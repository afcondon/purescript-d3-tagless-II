<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PSD3v3 Visual Test</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 { color: #333; margin-bottom: 10px; }
    h2 { color: #666; margin-top: 30px; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
    .description { color: #666; margin-bottom: 20px; }
    .viz-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
    }
    .viz-card {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .viz-card h3 {
      margin: 0 0 10px 0;
      color: #333;
    }
    .viz-card .subtitle {
      font-size: 12px;
      color: #999;
      margin-bottom: 15px;
    }
    .viz-container {
      display: flex;
      justify-content: center;
      background: #fafafa;
      border-radius: 4px;
      padding: 10px;
    }
    .viz-container svg {
      max-width: 100%;
      height: auto;
    }
    pre {
      background: #2d2d2d;
      color: #ccc;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
    }
    .codegen { color: #9cdcfe; }
    .highlight { color: #ce9178; }
  </style>
</head>
<body>
  <h1>PSD3v3 Visual Test</h1>
  <p class="description">
    Visual verification of the v3 "Finally Tagless" DSL. All SVGs below are generated
    server-side using the same polymorphic expressions that produce CodeGen output.
  </p>

  <h2>1. Parabola (y = x²)</h2>
  <div class="viz-grid">
    <div class="viz-card">
      <h3>Scatter Plot</h3>
      <div class="subtitle">scaleX = (x + 10) * 15 + 50 | scaleY = 250 - (y * 2)</div>
      <div class="viz-container" id="parabola"></div>
    </div>
  </div>

  <h2>2. Tree Layout</h2>
  <div class="viz-grid">
    <div class="viz-card">
      <h3>Hierarchical Tree</h3>
      <div class="subtitle">
        nodeRadius = if hasChildren then 8 else 5<br>
        nodeFill = if depth&lt;1 then red else (if hasChildren then blue else green)
      </div>
      <div class="viz-container" id="tree"></div>
    </div>
  </div>

  <h2>3. Sankey Diagram</h2>
  <div class="viz-grid">
    <div class="viz-card">
      <h3>Energy Flow</h3>
      <div class="subtitle">
        linkPath = sankeyLink sourceX sourceY0 sourceY1 targetX targetY0 targetY1
      </div>
      <div class="viz-container" id="sankey"></div>
    </div>
  </div>

  <h2>4. Update Pattern (Enter/Update/Exit)</h2>
  <div class="viz-grid">
    <div class="viz-card" style="grid-column: span 2;">
      <h3>Bar Chart with Data Updates</h3>
      <div class="subtitle">
        barFill = if value &lt; 50 then blue else (if value &lt; 75 then green else red)
      </div>
      <div class="viz-container" id="update-pattern"></div>
    </div>
  </div>

  <h2>5. Path Generators</h2>
  <div class="viz-grid">
    <div class="viz-card">
      <h3>Link Types</h3>
      <div class="subtitle">Horizontal, Vertical, and Sankey bezier curves</div>
      <div class="viz-container" id="paths"></div>
    </div>
    <div class="viz-card">
      <h3>Arc/Pie</h3>
      <div class="subtitle">arc startAngle endAngle innerRadius outerRadius</div>
      <div class="viz-container" id="arcs"></div>
    </div>
  </div>

  <script>
    // All SVGs generated by the v3 DSL (copy-pasted from test output)

    // Parabola
    document.getElementById('parabola').innerHTML = `
<svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">
  <rect width="400" height="300" fill="#f5f5f5" />
  <text x="200" y="25" text-anchor="middle" font-family="sans-serif" font-size="14">y = x² (Pure SVG, no D3!)</text>
  <line x1="50" y1="250" x2="350" y2="250" stroke="#999" stroke-width="1" />
  <g class="data-points">
    <circle cx="50.0" cy="50.0" r="6" fill="steelblue" stroke="white" stroke-width="2" />
    <circle cx="87.5" cy="137.5" r="6" fill="steelblue" stroke="white" stroke-width="2" />
    <circle cx="125.0" cy="200.0" r="6" fill="steelblue" stroke="white" stroke-width="2" />
    <circle cx="162.5" cy="237.5" r="6" fill="steelblue" stroke="white" stroke-width="2" />
    <circle cx="200.0" cy="250.0" r="6" fill="steelblue" stroke="white" stroke-width="2" />
    <circle cx="237.5" cy="237.5" r="6" fill="steelblue" stroke="white" stroke-width="2" />
    <circle cx="275.0" cy="200.0" r="6" fill="steelblue" stroke="white" stroke-width="2" />
    <circle cx="312.5" cy="137.5" r="6" fill="steelblue" stroke="white" stroke-width="2" />
    <circle cx="350.0" cy="50.0" r="6" fill="steelblue" stroke="white" stroke-width="2" />
  </g>
</svg>`;

    // Tree
    document.getElementById('tree').innerHTML = `
<svg width="300" height="320" xmlns="http://www.w3.org/2000/svg">
  <style>
    .node text { font: 10px sans-serif; text-anchor: middle; }
    .link { fill: none; stroke: #999; stroke-width: 1.5; }
  </style>
  <g class="links">
    <path class="link" d="M 150.0,50.0 C 150.0,100.0 75.0,100.0 75.0,150.0" />
    <path class="link" d="M 150.0,50.0 C 150.0,100.0 225.0,100.0 225.0,150.0" />
    <path class="link" d="M 75.0,150.0 C 75.0,200.0 37.5,200.0 37.5,250.0" />
    <path class="link" d="M 75.0,150.0 C 75.0,200.0 112.5,200.0 112.5,250.0" />
    <path class="link" d="M 225.0,150.0 C 225.0,200.0 225.0,200.0 225.0,250.0" />
  </g>
  <g class="nodes">
    <g class="node" transform="translate(150.0,50.0)">
      <circle r="8.0" fill="#e74c3c" stroke="white" stroke-width="2" />
      <text y="20.0">Root</text>
    </g>
    <g class="node" transform="translate(75.0,150.0)">
      <circle r="8.0" fill="#3498db" stroke="white" stroke-width="2" />
      <text y="20.0">A</text>
    </g>
    <g class="node" transform="translate(225.0,150.0)">
      <circle r="8.0" fill="#3498db" stroke="white" stroke-width="2" />
      <text y="20.0">B</text>
    </g>
    <g class="node" transform="translate(37.5,250.0)">
      <circle r="5.0" fill="#2ecc71" stroke="white" stroke-width="2" />
      <text y="20.0">A1</text>
    </g>
    <g class="node" transform="translate(112.5,250.0)">
      <circle r="5.0" fill="#2ecc71" stroke="white" stroke-width="2" />
      <text y="20.0">A2</text>
    </g>
    <g class="node" transform="translate(225.0,250.0)">
      <circle r="5.0" fill="#2ecc71" stroke="white" stroke-width="2" />
      <text y="20.0">B1</text>
    </g>
  </g>
</svg>`;

    // Sankey
    document.getElementById('sankey').innerHTML = `
<svg width="450" height="300" xmlns="http://www.w3.org/2000/svg">
  <style>
    .sankey-node rect { stroke: #333; }
    .sankey-node text { font: 11px sans-serif; }
    .sankey-link { fill-opacity: 0.5; stroke: none; }
  </style>
  <g class="sankey-links">
    <path class="sankey-link" fill="#a55" d="M 20.0,0.0 C 110.0,0.0 110.0,50.0 200.0,50.0 L 200.0,150.0 C 110.0,150.0 110.0,100.0 20.0,100.0 Z" />
    <path class="sankey-link" fill="#a77" d="M 20.0,100.0 C 110.0,100.0 110.0,150.0 200.0,150.0 L 200.0,200.0 C 110.0,200.0 110.0,150.0 20.0,150.0 Z" />
    <path class="sankey-link" fill="#a99" d="M 20.0,170.0 C 110.0,170.0 110.0,200.0 200.0,200.0 L 200.0,250.0 C 110.0,250.0 110.0,280.0 20.0,280.0 Z" />
  </g>
  <g class="sankey-nodes">
    <g class="sankey-node" transform="translate(0,0)">
      <rect width="20" height="150" fill="#555" />
      <text x="26" y="75" dy=".35em" text-anchor="start">Coal</text>
    </g>
    <g class="sankey-node" transform="translate(0,170)">
      <rect width="20" height="110" fill="#777" />
      <text x="26" y="55" dy=".35em" text-anchor="start">Gas</text>
    </g>
    <g class="sankey-node" transform="translate(200,50)">
      <rect width="20" height="200" fill="#c66" />
      <text x="26" y="100" dy=".35em" text-anchor="start">Power</text>
    </g>
    <g class="sankey-node" transform="translate(400,0)">
      <rect width="20" height="120" fill="#6c6" />
      <text x="-6" y="60" dy=".35em" text-anchor="end">Industry</text>
    </g>
    <g class="sankey-node" transform="translate(400,140)">
      <rect width="20" height="80" fill="#66c" />
      <text x="-6" y="40" dy=".35em" text-anchor="end">Residential</text>
    </g>
  </g>
</svg>`;

    // Update Pattern
    document.getElementById('update-pattern').innerHTML = `
<svg width="850" height="250" xmlns="http://www.w3.org/2000/svg">
  <style>
    text { font: 11px sans-serif; }
    .title { font-weight: bold; }
  </style>

  <!-- Dataset 1 -->
  <g transform="translate(20, 30)">
    <text class="title" x="0" y="-10">Dataset 1 (Initial)</text>
    <rect x="0.0" y="140.0" width="76.0" height="60.0" fill="#3498db" />
    <text x="38.0" y="215.0" text-anchor="middle">A</text>
    <rect x="80.0" y="40.0" width="76.0" height="160.0" fill="#e74c3c" />
    <text x="118.0" y="215.0" text-anchor="middle">B</text>
    <rect x="160.0" y="110.0" width="76.0" height="90.0" fill="#3498db" />
    <text x="198.0" y="215.0" text-anchor="middle">C</text>
    <rect x="240.0" y="80.0" width="76.0" height="120.0" fill="#2ecc71" />
    <text x="278.0" y="215.0" text-anchor="middle">D</text>
  </g>

  <!-- Dataset 2 -->
  <g transform="translate(450, 30)">
    <text class="title" x="0" y="-10">Dataset 2 (After Update)</text>
    <rect x="0.0" y="140.0" width="76.0" height="60.0" fill="#3498db" stroke="none" stroke-width="1" />
    <text x="38.0" y="215.0" text-anchor="middle">A</text>
    <rect x="80.0" y="10.0" width="76.0" height="190.0" fill="#e74c3c" stroke="#f39c12" stroke-width="2" />
    <text x="118.0" y="215.0" text-anchor="middle">B</text>
    <rect x="160.0" y="80.0" width="76.0" height="120.0" fill="#2ecc71" stroke="none" stroke-width="1" />
    <text x="198.0" y="215.0" text-anchor="middle">D</text>
    <rect x="240.0" y="60.0" width="76.0" height="140.0" fill="#2ecc71" stroke="#2ecc71" stroke-width="3" />
    <text x="278.0" y="215.0" text-anchor="middle">E</text>
  </g>

  <!-- Legend -->
  <g transform="translate(20, 240)">
    <rect x="0" y="-8" width="12" height="12" fill="none" stroke="#2ecc71" stroke-width="2" />
    <text x="18" y="0">Enter (new)</text>
    <rect x="100" y="-8" width="12" height="12" fill="none" stroke="#f39c12" stroke-width="2" />
    <text x="118" y="0">Update (changed)</text>
    <text x="230" y="0" fill="#95a5a6">C was removed (exit)</text>
  </g>
</svg>`;

    // Path types comparison
    document.getElementById('paths').innerHTML = `
<svg width="400" height="200" xmlns="http://www.w3.org/2000/svg">
  <style>
    .label { font: 11px sans-serif; fill: #666; }
    .path-demo { fill: none; stroke-width: 2; }
  </style>

  <!-- Horizontal link -->
  <g transform="translate(20, 30)">
    <text class="label" x="0" y="-10">linkHorizontal</text>
    <circle cx="0" cy="30" r="4" fill="#3498db" />
    <circle cx="100" cy="60" r="4" fill="#3498db" />
    <path class="path-demo" stroke="#3498db" d="M 0,30 C 50,30 50,60 100,60" />
  </g>

  <!-- Vertical link -->
  <g transform="translate(150, 30)">
    <text class="label" x="0" y="-10">linkVertical</text>
    <circle cx="30" cy="0" r="4" fill="#e74c3c" />
    <circle cx="70" cy="80" r="4" fill="#e74c3c" />
    <path class="path-demo" stroke="#e74c3c" d="M 30,0 C 30,40 70,40 70,80" />
  </g>

  <!-- Sankey ribbon -->
  <g transform="translate(270, 30)">
    <text class="label" x="0" y="-10">sankeyLink</text>
    <path class="path-demo" fill="#9b59b6" fill-opacity="0.5" stroke="#9b59b6"
          d="M 0,0 C 50,0 50,20 100,20 L 100,60 C 50,60 50,40 0,40 Z" />
  </g>
</svg>`;

    // Arcs
    document.getElementById('arcs').innerHTML = `
<svg width="300" height="200" xmlns="http://www.w3.org/2000/svg">
  <style>.label { font: 11px sans-serif; fill: #666; }</style>

  <!-- Pie slice -->
  <g transform="translate(75, 100)">
    <text class="label" x="0" y="-85">Pie (inner=0)</text>
    <path fill="#3498db" d="M 0,0 L 0,-70 A 70,70 0 0 1 70,0 Z" />
    <path fill="#e74c3c" d="M 0,0 L 70,0 A 70,70 0 0 1 0,70 Z" />
    <path fill="#2ecc71" d="M 0,0 L 0,70 A 70,70 0 0 1 -70,0 Z" />
    <path fill="#f39c12" d="M 0,0 L -70,0 A 70,70 0 0 1 0,-70 Z" />
  </g>

  <!-- Donut slice -->
  <g transform="translate(225, 100)">
    <text class="label" x="0" y="-85">Donut (inner=35)</text>
    <path fill="#3498db" d="M 0,-70 A 70,70 0 0 1 70,0 L 35,0 A 35,35 0 0 0 0,-35 Z" />
    <path fill="#e74c3c" d="M 70,0 A 70,70 0 0 1 0,70 L 0,35 A 35,35 0 0 0 35,0 Z" />
    <path fill="#2ecc71" d="M 0,70 A 70,70 0 0 1 -70,0 L -35,0 A 35,35 0 0 0 0,35 Z" />
    <path fill="#f39c12" d="M -70,0 A 70,70 0 0 1 0,-70 L 0,-35 A 35,35 0 0 0 -35,0 Z" />
  </g>
</svg>`;

  </script>
</body>
</html>
