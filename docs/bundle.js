/* Generated by Spago v0.93.44 */
(() => {
  // output/Control.Bind/foreign.js
  var arrayBind = typeof Array.prototype.flatMap === "function" ? function(arr) {
    return function(f) {
      return arr.flatMap(f);
    };
  } : function(arr) {
    return function(f) {
      var result = [];
      var l2 = arr.length;
      for (var i2 = 0; i2 < l2; i2++) {
        var xs = f(arr[i2]);
        var k = xs.length;
        for (var j = 0; j < k; j++) {
          result.push(xs[j]);
        }
      }
      return result;
    };
  };

  // output/Control.Apply/foreign.js
  var arrayApply = function(fs) {
    return function(xs) {
      var l2 = fs.length;
      var k = xs.length;
      var result = new Array(l2 * k);
      var n = 0;
      for (var i2 = 0; i2 < l2; i2++) {
        var f = fs[i2];
        for (var j = 0; j < k; j++) {
          result[n++] = f(xs[j]);
        }
      }
      return result;
    };
  };

  // output/Control.Semigroupoid/index.js
  var semigroupoidFn = {
    compose: function(f) {
      return function(g2) {
        return function(x32) {
          return f(g2(x32));
        };
      };
    }
  };

  // output/Control.Category/index.js
  var identity = function(dict) {
    return dict.identity;
  };
  var categoryFn = {
    identity: function(x32) {
      return x32;
    },
    Semigroupoid0: function() {
      return semigroupoidFn;
    }
  };

  // output/Data.Boolean/index.js
  var otherwise = true;

  // output/Data.Function/index.js
  var on = function(f) {
    return function(g2) {
      return function(x32) {
        return function(y32) {
          return f(g2(x32))(g2(y32));
        };
      };
    };
  };
  var flip = function(f) {
    return function(b10) {
      return function(a3) {
        return f(a3)(b10);
      };
    };
  };
  var $$const = function(a3) {
    return function(v2) {
      return a3;
    };
  };

  // output/Data.Functor/foreign.js
  var arrayMap = function(f) {
    return function(arr) {
      var l2 = arr.length;
      var result = new Array(l2);
      for (var i2 = 0; i2 < l2; i2++) {
        result[i2] = f(arr[i2]);
      }
      return result;
    };
  };

  // output/Data.Unit/foreign.js
  var unit = void 0;

  // output/Type.Proxy/index.js
  var $$Proxy = /* @__PURE__ */ (function() {
    function $$Proxy2() {
    }
    ;
    $$Proxy2.value = new $$Proxy2();
    return $$Proxy2;
  })();

  // output/Data.Functor/index.js
  var map = function(dict) {
    return dict.map;
  };
  var mapFlipped = function(dictFunctor) {
    var map131 = map(dictFunctor);
    return function(fa) {
      return function(f) {
        return map131(f)(fa);
      };
    };
  };
  var $$void = function(dictFunctor) {
    return map(dictFunctor)($$const(unit));
  };
  var voidLeft = function(dictFunctor) {
    var map131 = map(dictFunctor);
    return function(f) {
      return function(x32) {
        return map131($$const(x32))(f);
      };
    };
  };
  var voidRight = function(dictFunctor) {
    var map131 = map(dictFunctor);
    return function(x32) {
      return map131($$const(x32));
    };
  };
  var functorArray = {
    map: arrayMap
  };

  // output/Control.Apply/index.js
  var identity2 = /* @__PURE__ */ identity(categoryFn);
  var applyArray = {
    apply: arrayApply,
    Functor0: function() {
      return functorArray;
    }
  };
  var apply = function(dict) {
    return dict.apply;
  };
  var applyFirst = function(dictApply) {
    var apply1 = apply(dictApply);
    var map131 = map(dictApply.Functor0());
    return function(a3) {
      return function(b10) {
        return apply1(map131($$const)(a3))(b10);
      };
    };
  };
  var applySecond = function(dictApply) {
    var apply1 = apply(dictApply);
    var map131 = map(dictApply.Functor0());
    return function(a3) {
      return function(b10) {
        return apply1(map131($$const(identity2))(a3))(b10);
      };
    };
  };
  var lift2 = function(dictApply) {
    var apply1 = apply(dictApply);
    var map131 = map(dictApply.Functor0());
    return function(f) {
      return function(a3) {
        return function(b10) {
          return apply1(map131(f)(a3))(b10);
        };
      };
    };
  };

  // output/Control.Applicative/index.js
  var pure = function(dict) {
    return dict.pure;
  };
  var unless = function(dictApplicative) {
    var pure128 = pure(dictApplicative);
    return function(v2) {
      return function(v1) {
        if (!v2) {
          return v1;
        }
        ;
        if (v2) {
          return pure128(unit);
        }
        ;
        throw new Error("Failed pattern match at Control.Applicative (line 68, column 1 - line 68, column 65): " + [v2.constructor.name, v1.constructor.name]);
      };
    };
  };
  var when = function(dictApplicative) {
    var pure128 = pure(dictApplicative);
    return function(v2) {
      return function(v1) {
        if (v2) {
          return v1;
        }
        ;
        if (!v2) {
          return pure128(unit);
        }
        ;
        throw new Error("Failed pattern match at Control.Applicative (line 63, column 1 - line 63, column 63): " + [v2.constructor.name, v1.constructor.name]);
      };
    };
  };
  var liftA1 = function(dictApplicative) {
    var apply7 = apply(dictApplicative.Apply0());
    var pure128 = pure(dictApplicative);
    return function(f) {
      return function(a3) {
        return apply7(pure128(f))(a3);
      };
    };
  };
  var applicativeArray = {
    pure: function(x32) {
      return [x32];
    },
    Apply0: function() {
      return applyArray;
    }
  };

  // output/Control.Bind/index.js
  var identity3 = /* @__PURE__ */ identity(categoryFn);
  var discard = function(dict) {
    return dict.discard;
  };
  var bindArray = {
    bind: arrayBind,
    Apply0: function() {
      return applyArray;
    }
  };
  var bind = function(dict) {
    return dict.bind;
  };
  var bindFlipped = function(dictBind) {
    return flip(bind(dictBind));
  };
  var composeKleisliFlipped = function(dictBind) {
    var bindFlipped12 = bindFlipped(dictBind);
    return function(f) {
      return function(g2) {
        return function(a3) {
          return bindFlipped12(f)(g2(a3));
        };
      };
    };
  };
  var composeKleisli = function(dictBind) {
    var bind142 = bind(dictBind);
    return function(f) {
      return function(g2) {
        return function(a3) {
          return bind142(f(a3))(g2);
        };
      };
    };
  };
  var discardUnit = {
    discard: function(dictBind) {
      return bind(dictBind);
    }
  };
  var join = function(dictBind) {
    var bind142 = bind(dictBind);
    return function(m2) {
      return bind142(m2)(identity3);
    };
  };

  // output/Data.Bounded/foreign.js
  var topInt = 2147483647;
  var bottomInt = -2147483648;
  var topChar = String.fromCharCode(65535);
  var bottomChar = String.fromCharCode(0);
  var topNumber = Number.POSITIVE_INFINITY;
  var bottomNumber = Number.NEGATIVE_INFINITY;

  // output/Data.Ord/foreign.js
  var unsafeCompareImpl = function(lt2) {
    return function(eq20) {
      return function(gt2) {
        return function(x32) {
          return function(y32) {
            return x32 < y32 ? lt2 : x32 === y32 ? eq20 : gt2;
          };
        };
      };
    };
  };
  var ordBooleanImpl = unsafeCompareImpl;
  var ordIntImpl = unsafeCompareImpl;
  var ordNumberImpl = unsafeCompareImpl;
  var ordStringImpl = unsafeCompareImpl;
  var ordCharImpl = unsafeCompareImpl;
  var ordArrayImpl = function(f) {
    return function(xs) {
      return function(ys) {
        var i2 = 0;
        var xlen = xs.length;
        var ylen = ys.length;
        while (i2 < xlen && i2 < ylen) {
          var x32 = xs[i2];
          var y32 = ys[i2];
          var o = f(x32)(y32);
          if (o !== 0) {
            return o;
          }
          i2++;
        }
        if (xlen === ylen) {
          return 0;
        } else if (xlen > ylen) {
          return -1;
        } else {
          return 1;
        }
      };
    };
  };

  // output/Data.Eq/foreign.js
  var refEq = function(r1) {
    return function(r29) {
      return r1 === r29;
    };
  };
  var eqBooleanImpl = refEq;
  var eqIntImpl = refEq;
  var eqNumberImpl = refEq;
  var eqCharImpl = refEq;
  var eqStringImpl = refEq;
  var eqArrayImpl = function(f) {
    return function(xs) {
      return function(ys) {
        if (xs.length !== ys.length) return false;
        for (var i2 = 0; i2 < xs.length; i2++) {
          if (!f(xs[i2])(ys[i2])) return false;
        }
        return true;
      };
    };
  };

  // output/Data.Symbol/index.js
  var reflectSymbol = function(dict) {
    return dict.reflectSymbol;
  };

  // output/Record.Unsafe/foreign.js
  var unsafeGet = function(label5) {
    return function(rec) {
      return rec[label5];
    };
  };

  // output/Data.Eq/index.js
  var eqUnit = {
    eq: function(v2) {
      return function(v1) {
        return true;
      };
    }
  };
  var eqString = {
    eq: eqStringImpl
  };
  var eqRowNil = {
    eqRecord: function(v2) {
      return function(v1) {
        return function(v22) {
          return true;
        };
      };
    }
  };
  var eqRecord = function(dict) {
    return dict.eqRecord;
  };
  var eqRec = function() {
    return function(dictEqRecord) {
      return {
        eq: eqRecord(dictEqRecord)($$Proxy.value)
      };
    };
  };
  var eqNumber = {
    eq: eqNumberImpl
  };
  var eqInt = {
    eq: eqIntImpl
  };
  var eqChar = {
    eq: eqCharImpl
  };
  var eqBoolean = {
    eq: eqBooleanImpl
  };
  var eq = function(dict) {
    return dict.eq;
  };
  var eq2 = /* @__PURE__ */ eq(eqBoolean);
  var eqArray = function(dictEq) {
    return {
      eq: eqArrayImpl(eq(dictEq))
    };
  };
  var eqRowCons = function(dictEqRecord) {
    var eqRecord1 = eqRecord(dictEqRecord);
    return function() {
      return function(dictIsSymbol) {
        var reflectSymbol2 = reflectSymbol(dictIsSymbol);
        return function(dictEq) {
          var eq34 = eq(dictEq);
          return {
            eqRecord: function(v2) {
              return function(ra) {
                return function(rb) {
                  var tail3 = eqRecord1($$Proxy.value)(ra)(rb);
                  var key2 = reflectSymbol2($$Proxy.value);
                  var get22 = unsafeGet(key2);
                  return eq34(get22(ra))(get22(rb)) && tail3;
                };
              };
            }
          };
        };
      };
    };
  };
  var notEq = function(dictEq) {
    var eq34 = eq(dictEq);
    return function(x32) {
      return function(y32) {
        return eq2(eq34(x32)(y32))(false);
      };
    };
  };

  // output/Data.Ordering/index.js
  var LT = /* @__PURE__ */ (function() {
    function LT2() {
    }
    ;
    LT2.value = new LT2();
    return LT2;
  })();
  var GT = /* @__PURE__ */ (function() {
    function GT2() {
    }
    ;
    GT2.value = new GT2();
    return GT2;
  })();
  var EQ = /* @__PURE__ */ (function() {
    function EQ2() {
    }
    ;
    EQ2.value = new EQ2();
    return EQ2;
  })();
  var semigroupOrdering = {
    append: function(v2) {
      return function(v1) {
        if (v2 instanceof LT) {
          return LT.value;
        }
        ;
        if (v2 instanceof GT) {
          return GT.value;
        }
        ;
        if (v2 instanceof EQ) {
          return v1;
        }
        ;
        throw new Error("Failed pattern match at Data.Ordering (line 21, column 1 - line 24, column 18): " + [v2.constructor.name, v1.constructor.name]);
      };
    }
  };
  var eqOrdering = {
    eq: function(v2) {
      return function(v1) {
        if (v2 instanceof LT && v1 instanceof LT) {
          return true;
        }
        ;
        if (v2 instanceof GT && v1 instanceof GT) {
          return true;
        }
        ;
        if (v2 instanceof EQ && v1 instanceof EQ) {
          return true;
        }
        ;
        return false;
      };
    }
  };

  // output/Data.Ring/foreign.js
  var intSub = function(x32) {
    return function(y32) {
      return x32 - y32 | 0;
    };
  };

  // output/Data.Semiring/foreign.js
  var intAdd = function(x32) {
    return function(y32) {
      return x32 + y32 | 0;
    };
  };
  var intMul = function(x32) {
    return function(y32) {
      return x32 * y32 | 0;
    };
  };
  var numAdd = function(n1) {
    return function(n2) {
      return n1 + n2;
    };
  };
  var numMul = function(n1) {
    return function(n2) {
      return n1 * n2;
    };
  };

  // output/Data.Semiring/index.js
  var zero = function(dict) {
    return dict.zero;
  };
  var semiringNumber = {
    add: numAdd,
    zero: 0,
    mul: numMul,
    one: 1
  };
  var semiringInt = {
    add: intAdd,
    zero: 0,
    mul: intMul,
    one: 1
  };
  var one = function(dict) {
    return dict.one;
  };
  var mul = function(dict) {
    return dict.mul;
  };
  var add = function(dict) {
    return dict.add;
  };

  // output/Data.Ring/index.js
  var ringInt = {
    sub: intSub,
    Semiring0: function() {
      return semiringInt;
    }
  };

  // output/Data.Ord/index.js
  var eqRec2 = /* @__PURE__ */ eqRec();
  var notEq2 = /* @__PURE__ */ notEq(eqOrdering);
  var ordUnit = {
    compare: function(v2) {
      return function(v1) {
        return EQ.value;
      };
    },
    Eq0: function() {
      return eqUnit;
    }
  };
  var ordString = /* @__PURE__ */ (function() {
    return {
      compare: ordStringImpl(LT.value)(EQ.value)(GT.value),
      Eq0: function() {
        return eqString;
      }
    };
  })();
  var ordRecordNil = {
    compareRecord: function(v2) {
      return function(v1) {
        return function(v22) {
          return EQ.value;
        };
      };
    },
    EqRecord0: function() {
      return eqRowNil;
    }
  };
  var ordNumber = /* @__PURE__ */ (function() {
    return {
      compare: ordNumberImpl(LT.value)(EQ.value)(GT.value),
      Eq0: function() {
        return eqNumber;
      }
    };
  })();
  var ordInt = /* @__PURE__ */ (function() {
    return {
      compare: ordIntImpl(LT.value)(EQ.value)(GT.value),
      Eq0: function() {
        return eqInt;
      }
    };
  })();
  var ordChar = /* @__PURE__ */ (function() {
    return {
      compare: ordCharImpl(LT.value)(EQ.value)(GT.value),
      Eq0: function() {
        return eqChar;
      }
    };
  })();
  var ordBoolean = /* @__PURE__ */ (function() {
    return {
      compare: ordBooleanImpl(LT.value)(EQ.value)(GT.value),
      Eq0: function() {
        return eqBoolean;
      }
    };
  })();
  var compareRecord = function(dict) {
    return dict.compareRecord;
  };
  var ordRecord = function() {
    return function(dictOrdRecord) {
      var eqRec1 = eqRec2(dictOrdRecord.EqRecord0());
      return {
        compare: compareRecord(dictOrdRecord)($$Proxy.value),
        Eq0: function() {
          return eqRec1;
        }
      };
    };
  };
  var compare = function(dict) {
    return dict.compare;
  };
  var compare2 = /* @__PURE__ */ compare(ordInt);
  var comparing = function(dictOrd) {
    var compare32 = compare(dictOrd);
    return function(f) {
      return function(x32) {
        return function(y32) {
          return compare32(f(x32))(f(y32));
        };
      };
    };
  };
  var max = function(dictOrd) {
    var compare32 = compare(dictOrd);
    return function(x32) {
      return function(y32) {
        var v2 = compare32(x32)(y32);
        if (v2 instanceof LT) {
          return y32;
        }
        ;
        if (v2 instanceof EQ) {
          return x32;
        }
        ;
        if (v2 instanceof GT) {
          return x32;
        }
        ;
        throw new Error("Failed pattern match at Data.Ord (line 181, column 3 - line 184, column 12): " + [v2.constructor.name]);
      };
    };
  };
  var min = function(dictOrd) {
    var compare32 = compare(dictOrd);
    return function(x32) {
      return function(y32) {
        var v2 = compare32(x32)(y32);
        if (v2 instanceof LT) {
          return x32;
        }
        ;
        if (v2 instanceof EQ) {
          return x32;
        }
        ;
        if (v2 instanceof GT) {
          return y32;
        }
        ;
        throw new Error("Failed pattern match at Data.Ord (line 172, column 3 - line 175, column 12): " + [v2.constructor.name]);
      };
    };
  };
  var ordArray = function(dictOrd) {
    var compare32 = compare(dictOrd);
    var eqArray2 = eqArray(dictOrd.Eq0());
    return {
      compare: /* @__PURE__ */ (function() {
        var toDelta = function(x32) {
          return function(y32) {
            var v2 = compare32(x32)(y32);
            if (v2 instanceof EQ) {
              return 0;
            }
            ;
            if (v2 instanceof LT) {
              return 1;
            }
            ;
            if (v2 instanceof GT) {
              return -1 | 0;
            }
            ;
            throw new Error("Failed pattern match at Data.Ord (line 79, column 7 - line 82, column 17): " + [v2.constructor.name]);
          };
        };
        return function(xs) {
          return function(ys) {
            return compare2(0)(ordArrayImpl(toDelta)(xs)(ys));
          };
        };
      })(),
      Eq0: function() {
        return eqArray2;
      }
    };
  };
  var ordRecordCons = function(dictOrdRecord) {
    var compareRecord1 = compareRecord(dictOrdRecord);
    var eqRowCons2 = eqRowCons(dictOrdRecord.EqRecord0())();
    return function() {
      return function(dictIsSymbol) {
        var reflectSymbol2 = reflectSymbol(dictIsSymbol);
        var eqRowCons1 = eqRowCons2(dictIsSymbol);
        return function(dictOrd) {
          var compare32 = compare(dictOrd);
          var eqRowCons22 = eqRowCons1(dictOrd.Eq0());
          return {
            compareRecord: function(v2) {
              return function(ra) {
                return function(rb) {
                  var key2 = reflectSymbol2($$Proxy.value);
                  var left2 = compare32(unsafeGet(key2)(ra))(unsafeGet(key2)(rb));
                  var $95 = notEq2(left2)(EQ.value);
                  if ($95) {
                    return left2;
                  }
                  ;
                  return compareRecord1($$Proxy.value)(ra)(rb);
                };
              };
            },
            EqRecord0: function() {
              return eqRowCons22;
            }
          };
        };
      };
    };
  };
  var clamp = function(dictOrd) {
    var min1 = min(dictOrd);
    var max111 = max(dictOrd);
    return function(low2) {
      return function(hi) {
        return function(x32) {
          return min1(hi)(max111(low2)(x32));
        };
      };
    };
  };

  // output/Data.Bounded/index.js
  var top = function(dict) {
    return dict.top;
  };
  var boundedInt = {
    top: topInt,
    bottom: bottomInt,
    Ord0: function() {
      return ordInt;
    }
  };
  var boundedChar = {
    top: topChar,
    bottom: bottomChar,
    Ord0: function() {
      return ordChar;
    }
  };
  var bottom = function(dict) {
    return dict.bottom;
  };

  // output/Data.Show/foreign.js
  var showIntImpl = function(n) {
    return n.toString();
  };
  var showNumberImpl = function(n) {
    var str23 = n.toString();
    return isNaN(str23 + ".0") ? str23 : str23 + ".0";
  };
  var showStringImpl = function(s3) {
    var l2 = s3.length;
    return '"' + s3.replace(
      /[\0-\x1F\x7F"\\]/g,
      // eslint-disable-line no-control-regex
      function(c2, i2) {
        switch (c2) {
          case '"':
          case "\\":
            return "\\" + c2;
          case "\x07":
            return "\\a";
          case "\b":
            return "\\b";
          case "\f":
            return "\\f";
          case "\n":
            return "\\n";
          case "\r":
            return "\\r";
          case "	":
            return "\\t";
          case "\v":
            return "\\v";
        }
        var k = i2 + 1;
        var empty10 = k < l2 && s3[k] >= "0" && s3[k] <= "9" ? "\\&" : "";
        return "\\" + c2.charCodeAt(0).toString(10) + empty10;
      }
    ) + '"';
  };
  var showArrayImpl = function(f) {
    return function(xs) {
      var ss = [];
      for (var i2 = 0, l2 = xs.length; i2 < l2; i2++) {
        ss[i2] = f(xs[i2]);
      }
      return "[" + ss.join(",") + "]";
    };
  };

  // output/Data.Show/index.js
  var showString = {
    show: showStringImpl
  };
  var showNumber = {
    show: showNumberImpl
  };
  var showInt = {
    show: showIntImpl
  };
  var showBoolean = {
    show: function(v2) {
      if (v2) {
        return "true";
      }
      ;
      if (!v2) {
        return "false";
      }
      ;
      throw new Error("Failed pattern match at Data.Show (line 29, column 1 - line 31, column 23): " + [v2.constructor.name]);
    }
  };
  var show = function(dict) {
    return dict.show;
  };
  var showArray = function(dictShow) {
    return {
      show: showArrayImpl(show(dictShow))
    };
  };

  // output/Data.HeytingAlgebra/foreign.js
  var boolConj = function(b12) {
    return function(b22) {
      return b12 && b22;
    };
  };
  var boolDisj = function(b12) {
    return function(b22) {
      return b12 || b22;
    };
  };
  var boolNot = function(b10) {
    return !b10;
  };

  // output/Data.HeytingAlgebra/index.js
  var tt = function(dict) {
    return dict.tt;
  };
  var not = function(dict) {
    return dict.not;
  };
  var implies = function(dict) {
    return dict.implies;
  };
  var ff = function(dict) {
    return dict.ff;
  };
  var disj = function(dict) {
    return dict.disj;
  };
  var heytingAlgebraBoolean = {
    ff: false,
    tt: true,
    implies: function(a3) {
      return function(b10) {
        return disj(heytingAlgebraBoolean)(not(heytingAlgebraBoolean)(a3))(b10);
      };
    },
    conj: boolConj,
    disj: boolDisj,
    not: boolNot
  };
  var conj = function(dict) {
    return dict.conj;
  };
  var heytingAlgebraFunction = function(dictHeytingAlgebra) {
    var ff1 = ff(dictHeytingAlgebra);
    var tt1 = tt(dictHeytingAlgebra);
    var implies1 = implies(dictHeytingAlgebra);
    var conj1 = conj(dictHeytingAlgebra);
    var disj1 = disj(dictHeytingAlgebra);
    var not1 = not(dictHeytingAlgebra);
    return {
      ff: function(v2) {
        return ff1;
      },
      tt: function(v2) {
        return tt1;
      },
      implies: function(f) {
        return function(g2) {
          return function(a3) {
            return implies1(f(a3))(g2(a3));
          };
        };
      },
      conj: function(f) {
        return function(g2) {
          return function(a3) {
            return conj1(f(a3))(g2(a3));
          };
        };
      },
      disj: function(f) {
        return function(g2) {
          return function(a3) {
            return disj1(f(a3))(g2(a3));
          };
        };
      },
      not: function(f) {
        return function(a3) {
          return not1(f(a3));
        };
      }
    };
  };

  // output/Data.EuclideanRing/foreign.js
  var intDegree = function(x32) {
    return Math.min(Math.abs(x32), 2147483647);
  };
  var intDiv = function(x32) {
    return function(y32) {
      if (y32 === 0) return 0;
      return y32 > 0 ? Math.floor(x32 / y32) : -Math.floor(x32 / -y32);
    };
  };
  var intMod = function(x32) {
    return function(y32) {
      if (y32 === 0) return 0;
      var yy = Math.abs(y32);
      return (x32 % yy + yy) % yy;
    };
  };

  // output/Data.CommutativeRing/index.js
  var commutativeRingInt = {
    Ring0: function() {
      return ringInt;
    }
  };

  // output/Data.EuclideanRing/index.js
  var mod = function(dict) {
    return dict.mod;
  };
  var euclideanRingInt = {
    degree: intDegree,
    div: intDiv,
    mod: intMod,
    CommutativeRing0: function() {
      return commutativeRingInt;
    }
  };
  var div = function(dict) {
    return dict.div;
  };

  // output/Data.Semigroup/foreign.js
  var concatString = function(s1) {
    return function(s22) {
      return s1 + s22;
    };
  };
  var concatArray = function(xs) {
    return function(ys) {
      if (xs.length === 0) return ys;
      if (ys.length === 0) return xs;
      return xs.concat(ys);
    };
  };

  // output/Data.Semigroup/index.js
  var semigroupString = {
    append: concatString
  };
  var semigroupArray = {
    append: concatArray
  };
  var append = function(dict) {
    return dict.append;
  };

  // output/Data.Monoid/index.js
  var monoidString = {
    mempty: "",
    Semigroup0: function() {
      return semigroupString;
    }
  };
  var mempty = function(dict) {
    return dict.mempty;
  };

  // output/Data.Tuple/index.js
  var Tuple = /* @__PURE__ */ (function() {
    function Tuple2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    Tuple2.create = function(value0) {
      return function(value1) {
        return new Tuple2(value0, value1);
      };
    };
    return Tuple2;
  })();
  var snd = function(v2) {
    return v2.value1;
  };
  var functorTuple = {
    map: function(f) {
      return function(m2) {
        return new Tuple(m2.value0, f(m2.value1));
      };
    }
  };
  var fst = function(v2) {
    return v2.value0;
  };
  var eqTuple = function(dictEq) {
    var eq20 = eq(dictEq);
    return function(dictEq1) {
      var eq111 = eq(dictEq1);
      return {
        eq: function(x32) {
          return function(y32) {
            return eq20(x32.value0)(y32.value0) && eq111(x32.value1)(y32.value1);
          };
        }
      };
    };
  };
  var ordTuple = function(dictOrd) {
    var compare24 = compare(dictOrd);
    var eqTuple1 = eqTuple(dictOrd.Eq0());
    return function(dictOrd1) {
      var compare111 = compare(dictOrd1);
      var eqTuple2 = eqTuple1(dictOrd1.Eq0());
      return {
        compare: function(x32) {
          return function(y32) {
            var v2 = compare24(x32.value0)(y32.value0);
            if (v2 instanceof LT) {
              return LT.value;
            }
            ;
            if (v2 instanceof GT) {
              return GT.value;
            }
            ;
            return compare111(x32.value1)(y32.value1);
          };
        },
        Eq0: function() {
          return eqTuple2;
        }
      };
    };
  };

  // output/Control.Monad.State.Class/index.js
  var state = function(dict) {
    return dict.state;
  };
  var modify_ = function(dictMonadState) {
    var state1 = state(dictMonadState);
    return function(f) {
      return state1(function(s3) {
        return new Tuple(unit, f(s3));
      });
    };
  };
  var get = function(dictMonadState) {
    return state(dictMonadState)(function(s3) {
      return new Tuple(s3, s3);
    });
  };

  // output/Control.Alt/index.js
  var alt = function(dict) {
    return dict.alt;
  };

  // output/Control.Monad/index.js
  var unlessM = function(dictMonad) {
    var bind100 = bind(dictMonad.Bind1());
    var unless3 = unless(dictMonad.Applicative0());
    return function(mb) {
      return function(m2) {
        return bind100(mb)(function(b10) {
          return unless3(b10)(m2);
        });
      };
    };
  };
  var ap = function(dictMonad) {
    var bind100 = bind(dictMonad.Bind1());
    var pure107 = pure(dictMonad.Applicative0());
    return function(f) {
      return function(a3) {
        return bind100(f)(function(f$prime) {
          return bind100(a3)(function(a$prime) {
            return pure107(f$prime(a$prime));
          });
        });
      };
    };
  };

  // output/Data.Maybe/index.js
  var identity4 = /* @__PURE__ */ identity(categoryFn);
  var Nothing = /* @__PURE__ */ (function() {
    function Nothing2() {
    }
    ;
    Nothing2.value = new Nothing2();
    return Nothing2;
  })();
  var Just = /* @__PURE__ */ (function() {
    function Just2(value0) {
      this.value0 = value0;
    }
    ;
    Just2.create = function(value0) {
      return new Just2(value0);
    };
    return Just2;
  })();
  var maybe = function(v2) {
    return function(v1) {
      return function(v22) {
        if (v22 instanceof Nothing) {
          return v2;
        }
        ;
        if (v22 instanceof Just) {
          return v1(v22.value0);
        }
        ;
        throw new Error("Failed pattern match at Data.Maybe (line 237, column 1 - line 237, column 51): " + [v2.constructor.name, v1.constructor.name, v22.constructor.name]);
      };
    };
  };
  var isNothing = /* @__PURE__ */ maybe(true)(/* @__PURE__ */ $$const(false));
  var isJust = /* @__PURE__ */ maybe(false)(/* @__PURE__ */ $$const(true));
  var functorMaybe = {
    map: function(v2) {
      return function(v1) {
        if (v1 instanceof Just) {
          return new Just(v2(v1.value0));
        }
        ;
        return Nothing.value;
      };
    }
  };
  var map2 = /* @__PURE__ */ map(functorMaybe);
  var fromMaybe = function(a3) {
    return maybe(a3)(identity4);
  };
  var fromJust = function() {
    return function(v2) {
      if (v2 instanceof Just) {
        return v2.value0;
      }
      ;
      throw new Error("Failed pattern match at Data.Maybe (line 288, column 1 - line 288, column 46): " + [v2.constructor.name]);
    };
  };
  var eqMaybe = function(dictEq) {
    var eq20 = eq(dictEq);
    return {
      eq: function(x32) {
        return function(y32) {
          if (x32 instanceof Nothing && y32 instanceof Nothing) {
            return true;
          }
          ;
          if (x32 instanceof Just && y32 instanceof Just) {
            return eq20(x32.value0)(y32.value0);
          }
          ;
          return false;
        };
      }
    };
  };
  var ordMaybe = function(dictOrd) {
    var compare24 = compare(dictOrd);
    var eqMaybe1 = eqMaybe(dictOrd.Eq0());
    return {
      compare: function(x32) {
        return function(y32) {
          if (x32 instanceof Nothing && y32 instanceof Nothing) {
            return EQ.value;
          }
          ;
          if (x32 instanceof Nothing) {
            return LT.value;
          }
          ;
          if (y32 instanceof Nothing) {
            return GT.value;
          }
          ;
          if (x32 instanceof Just && y32 instanceof Just) {
            return compare24(x32.value0)(y32.value0);
          }
          ;
          throw new Error("Failed pattern match at Data.Maybe (line 0, column 0 - line 0, column 0): " + [x32.constructor.name, y32.constructor.name]);
        };
      },
      Eq0: function() {
        return eqMaybe1;
      }
    };
  };
  var applyMaybe = {
    apply: function(v2) {
      return function(v1) {
        if (v2 instanceof Just) {
          return map2(v2.value0)(v1);
        }
        ;
        if (v2 instanceof Nothing) {
          return Nothing.value;
        }
        ;
        throw new Error("Failed pattern match at Data.Maybe (line 67, column 1 - line 69, column 30): " + [v2.constructor.name, v1.constructor.name]);
      };
    },
    Functor0: function() {
      return functorMaybe;
    }
  };
  var bindMaybe = {
    bind: function(v2) {
      return function(v1) {
        if (v2 instanceof Just) {
          return v1(v2.value0);
        }
        ;
        if (v2 instanceof Nothing) {
          return Nothing.value;
        }
        ;
        throw new Error("Failed pattern match at Data.Maybe (line 125, column 1 - line 127, column 28): " + [v2.constructor.name, v1.constructor.name]);
      };
    },
    Apply0: function() {
      return applyMaybe;
    }
  };
  var applicativeMaybe = /* @__PURE__ */ (function() {
    return {
      pure: Just.create,
      Apply0: function() {
        return applyMaybe;
      }
    };
  })();
  var altMaybe = {
    alt: function(v2) {
      return function(v1) {
        if (v2 instanceof Nothing) {
          return v1;
        }
        ;
        return v2;
      };
    },
    Functor0: function() {
      return functorMaybe;
    }
  };
  var plusMaybe = /* @__PURE__ */ (function() {
    return {
      empty: Nothing.value,
      Alt0: function() {
        return altMaybe;
      }
    };
  })();
  var alternativeMaybe = {
    Applicative0: function() {
      return applicativeMaybe;
    },
    Plus1: function() {
      return plusMaybe;
    }
  };

  // output/Data.Either/index.js
  var Left = /* @__PURE__ */ (function() {
    function Left4(value0) {
      this.value0 = value0;
    }
    ;
    Left4.create = function(value0) {
      return new Left4(value0);
    };
    return Left4;
  })();
  var Right = /* @__PURE__ */ (function() {
    function Right4(value0) {
      this.value0 = value0;
    }
    ;
    Right4.create = function(value0) {
      return new Right4(value0);
    };
    return Right4;
  })();
  var note = function(a3) {
    return maybe(new Left(a3))(Right.create);
  };
  var functorEither = {
    map: function(f) {
      return function(m2) {
        if (m2 instanceof Left) {
          return new Left(m2.value0);
        }
        ;
        if (m2 instanceof Right) {
          return new Right(f(m2.value0));
        }
        ;
        throw new Error("Failed pattern match at Data.Either (line 0, column 0 - line 0, column 0): " + [m2.constructor.name]);
      };
    }
  };
  var map3 = /* @__PURE__ */ map(functorEither);
  var either = function(v2) {
    return function(v1) {
      return function(v22) {
        if (v22 instanceof Left) {
          return v2(v22.value0);
        }
        ;
        if (v22 instanceof Right) {
          return v1(v22.value0);
        }
        ;
        throw new Error("Failed pattern match at Data.Either (line 208, column 1 - line 208, column 64): " + [v2.constructor.name, v1.constructor.name, v22.constructor.name]);
      };
    };
  };
  var applyEither = {
    apply: function(v2) {
      return function(v1) {
        if (v2 instanceof Left) {
          return new Left(v2.value0);
        }
        ;
        if (v2 instanceof Right) {
          return map3(v2.value0)(v1);
        }
        ;
        throw new Error("Failed pattern match at Data.Either (line 70, column 1 - line 72, column 30): " + [v2.constructor.name, v1.constructor.name]);
      };
    },
    Functor0: function() {
      return functorEither;
    }
  };
  var applicativeEither = /* @__PURE__ */ (function() {
    return {
      pure: Right.create,
      Apply0: function() {
        return applyEither;
      }
    };
  })();

  // output/Data.Identity/index.js
  var Identity = function(x32) {
    return x32;
  };
  var functorIdentity = {
    map: function(f) {
      return function(m2) {
        return f(m2);
      };
    }
  };
  var applyIdentity = {
    apply: function(v2) {
      return function(v1) {
        return v2(v1);
      };
    },
    Functor0: function() {
      return functorIdentity;
    }
  };
  var bindIdentity = {
    bind: function(v2) {
      return function(f) {
        return f(v2);
      };
    },
    Apply0: function() {
      return applyIdentity;
    }
  };
  var applicativeIdentity = {
    pure: Identity,
    Apply0: function() {
      return applyIdentity;
    }
  };
  var monadIdentity = {
    Applicative0: function() {
      return applicativeIdentity;
    },
    Bind1: function() {
      return bindIdentity;
    }
  };

  // output/Effect/foreign.js
  var pureE = function(a3) {
    return function() {
      return a3;
    };
  };
  var bindE = function(a3) {
    return function(f) {
      return function() {
        return f(a3())();
      };
    };
  };

  // output/Effect/index.js
  var $runtime_lazy = function(name16, moduleName, init4) {
    var state3 = 0;
    var val;
    return function(lineNumber) {
      if (state3 === 2) return val;
      if (state3 === 1) throw new ReferenceError(name16 + " was needed before it finished initializing (module " + moduleName + ", line " + lineNumber + ")", moduleName, lineNumber);
      state3 = 1;
      val = init4();
      state3 = 2;
      return val;
    };
  };
  var monadEffect = {
    Applicative0: function() {
      return applicativeEffect;
    },
    Bind1: function() {
      return bindEffect;
    }
  };
  var bindEffect = {
    bind: bindE,
    Apply0: function() {
      return $lazy_applyEffect(0);
    }
  };
  var applicativeEffect = {
    pure: pureE,
    Apply0: function() {
      return $lazy_applyEffect(0);
    }
  };
  var $lazy_functorEffect = /* @__PURE__ */ $runtime_lazy("functorEffect", "Effect", function() {
    return {
      map: liftA1(applicativeEffect)
    };
  });
  var $lazy_applyEffect = /* @__PURE__ */ $runtime_lazy("applyEffect", "Effect", function() {
    return {
      apply: ap(monadEffect),
      Functor0: function() {
        return $lazy_functorEffect(0);
      }
    };
  });
  var functorEffect = /* @__PURE__ */ $lazy_functorEffect(20);
  var applyEffect = /* @__PURE__ */ $lazy_applyEffect(23);

  // output/Effect.Ref/foreign.js
  var _new = function(val) {
    return function() {
      return { value: val };
    };
  };
  var read = function(ref2) {
    return function() {
      return ref2.value;
    };
  };
  var modifyImpl = function(f) {
    return function(ref2) {
      return function() {
        var t2 = f(ref2.value);
        ref2.value = t2.state;
        return t2.value;
      };
    };
  };
  var write = function(val) {
    return function(ref2) {
      return function() {
        ref2.value = val;
      };
    };
  };

  // output/Effect.Ref/index.js
  var $$void2 = /* @__PURE__ */ $$void(functorEffect);
  var $$new = _new;
  var modify$prime = modifyImpl;
  var modify = function(f) {
    return modify$prime(function(s3) {
      var s$prime = f(s3);
      return {
        state: s$prime,
        value: s$prime
      };
    });
  };
  var modify_2 = function(f) {
    return function(s3) {
      return $$void2(modify(f)(s3));
    };
  };

  // output/Control.Monad.Rec.Class/index.js
  var bindFlipped2 = /* @__PURE__ */ bindFlipped(bindEffect);
  var map4 = /* @__PURE__ */ map(functorEffect);
  var Loop = /* @__PURE__ */ (function() {
    function Loop2(value0) {
      this.value0 = value0;
    }
    ;
    Loop2.create = function(value0) {
      return new Loop2(value0);
    };
    return Loop2;
  })();
  var Done = /* @__PURE__ */ (function() {
    function Done2(value0) {
      this.value0 = value0;
    }
    ;
    Done2.create = function(value0) {
      return new Done2(value0);
    };
    return Done2;
  })();
  var tailRecM = function(dict) {
    return dict.tailRecM;
  };
  var monadRecEffect = {
    tailRecM: function(f) {
      return function(a3) {
        var fromDone = function(v2) {
          if (v2 instanceof Done) {
            return v2.value0;
          }
          ;
          throw new Error("Failed pattern match at Control.Monad.Rec.Class (line 137, column 30 - line 137, column 44): " + [v2.constructor.name]);
        };
        return function __do7() {
          var r29 = bindFlipped2($$new)(f(a3))();
          (function() {
            while (!(function __do8() {
              var v2 = read(r29)();
              if (v2 instanceof Loop) {
                var e = f(v2.value0)();
                write(e)(r29)();
                return false;
              }
              ;
              if (v2 instanceof Done) {
                return true;
              }
              ;
              throw new Error("Failed pattern match at Control.Monad.Rec.Class (line 128, column 22 - line 133, column 28): " + [v2.constructor.name]);
            })()) {
            }
            ;
            return {};
          })();
          return map4(fromDone)(read(r29))();
        };
      };
    },
    Monad0: function() {
      return monadEffect;
    }
  };
  var forever = function(dictMonadRec) {
    var tailRecM1 = tailRecM(dictMonadRec);
    var voidRight4 = voidRight(dictMonadRec.Monad0().Bind1().Apply0().Functor0());
    return function(ma) {
      return tailRecM1(function(u2) {
        return voidRight4(new Loop(u2))(ma);
      })(unit);
    };
  };

  // output/Data.Foldable/foreign.js
  var foldrArray = function(f) {
    return function(init4) {
      return function(xs) {
        var acc = init4;
        var len = xs.length;
        for (var i2 = len - 1; i2 >= 0; i2--) {
          acc = f(xs[i2])(acc);
        }
        return acc;
      };
    };
  };
  var foldlArray = function(f) {
    return function(init4) {
      return function(xs) {
        var acc = init4;
        var len = xs.length;
        for (var i2 = 0; i2 < len; i2++) {
          acc = f(acc)(xs[i2]);
        }
        return acc;
      };
    };
  };

  // output/Control.Plus/index.js
  var empty = function(dict) {
    return dict.empty;
  };

  // output/Data.Bifunctor/index.js
  var bimap = function(dict) {
    return dict.bimap;
  };

  // output/Data.Monoid.Disj/index.js
  var Disj = function(x32) {
    return x32;
  };
  var semigroupDisj = function(dictHeytingAlgebra) {
    var disj2 = disj(dictHeytingAlgebra);
    return {
      append: function(v2) {
        return function(v1) {
          return disj2(v2)(v1);
        };
      }
    };
  };
  var monoidDisj = function(dictHeytingAlgebra) {
    var semigroupDisj1 = semigroupDisj(dictHeytingAlgebra);
    return {
      mempty: ff(dictHeytingAlgebra),
      Semigroup0: function() {
        return semigroupDisj1;
      }
    };
  };

  // output/Unsafe.Coerce/foreign.js
  var unsafeCoerce2 = function(x32) {
    return x32;
  };

  // output/Safe.Coerce/index.js
  var coerce = function() {
    return unsafeCoerce2;
  };

  // output/Data.Newtype/index.js
  var coerce2 = /* @__PURE__ */ coerce();
  var unwrap = function() {
    return coerce2;
  };
  var alaF = function() {
    return function() {
      return function() {
        return function() {
          return function(v2) {
            return coerce2;
          };
        };
      };
    };
  };

  // output/Data.Foldable/index.js
  var eq12 = /* @__PURE__ */ eq(eqOrdering);
  var alaF2 = /* @__PURE__ */ alaF()()()();
  var foldr = function(dict) {
    return dict.foldr;
  };
  var traverse_ = function(dictApplicative) {
    var applySecond3 = applySecond(dictApplicative.Apply0());
    var pure107 = pure(dictApplicative);
    return function(dictFoldable) {
      var foldr22 = foldr(dictFoldable);
      return function(f) {
        return foldr22(function($454) {
          return applySecond3(f($454));
        })(pure107(unit));
      };
    };
  };
  var for_ = function(dictApplicative) {
    var traverse_14 = traverse_(dictApplicative);
    return function(dictFoldable) {
      return flip(traverse_14(dictFoldable));
    };
  };
  var foldl = function(dict) {
    return dict.foldl;
  };
  var indexl = function(dictFoldable) {
    var foldl22 = foldl(dictFoldable);
    return function(idx) {
      var go2 = function(cursor) {
        return function(a3) {
          if (cursor.elem instanceof Just) {
            return cursor;
          }
          ;
          var $296 = cursor.pos === idx;
          if ($296) {
            return {
              elem: new Just(a3),
              pos: cursor.pos
            };
          }
          ;
          return {
            pos: cursor.pos + 1 | 0,
            elem: cursor.elem
          };
        };
      };
      var $455 = foldl22(go2)({
        elem: Nothing.value,
        pos: 0
      });
      return function($456) {
        return (function(v2) {
          return v2.elem;
        })($455($456));
      };
    };
  };
  var intercalate = function(dictFoldable) {
    var foldl22 = foldl(dictFoldable);
    return function(dictMonoid) {
      var append42 = append(dictMonoid.Semigroup0());
      var mempty3 = mempty(dictMonoid);
      return function(sep) {
        return function(xs) {
          var go2 = function(v2) {
            return function(v1) {
              if (v2.init) {
                return {
                  init: false,
                  acc: v1
                };
              }
              ;
              return {
                init: false,
                acc: append42(v2.acc)(append42(sep)(v1))
              };
            };
          };
          return foldl22(go2)({
            init: true,
            acc: mempty3
          })(xs).acc;
        };
      };
    };
  };
  var maximumBy = function(dictFoldable) {
    var foldl22 = foldl(dictFoldable);
    return function(cmp) {
      var max$prime = function(v2) {
        return function(v1) {
          if (v2 instanceof Nothing) {
            return new Just(v1);
          }
          ;
          if (v2 instanceof Just) {
            return new Just((function() {
              var $303 = eq12(cmp(v2.value0)(v1))(GT.value);
              if ($303) {
                return v2.value0;
              }
              ;
              return v1;
            })());
          }
          ;
          throw new Error("Failed pattern match at Data.Foldable (line 441, column 3 - line 441, column 27): " + [v2.constructor.name, v1.constructor.name]);
        };
      };
      return foldl22(max$prime)(Nothing.value);
    };
  };
  var maximum = function(dictOrd) {
    var compare24 = compare(dictOrd);
    return function(dictFoldable) {
      return maximumBy(dictFoldable)(compare24);
    };
  };
  var minimumBy = function(dictFoldable) {
    var foldl22 = foldl(dictFoldable);
    return function(cmp) {
      var min$prime = function(v2) {
        return function(v1) {
          if (v2 instanceof Nothing) {
            return new Just(v1);
          }
          ;
          if (v2 instanceof Just) {
            return new Just((function() {
              var $307 = eq12(cmp(v2.value0)(v1))(LT.value);
              if ($307) {
                return v2.value0;
              }
              ;
              return v1;
            })());
          }
          ;
          throw new Error("Failed pattern match at Data.Foldable (line 454, column 3 - line 454, column 27): " + [v2.constructor.name, v1.constructor.name]);
        };
      };
      return foldl22(min$prime)(Nothing.value);
    };
  };
  var minimum = function(dictOrd) {
    var compare24 = compare(dictOrd);
    return function(dictFoldable) {
      return minimumBy(dictFoldable)(compare24);
    };
  };
  var sum = function(dictFoldable) {
    var foldl22 = foldl(dictFoldable);
    return function(dictSemiring) {
      return foldl22(add(dictSemiring))(zero(dictSemiring));
    };
  };
  var foldableMaybe = {
    foldr: function(v2) {
      return function(v1) {
        return function(v22) {
          if (v22 instanceof Nothing) {
            return v1;
          }
          ;
          if (v22 instanceof Just) {
            return v2(v22.value0)(v1);
          }
          ;
          throw new Error("Failed pattern match at Data.Foldable (line 138, column 1 - line 144, column 27): " + [v2.constructor.name, v1.constructor.name, v22.constructor.name]);
        };
      };
    },
    foldl: function(v2) {
      return function(v1) {
        return function(v22) {
          if (v22 instanceof Nothing) {
            return v1;
          }
          ;
          if (v22 instanceof Just) {
            return v2(v1)(v22.value0);
          }
          ;
          throw new Error("Failed pattern match at Data.Foldable (line 138, column 1 - line 144, column 27): " + [v2.constructor.name, v1.constructor.name, v22.constructor.name]);
        };
      };
    },
    foldMap: function(dictMonoid) {
      var mempty3 = mempty(dictMonoid);
      return function(v2) {
        return function(v1) {
          if (v1 instanceof Nothing) {
            return mempty3;
          }
          ;
          if (v1 instanceof Just) {
            return v2(v1.value0);
          }
          ;
          throw new Error("Failed pattern match at Data.Foldable (line 138, column 1 - line 144, column 27): " + [v2.constructor.name, v1.constructor.name]);
        };
      };
    }
  };
  var foldableEither = {
    foldr: function(v2) {
      return function(v1) {
        return function(v22) {
          if (v22 instanceof Left) {
            return v1;
          }
          ;
          if (v22 instanceof Right) {
            return v2(v22.value0)(v1);
          }
          ;
          throw new Error("Failed pattern match at Data.Foldable (line 181, column 1 - line 187, column 28): " + [v2.constructor.name, v1.constructor.name, v22.constructor.name]);
        };
      };
    },
    foldl: function(v2) {
      return function(v1) {
        return function(v22) {
          if (v22 instanceof Left) {
            return v1;
          }
          ;
          if (v22 instanceof Right) {
            return v2(v1)(v22.value0);
          }
          ;
          throw new Error("Failed pattern match at Data.Foldable (line 181, column 1 - line 187, column 28): " + [v2.constructor.name, v1.constructor.name, v22.constructor.name]);
        };
      };
    },
    foldMap: function(dictMonoid) {
      var mempty3 = mempty(dictMonoid);
      return function(v2) {
        return function(v1) {
          if (v1 instanceof Left) {
            return mempty3;
          }
          ;
          if (v1 instanceof Right) {
            return v2(v1.value0);
          }
          ;
          throw new Error("Failed pattern match at Data.Foldable (line 181, column 1 - line 187, column 28): " + [v2.constructor.name, v1.constructor.name]);
        };
      };
    }
  };
  var foldMapDefaultR = function(dictFoldable) {
    var foldr22 = foldr(dictFoldable);
    return function(dictMonoid) {
      var append42 = append(dictMonoid.Semigroup0());
      var mempty3 = mempty(dictMonoid);
      return function(f) {
        return foldr22(function(x32) {
          return function(acc) {
            return append42(f(x32))(acc);
          };
        })(mempty3);
      };
    };
  };
  var foldableArray = {
    foldr: foldrArray,
    foldl: foldlArray,
    foldMap: function(dictMonoid) {
      return foldMapDefaultR(foldableArray)(dictMonoid);
    }
  };
  var foldMap = function(dict) {
    return dict.foldMap;
  };
  var any = function(dictFoldable) {
    var foldMap22 = foldMap(dictFoldable);
    return function(dictHeytingAlgebra) {
      return alaF2(Disj)(foldMap22(monoidDisj(dictHeytingAlgebra)));
    };
  };

  // output/Data.FunctorWithIndex/foreign.js
  var mapWithIndexArray = function(f) {
    return function(xs) {
      var l2 = xs.length;
      var result = Array(l2);
      for (var i2 = 0; i2 < l2; i2++) {
        result[i2] = f(i2)(xs[i2]);
      }
      return result;
    };
  };

  // output/Data.FunctorWithIndex/index.js
  var mapWithIndex = function(dict) {
    return dict.mapWithIndex;
  };
  var functorWithIndexArray = {
    mapWithIndex: mapWithIndexArray,
    Functor0: function() {
      return functorArray;
    }
  };

  // output/Data.FoldableWithIndex/index.js
  var foldr8 = /* @__PURE__ */ foldr(foldableArray);
  var mapWithIndex2 = /* @__PURE__ */ mapWithIndex(functorWithIndexArray);
  var foldl8 = /* @__PURE__ */ foldl(foldableArray);
  var foldrWithIndex = function(dict) {
    return dict.foldrWithIndex;
  };
  var traverseWithIndex_ = function(dictApplicative) {
    var applySecond3 = applySecond(dictApplicative.Apply0());
    var pure107 = pure(dictApplicative);
    return function(dictFoldableWithIndex) {
      var foldrWithIndex1 = foldrWithIndex(dictFoldableWithIndex);
      return function(f) {
        return foldrWithIndex1(function(i2) {
          var $289 = f(i2);
          return function($290) {
            return applySecond3($289($290));
          };
        })(pure107(unit));
      };
    };
  };
  var foldlWithIndex = function(dict) {
    return dict.foldlWithIndex;
  };
  var foldMapWithIndexDefaultR = function(dictFoldableWithIndex) {
    var foldrWithIndex1 = foldrWithIndex(dictFoldableWithIndex);
    return function(dictMonoid) {
      var append42 = append(dictMonoid.Semigroup0());
      var mempty3 = mempty(dictMonoid);
      return function(f) {
        return foldrWithIndex1(function(i2) {
          return function(x32) {
            return function(acc) {
              return append42(f(i2)(x32))(acc);
            };
          };
        })(mempty3);
      };
    };
  };
  var foldableWithIndexArray = {
    foldrWithIndex: function(f) {
      return function(z2) {
        var $291 = foldr8(function(v2) {
          return function(y32) {
            return f(v2.value0)(v2.value1)(y32);
          };
        })(z2);
        var $292 = mapWithIndex2(Tuple.create);
        return function($293) {
          return $291($292($293));
        };
      };
    },
    foldlWithIndex: function(f) {
      return function(z2) {
        var $294 = foldl8(function(y32) {
          return function(v2) {
            return f(v2.value0)(y32)(v2.value1);
          };
        })(z2);
        var $295 = mapWithIndex2(Tuple.create);
        return function($296) {
          return $294($295($296));
        };
      };
    },
    foldMapWithIndex: function(dictMonoid) {
      return foldMapWithIndexDefaultR(foldableWithIndexArray)(dictMonoid);
    },
    Foldable0: function() {
      return foldableArray;
    }
  };

  // output/Data.Traversable/foreign.js
  var traverseArrayImpl = /* @__PURE__ */ (function() {
    function array1(a3) {
      return [a3];
    }
    function array2(a3) {
      return function(b10) {
        return [a3, b10];
      };
    }
    function array3(a3) {
      return function(b10) {
        return function(c2) {
          return [a3, b10, c2];
        };
      };
    }
    function concat22(xs) {
      return function(ys) {
        return xs.concat(ys);
      };
    }
    return function(apply7) {
      return function(map131) {
        return function(pure107) {
          return function(f) {
            return function(array4) {
              function go2(bot, top3) {
                switch (top3 - bot) {
                  case 0:
                    return pure107([]);
                  case 1:
                    return map131(array1)(f(array4[bot]));
                  case 2:
                    return apply7(map131(array2)(f(array4[bot])))(f(array4[bot + 1]));
                  case 3:
                    return apply7(apply7(map131(array3)(f(array4[bot])))(f(array4[bot + 1])))(f(array4[bot + 2]));
                  default:
                    var pivot = bot + Math.floor((top3 - bot) / 4) * 2;
                    return apply7(map131(concat22)(go2(bot, pivot)))(go2(pivot, top3));
                }
              }
              return go2(0, array4.length);
            };
          };
        };
      };
    };
  })();

  // output/Data.Traversable.Accum.Internal/index.js
  var stateL = function(v2) {
    return v2;
  };
  var functorStateL = {
    map: function(f) {
      return function(k) {
        return function(s3) {
          var v2 = stateL(k)(s3);
          return {
            accum: v2.accum,
            value: f(v2.value)
          };
        };
      };
    }
  };
  var applyStateL = {
    apply: function(f) {
      return function(x32) {
        return function(s3) {
          var v2 = stateL(f)(s3);
          var v1 = stateL(x32)(v2.accum);
          return {
            accum: v1.accum,
            value: v2.value(v1.value)
          };
        };
      };
    },
    Functor0: function() {
      return functorStateL;
    }
  };
  var applicativeStateL = {
    pure: function(a3) {
      return function(s3) {
        return {
          accum: s3,
          value: a3
        };
      };
    },
    Apply0: function() {
      return applyStateL;
    }
  };

  // output/Data.Traversable/index.js
  var identity5 = /* @__PURE__ */ identity(categoryFn);
  var traverse = function(dict) {
    return dict.traverse;
  };
  var sequenceDefault = function(dictTraversable) {
    var traverse22 = traverse(dictTraversable);
    return function(dictApplicative) {
      return traverse22(dictApplicative)(identity5);
    };
  };
  var traversableArray = {
    traverse: function(dictApplicative) {
      var Apply0 = dictApplicative.Apply0();
      return traverseArrayImpl(apply(Apply0))(map(Apply0.Functor0()))(pure(dictApplicative));
    },
    sequence: function(dictApplicative) {
      return sequenceDefault(traversableArray)(dictApplicative);
    },
    Functor0: function() {
      return functorArray;
    },
    Foldable1: function() {
      return foldableArray;
    }
  };
  var sequence = function(dict) {
    return dict.sequence;
  };
  var mapAccumL = function(dictTraversable) {
    var traverse22 = traverse(dictTraversable)(applicativeStateL);
    return function(f) {
      return function(s0) {
        return function(xs) {
          return stateL(traverse22(function(a3) {
            return function(s3) {
              return f(s3)(a3);
            };
          })(xs))(s0);
        };
      };
    };
  };
  var scanl = function(dictTraversable) {
    var mapAccumL1 = mapAccumL(dictTraversable);
    return function(f) {
      return function(b02) {
        return function(xs) {
          return mapAccumL1(function(b10) {
            return function(a3) {
              var b$prime = f(b10)(a3);
              return {
                accum: b$prime,
                value: b$prime
              };
            };
          })(b02)(xs).value;
        };
      };
    };
  };

  // output/Data.TraversableWithIndex/index.js
  var traverseWithIndexDefault = function(dictTraversableWithIndex) {
    var sequence2 = sequence(dictTraversableWithIndex.Traversable2());
    var mapWithIndex4 = mapWithIndex(dictTraversableWithIndex.FunctorWithIndex0());
    return function(dictApplicative) {
      var sequence12 = sequence2(dictApplicative);
      return function(f) {
        var $174 = mapWithIndex4(f);
        return function($175) {
          return sequence12($174($175));
        };
      };
    };
  };
  var traverseWithIndex = function(dict) {
    return dict.traverseWithIndex;
  };
  var traversableWithIndexArray = {
    traverseWithIndex: function(dictApplicative) {
      return traverseWithIndexDefault(traversableWithIndexArray)(dictApplicative);
    },
    FunctorWithIndex0: function() {
      return functorWithIndexArray;
    },
    FoldableWithIndex1: function() {
      return foldableWithIndexArray;
    },
    Traversable2: function() {
      return traversableArray;
    }
  };

  // output/Data.Unfoldable/foreign.js
  var unfoldrArrayImpl = function(isNothing2) {
    return function(fromJust7) {
      return function(fst2) {
        return function(snd2) {
          return function(f) {
            return function(b10) {
              var result = [];
              var value20 = b10;
              while (true) {
                var maybe2 = f(value20);
                if (isNothing2(maybe2)) return result;
                var tuple = fromJust7(maybe2);
                result.push(fst2(tuple));
                value20 = snd2(tuple);
              }
            };
          };
        };
      };
    };
  };

  // output/Data.Unfoldable1/foreign.js
  var unfoldr1ArrayImpl = function(isNothing2) {
    return function(fromJust7) {
      return function(fst2) {
        return function(snd2) {
          return function(f) {
            return function(b10) {
              var result = [];
              var value20 = b10;
              while (true) {
                var tuple = f(value20);
                result.push(fst2(tuple));
                var maybe2 = snd2(tuple);
                if (isNothing2(maybe2)) return result;
                value20 = fromJust7(maybe2);
              }
            };
          };
        };
      };
    };
  };

  // output/Data.Unfoldable1/index.js
  var fromJust2 = /* @__PURE__ */ fromJust();
  var unfoldable1Array = {
    unfoldr1: /* @__PURE__ */ unfoldr1ArrayImpl(isNothing)(fromJust2)(fst)(snd)
  };

  // output/Data.Unfoldable/index.js
  var fromJust3 = /* @__PURE__ */ fromJust();
  var unfoldr = function(dict) {
    return dict.unfoldr;
  };
  var unfoldableArray = {
    unfoldr: /* @__PURE__ */ unfoldrArrayImpl(isNothing)(fromJust3)(fst)(snd),
    Unfoldable10: function() {
      return unfoldable1Array;
    }
  };

  // output/Data.NonEmpty/index.js
  var NonEmpty = /* @__PURE__ */ (function() {
    function NonEmpty2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    NonEmpty2.create = function(value0) {
      return function(value1) {
        return new NonEmpty2(value0, value1);
      };
    };
    return NonEmpty2;
  })();
  var singleton2 = function(dictPlus) {
    var empty10 = empty(dictPlus);
    return function(a3) {
      return new NonEmpty(a3, empty10);
    };
  };

  // output/Data.List.Types/index.js
  var identity6 = /* @__PURE__ */ identity(categoryFn);
  var Nil = /* @__PURE__ */ (function() {
    function Nil2() {
    }
    ;
    Nil2.value = new Nil2();
    return Nil2;
  })();
  var Cons = /* @__PURE__ */ (function() {
    function Cons2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    Cons2.create = function(value0) {
      return function(value1) {
        return new Cons2(value0, value1);
      };
    };
    return Cons2;
  })();
  var NonEmptyList = function(x32) {
    return x32;
  };
  var toList = function(v2) {
    return new Cons(v2.value0, v2.value1);
  };
  var listMap = function(f) {
    var chunkedRevMap = function($copy_v) {
      return function($copy_v1) {
        var $tco_var_v = $copy_v;
        var $tco_done = false;
        var $tco_result;
        function $tco_loop(v2, v1) {
          if (v1 instanceof Cons && (v1.value1 instanceof Cons && v1.value1.value1 instanceof Cons)) {
            $tco_var_v = new Cons(v1, v2);
            $copy_v1 = v1.value1.value1.value1;
            return;
          }
          ;
          var unrolledMap = function(v22) {
            if (v22 instanceof Cons && (v22.value1 instanceof Cons && v22.value1.value1 instanceof Nil)) {
              return new Cons(f(v22.value0), new Cons(f(v22.value1.value0), Nil.value));
            }
            ;
            if (v22 instanceof Cons && v22.value1 instanceof Nil) {
              return new Cons(f(v22.value0), Nil.value);
            }
            ;
            return Nil.value;
          };
          var reverseUnrolledMap = function($copy_v2) {
            return function($copy_v3) {
              var $tco_var_v2 = $copy_v2;
              var $tco_done1 = false;
              var $tco_result2;
              function $tco_loop2(v22, v3) {
                if (v22 instanceof Cons && (v22.value0 instanceof Cons && (v22.value0.value1 instanceof Cons && v22.value0.value1.value1 instanceof Cons))) {
                  $tco_var_v2 = v22.value1;
                  $copy_v3 = new Cons(f(v22.value0.value0), new Cons(f(v22.value0.value1.value0), new Cons(f(v22.value0.value1.value1.value0), v3)));
                  return;
                }
                ;
                $tco_done1 = true;
                return v3;
              }
              ;
              while (!$tco_done1) {
                $tco_result2 = $tco_loop2($tco_var_v2, $copy_v3);
              }
              ;
              return $tco_result2;
            };
          };
          $tco_done = true;
          return reverseUnrolledMap(v2)(unrolledMap(v1));
        }
        ;
        while (!$tco_done) {
          $tco_result = $tco_loop($tco_var_v, $copy_v1);
        }
        ;
        return $tco_result;
      };
    };
    return chunkedRevMap(Nil.value);
  };
  var functorList = {
    map: listMap
  };
  var map5 = /* @__PURE__ */ map(functorList);
  var foldableList = {
    foldr: function(f) {
      return function(b10) {
        var rev3 = (function() {
          var go2 = function($copy_v) {
            return function($copy_v1) {
              var $tco_var_v = $copy_v;
              var $tco_done = false;
              var $tco_result;
              function $tco_loop(v2, v1) {
                if (v1 instanceof Nil) {
                  $tco_done = true;
                  return v2;
                }
                ;
                if (v1 instanceof Cons) {
                  $tco_var_v = new Cons(v1.value0, v2);
                  $copy_v1 = v1.value1;
                  return;
                }
                ;
                throw new Error("Failed pattern match at Data.List.Types (line 107, column 7 - line 107, column 23): " + [v2.constructor.name, v1.constructor.name]);
              }
              ;
              while (!$tco_done) {
                $tco_result = $tco_loop($tco_var_v, $copy_v1);
              }
              ;
              return $tco_result;
            };
          };
          return go2(Nil.value);
        })();
        var $284 = foldl(foldableList)(flip(f))(b10);
        return function($285) {
          return $284(rev3($285));
        };
      };
    },
    foldl: function(f) {
      var go2 = function($copy_b) {
        return function($copy_v) {
          var $tco_var_b = $copy_b;
          var $tco_done1 = false;
          var $tco_result;
          function $tco_loop(b10, v2) {
            if (v2 instanceof Nil) {
              $tco_done1 = true;
              return b10;
            }
            ;
            if (v2 instanceof Cons) {
              $tco_var_b = f(b10)(v2.value0);
              $copy_v = v2.value1;
              return;
            }
            ;
            throw new Error("Failed pattern match at Data.List.Types (line 111, column 12 - line 113, column 30): " + [v2.constructor.name]);
          }
          ;
          while (!$tco_done1) {
            $tco_result = $tco_loop($tco_var_b, $copy_v);
          }
          ;
          return $tco_result;
        };
      };
      return go2;
    },
    foldMap: function(dictMonoid) {
      var append213 = append(dictMonoid.Semigroup0());
      var mempty3 = mempty(dictMonoid);
      return function(f) {
        return foldl(foldableList)(function(acc) {
          var $286 = append213(acc);
          return function($287) {
            return $286(f($287));
          };
        })(mempty3);
      };
    }
  };
  var foldl2 = /* @__PURE__ */ foldl(foldableList);
  var foldr2 = /* @__PURE__ */ foldr(foldableList);
  var semigroupList = {
    append: function(xs) {
      return function(ys) {
        return foldr2(Cons.create)(ys)(xs);
      };
    }
  };
  var append1 = /* @__PURE__ */ append(semigroupList);
  var monoidList = /* @__PURE__ */ (function() {
    return {
      mempty: Nil.value,
      Semigroup0: function() {
        return semigroupList;
      }
    };
  })();
  var semigroupNonEmptyList = {
    append: function(v2) {
      return function(as$prime) {
        return new NonEmpty(v2.value0, append1(v2.value1)(toList(as$prime)));
      };
    }
  };
  var traversableList = {
    traverse: function(dictApplicative) {
      var Apply0 = dictApplicative.Apply0();
      var map131 = map(Apply0.Functor0());
      var lift22 = lift2(Apply0);
      var pure128 = pure(dictApplicative);
      return function(f) {
        var $301 = map131(foldl2(flip(Cons.create))(Nil.value));
        var $302 = foldl2(function(acc) {
          var $304 = lift22(flip(Cons.create))(acc);
          return function($305) {
            return $304(f($305));
          };
        })(pure128(Nil.value));
        return function($303) {
          return $301($302($303));
        };
      };
    },
    sequence: function(dictApplicative) {
      return traverse(traversableList)(dictApplicative)(identity6);
    },
    Functor0: function() {
      return functorList;
    },
    Foldable1: function() {
      return foldableList;
    }
  };
  var applyList = {
    apply: function(v2) {
      return function(v1) {
        if (v2 instanceof Nil) {
          return Nil.value;
        }
        ;
        if (v2 instanceof Cons) {
          return append1(map5(v2.value0)(v1))(apply(applyList)(v2.value1)(v1));
        }
        ;
        throw new Error("Failed pattern match at Data.List.Types (line 157, column 1 - line 159, column 48): " + [v2.constructor.name, v1.constructor.name]);
      };
    },
    Functor0: function() {
      return functorList;
    }
  };
  var bindList = {
    bind: function(v2) {
      return function(v1) {
        if (v2 instanceof Nil) {
          return Nil.value;
        }
        ;
        if (v2 instanceof Cons) {
          return append1(v1(v2.value0))(bind(bindList)(v2.value1)(v1));
        }
        ;
        throw new Error("Failed pattern match at Data.List.Types (line 164, column 1 - line 166, column 37): " + [v2.constructor.name, v1.constructor.name]);
      };
    },
    Apply0: function() {
      return applyList;
    }
  };
  var applicativeList = {
    pure: function(a3) {
      return new Cons(a3, Nil.value);
    },
    Apply0: function() {
      return applyList;
    }
  };
  var altList = {
    alt: append1,
    Functor0: function() {
      return functorList;
    }
  };
  var plusList = /* @__PURE__ */ (function() {
    return {
      empty: Nil.value,
      Alt0: function() {
        return altList;
      }
    };
  })();

  // output/Data.List/index.js
  var map6 = /* @__PURE__ */ map(functorMaybe);
  var foldl3 = /* @__PURE__ */ foldl(foldableList);
  var uncons = function(v2) {
    if (v2 instanceof Nil) {
      return Nothing.value;
    }
    ;
    if (v2 instanceof Cons) {
      return new Just({
        head: v2.value0,
        tail: v2.value1
      });
    }
    ;
    throw new Error("Failed pattern match at Data.List (line 259, column 1 - line 259, column 66): " + [v2.constructor.name]);
  };
  var toUnfoldable = function(dictUnfoldable) {
    return unfoldr(dictUnfoldable)(function(xs) {
      return map6(function(rec) {
        return new Tuple(rec.head, rec.tail);
      })(uncons(xs));
    });
  };
  var singleton3 = function(a3) {
    return new Cons(a3, Nil.value);
  };
  var reverse = /* @__PURE__ */ (function() {
    var go2 = function($copy_v) {
      return function($copy_v1) {
        var $tco_var_v = $copy_v;
        var $tco_done = false;
        var $tco_result;
        function $tco_loop(v2, v1) {
          if (v1 instanceof Nil) {
            $tco_done = true;
            return v2;
          }
          ;
          if (v1 instanceof Cons) {
            $tco_var_v = new Cons(v1.value0, v2);
            $copy_v1 = v1.value1;
            return;
          }
          ;
          throw new Error("Failed pattern match at Data.List (line 368, column 3 - line 368, column 19): " + [v2.constructor.name, v1.constructor.name]);
        }
        ;
        while (!$tco_done) {
          $tco_result = $tco_loop($tco_var_v, $copy_v1);
        }
        ;
        return $tco_result;
      };
    };
    return go2(Nil.value);
  })();
  var unsnoc = function(lst) {
    var go2 = function($copy_v) {
      return function($copy_v1) {
        var $tco_var_v = $copy_v;
        var $tco_done = false;
        var $tco_result;
        function $tco_loop(v2, v1) {
          if (v2 instanceof Nil) {
            $tco_done = true;
            return Nothing.value;
          }
          ;
          if (v2 instanceof Cons && v2.value1 instanceof Nil) {
            $tco_done = true;
            return new Just({
              revInit: v1,
              last: v2.value0
            });
          }
          ;
          if (v2 instanceof Cons) {
            $tco_var_v = v2.value1;
            $copy_v1 = new Cons(v2.value0, v1);
            return;
          }
          ;
          throw new Error("Failed pattern match at Data.List (line 270, column 3 - line 270, column 21): " + [v2.constructor.name, v1.constructor.name]);
        }
        ;
        while (!$tco_done) {
          $tco_result = $tco_loop($tco_var_v, $copy_v1);
        }
        ;
        return $tco_result;
      };
    };
    return map6(function(h7) {
      return {
        init: reverse(h7.revInit),
        last: h7.last
      };
    })(go2(lst)(Nil.value));
  };
  var zipWith = function(f) {
    return function(xs) {
      return function(ys) {
        var go2 = function($copy_v) {
          return function($copy_v1) {
            return function($copy_v2) {
              var $tco_var_v = $copy_v;
              var $tco_var_v1 = $copy_v1;
              var $tco_done = false;
              var $tco_result;
              function $tco_loop(v2, v1, v22) {
                if (v2 instanceof Nil) {
                  $tco_done = true;
                  return v22;
                }
                ;
                if (v1 instanceof Nil) {
                  $tco_done = true;
                  return v22;
                }
                ;
                if (v2 instanceof Cons && v1 instanceof Cons) {
                  $tco_var_v = v2.value1;
                  $tco_var_v1 = v1.value1;
                  $copy_v2 = new Cons(f(v2.value0)(v1.value0), v22);
                  return;
                }
                ;
                throw new Error("Failed pattern match at Data.List (line 779, column 3 - line 779, column 21): " + [v2.constructor.name, v1.constructor.name, v22.constructor.name]);
              }
              ;
              while (!$tco_done) {
                $tco_result = $tco_loop($tco_var_v, $tco_var_v1, $copy_v2);
              }
              ;
              return $tco_result;
            };
          };
        };
        return reverse(go2(xs)(ys)(Nil.value));
      };
    };
  };
  var $$null = function(v2) {
    if (v2 instanceof Nil) {
      return true;
    }
    ;
    return false;
  };
  var length = /* @__PURE__ */ foldl3(function(acc) {
    return function(v2) {
      return acc + 1 | 0;
    };
  })(0);
  var fromFoldable = function(dictFoldable) {
    return foldr(dictFoldable)(Cons.create)(Nil.value);
  };

  // output/Data.CatQueue/index.js
  var CatQueue = /* @__PURE__ */ (function() {
    function CatQueue2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    CatQueue2.create = function(value0) {
      return function(value1) {
        return new CatQueue2(value0, value1);
      };
    };
    return CatQueue2;
  })();
  var uncons2 = function($copy_v) {
    var $tco_done = false;
    var $tco_result;
    function $tco_loop(v2) {
      if (v2.value0 instanceof Nil && v2.value1 instanceof Nil) {
        $tco_done = true;
        return Nothing.value;
      }
      ;
      if (v2.value0 instanceof Nil) {
        $copy_v = new CatQueue(reverse(v2.value1), Nil.value);
        return;
      }
      ;
      if (v2.value0 instanceof Cons) {
        $tco_done = true;
        return new Just(new Tuple(v2.value0.value0, new CatQueue(v2.value0.value1, v2.value1)));
      }
      ;
      throw new Error("Failed pattern match at Data.CatQueue (line 82, column 1 - line 82, column 63): " + [v2.constructor.name]);
    }
    ;
    while (!$tco_done) {
      $tco_result = $tco_loop($copy_v);
    }
    ;
    return $tco_result;
  };
  var snoc = function(v2) {
    return function(a3) {
      return new CatQueue(v2.value0, new Cons(a3, v2.value1));
    };
  };
  var $$null2 = function(v2) {
    if (v2.value0 instanceof Nil && v2.value1 instanceof Nil) {
      return true;
    }
    ;
    return false;
  };
  var empty2 = /* @__PURE__ */ (function() {
    return new CatQueue(Nil.value, Nil.value);
  })();

  // output/Data.CatList/index.js
  var CatNil = /* @__PURE__ */ (function() {
    function CatNil2() {
    }
    ;
    CatNil2.value = new CatNil2();
    return CatNil2;
  })();
  var CatCons = /* @__PURE__ */ (function() {
    function CatCons2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    CatCons2.create = function(value0) {
      return function(value1) {
        return new CatCons2(value0, value1);
      };
    };
    return CatCons2;
  })();
  var link = function(v2) {
    return function(v1) {
      if (v2 instanceof CatNil) {
        return v1;
      }
      ;
      if (v1 instanceof CatNil) {
        return v2;
      }
      ;
      if (v2 instanceof CatCons) {
        return new CatCons(v2.value0, snoc(v2.value1)(v1));
      }
      ;
      throw new Error("Failed pattern match at Data.CatList (line 108, column 1 - line 108, column 54): " + [v2.constructor.name, v1.constructor.name]);
    };
  };
  var foldr3 = function(k) {
    return function(b10) {
      return function(q3) {
        var foldl21 = function($copy_v) {
          return function($copy_v1) {
            return function($copy_v2) {
              var $tco_var_v = $copy_v;
              var $tco_var_v1 = $copy_v1;
              var $tco_done = false;
              var $tco_result;
              function $tco_loop(v2, v1, v22) {
                if (v22 instanceof Nil) {
                  $tco_done = true;
                  return v1;
                }
                ;
                if (v22 instanceof Cons) {
                  $tco_var_v = v2;
                  $tco_var_v1 = v2(v1)(v22.value0);
                  $copy_v2 = v22.value1;
                  return;
                }
                ;
                throw new Error("Failed pattern match at Data.CatList (line 124, column 3 - line 124, column 59): " + [v2.constructor.name, v1.constructor.name, v22.constructor.name]);
              }
              ;
              while (!$tco_done) {
                $tco_result = $tco_loop($tco_var_v, $tco_var_v1, $copy_v2);
              }
              ;
              return $tco_result;
            };
          };
        };
        var go2 = function($copy_xs) {
          return function($copy_ys) {
            var $tco_var_xs = $copy_xs;
            var $tco_done1 = false;
            var $tco_result;
            function $tco_loop(xs, ys) {
              var v2 = uncons2(xs);
              if (v2 instanceof Nothing) {
                $tco_done1 = true;
                return foldl21(function(x32) {
                  return function(i2) {
                    return i2(x32);
                  };
                })(b10)(ys);
              }
              ;
              if (v2 instanceof Just) {
                $tco_var_xs = v2.value0.value1;
                $copy_ys = new Cons(k(v2.value0.value0), ys);
                return;
              }
              ;
              throw new Error("Failed pattern match at Data.CatList (line 120, column 14 - line 122, column 67): " + [v2.constructor.name]);
            }
            ;
            while (!$tco_done1) {
              $tco_result = $tco_loop($tco_var_xs, $copy_ys);
            }
            ;
            return $tco_result;
          };
        };
        return go2(q3)(Nil.value);
      };
    };
  };
  var uncons3 = function(v2) {
    if (v2 instanceof CatNil) {
      return Nothing.value;
    }
    ;
    if (v2 instanceof CatCons) {
      return new Just(new Tuple(v2.value0, (function() {
        var $66 = $$null2(v2.value1);
        if ($66) {
          return CatNil.value;
        }
        ;
        return foldr3(link)(CatNil.value)(v2.value1);
      })()));
    }
    ;
    throw new Error("Failed pattern match at Data.CatList (line 99, column 1 - line 99, column 61): " + [v2.constructor.name]);
  };
  var empty3 = /* @__PURE__ */ (function() {
    return CatNil.value;
  })();
  var append2 = link;
  var cons = function(a3) {
    return function(cat) {
      return append2(new CatCons(a3, empty2))(cat);
    };
  };
  var singleton4 = function(a3) {
    return cons(a3)(CatNil.value);
  };
  var semigroupCatList = {
    append: append2
  };
  var monoidCatList = /* @__PURE__ */ (function() {
    return {
      mempty: CatNil.value,
      Semigroup0: function() {
        return semigroupCatList;
      }
    };
  })();
  var fromFoldable2 = function(dictFoldable) {
    var foldMap12 = foldMap(dictFoldable)(monoidCatList);
    return function(f) {
      return foldMap12(singleton4)(f);
    };
  };
  var snoc2 = function(cat) {
    return function(a3) {
      return append2(cat)(new CatCons(a3, empty2));
    };
  };

  // output/Control.Monad.Free/index.js
  var $runtime_lazy2 = function(name16, moduleName, init4) {
    var state3 = 0;
    var val;
    return function(lineNumber) {
      if (state3 === 2) return val;
      if (state3 === 1) throw new ReferenceError(name16 + " was needed before it finished initializing (module " + moduleName + ", line " + lineNumber + ")", moduleName, lineNumber);
      state3 = 1;
      val = init4();
      state3 = 2;
      return val;
    };
  };
  var append3 = /* @__PURE__ */ append(semigroupCatList);
  var Free = /* @__PURE__ */ (function() {
    function Free2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    Free2.create = function(value0) {
      return function(value1) {
        return new Free2(value0, value1);
      };
    };
    return Free2;
  })();
  var Return = /* @__PURE__ */ (function() {
    function Return2(value0) {
      this.value0 = value0;
    }
    ;
    Return2.create = function(value0) {
      return new Return2(value0);
    };
    return Return2;
  })();
  var Bind = /* @__PURE__ */ (function() {
    function Bind2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    Bind2.create = function(value0) {
      return function(value1) {
        return new Bind2(value0, value1);
      };
    };
    return Bind2;
  })();
  var toView = function($copy_v) {
    var $tco_done = false;
    var $tco_result;
    function $tco_loop(v2) {
      var runExpF = function(v23) {
        return v23;
      };
      var concatF = function(v23) {
        return function(r29) {
          return new Free(v23.value0, append3(v23.value1)(r29));
        };
      };
      if (v2.value0 instanceof Return) {
        var v22 = uncons3(v2.value1);
        if (v22 instanceof Nothing) {
          $tco_done = true;
          return new Return(v2.value0.value0);
        }
        ;
        if (v22 instanceof Just) {
          $copy_v = concatF(runExpF(v22.value0.value0)(v2.value0.value0))(v22.value0.value1);
          return;
        }
        ;
        throw new Error("Failed pattern match at Control.Monad.Free (line 227, column 7 - line 231, column 64): " + [v22.constructor.name]);
      }
      ;
      if (v2.value0 instanceof Bind) {
        $tco_done = true;
        return new Bind(v2.value0.value0, function(a3) {
          return concatF(v2.value0.value1(a3))(v2.value1);
        });
      }
      ;
      throw new Error("Failed pattern match at Control.Monad.Free (line 225, column 3 - line 233, column 56): " + [v2.value0.constructor.name]);
    }
    ;
    while (!$tco_done) {
      $tco_result = $tco_loop($copy_v);
    }
    ;
    return $tco_result;
  };
  var fromView = function(f) {
    return new Free(f, empty3);
  };
  var freeMonad = {
    Applicative0: function() {
      return freeApplicative;
    },
    Bind1: function() {
      return freeBind;
    }
  };
  var freeFunctor = {
    map: function(k) {
      return function(f) {
        return bindFlipped(freeBind)((function() {
          var $189 = pure(freeApplicative);
          return function($190) {
            return $189(k($190));
          };
        })())(f);
      };
    }
  };
  var freeBind = {
    bind: function(v2) {
      return function(k) {
        return new Free(v2.value0, snoc2(v2.value1)(k));
      };
    },
    Apply0: function() {
      return $lazy_freeApply(0);
    }
  };
  var freeApplicative = {
    pure: function($191) {
      return fromView(Return.create($191));
    },
    Apply0: function() {
      return $lazy_freeApply(0);
    }
  };
  var $lazy_freeApply = /* @__PURE__ */ $runtime_lazy2("freeApply", "Control.Monad.Free", function() {
    return {
      apply: ap(freeMonad),
      Functor0: function() {
        return freeFunctor;
      }
    };
  });
  var pure2 = /* @__PURE__ */ pure(freeApplicative);
  var liftF = function(f) {
    return fromView(new Bind(f, function($192) {
      return pure2($192);
    }));
  };
  var foldFree = function(dictMonadRec) {
    var Monad0 = dictMonadRec.Monad0();
    var map131 = map(Monad0.Bind1().Apply0().Functor0());
    var pure128 = pure(Monad0.Applicative0());
    var tailRecM4 = tailRecM(dictMonadRec);
    return function(k) {
      var go2 = function(f) {
        var v2 = toView(f);
        if (v2 instanceof Return) {
          return map131(Done.create)(pure128(v2.value0));
        }
        ;
        if (v2 instanceof Bind) {
          return map131(function($199) {
            return Loop.create(v2.value1($199));
          })(k(v2.value0));
        }
        ;
        throw new Error("Failed pattern match at Control.Monad.Free (line 158, column 10 - line 160, column 37): " + [v2.constructor.name]);
      };
      return tailRecM4(go2);
    };
  };

  // output/Effect.Exception/foreign.js
  function error(msg) {
    return new Error(msg);
  }
  function message(e) {
    return e.message;
  }
  function throwException(e) {
    return function() {
      throw e;
    };
  }

  // output/Effect.Exception/index.js
  var $$throw = function($4) {
    return throwException(error($4));
  };

  // output/Control.Monad.Error.Class/index.js
  var throwError = function(dict) {
    return dict.throwError;
  };
  var catchError = function(dict) {
    return dict.catchError;
  };
  var $$try = function(dictMonadError) {
    var catchError1 = catchError(dictMonadError);
    var Monad0 = dictMonadError.MonadThrow0().Monad0();
    var map131 = map(Monad0.Bind1().Apply0().Functor0());
    var pure107 = pure(Monad0.Applicative0());
    return function(a3) {
      return catchError1(map131(Right.create)(a3))(function($52) {
        return pure107(Left.create($52));
      });
    };
  };

  // output/Control.Monad.ST.Internal/foreign.js
  var map_ = function(f) {
    return function(a3) {
      return function() {
        return f(a3());
      };
    };
  };
  var pure_ = function(a3) {
    return function() {
      return a3;
    };
  };
  var bind_ = function(a3) {
    return function(f) {
      return function() {
        return f(a3())();
      };
    };
  };
  var foreach = function(as) {
    return function(f) {
      return function() {
        for (var i2 = 0, l2 = as.length; i2 < l2; i2++) {
          f(as[i2])();
        }
      };
    };
  };
  function newSTRef(val) {
    return function() {
      return { value: val };
    };
  }
  var read2 = function(ref2) {
    return function() {
      return ref2.value;
    };
  };
  var modifyImpl2 = function(f) {
    return function(ref2) {
      return function() {
        var t2 = f(ref2.value);
        ref2.value = t2.state;
        return t2.value;
      };
    };
  };
  var write2 = function(a3) {
    return function(ref2) {
      return function() {
        return ref2.value = a3;
      };
    };
  };

  // output/Control.Monad.ST.Internal/index.js
  var $runtime_lazy3 = function(name16, moduleName, init4) {
    var state3 = 0;
    var val;
    return function(lineNumber) {
      if (state3 === 2) return val;
      if (state3 === 1) throw new ReferenceError(name16 + " was needed before it finished initializing (module " + moduleName + ", line " + lineNumber + ")", moduleName, lineNumber);
      state3 = 1;
      val = init4();
      state3 = 2;
      return val;
    };
  };
  var modify$prime2 = modifyImpl2;
  var modify2 = function(f) {
    return modify$prime2(function(s3) {
      var s$prime = f(s3);
      return {
        state: s$prime,
        value: s$prime
      };
    });
  };
  var functorST = {
    map: map_
  };
  var monadST = {
    Applicative0: function() {
      return applicativeST;
    },
    Bind1: function() {
      return bindST;
    }
  };
  var bindST = {
    bind: bind_,
    Apply0: function() {
      return $lazy_applyST(0);
    }
  };
  var applicativeST = {
    pure: pure_,
    Apply0: function() {
      return $lazy_applyST(0);
    }
  };
  var $lazy_applyST = /* @__PURE__ */ $runtime_lazy3("applyST", "Control.Monad.ST.Internal", function() {
    return {
      apply: ap(monadST),
      Functor0: function() {
        return functorST;
      }
    };
  });

  // output/Control.Monad.Writer.Class/index.js
  var tell = function(dict) {
    return dict.tell;
  };

  // output/Effect.Class/index.js
  var monadEffectEffect = {
    liftEffect: /* @__PURE__ */ identity(categoryFn),
    Monad0: function() {
      return monadEffect;
    }
  };
  var liftEffect = function(dict) {
    return dict.liftEffect;
  };

  // output/Control.Monad.State.Trans/index.js
  var runStateT = function(v2) {
    return v2;
  };
  var functorStateT = function(dictFunctor) {
    var map131 = map(dictFunctor);
    return {
      map: function(f) {
        return function(v2) {
          return function(s3) {
            return map131(function(v1) {
              return new Tuple(f(v1.value0), v1.value1);
            })(v2(s3));
          };
        };
      }
    };
  };
  var monadStateT = function(dictMonad) {
    return {
      Applicative0: function() {
        return applicativeStateT(dictMonad);
      },
      Bind1: function() {
        return bindStateT(dictMonad);
      }
    };
  };
  var bindStateT = function(dictMonad) {
    var bind100 = bind(dictMonad.Bind1());
    return {
      bind: function(v2) {
        return function(f) {
          return function(s3) {
            return bind100(v2(s3))(function(v1) {
              var v3 = f(v1.value0);
              return v3(v1.value1);
            });
          };
        };
      },
      Apply0: function() {
        return applyStateT(dictMonad);
      }
    };
  };
  var applyStateT = function(dictMonad) {
    var functorStateT1 = functorStateT(dictMonad.Bind1().Apply0().Functor0());
    return {
      apply: ap(monadStateT(dictMonad)),
      Functor0: function() {
        return functorStateT1;
      }
    };
  };
  var applicativeStateT = function(dictMonad) {
    var pure107 = pure(dictMonad.Applicative0());
    return {
      pure: function(a3) {
        return function(s3) {
          return pure107(new Tuple(a3, s3));
        };
      },
      Apply0: function() {
        return applyStateT(dictMonad);
      }
    };
  };
  var monadStateStateT = function(dictMonad) {
    var pure107 = pure(dictMonad.Applicative0());
    var monadStateT1 = monadStateT(dictMonad);
    return {
      state: function(f) {
        return function($206) {
          return pure107(f($206));
        };
      },
      Monad0: function() {
        return monadStateT1;
      }
    };
  };

  // output/Control.Monad.State/index.js
  var execState = function(v2) {
    return function(s3) {
      var v1 = v2(s3);
      return v1.value1;
    };
  };

  // output/Data.Lazy/foreign.js
  var defer2 = function(thunk) {
    var v2 = null;
    return function() {
      if (thunk === void 0) return v2;
      v2 = thunk();
      thunk = void 0;
      return v2;
    };
  };
  var force = function(l2) {
    return l2();
  };

  // output/Data.Lazy/index.js
  var functorLazy = {
    map: function(f) {
      return function(l2) {
        return defer2(function(v2) {
          return f(force(l2));
        });
      };
    }
  };

  // output/Control.Comonad.Cofree/index.js
  var map7 = /* @__PURE__ */ map(functorLazy);
  var tail = function(v2) {
    return snd(force(v2));
  };
  var mkCofree = function(a3) {
    return function(t2) {
      return defer2(function(v2) {
        return new Tuple(a3, t2);
      });
    };
  };
  var head = function(v2) {
    return fst(force(v2));
  };
  var functorCofree = function(dictFunctor) {
    var map212 = map(dictFunctor);
    return {
      map: function(f) {
        var loop2 = function(v2) {
          return map7(function(v1) {
            return new Tuple(f(v1.value0), map212(loop2)(v1.value1));
          })(v2);
        };
        return loop2;
      }
    };
  };
  var foldableCofree = function(dictFoldable) {
    var foldr6 = foldr(dictFoldable);
    var foldl21 = foldl(dictFoldable);
    var foldMap3 = foldMap(dictFoldable);
    return {
      foldr: function(f) {
        var go2 = function(fa) {
          return function(b10) {
            return f(head(fa))(foldr6(go2)(b10)(tail(fa)));
          };
        };
        return flip(go2);
      },
      foldl: function(f) {
        var go2 = function(b10) {
          return function(fa) {
            return foldl21(go2)(f(b10)(head(fa)))(tail(fa));
          };
        };
        return go2;
      },
      foldMap: function(dictMonoid) {
        var append42 = append(dictMonoid.Semigroup0());
        var foldMap12 = foldMap3(dictMonoid);
        return function(f) {
          var go2 = function(fa) {
            return append42(f(head(fa)))(foldMap12(go2)(tail(fa)));
          };
          return go2;
        };
      }
    };
  };

  // output/Data.Array/foreign.js
  var rangeImpl = function(start4, end2) {
    var step5 = start4 > end2 ? -1 : 1;
    var result = new Array(step5 * (end2 - start4) + 1);
    var i2 = start4, n = 0;
    while (i2 !== end2) {
      result[n++] = i2;
      i2 += step5;
    }
    result[n] = i2;
    return result;
  };
  var replicateFill = function(count, value20) {
    if (count < 1) {
      return [];
    }
    var result = new Array(count);
    return result.fill(value20);
  };
  var replicatePolyfill = function(count, value20) {
    var result = [];
    var n = 0;
    for (var i2 = 0; i2 < count; i2++) {
      result[n++] = value20;
    }
    return result;
  };
  var replicateImpl = typeof Array.prototype.fill === "function" ? replicateFill : replicatePolyfill;
  var fromFoldableImpl = /* @__PURE__ */ (function() {
    function Cons2(head6, tail3) {
      this.head = head6;
      this.tail = tail3;
    }
    var emptyList = {};
    function curryCons(head6) {
      return function(tail3) {
        return new Cons2(head6, tail3);
      };
    }
    function listToArray(list) {
      var result = [];
      var count = 0;
      var xs = list;
      while (xs !== emptyList) {
        result[count++] = xs.head;
        xs = xs.tail;
      }
      return result;
    }
    return function(foldr6, xs) {
      return listToArray(foldr6(curryCons)(emptyList)(xs));
    };
  })();
  var length3 = function(xs) {
    return xs.length;
  };
  var unconsImpl = function(empty10, next2, xs) {
    return xs.length === 0 ? empty10({}) : next2(xs[0])(xs.slice(1));
  };
  var indexImpl = function(just, nothing, xs, i2) {
    return i2 < 0 || i2 >= xs.length ? nothing : just(xs[i2]);
  };
  var findMapImpl = function(nothing, isJust2, f, xs) {
    for (var i2 = 0; i2 < xs.length; i2++) {
      var result = f(xs[i2]);
      if (isJust2(result)) return result;
    }
    return nothing;
  };
  var findIndexImpl = function(just, nothing, f, xs) {
    for (var i2 = 0, l2 = xs.length; i2 < l2; i2++) {
      if (f(xs[i2])) return just(i2);
    }
    return nothing;
  };
  var _insertAt = function(just, nothing, i2, a3, l2) {
    if (i2 < 0 || i2 > l2.length) return nothing;
    var l1 = l2.slice();
    l1.splice(i2, 0, a3);
    return just(l1);
  };
  var _deleteAt = function(just, nothing, i2, l2) {
    if (i2 < 0 || i2 >= l2.length) return nothing;
    var l1 = l2.slice();
    l1.splice(i2, 1);
    return just(l1);
  };
  var _updateAt = function(just, nothing, i2, a3, l2) {
    if (i2 < 0 || i2 >= l2.length) return nothing;
    var l1 = l2.slice();
    l1[i2] = a3;
    return just(l1);
  };
  var reverse2 = function(l2) {
    return l2.slice().reverse();
  };
  var concat = function(xss) {
    if (xss.length <= 1e4) {
      return Array.prototype.concat.apply([], xss);
    }
    var result = [];
    for (var i2 = 0, l2 = xss.length; i2 < l2; i2++) {
      var xs = xss[i2];
      for (var j = 0, m2 = xs.length; j < m2; j++) {
        result.push(xs[j]);
      }
    }
    return result;
  };
  var filterImpl = function(f, xs) {
    return xs.filter(f);
  };
  var sortByImpl = /* @__PURE__ */ (function() {
    function mergeFromTo(compare24, fromOrdering, xs1, xs2, from10, to) {
      var mid;
      var i2;
      var j;
      var k;
      var x32;
      var y32;
      var c2;
      mid = from10 + (to - from10 >> 1);
      if (mid - from10 > 1) mergeFromTo(compare24, fromOrdering, xs2, xs1, from10, mid);
      if (to - mid > 1) mergeFromTo(compare24, fromOrdering, xs2, xs1, mid, to);
      i2 = from10;
      j = mid;
      k = from10;
      while (i2 < mid && j < to) {
        x32 = xs2[i2];
        y32 = xs2[j];
        c2 = fromOrdering(compare24(x32)(y32));
        if (c2 > 0) {
          xs1[k++] = y32;
          ++j;
        } else {
          xs1[k++] = x32;
          ++i2;
        }
      }
      while (i2 < mid) {
        xs1[k++] = xs2[i2++];
      }
      while (j < to) {
        xs1[k++] = xs2[j++];
      }
    }
    return function(compare24, fromOrdering, xs) {
      var out;
      if (xs.length < 2) return xs;
      out = xs.slice(0);
      mergeFromTo(compare24, fromOrdering, out, xs.slice(0), 0, xs.length);
      return out;
    };
  })();
  var sliceImpl = function(s3, e, l2) {
    return l2.slice(s3, e);
  };
  var zipWithImpl = function(f, xs, ys) {
    var l2 = xs.length < ys.length ? xs.length : ys.length;
    var result = new Array(l2);
    for (var i2 = 0; i2 < l2; i2++) {
      result[i2] = f(xs[i2])(ys[i2]);
    }
    return result;
  };
  var anyImpl = function(p2, xs) {
    var len = xs.length;
    for (var i2 = 0; i2 < len; i2++) {
      if (p2(xs[i2])) return true;
    }
    return false;
  };
  var allImpl = function(p2, xs) {
    var len = xs.length;
    for (var i2 = 0; i2 < len; i2++) {
      if (!p2(xs[i2])) return false;
    }
    return true;
  };
  var unsafeIndexImpl = function(xs, n) {
    return xs[n];
  };

  // output/Data.Array.ST/foreign.js
  function newSTArray() {
    return [];
  }
  function unsafeFreezeThawImpl(xs) {
    return xs;
  }
  var unsafeFreezeImpl = unsafeFreezeThawImpl;
  var unsafeThawImpl = unsafeFreezeThawImpl;
  function copyImpl(xs) {
    return xs.slice();
  }
  var thawImpl = copyImpl;
  var pushImpl = function(a3, xs) {
    return xs.push(a3);
  };

  // output/Control.Monad.ST.Uncurried/foreign.js
  var runSTFn1 = function runSTFn12(fn) {
    return function(a3) {
      return function() {
        return fn(a3);
      };
    };
  };
  var runSTFn2 = function runSTFn22(fn) {
    return function(a3) {
      return function(b10) {
        return function() {
          return fn(a3, b10);
        };
      };
    };
  };

  // output/Data.Array.ST/index.js
  var unsafeThaw = /* @__PURE__ */ runSTFn1(unsafeThawImpl);
  var unsafeFreeze = /* @__PURE__ */ runSTFn1(unsafeFreezeImpl);
  var thaw = /* @__PURE__ */ runSTFn1(thawImpl);
  var withArray = function(f) {
    return function(xs) {
      return function __do7() {
        var result = thaw(xs)();
        f(result)();
        return unsafeFreeze(result)();
      };
    };
  };
  var push = /* @__PURE__ */ runSTFn2(pushImpl);

  // output/Data.Array.ST.Iterator/index.js
  var map8 = /* @__PURE__ */ map(functorST);
  var not2 = /* @__PURE__ */ not(heytingAlgebraBoolean);
  var $$void3 = /* @__PURE__ */ $$void(functorST);
  var Iterator = /* @__PURE__ */ (function() {
    function Iterator2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    Iterator2.create = function(value0) {
      return function(value1) {
        return new Iterator2(value0, value1);
      };
    };
    return Iterator2;
  })();
  var peek = function(v2) {
    return function __do7() {
      var i2 = read2(v2.value1)();
      return v2.value0(i2);
    };
  };
  var next = function(v2) {
    return function __do7() {
      var i2 = read2(v2.value1)();
      modify2(function(v1) {
        return v1 + 1 | 0;
      })(v2.value1)();
      return v2.value0(i2);
    };
  };
  var pushWhile = function(p2) {
    return function(iter) {
      return function(array2) {
        return function __do7() {
          var $$break = newSTRef(false)();
          while (map8(not2)(read2($$break))()) {
            (function __do8() {
              var mx = peek(iter)();
              if (mx instanceof Just && p2(mx.value0)) {
                push(mx.value0)(array2)();
                return $$void3(next(iter))();
              }
              ;
              return $$void3(write2(true)($$break))();
            })();
          }
          ;
          return {};
        };
      };
    };
  };
  var iterator = function(f) {
    return map8(Iterator.create(f))(newSTRef(0));
  };
  var iterate = function(iter) {
    return function(f) {
      return function __do7() {
        var $$break = newSTRef(false)();
        while (map8(not2)(read2($$break))()) {
          (function __do8() {
            var mx = next(iter)();
            if (mx instanceof Just) {
              return f(mx.value0)();
            }
            ;
            if (mx instanceof Nothing) {
              return $$void3(write2(true)($$break))();
            }
            ;
            throw new Error("Failed pattern match at Data.Array.ST.Iterator (line 42, column 5 - line 44, column 47): " + [mx.constructor.name]);
          })();
        }
        ;
        return {};
      };
    };
  };

  // output/Data.Function.Uncurried/foreign.js
  var runFn2 = function(fn) {
    return function(a3) {
      return function(b10) {
        return fn(a3, b10);
      };
    };
  };
  var runFn3 = function(fn) {
    return function(a3) {
      return function(b10) {
        return function(c2) {
          return fn(a3, b10, c2);
        };
      };
    };
  };
  var runFn4 = function(fn) {
    return function(a3) {
      return function(b10) {
        return function(c2) {
          return function(d) {
            return fn(a3, b10, c2, d);
          };
        };
      };
    };
  };
  var runFn5 = function(fn) {
    return function(a3) {
      return function(b10) {
        return function(c2) {
          return function(d) {
            return function(e) {
              return fn(a3, b10, c2, d, e);
            };
          };
        };
      };
    };
  };

  // output/Data.Array/index.js
  var $$void4 = /* @__PURE__ */ $$void(functorST);
  var intercalate1 = /* @__PURE__ */ intercalate(foldableArray);
  var map9 = /* @__PURE__ */ map(functorMaybe);
  var map1 = /* @__PURE__ */ map(functorArray);
  var map22 = /* @__PURE__ */ map(functorST);
  var fromJust4 = /* @__PURE__ */ fromJust();
  var when2 = /* @__PURE__ */ when(applicativeST);
  var notEq3 = /* @__PURE__ */ notEq(eqOrdering);
  var append4 = /* @__PURE__ */ append(semigroupArray);
  var zipWith2 = /* @__PURE__ */ runFn3(zipWithImpl);
  var zip = /* @__PURE__ */ (function() {
    return zipWith2(Tuple.create);
  })();
  var updateAt = /* @__PURE__ */ (function() {
    return runFn5(_updateAt)(Just.create)(Nothing.value);
  })();
  var unsafeIndex = function() {
    return runFn2(unsafeIndexImpl);
  };
  var unsafeIndex1 = /* @__PURE__ */ unsafeIndex();
  var uncons4 = /* @__PURE__ */ (function() {
    return runFn3(unconsImpl)($$const(Nothing.value))(function(x32) {
      return function(xs) {
        return new Just({
          head: x32,
          tail: xs
        });
      };
    });
  })();
  var sortBy = function(comp) {
    return runFn3(sortByImpl)(comp)(function(v2) {
      if (v2 instanceof GT) {
        return 1;
      }
      ;
      if (v2 instanceof EQ) {
        return 0;
      }
      ;
      if (v2 instanceof LT) {
        return -1 | 0;
      }
      ;
      throw new Error("Failed pattern match at Data.Array (line 897, column 38 - line 900, column 11): " + [v2.constructor.name]);
    });
  };
  var sortWith = function(dictOrd) {
    var comparing4 = comparing(dictOrd);
    return function(f) {
      return sortBy(comparing4(f));
    };
  };
  var sortWith1 = /* @__PURE__ */ sortWith(ordInt);
  var sort = function(dictOrd) {
    var compare24 = compare(dictOrd);
    return function(xs) {
      return sortBy(compare24)(xs);
    };
  };
  var snoc3 = function(xs) {
    return function(x32) {
      return withArray(push(x32))(xs)();
    };
  };
  var slice = /* @__PURE__ */ runFn3(sliceImpl);
  var take = function(n) {
    return function(xs) {
      var $152 = n < 1;
      if ($152) {
        return [];
      }
      ;
      return slice(0)(n)(xs);
    };
  };
  var singleton5 = function(a3) {
    return [a3];
  };
  var replicate = /* @__PURE__ */ runFn2(replicateImpl);
  var range2 = /* @__PURE__ */ runFn2(rangeImpl);
  var $$null3 = function(xs) {
    return length3(xs) === 0;
  };
  var mapWithIndex3 = /* @__PURE__ */ mapWithIndex(functorWithIndexArray);
  var intercalate2 = function(dictMonoid) {
    return intercalate1(dictMonoid);
  };
  var insertAt = /* @__PURE__ */ (function() {
    return runFn5(_insertAt)(Just.create)(Nothing.value);
  })();
  var index = /* @__PURE__ */ (function() {
    return runFn4(indexImpl)(Just.create)(Nothing.value);
  })();
  var last = function(xs) {
    return index(xs)(length3(xs) - 1 | 0);
  };
  var span = function(p2) {
    return function(arr) {
      var go2 = function($copy_i) {
        var $tco_done = false;
        var $tco_result;
        function $tco_loop(i2) {
          var v2 = index(arr)(i2);
          if (v2 instanceof Just) {
            var $156 = p2(v2.value0);
            if ($156) {
              $copy_i = i2 + 1 | 0;
              return;
            }
            ;
            $tco_done = true;
            return new Just(i2);
          }
          ;
          if (v2 instanceof Nothing) {
            $tco_done = true;
            return Nothing.value;
          }
          ;
          throw new Error("Failed pattern match at Data.Array (line 1035, column 5 - line 1037, column 25): " + [v2.constructor.name]);
        }
        ;
        while (!$tco_done) {
          $tco_result = $tco_loop($copy_i);
        }
        ;
        return $tco_result;
      };
      var breakIndex = go2(0);
      if (breakIndex instanceof Just && breakIndex.value0 === 0) {
        return {
          init: [],
          rest: arr
        };
      }
      ;
      if (breakIndex instanceof Just) {
        return {
          init: slice(0)(breakIndex.value0)(arr),
          rest: slice(breakIndex.value0)(length3(arr))(arr)
        };
      }
      ;
      if (breakIndex instanceof Nothing) {
        return {
          init: arr,
          rest: []
        };
      }
      ;
      throw new Error("Failed pattern match at Data.Array (line 1022, column 3 - line 1028, column 30): " + [breakIndex.constructor.name]);
    };
  };
  var takeWhile = function(p2) {
    return function(xs) {
      return span(p2)(xs).init;
    };
  };
  var head2 = function(xs) {
    return index(xs)(0);
  };
  var nubBy = function(comp) {
    return function(xs) {
      var indexedAndSorted = sortBy(function(x32) {
        return function(y32) {
          return comp(snd(x32))(snd(y32));
        };
      })(mapWithIndex3(Tuple.create)(xs));
      var v2 = head2(indexedAndSorted);
      if (v2 instanceof Nothing) {
        return [];
      }
      ;
      if (v2 instanceof Just) {
        return map1(snd)(sortWith1(fst)((function __do7() {
          var result = unsafeThaw(singleton5(v2.value0))();
          foreach(indexedAndSorted)(function(v1) {
            return function __do8() {
              var lst = map22(/* @__PURE__ */ (function() {
                var $183 = function($185) {
                  return fromJust4(last($185));
                };
                return function($184) {
                  return snd($183($184));
                };
              })())(unsafeFreeze(result))();
              return when2(notEq3(comp(lst)(v1.value1))(EQ.value))($$void4(push(v1)(result)))();
            };
          })();
          return unsafeFreeze(result)();
        })()));
      }
      ;
      throw new Error("Failed pattern match at Data.Array (line 1115, column 17 - line 1123, column 28): " + [v2.constructor.name]);
    };
  };
  var nub = function(dictOrd) {
    return nubBy(compare(dictOrd));
  };
  var groupBy = function(op) {
    return function(xs) {
      return (function __do7() {
        var result = newSTArray();
        var iter = iterator(function(v2) {
          return index(xs)(v2);
        })();
        iterate(iter)(function(x32) {
          return $$void4(function __do8() {
            var sub1 = newSTArray();
            push(x32)(sub1)();
            pushWhile(op(x32))(iter)(sub1)();
            var grp = unsafeFreeze(sub1)();
            return push(grp)(result)();
          });
        })();
        return unsafeFreeze(result)();
      })();
    };
  };
  var fromFoldable3 = function(dictFoldable) {
    return runFn2(fromFoldableImpl)(foldr(dictFoldable));
  };
  var foldr4 = /* @__PURE__ */ foldr(foldableArray);
  var foldl4 = /* @__PURE__ */ foldl(foldableArray);
  var foldM = function(dictMonad) {
    var pure128 = pure(dictMonad.Applicative0());
    var bind142 = bind(dictMonad.Bind1());
    return function(f) {
      return function(b10) {
        return runFn3(unconsImpl)(function(v2) {
          return pure128(b10);
        })(function(a3) {
          return function(as) {
            return bind142(f(b10)(a3))(function(b$prime) {
              return foldM(dictMonad)(f)(b$prime)(as);
            });
          };
        });
      };
    };
  };
  var findMap2 = /* @__PURE__ */ (function() {
    return runFn4(findMapImpl)(Nothing.value)(isJust);
  })();
  var findIndex = /* @__PURE__ */ (function() {
    return runFn4(findIndexImpl)(Just.create)(Nothing.value);
  })();
  var find2 = function(f) {
    return function(xs) {
      return map9(unsafeIndex1(xs))(findIndex(f)(xs));
    };
  };
  var filter = /* @__PURE__ */ runFn2(filterImpl);
  var elemIndex = function(dictEq) {
    var eq27 = eq(dictEq);
    return function(x32) {
      return findIndex(function(v2) {
        return eq27(v2)(x32);
      });
    };
  };
  var elem2 = function(dictEq) {
    var elemIndex1 = elemIndex(dictEq);
    return function(a3) {
      return function(arr) {
        return isJust(elemIndex1(a3)(arr));
      };
    };
  };
  var dropWhile = function(p2) {
    return function(xs) {
      return span(p2)(xs).rest;
    };
  };
  var drop = function(n) {
    return function(xs) {
      var $173 = n < 1;
      if ($173) {
        return xs;
      }
      ;
      return slice(n)(length3(xs))(xs);
    };
  };
  var deleteAt = /* @__PURE__ */ (function() {
    return runFn4(_deleteAt)(Just.create)(Nothing.value);
  })();
  var deleteBy = function(v2) {
    return function(v1) {
      return function(v22) {
        if (v22.length === 0) {
          return [];
        }
        ;
        return maybe(v22)(function(i2) {
          return fromJust4(deleteAt(i2)(v22));
        })(findIndex(v2(v1))(v22));
      };
    };
  };
  var $$delete = function(dictEq) {
    return deleteBy(eq(dictEq));
  };
  var difference = function(dictEq) {
    return foldr4($$delete(dictEq));
  };
  var cons2 = function(x32) {
    return function(xs) {
      return append4([x32])(xs);
    };
  };
  var concatMap = /* @__PURE__ */ flip(/* @__PURE__ */ bind(bindArray));
  var mapMaybe = function(f) {
    return concatMap((function() {
      var $189 = maybe([])(singleton5);
      return function($190) {
        return $189(f($190));
      };
    })());
  };
  var catMaybes = /* @__PURE__ */ mapMaybe(/* @__PURE__ */ identity(categoryFn));
  var any2 = /* @__PURE__ */ runFn2(anyImpl);
  var all2 = /* @__PURE__ */ runFn2(allImpl);

  // output/Data.Tree/index.js
  var mkTree = mkCofree;

  // output/Data.Int/foreign.js
  var fromNumberImpl = function(just) {
    return function(nothing) {
      return function(n) {
        return (n | 0) === n ? just(n) : nothing;
      };
    };
  };
  var toNumber = function(n) {
    return n;
  };
  var fromStringAsImpl = function(just) {
    return function(nothing) {
      return function(radix) {
        var digits;
        if (radix < 11) {
          digits = "[0-" + (radix - 1).toString() + "]";
        } else if (radix === 11) {
          digits = "[0-9a]";
        } else {
          digits = "[0-9a-" + String.fromCharCode(86 + radix) + "]";
        }
        var pattern2 = new RegExp("^[\\+\\-]?" + digits + "+$", "i");
        return function(s3) {
          if (pattern2.test(s3)) {
            var i2 = parseInt(s3, radix);
            return (i2 | 0) === i2 ? just(i2) : nothing;
          } else {
            return nothing;
          }
        };
      };
    };
  };
  var toStringAs = function(radix) {
    return function(i2) {
      return i2.toString(radix);
    };
  };

  // output/Data.Number/foreign.js
  var isFiniteImpl = isFinite;
  function fromStringImpl(str23, isFinite2, just, nothing) {
    var num41 = parseFloat(str23);
    if (isFinite2(num41)) {
      return just(num41);
    } else {
      return nothing;
    }
  }
  var abs = Math.abs;
  var acos = Math.acos;
  var asin = Math.asin;
  var atan = Math.atan;
  var atan2 = function(y32) {
    return function(x32) {
      return Math.atan2(y32, x32);
    };
  };
  var ceil = Math.ceil;
  var cos = Math.cos;
  var floor = Math.floor;
  var log = Math.log;
  var pow = function(n) {
    return function(p2) {
      return Math.pow(n, p2);
    };
  };
  var remainder = function(n) {
    return function(m2) {
      return n % m2;
    };
  };
  var round = Math.round;
  var sin = Math.sin;
  var sqrt = Math.sqrt;
  var tan = Math.tan;

  // output/Data.Number/index.js
  var pi = 3.141592653589793;
  var fromString = function(str23) {
    return fromStringImpl(str23, isFiniteImpl, Just.create, Nothing.value);
  };

  // output/Data.Int/index.js
  var top2 = /* @__PURE__ */ top(boundedInt);
  var bottom2 = /* @__PURE__ */ bottom(boundedInt);
  var hexadecimal = 16;
  var fromStringAs = /* @__PURE__ */ (function() {
    return fromStringAsImpl(Just.create)(Nothing.value);
  })();
  var fromString2 = /* @__PURE__ */ fromStringAs(10);
  var fromNumber = /* @__PURE__ */ (function() {
    return fromNumberImpl(Just.create)(Nothing.value);
  })();
  var unsafeClamp = function(x32) {
    if (!isFiniteImpl(x32)) {
      return 0;
    }
    ;
    if (x32 >= toNumber(top2)) {
      return top2;
    }
    ;
    if (x32 <= toNumber(bottom2)) {
      return bottom2;
    }
    ;
    if (otherwise) {
      return fromMaybe(0)(fromNumber(x32));
    }
    ;
    throw new Error("Failed pattern match at Data.Int (line 72, column 1 - line 72, column 29): " + [x32.constructor.name]);
  };
  var round2 = function($37) {
    return unsafeClamp(round($37));
  };
  var floor2 = function($39) {
    return unsafeClamp(floor($39));
  };

  // output/DataViz.Layout.Hierarchy.Cluster/index.js
  var compare3 = /* @__PURE__ */ compare(ordInt);
  var map10 = /* @__PURE__ */ map(functorList);
  var fromFoldable4 = /* @__PURE__ */ fromFoldable3(foldableList);
  var fromFoldable1 = /* @__PURE__ */ fromFoldable(foldableArray);
  var fromFoldable22 = /* @__PURE__ */ fromFoldable3(/* @__PURE__ */ foldableCofree(foldableList));
  var map12 = /* @__PURE__ */ map(functorArray);
  var maximum2 = /* @__PURE__ */ maximum(ordNumber)(foldableArray);
  var minimum2 = /* @__PURE__ */ minimum(ordNumber)(foldableArray);
  var maximum1 = /* @__PURE__ */ maximum(ordInt)(foldableArray);
  var foldl5 = /* @__PURE__ */ foldl(foldableArray);
  var sortByHeight = function(t2) {
    var compareByHeight = function(t12) {
      return function(t22) {
        return compare3(head(t22).height)(head(t12).height);
      };
    };
    var val = head(t2);
    var children3 = tail(t2);
    var sortedGrandchildren = map10(sortByHeight)(children3);
    var childArray = fromFoldable4(sortedGrandchildren);
    var sortedArray = sortBy(compareByHeight)(childArray);
    var sortedChildrenList = fromFoldable1(sortedArray);
    return mkTree(val)(sortedChildrenList);
  };
  var scaleToPixels = function(config) {
    return function(inputTree) {
      var allNodes = fromFoldable22(inputTree);
      var allX = map12(function(n) {
        return n.x;
      })(allNodes);
      var maxX = fromMaybe(1)(maximum2(allX));
      var minX = fromMaybe(0)(minimum2(allX));
      var xRange = (function() {
        var $30 = maxX - minX === 0;
        if ($30) {
          return 1;
        }
        ;
        return maxX - minX;
      })();
      var scaleX5 = function(x32) {
        return (x32 - minX) / xRange * config.size.width;
      };
      var allHeights = map12(function(n) {
        return n.height;
      })(allNodes);
      var maxHeight = fromMaybe(1)(maximum1(allHeights));
      var scaleY5 = function(height47) {
        return (1 - toNumber(height47) / toNumber(maxHeight)) * config.size.height;
      };
      var go2 = function(t2) {
        var val = head(t2);
        var children3 = tail(t2);
        return mkTree((function() {
          var $31 = {};
          for (var $32 in val) {
            if ({}.hasOwnProperty.call(val, $32)) {
              $31[$32] = val[$32];
            }
            ;
          }
          ;
          $31.x = scaleX5(val.x);
          $31.y = scaleY5(val.height);
          return $31;
        })())(map10(go2)(children3));
      };
      return go2(inputTree);
    };
  };
  var render = function(minSep) {
    return function(inputTree) {
      var foldl110 = function(f) {
        return function(init4) {
          return function(arr) {
            return foldl5(f)(init4)(arr);
          };
        };
      };
      var findExtent = function(t2) {
        var val = head(t2);
        var children3 = tail(t2);
        var v2 = fromFoldable4(children3);
        if (v2.length === 0) {
          return {
            minX: val.x,
            maxX: val.x
          };
        }
        ;
        var childExtents = map12(findExtent)(v2);
        var maxX = fromMaybe(val.x)(maximum2(map12(function(e) {
          return e.maxX;
        })(childExtents)));
        var minX = fromMaybe(val.x)(minimum2(map12(function(e) {
          return e.minX;
        })(childExtents)));
        return {
          minX,
          maxX
        };
      };
      var renderInternal = function(currentLeafX) {
        return function(t2) {
          var val = head(t2);
          var children3 = tail(t2);
          var v2 = fromFoldable4(children3);
          if (v2.length === 0) {
            var leafNode = mkTree((function() {
              var $36 = {};
              for (var $37 in val) {
                if ({}.hasOwnProperty.call(val, $37)) {
                  $36[$37] = val[$37];
                }
                ;
              }
              ;
              $36.x = currentLeafX;
              return $36;
            })())(Nil.value);
            return {
              tree: leafNode,
              lastLeafX: currentLeafX + minSep
            };
          }
          ;
          var processChildren = foldl110(function(acc) {
            return function(child) {
              var result = renderInternal(acc.lastLeafX)(child);
              return {
                trees: snoc3(acc.trees)(result.tree),
                lastLeafX: result.lastLeafX
              };
            };
          })({
            trees: [],
            lastLeafX: currentLeafX
          })(v2);
          var childrenList = fromFoldable1(processChildren.trees);
          var allChildExtents = map12(findExtent)(processChildren.trees);
          var maxX = fromMaybe(0)(maximum2(map12(function(e) {
            return e.maxX;
          })(allChildExtents)));
          var minX = fromMaybe(0)(minimum2(map12(function(e) {
            return e.minX;
          })(allChildExtents)));
          var centerX = (minX + maxX) / 2;
          var internalNode = mkTree((function() {
            var $39 = {};
            for (var $40 in val) {
              if ({}.hasOwnProperty.call(val, $40)) {
                $39[$40] = val[$40];
              }
              ;
            }
            ;
            $39.x = centerX;
            return $39;
          })())(childrenList);
          return {
            tree: internalNode,
            lastLeafX: processChildren.lastLeafX
          };
        };
      };
      return renderInternal(0)(inputTree);
    };
  };
  var defaultClusterConfig = {
    size: {
      width: 800,
      height: 600
    },
    minSeparation: 1
  };
  var centerRoot = function(tree2) {
    var root3 = head(tree2);
    var allNodes = fromFoldable22(tree2);
    var leaves2 = filter(function(n) {
      return n.height === 0;
    })(allNodes);
    var firstLeaf = head2(leaves2);
    var minX = (function() {
      if (firstLeaf instanceof Just) {
        return firstLeaf.value0.x;
      }
      ;
      if (firstLeaf instanceof Nothing) {
        return 0;
      }
      ;
      throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Cluster (line 92, column 12 - line 94, column 21): " + [firstLeaf.constructor.name]);
    })();
    var lastLeaf = last(leaves2);
    var maxX = (function() {
      if (lastLeaf instanceof Just) {
        return lastLeaf.value0.x;
      }
      ;
      if (lastLeaf instanceof Nothing) {
        return 0;
      }
      ;
      throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Cluster (line 96, column 12 - line 98, column 21): " + [lastLeaf.constructor.name]);
    })();
    var targetX = (minX + maxX) / 2;
    var offset = targetX - root3.x;
    var shiftTree = function(t2) {
      var val = head(t2);
      var children3 = tail(t2);
      return mkTree((function() {
        var $46 = {};
        for (var $47 in val) {
          if ({}.hasOwnProperty.call(val, $47)) {
            $46[$47] = val[$47];
          }
          ;
        }
        ;
        $46.x = val.x + offset;
        return $46;
      })())(map10(shiftTree)(children3));
    };
    return shiftTree(tree2);
  };
  var addYCoordinates = function(t2) {
    var val = head(t2);
    var nodeY2 = toNumber(val.height);
    var children3 = tail(t2);
    var childrenWithY = map10(addYCoordinates)(children3);
    return mkTree((function() {
      var $49 = {};
      for (var $50 in val) {
        if ({}.hasOwnProperty.call(val, $50)) {
          $49[$50] = val[$50];
        }
        ;
      }
      ;
      $49.y = nodeY2;
      return $49;
    })())(childrenWithY);
  };
  var addHeight = function(t2) {
    var val = head(t2);
    var children3 = tail(t2);
    var childrenWithHeight = map10(addHeight)(children3);
    var nodeHeight = (function() {
      var v2 = fromFoldable4(childrenWithHeight);
      if (v2.length === 0) {
        return 0;
      }
      ;
      var childHeights = map12(function(c2) {
        return head(c2).height;
      })(v2);
      var maxChildHeight = fromMaybe(0)(maximum1(childHeights));
      return 1 + maxChildHeight | 0;
    })();
    return mkTree((function() {
      var $53 = {};
      for (var $54 in val) {
        if ({}.hasOwnProperty.call(val, $54)) {
          $53[$54] = val[$54];
        }
        ;
      }
      ;
      $53.height = nodeHeight;
      return $53;
    })())(childrenWithHeight);
  };
  var cluster = function(config) {
    return function(inputTree) {
      var withHeight = addHeight(inputTree);
      var sorted = sortByHeight(withHeight);
      var rendered = render(config.minSeparation)(sorted);
      var centered = centerRoot(rendered.tree);
      var withCoords = addYCoordinates(centered);
      var scaled = scaleToPixels(config)(withCoords);
      return scaled;
    };
  };

  // output/DataViz.Layout.Hierarchy.Tree/index.js
  var compare4 = /* @__PURE__ */ compare(ordInt);
  var map11 = /* @__PURE__ */ map(functorList);
  var fromFoldable5 = /* @__PURE__ */ fromFoldable3(foldableList);
  var fromFoldable12 = /* @__PURE__ */ fromFoldable(foldableArray);
  var add2 = /* @__PURE__ */ add(semiringNumber);
  var fromFoldable23 = /* @__PURE__ */ fromFoldable3(/* @__PURE__ */ foldableCofree(foldableList));
  var map13 = /* @__PURE__ */ map(functorArray);
  var maximum3 = /* @__PURE__ */ maximum(ordNumber)(foldableArray);
  var minimum3 = /* @__PURE__ */ minimum(ordNumber)(foldableArray);
  var scanl2 = /* @__PURE__ */ scanl(traversableList);
  var maximum12 = /* @__PURE__ */ maximum(ordInt)(foldableArray);
  var Contours = /* @__PURE__ */ (function() {
    function Contours2(value0) {
      this.value0 = value0;
    }
    ;
    Contours2.create = function(value0) {
      return new Contours2(value0);
    };
    return Contours2;
  })();
  var sortByHeight2 = function(t2) {
    var compareByHeight = function(t12) {
      return function(t22) {
        return compare4(head(t22).height)(head(t12).height);
      };
    };
    var val = head(t2);
    var children3 = tail(t2);
    var sortedGrandchildren = map11(sortByHeight2)(children3);
    var childArray = fromFoldable5(sortedGrandchildren);
    var sortedArray = sortBy(compareByHeight)(childArray);
    var sortedChildrenList = fromFoldable12(sortedArray);
    return mkTree(val)(sortedChildrenList);
  };
  var singletonContours = /* @__PURE__ */ (function() {
    return new Contours({
      left: new Cons(0, Nil.value),
      right: new Cons(0, Nil.value)
    });
  })();
  var scanContoursWithBase = function(baseSep) {
    return function(v2) {
      return function(v1) {
        var go2 = function($copy_v2) {
          return function($copy_v3) {
            return function($copy_v4) {
              return function($copy_v5) {
                return function($copy_v6) {
                  var $tco_var_v2 = $copy_v2;
                  var $tco_var_v3 = $copy_v3;
                  var $tco_var_v4 = $copy_v4;
                  var $tco_var_v5 = $copy_v5;
                  var $tco_done = false;
                  var $tco_result;
                  function $tco_loop(v22, v3, v4, v5, v6) {
                    if (v5 instanceof Nil && v6 instanceof Nil) {
                      $tco_done = true;
                      return v22;
                    }
                    ;
                    if (v5 instanceof Nil && v6 instanceof Cons) {
                      var actualSep = v22 + v6.value0 - v3;
                      var neededSep = (function() {
                        var $71 = actualSep < baseSep;
                        if ($71) {
                          return v22 + (baseSep - actualSep);
                        }
                        ;
                        return v22;
                      })();
                      $tco_var_v2 = neededSep;
                      $tco_var_v3 = v3;
                      $tco_var_v4 = v6.value0;
                      $tco_var_v5 = Nil.value;
                      $copy_v6 = v6.value1;
                      return;
                    }
                    ;
                    if (v5 instanceof Cons && v6 instanceof Nil) {
                      var actualSep = v22 + v4 - v5.value0;
                      var neededSep = (function() {
                        var $74 = actualSep < baseSep;
                        if ($74) {
                          return v22 + (baseSep - actualSep);
                        }
                        ;
                        return v22;
                      })();
                      $tco_var_v2 = neededSep;
                      $tco_var_v3 = v5.value0;
                      $tco_var_v4 = v4;
                      $tco_var_v5 = v5.value1;
                      $copy_v6 = Nil.value;
                      return;
                    }
                    ;
                    if (v5 instanceof Cons && v6 instanceof Cons) {
                      var actualSep = v22 + v6.value0 - v5.value0;
                      var neededSep = (function() {
                        var $77 = actualSep < baseSep;
                        if ($77) {
                          return v22 + (baseSep - actualSep);
                        }
                        ;
                        return v22;
                      })();
                      $tco_var_v2 = neededSep;
                      $tco_var_v3 = v5.value0;
                      $tco_var_v4 = v6.value0;
                      $tco_var_v5 = v5.value1;
                      $copy_v6 = v6.value1;
                      return;
                    }
                    ;
                    throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 292, column 3 - line 292, column 67): " + [v22.constructor.name, v3.constructor.name, v4.constructor.name, v5.constructor.name, v6.constructor.name]);
                  }
                  ;
                  while (!$tco_done) {
                    $tco_result = $tco_loop($tco_var_v2, $tco_var_v3, $tco_var_v4, $tco_var_v5, $copy_v6);
                  }
                  ;
                  return $tco_result;
                };
              };
            };
          };
        };
        return go2(baseSep)(0)(0)(v2.value0.right)(v1.value0.left);
      };
    };
  };
  var scaleToPixels2 = function(config) {
    return function(inputTree) {
      var layerScaleFn = fromMaybe(toNumber)(config.layerScale);
      var allNodes = fromFoldable23(inputTree);
      var allX = map13(function(n) {
        return n.x;
      })(allNodes);
      var maxX = fromMaybe(1)(maximum3(allX));
      var minX = fromMaybe(0)(minimum3(allX));
      var xRange = (function() {
        var $105 = maxX - minX === 0;
        if ($105) {
          return 1;
        }
        ;
        return maxX - minX;
      })();
      var scaleX5 = function(x32) {
        return (x32 - minX) / xRange * config.size.width;
      };
      var scaledDepths = map13(function(n) {
        return layerScaleFn(n.depth);
      })(allNodes);
      var maxScaledDepth = fromMaybe(1)(maximum3(scaledDepths));
      var scaleY5 = function(depth) {
        var scaledDepth = layerScaleFn(depth);
        return scaledDepth / maxScaledDepth * config.size.height;
      };
      var go2 = function(tr2) {
        var val = head(tr2);
        var cs = tail(tr2);
        return mkTree((function() {
          var $106 = {};
          for (var $107 in val) {
            if ({}.hasOwnProperty.call(val, $107)) {
              $106[$107] = val[$107];
            }
            ;
          }
          ;
          $106.x = scaleX5(val.x);
          $106.y = scaleY5(val.depth);
          return $106;
        })())(map11(go2)(cs));
      };
      return go2(inputTree);
    };
  };
  var petrify = function(parentX) {
    return function(t2) {
      var v2 = head(t2);
      var nodeY2 = toNumber(v2.value1.depth);
      var nodeX2 = parentX + v2.value0.offset;
      var children3 = tail(t2);
      var childrenWithCoords = map11(petrify(nodeX2))(children3);
      return mkTree((function() {
        var $110 = {};
        for (var $111 in v2.value1) {
          if ({}.hasOwnProperty.call(v2.value1, $111)) {
            $110[$111] = v2["value1"][$111];
          }
          ;
        }
        ;
        $110.x = nodeX2;
        $110.y = nodeY2;
        return $110;
      })())(childrenWithCoords);
    };
  };
  var mergeContoursRight = function(contours) {
    var mergeLevel = function(cs) {
      var currentLevels = mapMaybe(function(c2) {
        if (c2 instanceof Cons) {
          return new Just(c2.value0);
        }
        ;
        if (c2 instanceof Nil) {
          return Nothing.value;
        }
        ;
        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 437, column 17 - line 439, column 27): " + [c2.constructor.name]);
      })(cs);
      var v2 = head2(currentLevels);
      if (v2 instanceof Nothing) {
        return Nil.value;
      }
      ;
      if (v2 instanceof Just) {
        var restContours = mapMaybe(function(c2) {
          if (c2 instanceof Cons) {
            return new Just(c2.value1);
          }
          ;
          if (c2 instanceof Nil) {
            return Nothing.value;
          }
          ;
          throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 450, column 23 - line 452, column 33): " + [c2.constructor.name]);
        })(cs);
        var maxVal = fromMaybe(0)(maximum3(currentLevels));
        return new Cons(maxVal, mergeLevel(restContours));
      }
      ;
      throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 443, column 7 - line 456, column 50): " + [v2.constructor.name]);
    };
    if (contours.length === 0) {
      return Nil.value;
    }
    ;
    return mergeLevel(contours);
  };
  var mergeContoursLeft = function(contours) {
    var mergeLevel = function(cs) {
      var currentLevels = mapMaybe(function(c2) {
        if (c2 instanceof Cons) {
          return new Just(c2.value0);
        }
        ;
        if (c2 instanceof Nil) {
          return Nothing.value;
        }
        ;
        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 404, column 17 - line 406, column 27): " + [c2.constructor.name]);
      })(cs);
      var v2 = head2(currentLevels);
      if (v2 instanceof Nothing) {
        return Nil.value;
      }
      ;
      if (v2 instanceof Just) {
        var restContours = mapMaybe(function(c2) {
          if (c2 instanceof Cons) {
            return new Just(c2.value1);
          }
          ;
          if (c2 instanceof Nil) {
            return Nothing.value;
          }
          ;
          throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 417, column 23 - line 419, column 33): " + [c2.constructor.name]);
        })(cs);
        var minVal = fromMaybe(0)(minimum3(currentLevels));
        return new Cons(minVal, mergeLevel(restContours));
      }
      ;
      throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 410, column 7 - line 423, column 50): " + [v2.constructor.name]);
    };
    if (contours.length === 0) {
      return Nil.value;
    }
    ;
    return mergeLevel(contours);
  };
  var spliceContours = function(offsets) {
    return function(contours) {
      var v2 = fromFoldable5(zipWith(Tuple.create)(offsets)(contours));
      if (v2.length === 0) {
        return singletonContours;
      }
      ;
      if (v2.length === 1) {
        return new Contours({
          left: new Cons(0, map11(function(x32) {
            return x32 + v2[0].value0;
          })(v2[0].value1.value0.left)),
          right: new Cons(0, map11(function(x32) {
            return x32 + v2[0].value0;
          })(v2[0].value1.value0.right))
        });
      }
      ;
      var shiftedContours = map13(function(v1) {
        return new Contours({
          left: map11(function(x32) {
            return x32 + v1.value0;
          })(v1.value1.value0.left),
          right: map11(function(x32) {
            return x32 + v1.value0;
          })(v1.value1.value0.right)
        });
      })(v2);
      var mergedRight = mergeContoursRight(map13(function(v1) {
        return v1.value0.right;
      })(shiftedContours));
      var mergedLeft = mergeContoursLeft(map13(function(v1) {
        return v1.value0.left;
      })(shiftedContours));
      return new Contours({
        left: new Cons(0, mergedLeft),
        right: new Cons(0, mergedRight)
      });
    };
  };
  var getRootData = function(t2) {
    var v2 = head(t2);
    return v2.value1;
  };
  var defaultTreeConfig = /* @__PURE__ */ (function() {
    return {
      size: {
        width: 800,
        height: 600
      },
      minSeparation: 1,
      separation: Nothing.value,
      layerScale: Nothing.value
    };
  })();
  var computeSeparationsWithBase = function(baseSeps) {
    return function(contours) {
      var tailSafe = function(v3) {
        if (v3 instanceof Nil) {
          return Nil.value;
        }
        ;
        if (v3 instanceof Cons) {
          return v3.value1;
        }
        ;
        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 280, column 3 - line 280, column 41): " + [v3.constructor.name]);
      };
      var applyBase = function(base3) {
        return function(v3) {
          return scanContoursWithBase(base3)(v3.value0)(v3.value1);
        };
      };
      var v2 = new Tuple(baseSeps, contours);
      if (v2.value0 instanceof Nil) {
        return Nil.value;
      }
      ;
      if (v2.value1 instanceof Nil) {
        return Nil.value;
      }
      ;
      if (v2.value1 instanceof Cons && v2.value1.value1 instanceof Nil) {
        return Nil.value;
      }
      ;
      var contourPairs = zipWith(Tuple.create)(contours)(tailSafe(contours));
      return zipWith(applyBase)(baseSeps)(contourPairs);
    };
  };
  var computeBaseSeparations = function(minSep) {
    return function(separationFn) {
      return function(nodes3) {
        var tailSafe = function(v2) {
          if (v2 instanceof Nil) {
            return Nil.value;
          }
          ;
          if (v2 instanceof Cons) {
            return v2.value1;
          }
          ;
          throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 258, column 3 - line 258, column 41): " + [v2.constructor.name]);
        };
        var getSep = function(v2) {
          return function(v1) {
            return function(v22) {
              return function(v3) {
                if (v2 instanceof Nothing) {
                  return v1;
                }
                ;
                if (v2 instanceof Just) {
                  return v2.value0(v22)(v3) + v1;
                }
                ;
                throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 254, column 3 - line 254, column 67): " + [v2.constructor.name, v1.constructor.name, v22.constructor.name, v3.constructor.name]);
              };
            };
          };
        };
        if (nodes3 instanceof Nil) {
          return Nil.value;
        }
        ;
        if (nodes3 instanceof Cons && nodes3.value1 instanceof Nil) {
          return Nil.value;
        }
        ;
        return zipWith(getSep(separationFn)(minSep))(nodes3)(tailSafe(nodes3));
      };
    };
  };
  var render2 = function(minSep) {
    return function(separationFn) {
      return function(inputTree) {
        var updateOffset = function(tr2) {
          return function(newOffset) {
            var v3 = head(tr2);
            var children3 = tail(tr2);
            return mkTree(new Tuple({
              offset: newOffset
            }, v3.value1))(children3);
          };
        };
        var renderWithContours = function(t2) {
          var val = head(t2);
          var children3 = tail(t2);
          var childCount = length(children3);
          if (childCount === 0) {
            return new Tuple(mkTree(new Tuple({
              offset: 0
            }, val))(Nil.value), singletonContours);
          }
          ;
          var childResults = map11(renderWithContours)(children3);
          var childTrees = map11(function(v3) {
            return v3.value0;
          })(childResults);
          var childRootData = map11(getRootData)(childTrees);
          var childContours = map11(function(v3) {
            return v3.value1;
          })(childResults);
          var baseSeparations = computeBaseSeparations(minSep)(separationFn)(childRootData);
          var separations = computeSeparationsWithBase(baseSeparations)(childContours);
          var childAbsoluteOffsets = new Cons(0, scanl2(add2)(0)(separations));
          var leftmostOffset = fromMaybe(0)(head2(fromFoldable5(childAbsoluteOffsets)));
          var rightmostOffset = fromMaybe(0)(last(fromFoldable5(childAbsoluteOffsets)));
          var parentOffset = (leftmostOffset + rightmostOffset) / 2;
          var childRelativeOffsets = map11(function(absOffset) {
            return absOffset - parentOffset;
          })(childAbsoluteOffsets);
          var childrenWithOffsets = zipWith(updateOffset)(childTrees)(childRelativeOffsets);
          var parentContours = spliceContours(childRelativeOffsets)(childContours);
          var resultTree = mkTree(new Tuple({
            offset: parentOffset
          }, val))(childrenWithOffsets);
          return new Tuple(resultTree, parentContours);
        };
        var v2 = renderWithContours(inputTree);
        return v2.value0;
      };
    };
  };
  var addHeightField = function(t2) {
    var val = head(t2);
    var children3 = tail(t2);
    var childrenWithHeight = map11(addHeightField)(children3);
    var nodeHeight = (function() {
      var v2 = fromFoldable5(childrenWithHeight);
      if (v2.length === 0) {
        return 0;
      }
      ;
      var childHeights = map13(function(c2) {
        return head(c2).height;
      })(v2);
      var maxChildHeight = fromMaybe(0)(maximum12(childHeights));
      return maxChildHeight + 1 | 0;
    })();
    return mkTree((function() {
      var $190 = {};
      for (var $191 in val) {
        if ({}.hasOwnProperty.call(val, $191)) {
          $190[$191] = val[$191];
        }
        ;
      }
      ;
      $190.height = nodeHeight;
      return $190;
    })())(childrenWithHeight);
  };
  var addDepth = function(currentDepth) {
    return function(t2) {
      var val = head(t2);
      var children3 = tail(t2);
      return mkTree((function() {
        var $193 = {};
        for (var $194 in val) {
          if ({}.hasOwnProperty.call(val, $194)) {
            $193[$194] = val[$194];
          }
          ;
        }
        ;
        $193.depth = currentDepth;
        return $193;
      })())(map11(addDepth(currentDepth + 1 | 0))(children3));
    };
  };
  var tree = function(config) {
    return function(inputTree) {
      var withDepth = addDepth(0)(inputTree);
      var rendered = render2(config.minSeparation)(config.separation)(withDepth);
      var withCoords = petrify(0)(rendered);
      var scaled = scaleToPixels2(config)(withCoords);
      return scaled;
    };
  };
  var treeWithSorting = function(config) {
    return function(inputTree) {
      var withDepth = addDepth(0)(inputTree);
      var withHeight = addHeightField(withDepth);
      var sorted = sortByHeight2(withHeight);
      var rendered = render2(config.minSeparation)(config.separation)(sorted);
      var withCoords = petrify(0)(rendered);
      var scaled = scaleToPixels2(config)(withCoords);
      return scaled;
    };
  };

  // output/PSD3.Expr.Interpreter.Eval/foreign.js
  var unsafeGetField = (name16) => (record) => record[name16];

  // output/PSD3.Expr.Interpreter.Eval/index.js
  var trigExprEvalD = {
    sin: function(v2) {
      return function(d) {
        return function(i2) {
          return sin(v2(d)(i2));
        };
      };
    },
    cos: function(v2) {
      return function(d) {
        return function(i2) {
          return cos(v2(d)(i2));
        };
      };
    },
    tan: function(v2) {
      return function(d) {
        return function(i2) {
          return tan(v2(d)(i2));
        };
      };
    },
    asin: function(v2) {
      return function(d) {
        return function(i2) {
          return asin(v2(d)(i2));
        };
      };
    },
    acos: function(v2) {
      return function(d) {
        return function(i2) {
          return acos(v2(d)(i2));
        };
      };
    },
    atan: function(v2) {
      return function(d) {
        return function(i2) {
          return atan(v2(d)(i2));
        };
      };
    },
    atan2: function(v2) {
      return function(v1) {
        return function(d) {
          return function(i2) {
            return atan2(v2(d)(i2))(v1(d)(i2));
          };
        };
      };
    },
    pi: function(v2) {
      return function(v1) {
        return pi;
      };
    }
  };
  var stringExprEvalD = {
    str: function(s3) {
      return function(v2) {
        return function(v1) {
          return s3;
        };
      };
    },
    concat: function(v2) {
      return function(v1) {
        return function(d) {
          return function(i2) {
            return v2(d)(i2) + v1(d)(i2);
          };
        };
      };
    }
  };
  var runEvalD = function(v2) {
    return function(d) {
      return function(i2) {
        return v2(d)(i2);
      };
    };
  };
  var numExprEvalD = {
    lit: function(n) {
      return function(v2) {
        return function(v1) {
          return n;
        };
      };
    },
    add: function(v2) {
      return function(v1) {
        return function(d) {
          return function(i2) {
            return v2(d)(i2) + v1(d)(i2);
          };
        };
      };
    },
    sub: function(v2) {
      return function(v1) {
        return function(d) {
          return function(i2) {
            return v2(d)(i2) - v1(d)(i2);
          };
        };
      };
    },
    mul: function(v2) {
      return function(v1) {
        return function(d) {
          return function(i2) {
            return v2(d)(i2) * v1(d)(i2);
          };
        };
      };
    },
    div: function(v2) {
      return function(v1) {
        return function(d) {
          return function(i2) {
            return v2(d)(i2) / v1(d)(i2);
          };
        };
      };
    },
    negate: function(v2) {
      return function(d) {
        return function(i2) {
          return -v2(d)(i2);
        };
      };
    }
  };
  var datumExprEvalD = {
    field: function(dictIsSymbol) {
      var reflectSymbol2 = reflectSymbol(dictIsSymbol);
      return function() {
        return function(proxy) {
          return function(d) {
            return function(v2) {
              return unsafeGetField(reflectSymbol2(proxy))(d);
            };
          };
        };
      };
    },
    index: function(v2) {
      return function(i2) {
        return i2;
      };
    }
  };
  var compareExprEvalD = {
    lt: function(v2) {
      return function(v1) {
        return function(d) {
          return function(i2) {
            return v2(d)(i2) < v1(d)(i2);
          };
        };
      };
    },
    lte: function(v2) {
      return function(v1) {
        return function(d) {
          return function(i2) {
            return v2(d)(i2) <= v1(d)(i2);
          };
        };
      };
    },
    gt: function(v2) {
      return function(v1) {
        return function(d) {
          return function(i2) {
            return v2(d)(i2) > v1(d)(i2);
          };
        };
      };
    },
    gte: function(v2) {
      return function(v1) {
        return function(d) {
          return function(i2) {
            return v2(d)(i2) >= v1(d)(i2);
          };
        };
      };
    },
    eq: function(v2) {
      return function(v1) {
        return function(d) {
          return function(i2) {
            return v2(d)(i2) === v1(d)(i2);
          };
        };
      };
    }
  };
  var boolExprEvalD = {
    bool: function(b10) {
      return function(v2) {
        return function(v1) {
          return b10;
        };
      };
    },
    and: function(v2) {
      return function(v1) {
        return function(d) {
          return function(i2) {
            return v2(d)(i2) && v1(d)(i2);
          };
        };
      };
    },
    or: function(v2) {
      return function(v1) {
        return function(d) {
          return function(i2) {
            return v2(d)(i2) || v1(d)(i2);
          };
        };
      };
    },
    not: function(v2) {
      return function(d) {
        return function(i2) {
          return !v2(d)(i2);
        };
      };
    },
    ifThenElse: function(v2) {
      return function(v1) {
        return function(v22) {
          return function(d) {
            return function(i2) {
              var $363 = v2(d)(i2);
              if ($363) {
                return v1(d)(i2);
              }
              ;
              return v22(d)(i2);
            };
          };
        };
      };
    }
  };

  // output/PSD3.Internal.Attribute/index.js
  var StringValue = /* @__PURE__ */ (function() {
    function StringValue2(value0) {
      this.value0 = value0;
    }
    ;
    StringValue2.create = function(value0) {
      return new StringValue2(value0);
    };
    return StringValue2;
  })();
  var NumberValue = /* @__PURE__ */ (function() {
    function NumberValue2(value0) {
      this.value0 = value0;
    }
    ;
    NumberValue2.create = function(value0) {
      return new NumberValue2(value0);
    };
    return NumberValue2;
  })();
  var BooleanValue = /* @__PURE__ */ (function() {
    function BooleanValue2(value0) {
      this.value0 = value0;
    }
    ;
    BooleanValue2.create = function(value0) {
      return new BooleanValue2(value0);
    };
    return BooleanValue2;
  })();
  var UnknownSource = /* @__PURE__ */ (function() {
    function UnknownSource2() {
    }
    ;
    UnknownSource2.value = new UnknownSource2();
    return UnknownSource2;
  })();
  var StaticSource = /* @__PURE__ */ (function() {
    function StaticSource2(value0) {
      this.value0 = value0;
    }
    ;
    StaticSource2.create = function(value0) {
      return new StaticSource2(value0);
    };
    return StaticSource2;
  })();
  var FieldSource = /* @__PURE__ */ (function() {
    function FieldSource2(value0) {
      this.value0 = value0;
    }
    ;
    FieldSource2.create = function(value0) {
      return new FieldSource2(value0);
    };
    return FieldSource2;
  })();
  var ExprSource = /* @__PURE__ */ (function() {
    function ExprSource2(value0) {
      this.value0 = value0;
    }
    ;
    ExprSource2.create = function(value0) {
      return new ExprSource2(value0);
    };
    return ExprSource2;
  })();
  var IndexSource = /* @__PURE__ */ (function() {
    function IndexSource2() {
    }
    ;
    IndexSource2.value = new IndexSource2();
    return IndexSource2;
  })();
  var StaticAttr = /* @__PURE__ */ (function() {
    function StaticAttr2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    StaticAttr2.create = function(value0) {
      return function(value1) {
        return new StaticAttr2(value0, value1);
      };
    };
    return StaticAttr2;
  })();
  var DataAttr = /* @__PURE__ */ (function() {
    function DataAttr2(value0, value1, value22) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
    }
    ;
    DataAttr2.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return new DataAttr2(value0, value1, value22);
        };
      };
    };
    return DataAttr2;
  })();
  var IndexedAttr = /* @__PURE__ */ (function() {
    function IndexedAttr2(value0, value1, value22) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
    }
    ;
    IndexedAttr2.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return new IndexedAttr2(value0, value1, value22);
        };
      };
    };
    return IndexedAttr2;
  })();

  // output/PSD3.Expr.Integration/index.js
  var v3StaticStr = function(name16) {
    return function(value20) {
      return new StaticAttr(name16, new StringValue(value20));
    };
  };
  var v3Static = function(dictShow) {
    var show87 = show(dictShow);
    return function(name16) {
      return function(value20) {
        return new StaticAttr(name16, new StringValue(show87(value20)));
      };
    };
  };
  var v3AttrStr = function(name16) {
    return function(expr) {
      return new DataAttr(name16, UnknownSource.value, function(d) {
        return new StringValue(runEvalD(expr)(d)(0));
      });
    };
  };
  var v3AttrFnStr = function(name16) {
    return function(f) {
      return new DataAttr(name16, UnknownSource.value, function(d) {
        return new StringValue(f(d));
      });
    };
  };
  var v3AttrFn = function(dictShow) {
    var show87 = show(dictShow);
    return function(name16) {
      return function(f) {
        return new DataAttr(name16, UnknownSource.value, function(d) {
          return new StringValue(show87(f(d)));
        });
      };
    };
  };
  var v3Attr = function(dictShow) {
    var show87 = show(dictShow);
    return function(name16) {
      return function(expr) {
        return new DataAttr(name16, UnknownSource.value, function(d) {
          return new StringValue(show87(runEvalD(expr)(d)(0)));
        });
      };
    };
  };

  // output/PSD3.Internal.Capabilities.Selection/index.js
  var updateJoin = function(dict) {
    return dict.updateJoin;
  };
  var setAttrs = function(dict) {
    return dict.setAttrs;
  };
  var select = function(dict) {
    return dict.select;
  };
  var renderTree = function(dict) {
    return dict.renderTree;
  };
  var remove = function(dict) {
    return dict.remove;
  };
  var openSelection = function(dict) {
    return dict.openSelection;
  };
  var on2 = function(dict) {
    return dict.on;
  };
  var clear = function(dict) {
    return dict.clear;
  };
  var appendChild = function(dict) {
    return dict.appendChild;
  };
  var append5 = function(dict) {
    return dict.append;
  };

  // output/PSD3.Internal.Capabilities.Transition/index.js
  var withTransitionStaggered = function(dict) {
    return dict.withTransitionStaggered;
  };
  var withTransition = function(dict) {
    return dict.withTransition;
  };
  var staggerByIndex = function(msPerElement) {
    return function(v2) {
      return function(i2) {
        return toNumber(i2) * msPerElement;
      };
    };
  };

  // output/PSD3.Internal.Selection.Types/index.js
  var EmptySelection = /* @__PURE__ */ (function() {
    function EmptySelection2(value0) {
      this.value0 = value0;
    }
    ;
    EmptySelection2.create = function(value0) {
      return new EmptySelection2(value0);
    };
    return EmptySelection2;
  })();
  var BoundSelection = /* @__PURE__ */ (function() {
    function BoundSelection2(value0) {
      this.value0 = value0;
    }
    ;
    BoundSelection2.create = function(value0) {
      return new BoundSelection2(value0);
    };
    return BoundSelection2;
  })();
  var PendingSelection = /* @__PURE__ */ (function() {
    function PendingSelection2(value0) {
      this.value0 = value0;
    }
    ;
    PendingSelection2.create = function(value0) {
      return new PendingSelection2(value0);
    };
    return PendingSelection2;
  })();
  var ExitingSelection = /* @__PURE__ */ (function() {
    function ExitingSelection2(value0) {
      this.value0 = value0;
    }
    ;
    ExitingSelection2.create = function(value0) {
      return new ExitingSelection2(value0);
    };
    return ExitingSelection2;
  })();
  var SVGContext = /* @__PURE__ */ (function() {
    function SVGContext2() {
    }
    ;
    SVGContext2.value = new SVGContext2();
    return SVGContext2;
  })();
  var HTMLContext = /* @__PURE__ */ (function() {
    function HTMLContext2() {
    }
    ;
    HTMLContext2.value = new HTMLContext2();
    return HTMLContext2;
  })();
  var JoinResult = /* @__PURE__ */ (function() {
    function JoinResult2(value0) {
      this.value0 = value0;
    }
    ;
    JoinResult2.create = function(value0) {
      return new JoinResult2(value0);
    };
    return JoinResult2;
  })();
  var Circle = /* @__PURE__ */ (function() {
    function Circle3() {
    }
    ;
    Circle3.value = new Circle3();
    return Circle3;
  })();
  var Rect = /* @__PURE__ */ (function() {
    function Rect2() {
    }
    ;
    Rect2.value = new Rect2();
    return Rect2;
  })();
  var Path = /* @__PURE__ */ (function() {
    function Path5() {
    }
    ;
    Path5.value = new Path5();
    return Path5;
  })();
  var Line = /* @__PURE__ */ (function() {
    function Line2() {
    }
    ;
    Line2.value = new Line2();
    return Line2;
  })();
  var Text = /* @__PURE__ */ (function() {
    function Text3() {
    }
    ;
    Text3.value = new Text3();
    return Text3;
  })();
  var Group = /* @__PURE__ */ (function() {
    function Group2() {
    }
    ;
    Group2.value = new Group2();
    return Group2;
  })();
  var SVG = /* @__PURE__ */ (function() {
    function SVG2() {
    }
    ;
    SVG2.value = new SVG2();
    return SVG2;
  })();
  var Defs = /* @__PURE__ */ (function() {
    function Defs2() {
    }
    ;
    Defs2.value = new Defs2();
    return Defs2;
  })();
  var LinearGradient = /* @__PURE__ */ (function() {
    function LinearGradient2() {
    }
    ;
    LinearGradient2.value = new LinearGradient2();
    return LinearGradient2;
  })();
  var Stop = /* @__PURE__ */ (function() {
    function Stop2() {
    }
    ;
    Stop2.value = new Stop2();
    return Stop2;
  })();
  var Div = /* @__PURE__ */ (function() {
    function Div2() {
    }
    ;
    Div2.value = new Div2();
    return Div2;
  })();
  var Span = /* @__PURE__ */ (function() {
    function Span2() {
    }
    ;
    Span2.value = new Span2();
    return Span2;
  })();
  var Table = /* @__PURE__ */ (function() {
    function Table2() {
    }
    ;
    Table2.value = new Table2();
    return Table2;
  })();
  var Tr = /* @__PURE__ */ (function() {
    function Tr2() {
    }
    ;
    Tr2.value = new Tr2();
    return Tr2;
  })();
  var Td = /* @__PURE__ */ (function() {
    function Td2() {
    }
    ;
    Td2.value = new Td2();
    return Td2;
  })();
  var Th = /* @__PURE__ */ (function() {
    function Th2() {
    }
    ;
    Th2.value = new Th2();
    return Th2;
  })();
  var Tbody = /* @__PURE__ */ (function() {
    function Tbody2() {
    }
    ;
    Tbody2.value = new Tbody2();
    return Tbody2;
  })();
  var Thead = /* @__PURE__ */ (function() {
    function Thead2() {
    }
    ;
    Thead2.value = new Thead2();
    return Thead2;
  })();
  var elementContext = function(v2) {
    if (v2 instanceof Circle) {
      return SVGContext.value;
    }
    ;
    if (v2 instanceof Rect) {
      return SVGContext.value;
    }
    ;
    if (v2 instanceof Path) {
      return SVGContext.value;
    }
    ;
    if (v2 instanceof Line) {
      return SVGContext.value;
    }
    ;
    if (v2 instanceof Text) {
      return SVGContext.value;
    }
    ;
    if (v2 instanceof Group) {
      return SVGContext.value;
    }
    ;
    if (v2 instanceof SVG) {
      return SVGContext.value;
    }
    ;
    if (v2 instanceof Defs) {
      return SVGContext.value;
    }
    ;
    if (v2 instanceof LinearGradient) {
      return SVGContext.value;
    }
    ;
    if (v2 instanceof Stop) {
      return SVGContext.value;
    }
    ;
    if (v2 instanceof Div) {
      return HTMLContext.value;
    }
    ;
    if (v2 instanceof Span) {
      return HTMLContext.value;
    }
    ;
    if (v2 instanceof Table) {
      return HTMLContext.value;
    }
    ;
    if (v2 instanceof Tr) {
      return HTMLContext.value;
    }
    ;
    if (v2 instanceof Td) {
      return HTMLContext.value;
    }
    ;
    if (v2 instanceof Th) {
      return HTMLContext.value;
    }
    ;
    if (v2 instanceof Tbody) {
      return HTMLContext.value;
    }
    ;
    if (v2 instanceof Thead) {
      return HTMLContext.value;
    }
    ;
    throw new Error("Failed pattern match at PSD3.Internal.Selection.Types (line 204, column 1 - line 204, column 47): " + [v2.constructor.name]);
  };

  // output/PSD3.Internal.Transition.Types/index.js
  var Linear = /* @__PURE__ */ (function() {
    function Linear3() {
    }
    ;
    Linear3.value = new Linear3();
    return Linear3;
  })();
  var Cubic = /* @__PURE__ */ (function() {
    function Cubic2() {
    }
    ;
    Cubic2.value = new Cubic2();
    return Cubic2;
  })();
  var CubicIn = /* @__PURE__ */ (function() {
    function CubicIn2() {
    }
    ;
    CubicIn2.value = new CubicIn2();
    return CubicIn2;
  })();
  var CubicOut = /* @__PURE__ */ (function() {
    function CubicOut2() {
    }
    ;
    CubicOut2.value = new CubicOut2();
    return CubicOut2;
  })();
  var CubicInOut = /* @__PURE__ */ (function() {
    function CubicInOut2() {
    }
    ;
    CubicInOut2.value = new CubicInOut2();
    return CubicInOut2;
  })();
  var Quad = /* @__PURE__ */ (function() {
    function Quad2() {
    }
    ;
    Quad2.value = new Quad2();
    return Quad2;
  })();
  var QuadIn = /* @__PURE__ */ (function() {
    function QuadIn2() {
    }
    ;
    QuadIn2.value = new QuadIn2();
    return QuadIn2;
  })();
  var QuadOut = /* @__PURE__ */ (function() {
    function QuadOut2() {
    }
    ;
    QuadOut2.value = new QuadOut2();
    return QuadOut2;
  })();
  var QuadInOut = /* @__PURE__ */ (function() {
    function QuadInOut2() {
    }
    ;
    QuadInOut2.value = new QuadInOut2();
    return QuadInOut2;
  })();
  var Sin = /* @__PURE__ */ (function() {
    function Sin2() {
    }
    ;
    Sin2.value = new Sin2();
    return Sin2;
  })();
  var SinIn = /* @__PURE__ */ (function() {
    function SinIn2() {
    }
    ;
    SinIn2.value = new SinIn2();
    return SinIn2;
  })();
  var SinOut = /* @__PURE__ */ (function() {
    function SinOut2() {
    }
    ;
    SinOut2.value = new SinOut2();
    return SinOut2;
  })();
  var SinInOut = /* @__PURE__ */ (function() {
    function SinInOut2() {
    }
    ;
    SinInOut2.value = new SinInOut2();
    return SinInOut2;
  })();
  var Exp = /* @__PURE__ */ (function() {
    function Exp2() {
    }
    ;
    Exp2.value = new Exp2();
    return Exp2;
  })();
  var ExpIn = /* @__PURE__ */ (function() {
    function ExpIn2() {
    }
    ;
    ExpIn2.value = new ExpIn2();
    return ExpIn2;
  })();
  var ExpOut = /* @__PURE__ */ (function() {
    function ExpOut2() {
    }
    ;
    ExpOut2.value = new ExpOut2();
    return ExpOut2;
  })();
  var ExpInOut = /* @__PURE__ */ (function() {
    function ExpInOut2() {
    }
    ;
    ExpInOut2.value = new ExpInOut2();
    return ExpInOut2;
  })();
  var Circle2 = /* @__PURE__ */ (function() {
    function Circle3() {
    }
    ;
    Circle3.value = new Circle3();
    return Circle3;
  })();
  var CircleIn = /* @__PURE__ */ (function() {
    function CircleIn2() {
    }
    ;
    CircleIn2.value = new CircleIn2();
    return CircleIn2;
  })();
  var CircleOut = /* @__PURE__ */ (function() {
    function CircleOut2() {
    }
    ;
    CircleOut2.value = new CircleOut2();
    return CircleOut2;
  })();
  var CircleInOut = /* @__PURE__ */ (function() {
    function CircleInOut2() {
    }
    ;
    CircleInOut2.value = new CircleInOut2();
    return CircleInOut2;
  })();
  var Elastic = /* @__PURE__ */ (function() {
    function Elastic2() {
    }
    ;
    Elastic2.value = new Elastic2();
    return Elastic2;
  })();
  var ElasticIn = /* @__PURE__ */ (function() {
    function ElasticIn2() {
    }
    ;
    ElasticIn2.value = new ElasticIn2();
    return ElasticIn2;
  })();
  var ElasticOut = /* @__PURE__ */ (function() {
    function ElasticOut2() {
    }
    ;
    ElasticOut2.value = new ElasticOut2();
    return ElasticOut2;
  })();
  var ElasticInOut = /* @__PURE__ */ (function() {
    function ElasticInOut2() {
    }
    ;
    ElasticInOut2.value = new ElasticInOut2();
    return ElasticInOut2;
  })();
  var Back = /* @__PURE__ */ (function() {
    function Back2() {
    }
    ;
    Back2.value = new Back2();
    return Back2;
  })();
  var BackIn = /* @__PURE__ */ (function() {
    function BackIn2() {
    }
    ;
    BackIn2.value = new BackIn2();
    return BackIn2;
  })();
  var BackOut = /* @__PURE__ */ (function() {
    function BackOut2() {
    }
    ;
    BackOut2.value = new BackOut2();
    return BackOut2;
  })();
  var BackInOut = /* @__PURE__ */ (function() {
    function BackInOut2() {
    }
    ;
    BackInOut2.value = new BackInOut2();
    return BackInOut2;
  })();
  var Bounce = /* @__PURE__ */ (function() {
    function Bounce2() {
    }
    ;
    Bounce2.value = new Bounce2();
    return Bounce2;
  })();
  var BounceIn = /* @__PURE__ */ (function() {
    function BounceIn2() {
    }
    ;
    BounceIn2.value = new BounceIn2();
    return BounceIn2;
  })();
  var BounceOut = /* @__PURE__ */ (function() {
    function BounceOut2() {
    }
    ;
    BounceOut2.value = new BounceOut2();
    return BounceOut2;
  })();
  var BounceInOut = /* @__PURE__ */ (function() {
    function BounceInOut2() {
    }
    ;
    BounceInOut2.value = new BounceInOut2();
    return BounceInOut2;
  })();
  var showEasing = {
    show: function(v2) {
      if (v2 instanceof Linear) {
        return "linear";
      }
      ;
      if (v2 instanceof Cubic) {
        return "cubic";
      }
      ;
      if (v2 instanceof CubicIn) {
        return "cubicIn";
      }
      ;
      if (v2 instanceof CubicOut) {
        return "cubicOut";
      }
      ;
      if (v2 instanceof CubicInOut) {
        return "cubicInOut";
      }
      ;
      if (v2 instanceof Quad) {
        return "quad";
      }
      ;
      if (v2 instanceof QuadIn) {
        return "quadIn";
      }
      ;
      if (v2 instanceof QuadOut) {
        return "quadOut";
      }
      ;
      if (v2 instanceof QuadInOut) {
        return "quadInOut";
      }
      ;
      if (v2 instanceof Sin) {
        return "sin";
      }
      ;
      if (v2 instanceof SinIn) {
        return "sinIn";
      }
      ;
      if (v2 instanceof SinOut) {
        return "sinOut";
      }
      ;
      if (v2 instanceof SinInOut) {
        return "sinInOut";
      }
      ;
      if (v2 instanceof Exp) {
        return "exp";
      }
      ;
      if (v2 instanceof ExpIn) {
        return "expIn";
      }
      ;
      if (v2 instanceof ExpOut) {
        return "expOut";
      }
      ;
      if (v2 instanceof ExpInOut) {
        return "expInOut";
      }
      ;
      if (v2 instanceof Circle2) {
        return "circle";
      }
      ;
      if (v2 instanceof CircleIn) {
        return "circleIn";
      }
      ;
      if (v2 instanceof CircleOut) {
        return "circleOut";
      }
      ;
      if (v2 instanceof CircleInOut) {
        return "circleInOut";
      }
      ;
      if (v2 instanceof Elastic) {
        return "elastic";
      }
      ;
      if (v2 instanceof ElasticIn) {
        return "elasticIn";
      }
      ;
      if (v2 instanceof ElasticOut) {
        return "elasticOut";
      }
      ;
      if (v2 instanceof ElasticInOut) {
        return "elasticInOut";
      }
      ;
      if (v2 instanceof Back) {
        return "back";
      }
      ;
      if (v2 instanceof BackIn) {
        return "backIn";
      }
      ;
      if (v2 instanceof BackOut) {
        return "backOut";
      }
      ;
      if (v2 instanceof BackInOut) {
        return "backInOut";
      }
      ;
      if (v2 instanceof Bounce) {
        return "bounce";
      }
      ;
      if (v2 instanceof BounceIn) {
        return "bounceIn";
      }
      ;
      if (v2 instanceof BounceOut) {
        return "bounceOut";
      }
      ;
      if (v2 instanceof BounceInOut) {
        return "bounceInOut";
      }
      ;
      throw new Error("Failed pattern match at PSD3.Internal.Transition.Types (line 91, column 1 - line 124, column 35): " + [v2.constructor.name]);
    }
  };
  var transitionWith = /* @__PURE__ */ identity(categoryFn);
  var transition = function(duration2) {
    return {
      duration: duration2,
      delay: Nothing.value,
      staggerDelay: Nothing.value,
      easing: Nothing.value
    };
  };
  var staggeredTransition = function(duration2) {
    return function(staggerMs) {
      return {
        duration: duration2,
        delay: Nothing.value,
        staggerDelay: new Just(staggerMs),
        easing: Nothing.value
      };
    };
  };

  // output/Data.Map.Internal/index.js
  var $runtime_lazy4 = function(name16, moduleName, init4) {
    var state3 = 0;
    var val;
    return function(lineNumber) {
      if (state3 === 2) return val;
      if (state3 === 1) throw new ReferenceError(name16 + " was needed before it finished initializing (module " + moduleName + ", line " + lineNumber + ")", moduleName, lineNumber);
      state3 = 1;
      val = init4();
      state3 = 2;
      return val;
    };
  };
  var map14 = /* @__PURE__ */ map(functorMaybe);
  var Leaf = /* @__PURE__ */ (function() {
    function Leaf2() {
    }
    ;
    Leaf2.value = new Leaf2();
    return Leaf2;
  })();
  var Node = /* @__PURE__ */ (function() {
    function Node3(value0, value1, value22, value32, value42, value52) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
      this.value3 = value32;
      this.value4 = value42;
      this.value5 = value52;
    }
    ;
    Node3.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return function(value32) {
            return function(value42) {
              return function(value52) {
                return new Node3(value0, value1, value22, value32, value42, value52);
              };
            };
          };
        };
      };
    };
    return Node3;
  })();
  var IterLeaf = /* @__PURE__ */ (function() {
    function IterLeaf2() {
    }
    ;
    IterLeaf2.value = new IterLeaf2();
    return IterLeaf2;
  })();
  var IterEmit = /* @__PURE__ */ (function() {
    function IterEmit2(value0, value1, value22) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
    }
    ;
    IterEmit2.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return new IterEmit2(value0, value1, value22);
        };
      };
    };
    return IterEmit2;
  })();
  var IterNode = /* @__PURE__ */ (function() {
    function IterNode2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    IterNode2.create = function(value0) {
      return function(value1) {
        return new IterNode2(value0, value1);
      };
    };
    return IterNode2;
  })();
  var IterDone = /* @__PURE__ */ (function() {
    function IterDone2() {
    }
    ;
    IterDone2.value = new IterDone2();
    return IterDone2;
  })();
  var IterNext = /* @__PURE__ */ (function() {
    function IterNext2(value0, value1, value22) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
    }
    ;
    IterNext2.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return new IterNext2(value0, value1, value22);
        };
      };
    };
    return IterNext2;
  })();
  var Split = /* @__PURE__ */ (function() {
    function Split2(value0, value1, value22) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
    }
    ;
    Split2.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return new Split2(value0, value1, value22);
        };
      };
    };
    return Split2;
  })();
  var SplitLast = /* @__PURE__ */ (function() {
    function SplitLast2(value0, value1, value22) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
    }
    ;
    SplitLast2.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return new SplitLast2(value0, value1, value22);
        };
      };
    };
    return SplitLast2;
  })();
  var unsafeNode = function(k, v2, l2, r29) {
    if (l2 instanceof Leaf) {
      if (r29 instanceof Leaf) {
        return new Node(1, 1, k, v2, l2, r29);
      }
      ;
      if (r29 instanceof Node) {
        return new Node(1 + r29.value0 | 0, 1 + r29.value1 | 0, k, v2, l2, r29);
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 702, column 5 - line 706, column 39): " + [r29.constructor.name]);
    }
    ;
    if (l2 instanceof Node) {
      if (r29 instanceof Leaf) {
        return new Node(1 + l2.value0 | 0, 1 + l2.value1 | 0, k, v2, l2, r29);
      }
      ;
      if (r29 instanceof Node) {
        return new Node(1 + (function() {
          var $280 = l2.value0 > r29.value0;
          if ($280) {
            return l2.value0;
          }
          ;
          return r29.value0;
        })() | 0, (1 + l2.value1 | 0) + r29.value1 | 0, k, v2, l2, r29);
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 708, column 5 - line 712, column 68): " + [r29.constructor.name]);
    }
    ;
    throw new Error("Failed pattern match at Data.Map.Internal (line 700, column 32 - line 712, column 68): " + [l2.constructor.name]);
  };
  var toMapIter = /* @__PURE__ */ (function() {
    return flip(IterNode.create)(IterLeaf.value);
  })();
  var stepWith = function(f) {
    return function(next2) {
      return function(done) {
        var go2 = function($copy_v) {
          var $tco_done = false;
          var $tco_result;
          function $tco_loop(v2) {
            if (v2 instanceof IterLeaf) {
              $tco_done = true;
              return done(unit);
            }
            ;
            if (v2 instanceof IterEmit) {
              $tco_done = true;
              return next2(v2.value0, v2.value1, v2.value2);
            }
            ;
            if (v2 instanceof IterNode) {
              $copy_v = f(v2.value1)(v2.value0);
              return;
            }
            ;
            throw new Error("Failed pattern match at Data.Map.Internal (line 940, column 8 - line 946, column 20): " + [v2.constructor.name]);
          }
          ;
          while (!$tco_done) {
            $tco_result = $tco_loop($copy_v);
          }
          ;
          return $tco_result;
        };
        return go2;
      };
    };
  };
  var size = function(v2) {
    if (v2 instanceof Leaf) {
      return 0;
    }
    ;
    if (v2 instanceof Node) {
      return v2.value1;
    }
    ;
    throw new Error("Failed pattern match at Data.Map.Internal (line 618, column 8 - line 620, column 24): " + [v2.constructor.name]);
  };
  var singleton6 = function(k) {
    return function(v2) {
      return new Node(1, 1, k, v2, Leaf.value, Leaf.value);
    };
  };
  var unsafeBalancedNode = /* @__PURE__ */ (function() {
    var height47 = function(v2) {
      if (v2 instanceof Leaf) {
        return 0;
      }
      ;
      if (v2 instanceof Node) {
        return v2.value0;
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 757, column 12 - line 759, column 26): " + [v2.constructor.name]);
    };
    var rotateLeft = function(k, v2, l2, rk, rv, rl, rr) {
      if (rl instanceof Node && rl.value0 > height47(rr)) {
        return unsafeNode(rl.value2, rl.value3, unsafeNode(k, v2, l2, rl.value4), unsafeNode(rk, rv, rl.value5, rr));
      }
      ;
      return unsafeNode(rk, rv, unsafeNode(k, v2, l2, rl), rr);
    };
    var rotateRight = function(k, v2, lk, lv, ll, lr, r29) {
      if (lr instanceof Node && height47(ll) <= lr.value0) {
        return unsafeNode(lr.value2, lr.value3, unsafeNode(lk, lv, ll, lr.value4), unsafeNode(k, v2, lr.value5, r29));
      }
      ;
      return unsafeNode(lk, lv, ll, unsafeNode(k, v2, lr, r29));
    };
    return function(k, v2, l2, r29) {
      if (l2 instanceof Leaf) {
        if (r29 instanceof Leaf) {
          return singleton6(k)(v2);
        }
        ;
        if (r29 instanceof Node && r29.value0 > 1) {
          return rotateLeft(k, v2, l2, r29.value2, r29.value3, r29.value4, r29.value5);
        }
        ;
        return unsafeNode(k, v2, l2, r29);
      }
      ;
      if (l2 instanceof Node) {
        if (r29 instanceof Node) {
          if (r29.value0 > (l2.value0 + 1 | 0)) {
            return rotateLeft(k, v2, l2, r29.value2, r29.value3, r29.value4, r29.value5);
          }
          ;
          if (l2.value0 > (r29.value0 + 1 | 0)) {
            return rotateRight(k, v2, l2.value2, l2.value3, l2.value4, l2.value5, r29);
          }
          ;
        }
        ;
        if (r29 instanceof Leaf && l2.value0 > 1) {
          return rotateRight(k, v2, l2.value2, l2.value3, l2.value4, l2.value5, r29);
        }
        ;
        return unsafeNode(k, v2, l2, r29);
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 717, column 40 - line 738, column 34): " + [l2.constructor.name]);
    };
  })();
  var $lazy_unsafeSplit = /* @__PURE__ */ $runtime_lazy4("unsafeSplit", "Data.Map.Internal", function() {
    return function(comp, k, m2) {
      if (m2 instanceof Leaf) {
        return new Split(Nothing.value, Leaf.value, Leaf.value);
      }
      ;
      if (m2 instanceof Node) {
        var v2 = comp(k)(m2.value2);
        if (v2 instanceof LT) {
          var v1 = $lazy_unsafeSplit(793)(comp, k, m2.value4);
          return new Split(v1.value0, v1.value1, unsafeBalancedNode(m2.value2, m2.value3, v1.value2, m2.value5));
        }
        ;
        if (v2 instanceof GT) {
          var v1 = $lazy_unsafeSplit(796)(comp, k, m2.value5);
          return new Split(v1.value0, unsafeBalancedNode(m2.value2, m2.value3, m2.value4, v1.value1), v1.value2);
        }
        ;
        if (v2 instanceof EQ) {
          return new Split(new Just(m2.value3), m2.value4, m2.value5);
        }
        ;
        throw new Error("Failed pattern match at Data.Map.Internal (line 791, column 5 - line 799, column 30): " + [v2.constructor.name]);
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 787, column 34 - line 799, column 30): " + [m2.constructor.name]);
    };
  });
  var unsafeSplit = /* @__PURE__ */ $lazy_unsafeSplit(786);
  var $lazy_unsafeSplitLast = /* @__PURE__ */ $runtime_lazy4("unsafeSplitLast", "Data.Map.Internal", function() {
    return function(k, v2, l2, r29) {
      if (r29 instanceof Leaf) {
        return new SplitLast(k, v2, l2);
      }
      ;
      if (r29 instanceof Node) {
        var v1 = $lazy_unsafeSplitLast(779)(r29.value2, r29.value3, r29.value4, r29.value5);
        return new SplitLast(v1.value0, v1.value1, unsafeBalancedNode(k, v2, l2, v1.value2));
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 776, column 37 - line 780, column 57): " + [r29.constructor.name]);
    };
  });
  var unsafeSplitLast = /* @__PURE__ */ $lazy_unsafeSplitLast(775);
  var unsafeJoinNodes = function(v2, v1) {
    if (v2 instanceof Leaf) {
      return v1;
    }
    ;
    if (v2 instanceof Node) {
      var v22 = unsafeSplitLast(v2.value2, v2.value3, v2.value4, v2.value5);
      return unsafeBalancedNode(v22.value0, v22.value1, v22.value2, v1);
    }
    ;
    throw new Error("Failed pattern match at Data.Map.Internal (line 764, column 25 - line 768, column 38): " + [v2.constructor.name, v1.constructor.name]);
  };
  var $lazy_unsafeDifference = /* @__PURE__ */ $runtime_lazy4("unsafeDifference", "Data.Map.Internal", function() {
    return function(comp, l2, r29) {
      if (l2 instanceof Leaf) {
        return Leaf.value;
      }
      ;
      if (r29 instanceof Leaf) {
        return l2;
      }
      ;
      if (r29 instanceof Node) {
        var v2 = unsafeSplit(comp, r29.value2, l2);
        var l$prime = $lazy_unsafeDifference(841)(comp, v2.value1, r29.value4);
        var r$prime = $lazy_unsafeDifference(842)(comp, v2.value2, r29.value5);
        return unsafeJoinNodes(l$prime, r$prime);
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 836, column 39 - line 843, column 33): " + [l2.constructor.name, r29.constructor.name]);
    };
  });
  var unsafeDifference = /* @__PURE__ */ $lazy_unsafeDifference(835);
  var $lazy_unsafeIntersectionWith = /* @__PURE__ */ $runtime_lazy4("unsafeIntersectionWith", "Data.Map.Internal", function() {
    return function(comp, app, l2, r29) {
      if (l2 instanceof Leaf) {
        return Leaf.value;
      }
      ;
      if (r29 instanceof Leaf) {
        return Leaf.value;
      }
      ;
      if (r29 instanceof Node) {
        var v2 = unsafeSplit(comp, r29.value2, l2);
        var l$prime = $lazy_unsafeIntersectionWith(825)(comp, app, v2.value1, r29.value4);
        var r$prime = $lazy_unsafeIntersectionWith(826)(comp, app, v2.value2, r29.value5);
        if (v2.value0 instanceof Just) {
          return unsafeBalancedNode(r29.value2, app(v2.value0.value0)(r29.value3), l$prime, r$prime);
        }
        ;
        if (v2.value0 instanceof Nothing) {
          return unsafeJoinNodes(l$prime, r$prime);
        }
        ;
        throw new Error("Failed pattern match at Data.Map.Internal (line 827, column 5 - line 831, column 37): " + [v2.value0.constructor.name]);
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 820, column 49 - line 831, column 37): " + [l2.constructor.name, r29.constructor.name]);
    };
  });
  var unsafeIntersectionWith = /* @__PURE__ */ $lazy_unsafeIntersectionWith(819);
  var $lazy_unsafeUnionWith = /* @__PURE__ */ $runtime_lazy4("unsafeUnionWith", "Data.Map.Internal", function() {
    return function(comp, app, l2, r29) {
      if (l2 instanceof Leaf) {
        return r29;
      }
      ;
      if (r29 instanceof Leaf) {
        return l2;
      }
      ;
      if (r29 instanceof Node) {
        var v2 = unsafeSplit(comp, r29.value2, l2);
        var l$prime = $lazy_unsafeUnionWith(809)(comp, app, v2.value1, r29.value4);
        var r$prime = $lazy_unsafeUnionWith(810)(comp, app, v2.value2, r29.value5);
        if (v2.value0 instanceof Just) {
          return unsafeBalancedNode(r29.value2, app(v2.value0.value0)(r29.value3), l$prime, r$prime);
        }
        ;
        if (v2.value0 instanceof Nothing) {
          return unsafeBalancedNode(r29.value2, r29.value3, l$prime, r$prime);
        }
        ;
        throw new Error("Failed pattern match at Data.Map.Internal (line 811, column 5 - line 815, column 46): " + [v2.value0.constructor.name]);
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 804, column 42 - line 815, column 46): " + [l2.constructor.name, r29.constructor.name]);
    };
  });
  var unsafeUnionWith = /* @__PURE__ */ $lazy_unsafeUnionWith(803);
  var unionWith = function(dictOrd) {
    var compare24 = compare(dictOrd);
    return function(app) {
      return function(m1) {
        return function(m2) {
          return unsafeUnionWith(compare24, app, m1, m2);
        };
      };
    };
  };
  var union = function(dictOrd) {
    return unionWith(dictOrd)($$const);
  };
  var pop = function(dictOrd) {
    var compare24 = compare(dictOrd);
    return function(k) {
      return function(m2) {
        var v2 = unsafeSplit(compare24, k, m2);
        return map14(function(a3) {
          return new Tuple(a3, unsafeJoinNodes(v2.value1, v2.value2));
        })(v2.value0);
      };
    };
  };
  var member = function(dictOrd) {
    var compare24 = compare(dictOrd);
    return function(k) {
      var go2 = function($copy_v) {
        var $tco_done = false;
        var $tco_result;
        function $tco_loop(v2) {
          if (v2 instanceof Leaf) {
            $tco_done = true;
            return false;
          }
          ;
          if (v2 instanceof Node) {
            var v1 = compare24(k)(v2.value2);
            if (v1 instanceof LT) {
              $copy_v = v2.value4;
              return;
            }
            ;
            if (v1 instanceof GT) {
              $copy_v = v2.value5;
              return;
            }
            ;
            if (v1 instanceof EQ) {
              $tco_done = true;
              return true;
            }
            ;
            throw new Error("Failed pattern match at Data.Map.Internal (line 459, column 7 - line 462, column 19): " + [v1.constructor.name]);
          }
          ;
          throw new Error("Failed pattern match at Data.Map.Internal (line 456, column 8 - line 462, column 19): " + [v2.constructor.name]);
        }
        ;
        while (!$tco_done) {
          $tco_result = $tco_loop($copy_v);
        }
        ;
        return $tco_result;
      };
      return go2;
    };
  };
  var lookup = function(dictOrd) {
    var compare24 = compare(dictOrd);
    return function(k) {
      var go2 = function($copy_v) {
        var $tco_done = false;
        var $tco_result;
        function $tco_loop(v2) {
          if (v2 instanceof Leaf) {
            $tco_done = true;
            return Nothing.value;
          }
          ;
          if (v2 instanceof Node) {
            var v1 = compare24(k)(v2.value2);
            if (v1 instanceof LT) {
              $copy_v = v2.value4;
              return;
            }
            ;
            if (v1 instanceof GT) {
              $copy_v = v2.value5;
              return;
            }
            ;
            if (v1 instanceof EQ) {
              $tco_done = true;
              return new Just(v2.value3);
            }
            ;
            throw new Error("Failed pattern match at Data.Map.Internal (line 283, column 7 - line 286, column 22): " + [v1.constructor.name]);
          }
          ;
          throw new Error("Failed pattern match at Data.Map.Internal (line 280, column 8 - line 286, column 22): " + [v2.constructor.name]);
        }
        ;
        while (!$tco_done) {
          $tco_result = $tco_loop($copy_v);
        }
        ;
        return $tco_result;
      };
      return go2;
    };
  };
  var iterMapL = /* @__PURE__ */ (function() {
    var go2 = function($copy_iter) {
      return function($copy_v) {
        var $tco_var_iter = $copy_iter;
        var $tco_done = false;
        var $tco_result;
        function $tco_loop(iter, v2) {
          if (v2 instanceof Leaf) {
            $tco_done = true;
            return iter;
          }
          ;
          if (v2 instanceof Node) {
            if (v2.value5 instanceof Leaf) {
              $tco_var_iter = new IterEmit(v2.value2, v2.value3, iter);
              $copy_v = v2.value4;
              return;
            }
            ;
            $tco_var_iter = new IterEmit(v2.value2, v2.value3, new IterNode(v2.value5, iter));
            $copy_v = v2.value4;
            return;
          }
          ;
          throw new Error("Failed pattern match at Data.Map.Internal (line 951, column 13 - line 958, column 48): " + [v2.constructor.name]);
        }
        ;
        while (!$tco_done) {
          $tco_result = $tco_loop($tco_var_iter, $copy_v);
        }
        ;
        return $tco_result;
      };
    };
    return go2;
  })();
  var stepAscCps = /* @__PURE__ */ stepWith(iterMapL);
  var stepAsc = /* @__PURE__ */ (function() {
    return stepAscCps(function(k, v2, next2) {
      return new IterNext(k, v2, next2);
    })($$const(IterDone.value));
  })();
  var eqMapIter = function(dictEq) {
    var eq111 = eq(dictEq);
    return function(dictEq1) {
      var eq27 = eq(dictEq1);
      return {
        eq: /* @__PURE__ */ (function() {
          var go2 = function($copy_a) {
            return function($copy_b) {
              var $tco_var_a = $copy_a;
              var $tco_done = false;
              var $tco_result;
              function $tco_loop(a3, b10) {
                var v2 = stepAsc(a3);
                if (v2 instanceof IterNext) {
                  var v22 = stepAsc(b10);
                  if (v22 instanceof IterNext && (eq111(v2.value0)(v22.value0) && eq27(v2.value1)(v22.value1))) {
                    $tco_var_a = v2.value2;
                    $copy_b = v22.value2;
                    return;
                  }
                  ;
                  $tco_done = true;
                  return false;
                }
                ;
                if (v2 instanceof IterDone) {
                  $tco_done = true;
                  return true;
                }
                ;
                throw new Error("Failed pattern match at Data.Map.Internal (line 859, column 14 - line 868, column 13): " + [v2.constructor.name]);
              }
              ;
              while (!$tco_done) {
                $tco_result = $tco_loop($tco_var_a, $copy_b);
              }
              ;
              return $tco_result;
            };
          };
          return go2;
        })()
      };
    };
  };
  var stepUnfoldr = /* @__PURE__ */ (function() {
    var step5 = function(k, v2, next2) {
      return new Just(new Tuple(new Tuple(k, v2), next2));
    };
    return stepAscCps(step5)(function(v2) {
      return Nothing.value;
    });
  })();
  var toUnfoldable2 = function(dictUnfoldable) {
    var $784 = unfoldr(dictUnfoldable)(stepUnfoldr);
    return function($785) {
      return $784(toMapIter($785));
    };
  };
  var isEmpty = function(v2) {
    if (v2 instanceof Leaf) {
      return true;
    }
    ;
    return false;
  };
  var intersectionWith = function(dictOrd) {
    var compare24 = compare(dictOrd);
    return function(app) {
      return function(m1) {
        return function(m2) {
          return unsafeIntersectionWith(compare24, app, m1, m2);
        };
      };
    };
  };
  var intersection = function(dictOrd) {
    return intersectionWith(dictOrd)($$const);
  };
  var insertWith = function(dictOrd) {
    var compare24 = compare(dictOrd);
    return function(app) {
      return function(k) {
        return function(v2) {
          var go2 = function(v1) {
            if (v1 instanceof Leaf) {
              return singleton6(k)(v2);
            }
            ;
            if (v1 instanceof Node) {
              var v22 = compare24(k)(v1.value2);
              if (v22 instanceof LT) {
                return unsafeBalancedNode(v1.value2, v1.value3, go2(v1.value4), v1.value5);
              }
              ;
              if (v22 instanceof GT) {
                return unsafeBalancedNode(v1.value2, v1.value3, v1.value4, go2(v1.value5));
              }
              ;
              if (v22 instanceof EQ) {
                return new Node(v1.value0, v1.value1, k, app(v1.value3)(v2), v1.value4, v1.value5);
              }
              ;
              throw new Error("Failed pattern match at Data.Map.Internal (line 486, column 7 - line 489, column 44): " + [v22.constructor.name]);
            }
            ;
            throw new Error("Failed pattern match at Data.Map.Internal (line 483, column 8 - line 489, column 44): " + [v1.constructor.name]);
          };
          return go2;
        };
      };
    };
  };
  var insert = function(dictOrd) {
    var compare24 = compare(dictOrd);
    return function(k) {
      return function(v2) {
        var go2 = function(v1) {
          if (v1 instanceof Leaf) {
            return singleton6(k)(v2);
          }
          ;
          if (v1 instanceof Node) {
            var v22 = compare24(k)(v1.value2);
            if (v22 instanceof LT) {
              return unsafeBalancedNode(v1.value2, v1.value3, go2(v1.value4), v1.value5);
            }
            ;
            if (v22 instanceof GT) {
              return unsafeBalancedNode(v1.value2, v1.value3, v1.value4, go2(v1.value5));
            }
            ;
            if (v22 instanceof EQ) {
              return new Node(v1.value0, v1.value1, k, v2, v1.value4, v1.value5);
            }
            ;
            throw new Error("Failed pattern match at Data.Map.Internal (line 471, column 7 - line 474, column 35): " + [v22.constructor.name]);
          }
          ;
          throw new Error("Failed pattern match at Data.Map.Internal (line 468, column 8 - line 474, column 35): " + [v1.constructor.name]);
        };
        return go2;
      };
    };
  };
  var functorMap = {
    map: function(f) {
      var go2 = function(v2) {
        if (v2 instanceof Leaf) {
          return Leaf.value;
        }
        ;
        if (v2 instanceof Node) {
          return new Node(v2.value0, v2.value1, v2.value2, f(v2.value3), go2(v2.value4), go2(v2.value5));
        }
        ;
        throw new Error("Failed pattern match at Data.Map.Internal (line 147, column 10 - line 150, column 39): " + [v2.constructor.name]);
      };
      return go2;
    }
  };
  var foldableMap = {
    foldr: function(f) {
      return function(z2) {
        var $lazy_go = $runtime_lazy4("go", "Data.Map.Internal", function() {
          return function(m$prime, z$prime) {
            if (m$prime instanceof Leaf) {
              return z$prime;
            }
            ;
            if (m$prime instanceof Node) {
              return $lazy_go(172)(m$prime.value4, f(m$prime.value3)($lazy_go(172)(m$prime.value5, z$prime)));
            }
            ;
            throw new Error("Failed pattern match at Data.Map.Internal (line 169, column 26 - line 172, column 43): " + [m$prime.constructor.name]);
          };
        });
        var go2 = $lazy_go(169);
        return function(m2) {
          return go2(m2, z2);
        };
      };
    },
    foldl: function(f) {
      return function(z2) {
        var $lazy_go = $runtime_lazy4("go", "Data.Map.Internal", function() {
          return function(z$prime, m$prime) {
            if (m$prime instanceof Leaf) {
              return z$prime;
            }
            ;
            if (m$prime instanceof Node) {
              return $lazy_go(178)(f($lazy_go(178)(z$prime, m$prime.value4))(m$prime.value3), m$prime.value5);
            }
            ;
            throw new Error("Failed pattern match at Data.Map.Internal (line 175, column 26 - line 178, column 43): " + [m$prime.constructor.name]);
          };
        });
        var go2 = $lazy_go(175);
        return function(m2) {
          return go2(z2, m2);
        };
      };
    },
    foldMap: function(dictMonoid) {
      var mempty3 = mempty(dictMonoid);
      var append128 = append(dictMonoid.Semigroup0());
      return function(f) {
        var go2 = function(v2) {
          if (v2 instanceof Leaf) {
            return mempty3;
          }
          ;
          if (v2 instanceof Node) {
            return append128(go2(v2.value4))(append128(f(v2.value3))(go2(v2.value5)));
          }
          ;
          throw new Error("Failed pattern match at Data.Map.Internal (line 181, column 10 - line 184, column 28): " + [v2.constructor.name]);
        };
        return go2;
      };
    }
  };
  var foldableWithIndexMap = {
    foldrWithIndex: function(f) {
      return function(z2) {
        var $lazy_go = $runtime_lazy4("go", "Data.Map.Internal", function() {
          return function(m$prime, z$prime) {
            if (m$prime instanceof Leaf) {
              return z$prime;
            }
            ;
            if (m$prime instanceof Node) {
              return $lazy_go(192)(m$prime.value4, f(m$prime.value2)(m$prime.value3)($lazy_go(192)(m$prime.value5, z$prime)));
            }
            ;
            throw new Error("Failed pattern match at Data.Map.Internal (line 189, column 26 - line 192, column 45): " + [m$prime.constructor.name]);
          };
        });
        var go2 = $lazy_go(189);
        return function(m2) {
          return go2(m2, z2);
        };
      };
    },
    foldlWithIndex: function(f) {
      return function(z2) {
        var $lazy_go = $runtime_lazy4("go", "Data.Map.Internal", function() {
          return function(z$prime, m$prime) {
            if (m$prime instanceof Leaf) {
              return z$prime;
            }
            ;
            if (m$prime instanceof Node) {
              return $lazy_go(198)(f(m$prime.value2)($lazy_go(198)(z$prime, m$prime.value4))(m$prime.value3), m$prime.value5);
            }
            ;
            throw new Error("Failed pattern match at Data.Map.Internal (line 195, column 26 - line 198, column 45): " + [m$prime.constructor.name]);
          };
        });
        var go2 = $lazy_go(195);
        return function(m2) {
          return go2(z2, m2);
        };
      };
    },
    foldMapWithIndex: function(dictMonoid) {
      var mempty3 = mempty(dictMonoid);
      var append128 = append(dictMonoid.Semigroup0());
      return function(f) {
        var go2 = function(v2) {
          if (v2 instanceof Leaf) {
            return mempty3;
          }
          ;
          if (v2 instanceof Node) {
            return append128(go2(v2.value4))(append128(f(v2.value2)(v2.value3))(go2(v2.value5)));
          }
          ;
          throw new Error("Failed pattern match at Data.Map.Internal (line 201, column 10 - line 204, column 30): " + [v2.constructor.name]);
        };
        return go2;
      };
    },
    Foldable0: function() {
      return foldableMap;
    }
  };
  var keys = /* @__PURE__ */ (function() {
    return foldrWithIndex(foldableWithIndexMap)(function(k) {
      return function(v2) {
        return function(acc) {
          return new Cons(k, acc);
        };
      };
    })(Nil.value);
  })();
  var values = /* @__PURE__ */ (function() {
    return foldr(foldableMap)(Cons.create)(Nil.value);
  })();
  var findMin = function($copy_v) {
    var $tco_done = false;
    var $tco_result;
    function $tco_loop(v2) {
      if (v2 instanceof Leaf) {
        $tco_done = true;
        return Nothing.value;
      }
      ;
      if (v2 instanceof Node) {
        if (v2.value4 instanceof Leaf) {
          $tco_done = true;
          return new Just({
            key: v2.value2,
            value: v2.value3
          });
        }
        ;
        $copy_v = v2.value4;
        return;
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 361, column 11 - line 366, column 21): " + [v2.constructor.name]);
    }
    ;
    while (!$tco_done) {
      $tco_result = $tco_loop($copy_v);
    }
    ;
    return $tco_result;
  };
  var filterWithKey = function(dictOrd) {
    return function(f) {
      var go2 = function(v2) {
        if (v2 instanceof Leaf) {
          return Leaf.value;
        }
        ;
        if (v2 instanceof Node) {
          if (f(v2.value2)(v2.value3)) {
            return unsafeBalancedNode(v2.value2, v2.value3, go2(v2.value4), go2(v2.value5));
          }
          ;
          if (otherwise) {
            return unsafeJoinNodes(go2(v2.value4), go2(v2.value5));
          }
          ;
        }
        ;
        throw new Error("Failed pattern match at Data.Map.Internal (line 627, column 8 - line 633, column 47): " + [v2.constructor.name]);
      };
      return go2;
    };
  };
  var filterKeys = function(dictOrd) {
    return function(f) {
      var go2 = function(v2) {
        if (v2 instanceof Leaf) {
          return Leaf.value;
        }
        ;
        if (v2 instanceof Node) {
          if (f(v2.value2)) {
            return unsafeBalancedNode(v2.value2, v2.value3, go2(v2.value4), go2(v2.value5));
          }
          ;
          if (otherwise) {
            return unsafeJoinNodes(go2(v2.value4), go2(v2.value5));
          }
          ;
        }
        ;
        throw new Error("Failed pattern match at Data.Map.Internal (line 640, column 8 - line 646, column 47): " + [v2.constructor.name]);
      };
      return go2;
    };
  };
  var filter2 = function(dictOrd) {
    var $786 = filterWithKey(dictOrd);
    return function($787) {
      return $786($$const($787));
    };
  };
  var eqMap = function(dictEq) {
    var eqMapIter1 = eqMapIter(dictEq);
    return function(dictEq1) {
      var eq111 = eq(eqMapIter1(dictEq1));
      return {
        eq: function(xs) {
          return function(ys) {
            if (xs instanceof Leaf) {
              if (ys instanceof Leaf) {
                return true;
              }
              ;
              return false;
            }
            ;
            if (xs instanceof Node) {
              if (ys instanceof Node && xs.value1 === ys.value1) {
                return eq111(toMapIter(xs))(toMapIter(ys));
              }
              ;
              return false;
            }
            ;
            throw new Error("Failed pattern match at Data.Map.Internal (line 94, column 14 - line 105, column 16): " + [xs.constructor.name]);
          };
        }
      };
    };
  };
  var empty4 = /* @__PURE__ */ (function() {
    return Leaf.value;
  })();
  var fromFoldable6 = function(dictOrd) {
    var insert19 = insert(dictOrd);
    return function(dictFoldable) {
      return foldl(dictFoldable)(function(m2) {
        return function(v2) {
          return insert19(v2.value0)(v2.value1)(m2);
        };
      })(empty4);
    };
  };
  var difference2 = function(dictOrd) {
    var compare24 = compare(dictOrd);
    return function(m1) {
      return function(m2) {
        return unsafeDifference(compare24, m1, m2);
      };
    };
  };
  var $$delete2 = function(dictOrd) {
    var compare24 = compare(dictOrd);
    return function(k) {
      var go2 = function(v2) {
        if (v2 instanceof Leaf) {
          return Leaf.value;
        }
        ;
        if (v2 instanceof Node) {
          var v1 = compare24(k)(v2.value2);
          if (v1 instanceof LT) {
            return unsafeBalancedNode(v2.value2, v2.value3, go2(v2.value4), v2.value5);
          }
          ;
          if (v1 instanceof GT) {
            return unsafeBalancedNode(v2.value2, v2.value3, v2.value4, go2(v2.value5));
          }
          ;
          if (v1 instanceof EQ) {
            return unsafeJoinNodes(v2.value4, v2.value5);
          }
          ;
          throw new Error("Failed pattern match at Data.Map.Internal (line 498, column 7 - line 501, column 43): " + [v1.constructor.name]);
        }
        ;
        throw new Error("Failed pattern match at Data.Map.Internal (line 495, column 8 - line 501, column 43): " + [v2.constructor.name]);
      };
      return go2;
    };
  };
  var alter = function(dictOrd) {
    var compare24 = compare(dictOrd);
    return function(f) {
      return function(k) {
        return function(m2) {
          var v2 = unsafeSplit(compare24, k, m2);
          var v22 = f(v2.value0);
          if (v22 instanceof Nothing) {
            return unsafeJoinNodes(v2.value1, v2.value2);
          }
          ;
          if (v22 instanceof Just) {
            return unsafeBalancedNode(k, v22.value0, v2.value1, v2.value2);
          }
          ;
          throw new Error("Failed pattern match at Data.Map.Internal (line 514, column 3 - line 518, column 41): " + [v22.constructor.name]);
        };
      };
    };
  };

  // output/Data.Nullable/foreign.js
  var nullImpl = null;
  function nullable(a3, r29, f) {
    return a3 == null ? r29 : f(a3);
  }
  function notNull(x32) {
    return x32;
  }

  // output/Data.Nullable/index.js
  var toNullable = /* @__PURE__ */ maybe(nullImpl)(notNull);
  var toMaybe = function(n) {
    return nullable(n, Nothing.value, Just.create);
  };
  var eqNullable = function(dictEq) {
    return {
      eq: on(eq(eqMaybe(dictEq)))(toMaybe)
    };
  };
  var ordNullable = function(dictOrd) {
    var eqNullable1 = eqNullable(dictOrd.Eq0());
    return {
      compare: on(compare(ordMaybe(dictOrd)))(toMaybe),
      Eq0: function() {
        return eqNullable1;
      }
    };
  };

  // output/PSD3.Internal.Selection.Operations/foreign.js
  function getElementData_(element4) {
    return function() {
      return element4.__data__;
    };
  }
  function setElementData_(datum2) {
    return function(element4) {
      return function() {
        element4.__data__ = datum2;
      };
    };
  }
  function setTextContent_(text47) {
    return function(element4) {
      return function() {
        element4.textContent = text47;
      };
    };
  }
  function offsetX(event) {
    return event.offsetX;
  }
  function offsetY(event) {
    return event.offsetY;
  }
  function clearElement_(selector) {
    return function() {
      const el = document.querySelector(selector);
      if (el) {
        el.innerHTML = "";
      }
    };
  }
  function jsonStringify_(value20) {
    return JSON.stringify(value20);
  }

  // output/Effect.Console/foreign.js
  var log2 = function(s3) {
    return function() {
      console.log(s3);
    };
  };
  var warn = function(s3) {
    return function() {
      console.warn(s3);
    };
  };

  // output/Effect.Class.Console/index.js
  var log3 = function(dictMonadEffect) {
    var $67 = liftEffect(dictMonadEffect);
    return function($68) {
      return $67(log2($68));
    };
  };

  // output/PSD3.AST/index.js
  var append6 = /* @__PURE__ */ append(semigroupArray);
  var Node2 = /* @__PURE__ */ (function() {
    function Node3(value0) {
      this.value0 = value0;
    }
    ;
    Node3.create = function(value0) {
      return new Node3(value0);
    };
    return Node3;
  })();
  var Join = /* @__PURE__ */ (function() {
    function Join3(value0) {
      this.value0 = value0;
    }
    ;
    Join3.create = function(value0) {
      return new Join3(value0);
    };
    return Join3;
  })();
  var NestedJoin = /* @__PURE__ */ (function() {
    function NestedJoin2(value0) {
      this.value0 = value0;
    }
    ;
    NestedJoin2.create = function(value0) {
      return new NestedJoin2(value0);
    };
    return NestedJoin2;
  })();
  var SceneJoin = /* @__PURE__ */ (function() {
    function SceneJoin2(value0) {
      this.value0 = value0;
    }
    ;
    SceneJoin2.create = function(value0) {
      return new SceneJoin2(value0);
    };
    return SceneJoin2;
  })();
  var SceneNestedJoin = /* @__PURE__ */ (function() {
    function SceneNestedJoin2(value0) {
      this.value0 = value0;
    }
    ;
    SceneNestedJoin2.create = function(value0) {
      return new SceneNestedJoin2(value0);
    };
    return SceneNestedJoin2;
  })();
  var withChildren = function(parent2) {
    return function(newChildren) {
      if (parent2 instanceof Node2) {
        return new Node2({
          name: parent2.value0.name,
          elemType: parent2.value0.elemType,
          attrs: parent2.value0.attrs,
          behaviors: parent2.value0.behaviors,
          children: append6(parent2.value0.children)(newChildren)
        });
      }
      ;
      if (parent2 instanceof Join) {
        return new Join(parent2.value0);
      }
      ;
      if (parent2 instanceof NestedJoin) {
        return new NestedJoin(parent2.value0);
      }
      ;
      if (parent2 instanceof SceneJoin) {
        return new SceneJoin(parent2.value0);
      }
      ;
      if (parent2 instanceof SceneNestedJoin) {
        return new SceneNestedJoin(parent2.value0);
      }
      ;
      throw new Error("Failed pattern match at PSD3.AST (line 256, column 35 - line 261, column 45): " + [parent2.constructor.name]);
    };
  };
  var withChild = function(parent2) {
    return function(child) {
      if (parent2 instanceof Node2) {
        return new Node2({
          name: parent2.value0.name,
          elemType: parent2.value0.elemType,
          attrs: parent2.value0.attrs,
          behaviors: parent2.value0.behaviors,
          children: append6(parent2.value0.children)([child])
        });
      }
      ;
      if (parent2 instanceof Join) {
        return new Join(parent2.value0);
      }
      ;
      if (parent2 instanceof NestedJoin) {
        return new NestedJoin(parent2.value0);
      }
      ;
      if (parent2 instanceof SceneJoin) {
        return new SceneJoin(parent2.value0);
      }
      ;
      if (parent2 instanceof SceneNestedJoin) {
        return new SceneNestedJoin(parent2.value0);
      }
      ;
      throw new Error("Failed pattern match at PSD3.AST (line 245, column 26 - line 250, column 45): " + [parent2.constructor.name]);
    };
  };
  var withBehaviors = function(tree2) {
    return function(newBehaviors) {
      if (tree2 instanceof Node2) {
        return new Node2({
          name: tree2.value0.name,
          elemType: tree2.value0.elemType,
          attrs: tree2.value0.attrs,
          children: tree2.value0.children,
          behaviors: append6(tree2.value0.behaviors)(newBehaviors)
        });
      }
      ;
      if (tree2 instanceof Join) {
        return new Join(tree2.value0);
      }
      ;
      if (tree2 instanceof NestedJoin) {
        return new NestedJoin(tree2.value0);
      }
      ;
      if (tree2 instanceof SceneJoin) {
        return new SceneJoin(tree2.value0);
      }
      ;
      if (tree2 instanceof SceneNestedJoin) {
        return new SceneNestedJoin(tree2.value0);
      }
      ;
      throw new Error("Failed pattern match at PSD3.AST (line 281, column 35 - line 286, column 45): " + [tree2.constructor.name]);
    };
  };
  var sceneNestedJoin = function(name16) {
    return function(key2) {
      return function(data$prime) {
        return function(decomposeFn) {
          return function(templateFn) {
            return function(behaviors) {
              return new SceneNestedJoin({
                name: name16,
                key: key2,
                joinData: data$prime,
                decompose: decomposeFn,
                template: templateFn,
                enterBehavior: behaviors.enterBehavior,
                updateBehavior: behaviors.updateBehavior,
                exitBehavior: behaviors.exitBehavior
              });
            };
          };
        };
      };
    };
  };
  var sceneJoin = function(name16) {
    return function(key2) {
      return function(data$prime) {
        return function(template) {
          return function(behaviors) {
            return new SceneJoin({
              name: name16,
              key: key2,
              joinData: data$prime,
              template,
              keyFn: behaviors.keyFn,
              enterBehavior: behaviors.enterBehavior,
              updateBehavior: behaviors.updateBehavior,
              exitBehavior: behaviors.exitBehavior
            });
          };
        };
      };
    };
  };
  var nestedJoin = function(name16) {
    return function(key2) {
      return function(data$prime) {
        return function(decomposeFn) {
          return function(templateFn) {
            return new NestedJoin({
              name: name16,
              key: key2,
              joinData: data$prime,
              decompose: decomposeFn,
              template: templateFn
            });
          };
        };
      };
    };
  };
  var named = function(elemType) {
    return function(name16) {
      return function(attrs) {
        return new Node2({
          name: new Just(name16),
          elemType,
          attrs,
          behaviors: [],
          children: []
        });
      };
    };
  };
  var joinData = function(name16) {
    return function(key2) {
      return function(data$prime) {
        return function(templateBuilder) {
          return new Join({
            name: name16,
            key: key2,
            joinData: data$prime,
            template: templateBuilder
          });
        };
      };
    };
  };
  var elem3 = function(elemType) {
    return function(attrs) {
      return new Node2({
        name: Nothing.value,
        elemType,
        attrs,
        behaviors: [],
        children: []
      });
    };
  };

  // node_modules/d3-selection/src/namespaces.js
  var xhtml = "http://www.w3.org/1999/xhtml";
  var namespaces_default = {
    svg: "http://www.w3.org/2000/svg",
    xhtml,
    xlink: "http://www.w3.org/1999/xlink",
    xml: "http://www.w3.org/XML/1998/namespace",
    xmlns: "http://www.w3.org/2000/xmlns/"
  };

  // node_modules/d3-selection/src/namespace.js
  function namespace_default(name16) {
    var prefix = name16 += "", i2 = prefix.indexOf(":");
    if (i2 >= 0 && (prefix = name16.slice(0, i2)) !== "xmlns") name16 = name16.slice(i2 + 1);
    return namespaces_default.hasOwnProperty(prefix) ? { space: namespaces_default[prefix], local: name16 } : name16;
  }

  // node_modules/d3-selection/src/creator.js
  function creatorInherit(name16) {
    return function() {
      var document3 = this.ownerDocument, uri = this.namespaceURI;
      return uri === xhtml && document3.documentElement.namespaceURI === xhtml ? document3.createElement(name16) : document3.createElementNS(uri, name16);
    };
  }
  function creatorFixed(fullname) {
    return function() {
      return this.ownerDocument.createElementNS(fullname.space, fullname.local);
    };
  }
  function creator_default(name16) {
    var fullname = namespace_default(name16);
    return (fullname.local ? creatorFixed : creatorInherit)(fullname);
  }

  // node_modules/d3-selection/src/selector.js
  function none() {
  }
  function selector_default(selector) {
    return selector == null ? none : function() {
      return this.querySelector(selector);
    };
  }

  // node_modules/d3-selection/src/selection/select.js
  function select_default(select53) {
    if (typeof select53 !== "function") select53 = selector_default(select53);
    for (var groups = this._groups, m2 = groups.length, subgroups = new Array(m2), j = 0; j < m2; ++j) {
      for (var group4 = groups[j], n = group4.length, subgroup = subgroups[j] = new Array(n), node, subnode, i2 = 0; i2 < n; ++i2) {
        if ((node = group4[i2]) && (subnode = select53.call(node, node.__data__, i2, group4))) {
          if ("__data__" in node) subnode.__data__ = node.__data__;
          subgroup[i2] = subnode;
        }
      }
    }
    return new Selection(subgroups, this._parents);
  }

  // node_modules/d3-selection/src/array.js
  function array(x32) {
    return x32 == null ? [] : Array.isArray(x32) ? x32 : Array.from(x32);
  }

  // node_modules/d3-selection/src/selectorAll.js
  function empty5() {
    return [];
  }
  function selectorAll_default(selector) {
    return selector == null ? empty5 : function() {
      return this.querySelectorAll(selector);
    };
  }

  // node_modules/d3-selection/src/selection/selectAll.js
  function arrayAll(select53) {
    return function() {
      return array(select53.apply(this, arguments));
    };
  }
  function selectAll_default(select53) {
    if (typeof select53 === "function") select53 = arrayAll(select53);
    else select53 = selectorAll_default(select53);
    for (var groups = this._groups, m2 = groups.length, subgroups = [], parents = [], j = 0; j < m2; ++j) {
      for (var group4 = groups[j], n = group4.length, node, i2 = 0; i2 < n; ++i2) {
        if (node = group4[i2]) {
          subgroups.push(select53.call(node, node.__data__, i2, group4));
          parents.push(node);
        }
      }
    }
    return new Selection(subgroups, parents);
  }

  // node_modules/d3-selection/src/matcher.js
  function matcher_default(selector) {
    return function() {
      return this.matches(selector);
    };
  }
  function childMatcher(selector) {
    return function(node) {
      return node.matches(selector);
    };
  }

  // node_modules/d3-selection/src/selection/selectChild.js
  var find3 = Array.prototype.find;
  function childFind(match3) {
    return function() {
      return find3.call(this.children, match3);
    };
  }
  function childFirst() {
    return this.firstElementChild;
  }
  function selectChild_default(match3) {
    return this.select(match3 == null ? childFirst : childFind(typeof match3 === "function" ? match3 : childMatcher(match3)));
  }

  // node_modules/d3-selection/src/selection/selectChildren.js
  var filter3 = Array.prototype.filter;
  function children() {
    return Array.from(this.children);
  }
  function childrenFilter(match3) {
    return function() {
      return filter3.call(this.children, match3);
    };
  }
  function selectChildren_default(match3) {
    return this.selectAll(match3 == null ? children : childrenFilter(typeof match3 === "function" ? match3 : childMatcher(match3)));
  }

  // node_modules/d3-selection/src/selection/filter.js
  function filter_default(match3) {
    if (typeof match3 !== "function") match3 = matcher_default(match3);
    for (var groups = this._groups, m2 = groups.length, subgroups = new Array(m2), j = 0; j < m2; ++j) {
      for (var group4 = groups[j], n = group4.length, subgroup = subgroups[j] = [], node, i2 = 0; i2 < n; ++i2) {
        if ((node = group4[i2]) && match3.call(node, node.__data__, i2, group4)) {
          subgroup.push(node);
        }
      }
    }
    return new Selection(subgroups, this._parents);
  }

  // node_modules/d3-selection/src/selection/sparse.js
  function sparse_default(update2) {
    return new Array(update2.length);
  }

  // node_modules/d3-selection/src/selection/enter.js
  function enter_default() {
    return new Selection(this._enter || this._groups.map(sparse_default), this._parents);
  }
  function EnterNode(parent2, datum2) {
    this.ownerDocument = parent2.ownerDocument;
    this.namespaceURI = parent2.namespaceURI;
    this._next = null;
    this._parent = parent2;
    this.__data__ = datum2;
  }
  EnterNode.prototype = {
    constructor: EnterNode,
    appendChild: function(child) {
      return this._parent.insertBefore(child, this._next);
    },
    insertBefore: function(child, next2) {
      return this._parent.insertBefore(child, next2);
    },
    querySelector: function(selector) {
      return this._parent.querySelector(selector);
    },
    querySelectorAll: function(selector) {
      return this._parent.querySelectorAll(selector);
    }
  };

  // node_modules/d3-selection/src/constant.js
  function constant_default(x32) {
    return function() {
      return x32;
    };
  }

  // node_modules/d3-selection/src/selection/data.js
  function bindIndex(parent2, group4, enter, update2, exit, data) {
    var i2 = 0, node, groupLength = group4.length, dataLength = data.length;
    for (; i2 < dataLength; ++i2) {
      if (node = group4[i2]) {
        node.__data__ = data[i2];
        update2[i2] = node;
      } else {
        enter[i2] = new EnterNode(parent2, data[i2]);
      }
    }
    for (; i2 < groupLength; ++i2) {
      if (node = group4[i2]) {
        exit[i2] = node;
      }
    }
  }
  function bindKey(parent2, group4, enter, update2, exit, data, key2) {
    var i2, node, nodeByKeyValue = /* @__PURE__ */ new Map(), groupLength = group4.length, dataLength = data.length, keyValues = new Array(groupLength), keyValue;
    for (i2 = 0; i2 < groupLength; ++i2) {
      if (node = group4[i2]) {
        keyValues[i2] = keyValue = key2.call(node, node.__data__, i2, group4) + "";
        if (nodeByKeyValue.has(keyValue)) {
          exit[i2] = node;
        } else {
          nodeByKeyValue.set(keyValue, node);
        }
      }
    }
    for (i2 = 0; i2 < dataLength; ++i2) {
      keyValue = key2.call(parent2, data[i2], i2, data) + "";
      if (node = nodeByKeyValue.get(keyValue)) {
        update2[i2] = node;
        node.__data__ = data[i2];
        nodeByKeyValue.delete(keyValue);
      } else {
        enter[i2] = new EnterNode(parent2, data[i2]);
      }
    }
    for (i2 = 0; i2 < groupLength; ++i2) {
      if ((node = group4[i2]) && nodeByKeyValue.get(keyValues[i2]) === node) {
        exit[i2] = node;
      }
    }
  }
  function datum(node) {
    return node.__data__;
  }
  function data_default(value20, key2) {
    if (!arguments.length) return Array.from(this, datum);
    var bind100 = key2 ? bindKey : bindIndex, parents = this._parents, groups = this._groups;
    if (typeof value20 !== "function") value20 = constant_default(value20);
    for (var m2 = groups.length, update2 = new Array(m2), enter = new Array(m2), exit = new Array(m2), j = 0; j < m2; ++j) {
      var parent2 = parents[j], group4 = groups[j], groupLength = group4.length, data = arraylike(value20.call(parent2, parent2 && parent2.__data__, j, parents)), dataLength = data.length, enterGroup = enter[j] = new Array(dataLength), updateGroup = update2[j] = new Array(dataLength), exitGroup = exit[j] = new Array(groupLength);
      bind100(parent2, group4, enterGroup, updateGroup, exitGroup, data, key2);
      for (var i0 = 0, i1 = 0, previous, next2; i0 < dataLength; ++i0) {
        if (previous = enterGroup[i0]) {
          if (i0 >= i1) i1 = i0 + 1;
          while (!(next2 = updateGroup[i1]) && ++i1 < dataLength) ;
          previous._next = next2 || null;
        }
      }
    }
    update2 = new Selection(update2, parents);
    update2._enter = enter;
    update2._exit = exit;
    return update2;
  }
  function arraylike(data) {
    return typeof data === "object" && "length" in data ? data : Array.from(data);
  }

  // node_modules/d3-selection/src/selection/exit.js
  function exit_default() {
    return new Selection(this._exit || this._groups.map(sparse_default), this._parents);
  }

  // node_modules/d3-selection/src/selection/join.js
  function join_default(onenter, onupdate, onexit) {
    var enter = this.enter(), update2 = this, exit = this.exit();
    if (typeof onenter === "function") {
      enter = onenter(enter);
      if (enter) enter = enter.selection();
    } else {
      enter = enter.append(onenter + "");
    }
    if (onupdate != null) {
      update2 = onupdate(update2);
      if (update2) update2 = update2.selection();
    }
    if (onexit == null) exit.remove();
    else onexit(exit);
    return enter && update2 ? enter.merge(update2).order() : update2;
  }

  // node_modules/d3-selection/src/selection/merge.js
  function merge_default(context) {
    var selection2 = context.selection ? context.selection() : context;
    for (var groups0 = this._groups, groups1 = selection2._groups, m0 = groups0.length, m1 = groups1.length, m2 = Math.min(m0, m1), merges = new Array(m0), j = 0; j < m2; ++j) {
      for (var group0 = groups0[j], group1 = groups1[j], n = group0.length, merge3 = merges[j] = new Array(n), node, i2 = 0; i2 < n; ++i2) {
        if (node = group0[i2] || group1[i2]) {
          merge3[i2] = node;
        }
      }
    }
    for (; j < m0; ++j) {
      merges[j] = groups0[j];
    }
    return new Selection(merges, this._parents);
  }

  // node_modules/d3-selection/src/selection/order.js
  function order_default() {
    for (var groups = this._groups, j = -1, m2 = groups.length; ++j < m2; ) {
      for (var group4 = groups[j], i2 = group4.length - 1, next2 = group4[i2], node; --i2 >= 0; ) {
        if (node = group4[i2]) {
          if (next2 && node.compareDocumentPosition(next2) ^ 4) next2.parentNode.insertBefore(node, next2);
          next2 = node;
        }
      }
    }
    return this;
  }

  // node_modules/d3-selection/src/selection/sort.js
  function sort_default(compare24) {
    if (!compare24) compare24 = ascending;
    function compareNode(a3, b10) {
      return a3 && b10 ? compare24(a3.__data__, b10.__data__) : !a3 - !b10;
    }
    for (var groups = this._groups, m2 = groups.length, sortgroups = new Array(m2), j = 0; j < m2; ++j) {
      for (var group4 = groups[j], n = group4.length, sortgroup = sortgroups[j] = new Array(n), node, i2 = 0; i2 < n; ++i2) {
        if (node = group4[i2]) {
          sortgroup[i2] = node;
        }
      }
      sortgroup.sort(compareNode);
    }
    return new Selection(sortgroups, this._parents).order();
  }
  function ascending(a3, b10) {
    return a3 < b10 ? -1 : a3 > b10 ? 1 : a3 >= b10 ? 0 : NaN;
  }

  // node_modules/d3-selection/src/selection/call.js
  function call_default() {
    var callback = arguments[0];
    arguments[0] = this;
    callback.apply(null, arguments);
    return this;
  }

  // node_modules/d3-selection/src/selection/nodes.js
  function nodes_default() {
    return Array.from(this);
  }

  // node_modules/d3-selection/src/selection/node.js
  function node_default() {
    for (var groups = this._groups, j = 0, m2 = groups.length; j < m2; ++j) {
      for (var group4 = groups[j], i2 = 0, n = group4.length; i2 < n; ++i2) {
        var node = group4[i2];
        if (node) return node;
      }
    }
    return null;
  }

  // node_modules/d3-selection/src/selection/size.js
  function size_default() {
    let size6 = 0;
    for (const node of this) ++size6;
    return size6;
  }

  // node_modules/d3-selection/src/selection/empty.js
  function empty_default() {
    return !this.node();
  }

  // node_modules/d3-selection/src/selection/each.js
  function each_default(callback) {
    for (var groups = this._groups, j = 0, m2 = groups.length; j < m2; ++j) {
      for (var group4 = groups[j], i2 = 0, n = group4.length, node; i2 < n; ++i2) {
        if (node = group4[i2]) callback.call(node, node.__data__, i2, group4);
      }
    }
    return this;
  }

  // node_modules/d3-selection/src/selection/attr.js
  function attrRemove(name16) {
    return function() {
      this.removeAttribute(name16);
    };
  }
  function attrRemoveNS(fullname) {
    return function() {
      this.removeAttributeNS(fullname.space, fullname.local);
    };
  }
  function attrConstant(name16, value20) {
    return function() {
      this.setAttribute(name16, value20);
    };
  }
  function attrConstantNS(fullname, value20) {
    return function() {
      this.setAttributeNS(fullname.space, fullname.local, value20);
    };
  }
  function attrFunction(name16, value20) {
    return function() {
      var v2 = value20.apply(this, arguments);
      if (v2 == null) this.removeAttribute(name16);
      else this.setAttribute(name16, v2);
    };
  }
  function attrFunctionNS(fullname, value20) {
    return function() {
      var v2 = value20.apply(this, arguments);
      if (v2 == null) this.removeAttributeNS(fullname.space, fullname.local);
      else this.setAttributeNS(fullname.space, fullname.local, v2);
    };
  }
  function attr_default(name16, value20) {
    var fullname = namespace_default(name16);
    if (arguments.length < 2) {
      var node = this.node();
      return fullname.local ? node.getAttributeNS(fullname.space, fullname.local) : node.getAttribute(fullname);
    }
    return this.each((value20 == null ? fullname.local ? attrRemoveNS : attrRemove : typeof value20 === "function" ? fullname.local ? attrFunctionNS : attrFunction : fullname.local ? attrConstantNS : attrConstant)(fullname, value20));
  }

  // node_modules/d3-selection/src/window.js
  function window_default(node) {
    return node.ownerDocument && node.ownerDocument.defaultView || node.document && node || node.defaultView;
  }

  // node_modules/d3-selection/src/selection/style.js
  function styleRemove(name16) {
    return function() {
      this.style.removeProperty(name16);
    };
  }
  function styleConstant(name16, value20, priority) {
    return function() {
      this.style.setProperty(name16, value20, priority);
    };
  }
  function styleFunction(name16, value20, priority) {
    return function() {
      var v2 = value20.apply(this, arguments);
      if (v2 == null) this.style.removeProperty(name16);
      else this.style.setProperty(name16, v2, priority);
    };
  }
  function style_default(name16, value20, priority) {
    return arguments.length > 1 ? this.each((value20 == null ? styleRemove : typeof value20 === "function" ? styleFunction : styleConstant)(name16, value20, priority == null ? "" : priority)) : styleValue(this.node(), name16);
  }
  function styleValue(node, name16) {
    return node.style.getPropertyValue(name16) || window_default(node).getComputedStyle(node, null).getPropertyValue(name16);
  }

  // node_modules/d3-selection/src/selection/property.js
  function propertyRemove(name16) {
    return function() {
      delete this[name16];
    };
  }
  function propertyConstant(name16, value20) {
    return function() {
      this[name16] = value20;
    };
  }
  function propertyFunction(name16, value20) {
    return function() {
      var v2 = value20.apply(this, arguments);
      if (v2 == null) delete this[name16];
      else this[name16] = v2;
    };
  }
  function property_default(name16, value20) {
    return arguments.length > 1 ? this.each((value20 == null ? propertyRemove : typeof value20 === "function" ? propertyFunction : propertyConstant)(name16, value20)) : this.node()[name16];
  }

  // node_modules/d3-selection/src/selection/classed.js
  function classArray(string2) {
    return string2.trim().split(/^|\s+/);
  }
  function classList(node) {
    return node.classList || new ClassList(node);
  }
  function ClassList(node) {
    this._node = node;
    this._names = classArray(node.getAttribute("class") || "");
  }
  ClassList.prototype = {
    add: function(name16) {
      var i2 = this._names.indexOf(name16);
      if (i2 < 0) {
        this._names.push(name16);
        this._node.setAttribute("class", this._names.join(" "));
      }
    },
    remove: function(name16) {
      var i2 = this._names.indexOf(name16);
      if (i2 >= 0) {
        this._names.splice(i2, 1);
        this._node.setAttribute("class", this._names.join(" "));
      }
    },
    contains: function(name16) {
      return this._names.indexOf(name16) >= 0;
    }
  };
  function classedAdd(node, names) {
    var list = classList(node), i2 = -1, n = names.length;
    while (++i2 < n) list.add(names[i2]);
  }
  function classedRemove(node, names) {
    var list = classList(node), i2 = -1, n = names.length;
    while (++i2 < n) list.remove(names[i2]);
  }
  function classedTrue(names) {
    return function() {
      classedAdd(this, names);
    };
  }
  function classedFalse(names) {
    return function() {
      classedRemove(this, names);
    };
  }
  function classedFunction(names, value20) {
    return function() {
      (value20.apply(this, arguments) ? classedAdd : classedRemove)(this, names);
    };
  }
  function classed_default(name16, value20) {
    var names = classArray(name16 + "");
    if (arguments.length < 2) {
      var list = classList(this.node()), i2 = -1, n = names.length;
      while (++i2 < n) if (!list.contains(names[i2])) return false;
      return true;
    }
    return this.each((typeof value20 === "function" ? classedFunction : value20 ? classedTrue : classedFalse)(names, value20));
  }

  // node_modules/d3-selection/src/selection/text.js
  function textRemove() {
    this.textContent = "";
  }
  function textConstant(value20) {
    return function() {
      this.textContent = value20;
    };
  }
  function textFunction(value20) {
    return function() {
      var v2 = value20.apply(this, arguments);
      this.textContent = v2 == null ? "" : v2;
    };
  }
  function text_default(value20) {
    return arguments.length ? this.each(value20 == null ? textRemove : (typeof value20 === "function" ? textFunction : textConstant)(value20)) : this.node().textContent;
  }

  // node_modules/d3-selection/src/selection/html.js
  function htmlRemove() {
    this.innerHTML = "";
  }
  function htmlConstant(value20) {
    return function() {
      this.innerHTML = value20;
    };
  }
  function htmlFunction(value20) {
    return function() {
      var v2 = value20.apply(this, arguments);
      this.innerHTML = v2 == null ? "" : v2;
    };
  }
  function html_default(value20) {
    return arguments.length ? this.each(value20 == null ? htmlRemove : (typeof value20 === "function" ? htmlFunction : htmlConstant)(value20)) : this.node().innerHTML;
  }

  // node_modules/d3-selection/src/selection/raise.js
  function raise() {
    if (this.nextSibling) this.parentNode.appendChild(this);
  }
  function raise_default() {
    return this.each(raise);
  }

  // node_modules/d3-selection/src/selection/lower.js
  function lower() {
    if (this.previousSibling) this.parentNode.insertBefore(this, this.parentNode.firstChild);
  }
  function lower_default() {
    return this.each(lower);
  }

  // node_modules/d3-selection/src/selection/append.js
  function append_default(name16) {
    var create6 = typeof name16 === "function" ? name16 : creator_default(name16);
    return this.select(function() {
      return this.appendChild(create6.apply(this, arguments));
    });
  }

  // node_modules/d3-selection/src/selection/insert.js
  function constantNull() {
    return null;
  }
  function insert_default(name16, before) {
    var create6 = typeof name16 === "function" ? name16 : creator_default(name16), select53 = before == null ? constantNull : typeof before === "function" ? before : selector_default(before);
    return this.select(function() {
      return this.insertBefore(create6.apply(this, arguments), select53.apply(this, arguments) || null);
    });
  }

  // node_modules/d3-selection/src/selection/remove.js
  function remove2() {
    var parent2 = this.parentNode;
    if (parent2) parent2.removeChild(this);
  }
  function remove_default() {
    return this.each(remove2);
  }

  // node_modules/d3-selection/src/selection/clone.js
  function selection_cloneShallow() {
    var clone2 = this.cloneNode(false), parent2 = this.parentNode;
    return parent2 ? parent2.insertBefore(clone2, this.nextSibling) : clone2;
  }
  function selection_cloneDeep() {
    var clone2 = this.cloneNode(true), parent2 = this.parentNode;
    return parent2 ? parent2.insertBefore(clone2, this.nextSibling) : clone2;
  }
  function clone_default(deep) {
    return this.select(deep ? selection_cloneDeep : selection_cloneShallow);
  }

  // node_modules/d3-selection/src/selection/datum.js
  function datum_default(value20) {
    return arguments.length ? this.property("__data__", value20) : this.node().__data__;
  }

  // node_modules/d3-selection/src/selection/on.js
  function contextListener(listener) {
    return function(event) {
      listener.call(this, event, this.__data__);
    };
  }
  function parseTypenames(typenames) {
    return typenames.trim().split(/^|\s+/).map(function(t2) {
      var name16 = "", i2 = t2.indexOf(".");
      if (i2 >= 0) name16 = t2.slice(i2 + 1), t2 = t2.slice(0, i2);
      return { type: t2, name: name16 };
    });
  }
  function onRemove(typename) {
    return function() {
      var on5 = this.__on;
      if (!on5) return;
      for (var j = 0, i2 = -1, m2 = on5.length, o; j < m2; ++j) {
        if (o = on5[j], (!typename.type || o.type === typename.type) && o.name === typename.name) {
          this.removeEventListener(o.type, o.listener, o.options);
        } else {
          on5[++i2] = o;
        }
      }
      if (++i2) on5.length = i2;
      else delete this.__on;
    };
  }
  function onAdd(typename, value20, options2) {
    return function() {
      var on5 = this.__on, o, listener = contextListener(value20);
      if (on5) for (var j = 0, m2 = on5.length; j < m2; ++j) {
        if ((o = on5[j]).type === typename.type && o.name === typename.name) {
          this.removeEventListener(o.type, o.listener, o.options);
          this.addEventListener(o.type, o.listener = listener, o.options = options2);
          o.value = value20;
          return;
        }
      }
      this.addEventListener(typename.type, listener, options2);
      o = { type: typename.type, name: typename.name, value: value20, listener, options: options2 };
      if (!on5) this.__on = [o];
      else on5.push(o);
    };
  }
  function on_default(typename, value20, options2) {
    var typenames = parseTypenames(typename + ""), i2, n = typenames.length, t2;
    if (arguments.length < 2) {
      var on5 = this.node().__on;
      if (on5) for (var j = 0, m2 = on5.length, o; j < m2; ++j) {
        for (i2 = 0, o = on5[j]; i2 < n; ++i2) {
          if ((t2 = typenames[i2]).type === o.type && t2.name === o.name) {
            return o.value;
          }
        }
      }
      return;
    }
    on5 = value20 ? onAdd : onRemove;
    for (i2 = 0; i2 < n; ++i2) this.each(on5(typenames[i2], value20, options2));
    return this;
  }

  // node_modules/d3-selection/src/selection/dispatch.js
  function dispatchEvent(node, type2, params) {
    var window2 = window_default(node), event = window2.CustomEvent;
    if (typeof event === "function") {
      event = new event(type2, params);
    } else {
      event = window2.document.createEvent("Event");
      if (params) event.initEvent(type2, params.bubbles, params.cancelable), event.detail = params.detail;
      else event.initEvent(type2, false, false);
    }
    node.dispatchEvent(event);
  }
  function dispatchConstant(type2, params) {
    return function() {
      return dispatchEvent(this, type2, params);
    };
  }
  function dispatchFunction(type2, params) {
    return function() {
      return dispatchEvent(this, type2, params.apply(this, arguments));
    };
  }
  function dispatch_default(type2, params) {
    return this.each((typeof params === "function" ? dispatchFunction : dispatchConstant)(type2, params));
  }

  // node_modules/d3-selection/src/selection/iterator.js
  function* iterator_default() {
    for (var groups = this._groups, j = 0, m2 = groups.length; j < m2; ++j) {
      for (var group4 = groups[j], i2 = 0, n = group4.length, node; i2 < n; ++i2) {
        if (node = group4[i2]) yield node;
      }
    }
  }

  // node_modules/d3-selection/src/selection/index.js
  var root = [null];
  function Selection(groups, parents) {
    this._groups = groups;
    this._parents = parents;
  }
  function selection() {
    return new Selection([[document.documentElement]], root);
  }
  function selection_selection() {
    return this;
  }
  Selection.prototype = selection.prototype = {
    constructor: Selection,
    select: select_default,
    selectAll: selectAll_default,
    selectChild: selectChild_default,
    selectChildren: selectChildren_default,
    filter: filter_default,
    data: data_default,
    enter: enter_default,
    exit: exit_default,
    join: join_default,
    merge: merge_default,
    selection: selection_selection,
    order: order_default,
    sort: sort_default,
    call: call_default,
    nodes: nodes_default,
    node: node_default,
    size: size_default,
    empty: empty_default,
    each: each_default,
    attr: attr_default,
    style: style_default,
    property: property_default,
    classed: classed_default,
    text: text_default,
    html: html_default,
    raise: raise_default,
    lower: lower_default,
    append: append_default,
    insert: insert_default,
    remove: remove_default,
    clone: clone_default,
    datum: datum_default,
    on: on_default,
    dispatch: dispatch_default,
    [Symbol.iterator]: iterator_default
  };
  var selection_default = selection;

  // node_modules/d3-selection/src/select.js
  function select_default2(selector) {
    return typeof selector === "string" ? new Selection([[document.querySelector(selector)]], [document.documentElement]) : new Selection([[selector]], root);
  }

  // node_modules/d3-selection/src/sourceEvent.js
  function sourceEvent_default(event) {
    let sourceEvent;
    while (sourceEvent = event.sourceEvent) event = sourceEvent;
    return event;
  }

  // node_modules/d3-selection/src/pointer.js
  function pointer_default(event, node) {
    event = sourceEvent_default(event);
    if (node === void 0) node = event.currentTarget;
    if (node) {
      var svg2 = node.ownerSVGElement || node;
      if (svg2.createSVGPoint) {
        var point3 = svg2.createSVGPoint();
        point3.x = event.clientX, point3.y = event.clientY;
        point3 = point3.matrixTransform(node.getScreenCTM().inverse());
        return [point3.x, point3.y];
      }
      if (node.getBoundingClientRect) {
        var rect2 = node.getBoundingClientRect();
        return [event.clientX - rect2.left - node.clientLeft, event.clientY - rect2.top - node.clientTop];
      }
    }
    return [event.pageX, event.pageY];
  }

  // node_modules/d3-dispatch/src/dispatch.js
  var noop = { value: () => {
  } };
  function dispatch() {
    for (var i2 = 0, n = arguments.length, _ = {}, t2; i2 < n; ++i2) {
      if (!(t2 = arguments[i2] + "") || t2 in _ || /[\s.]/.test(t2)) throw new Error("illegal type: " + t2);
      _[t2] = [];
    }
    return new Dispatch(_);
  }
  function Dispatch(_) {
    this._ = _;
  }
  function parseTypenames2(typenames, types) {
    return typenames.trim().split(/^|\s+/).map(function(t2) {
      var name16 = "", i2 = t2.indexOf(".");
      if (i2 >= 0) name16 = t2.slice(i2 + 1), t2 = t2.slice(0, i2);
      if (t2 && !types.hasOwnProperty(t2)) throw new Error("unknown type: " + t2);
      return { type: t2, name: name16 };
    });
  }
  Dispatch.prototype = dispatch.prototype = {
    constructor: Dispatch,
    on: function(typename, callback) {
      var _ = this._, T = parseTypenames2(typename + "", _), t2, i2 = -1, n = T.length;
      if (arguments.length < 2) {
        while (++i2 < n) if ((t2 = (typename = T[i2]).type) && (t2 = get2(_[t2], typename.name))) return t2;
        return;
      }
      if (callback != null && typeof callback !== "function") throw new Error("invalid callback: " + callback);
      while (++i2 < n) {
        if (t2 = (typename = T[i2]).type) _[t2] = set(_[t2], typename.name, callback);
        else if (callback == null) for (t2 in _) _[t2] = set(_[t2], typename.name, null);
      }
      return this;
    },
    copy: function() {
      var copy4 = {}, _ = this._;
      for (var t2 in _) copy4[t2] = _[t2].slice();
      return new Dispatch(copy4);
    },
    call: function(type2, that) {
      if ((n = arguments.length - 2) > 0) for (var args = new Array(n), i2 = 0, n, t2; i2 < n; ++i2) args[i2] = arguments[i2 + 2];
      if (!this._.hasOwnProperty(type2)) throw new Error("unknown type: " + type2);
      for (t2 = this._[type2], i2 = 0, n = t2.length; i2 < n; ++i2) t2[i2].value.apply(that, args);
    },
    apply: function(type2, that, args) {
      if (!this._.hasOwnProperty(type2)) throw new Error("unknown type: " + type2);
      for (var t2 = this._[type2], i2 = 0, n = t2.length; i2 < n; ++i2) t2[i2].value.apply(that, args);
    }
  };
  function get2(type2, name16) {
    for (var i2 = 0, n = type2.length, c2; i2 < n; ++i2) {
      if ((c2 = type2[i2]).name === name16) {
        return c2.value;
      }
    }
  }
  function set(type2, name16, callback) {
    for (var i2 = 0, n = type2.length; i2 < n; ++i2) {
      if (type2[i2].name === name16) {
        type2[i2] = noop, type2 = type2.slice(0, i2).concat(type2.slice(i2 + 1));
        break;
      }
    }
    if (callback != null) type2.push({ name: name16, value: callback });
    return type2;
  }
  var dispatch_default2 = dispatch;

  // node_modules/d3-drag/src/noevent.js
  var nonpassive = { passive: false };
  var nonpassivecapture = { capture: true, passive: false };
  function nopropagation(event) {
    event.stopImmediatePropagation();
  }
  function noevent_default(event) {
    event.preventDefault();
    event.stopImmediatePropagation();
  }

  // node_modules/d3-drag/src/nodrag.js
  function nodrag_default(view) {
    var root3 = view.document.documentElement, selection2 = select_default2(view).on("dragstart.drag", noevent_default, nonpassivecapture);
    if ("onselectstart" in root3) {
      selection2.on("selectstart.drag", noevent_default, nonpassivecapture);
    } else {
      root3.__noselect = root3.style.MozUserSelect;
      root3.style.MozUserSelect = "none";
    }
  }
  function yesdrag(view, noclick) {
    var root3 = view.document.documentElement, selection2 = select_default2(view).on("dragstart.drag", null);
    if (noclick) {
      selection2.on("click.drag", noevent_default, nonpassivecapture);
      setTimeout(function() {
        selection2.on("click.drag", null);
      }, 0);
    }
    if ("onselectstart" in root3) {
      selection2.on("selectstart.drag", null);
    } else {
      root3.style.MozUserSelect = root3.__noselect;
      delete root3.__noselect;
    }
  }

  // node_modules/d3-drag/src/constant.js
  var constant_default2 = (x32) => () => x32;

  // node_modules/d3-drag/src/event.js
  function DragEvent(type2, {
    sourceEvent,
    subject,
    target: target7,
    identifier,
    active,
    x: x32,
    y: y32,
    dx,
    dy,
    dispatch: dispatch2
  }) {
    Object.defineProperties(this, {
      type: { value: type2, enumerable: true, configurable: true },
      sourceEvent: { value: sourceEvent, enumerable: true, configurable: true },
      subject: { value: subject, enumerable: true, configurable: true },
      target: { value: target7, enumerable: true, configurable: true },
      identifier: { value: identifier, enumerable: true, configurable: true },
      active: { value: active, enumerable: true, configurable: true },
      x: { value: x32, enumerable: true, configurable: true },
      y: { value: y32, enumerable: true, configurable: true },
      dx: { value: dx, enumerable: true, configurable: true },
      dy: { value: dy, enumerable: true, configurable: true },
      _: { value: dispatch2 }
    });
  }
  DragEvent.prototype.on = function() {
    var value20 = this._.on.apply(this._, arguments);
    return value20 === this._ ? this : value20;
  };

  // node_modules/d3-drag/src/drag.js
  function defaultFilter(event) {
    return !event.ctrlKey && !event.button;
  }
  function defaultContainer() {
    return this.parentNode;
  }
  function defaultSubject(event, d) {
    return d == null ? { x: event.x, y: event.y } : d;
  }
  function defaultTouchable() {
    return navigator.maxTouchPoints || "ontouchstart" in this;
  }
  function drag_default() {
    var filter7 = defaultFilter, container = defaultContainer, subject = defaultSubject, touchable = defaultTouchable, gestures = {}, listeners = dispatch_default2("start", "drag", "end"), active = 0, mousedownx, mousedowny, mousemoving, touchending, clickDistance2 = 0;
    function drag2(selection2) {
      selection2.on("mousedown.drag", mousedowned).filter(touchable).on("touchstart.drag", touchstarted).on("touchmove.drag", touchmoved, nonpassive).on("touchend.drag touchcancel.drag", touchended).style("touch-action", "none").style("-webkit-tap-highlight-color", "rgba(0,0,0,0)");
    }
    function mousedowned(event, d) {
      if (touchending || !filter7.call(this, event, d)) return;
      var gesture = beforestart(this, container.call(this, event, d), event, d, "mouse");
      if (!gesture) return;
      select_default2(event.view).on("mousemove.drag", mousemoved, nonpassivecapture).on("mouseup.drag", mouseupped, nonpassivecapture);
      nodrag_default(event.view);
      nopropagation(event);
      mousemoving = false;
      mousedownx = event.clientX;
      mousedowny = event.clientY;
      gesture("start", event);
    }
    function mousemoved(event) {
      noevent_default(event);
      if (!mousemoving) {
        var dx = event.clientX - mousedownx, dy = event.clientY - mousedowny;
        mousemoving = dx * dx + dy * dy > clickDistance2;
      }
      gestures.mouse("drag", event);
    }
    function mouseupped(event) {
      select_default2(event.view).on("mousemove.drag mouseup.drag", null);
      yesdrag(event.view, mousemoving);
      noevent_default(event);
      gestures.mouse("end", event);
    }
    function touchstarted(event, d) {
      if (!filter7.call(this, event, d)) return;
      var touches = event.changedTouches, c2 = container.call(this, event, d), n = touches.length, i2, gesture;
      for (i2 = 0; i2 < n; ++i2) {
        if (gesture = beforestart(this, c2, event, d, touches[i2].identifier, touches[i2])) {
          nopropagation(event);
          gesture("start", event, touches[i2]);
        }
      }
    }
    function touchmoved(event) {
      var touches = event.changedTouches, n = touches.length, i2, gesture;
      for (i2 = 0; i2 < n; ++i2) {
        if (gesture = gestures[touches[i2].identifier]) {
          noevent_default(event);
          gesture("drag", event, touches[i2]);
        }
      }
    }
    function touchended(event) {
      var touches = event.changedTouches, n = touches.length, i2, gesture;
      if (touchending) clearTimeout(touchending);
      touchending = setTimeout(function() {
        touchending = null;
      }, 500);
      for (i2 = 0; i2 < n; ++i2) {
        if (gesture = gestures[touches[i2].identifier]) {
          nopropagation(event);
          gesture("end", event, touches[i2]);
        }
      }
    }
    function beforestart(that, container2, event, d, identifier, touch) {
      var dispatch2 = listeners.copy(), p2 = pointer_default(touch || event, container2), dx, dy, s3;
      if ((s3 = subject.call(that, new DragEvent("beforestart", {
        sourceEvent: event,
        target: drag2,
        identifier,
        active,
        x: p2[0],
        y: p2[1],
        dx: 0,
        dy: 0,
        dispatch: dispatch2
      }), d)) == null) return;
      dx = s3.x - p2[0] || 0;
      dy = s3.y - p2[1] || 0;
      return function gesture(type2, event2, touch2) {
        var p0 = p2, n;
        switch (type2) {
          case "start":
            gestures[identifier] = gesture, n = active++;
            break;
          case "end":
            delete gestures[identifier], --active;
          // falls through
          case "drag":
            p2 = pointer_default(touch2 || event2, container2), n = active;
            break;
        }
        dispatch2.call(
          type2,
          that,
          new DragEvent(type2, {
            sourceEvent: event2,
            subject: s3,
            target: drag2,
            identifier,
            active: n,
            x: p2[0] + dx,
            y: p2[1] + dy,
            dx: p2[0] - p0[0],
            dy: p2[1] - p0[1],
            dispatch: dispatch2
          }),
          d
        );
      };
    }
    drag2.filter = function(_) {
      return arguments.length ? (filter7 = typeof _ === "function" ? _ : constant_default2(!!_), drag2) : filter7;
    };
    drag2.container = function(_) {
      return arguments.length ? (container = typeof _ === "function" ? _ : constant_default2(_), drag2) : container;
    };
    drag2.subject = function(_) {
      return arguments.length ? (subject = typeof _ === "function" ? _ : constant_default2(_), drag2) : subject;
    };
    drag2.touchable = function(_) {
      return arguments.length ? (touchable = typeof _ === "function" ? _ : constant_default2(!!_), drag2) : touchable;
    };
    drag2.on = function() {
      var value20 = listeners.on.apply(listeners, arguments);
      return value20 === listeners ? drag2 : value20;
    };
    drag2.clickDistance = function(_) {
      return arguments.length ? (clickDistance2 = (_ = +_) * _, drag2) : Math.sqrt(clickDistance2);
    };
    return drag2;
  }

  // node_modules/d3-color/src/define.js
  function define_default(constructor, factory, prototype) {
    constructor.prototype = factory.prototype = prototype;
    prototype.constructor = constructor;
  }
  function extend2(parent2, definition) {
    var prototype = Object.create(parent2.prototype);
    for (var key2 in definition) prototype[key2] = definition[key2];
    return prototype;
  }

  // node_modules/d3-color/src/color.js
  function Color() {
  }
  var darker = 0.7;
  var brighter = 1 / darker;
  var reI = "\\s*([+-]?\\d+)\\s*";
  var reN = "\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*";
  var reP = "\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*";
  var reHex = /^#([0-9a-f]{3,8})$/;
  var reRgbInteger = new RegExp(`^rgb\\(${reI},${reI},${reI}\\)$`);
  var reRgbPercent = new RegExp(`^rgb\\(${reP},${reP},${reP}\\)$`);
  var reRgbaInteger = new RegExp(`^rgba\\(${reI},${reI},${reI},${reN}\\)$`);
  var reRgbaPercent = new RegExp(`^rgba\\(${reP},${reP},${reP},${reN}\\)$`);
  var reHslPercent = new RegExp(`^hsl\\(${reN},${reP},${reP}\\)$`);
  var reHslaPercent = new RegExp(`^hsla\\(${reN},${reP},${reP},${reN}\\)$`);
  var named2 = {
    aliceblue: 15792383,
    antiquewhite: 16444375,
    aqua: 65535,
    aquamarine: 8388564,
    azure: 15794175,
    beige: 16119260,
    bisque: 16770244,
    black: 0,
    blanchedalmond: 16772045,
    blue: 255,
    blueviolet: 9055202,
    brown: 10824234,
    burlywood: 14596231,
    cadetblue: 6266528,
    chartreuse: 8388352,
    chocolate: 13789470,
    coral: 16744272,
    cornflowerblue: 6591981,
    cornsilk: 16775388,
    crimson: 14423100,
    cyan: 65535,
    darkblue: 139,
    darkcyan: 35723,
    darkgoldenrod: 12092939,
    darkgray: 11119017,
    darkgreen: 25600,
    darkgrey: 11119017,
    darkkhaki: 12433259,
    darkmagenta: 9109643,
    darkolivegreen: 5597999,
    darkorange: 16747520,
    darkorchid: 10040012,
    darkred: 9109504,
    darksalmon: 15308410,
    darkseagreen: 9419919,
    darkslateblue: 4734347,
    darkslategray: 3100495,
    darkslategrey: 3100495,
    darkturquoise: 52945,
    darkviolet: 9699539,
    deeppink: 16716947,
    deepskyblue: 49151,
    dimgray: 6908265,
    dimgrey: 6908265,
    dodgerblue: 2003199,
    firebrick: 11674146,
    floralwhite: 16775920,
    forestgreen: 2263842,
    fuchsia: 16711935,
    gainsboro: 14474460,
    ghostwhite: 16316671,
    gold: 16766720,
    goldenrod: 14329120,
    gray: 8421504,
    green: 32768,
    greenyellow: 11403055,
    grey: 8421504,
    honeydew: 15794160,
    hotpink: 16738740,
    indianred: 13458524,
    indigo: 4915330,
    ivory: 16777200,
    khaki: 15787660,
    lavender: 15132410,
    lavenderblush: 16773365,
    lawngreen: 8190976,
    lemonchiffon: 16775885,
    lightblue: 11393254,
    lightcoral: 15761536,
    lightcyan: 14745599,
    lightgoldenrodyellow: 16448210,
    lightgray: 13882323,
    lightgreen: 9498256,
    lightgrey: 13882323,
    lightpink: 16758465,
    lightsalmon: 16752762,
    lightseagreen: 2142890,
    lightskyblue: 8900346,
    lightslategray: 7833753,
    lightslategrey: 7833753,
    lightsteelblue: 11584734,
    lightyellow: 16777184,
    lime: 65280,
    limegreen: 3329330,
    linen: 16445670,
    magenta: 16711935,
    maroon: 8388608,
    mediumaquamarine: 6737322,
    mediumblue: 205,
    mediumorchid: 12211667,
    mediumpurple: 9662683,
    mediumseagreen: 3978097,
    mediumslateblue: 8087790,
    mediumspringgreen: 64154,
    mediumturquoise: 4772300,
    mediumvioletred: 13047173,
    midnightblue: 1644912,
    mintcream: 16121850,
    mistyrose: 16770273,
    moccasin: 16770229,
    navajowhite: 16768685,
    navy: 128,
    oldlace: 16643558,
    olive: 8421376,
    olivedrab: 7048739,
    orange: 16753920,
    orangered: 16729344,
    orchid: 14315734,
    palegoldenrod: 15657130,
    palegreen: 10025880,
    paleturquoise: 11529966,
    palevioletred: 14381203,
    papayawhip: 16773077,
    peachpuff: 16767673,
    peru: 13468991,
    pink: 16761035,
    plum: 14524637,
    powderblue: 11591910,
    purple: 8388736,
    rebeccapurple: 6697881,
    red: 16711680,
    rosybrown: 12357519,
    royalblue: 4286945,
    saddlebrown: 9127187,
    salmon: 16416882,
    sandybrown: 16032864,
    seagreen: 3050327,
    seashell: 16774638,
    sienna: 10506797,
    silver: 12632256,
    skyblue: 8900331,
    slateblue: 6970061,
    slategray: 7372944,
    slategrey: 7372944,
    snow: 16775930,
    springgreen: 65407,
    steelblue: 4620980,
    tan: 13808780,
    teal: 32896,
    thistle: 14204888,
    tomato: 16737095,
    turquoise: 4251856,
    violet: 15631086,
    wheat: 16113331,
    white: 16777215,
    whitesmoke: 16119285,
    yellow: 16776960,
    yellowgreen: 10145074
  };
  define_default(Color, color, {
    copy(channels) {
      return Object.assign(new this.constructor(), this, channels);
    },
    displayable() {
      return this.rgb().displayable();
    },
    hex: color_formatHex,
    // Deprecated! Use color.formatHex.
    formatHex: color_formatHex,
    formatHex8: color_formatHex8,
    formatHsl: color_formatHsl,
    formatRgb: color_formatRgb,
    toString: color_formatRgb
  });
  function color_formatHex() {
    return this.rgb().formatHex();
  }
  function color_formatHex8() {
    return this.rgb().formatHex8();
  }
  function color_formatHsl() {
    return hslConvert(this).formatHsl();
  }
  function color_formatRgb() {
    return this.rgb().formatRgb();
  }
  function color(format2) {
    var m2, l2;
    format2 = (format2 + "").trim().toLowerCase();
    return (m2 = reHex.exec(format2)) ? (l2 = m2[1].length, m2 = parseInt(m2[1], 16), l2 === 6 ? rgbn(m2) : l2 === 3 ? new Rgb(m2 >> 8 & 15 | m2 >> 4 & 240, m2 >> 4 & 15 | m2 & 240, (m2 & 15) << 4 | m2 & 15, 1) : l2 === 8 ? rgba(m2 >> 24 & 255, m2 >> 16 & 255, m2 >> 8 & 255, (m2 & 255) / 255) : l2 === 4 ? rgba(m2 >> 12 & 15 | m2 >> 8 & 240, m2 >> 8 & 15 | m2 >> 4 & 240, m2 >> 4 & 15 | m2 & 240, ((m2 & 15) << 4 | m2 & 15) / 255) : null) : (m2 = reRgbInteger.exec(format2)) ? new Rgb(m2[1], m2[2], m2[3], 1) : (m2 = reRgbPercent.exec(format2)) ? new Rgb(m2[1] * 255 / 100, m2[2] * 255 / 100, m2[3] * 255 / 100, 1) : (m2 = reRgbaInteger.exec(format2)) ? rgba(m2[1], m2[2], m2[3], m2[4]) : (m2 = reRgbaPercent.exec(format2)) ? rgba(m2[1] * 255 / 100, m2[2] * 255 / 100, m2[3] * 255 / 100, m2[4]) : (m2 = reHslPercent.exec(format2)) ? hsla(m2[1], m2[2] / 100, m2[3] / 100, 1) : (m2 = reHslaPercent.exec(format2)) ? hsla(m2[1], m2[2] / 100, m2[3] / 100, m2[4]) : named2.hasOwnProperty(format2) ? rgbn(named2[format2]) : format2 === "transparent" ? new Rgb(NaN, NaN, NaN, 0) : null;
  }
  function rgbn(n) {
    return new Rgb(n >> 16 & 255, n >> 8 & 255, n & 255, 1);
  }
  function rgba(r29, g2, b10, a3) {
    if (a3 <= 0) r29 = g2 = b10 = NaN;
    return new Rgb(r29, g2, b10, a3);
  }
  function rgbConvert(o) {
    if (!(o instanceof Color)) o = color(o);
    if (!o) return new Rgb();
    o = o.rgb();
    return new Rgb(o.r, o.g, o.b, o.opacity);
  }
  function rgb(r29, g2, b10, opacity14) {
    return arguments.length === 1 ? rgbConvert(r29) : new Rgb(r29, g2, b10, opacity14 == null ? 1 : opacity14);
  }
  function Rgb(r29, g2, b10, opacity14) {
    this.r = +r29;
    this.g = +g2;
    this.b = +b10;
    this.opacity = +opacity14;
  }
  define_default(Rgb, rgb, extend2(Color, {
    brighter(k) {
      k = k == null ? brighter : Math.pow(brighter, k);
      return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);
    },
    darker(k) {
      k = k == null ? darker : Math.pow(darker, k);
      return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);
    },
    rgb() {
      return this;
    },
    clamp() {
      return new Rgb(clampi(this.r), clampi(this.g), clampi(this.b), clampa(this.opacity));
    },
    displayable() {
      return -0.5 <= this.r && this.r < 255.5 && (-0.5 <= this.g && this.g < 255.5) && (-0.5 <= this.b && this.b < 255.5) && (0 <= this.opacity && this.opacity <= 1);
    },
    hex: rgb_formatHex,
    // Deprecated! Use color.formatHex.
    formatHex: rgb_formatHex,
    formatHex8: rgb_formatHex8,
    formatRgb: rgb_formatRgb,
    toString: rgb_formatRgb
  }));
  function rgb_formatHex() {
    return `#${hex(this.r)}${hex(this.g)}${hex(this.b)}`;
  }
  function rgb_formatHex8() {
    return `#${hex(this.r)}${hex(this.g)}${hex(this.b)}${hex((isNaN(this.opacity) ? 1 : this.opacity) * 255)}`;
  }
  function rgb_formatRgb() {
    const a3 = clampa(this.opacity);
    return `${a3 === 1 ? "rgb(" : "rgba("}${clampi(this.r)}, ${clampi(this.g)}, ${clampi(this.b)}${a3 === 1 ? ")" : `, ${a3})`}`;
  }
  function clampa(opacity14) {
    return isNaN(opacity14) ? 1 : Math.max(0, Math.min(1, opacity14));
  }
  function clampi(value20) {
    return Math.max(0, Math.min(255, Math.round(value20) || 0));
  }
  function hex(value20) {
    value20 = clampi(value20);
    return (value20 < 16 ? "0" : "") + value20.toString(16);
  }
  function hsla(h7, s3, l2, a3) {
    if (a3 <= 0) h7 = s3 = l2 = NaN;
    else if (l2 <= 0 || l2 >= 1) h7 = s3 = NaN;
    else if (s3 <= 0) h7 = NaN;
    return new Hsl(h7, s3, l2, a3);
  }
  function hslConvert(o) {
    if (o instanceof Hsl) return new Hsl(o.h, o.s, o.l, o.opacity);
    if (!(o instanceof Color)) o = color(o);
    if (!o) return new Hsl();
    if (o instanceof Hsl) return o;
    o = o.rgb();
    var r29 = o.r / 255, g2 = o.g / 255, b10 = o.b / 255, min18 = Math.min(r29, g2, b10), max25 = Math.max(r29, g2, b10), h7 = NaN, s3 = max25 - min18, l2 = (max25 + min18) / 2;
    if (s3) {
      if (r29 === max25) h7 = (g2 - b10) / s3 + (g2 < b10) * 6;
      else if (g2 === max25) h7 = (b10 - r29) / s3 + 2;
      else h7 = (r29 - g2) / s3 + 4;
      s3 /= l2 < 0.5 ? max25 + min18 : 2 - max25 - min18;
      h7 *= 60;
    } else {
      s3 = l2 > 0 && l2 < 1 ? 0 : h7;
    }
    return new Hsl(h7, s3, l2, o.opacity);
  }
  function hsl(h7, s3, l2, opacity14) {
    return arguments.length === 1 ? hslConvert(h7) : new Hsl(h7, s3, l2, opacity14 == null ? 1 : opacity14);
  }
  function Hsl(h7, s3, l2, opacity14) {
    this.h = +h7;
    this.s = +s3;
    this.l = +l2;
    this.opacity = +opacity14;
  }
  define_default(Hsl, hsl, extend2(Color, {
    brighter(k) {
      k = k == null ? brighter : Math.pow(brighter, k);
      return new Hsl(this.h, this.s, this.l * k, this.opacity);
    },
    darker(k) {
      k = k == null ? darker : Math.pow(darker, k);
      return new Hsl(this.h, this.s, this.l * k, this.opacity);
    },
    rgb() {
      var h7 = this.h % 360 + (this.h < 0) * 360, s3 = isNaN(h7) || isNaN(this.s) ? 0 : this.s, l2 = this.l, m2 = l2 + (l2 < 0.5 ? l2 : 1 - l2) * s3, m1 = 2 * l2 - m2;
      return new Rgb(
        hsl2rgb(h7 >= 240 ? h7 - 240 : h7 + 120, m1, m2),
        hsl2rgb(h7, m1, m2),
        hsl2rgb(h7 < 120 ? h7 + 240 : h7 - 120, m1, m2),
        this.opacity
      );
    },
    clamp() {
      return new Hsl(clamph(this.h), clampt(this.s), clampt(this.l), clampa(this.opacity));
    },
    displayable() {
      return (0 <= this.s && this.s <= 1 || isNaN(this.s)) && (0 <= this.l && this.l <= 1) && (0 <= this.opacity && this.opacity <= 1);
    },
    formatHsl() {
      const a3 = clampa(this.opacity);
      return `${a3 === 1 ? "hsl(" : "hsla("}${clamph(this.h)}, ${clampt(this.s) * 100}%, ${clampt(this.l) * 100}%${a3 === 1 ? ")" : `, ${a3})`}`;
    }
  }));
  function clamph(value20) {
    value20 = (value20 || 0) % 360;
    return value20 < 0 ? value20 + 360 : value20;
  }
  function clampt(value20) {
    return Math.max(0, Math.min(1, value20 || 0));
  }
  function hsl2rgb(h7, m1, m2) {
    return (h7 < 60 ? m1 + (m2 - m1) * h7 / 60 : h7 < 180 ? m2 : h7 < 240 ? m1 + (m2 - m1) * (240 - h7) / 60 : m1) * 255;
  }

  // node_modules/d3-interpolate/src/basis.js
  function basis(t12, v0, v1, v2, v3) {
    var t2 = t12 * t12, t3 = t2 * t12;
    return ((1 - 3 * t12 + 3 * t2 - t3) * v0 + (4 - 6 * t2 + 3 * t3) * v1 + (1 + 3 * t12 + 3 * t2 - 3 * t3) * v2 + t3 * v3) / 6;
  }
  function basis_default(values2) {
    var n = values2.length - 1;
    return function(t2) {
      var i2 = t2 <= 0 ? t2 = 0 : t2 >= 1 ? (t2 = 1, n - 1) : Math.floor(t2 * n), v1 = values2[i2], v2 = values2[i2 + 1], v0 = i2 > 0 ? values2[i2 - 1] : 2 * v1 - v2, v3 = i2 < n - 1 ? values2[i2 + 2] : 2 * v2 - v1;
      return basis((t2 - i2 / n) * n, v0, v1, v2, v3);
    };
  }

  // node_modules/d3-interpolate/src/basisClosed.js
  function basisClosed_default(values2) {
    var n = values2.length;
    return function(t2) {
      var i2 = Math.floor(((t2 %= 1) < 0 ? ++t2 : t2) * n), v0 = values2[(i2 + n - 1) % n], v1 = values2[i2 % n], v2 = values2[(i2 + 1) % n], v3 = values2[(i2 + 2) % n];
      return basis((t2 - i2 / n) * n, v0, v1, v2, v3);
    };
  }

  // node_modules/d3-interpolate/src/constant.js
  var constant_default3 = (x32) => () => x32;

  // node_modules/d3-interpolate/src/color.js
  function linear(a3, d) {
    return function(t2) {
      return a3 + t2 * d;
    };
  }
  function exponential(a3, b10, y32) {
    return a3 = Math.pow(a3, y32), b10 = Math.pow(b10, y32) - a3, y32 = 1 / y32, function(t2) {
      return Math.pow(a3 + t2 * b10, y32);
    };
  }
  function gamma(y32) {
    return (y32 = +y32) === 1 ? nogamma : function(a3, b10) {
      return b10 - a3 ? exponential(a3, b10, y32) : constant_default3(isNaN(a3) ? b10 : a3);
    };
  }
  function nogamma(a3, b10) {
    var d = b10 - a3;
    return d ? linear(a3, d) : constant_default3(isNaN(a3) ? b10 : a3);
  }

  // node_modules/d3-interpolate/src/rgb.js
  var rgb_default = (function rgbGamma(y32) {
    var color2 = gamma(y32);
    function rgb3(start4, end2) {
      var r29 = color2((start4 = rgb(start4)).r, (end2 = rgb(end2)).r), g2 = color2(start4.g, end2.g), b10 = color2(start4.b, end2.b), opacity14 = nogamma(start4.opacity, end2.opacity);
      return function(t2) {
        start4.r = r29(t2);
        start4.g = g2(t2);
        start4.b = b10(t2);
        start4.opacity = opacity14(t2);
        return start4 + "";
      };
    }
    rgb3.gamma = rgbGamma;
    return rgb3;
  })(1);
  function rgbSpline(spline) {
    return function(colors5) {
      var n = colors5.length, r29 = new Array(n), g2 = new Array(n), b10 = new Array(n), i2, color2;
      for (i2 = 0; i2 < n; ++i2) {
        color2 = rgb(colors5[i2]);
        r29[i2] = color2.r || 0;
        g2[i2] = color2.g || 0;
        b10[i2] = color2.b || 0;
      }
      r29 = spline(r29);
      g2 = spline(g2);
      b10 = spline(b10);
      color2.opacity = 1;
      return function(t2) {
        color2.r = r29(t2);
        color2.g = g2(t2);
        color2.b = b10(t2);
        return color2 + "";
      };
    };
  }
  var rgbBasis = rgbSpline(basis_default);
  var rgbBasisClosed = rgbSpline(basisClosed_default);

  // node_modules/d3-interpolate/src/numberArray.js
  function numberArray_default(a3, b10) {
    if (!b10) b10 = [];
    var n = a3 ? Math.min(b10.length, a3.length) : 0, c2 = b10.slice(), i2;
    return function(t2) {
      for (i2 = 0; i2 < n; ++i2) c2[i2] = a3[i2] * (1 - t2) + b10[i2] * t2;
      return c2;
    };
  }
  function isNumberArray(x32) {
    return ArrayBuffer.isView(x32) && !(x32 instanceof DataView);
  }

  // node_modules/d3-interpolate/src/array.js
  function genericArray(a3, b10) {
    var nb = b10 ? b10.length : 0, na = a3 ? Math.min(nb, a3.length) : 0, x32 = new Array(na), c2 = new Array(nb), i2;
    for (i2 = 0; i2 < na; ++i2) x32[i2] = value_default(a3[i2], b10[i2]);
    for (; i2 < nb; ++i2) c2[i2] = b10[i2];
    return function(t2) {
      for (i2 = 0; i2 < na; ++i2) c2[i2] = x32[i2](t2);
      return c2;
    };
  }

  // node_modules/d3-interpolate/src/date.js
  function date_default(a3, b10) {
    var d = /* @__PURE__ */ new Date();
    return a3 = +a3, b10 = +b10, function(t2) {
      return d.setTime(a3 * (1 - t2) + b10 * t2), d;
    };
  }

  // node_modules/d3-interpolate/src/number.js
  function number_default(a3, b10) {
    return a3 = +a3, b10 = +b10, function(t2) {
      return a3 * (1 - t2) + b10 * t2;
    };
  }

  // node_modules/d3-interpolate/src/object.js
  function object_default(a3, b10) {
    var i2 = {}, c2 = {}, k;
    if (a3 === null || typeof a3 !== "object") a3 = {};
    if (b10 === null || typeof b10 !== "object") b10 = {};
    for (k in b10) {
      if (k in a3) {
        i2[k] = value_default(a3[k], b10[k]);
      } else {
        c2[k] = b10[k];
      }
    }
    return function(t2) {
      for (k in i2) c2[k] = i2[k](t2);
      return c2;
    };
  }

  // node_modules/d3-interpolate/src/string.js
  var reA = /[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;
  var reB = new RegExp(reA.source, "g");
  function zero2(b10) {
    return function() {
      return b10;
    };
  }
  function one2(b10) {
    return function(t2) {
      return b10(t2) + "";
    };
  }
  function string_default(a3, b10) {
    var bi = reA.lastIndex = reB.lastIndex = 0, am, bm, bs, i2 = -1, s3 = [], q3 = [];
    a3 = a3 + "", b10 = b10 + "";
    while ((am = reA.exec(a3)) && (bm = reB.exec(b10))) {
      if ((bs = bm.index) > bi) {
        bs = b10.slice(bi, bs);
        if (s3[i2]) s3[i2] += bs;
        else s3[++i2] = bs;
      }
      if ((am = am[0]) === (bm = bm[0])) {
        if (s3[i2]) s3[i2] += bm;
        else s3[++i2] = bm;
      } else {
        s3[++i2] = null;
        q3.push({ i: i2, x: number_default(am, bm) });
      }
      bi = reB.lastIndex;
    }
    if (bi < b10.length) {
      bs = b10.slice(bi);
      if (s3[i2]) s3[i2] += bs;
      else s3[++i2] = bs;
    }
    return s3.length < 2 ? q3[0] ? one2(q3[0].x) : zero2(b10) : (b10 = q3.length, function(t2) {
      for (var i3 = 0, o; i3 < b10; ++i3) s3[(o = q3[i3]).i] = o.x(t2);
      return s3.join("");
    });
  }

  // node_modules/d3-interpolate/src/value.js
  function value_default(a3, b10) {
    var t2 = typeof b10, c2;
    return b10 == null || t2 === "boolean" ? constant_default3(b10) : (t2 === "number" ? number_default : t2 === "string" ? (c2 = color(b10)) ? (b10 = c2, rgb_default) : string_default : b10 instanceof color ? rgb_default : b10 instanceof Date ? date_default : isNumberArray(b10) ? numberArray_default : Array.isArray(b10) ? genericArray : typeof b10.valueOf !== "function" && typeof b10.toString !== "function" || isNaN(b10) ? object_default : number_default)(a3, b10);
  }

  // node_modules/d3-interpolate/src/round.js
  function round_default(a3, b10) {
    return a3 = +a3, b10 = +b10, function(t2) {
      return Math.round(a3 * (1 - t2) + b10 * t2);
    };
  }

  // node_modules/d3-interpolate/src/transform/decompose.js
  var degrees = 180 / Math.PI;
  var identity7 = {
    translateX: 0,
    translateY: 0,
    rotate: 0,
    skewX: 0,
    scaleX: 1,
    scaleY: 1
  };
  function decompose_default(a3, b10, c2, d, e, f) {
    var scaleX5, scaleY5, skewX;
    if (scaleX5 = Math.sqrt(a3 * a3 + b10 * b10)) a3 /= scaleX5, b10 /= scaleX5;
    if (skewX = a3 * c2 + b10 * d) c2 -= a3 * skewX, d -= b10 * skewX;
    if (scaleY5 = Math.sqrt(c2 * c2 + d * d)) c2 /= scaleY5, d /= scaleY5, skewX /= scaleY5;
    if (a3 * d < b10 * c2) a3 = -a3, b10 = -b10, skewX = -skewX, scaleX5 = -scaleX5;
    return {
      translateX: e,
      translateY: f,
      rotate: Math.atan2(b10, a3) * degrees,
      skewX: Math.atan(skewX) * degrees,
      scaleX: scaleX5,
      scaleY: scaleY5
    };
  }

  // node_modules/d3-interpolate/src/transform/parse.js
  var svgNode;
  function parseCss(value20) {
    const m2 = new (typeof DOMMatrix === "function" ? DOMMatrix : WebKitCSSMatrix)(value20 + "");
    return m2.isIdentity ? identity7 : decompose_default(m2.a, m2.b, m2.c, m2.d, m2.e, m2.f);
  }
  function parseSvg(value20) {
    if (value20 == null) return identity7;
    if (!svgNode) svgNode = document.createElementNS("http://www.w3.org/2000/svg", "g");
    svgNode.setAttribute("transform", value20);
    if (!(value20 = svgNode.transform.baseVal.consolidate())) return identity7;
    value20 = value20.matrix;
    return decompose_default(value20.a, value20.b, value20.c, value20.d, value20.e, value20.f);
  }

  // node_modules/d3-interpolate/src/transform/index.js
  function interpolateTransform(parse9, pxComma, pxParen, degParen) {
    function pop4(s3) {
      return s3.length ? s3.pop() + " " : "";
    }
    function translate(xa, ya, xb, yb, s3, q3) {
      if (xa !== xb || ya !== yb) {
        var i2 = s3.push("translate(", null, pxComma, null, pxParen);
        q3.push({ i: i2 - 4, x: number_default(xa, xb) }, { i: i2 - 2, x: number_default(ya, yb) });
      } else if (xb || yb) {
        s3.push("translate(" + xb + pxComma + yb + pxParen);
      }
    }
    function rotate(a3, b10, s3, q3) {
      if (a3 !== b10) {
        if (a3 - b10 > 180) b10 += 360;
        else if (b10 - a3 > 180) a3 += 360;
        q3.push({ i: s3.push(pop4(s3) + "rotate(", null, degParen) - 2, x: number_default(a3, b10) });
      } else if (b10) {
        s3.push(pop4(s3) + "rotate(" + b10 + degParen);
      }
    }
    function skewX(a3, b10, s3, q3) {
      if (a3 !== b10) {
        q3.push({ i: s3.push(pop4(s3) + "skewX(", null, degParen) - 2, x: number_default(a3, b10) });
      } else if (b10) {
        s3.push(pop4(s3) + "skewX(" + b10 + degParen);
      }
    }
    function scale(xa, ya, xb, yb, s3, q3) {
      if (xa !== xb || ya !== yb) {
        var i2 = s3.push(pop4(s3) + "scale(", null, ",", null, ")");
        q3.push({ i: i2 - 4, x: number_default(xa, xb) }, { i: i2 - 2, x: number_default(ya, yb) });
      } else if (xb !== 1 || yb !== 1) {
        s3.push(pop4(s3) + "scale(" + xb + "," + yb + ")");
      }
    }
    return function(a3, b10) {
      var s3 = [], q3 = [];
      a3 = parse9(a3), b10 = parse9(b10);
      translate(a3.translateX, a3.translateY, b10.translateX, b10.translateY, s3, q3);
      rotate(a3.rotate, b10.rotate, s3, q3);
      skewX(a3.skewX, b10.skewX, s3, q3);
      scale(a3.scaleX, a3.scaleY, b10.scaleX, b10.scaleY, s3, q3);
      a3 = b10 = null;
      return function(t2) {
        var i2 = -1, n = q3.length, o;
        while (++i2 < n) s3[(o = q3[i2]).i] = o.x(t2);
        return s3.join("");
      };
    };
  }
  var interpolateTransformCss = interpolateTransform(parseCss, "px, ", "px)", "deg)");
  var interpolateTransformSvg = interpolateTransform(parseSvg, ", ", ")", ")");

  // node_modules/d3-interpolate/src/zoom.js
  var epsilon2 = 1e-12;
  function cosh(x32) {
    return ((x32 = Math.exp(x32)) + 1 / x32) / 2;
  }
  function sinh(x32) {
    return ((x32 = Math.exp(x32)) - 1 / x32) / 2;
  }
  function tanh(x32) {
    return ((x32 = Math.exp(2 * x32)) - 1) / (x32 + 1);
  }
  var zoom_default = (function zoomRho(rho, rho2, rho4) {
    function zoom(p0, p1) {
      var ux0 = p0[0], uy0 = p0[1], w0 = p0[2], ux1 = p1[0], uy1 = p1[1], w1 = p1[2], dx = ux1 - ux0, dy = uy1 - uy0, d2 = dx * dx + dy * dy, i2, S;
      if (d2 < epsilon2) {
        S = Math.log(w1 / w0) / rho;
        i2 = function(t2) {
          return [
            ux0 + t2 * dx,
            uy0 + t2 * dy,
            w0 * Math.exp(rho * t2 * S)
          ];
        };
      } else {
        var d1 = Math.sqrt(d2), b02 = (w1 * w1 - w0 * w0 + rho4 * d2) / (2 * w0 * rho2 * d1), b12 = (w1 * w1 - w0 * w0 - rho4 * d2) / (2 * w1 * rho2 * d1), r0 = Math.log(Math.sqrt(b02 * b02 + 1) - b02), r1 = Math.log(Math.sqrt(b12 * b12 + 1) - b12);
        S = (r1 - r0) / rho;
        i2 = function(t2) {
          var s3 = t2 * S, coshr0 = cosh(r0), u2 = w0 / (rho2 * d1) * (coshr0 * tanh(rho * s3 + r0) - sinh(r0));
          return [
            ux0 + u2 * dx,
            uy0 + u2 * dy,
            w0 * coshr0 / cosh(rho * s3 + r0)
          ];
        };
      }
      i2.duration = S * 1e3 * rho / Math.SQRT2;
      return i2;
    }
    zoom.rho = function(_) {
      var _1 = Math.max(1e-3, +_), _2 = _1 * _1, _4 = _2 * _2;
      return zoomRho(_1, _2, _4);
    };
    return zoom;
  })(Math.SQRT2, 2, 4);

  // node_modules/d3-timer/src/timer.js
  var frame = 0;
  var timeout = 0;
  var interval = 0;
  var pokeDelay = 1e3;
  var taskHead;
  var taskTail;
  var clockLast = 0;
  var clockNow = 0;
  var clockSkew = 0;
  var clock = typeof performance === "object" && performance.now ? performance : Date;
  var setFrame = typeof window === "object" && window.requestAnimationFrame ? window.requestAnimationFrame.bind(window) : function(f) {
    setTimeout(f, 17);
  };
  function now() {
    return clockNow || (setFrame(clearNow), clockNow = clock.now() + clockSkew);
  }
  function clearNow() {
    clockNow = 0;
  }
  function Timer() {
    this._call = this._time = this._next = null;
  }
  Timer.prototype = timer.prototype = {
    constructor: Timer,
    restart: function(callback, delay2, time4) {
      if (typeof callback !== "function") throw new TypeError("callback is not a function");
      time4 = (time4 == null ? now() : +time4) + (delay2 == null ? 0 : +delay2);
      if (!this._next && taskTail !== this) {
        if (taskTail) taskTail._next = this;
        else taskHead = this;
        taskTail = this;
      }
      this._call = callback;
      this._time = time4;
      sleep();
    },
    stop: function() {
      if (this._call) {
        this._call = null;
        this._time = Infinity;
        sleep();
      }
    }
  };
  function timer(callback, delay2, time4) {
    var t2 = new Timer();
    t2.restart(callback, delay2, time4);
    return t2;
  }
  function timerFlush() {
    now();
    ++frame;
    var t2 = taskHead, e;
    while (t2) {
      if ((e = clockNow - t2._time) >= 0) t2._call.call(void 0, e);
      t2 = t2._next;
    }
    --frame;
  }
  function wake() {
    clockNow = (clockLast = clock.now()) + clockSkew;
    frame = timeout = 0;
    try {
      timerFlush();
    } finally {
      frame = 0;
      nap();
      clockNow = 0;
    }
  }
  function poke2() {
    var now3 = clock.now(), delay2 = now3 - clockLast;
    if (delay2 > pokeDelay) clockSkew -= delay2, clockLast = now3;
  }
  function nap() {
    var t02, t12 = taskHead, t2, time4 = Infinity;
    while (t12) {
      if (t12._call) {
        if (time4 > t12._time) time4 = t12._time;
        t02 = t12, t12 = t12._next;
      } else {
        t2 = t12._next, t12._next = null;
        t12 = t02 ? t02._next = t2 : taskHead = t2;
      }
    }
    taskTail = t02;
    sleep(time4);
  }
  function sleep(time4) {
    if (frame) return;
    if (timeout) timeout = clearTimeout(timeout);
    var delay2 = time4 - clockNow;
    if (delay2 > 24) {
      if (time4 < Infinity) timeout = setTimeout(wake, time4 - clock.now() - clockSkew);
      if (interval) interval = clearInterval(interval);
    } else {
      if (!interval) clockLast = clock.now(), interval = setInterval(poke2, pokeDelay);
      frame = 1, setFrame(wake);
    }
  }

  // node_modules/d3-timer/src/timeout.js
  function timeout_default(callback, delay2, time4) {
    var t2 = new Timer();
    delay2 = delay2 == null ? 0 : +delay2;
    t2.restart((elapsed) => {
      t2.stop();
      callback(elapsed + delay2);
    }, delay2, time4);
    return t2;
  }

  // node_modules/d3-transition/src/transition/schedule.js
  var emptyOn = dispatch_default2("start", "end", "cancel", "interrupt");
  var emptyTween = [];
  var CREATED = 0;
  var SCHEDULED = 1;
  var STARTING = 2;
  var STARTED = 3;
  var RUNNING = 4;
  var ENDING = 5;
  var ENDED = 6;
  function schedule_default(node, name16, id5, index7, group4, timing) {
    var schedules = node.__transition;
    if (!schedules) node.__transition = {};
    else if (id5 in schedules) return;
    create(node, id5, {
      name: name16,
      index: index7,
      // For context during callback.
      group: group4,
      // For context during callback.
      on: emptyOn,
      tween: emptyTween,
      time: timing.time,
      delay: timing.delay,
      duration: timing.duration,
      ease: timing.ease,
      timer: null,
      state: CREATED
    });
  }
  function init(node, id5) {
    var schedule = get3(node, id5);
    if (schedule.state > CREATED) throw new Error("too late; already scheduled");
    return schedule;
  }
  function set2(node, id5) {
    var schedule = get3(node, id5);
    if (schedule.state > STARTED) throw new Error("too late; already running");
    return schedule;
  }
  function get3(node, id5) {
    var schedule = node.__transition;
    if (!schedule || !(schedule = schedule[id5])) throw new Error("transition not found");
    return schedule;
  }
  function create(node, id5, self) {
    var schedules = node.__transition, tween;
    schedules[id5] = self;
    self.timer = timer(schedule, 0, self.time);
    function schedule(elapsed) {
      self.state = SCHEDULED;
      self.timer.restart(start4, self.delay, self.time);
      if (self.delay <= elapsed) start4(elapsed - self.delay);
    }
    function start4(elapsed) {
      var i2, j, n, o;
      if (self.state !== SCHEDULED) return stop2();
      for (i2 in schedules) {
        o = schedules[i2];
        if (o.name !== self.name) continue;
        if (o.state === STARTED) return timeout_default(start4);
        if (o.state === RUNNING) {
          o.state = ENDED;
          o.timer.stop();
          o.on.call("interrupt", node, node.__data__, o.index, o.group);
          delete schedules[i2];
        } else if (+i2 < id5) {
          o.state = ENDED;
          o.timer.stop();
          o.on.call("cancel", node, node.__data__, o.index, o.group);
          delete schedules[i2];
        }
      }
      timeout_default(function() {
        if (self.state === STARTED) {
          self.state = RUNNING;
          self.timer.restart(tick5, self.delay, self.time);
          tick5(elapsed);
        }
      });
      self.state = STARTING;
      self.on.call("start", node, node.__data__, self.index, self.group);
      if (self.state !== STARTING) return;
      self.state = STARTED;
      tween = new Array(n = self.tween.length);
      for (i2 = 0, j = -1; i2 < n; ++i2) {
        if (o = self.tween[i2].value.call(node, node.__data__, self.index, self.group)) {
          tween[++j] = o;
        }
      }
      tween.length = j + 1;
    }
    function tick5(elapsed) {
      var t2 = elapsed < self.duration ? self.ease.call(null, elapsed / self.duration) : (self.timer.restart(stop2), self.state = ENDING, 1), i2 = -1, n = tween.length;
      while (++i2 < n) {
        tween[i2].call(node, t2);
      }
      if (self.state === ENDING) {
        self.on.call("end", node, node.__data__, self.index, self.group);
        stop2();
      }
    }
    function stop2() {
      self.state = ENDED;
      self.timer.stop();
      delete schedules[id5];
      for (var i2 in schedules) return;
      delete node.__transition;
    }
  }

  // node_modules/d3-transition/src/interrupt.js
  function interrupt_default(node, name16) {
    var schedules = node.__transition, schedule, active, empty10 = true, i2;
    if (!schedules) return;
    name16 = name16 == null ? null : name16 + "";
    for (i2 in schedules) {
      if ((schedule = schedules[i2]).name !== name16) {
        empty10 = false;
        continue;
      }
      active = schedule.state > STARTING && schedule.state < ENDING;
      schedule.state = ENDED;
      schedule.timer.stop();
      schedule.on.call(active ? "interrupt" : "cancel", node, node.__data__, schedule.index, schedule.group);
      delete schedules[i2];
    }
    if (empty10) delete node.__transition;
  }

  // node_modules/d3-transition/src/selection/interrupt.js
  function interrupt_default2(name16) {
    return this.each(function() {
      interrupt_default(this, name16);
    });
  }

  // node_modules/d3-transition/src/transition/tween.js
  function tweenRemove(id5, name16) {
    var tween0, tween1;
    return function() {
      var schedule = set2(this, id5), tween = schedule.tween;
      if (tween !== tween0) {
        tween1 = tween0 = tween;
        for (var i2 = 0, n = tween1.length; i2 < n; ++i2) {
          if (tween1[i2].name === name16) {
            tween1 = tween1.slice();
            tween1.splice(i2, 1);
            break;
          }
        }
      }
      schedule.tween = tween1;
    };
  }
  function tweenFunction(id5, name16, value20) {
    var tween0, tween1;
    if (typeof value20 !== "function") throw new Error();
    return function() {
      var schedule = set2(this, id5), tween = schedule.tween;
      if (tween !== tween0) {
        tween1 = (tween0 = tween).slice();
        for (var t2 = { name: name16, value: value20 }, i2 = 0, n = tween1.length; i2 < n; ++i2) {
          if (tween1[i2].name === name16) {
            tween1[i2] = t2;
            break;
          }
        }
        if (i2 === n) tween1.push(t2);
      }
      schedule.tween = tween1;
    };
  }
  function tween_default(name16, value20) {
    var id5 = this._id;
    name16 += "";
    if (arguments.length < 2) {
      var tween = get3(this.node(), id5).tween;
      for (var i2 = 0, n = tween.length, t2; i2 < n; ++i2) {
        if ((t2 = tween[i2]).name === name16) {
          return t2.value;
        }
      }
      return null;
    }
    return this.each((value20 == null ? tweenRemove : tweenFunction)(id5, name16, value20));
  }
  function tweenValue(transition3, name16, value20) {
    var id5 = transition3._id;
    transition3.each(function() {
      var schedule = set2(this, id5);
      (schedule.value || (schedule.value = {}))[name16] = value20.apply(this, arguments);
    });
    return function(node) {
      return get3(node, id5).value[name16];
    };
  }

  // node_modules/d3-transition/src/transition/interpolate.js
  function interpolate_default(a3, b10) {
    var c2;
    return (typeof b10 === "number" ? number_default : b10 instanceof color ? rgb_default : (c2 = color(b10)) ? (b10 = c2, rgb_default) : string_default)(a3, b10);
  }

  // node_modules/d3-transition/src/transition/attr.js
  function attrRemove2(name16) {
    return function() {
      this.removeAttribute(name16);
    };
  }
  function attrRemoveNS2(fullname) {
    return function() {
      this.removeAttributeNS(fullname.space, fullname.local);
    };
  }
  function attrConstant2(name16, interpolate, value1) {
    var string00, string1 = value1 + "", interpolate0;
    return function() {
      var string0 = this.getAttribute(name16);
      return string0 === string1 ? null : string0 === string00 ? interpolate0 : interpolate0 = interpolate(string00 = string0, value1);
    };
  }
  function attrConstantNS2(fullname, interpolate, value1) {
    var string00, string1 = value1 + "", interpolate0;
    return function() {
      var string0 = this.getAttributeNS(fullname.space, fullname.local);
      return string0 === string1 ? null : string0 === string00 ? interpolate0 : interpolate0 = interpolate(string00 = string0, value1);
    };
  }
  function attrFunction2(name16, interpolate, value20) {
    var string00, string10, interpolate0;
    return function() {
      var string0, value1 = value20(this), string1;
      if (value1 == null) return void this.removeAttribute(name16);
      string0 = this.getAttribute(name16);
      string1 = value1 + "";
      return string0 === string1 ? null : string0 === string00 && string1 === string10 ? interpolate0 : (string10 = string1, interpolate0 = interpolate(string00 = string0, value1));
    };
  }
  function attrFunctionNS2(fullname, interpolate, value20) {
    var string00, string10, interpolate0;
    return function() {
      var string0, value1 = value20(this), string1;
      if (value1 == null) return void this.removeAttributeNS(fullname.space, fullname.local);
      string0 = this.getAttributeNS(fullname.space, fullname.local);
      string1 = value1 + "";
      return string0 === string1 ? null : string0 === string00 && string1 === string10 ? interpolate0 : (string10 = string1, interpolate0 = interpolate(string00 = string0, value1));
    };
  }
  function attr_default2(name16, value20) {
    var fullname = namespace_default(name16), i2 = fullname === "transform" ? interpolateTransformSvg : interpolate_default;
    return this.attrTween(name16, typeof value20 === "function" ? (fullname.local ? attrFunctionNS2 : attrFunction2)(fullname, i2, tweenValue(this, "attr." + name16, value20)) : value20 == null ? (fullname.local ? attrRemoveNS2 : attrRemove2)(fullname) : (fullname.local ? attrConstantNS2 : attrConstant2)(fullname, i2, value20));
  }

  // node_modules/d3-transition/src/transition/attrTween.js
  function attrInterpolate(name16, i2) {
    return function(t2) {
      this.setAttribute(name16, i2.call(this, t2));
    };
  }
  function attrInterpolateNS(fullname, i2) {
    return function(t2) {
      this.setAttributeNS(fullname.space, fullname.local, i2.call(this, t2));
    };
  }
  function attrTweenNS(fullname, value20) {
    var t02, i0;
    function tween() {
      var i2 = value20.apply(this, arguments);
      if (i2 !== i0) t02 = (i0 = i2) && attrInterpolateNS(fullname, i2);
      return t02;
    }
    tween._value = value20;
    return tween;
  }
  function attrTween(name16, value20) {
    var t02, i0;
    function tween() {
      var i2 = value20.apply(this, arguments);
      if (i2 !== i0) t02 = (i0 = i2) && attrInterpolate(name16, i2);
      return t02;
    }
    tween._value = value20;
    return tween;
  }
  function attrTween_default(name16, value20) {
    var key2 = "attr." + name16;
    if (arguments.length < 2) return (key2 = this.tween(key2)) && key2._value;
    if (value20 == null) return this.tween(key2, null);
    if (typeof value20 !== "function") throw new Error();
    var fullname = namespace_default(name16);
    return this.tween(key2, (fullname.local ? attrTweenNS : attrTween)(fullname, value20));
  }

  // node_modules/d3-transition/src/transition/delay.js
  function delayFunction(id5, value20) {
    return function() {
      init(this, id5).delay = +value20.apply(this, arguments);
    };
  }
  function delayConstant(id5, value20) {
    return value20 = +value20, function() {
      init(this, id5).delay = value20;
    };
  }
  function delay_default(value20) {
    var id5 = this._id;
    return arguments.length ? this.each((typeof value20 === "function" ? delayFunction : delayConstant)(id5, value20)) : get3(this.node(), id5).delay;
  }

  // node_modules/d3-transition/src/transition/duration.js
  function durationFunction(id5, value20) {
    return function() {
      set2(this, id5).duration = +value20.apply(this, arguments);
    };
  }
  function durationConstant(id5, value20) {
    return value20 = +value20, function() {
      set2(this, id5).duration = value20;
    };
  }
  function duration_default(value20) {
    var id5 = this._id;
    return arguments.length ? this.each((typeof value20 === "function" ? durationFunction : durationConstant)(id5, value20)) : get3(this.node(), id5).duration;
  }

  // node_modules/d3-transition/src/transition/ease.js
  function easeConstant(id5, value20) {
    if (typeof value20 !== "function") throw new Error();
    return function() {
      set2(this, id5).ease = value20;
    };
  }
  function ease_default(value20) {
    var id5 = this._id;
    return arguments.length ? this.each(easeConstant(id5, value20)) : get3(this.node(), id5).ease;
  }

  // node_modules/d3-transition/src/transition/easeVarying.js
  function easeVarying(id5, value20) {
    return function() {
      var v2 = value20.apply(this, arguments);
      if (typeof v2 !== "function") throw new Error();
      set2(this, id5).ease = v2;
    };
  }
  function easeVarying_default(value20) {
    if (typeof value20 !== "function") throw new Error();
    return this.each(easeVarying(this._id, value20));
  }

  // node_modules/d3-transition/src/transition/filter.js
  function filter_default2(match3) {
    if (typeof match3 !== "function") match3 = matcher_default(match3);
    for (var groups = this._groups, m2 = groups.length, subgroups = new Array(m2), j = 0; j < m2; ++j) {
      for (var group4 = groups[j], n = group4.length, subgroup = subgroups[j] = [], node, i2 = 0; i2 < n; ++i2) {
        if ((node = group4[i2]) && match3.call(node, node.__data__, i2, group4)) {
          subgroup.push(node);
        }
      }
    }
    return new Transition(subgroups, this._parents, this._name, this._id);
  }

  // node_modules/d3-transition/src/transition/merge.js
  function merge_default2(transition3) {
    if (transition3._id !== this._id) throw new Error();
    for (var groups0 = this._groups, groups1 = transition3._groups, m0 = groups0.length, m1 = groups1.length, m2 = Math.min(m0, m1), merges = new Array(m0), j = 0; j < m2; ++j) {
      for (var group0 = groups0[j], group1 = groups1[j], n = group0.length, merge3 = merges[j] = new Array(n), node, i2 = 0; i2 < n; ++i2) {
        if (node = group0[i2] || group1[i2]) {
          merge3[i2] = node;
        }
      }
    }
    for (; j < m0; ++j) {
      merges[j] = groups0[j];
    }
    return new Transition(merges, this._parents, this._name, this._id);
  }

  // node_modules/d3-transition/src/transition/on.js
  function start(name16) {
    return (name16 + "").trim().split(/^|\s+/).every(function(t2) {
      var i2 = t2.indexOf(".");
      if (i2 >= 0) t2 = t2.slice(0, i2);
      return !t2 || t2 === "start";
    });
  }
  function onFunction(id5, name16, listener) {
    var on0, on1, sit = start(name16) ? init : set2;
    return function() {
      var schedule = sit(this, id5), on5 = schedule.on;
      if (on5 !== on0) (on1 = (on0 = on5).copy()).on(name16, listener);
      schedule.on = on1;
    };
  }
  function on_default2(name16, listener) {
    var id5 = this._id;
    return arguments.length < 2 ? get3(this.node(), id5).on.on(name16) : this.each(onFunction(id5, name16, listener));
  }

  // node_modules/d3-transition/src/transition/remove.js
  function removeFunction(id5) {
    return function() {
      var parent2 = this.parentNode;
      for (var i2 in this.__transition) if (+i2 !== id5) return;
      if (parent2) parent2.removeChild(this);
    };
  }
  function remove_default2() {
    return this.on("end.remove", removeFunction(this._id));
  }

  // node_modules/d3-transition/src/transition/select.js
  function select_default3(select53) {
    var name16 = this._name, id5 = this._id;
    if (typeof select53 !== "function") select53 = selector_default(select53);
    for (var groups = this._groups, m2 = groups.length, subgroups = new Array(m2), j = 0; j < m2; ++j) {
      for (var group4 = groups[j], n = group4.length, subgroup = subgroups[j] = new Array(n), node, subnode, i2 = 0; i2 < n; ++i2) {
        if ((node = group4[i2]) && (subnode = select53.call(node, node.__data__, i2, group4))) {
          if ("__data__" in node) subnode.__data__ = node.__data__;
          subgroup[i2] = subnode;
          schedule_default(subgroup[i2], name16, id5, i2, subgroup, get3(node, id5));
        }
      }
    }
    return new Transition(subgroups, this._parents, name16, id5);
  }

  // node_modules/d3-transition/src/transition/selectAll.js
  function selectAll_default2(select53) {
    var name16 = this._name, id5 = this._id;
    if (typeof select53 !== "function") select53 = selectorAll_default(select53);
    for (var groups = this._groups, m2 = groups.length, subgroups = [], parents = [], j = 0; j < m2; ++j) {
      for (var group4 = groups[j], n = group4.length, node, i2 = 0; i2 < n; ++i2) {
        if (node = group4[i2]) {
          for (var children3 = select53.call(node, node.__data__, i2, group4), child, inherit2 = get3(node, id5), k = 0, l2 = children3.length; k < l2; ++k) {
            if (child = children3[k]) {
              schedule_default(child, name16, id5, k, children3, inherit2);
            }
          }
          subgroups.push(children3);
          parents.push(node);
        }
      }
    }
    return new Transition(subgroups, parents, name16, id5);
  }

  // node_modules/d3-transition/src/transition/selection.js
  var Selection2 = selection_default.prototype.constructor;
  function selection_default2() {
    return new Selection2(this._groups, this._parents);
  }

  // node_modules/d3-transition/src/transition/style.js
  function styleNull(name16, interpolate) {
    var string00, string10, interpolate0;
    return function() {
      var string0 = styleValue(this, name16), string1 = (this.style.removeProperty(name16), styleValue(this, name16));
      return string0 === string1 ? null : string0 === string00 && string1 === string10 ? interpolate0 : interpolate0 = interpolate(string00 = string0, string10 = string1);
    };
  }
  function styleRemove2(name16) {
    return function() {
      this.style.removeProperty(name16);
    };
  }
  function styleConstant2(name16, interpolate, value1) {
    var string00, string1 = value1 + "", interpolate0;
    return function() {
      var string0 = styleValue(this, name16);
      return string0 === string1 ? null : string0 === string00 ? interpolate0 : interpolate0 = interpolate(string00 = string0, value1);
    };
  }
  function styleFunction2(name16, interpolate, value20) {
    var string00, string10, interpolate0;
    return function() {
      var string0 = styleValue(this, name16), value1 = value20(this), string1 = value1 + "";
      if (value1 == null) string1 = value1 = (this.style.removeProperty(name16), styleValue(this, name16));
      return string0 === string1 ? null : string0 === string00 && string1 === string10 ? interpolate0 : (string10 = string1, interpolate0 = interpolate(string00 = string0, value1));
    };
  }
  function styleMaybeRemove(id5, name16) {
    var on0, on1, listener0, key2 = "style." + name16, event = "end." + key2, remove7;
    return function() {
      var schedule = set2(this, id5), on5 = schedule.on, listener = schedule.value[key2] == null ? remove7 || (remove7 = styleRemove2(name16)) : void 0;
      if (on5 !== on0 || listener0 !== listener) (on1 = (on0 = on5).copy()).on(event, listener0 = listener);
      schedule.on = on1;
    };
  }
  function style_default2(name16, value20, priority) {
    var i2 = (name16 += "") === "transform" ? interpolateTransformCss : interpolate_default;
    return value20 == null ? this.styleTween(name16, styleNull(name16, i2)).on("end.style." + name16, styleRemove2(name16)) : typeof value20 === "function" ? this.styleTween(name16, styleFunction2(name16, i2, tweenValue(this, "style." + name16, value20))).each(styleMaybeRemove(this._id, name16)) : this.styleTween(name16, styleConstant2(name16, i2, value20), priority).on("end.style." + name16, null);
  }

  // node_modules/d3-transition/src/transition/styleTween.js
  function styleInterpolate(name16, i2, priority) {
    return function(t2) {
      this.style.setProperty(name16, i2.call(this, t2), priority);
    };
  }
  function styleTween(name16, value20, priority) {
    var t2, i0;
    function tween() {
      var i2 = value20.apply(this, arguments);
      if (i2 !== i0) t2 = (i0 = i2) && styleInterpolate(name16, i2, priority);
      return t2;
    }
    tween._value = value20;
    return tween;
  }
  function styleTween_default(name16, value20, priority) {
    var key2 = "style." + (name16 += "");
    if (arguments.length < 2) return (key2 = this.tween(key2)) && key2._value;
    if (value20 == null) return this.tween(key2, null);
    if (typeof value20 !== "function") throw new Error();
    return this.tween(key2, styleTween(name16, value20, priority == null ? "" : priority));
  }

  // node_modules/d3-transition/src/transition/text.js
  function textConstant2(value20) {
    return function() {
      this.textContent = value20;
    };
  }
  function textFunction2(value20) {
    return function() {
      var value1 = value20(this);
      this.textContent = value1 == null ? "" : value1;
    };
  }
  function text_default2(value20) {
    return this.tween("text", typeof value20 === "function" ? textFunction2(tweenValue(this, "text", value20)) : textConstant2(value20 == null ? "" : value20 + ""));
  }

  // node_modules/d3-transition/src/transition/textTween.js
  function textInterpolate(i2) {
    return function(t2) {
      this.textContent = i2.call(this, t2);
    };
  }
  function textTween(value20) {
    var t02, i0;
    function tween() {
      var i2 = value20.apply(this, arguments);
      if (i2 !== i0) t02 = (i0 = i2) && textInterpolate(i2);
      return t02;
    }
    tween._value = value20;
    return tween;
  }
  function textTween_default(value20) {
    var key2 = "text";
    if (arguments.length < 1) return (key2 = this.tween(key2)) && key2._value;
    if (value20 == null) return this.tween(key2, null);
    if (typeof value20 !== "function") throw new Error();
    return this.tween(key2, textTween(value20));
  }

  // node_modules/d3-transition/src/transition/transition.js
  function transition_default() {
    var name16 = this._name, id0 = this._id, id1 = newId();
    for (var groups = this._groups, m2 = groups.length, j = 0; j < m2; ++j) {
      for (var group4 = groups[j], n = group4.length, node, i2 = 0; i2 < n; ++i2) {
        if (node = group4[i2]) {
          var inherit2 = get3(node, id0);
          schedule_default(node, name16, id1, i2, group4, {
            time: inherit2.time + inherit2.delay + inherit2.duration,
            delay: 0,
            duration: inherit2.duration,
            ease: inherit2.ease
          });
        }
      }
    }
    return new Transition(groups, this._parents, name16, id1);
  }

  // node_modules/d3-transition/src/transition/end.js
  function end_default() {
    var on0, on1, that = this, id5 = that._id, size6 = that.size();
    return new Promise(function(resolve, reject) {
      var cancel = { value: reject }, end2 = { value: function() {
        if (--size6 === 0) resolve();
      } };
      that.each(function() {
        var schedule = set2(this, id5), on5 = schedule.on;
        if (on5 !== on0) {
          on1 = (on0 = on5).copy();
          on1._.cancel.push(cancel);
          on1._.interrupt.push(cancel);
          on1._.end.push(end2);
        }
        schedule.on = on1;
      });
      if (size6 === 0) resolve();
    });
  }

  // node_modules/d3-transition/src/transition/index.js
  var id = 0;
  function Transition(groups, parents, name16, id5) {
    this._groups = groups;
    this._parents = parents;
    this._name = name16;
    this._id = id5;
  }
  function transition2(name16) {
    return selection_default().transition(name16);
  }
  function newId() {
    return ++id;
  }
  var selection_prototype = selection_default.prototype;
  Transition.prototype = transition2.prototype = {
    constructor: Transition,
    select: select_default3,
    selectAll: selectAll_default2,
    selectChild: selection_prototype.selectChild,
    selectChildren: selection_prototype.selectChildren,
    filter: filter_default2,
    merge: merge_default2,
    selection: selection_default2,
    transition: transition_default,
    call: selection_prototype.call,
    nodes: selection_prototype.nodes,
    node: selection_prototype.node,
    size: selection_prototype.size,
    empty: selection_prototype.empty,
    each: selection_prototype.each,
    on: on_default2,
    attr: attr_default2,
    attrTween: attrTween_default,
    style: style_default2,
    styleTween: styleTween_default,
    text: text_default2,
    textTween: textTween_default,
    remove: remove_default2,
    tween: tween_default,
    delay: delay_default,
    duration: duration_default,
    ease: ease_default,
    easeVarying: easeVarying_default,
    end: end_default,
    [Symbol.iterator]: selection_prototype[Symbol.iterator]
  };

  // node_modules/d3-ease/src/linear.js
  var linear2 = (t2) => +t2;

  // node_modules/d3-ease/src/quad.js
  function quadIn(t2) {
    return t2 * t2;
  }
  function quadOut(t2) {
    return t2 * (2 - t2);
  }
  function quadInOut(t2) {
    return ((t2 *= 2) <= 1 ? t2 * t2 : --t2 * (2 - t2) + 1) / 2;
  }

  // node_modules/d3-ease/src/cubic.js
  function cubicIn(t2) {
    return t2 * t2 * t2;
  }
  function cubicOut(t2) {
    return --t2 * t2 * t2 + 1;
  }
  function cubicInOut(t2) {
    return ((t2 *= 2) <= 1 ? t2 * t2 * t2 : (t2 -= 2) * t2 * t2 + 2) / 2;
  }

  // node_modules/d3-ease/src/sin.js
  var pi2 = Math.PI;
  var halfPi = pi2 / 2;
  function sinIn(t2) {
    return +t2 === 1 ? 1 : 1 - Math.cos(t2 * halfPi);
  }
  function sinOut(t2) {
    return Math.sin(t2 * halfPi);
  }
  function sinInOut(t2) {
    return (1 - Math.cos(pi2 * t2)) / 2;
  }

  // node_modules/d3-ease/src/math.js
  function tpmt(x32) {
    return (Math.pow(2, -10 * x32) - 9765625e-10) * 1.0009775171065494;
  }

  // node_modules/d3-ease/src/exp.js
  function expIn(t2) {
    return tpmt(1 - +t2);
  }
  function expOut(t2) {
    return 1 - tpmt(t2);
  }
  function expInOut(t2) {
    return ((t2 *= 2) <= 1 ? tpmt(1 - t2) : 2 - tpmt(t2 - 1)) / 2;
  }

  // node_modules/d3-ease/src/circle.js
  function circleIn(t2) {
    return 1 - Math.sqrt(1 - t2 * t2);
  }
  function circleOut(t2) {
    return Math.sqrt(1 - --t2 * t2);
  }
  function circleInOut(t2) {
    return ((t2 *= 2) <= 1 ? 1 - Math.sqrt(1 - t2 * t2) : Math.sqrt(1 - (t2 -= 2) * t2) + 1) / 2;
  }

  // node_modules/d3-ease/src/bounce.js
  var b1 = 4 / 11;
  var b2 = 6 / 11;
  var b3 = 8 / 11;
  var b4 = 3 / 4;
  var b5 = 9 / 11;
  var b6 = 10 / 11;
  var b7 = 15 / 16;
  var b8 = 21 / 22;
  var b9 = 63 / 64;
  var b0 = 1 / b1 / b1;
  function bounceIn(t2) {
    return 1 - bounceOut(1 - t2);
  }
  function bounceOut(t2) {
    return (t2 = +t2) < b1 ? b0 * t2 * t2 : t2 < b3 ? b0 * (t2 -= b2) * t2 + b4 : t2 < b6 ? b0 * (t2 -= b5) * t2 + b7 : b0 * (t2 -= b8) * t2 + b9;
  }
  function bounceInOut(t2) {
    return ((t2 *= 2) <= 1 ? 1 - bounceOut(1 - t2) : bounceOut(t2 - 1) + 1) / 2;
  }

  // node_modules/d3-ease/src/back.js
  var overshoot = 1.70158;
  var backIn = (function custom(s3) {
    s3 = +s3;
    function backIn2(t2) {
      return (t2 = +t2) * t2 * (s3 * (t2 - 1) + t2);
    }
    backIn2.overshoot = custom;
    return backIn2;
  })(overshoot);
  var backOut = (function custom2(s3) {
    s3 = +s3;
    function backOut2(t2) {
      return --t2 * t2 * ((t2 + 1) * s3 + t2) + 1;
    }
    backOut2.overshoot = custom2;
    return backOut2;
  })(overshoot);
  var backInOut = (function custom3(s3) {
    s3 = +s3;
    function backInOut2(t2) {
      return ((t2 *= 2) < 1 ? t2 * t2 * ((s3 + 1) * t2 - s3) : (t2 -= 2) * t2 * ((s3 + 1) * t2 + s3) + 2) / 2;
    }
    backInOut2.overshoot = custom3;
    return backInOut2;
  })(overshoot);

  // node_modules/d3-ease/src/elastic.js
  var tau = 2 * Math.PI;
  var amplitude = 1;
  var period = 0.3;
  var elasticIn = (function custom4(a3, p2) {
    var s3 = Math.asin(1 / (a3 = Math.max(1, a3))) * (p2 /= tau);
    function elasticIn2(t2) {
      return a3 * tpmt(- --t2) * Math.sin((s3 - t2) / p2);
    }
    elasticIn2.amplitude = function(a4) {
      return custom4(a4, p2 * tau);
    };
    elasticIn2.period = function(p3) {
      return custom4(a3, p3);
    };
    return elasticIn2;
  })(amplitude, period);
  var elasticOut = (function custom5(a3, p2) {
    var s3 = Math.asin(1 / (a3 = Math.max(1, a3))) * (p2 /= tau);
    function elasticOut2(t2) {
      return 1 - a3 * tpmt(t2 = +t2) * Math.sin((t2 + s3) / p2);
    }
    elasticOut2.amplitude = function(a4) {
      return custom5(a4, p2 * tau);
    };
    elasticOut2.period = function(p3) {
      return custom5(a3, p3);
    };
    return elasticOut2;
  })(amplitude, period);
  var elasticInOut = (function custom6(a3, p2) {
    var s3 = Math.asin(1 / (a3 = Math.max(1, a3))) * (p2 /= tau);
    function elasticInOut2(t2) {
      return ((t2 = t2 * 2 - 1) < 0 ? a3 * tpmt(-t2) * Math.sin((s3 - t2) / p2) : 2 - a3 * tpmt(t2) * Math.sin((s3 + t2) / p2)) / 2;
    }
    elasticInOut2.amplitude = function(a4) {
      return custom6(a4, p2 * tau);
    };
    elasticInOut2.period = function(p3) {
      return custom6(a3, p3);
    };
    return elasticInOut2;
  })(amplitude, period);

  // node_modules/d3-transition/src/selection/transition.js
  var defaultTiming = {
    time: null,
    // Set on use.
    delay: 0,
    duration: 250,
    ease: cubicInOut
  };
  function inherit(node, id5) {
    var timing;
    while (!(timing = node.__transition) || !(timing = timing[id5])) {
      if (!(node = node.parentNode)) {
        throw new Error(`transition ${id5} not found`);
      }
    }
    return timing;
  }
  function transition_default2(name16) {
    var id5, timing;
    if (name16 instanceof Transition) {
      id5 = name16._id, name16 = name16._name;
    } else {
      id5 = newId(), (timing = defaultTiming).time = now(), name16 = name16 == null ? null : name16 + "";
    }
    for (var groups = this._groups, m2 = groups.length, j = 0; j < m2; ++j) {
      for (var group4 = groups[j], n = group4.length, node, i2 = 0; i2 < n; ++i2) {
        if (node = group4[i2]) {
          schedule_default(node, name16, id5, i2, group4, timing || inherit(node, id5));
        }
      }
    }
    return new Transition(groups, this._parents, name16, id5);
  }

  // node_modules/d3-transition/src/selection/index.js
  selection_default.prototype.interrupt = interrupt_default2;
  selection_default.prototype.transition = transition_default2;

  // node_modules/d3-zoom/src/constant.js
  var constant_default4 = (x32) => () => x32;

  // node_modules/d3-zoom/src/event.js
  function ZoomEvent(type2, {
    sourceEvent,
    target: target7,
    transform: transform17,
    dispatch: dispatch2
  }) {
    Object.defineProperties(this, {
      type: { value: type2, enumerable: true, configurable: true },
      sourceEvent: { value: sourceEvent, enumerable: true, configurable: true },
      target: { value: target7, enumerable: true, configurable: true },
      transform: { value: transform17, enumerable: true, configurable: true },
      _: { value: dispatch2 }
    });
  }

  // node_modules/d3-zoom/src/transform.js
  function Transform(k, x32, y32) {
    this.k = k;
    this.x = x32;
    this.y = y32;
  }
  Transform.prototype = {
    constructor: Transform,
    scale: function(k) {
      return k === 1 ? this : new Transform(this.k * k, this.x, this.y);
    },
    translate: function(x32, y32) {
      return x32 === 0 & y32 === 0 ? this : new Transform(this.k, this.x + this.k * x32, this.y + this.k * y32);
    },
    apply: function(point3) {
      return [point3[0] * this.k + this.x, point3[1] * this.k + this.y];
    },
    applyX: function(x32) {
      return x32 * this.k + this.x;
    },
    applyY: function(y32) {
      return y32 * this.k + this.y;
    },
    invert: function(location2) {
      return [(location2[0] - this.x) / this.k, (location2[1] - this.y) / this.k];
    },
    invertX: function(x32) {
      return (x32 - this.x) / this.k;
    },
    invertY: function(y32) {
      return (y32 - this.y) / this.k;
    },
    rescaleX: function(x32) {
      return x32.copy().domain(x32.range().map(this.invertX, this).map(x32.invert, x32));
    },
    rescaleY: function(y32) {
      return y32.copy().domain(y32.range().map(this.invertY, this).map(y32.invert, y32));
    },
    toString: function() {
      return "translate(" + this.x + "," + this.y + ") scale(" + this.k + ")";
    }
  };
  var identity8 = new Transform(1, 0, 0);
  transform.prototype = Transform.prototype;
  function transform(node) {
    while (!node.__zoom) if (!(node = node.parentNode)) return identity8;
    return node.__zoom;
  }

  // node_modules/d3-zoom/src/noevent.js
  function nopropagation2(event) {
    event.stopImmediatePropagation();
  }
  function noevent_default2(event) {
    event.preventDefault();
    event.stopImmediatePropagation();
  }

  // node_modules/d3-zoom/src/zoom.js
  function defaultFilter2(event) {
    return (!event.ctrlKey || event.type === "wheel") && !event.button;
  }
  function defaultExtent() {
    var e = this;
    if (e instanceof SVGElement) {
      e = e.ownerSVGElement || e;
      if (e.hasAttribute("viewBox")) {
        e = e.viewBox.baseVal;
        return [[e.x, e.y], [e.x + e.width, e.y + e.height]];
      }
      return [[0, 0], [e.width.baseVal.value, e.height.baseVal.value]];
    }
    return [[0, 0], [e.clientWidth, e.clientHeight]];
  }
  function defaultTransform() {
    return this.__zoom || identity8;
  }
  function defaultWheelDelta(event) {
    return -event.deltaY * (event.deltaMode === 1 ? 0.05 : event.deltaMode ? 1 : 2e-3) * (event.ctrlKey ? 10 : 1);
  }
  function defaultTouchable2() {
    return navigator.maxTouchPoints || "ontouchstart" in this;
  }
  function defaultConstrain(transform17, extent2, translateExtent) {
    var dx0 = transform17.invertX(extent2[0][0]) - translateExtent[0][0], dx1 = transform17.invertX(extent2[1][0]) - translateExtent[1][0], dy0 = transform17.invertY(extent2[0][1]) - translateExtent[0][1], dy1 = transform17.invertY(extent2[1][1]) - translateExtent[1][1];
    return transform17.translate(
      dx1 > dx0 ? (dx0 + dx1) / 2 : Math.min(0, dx0) || Math.max(0, dx1),
      dy1 > dy0 ? (dy0 + dy1) / 2 : Math.min(0, dy0) || Math.max(0, dy1)
    );
  }
  function zoom_default2() {
    var filter7 = defaultFilter2, extent2 = defaultExtent, constrain = defaultConstrain, wheelDelta = defaultWheelDelta, touchable = defaultTouchable2, scaleExtent = [0, Infinity], translateExtent = [[-Infinity, -Infinity], [Infinity, Infinity]], duration2 = 250, interpolate = zoom_default, listeners = dispatch_default2("start", "zoom", "end"), touchstarting, touchfirst, touchending, touchDelay = 500, wheelDelay = 150, clickDistance2 = 0, tapDistance = 10;
    function zoom(selection2) {
      selection2.property("__zoom", defaultTransform).on("wheel.zoom", wheeled, { passive: false }).on("mousedown.zoom", mousedowned).on("dblclick.zoom", dblclicked).filter(touchable).on("touchstart.zoom", touchstarted).on("touchmove.zoom", touchmoved).on("touchend.zoom touchcancel.zoom", touchended).style("-webkit-tap-highlight-color", "rgba(0,0,0,0)");
    }
    zoom.transform = function(collection, transform17, point3, event) {
      var selection2 = collection.selection ? collection.selection() : collection;
      selection2.property("__zoom", defaultTransform);
      if (collection !== selection2) {
        schedule(collection, transform17, point3, event);
      } else {
        selection2.interrupt().each(function() {
          gesture(this, arguments).event(event).start().zoom(null, typeof transform17 === "function" ? transform17.apply(this, arguments) : transform17).end();
        });
      }
    };
    zoom.scaleBy = function(selection2, k, p2, event) {
      zoom.scaleTo(selection2, function() {
        var k0 = this.__zoom.k, k1 = typeof k === "function" ? k.apply(this, arguments) : k;
        return k0 * k1;
      }, p2, event);
    };
    zoom.scaleTo = function(selection2, k, p2, event) {
      zoom.transform(selection2, function() {
        var e = extent2.apply(this, arguments), t02 = this.__zoom, p0 = p2 == null ? centroid(e) : typeof p2 === "function" ? p2.apply(this, arguments) : p2, p1 = t02.invert(p0), k1 = typeof k === "function" ? k.apply(this, arguments) : k;
        return constrain(translate(scale(t02, k1), p0, p1), e, translateExtent);
      }, p2, event);
    };
    zoom.translateBy = function(selection2, x32, y32, event) {
      zoom.transform(selection2, function() {
        return constrain(this.__zoom.translate(
          typeof x32 === "function" ? x32.apply(this, arguments) : x32,
          typeof y32 === "function" ? y32.apply(this, arguments) : y32
        ), extent2.apply(this, arguments), translateExtent);
      }, null, event);
    };
    zoom.translateTo = function(selection2, x32, y32, p2, event) {
      zoom.transform(selection2, function() {
        var e = extent2.apply(this, arguments), t2 = this.__zoom, p0 = p2 == null ? centroid(e) : typeof p2 === "function" ? p2.apply(this, arguments) : p2;
        return constrain(identity8.translate(p0[0], p0[1]).scale(t2.k).translate(
          typeof x32 === "function" ? -x32.apply(this, arguments) : -x32,
          typeof y32 === "function" ? -y32.apply(this, arguments) : -y32
        ), e, translateExtent);
      }, p2, event);
    };
    function scale(transform17, k) {
      k = Math.max(scaleExtent[0], Math.min(scaleExtent[1], k));
      return k === transform17.k ? transform17 : new Transform(k, transform17.x, transform17.y);
    }
    function translate(transform17, p0, p1) {
      var x32 = p0[0] - p1[0] * transform17.k, y32 = p0[1] - p1[1] * transform17.k;
      return x32 === transform17.x && y32 === transform17.y ? transform17 : new Transform(transform17.k, x32, y32);
    }
    function centroid(extent3) {
      return [(+extent3[0][0] + +extent3[1][0]) / 2, (+extent3[0][1] + +extent3[1][1]) / 2];
    }
    function schedule(transition3, transform17, point3, event) {
      transition3.on("start.zoom", function() {
        gesture(this, arguments).event(event).start();
      }).on("interrupt.zoom end.zoom", function() {
        gesture(this, arguments).event(event).end();
      }).tween("zoom", function() {
        var that = this, args = arguments, g2 = gesture(that, args).event(event), e = extent2.apply(that, args), p2 = point3 == null ? centroid(e) : typeof point3 === "function" ? point3.apply(that, args) : point3, w = Math.max(e[1][0] - e[0][0], e[1][1] - e[0][1]), a3 = that.__zoom, b10 = typeof transform17 === "function" ? transform17.apply(that, args) : transform17, i2 = interpolate(a3.invert(p2).concat(w / a3.k), b10.invert(p2).concat(w / b10.k));
        return function(t2) {
          if (t2 === 1) t2 = b10;
          else {
            var l2 = i2(t2), k = w / l2[2];
            t2 = new Transform(k, p2[0] - l2[0] * k, p2[1] - l2[1] * k);
          }
          g2.zoom(null, t2);
        };
      });
    }
    function gesture(that, args, clean) {
      return !clean && that.__zooming || new Gesture(that, args);
    }
    function Gesture(that, args) {
      this.that = that;
      this.args = args;
      this.active = 0;
      this.sourceEvent = null;
      this.extent = extent2.apply(that, args);
      this.taps = 0;
    }
    Gesture.prototype = {
      event: function(event) {
        if (event) this.sourceEvent = event;
        return this;
      },
      start: function() {
        if (++this.active === 1) {
          this.that.__zooming = this;
          this.emit("start");
        }
        return this;
      },
      zoom: function(key2, transform17) {
        if (this.mouse && key2 !== "mouse") this.mouse[1] = transform17.invert(this.mouse[0]);
        if (this.touch0 && key2 !== "touch") this.touch0[1] = transform17.invert(this.touch0[0]);
        if (this.touch1 && key2 !== "touch") this.touch1[1] = transform17.invert(this.touch1[0]);
        this.that.__zoom = transform17;
        this.emit("zoom");
        return this;
      },
      end: function() {
        if (--this.active === 0) {
          delete this.that.__zooming;
          this.emit("end");
        }
        return this;
      },
      emit: function(type2) {
        var d = select_default2(this.that).datum();
        listeners.call(
          type2,
          this.that,
          new ZoomEvent(type2, {
            sourceEvent: this.sourceEvent,
            target: zoom,
            type: type2,
            transform: this.that.__zoom,
            dispatch: listeners
          }),
          d
        );
      }
    };
    function wheeled(event, ...args) {
      if (!filter7.apply(this, arguments)) return;
      var g2 = gesture(this, args).event(event), t2 = this.__zoom, k = Math.max(scaleExtent[0], Math.min(scaleExtent[1], t2.k * Math.pow(2, wheelDelta.apply(this, arguments)))), p2 = pointer_default(event);
      if (g2.wheel) {
        if (g2.mouse[0][0] !== p2[0] || g2.mouse[0][1] !== p2[1]) {
          g2.mouse[1] = t2.invert(g2.mouse[0] = p2);
        }
        clearTimeout(g2.wheel);
      } else if (t2.k === k) return;
      else {
        g2.mouse = [p2, t2.invert(p2)];
        interrupt_default(this);
        g2.start();
      }
      noevent_default2(event);
      g2.wheel = setTimeout(wheelidled, wheelDelay);
      g2.zoom("mouse", constrain(translate(scale(t2, k), g2.mouse[0], g2.mouse[1]), g2.extent, translateExtent));
      function wheelidled() {
        g2.wheel = null;
        g2.end();
      }
    }
    function mousedowned(event, ...args) {
      if (touchending || !filter7.apply(this, arguments)) return;
      var currentTarget2 = event.currentTarget, g2 = gesture(this, args, true).event(event), v2 = select_default2(event.view).on("mousemove.zoom", mousemoved, true).on("mouseup.zoom", mouseupped, true), p2 = pointer_default(event, currentTarget2), x0 = event.clientX, y0 = event.clientY;
      nodrag_default(event.view);
      nopropagation2(event);
      g2.mouse = [p2, this.__zoom.invert(p2)];
      interrupt_default(this);
      g2.start();
      function mousemoved(event2) {
        noevent_default2(event2);
        if (!g2.moved) {
          var dx = event2.clientX - x0, dy = event2.clientY - y0;
          g2.moved = dx * dx + dy * dy > clickDistance2;
        }
        g2.event(event2).zoom("mouse", constrain(translate(g2.that.__zoom, g2.mouse[0] = pointer_default(event2, currentTarget2), g2.mouse[1]), g2.extent, translateExtent));
      }
      function mouseupped(event2) {
        v2.on("mousemove.zoom mouseup.zoom", null);
        yesdrag(event2.view, g2.moved);
        noevent_default2(event2);
        g2.event(event2).end();
      }
    }
    function dblclicked(event, ...args) {
      if (!filter7.apply(this, arguments)) return;
      var t02 = this.__zoom, p0 = pointer_default(event.changedTouches ? event.changedTouches[0] : event, this), p1 = t02.invert(p0), k1 = t02.k * (event.shiftKey ? 0.5 : 2), t12 = constrain(translate(scale(t02, k1), p0, p1), extent2.apply(this, args), translateExtent);
      noevent_default2(event);
      if (duration2 > 0) select_default2(this).transition().duration(duration2).call(schedule, t12, p0, event);
      else select_default2(this).call(zoom.transform, t12, p0, event);
    }
    function touchstarted(event, ...args) {
      if (!filter7.apply(this, arguments)) return;
      var touches = event.touches, n = touches.length, g2 = gesture(this, args, event.changedTouches.length === n).event(event), started, i2, t2, p2;
      nopropagation2(event);
      for (i2 = 0; i2 < n; ++i2) {
        t2 = touches[i2], p2 = pointer_default(t2, this);
        p2 = [p2, this.__zoom.invert(p2), t2.identifier];
        if (!g2.touch0) g2.touch0 = p2, started = true, g2.taps = 1 + !!touchstarting;
        else if (!g2.touch1 && g2.touch0[2] !== p2[2]) g2.touch1 = p2, g2.taps = 0;
      }
      if (touchstarting) touchstarting = clearTimeout(touchstarting);
      if (started) {
        if (g2.taps < 2) touchfirst = p2[0], touchstarting = setTimeout(function() {
          touchstarting = null;
        }, touchDelay);
        interrupt_default(this);
        g2.start();
      }
    }
    function touchmoved(event, ...args) {
      if (!this.__zooming) return;
      var g2 = gesture(this, args).event(event), touches = event.changedTouches, n = touches.length, i2, t2, p2, l2;
      noevent_default2(event);
      for (i2 = 0; i2 < n; ++i2) {
        t2 = touches[i2], p2 = pointer_default(t2, this);
        if (g2.touch0 && g2.touch0[2] === t2.identifier) g2.touch0[0] = p2;
        else if (g2.touch1 && g2.touch1[2] === t2.identifier) g2.touch1[0] = p2;
      }
      t2 = g2.that.__zoom;
      if (g2.touch1) {
        var p0 = g2.touch0[0], l0 = g2.touch0[1], p1 = g2.touch1[0], l1 = g2.touch1[1], dp = (dp = p1[0] - p0[0]) * dp + (dp = p1[1] - p0[1]) * dp, dl2 = (dl2 = l1[0] - l0[0]) * dl2 + (dl2 = l1[1] - l0[1]) * dl2;
        t2 = scale(t2, Math.sqrt(dp / dl2));
        p2 = [(p0[0] + p1[0]) / 2, (p0[1] + p1[1]) / 2];
        l2 = [(l0[0] + l1[0]) / 2, (l0[1] + l1[1]) / 2];
      } else if (g2.touch0) p2 = g2.touch0[0], l2 = g2.touch0[1];
      else return;
      g2.zoom("touch", constrain(translate(t2, p2, l2), g2.extent, translateExtent));
    }
    function touchended(event, ...args) {
      if (!this.__zooming) return;
      var g2 = gesture(this, args).event(event), touches = event.changedTouches, n = touches.length, i2, t2;
      nopropagation2(event);
      if (touchending) clearTimeout(touchending);
      touchending = setTimeout(function() {
        touchending = null;
      }, touchDelay);
      for (i2 = 0; i2 < n; ++i2) {
        t2 = touches[i2];
        if (g2.touch0 && g2.touch0[2] === t2.identifier) delete g2.touch0;
        else if (g2.touch1 && g2.touch1[2] === t2.identifier) delete g2.touch1;
      }
      if (g2.touch1 && !g2.touch0) g2.touch0 = g2.touch1, delete g2.touch1;
      if (g2.touch0) g2.touch0[1] = this.__zoom.invert(g2.touch0[0]);
      else {
        g2.end();
        if (g2.taps === 2) {
          t2 = pointer_default(t2, this);
          if (Math.hypot(touchfirst[0] - t2[0], touchfirst[1] - t2[1]) < tapDistance) {
            var p2 = select_default2(this).on("dblclick.zoom");
            if (p2) p2.apply(this, arguments);
          }
        }
      }
    }
    zoom.wheelDelta = function(_) {
      return arguments.length ? (wheelDelta = typeof _ === "function" ? _ : constant_default4(+_), zoom) : wheelDelta;
    };
    zoom.filter = function(_) {
      return arguments.length ? (filter7 = typeof _ === "function" ? _ : constant_default4(!!_), zoom) : filter7;
    };
    zoom.touchable = function(_) {
      return arguments.length ? (touchable = typeof _ === "function" ? _ : constant_default4(!!_), zoom) : touchable;
    };
    zoom.extent = function(_) {
      return arguments.length ? (extent2 = typeof _ === "function" ? _ : constant_default4([[+_[0][0], +_[0][1]], [+_[1][0], +_[1][1]]]), zoom) : extent2;
    };
    zoom.scaleExtent = function(_) {
      return arguments.length ? (scaleExtent[0] = +_[0], scaleExtent[1] = +_[1], zoom) : [scaleExtent[0], scaleExtent[1]];
    };
    zoom.translateExtent = function(_) {
      return arguments.length ? (translateExtent[0][0] = +_[0][0], translateExtent[1][0] = +_[1][0], translateExtent[0][1] = +_[0][1], translateExtent[1][1] = +_[1][1], zoom) : [[translateExtent[0][0], translateExtent[0][1]], [translateExtent[1][0], translateExtent[1][1]]];
    };
    zoom.constrain = function(_) {
      return arguments.length ? (constrain = _, zoom) : constrain;
    };
    zoom.duration = function(_) {
      return arguments.length ? (duration2 = +_, zoom) : duration2;
    };
    zoom.interpolate = function(_) {
      return arguments.length ? (interpolate = _, zoom) : interpolate;
    };
    zoom.on = function() {
      var value20 = listeners.on.apply(listeners, arguments);
      return value20 === listeners ? zoom : value20;
    };
    zoom.clickDistance = function(_) {
      return arguments.length ? (clickDistance2 = (_ = +_) * _, zoom) : Math.sqrt(clickDistance2);
    };
    zoom.tapDistance = function(_) {
      return arguments.length ? (tapDistance = +_, zoom) : tapDistance;
    };
    return zoom;
  }

  // output/PSD3.Internal.Behavior.FFI/foreign.js
  var simulationRegistry = /* @__PURE__ */ new Map();
  function registerSimulation_(simId) {
    return (reheatFn) => () => {
      simulationRegistry.set(simId, { reheat: reheatFn });
      console.log(`[SimRegistry] Registered simulation: ${simId}`);
    };
  }
  function unregisterSimulation_(simId) {
    return () => {
      simulationRegistry.delete(simId);
      console.log(`[SimRegistry] Unregistered simulation: ${simId}`);
    };
  }
  function getSimulationReheat(simId) {
    const sim = simulationRegistry.get(simId);
    return sim ? sim.reheat : null;
  }
  function attachSimulationDragById_(element4) {
    return (simId) => () => {
      const selection2 = select_default2(element4);
      function dragstarted(event) {
        const reheat2 = getSimulationReheat(simId);
        if (reheat2) {
          reheat2();
        } else {
          console.warn(`[SimulationDrag] No simulation registered with ID: ${simId}`);
        }
        event.subject.fx = event.subject.x;
        event.subject.fy = event.subject.y;
      }
      function dragged(event) {
        event.subject.fx = event.x;
        event.subject.fy = event.y;
      }
      function dragended(event) {
        event.subject.fx = null;
        event.subject.fy = null;
      }
      const dragBehavior = drag_default().on("start", dragstarted).on("drag", dragged).on("end", dragended);
      selection2.call(dragBehavior).style("cursor", "grab");
      return element4;
    };
  }
  function attachSimulationDragNestedById_(element4) {
    return (simId) => () => {
      const selection2 = select_default2(element4);
      function dragstarted(event) {
        const reheat2 = getSimulationReheat(simId);
        if (reheat2) {
          reheat2();
        } else {
          console.warn(`[SimulationDragNested] No simulation registered with ID: ${simId}`);
        }
        const node = event.subject.node;
        node.fx = node.x;
        node.fy = node.y;
      }
      function dragged(event) {
        const node = event.subject.node;
        node.fx = event.x;
        node.fy = event.y;
      }
      function dragended(event) {
        const node = event.subject.node;
        node.fx = null;
        node.fy = null;
      }
      const dragBehavior = drag_default().on("start", dragstarted).on("drag", dragged).on("end", dragended);
      selection2.call(dragBehavior).style("cursor", "grab");
      return element4;
    };
  }
  function attachZoom_(element4) {
    return (scaleMin) => (scaleMax) => (targetSelector) => () => {
      const selection2 = select_default2(element4);
      function zoomed(event) {
        const target7 = selection2.select(targetSelector);
        target7.attr("transform", event.transform);
      }
      const zoomBehavior = zoom_default2().scaleExtent([scaleMin, scaleMax]).on("zoom", zoomed);
      selection2.call(zoomBehavior);
      return element4;
    };
  }
  function attachSimpleDrag_(element4) {
    return () => () => {
      const selection2 = select_default2(element4);
      let transform17 = { x: 0, y: 0 };
      function dragstarted(event) {
        select_default2(this).raise();
      }
      function dragged(event) {
        transform17.x += event.dx;
        transform17.y += event.dy;
        select_default2(this).attr("transform", `translate(${transform17.x},${transform17.y})`);
      }
      const dragBehavior = drag_default().on("start", dragstarted).on("drag", dragged);
      selection2.call(dragBehavior);
      return element4;
    };
  }
  function attachClick_(element4) {
    return (handler3) => () => {
      const selection2 = select_default2(element4);
      selection2.on("click", function(event) {
        handler3();
      });
      selection2.style("cursor", "pointer");
      return element4;
    };
  }
  function attachClickWithDatum_(element4) {
    return (handler3) => () => {
      const selection2 = select_default2(element4);
      selection2.on("click", function(event, d) {
        handler3(d)();
      });
      selection2.style("cursor", "pointer");
      return element4;
    };
  }
  function attachMouseEnter_(element4) {
    return (handler3) => () => {
      const selection2 = select_default2(element4);
      selection2.on("mouseenter", function(event, d) {
        handler3(d)();
      });
      return element4;
    };
  }
  function attachMouseLeave_(element4) {
    return (handler3) => () => {
      const selection2 = select_default2(element4);
      selection2.on("mouseleave", function(event, d) {
        handler3(d)();
      });
      return element4;
    };
  }
  function attachHighlight_(element4) {
    return (enterStyles) => (leaveStyles) => () => {
      const selection2 = select_default2(element4);
      selection2.on("mouseenter", function(event) {
        const sel = select_default2(this);
        sel.raise();
        enterStyles.forEach((style3) => {
          sel.attr(style3.attr, style3.value);
        });
      });
      selection2.on("mouseleave", function(event) {
        const sel = select_default2(this);
        leaveStyles.forEach((style3) => {
          sel.attr(style3.attr, style3.value);
        });
      });
      return element4;
    };
  }
  function attachMouseMoveWithEvent_(element4) {
    return (handler3) => () => {
      element4.addEventListener("mousemove", function(event) {
        const datum2 = this.__data__;
        handler3(datum2, event);
      });
      return element4;
    };
  }
  function attachMouseEnterWithEvent_(element4) {
    return (handler3) => () => {
      element4.addEventListener("mouseenter", function(event) {
        const datum2 = this.__data__;
        handler3(datum2, event);
      });
      return element4;
    };
  }
  function attachMouseLeaveWithEvent_(element4) {
    return (handler3) => () => {
      element4.addEventListener("mouseleave", function(event) {
        const datum2 = this.__data__;
        handler3(datum2, event);
      });
      return element4;
    };
  }

  // output/PSD3.Internal.Behavior.Types/index.js
  var ScaleExtent = /* @__PURE__ */ (function() {
    function ScaleExtent2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    ScaleExtent2.create = function(value0) {
      return function(value1) {
        return new ScaleExtent2(value0, value1);
      };
    };
    return ScaleExtent2;
  })();
  var SimpleDrag = /* @__PURE__ */ (function() {
    function SimpleDrag2() {
    }
    ;
    SimpleDrag2.value = new SimpleDrag2();
    return SimpleDrag2;
  })();
  var SimulationDrag = /* @__PURE__ */ (function() {
    function SimulationDrag2(value0) {
      this.value0 = value0;
    }
    ;
    SimulationDrag2.create = function(value0) {
      return new SimulationDrag2(value0);
    };
    return SimulationDrag2;
  })();
  var SimulationDragNested = /* @__PURE__ */ (function() {
    function SimulationDragNested2(value0) {
      this.value0 = value0;
    }
    ;
    SimulationDragNested2.create = function(value0) {
      return new SimulationDragNested2(value0);
    };
    return SimulationDragNested2;
  })();
  var Zoom = /* @__PURE__ */ (function() {
    function Zoom2(value0) {
      this.value0 = value0;
    }
    ;
    Zoom2.create = function(value0) {
      return new Zoom2(value0);
    };
    return Zoom2;
  })();
  var Drag = /* @__PURE__ */ (function() {
    function Drag2(value0) {
      this.value0 = value0;
    }
    ;
    Drag2.create = function(value0) {
      return new Drag2(value0);
    };
    return Drag2;
  })();
  var Click = /* @__PURE__ */ (function() {
    function Click2(value0) {
      this.value0 = value0;
    }
    ;
    Click2.create = function(value0) {
      return new Click2(value0);
    };
    return Click2;
  })();
  var ClickWithDatum = /* @__PURE__ */ (function() {
    function ClickWithDatum2(value0) {
      this.value0 = value0;
    }
    ;
    ClickWithDatum2.create = function(value0) {
      return new ClickWithDatum2(value0);
    };
    return ClickWithDatum2;
  })();
  var MouseEnter = /* @__PURE__ */ (function() {
    function MouseEnter2(value0) {
      this.value0 = value0;
    }
    ;
    MouseEnter2.create = function(value0) {
      return new MouseEnter2(value0);
    };
    return MouseEnter2;
  })();
  var MouseLeave = /* @__PURE__ */ (function() {
    function MouseLeave2(value0) {
      this.value0 = value0;
    }
    ;
    MouseLeave2.create = function(value0) {
      return new MouseLeave2(value0);
    };
    return MouseLeave2;
  })();
  var Highlight = /* @__PURE__ */ (function() {
    function Highlight2(value0) {
      this.value0 = value0;
    }
    ;
    Highlight2.create = function(value0) {
      return new Highlight2(value0);
    };
    return Highlight2;
  })();
  var MouseMoveWithInfo = /* @__PURE__ */ (function() {
    function MouseMoveWithInfo2(value0) {
      this.value0 = value0;
    }
    ;
    MouseMoveWithInfo2.create = function(value0) {
      return new MouseMoveWithInfo2(value0);
    };
    return MouseMoveWithInfo2;
  })();
  var MouseEnterWithInfo = /* @__PURE__ */ (function() {
    function MouseEnterWithInfo2(value0) {
      this.value0 = value0;
    }
    ;
    MouseEnterWithInfo2.create = function(value0) {
      return new MouseEnterWithInfo2(value0);
    };
    return MouseEnterWithInfo2;
  })();
  var MouseLeaveWithInfo = /* @__PURE__ */ (function() {
    function MouseLeaveWithInfo2(value0) {
      this.value0 = value0;
    }
    ;
    MouseLeaveWithInfo2.create = function(value0) {
      return new MouseLeaveWithInfo2(value0);
    };
    return MouseLeaveWithInfo2;
  })();
  var onMouseMoveWithInfo = /* @__PURE__ */ (function() {
    return MouseMoveWithInfo.create;
  })();
  var onMouseLeaveWithInfo = /* @__PURE__ */ (function() {
    return MouseLeaveWithInfo.create;
  })();
  var defaultZoom = function(scaleExtent) {
    return function(targetSelector) {
      return {
        scaleExtent,
        targetSelector
      };
    };
  };

  // output/PSD3.Internal.Selection.Join/index.js
  var unsafeIndex2 = /* @__PURE__ */ unsafeIndex();
  var foldlWithIndex2 = /* @__PURE__ */ foldlWithIndex(foldableWithIndexArray);
  var computeJoinWithKey = function(dictEq) {
    var eq20 = eq(dictEq);
    return function(newData) {
      return function(oldBindings) {
        return function(keyFn) {
          var processNewDatum = function(newIndex) {
            return function(state3) {
              return function(datum2) {
                var newKey = keyFn(datum2);
                var v2 = findIndex(function(v1) {
                  return eq20(keyFn(v1.datum))(newKey);
                })(state3.remainingOld);
                if (v2 instanceof Nothing) {
                  var enterBinding = {
                    datum: datum2,
                    newIndex
                  };
                  return {
                    remainingOld: state3.remainingOld,
                    matchedIndices: state3.matchedIndices,
                    update: state3.update,
                    enter: cons2(enterBinding)(state3.enter)
                  };
                }
                ;
                if (v2 instanceof Just) {
                  var newRemaining = fromMaybe(state3.remainingOld)(deleteAt(v2.value0)(state3.remainingOld));
                  var matched = unsafeIndex2(state3.remainingOld)(v2.value0);
                  var updateBinding = {
                    element: matched.element,
                    oldDatum: datum2,
                    newDatum: datum2,
                    newIndex
                  };
                  return {
                    enter: state3.enter,
                    update: cons2(updateBinding)(state3.update),
                    remainingOld: newRemaining,
                    matchedIndices: cons2(v2.value0)(state3.matchedIndices)
                  };
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Join (line 167, column 9 - line 189, column 18): " + [v2.constructor.name]);
              };
            };
          };
          var matchResult = foldlWithIndex2(processNewDatum)({
            remainingOld: oldBindings,
            enter: [],
            update: [],
            matchedIndices: []
          })(newData);
          return {
            enter: reverse2(matchResult.enter),
            update: reverse2(matchResult.update),
            exit: matchResult.remainingOld
          };
        };
      };
    };
  };
  var computeJoin = function(dictEq) {
    var eq20 = eq(dictEq);
    return function(newData) {
      return function(oldBindings) {
        var processNewDatum = function(newIndex) {
          return function(state3) {
            return function(datum2) {
              var v2 = findIndex(function(v1) {
                return eq20(v1.datum)(datum2);
              })(state3.remainingOld);
              if (v2 instanceof Nothing) {
                var enterBinding = {
                  datum: datum2,
                  newIndex
                };
                return {
                  remainingOld: state3.remainingOld,
                  matchedIndices: state3.matchedIndices,
                  update: state3.update,
                  enter: cons2(enterBinding)(state3.enter)
                };
              }
              ;
              if (v2 instanceof Just) {
                var newRemaining = fromMaybe(state3.remainingOld)(deleteAt(v2.value0)(state3.remainingOld));
                var matched = unsafeIndex2(state3.remainingOld)(v2.value0);
                var updateBinding = {
                  element: matched.element,
                  oldDatum: datum2,
                  newDatum: datum2,
                  newIndex
                };
                return {
                  enter: state3.enter,
                  update: cons2(updateBinding)(state3.update),
                  remainingOld: newRemaining,
                  matchedIndices: cons2(v2.value0)(state3.matchedIndices)
                };
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Join (line 100, column 7 - line 122, column 16): " + [v2.constructor.name]);
            };
          };
        };
        var matchResult = foldlWithIndex2(processNewDatum)({
          remainingOld: oldBindings,
          enter: [],
          update: [],
          matchedIndices: []
        })(newData);
        return {
          enter: reverse2(matchResult.enter),
          update: reverse2(matchResult.update),
          exit: matchResult.remainingOld
        };
      };
    };
  };

  // output/PSD3.Internal.Transition.FFI/foreign.js
  function createTransition_(duration2) {
    return function(delay2) {
      return function(easingName) {
        return function(element4) {
          return function() {
            let transition3 = select_default2(element4).transition();
            transition3 = transition3.duration(duration2);
            if (delay2 != null) {
              transition3 = transition3.delay(delay2);
            }
            if (easingName != null) {
              const easingFn = getD3EasingFunction(easingName);
              if (easingFn) {
                transition3 = transition3.ease(easingFn);
              }
            }
            return transition3;
          };
        };
      };
    };
  }
  function transitionSetAttribute_(name16) {
    return function(value20) {
      return function(transition3) {
        return function() {
          transition3.attr(name16, value20);
        };
      };
    };
  }
  function transitionRemove_(transition3) {
    return function() {
      transition3.remove();
    };
  }
  function getD3EasingFunction(name16) {
    const easingMap = {
      // Linear
      "linear": linear2,
      // Polynomial (Quad, Cubic)
      "quad": quadInOut,
      "quadIn": quadIn,
      "quadOut": quadOut,
      "quadInOut": quadInOut,
      "cubic": cubicInOut,
      "cubicIn": cubicIn,
      "cubicOut": cubicOut,
      "cubicInOut": cubicInOut,
      // Sinusoidal
      "sin": sinInOut,
      "sinIn": sinIn,
      "sinOut": sinOut,
      "sinInOut": sinInOut,
      // Exponential
      "exp": expInOut,
      "expIn": expIn,
      "expOut": expOut,
      "expInOut": expInOut,
      // Circular
      "circle": circleInOut,
      "circleIn": circleIn,
      "circleOut": circleOut,
      "circleInOut": circleInOut,
      // Elastic
      "elastic": elasticOut,
      "elasticIn": elasticIn,
      "elasticOut": elasticOut,
      "elasticInOut": elasticInOut,
      // Back
      "back": backInOut,
      "backIn": backIn,
      "backOut": backOut,
      "backInOut": backInOut,
      // Bounce
      "bounce": bounceOut,
      "bounceIn": bounceIn,
      "bounceOut": bounceOut,
      "bounceInOut": bounceInOut
    };
    return easingMap[name16];
  }

  // output/PSD3.Internal.Transition.FFI/index.js
  var map15 = /* @__PURE__ */ map(functorMaybe);
  var maybeMillisecondsToNullable = /* @__PURE__ */ (function() {
    var $4 = map15(unwrap());
    return function($5) {
      return toNullable($4($5));
    };
  })();
  var maybeEasingToNullable = /* @__PURE__ */ (function() {
    var $6 = map15(show(showEasing));
    return function($7) {
      return toNullable($6($7));
    };
  })();

  // output/Partial.Unsafe/foreign.js
  var _unsafePartial = function(f) {
    return f();
  };

  // output/Partial/foreign.js
  var _crashWith = function(msg) {
    throw new Error(msg);
  };

  // output/Partial/index.js
  var crashWith = function() {
    return _crashWith;
  };

  // output/Partial.Unsafe/index.js
  var crashWith2 = /* @__PURE__ */ crashWith();
  var unsafePartial = _unsafePartial;
  var unsafeCrashWith = function(msg) {
    return unsafePartial(function() {
      return crashWith2(msg);
    });
  };

  // output/Web.DOM.Document/foreign.js
  var getEffProp = function(name16) {
    return function(doc) {
      return function() {
        return doc[name16];
      };
    };
  };
  var url = getEffProp("URL");
  var documentURI = getEffProp("documentURI");
  var origin = getEffProp("origin");
  var compatMode = getEffProp("compatMode");
  var characterSet = getEffProp("characterSet");
  var contentType = getEffProp("contentType");
  var _documentElement = getEffProp("documentElement");
  function createElement(localName2) {
    return function(doc) {
      return function() {
        return doc.createElement(localName2);
      };
    };
  }
  function _createElementNS(ns) {
    return function(qualifiedName) {
      return function(doc) {
        return function() {
          return doc.createElementNS(ns, qualifiedName);
        };
      };
    };
  }

  // output/Web.Internal.FFI/foreign.js
  function _unsafeReadProtoTagged(nothing, just, name16, value20) {
    if (typeof window !== "undefined") {
      var ty = window[name16];
      if (ty != null && value20 instanceof ty) {
        return just(value20);
      }
    }
    var obj = value20;
    while (obj != null) {
      var proto = Object.getPrototypeOf(obj);
      var constructorName = proto.constructor.name;
      if (constructorName === name16) {
        return just(value20);
      } else if (constructorName === "Object") {
        return nothing;
      }
      obj = proto;
    }
    return nothing;
  }

  // output/Web.Internal.FFI/index.js
  var unsafeReadProtoTagged = function(name16) {
    return function(value20) {
      return _unsafeReadProtoTagged(Nothing.value, Just.create, name16, value20);
    };
  };

  // output/Web.DOM.Document/index.js
  var toParentNode = unsafeCoerce2;
  var createElementNS = function($6) {
    return _createElementNS(toNullable($6));
  };

  // output/Web.DOM.Element/foreign.js
  var getProp = function(name16) {
    return function(doctype) {
      return doctype[name16];
    };
  };
  var _namespaceURI = getProp("namespaceURI");
  var _prefix = getProp("prefix");
  var localName = getProp("localName");
  var tagName = getProp("tagName");
  function setAttribute(name16) {
    return function(value20) {
      return function(element4) {
        return function() {
          element4.setAttribute(name16, value20);
        };
      };
    };
  }

  // output/Web.DOM.ParentNode/foreign.js
  var getEffProp2 = function(name16) {
    return function(node) {
      return function() {
        return node[name16];
      };
    };
  };
  var children2 = getEffProp2("children");
  var _firstElementChild = getEffProp2("firstElementChild");
  var _lastElementChild = getEffProp2("lastElementChild");
  var childElementCount = getEffProp2("childElementCount");
  function _querySelector(selector) {
    return function(node) {
      return function() {
        return node.querySelector(selector);
      };
    };
  }
  function querySelectorAll(selector) {
    return function(node) {
      return function() {
        return node.querySelectorAll(selector);
      };
    };
  }

  // output/Web.DOM.ParentNode/index.js
  var map16 = /* @__PURE__ */ map(functorEffect);
  var querySelector = function(qs) {
    var $2 = map16(toMaybe);
    var $3 = _querySelector(qs);
    return function($4) {
      return $2($3($4));
    };
  };

  // output/Web.DOM.Element/index.js
  var toParentNode2 = unsafeCoerce2;
  var toNode = unsafeCoerce2;
  var fromNode = /* @__PURE__ */ unsafeReadProtoTagged("Element");

  // output/Web.DOM.Node/foreign.js
  var getEffProp3 = function(name16) {
    return function(node) {
      return function() {
        return node[name16];
      };
    };
  };
  var baseURI = getEffProp3("baseURI");
  var _ownerDocument = getEffProp3("ownerDocument");
  var _parentNode = getEffProp3("parentNode");
  var _parentElement = getEffProp3("parentElement");
  var childNodes = getEffProp3("childNodes");
  var _firstChild = getEffProp3("firstChild");
  var _lastChild = getEffProp3("lastChild");
  var _previousSibling = getEffProp3("previousSibling");
  var _nextSibling = getEffProp3("nextSibling");
  var _nodeValue = getEffProp3("nodeValue");
  var textContent = getEffProp3("textContent");
  function setTextContent(value20) {
    return function(node) {
      return function() {
        node.textContent = value20;
      };
    };
  }
  function insertBefore(node1) {
    return function(node2) {
      return function(parent2) {
        return function() {
          parent2.insertBefore(node1, node2);
        };
      };
    };
  }
  function appendChild2(node) {
    return function(parent2) {
      return function() {
        parent2.appendChild(node);
      };
    };
  }
  function removeChild(node) {
    return function(parent2) {
      return function() {
        parent2.removeChild(node);
      };
    };
  }

  // output/Data.Enum/foreign.js
  function toCharCode(c2) {
    return c2.charCodeAt(0);
  }
  function fromCharCode(c2) {
    return String.fromCharCode(c2);
  }

  // output/Control.Alternative/index.js
  var guard = function(dictAlternative) {
    var pure107 = pure(dictAlternative.Applicative0());
    var empty10 = empty(dictAlternative.Plus1());
    return function(v2) {
      if (v2) {
        return pure107(unit);
      }
      ;
      if (!v2) {
        return empty10;
      }
      ;
      throw new Error("Failed pattern match at Control.Alternative (line 48, column 1 - line 48, column 54): " + [v2.constructor.name]);
    };
  };

  // output/Data.Enum/index.js
  var bottom1 = /* @__PURE__ */ bottom(boundedChar);
  var top1 = /* @__PURE__ */ top(boundedChar);
  var toEnum = function(dict) {
    return dict.toEnum;
  };
  var fromEnum = function(dict) {
    return dict.fromEnum;
  };
  var toEnumWithDefaults = function(dictBoundedEnum) {
    var toEnum1 = toEnum(dictBoundedEnum);
    var fromEnum1 = fromEnum(dictBoundedEnum);
    var bottom22 = bottom(dictBoundedEnum.Bounded0());
    return function(low2) {
      return function(high2) {
        return function(x32) {
          var v2 = toEnum1(x32);
          if (v2 instanceof Just) {
            return v2.value0;
          }
          ;
          if (v2 instanceof Nothing) {
            var $140 = x32 < fromEnum1(bottom22);
            if ($140) {
              return low2;
            }
            ;
            return high2;
          }
          ;
          throw new Error("Failed pattern match at Data.Enum (line 158, column 33 - line 160, column 62): " + [v2.constructor.name]);
        };
      };
    };
  };
  var defaultSucc = function(toEnum$prime) {
    return function(fromEnum$prime) {
      return function(a3) {
        return toEnum$prime(fromEnum$prime(a3) + 1 | 0);
      };
    };
  };
  var defaultPred = function(toEnum$prime) {
    return function(fromEnum$prime) {
      return function(a3) {
        return toEnum$prime(fromEnum$prime(a3) - 1 | 0);
      };
    };
  };
  var charToEnum = function(v2) {
    if (v2 >= toCharCode(bottom1) && v2 <= toCharCode(top1)) {
      return new Just(fromCharCode(v2));
    }
    ;
    return Nothing.value;
  };
  var enumChar = {
    succ: /* @__PURE__ */ defaultSucc(charToEnum)(toCharCode),
    pred: /* @__PURE__ */ defaultPred(charToEnum)(toCharCode),
    Ord0: function() {
      return ordChar;
    }
  };
  var boundedEnumChar = /* @__PURE__ */ (function() {
    return {
      cardinality: toCharCode(top1) - toCharCode(bottom1) | 0,
      toEnum: charToEnum,
      fromEnum: toCharCode,
      Bounded0: function() {
        return boundedChar;
      },
      Enum1: function() {
        return enumChar;
      }
    };
  })();

  // output/Web.DOM.Node/index.js
  var map17 = /* @__PURE__ */ map(functorEffect);
  var parentNode = /* @__PURE__ */ (function() {
    var $6 = map17(toMaybe);
    return function($7) {
      return $6(_parentNode($7));
    };
  })();
  var nextSibling = /* @__PURE__ */ (function() {
    var $15 = map17(toMaybe);
    return function($16) {
      return $15(_nextSibling($16));
    };
  })();

  // output/Web.DOM.NodeList/foreign.js
  function toArray(list) {
    return function() {
      return [].slice.call(list);
    };
  }

  // output/Web.HTML/foreign.js
  var windowImpl = function() {
    return window;
  };

  // output/Web.HTML.HTMLDocument/foreign.js
  function _readyState(doc) {
    return doc.readyState;
  }

  // output/Web.HTML.HTMLDocument.ReadyState/index.js
  var Loading = /* @__PURE__ */ (function() {
    function Loading2() {
    }
    ;
    Loading2.value = new Loading2();
    return Loading2;
  })();
  var Interactive = /* @__PURE__ */ (function() {
    function Interactive2() {
    }
    ;
    Interactive2.value = new Interactive2();
    return Interactive2;
  })();
  var Complete = /* @__PURE__ */ (function() {
    function Complete2() {
    }
    ;
    Complete2.value = new Complete2();
    return Complete2;
  })();
  var parse = function(v2) {
    if (v2 === "loading") {
      return new Just(Loading.value);
    }
    ;
    if (v2 === "interactive") {
      return new Just(Interactive.value);
    }
    ;
    if (v2 === "complete") {
      return new Just(Complete.value);
    }
    ;
    return Nothing.value;
  };

  // output/Web.HTML.HTMLDocument/index.js
  var map18 = /* @__PURE__ */ map(functorEffect);
  var toParentNode3 = unsafeCoerce2;
  var toDocument = unsafeCoerce2;
  var readyState = function(doc) {
    return map18((function() {
      var $4 = fromMaybe(Loading.value);
      return function($5) {
        return $4(parse($5));
      };
    })())(function() {
      return _readyState(doc);
    });
  };

  // output/Web.HTML.HTMLElement/foreign.js
  function _read(nothing, just, value20) {
    var tag = Object.prototype.toString.call(value20);
    if (tag.indexOf("[object HTML") === 0 && tag.indexOf("Element]") === tag.length - 8) {
      return just(value20);
    } else {
      return nothing;
    }
  }

  // output/Web.HTML.HTMLElement/index.js
  var toNode2 = unsafeCoerce2;
  var fromElement = function(x32) {
    return _read(Nothing.value, Just.create, x32);
  };

  // output/Web.HTML.Location/foreign.js
  function hash(location2) {
    return function() {
      return location2.hash;
    };
  }
  function setHash(hash2) {
    return function(location2) {
      return function() {
        location2.hash = hash2;
      };
    };
  }

  // output/Web.HTML.Window/foreign.js
  function document2(window2) {
    return function() {
      return window2.document;
    };
  }
  function location(window2) {
    return function() {
      return window2.location;
    };
  }
  function scroll(xCoord) {
    return function(yCoord) {
      return function(window2) {
        return function() {
          window2.scroll(xCoord, yCoord);
        };
      };
    };
  }

  // output/Web.HTML.Window/index.js
  var toEventTarget = unsafeCoerce2;

  // output/Web.UIEvent.MouseEvent/foreign.js
  function clientX(e) {
    return e.clientX;
  }
  function clientY(e) {
    return e.clientY;
  }
  function pageX(e) {
    return e.pageX;
  }
  function pageY(e) {
    return e.pageY;
  }

  // output/PSD3.Internal.Selection.Operations/index.js
  var bind2 = /* @__PURE__ */ bind(bindEffect);
  var pure3 = /* @__PURE__ */ pure(applicativeEffect);
  var mapFlipped2 = /* @__PURE__ */ mapFlipped(functorEffect);
  var lookup2 = /* @__PURE__ */ lookup(ordString);
  var traverse_2 = /* @__PURE__ */ traverse_(applicativeEffect)(foldableArray);
  var traverse2 = /* @__PURE__ */ traverse(traversableArray)(applicativeEffect);
  var append12 = /* @__PURE__ */ append(semigroupArray);
  var mapFlipped1 = /* @__PURE__ */ mapFlipped(functorMaybe);
  var compare5 = /* @__PURE__ */ compare(ordInt);
  var mapFlipped22 = /* @__PURE__ */ mapFlipped(functorArray);
  var show2 = /* @__PURE__ */ show(showNumber);
  var show1 = /* @__PURE__ */ show(showBoolean);
  var unwrap2 = /* @__PURE__ */ unwrap();
  var traverseWithIndex_2 = /* @__PURE__ */ traverseWithIndex_(applicativeEffect)(foldableWithIndexArray);
  var discard2 = /* @__PURE__ */ discard(discardUnit);
  var $$void5 = /* @__PURE__ */ $$void(functorEffect);
  var unsafeIndex3 = /* @__PURE__ */ unsafeIndex();
  var traverseWithIndex2 = /* @__PURE__ */ traverseWithIndex(traversableWithIndexArray)(applicativeEffect);
  var mod2 = /* @__PURE__ */ mod(euclideanRingInt);
  var union2 = /* @__PURE__ */ union(ordString);
  var map19 = /* @__PURE__ */ map(functorArray);
  var insert2 = /* @__PURE__ */ insert(ordString);
  var liftEffect2 = /* @__PURE__ */ liftEffect(monadEffectEffect);
  var log4 = /* @__PURE__ */ log3(monadEffectEffect);
  var show22 = /* @__PURE__ */ show(showInt);
  var join2 = /* @__PURE__ */ join(bindArray);
  var stringToElementType = function(v2) {
    if (v2 === "circle") {
      return Circle.value;
    }
    ;
    if (v2 === "rect") {
      return Rect.value;
    }
    ;
    if (v2 === "path") {
      return Path.value;
    }
    ;
    if (v2 === "line") {
      return Line.value;
    }
    ;
    if (v2 === "text") {
      return Text.value;
    }
    ;
    if (v2 === "g") {
      return Group.value;
    }
    ;
    if (v2 === "svg") {
      return SVG.value;
    }
    ;
    if (v2 === "defs") {
      return Defs.value;
    }
    ;
    if (v2 === "linearGradient") {
      return LinearGradient.value;
    }
    ;
    if (v2 === "stop") {
      return Stop.value;
    }
    ;
    if (v2 === "div") {
      return Div.value;
    }
    ;
    if (v2 === "span") {
      return Span.value;
    }
    ;
    if (v2 === "table") {
      return Table.value;
    }
    ;
    if (v2 === "tr") {
      return Tr.value;
    }
    ;
    if (v2 === "td") {
      return Td.value;
    }
    ;
    if (v2 === "th") {
      return Th.value;
    }
    ;
    if (v2 === "tbody") {
      return Tbody.value;
    }
    ;
    if (v2 === "thead") {
      return Thead.value;
    }
    ;
    return Group.value;
  };
  var select4 = function(dictMonadEffect) {
    var liftEffect118 = liftEffect(dictMonadEffect);
    return function(selector) {
      return liftEffect118(function __do7() {
        var htmlDoc = bind2(windowImpl)(document2)();
        var doc = toDocument(htmlDoc);
        var parentNode3 = toParentNode3(htmlDoc);
        var maybeElement = querySelector(selector)(parentNode3)();
        if (maybeElement instanceof Nothing) {
          return new EmptySelection({
            parentElements: [],
            document: doc
          });
        }
        ;
        if (maybeElement instanceof Just) {
          return new EmptySelection({
            parentElements: [maybeElement.value0],
            document: doc
          });
        }
        ;
        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 91, column 3 - line 99, column 8): " + [maybeElement.constructor.name]);
      });
    };
  };
  var reselect = function(name16) {
    return function(selectionsMap) {
      return function __do7() {
        var doc = mapFlipped2(bind2(windowImpl)(document2))(toDocument)();
        var v2 = lookup2(name16)(selectionsMap);
        if (v2 instanceof Just) {
          var elements = (function() {
            if (v2.value0 instanceof BoundSelection) {
              return v2.value0.value0.elements;
            }
            ;
            if (v2.value0 instanceof EmptySelection) {
              return v2.value0.value0.parentElements;
            }
            ;
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2020, column 34 - line 2022, column 47): " + [v2.value0.constructor.name]);
          })();
          return new EmptySelection({
            parentElements: elements,
            document: doc
          });
        }
        ;
        if (v2 instanceof Nothing) {
          return new EmptySelection({
            parentElements: [],
            document: doc
          });
        }
        ;
        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2014, column 3 - line 2033, column 10): " + [v2.constructor.name]);
      };
    };
  };
  var remove3 = function(dictMonadEffect) {
    var liftEffect118 = liftEffect(dictMonadEffect);
    return function(v2) {
      return liftEffect118((function() {
        var v1 = (function() {
          if (v2 instanceof ExitingSelection) {
            return v2.value0;
          }
          ;
          throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 325, column 34 - line 326, column 30): " + [v2.constructor.name]);
        })();
        return traverse_2(function(element4) {
          var node = toNode(element4);
          return function __do7() {
            var maybeParent = parentNode(node)();
            if (maybeParent instanceof Just) {
              return removeChild(node)(maybeParent.value0)();
            }
            ;
            if (maybeParent instanceof Nothing) {
              return unit;
            }
            ;
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 330, column 5 - line 332, column 27): " + [maybeParent.constructor.name]);
          };
        })(v1.elements);
      })());
    };
  };
  var remove1 = /* @__PURE__ */ remove3(monadEffectEffect);
  var querySelectorAllElements = function(selector) {
    return function(parents) {
      return function __do7() {
        var nodeArrays = traverse2(function(parent2) {
          var parentNode3 = toParentNode2(parent2);
          return function __do8() {
            var nodeList = querySelectorAll(selector)(parentNode3)();
            var nodes3 = toArray(nodeList)();
            return mapMaybe(fromNode)(nodes3);
          };
        })(parents)();
        return concat(nodeArrays);
      };
    };
  };
  var merge = function(dictMonadEffect) {
    var pure128 = pure(dictMonadEffect.Monad0().Applicative0());
    return function(v2) {
      return function(v1) {
        var v22 = (function() {
          if (v2 instanceof BoundSelection) {
            return v2.value0;
          }
          ;
          throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 539, column 68 - line 540, column 28): " + [v2.constructor.name]);
        })();
        var v3 = (function() {
          if (v1 instanceof BoundSelection) {
            return v1.value0;
          }
          ;
          throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 542, column 53 - line 543, column 28): " + [v1.constructor.name]);
        })();
        return pure128(new BoundSelection({
          elements: append12(v22.elements)(v3.elements),
          data: append12(v22.data)(v3.data),
          indices: Nothing.value,
          document: v22.document
        }));
      };
    };
  };
  var joinDataWithKey = function(dictMonadEffect) {
    var liftEffect118 = liftEffect(dictMonadEffect);
    return function(dictFoldable) {
      var fromFoldable44 = fromFoldable3(dictFoldable);
      return function(dictEq) {
        var computeJoinWithKey2 = computeJoinWithKey(dictEq);
        return function(foldableData) {
          return function(keyFn) {
            return function(selector) {
              return function(v2) {
                return liftEffect118((function() {
                  var v1 = (function() {
                    if (v2 instanceof EmptySelection) {
                      return v2.value0;
                    }
                    ;
                    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 663, column 55 - line 664, column 28): " + [v2.constructor.name]);
                  })();
                  return function __do7() {
                    var existingElements = querySelectorAllElements(selector)(v1.parentElements)();
                    var oldBindings = traverse2(function(element4) {
                      return function __do8() {
                        var nullableDatum = getElementData_(element4)();
                        var maybeDatum = toMaybe(nullableDatum);
                        return {
                          element: element4,
                          datum: maybeDatum
                        };
                      };
                    })(existingElements)();
                    var validOldBindings = mapMaybe(function(v22) {
                      return mapFlipped1(v22.datum)(function(d) {
                        return {
                          element: v22.element,
                          datum: d
                        };
                      });
                    })(oldBindings);
                    var newDataArray = fromFoldable44(foldableData);
                    var joinSets = computeJoinWithKey2(newDataArray)(validOldBindings)(keyFn);
                    var sortedEnter = sortBy(function(a3) {
                      return function(b10) {
                        return compare5(a3.newIndex)(b10.newIndex);
                      };
                    })(joinSets.enter);
                    var enterSelection = new PendingSelection({
                      parentElements: v1.parentElements,
                      pendingData: mapFlipped22(sortedEnter)(function(v22) {
                        return v22.datum;
                      }),
                      indices: new Just(mapFlipped22(sortedEnter)(function(v22) {
                        return v22.newIndex;
                      })),
                      document: v1.document
                    });
                    var sortedUpdate = sortBy(function(a3) {
                      return function(b10) {
                        return compare5(a3.newIndex)(b10.newIndex);
                      };
                    })(joinSets.update);
                    var updateSelection = new BoundSelection({
                      elements: mapFlipped22(sortedUpdate)(function(v22) {
                        return v22.element;
                      }),
                      data: mapFlipped22(sortedUpdate)(function(v22) {
                        return v22.newDatum;
                      }),
                      indices: new Just(mapFlipped22(sortedUpdate)(function(v22) {
                        return v22.newIndex;
                      })),
                      document: v1.document
                    });
                    var exitSelection = new ExitingSelection({
                      elements: mapFlipped22(joinSets.exit)(function(v22) {
                        return v22.element;
                      }),
                      data: mapFlipped22(joinSets.exit)(function(v22) {
                        return v22.datum;
                      }),
                      document: v1.document
                    });
                    return new JoinResult({
                      enter: enterSelection,
                      update: updateSelection,
                      exit: exitSelection
                    });
                  };
                })());
              };
            };
          };
        };
      };
    };
  };
  var joinDataWithKey1 = /* @__PURE__ */ joinDataWithKey(monadEffectEffect)(foldableArray)(eqString);
  var joinData2 = function(dictMonadEffect) {
    var liftEffect118 = liftEffect(dictMonadEffect);
    return function(dictFoldable) {
      var fromFoldable44 = fromFoldable3(dictFoldable);
      return function(dictOrd) {
        var computeJoin2 = computeJoin(dictOrd.Eq0());
        return function(foldableData) {
          return function(selector) {
            return function(v2) {
              return liftEffect118((function() {
                var v1 = (function() {
                  if (v2 instanceof EmptySelection) {
                    return v2.value0;
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 574, column 55 - line 575, column 28): " + [v2.constructor.name]);
                })();
                return function __do7() {
                  var existingElements = querySelectorAllElements(selector)(v1.parentElements)();
                  var oldBindings = traverse2(function(element4) {
                    return function __do8() {
                      var nullableDatum = getElementData_(element4)();
                      var maybeDatum = toMaybe(nullableDatum);
                      return {
                        element: element4,
                        datum: maybeDatum
                      };
                    };
                  })(existingElements)();
                  var validOldBindings = mapMaybe(function(v22) {
                    return mapFlipped1(v22.datum)(function(d) {
                      return {
                        element: v22.element,
                        datum: d
                      };
                    });
                  })(oldBindings);
                  var newDataArray = fromFoldable44(foldableData);
                  var joinSets = computeJoin2(newDataArray)(validOldBindings);
                  var sortedEnter = sortBy(function(a3) {
                    return function(b10) {
                      return compare5(a3.newIndex)(b10.newIndex);
                    };
                  })(joinSets.enter);
                  var enterSelection = new PendingSelection({
                    parentElements: v1.parentElements,
                    pendingData: mapFlipped22(sortedEnter)(function(v22) {
                      return v22.datum;
                    }),
                    indices: new Just(mapFlipped22(sortedEnter)(function(v22) {
                      return v22.newIndex;
                    })),
                    document: v1.document
                  });
                  var sortedUpdate = sortBy(function(a3) {
                    return function(b10) {
                      return compare5(a3.newIndex)(b10.newIndex);
                    };
                  })(joinSets.update);
                  var updateSelection = new BoundSelection({
                    elements: mapFlipped22(sortedUpdate)(function(v22) {
                      return v22.element;
                    }),
                    data: mapFlipped22(sortedUpdate)(function(v22) {
                      return v22.newDatum;
                    }),
                    indices: new Just(mapFlipped22(sortedUpdate)(function(v22) {
                      return v22.newIndex;
                    })),
                    document: v1.document
                  });
                  var exitSelection = new ExitingSelection({
                    elements: mapFlipped22(joinSets.exit)(function(v22) {
                      return v22.element;
                    }),
                    data: mapFlipped22(joinSets.exit)(function(v22) {
                      return v22.datum;
                    }),
                    document: v1.document
                  });
                  return new JoinResult({
                    enter: enterSelection,
                    update: updateSelection,
                    exit: exitSelection
                  });
                };
              })());
            };
          };
        };
      };
    };
  };
  var joinData1 = /* @__PURE__ */ joinData2(monadEffectEffect)(foldableArray);
  var getExitingElementDatumPairs = function(v2) {
    var v1 = (function() {
      if (v2 instanceof ExitingSelection) {
        return v2.value0;
      }
      ;
      throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1165, column 52 - line 1166, column 30): " + [v2.constructor.name]);
    })();
    return zipWith2(Tuple.create)(v1.elements)(v1.data);
  };
  var getElementsFromBoundSelection = function(v2) {
    if (v2 instanceof BoundSelection) {
      return v2.value0.elements;
    }
    ;
    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1188, column 17 - line 1189, column 35): " + [v2.constructor.name]);
  };
  var getDocument = function(v2) {
    if (v2 instanceof EmptySelection) {
      return pure3(v2.value0.document);
    }
    ;
    if (v2 instanceof BoundSelection) {
      return pure3(v2.value0.document);
    }
    ;
    if (v2 instanceof PendingSelection) {
      return pure3(v2.value0.document);
    }
    ;
    if (v2 instanceof ExitingSelection) {
      return pure3(v2.value0.document);
    }
    ;
    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 852, column 1 - line 852, column 82): " + [v2.constructor.name]);
  };
  var selectAll = function(dictMonadEffect) {
    var liftEffect118 = liftEffect(dictMonadEffect);
    return function(selector) {
      return function(v2) {
        return liftEffect118(function __do7() {
          var doc = getDocument(v2)();
          var parentElems = (function() {
            if (v2 instanceof EmptySelection) {
              return v2.value0.parentElements;
            }
            ;
            if (v2 instanceof BoundSelection) {
              return v2.value0.elements;
            }
            ;
            if (v2 instanceof PendingSelection) {
              return v2.value0.parentElements;
            }
            ;
            if (v2 instanceof ExitingSelection) {
              return v2.value0.elements;
            }
            ;
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 123, column 19 - line 127, column 48): " + [v2.constructor.name]);
          })();
          return new EmptySelection({
            parentElements: parentElems,
            document: doc
          });
        });
      };
    };
  };
  var selectAllWithData = function(dictMonadEffect) {
    var liftEffect118 = liftEffect(dictMonadEffect);
    return function(selector) {
      return function(v2) {
        return liftEffect118(function __do7() {
          var doc = getDocument(v2)();
          var elements = (function() {
            if (v2 instanceof EmptySelection) {
              return querySelectorAllElements(selector)(v2.value0.parentElements)();
            }
            ;
            if (v2 instanceof BoundSelection) {
              return querySelectorAllElements(selector)(v2.value0.elements)();
            }
            ;
            if (v2 instanceof PendingSelection) {
              return querySelectorAllElements(selector)(v2.value0.parentElements)();
            }
            ;
            if (v2 instanceof ExitingSelection) {
              return querySelectorAllElements(selector)(v2.value0.elements)();
            }
            ;
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 155, column 15 - line 163, column 50): " + [v2.constructor.name]);
          })();
          var dataArray = traverse2(function(el) {
            return function __do8() {
              var nullableDatum = getElementData_(el)();
              var v1 = toMaybe(nullableDatum);
              if (v1 instanceof Just) {
                return v1.value0;
              }
              ;
              if (v1 instanceof Nothing) {
                return unit;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 169, column 16 - line 171, column 39): " + [v1.constructor.name]);
            };
          })(elements)();
          return new BoundSelection({
            elements,
            data: dataArray,
            indices: Nothing.value,
            document: doc
          });
        });
      };
    };
  };
  var getBoundElementDatumPairs = function(v2) {
    var v1 = (function() {
      if (v2 instanceof BoundSelection) {
        return v2.value0;
      }
      ;
      throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1177, column 52 - line 1178, column 28): " + [v2.constructor.name]);
    })();
    return zipWith2(Tuple.create)(v1.elements)(v1.data);
  };
  var elementTypeToString = function(v2) {
    if (v2 instanceof Circle) {
      return "circle";
    }
    ;
    if (v2 instanceof Rect) {
      return "rect";
    }
    ;
    if (v2 instanceof Path) {
      return "path";
    }
    ;
    if (v2 instanceof Line) {
      return "line";
    }
    ;
    if (v2 instanceof Text) {
      return "text";
    }
    ;
    if (v2 instanceof Group) {
      return "g";
    }
    ;
    if (v2 instanceof SVG) {
      return "svg";
    }
    ;
    if (v2 instanceof Defs) {
      return "defs";
    }
    ;
    if (v2 instanceof LinearGradient) {
      return "linearGradient";
    }
    ;
    if (v2 instanceof Stop) {
      return "stop";
    }
    ;
    if (v2 instanceof Div) {
      return "div";
    }
    ;
    if (v2 instanceof Span) {
      return "span";
    }
    ;
    if (v2 instanceof Table) {
      return "table";
    }
    ;
    if (v2 instanceof Tr) {
      return "tr";
    }
    ;
    if (v2 instanceof Td) {
      return "td";
    }
    ;
    if (v2 instanceof Th) {
      return "th";
    }
    ;
    if (v2 instanceof Tbody) {
      return "tbody";
    }
    ;
    if (v2 instanceof Thead) {
      return "thead";
    }
    ;
    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1002, column 1 - line 1002, column 45): " + [v2.constructor.name]);
  };
  var createElementWithNS = function(elemType) {
    return function(doc) {
      var v2 = elementContext(elemType);
      if (v2 instanceof SVGContext) {
        return createElementNS(new Just("http://www.w3.org/2000/svg"))(elementTypeToString(elemType))(doc);
      }
      ;
      if (v2 instanceof HTMLContext) {
        return createElement(elementTypeToString(elemType))(doc);
      }
      ;
      throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 862, column 3 - line 868, column 64): " + [v2.constructor.name]);
    };
  };
  var clear3 = function(dictMonadEffect) {
    var liftEffect118 = liftEffect(dictMonadEffect);
    return function(selector) {
      return liftEffect118(clearElement_(selector));
    };
  };
  var attributeValueToString = function(v2) {
    if (v2 instanceof StringValue) {
      return v2.value0;
    }
    ;
    if (v2 instanceof NumberValue) {
      return show2(v2.value0);
    }
    ;
    if (v2 instanceof BooleanValue) {
      return show1(v2.value0);
    }
    ;
    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 997, column 1 - line 997, column 51): " + [v2.constructor.name]);
  };
  var applyTransitionToSingleElement = function(config) {
    return function(index7) {
      return function(element4) {
        return function(datum2) {
          return function(attrs) {
            var baseDelay = maybe(0)(unwrap2)(config.delay);
            var stagger = fromMaybe(0)(config.staggerDelay);
            var effectiveDelay = baseDelay + toNumber(index7) * stagger;
            var delayNullable = toNullable(new Just(effectiveDelay));
            var easingNullable = maybeEasingToNullable(config.easing);
            return function __do7() {
              var transition3 = createTransition_(config.duration)(delayNullable)(easingNullable)(element4)();
              return traverse_2(function(attr46) {
                if (attr46 instanceof StaticAttr) {
                  return transitionSetAttribute_(attr46.value0)(attributeValueToString(attr46.value1))(transition3);
                }
                ;
                if (attr46 instanceof DataAttr) {
                  return transitionSetAttribute_(attr46.value0)(attributeValueToString(attr46.value2(datum2)))(transition3);
                }
                ;
                if (attr46 instanceof IndexedAttr) {
                  return transitionSetAttribute_(attr46.value0)(attributeValueToString(attr46.value2(datum2)(index7)))(transition3);
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1109, column 30 - line 1117, column 101): " + [attr46.constructor.name]);
              })(attrs)();
            };
          };
        };
      };
    };
  };
  var applyExitTransitionToElements = function(config) {
    return function(elementDatumPairs) {
      return function(attrs) {
        var baseDelay = maybe(0)(unwrap2)(config.delay);
        var stagger = fromMaybe(0)(config.staggerDelay);
        var easingNullable = maybeEasingToNullable(config.easing);
        return traverseWithIndex_2(function(index7) {
          return function(v2) {
            var effectiveDelay = baseDelay + toNumber(index7) * stagger;
            var delayNullable = toNullable(new Just(effectiveDelay));
            return function __do7() {
              var transition3 = createTransition_(config.duration)(delayNullable)(easingNullable)(v2.value0)();
              traverse_2(function(attr46) {
                if (attr46 instanceof StaticAttr) {
                  return transitionSetAttribute_(attr46.value0)(attributeValueToString(attr46.value1))(transition3);
                }
                ;
                if (attr46 instanceof DataAttr) {
                  return transitionSetAttribute_(attr46.value0)(attributeValueToString(attr46.value2(v2.value1)))(transition3);
                }
                ;
                if (attr46 instanceof IndexedAttr) {
                  return transitionSetAttribute_(attr46.value0)(attributeValueToString(attr46.value2(v2.value1)(index7)))(transition3);
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1145, column 32 - line 1153, column 103): " + [attr46.constructor.name]);
              })(attrs)();
              return transitionRemove_(transition3)();
            };
          };
        })(elementDatumPairs);
      };
    };
  };
  var applyBehaviorToElement = function(v2) {
    return function(v1) {
      if (v2 instanceof Zoom) {
        return $$void5(attachZoom_(v1)(v2.value0.scaleExtent.value0)(v2.value0.scaleExtent.value1)(v2.value0.targetSelector));
      }
      ;
      if (v2 instanceof Drag && v2.value0 instanceof SimpleDrag) {
        return $$void5(attachSimpleDrag_(v1)(unit));
      }
      ;
      if (v2 instanceof Drag && v2.value0 instanceof SimulationDrag) {
        return $$void5(attachSimulationDragById_(v1)(v2.value0.value0));
      }
      ;
      if (v2 instanceof Drag && v2.value0 instanceof SimulationDragNested) {
        return $$void5(attachSimulationDragNestedById_(v1)(v2.value0.value0));
      }
      ;
      if (v2 instanceof Click) {
        return $$void5(attachClick_(v1)(v2.value0));
      }
      ;
      if (v2 instanceof ClickWithDatum) {
        return $$void5(attachClickWithDatum_(v1)(v2.value0));
      }
      ;
      if (v2 instanceof MouseEnter) {
        return $$void5(attachMouseEnter_(v1)(v2.value0));
      }
      ;
      if (v2 instanceof MouseLeave) {
        return $$void5(attachMouseLeave_(v1)(v2.value0));
      }
      ;
      if (v2 instanceof Highlight) {
        return $$void5(attachHighlight_(v1)(v2.value0.enter)(v2.value0.leave));
      }
      ;
      if (v2 instanceof MouseMoveWithInfo) {
        return $$void5(attachMouseMoveWithEvent_(v1)(function(d, evt) {
          return v2.value0({
            datum: d,
            clientX: toNumber(clientX(evt)),
            clientY: toNumber(clientY(evt)),
            pageX: toNumber(pageX(evt)),
            pageY: toNumber(pageY(evt)),
            offsetX: offsetX(evt),
            offsetY: offsetY(evt)
          })();
        }));
      }
      ;
      if (v2 instanceof MouseEnterWithInfo) {
        return $$void5(attachMouseEnterWithEvent_(v1)(function(d, evt) {
          return v2.value0({
            datum: d,
            clientX: toNumber(clientX(evt)),
            clientY: toNumber(clientY(evt)),
            pageX: toNumber(pageX(evt)),
            pageY: toNumber(pageY(evt)),
            offsetX: offsetX(evt),
            offsetY: offsetY(evt)
          })();
        }));
      }
      ;
      if (v2 instanceof MouseLeaveWithInfo) {
        return $$void5(attachMouseLeaveWithEvent_(v1)(function(d, evt) {
          return v2.value0({
            datum: d,
            clientX: toNumber(clientX(evt)),
            clientY: toNumber(clientY(evt)),
            pageX: toNumber(pageX(evt)),
            pageY: toNumber(pageY(evt)),
            offsetX: offsetX(evt),
            offsetY: offsetY(evt)
          })();
        }));
      }
      ;
      throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 888, column 1 - line 888, column 81): " + [v2.constructor.name, v1.constructor.name]);
    };
  };
  var on3 = function(behavior) {
    return function(v2) {
      var getElements = function(v1) {
        if (v1 instanceof EmptySelection) {
          return v1.value0.parentElements;
        }
        ;
        if (v1 instanceof BoundSelection) {
          return v1.value0.elements;
        }
        ;
        if (v1 instanceof PendingSelection) {
          return v1.value0.parentElements;
        }
        ;
        if (v1 instanceof ExitingSelection) {
          return v1.value0.elements;
        }
        ;
        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 967, column 3 - line 967, column 59): " + [v1.constructor.name]);
      };
      var elements = getElements(v2);
      return function __do7() {
        traverse_2(applyBehaviorToElement(behavior))(elements)();
        return v2;
      };
    };
  };
  var applyAttributes = function(element4) {
    return function(datum2) {
      return function(index7) {
        return function(attrs) {
          return traverse_2(function(attr46) {
            if (attr46 instanceof StaticAttr) {
              var $408 = attr46.value0 === "textContent";
              if ($408) {
                return setTextContent_(attributeValueToString(attr46.value1))(element4);
              }
              ;
              return setAttribute(attr46.value0)(attributeValueToString(attr46.value1))(element4);
            }
            ;
            if (attr46 instanceof DataAttr) {
              var val = attributeValueToString(attr46.value2(datum2));
              var $411 = attr46.value0 === "textContent";
              if ($411) {
                return setTextContent_(val)(element4);
              }
              ;
              return setAttribute(attr46.value0)(val)(element4);
            }
            ;
            if (attr46 instanceof IndexedAttr) {
              var val = attributeValueToString(attr46.value2(datum2)(index7));
              var $415 = attr46.value0 === "textContent";
              if ($415) {
                return setTextContent_(val)(element4);
              }
              ;
              return setAttribute(attr46.value0)(val)(element4);
            }
            ;
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 978, column 30 - line 995, column 51): " + [attr46.constructor.name]);
          })(attrs);
        };
      };
    };
  };
  var applyPerDatumAttrs = function(dictMonadEffect) {
    var liftEffect118 = liftEffect(dictMonadEffect);
    return function(mkAttrs) {
      return function(v2) {
        return liftEffect118((function() {
          if (v2 instanceof BoundSelection) {
            var paired = zipWith2(Tuple.create)(v2.value0.data)(v2.value0.elements);
            return function __do7() {
              traverseWithIndex_2(function(index7) {
                return function(v1) {
                  var attrs = mkAttrs(v1.value0);
                  return applyAttributes(v1.value1)(v1.value0)(index7)(attrs);
                };
              })(paired)();
              return v2;
            };
          }
          ;
          return pure3(v2);
        })());
      };
    };
  };
  var setAttrs2 = function(dictMonadEffect) {
    var liftEffect118 = liftEffect(dictMonadEffect);
    return function(attrs) {
      return function(v2) {
        return liftEffect118((function() {
          var v1 = (function() {
            if (v2 instanceof BoundSelection) {
              return v2.value0;
            }
            ;
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 261, column 76 - line 262, column 28): " + [v2.constructor.name]);
          })();
          var paired = zipWith2(Tuple.create)(v1.data)(v1.elements);
          return function __do7() {
            traverseWithIndex_2(function(arrayIndex) {
              return function(v22) {
                var logicalIndex = (function() {
                  if (v1.indices instanceof Just) {
                    return unsafeIndex3(v1.indices.value0)(arrayIndex);
                  }
                  ;
                  if (v1.indices instanceof Nothing) {
                    return arrayIndex;
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 267, column 22 - line 269, column 30): " + [v1.indices.constructor.name]);
                })();
                return applyAttributes(v22.value1)(v22.value0)(logicalIndex)(attrs);
              };
            })(paired)();
            return new BoundSelection({
              elements: v1.elements,
              data: v1.data,
              indices: v1.indices,
              document: v1.document
            });
          };
        })());
      };
    };
  };
  var setAttrs1 = /* @__PURE__ */ setAttrs2(monadEffectEffect);
  var setAttrsExit = function(dictMonadEffect) {
    var liftEffect118 = liftEffect(dictMonadEffect);
    return function(attrs) {
      return function(v2) {
        return liftEffect118((function() {
          var v1 = (function() {
            if (v2 instanceof ExitingSelection) {
              return v2.value0;
            }
            ;
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 296, column 67 - line 297, column 30): " + [v2.constructor.name]);
          })();
          var paired = zipWith2(Tuple.create)(v1.data)(v1.elements);
          return function __do7() {
            traverseWithIndex_2(function(index7) {
              return function(v22) {
                return applyAttributes(v22.value1)(v22.value0)(index7)(attrs);
              };
            })(paired)();
            return new ExitingSelection({
              elements: v1.elements,
              data: v1.data,
              document: v1.document
            });
          };
        })());
      };
    };
  };
  var setAttrsExit1 = /* @__PURE__ */ setAttrsExit(monadEffectEffect);
  var updateElementFromTree = function(element4) {
    return function(datum2) {
      return function(index7) {
        return function(tree2) {
          return function(doc) {
            return function __do7() {
              setElementData_(datum2)(element4)();
              if (tree2 instanceof Node2) {
                return applyAttributes(element4)(datum2)(index7)(tree2.value0.attrs)();
              }
              ;
              return unit;
            };
          };
        };
      };
    };
  };
  var renderTemplatesForBoundSelection = function(dictOrd) {
    return function(templateFn) {
      return function(boundSel) {
        var v2 = (function() {
          if (boundSel instanceof BoundSelection) {
            return boundSel.value0;
          }
          ;
          throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1843, column 66 - line 1844, column 32): " + [boundSel.constructor.name]);
        })();
        return traverseWithIndex2(function(idx) {
          return function(datum2) {
            var v1 = index(v2.elements)(idx);
            if (v1 instanceof Nothing) {
              return unsafeCrashWith("renderTemplatesForBoundSelection: index out of bounds");
            }
            ;
            if (v1 instanceof Just) {
              var tree2 = templateFn(datum2);
              return function __do7() {
                updateElementFromTree(v1.value0)(datum2)(idx)(tree2)(v2.document)();
                return v1.value0;
              };
            }
            ;
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1849, column 9 - line 1858, column 25): " + [v1.constructor.name]);
          };
        })(v2.data);
      };
    };
  };
  var appendChildWithDatum = function(dictMonadEffect) {
    var liftEffect118 = liftEffect(dictMonadEffect);
    return function(elemType) {
      return function(attrs) {
        return function(datumOpt) {
          return function(v2) {
            return liftEffect118((function() {
              var v1 = (function() {
                if (v2 instanceof EmptySelection) {
                  return v2.value0;
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 434, column 55 - line 435, column 28): " + [v2.constructor.name]);
              })();
              return function __do7() {
                var elements = traverse2(function(parent2) {
                  return function __do8() {
                    var element4 = createElementWithNS(elemType)(v1.document)();
                    var datum2 = (function() {
                      if (datumOpt instanceof Just) {
                        return datumOpt.value0;
                      }
                      ;
                      if (datumOpt instanceof Nothing) {
                        return unit;
                      }
                      ;
                      throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 442, column 15 - line 444, column 49): " + [datumOpt.constructor.name]);
                    })();
                    applyAttributes(element4)(datum2)(0)(attrs)();
                    var elementNode = toNode(element4);
                    var parentNode3 = toNode(parent2);
                    appendChild2(elementNode)(parentNode3)();
                    return element4;
                  };
                })(v1.parentElements)();
                return new EmptySelection({
                  parentElements: elements,
                  document: v1.document
                });
              };
            })());
          };
        };
      };
    };
  };
  var appendChildWithDatum1 = /* @__PURE__ */ appendChildWithDatum(monadEffectEffect);
  var renderTemplatesForPendingSelection = function(dictOrd) {
    return function(templateFn) {
      return function(pendingSel) {
        var v2 = (function() {
          if (pendingSel instanceof PendingSelection) {
            return pendingSel.value0;
          }
          ;
          throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1786, column 68 - line 1787, column 34): " + [pendingSel.constructor.name]);
        })();
        var $479 = $$null3(v2.parentElements);
        if ($479) {
          return pure3([]);
        }
        ;
        return traverseWithIndex2(function(idx) {
          return function(datum2) {
            var parentIdx = mod2(idx)(length3(v2.parentElements));
            var v1 = index(v2.parentElements)(parentIdx);
            if (v1 instanceof Nothing) {
              return unsafeCrashWith("renderTemplatesForPendingSelection: no parent elements");
            }
            ;
            if (v1 instanceof Just) {
              var tree2 = templateFn(datum2);
              var singleParentSel = new EmptySelection({
                parentElements: [v1.value0],
                document: v2.document
              });
              return function __do7() {
                var v22 = renderNodeHelperWithDatum(dictOrd)(singleParentSel)(tree2)(new Just(datum2))();
                setElementData_(datum2)(v22.value0)();
                return new Tuple(v22.value0, v22.value1);
              };
            }
            ;
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1799, column 11 - line 1819, column 51): " + [v1.constructor.name]);
          };
        })(v2.pendingData);
      };
    };
  };
  var renderNodeHelperWithDatum = function(dictOrd) {
    return function(v2) {
      return function(v1) {
        return function(v22) {
          if (v1 instanceof Node2) {
            return function __do7() {
              var childSel = appendChildWithDatum1(v1.value0.elemType)(v1.value0.attrs)(v22)(v2)();
              var element4 = (function() {
                if (childSel instanceof EmptySelection) {
                  var v3 = head2(childSel.value0.parentElements);
                  if (v3 instanceof Just) {
                    return v3.value0;
                  }
                  ;
                  if (v3 instanceof Nothing) {
                    return unsafeCrashWith("renderTree: appendChild returned empty selection");
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1212, column 29 - line 1214, column 102): " + [v3.constructor.name]);
                }
                ;
                return unsafeCrashWith("renderTree: appendChild should return EmptySelection");
              })();
              traverse_2(function(behavior) {
                return applyBehaviorToElement(behavior)(element4);
              })(v1.value0.behaviors)();
              var childMaps = traverse2(function(child) {
                return renderNodeHelperWithDatum(dictOrd)(childSel)(child)(v22);
              })(v1.value0.children)();
              var combinedChildMap = foldl4(union2)(empty4)(map19(snd)(childMaps));
              var selectionsMap = (function() {
                if (v1.value0.name instanceof Just) {
                  return insert2(v1.value0.name.value0)(childSel)(combinedChildMap);
                }
                ;
                if (v1.value0.name instanceof Nothing) {
                  return combinedChildMap;
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1226, column 21 - line 1228, column 34): " + [v1.value0.name.constructor.name]);
              })();
              return new Tuple(element4, selectionsMap);
            };
          }
          ;
          if (v1 instanceof Join) {
            return renderNodeHelper(dictOrd)(v2)(v1);
          }
          ;
          if (v1 instanceof NestedJoin) {
            return renderNodeHelper(dictOrd)(v2)(v1);
          }
          ;
          if (v1 instanceof SceneJoin) {
            return renderNodeHelper(dictOrd)(v2)(v1);
          }
          ;
          if (v1 instanceof SceneNestedJoin) {
            return renderNodeHelper(dictOrd)(v2)(v1);
          }
          ;
          throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1197, column 1 - line 1203, column 74): " + [v2.constructor.name, v1.constructor.name, v22.constructor.name]);
        };
      };
    };
  };
  var renderNodeHelper = function(dictOrd) {
    var joinData22 = joinData1(dictOrd);
    var renderTemplatesForBoundSelection1 = renderTemplatesForBoundSelection(dictOrd);
    return function(v2) {
      return function(v1) {
        if (v1 instanceof Node2) {
          return renderNodeHelperWithDatum(dictOrd)(v2)(new Node2(v1.value0))(Nothing.value);
        }
        ;
        if (v1 instanceof Join) {
          return function __do7() {
            var v22 = joinData22(v1.value0.joinData)(v1.value0.key)(v2)();
            remove1(v22.value0.exit)();
            var enterElementsAndMaps = renderTemplatesForPendingSelection(dictOrd)(v1.value0.template)(v22.value0.enter)();
            var enterElements = map19(fst)(enterElementsAndMaps);
            var enterChildMaps = map19(snd)(enterElementsAndMaps);
            var updateElements = renderTemplatesForBoundSelection1(v1.value0.template)(v22.value0.update)();
            var allElements = append12(enterElements)(updateElements);
            var combinedChildMap = foldl4(union2)(empty4)(enterChildMaps);
            var doc = (function() {
              if (v22.value0.enter instanceof PendingSelection) {
                return v22.value0.enter.value0.document;
              }
              ;
              if (v22.value0.update instanceof BoundSelection) {
                return v22.value0.update.value0.document;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1302, column 12 - line 1303, column 43): " + [v22.value0.update.constructor.name]);
            })();
            var allData = (function() {
              if (v22.value0.enter instanceof PendingSelection) {
                return v22.value0.enter.value0.pendingData;
              }
              ;
              return [];
            })();
            var updateData = (function() {
              if (v22.value0.update instanceof BoundSelection) {
                return v22.value0.update.value0.data;
              }
              ;
              return [];
            })();
            var boundSel = new BoundSelection({
              elements: allElements,
              data: append12(allData)(updateData),
              indices: new Just(range2(0)(length3(allElements) - 1 | 0)),
              document: doc
            });
            var selectionsMap = insert2(v1.value0.name)(boundSel)(combinedChildMap);
            var firstElement = (function() {
              var v3 = head2(allElements);
              if (v3 instanceof Just) {
                return v3.value0;
              }
              ;
              if (v3 instanceof Nothing) {
                return createElementWithNS(Group.value)(doc)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1328, column 19 - line 1330, column 45): " + [v3.constructor.name]);
            })();
            return new Tuple(firstElement, selectionsMap);
          };
        }
        ;
        if (v1 instanceof NestedJoin) {
          return function __do7() {
            var v22 = joinData22(v1.value0.joinData)(v1.value0.key)(v2)();
            var elementsAndMaps = renderNestedTemplatesForPendingSelection(dictOrd)(v1.value0.decompose)(v1.value0.template)(stringToElementType(v1.value0.key))(v22.value0.enter)();
            var elements = map19(fst)(elementsAndMaps);
            var childMaps = map19(snd)(elementsAndMaps);
            var combinedChildMap = foldl4(union2)(empty4)(childMaps);
            var v3 = (function() {
              if (v22.value0.enter instanceof PendingSelection) {
                return v22.value0.enter.value0;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1354, column 52 - line 1355, column 34): " + [v22.value0.enter.constructor.name]);
            })();
            var boundSel = new BoundSelection({
              elements,
              data: v3.pendingData,
              indices: new Just(range2(0)(length3(elements) - 1 | 0)),
              document: v3.document
            });
            var selectionsMap = insert2(v1.value0.name)(boundSel)(combinedChildMap);
            var firstElement = (function() {
              var v4 = head2(elements);
              if (v4 instanceof Just) {
                return v4.value0;
              }
              ;
              if (v4 instanceof Nothing) {
                return createElementWithNS(Group.value)(v3.document)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1370, column 19 - line 1372, column 45): " + [v4.constructor.name]);
            })();
            return new Tuple(firstElement, selectionsMap);
          };
        }
        ;
        if (v1 instanceof SceneJoin) {
          return function __do7() {
            var v22 = (function() {
              if (v1.value0.keyFn instanceof Just) {
                return joinDataWithKey1(v1.value0.joinData)(v1.value0.keyFn.value0)(v1.value0.key)(v2)();
              }
              ;
              if (v1.value0.keyFn instanceof Nothing) {
                return joinData22(v1.value0.joinData)(v1.value0.key)(v2)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1382, column 5 - line 1384, column 67): " + [v1.value0.keyFn.constructor.name]);
            })();
            liftEffect2((function() {
              var enterCount = (function() {
                if (v22.value0.enter instanceof PendingSelection) {
                  return length3(v22.value0.enter.value0.pendingData);
                }
                ;
                return 0;
              })();
              var updateCount = (function() {
                if (v22.value0.update instanceof BoundSelection) {
                  return length3(v22.value0.update.value0.data);
                }
                ;
                return 0;
              })();
              var exitCount = (function() {
                if (v22.value0.exit instanceof BoundSelection) {
                  return length3(v22.value0.exit.value0.data);
                }
                ;
                if (v22.value0.exit instanceof ExitingSelection) {
                  return length3(v22.value0.exit.value0.data);
                }
                ;
                return 0;
              })();
              return log4("Tree API SceneJoin '" + (v1.value0.name + ("': enter=" + (show22(enterCount) + (", update=" + (show22(updateCount) + (", exit=" + show22(exitCount))))))));
            })())();
            (function() {
              if (v1.value0.exitBehavior instanceof Just) {
                if (v1.value0.exitBehavior.value0.transition instanceof Just) {
                  var pairs = getExitingElementDatumPairs(v22.value0.exit);
                  return liftEffect2(applyExitTransitionToElements(v1.value0.exitBehavior.value0.transition.value0)(pairs)(v1.value0.exitBehavior.value0.attrs))();
                }
                ;
                if (v1.value0.exitBehavior.value0.transition instanceof Nothing) {
                  setAttrsExit1(v1.value0.exitBehavior.value0.attrs)(v22.value0.exit)();
                  remove1(v22.value0.exit)();
                  return unit;
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1416, column 7 - line 1424, column 20): " + [v1.value0.exitBehavior.value0.transition.constructor.name]);
              }
              ;
              if (v1.value0.exitBehavior instanceof Nothing) {
                remove1(v22.value0.exit)();
                return unit;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1414, column 3 - line 1428, column 16): " + [v1.value0.exitBehavior.constructor.name]);
            })();
            var enterElementsAndMaps = (function() {
              if (v1.value0.enterBehavior instanceof Just) {
                var modifiedTemplate = function(datum2) {
                  var v3 = v1.value0.template(datum2);
                  if (v3 instanceof Node2) {
                    return new Node2({
                      name: v3.value0.name,
                      elemType: v3.value0.elemType,
                      behaviors: v3.value0.behaviors,
                      children: v3.value0.children,
                      attrs: append12(v3.value0.attrs)(v1.value0.enterBehavior.value0.initialAttrs)
                    });
                  }
                  ;
                  return v3;
                };
                var rendered = renderTemplatesForPendingSelection(dictOrd)(modifiedTemplate)(v22.value0.enter)();
                (function() {
                  if (v1.value0.enterBehavior.value0.transition instanceof Just) {
                    var enterElements2 = map19(fst)(rendered);
                    var pendingData = (function() {
                      if (v22.value0.enter instanceof PendingSelection) {
                        return v22.value0.enter.value0.pendingData;
                      }
                      ;
                      throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1457, column 41 - line 1458, column 54): " + [v22.value0.enter.constructor.name]);
                    })();
                    var pairs = zipWith2(Tuple.create)(enterElements2)(pendingData);
                    return liftEffect2(traverseWithIndex_2(function(index7) {
                      return function(v3) {
                        var finalAttrs = (function() {
                          var v4 = v1.value0.template(v3.value1);
                          if (v4 instanceof Node2) {
                            return v4.value0.attrs;
                          }
                          ;
                          return [];
                        })();
                        return applyTransitionToSingleElement(v1.value0.enterBehavior.value0.transition.value0)(index7)(v3.value0)(v3.value1)(finalAttrs);
                      };
                    })(pairs))();
                  }
                  ;
                  if (v1.value0.enterBehavior.value0.transition instanceof Nothing) {
                    return unit;
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1452, column 7 - line 1468, column 29): " + [v1.value0.enterBehavior.value0.transition.constructor.name]);
                })();
                return rendered;
              }
              ;
              if (v1.value0.enterBehavior instanceof Nothing) {
                return renderTemplatesForPendingSelection(dictOrd)(v1.value0.template)(v22.value0.enter)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1439, column 27 - line 1473, column 68): " + [v1.value0.enterBehavior.constructor.name]);
            })();
            var enterElements = map19(fst)(enterElementsAndMaps);
            var enterChildMaps = map19(snd)(enterElementsAndMaps);
            var updateElements = (function() {
              if (v1.value0.updateBehavior instanceof Just) {
                if (v1.value0.updateBehavior.value0.transition instanceof Just) {
                  var pairs = getBoundElementDatumPairs(v22.value0.update);
                  liftEffect2(traverseWithIndex_2(function(index7) {
                    return function(v3) {
                      return applyTransitionToSingleElement(v1.value0.updateBehavior.value0.transition.value0)(index7)(v3.value0)(v3.value1)(v1.value0.updateBehavior.value0.attrs);
                    };
                  })(pairs))();
                  return getElementsFromBoundSelection(v22.value0.update);
                }
                ;
                if (v1.value0.updateBehavior.value0.transition instanceof Nothing) {
                  setAttrs1(v1.value0.updateBehavior.value0.attrs)(v22.value0.update)();
                  return renderTemplatesForBoundSelection1(v1.value0.template)(v22.value0.update)();
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1482, column 7 - line 1498, column 71): " + [v1.value0.updateBehavior.value0.transition.constructor.name]);
              }
              ;
              if (v1.value0.updateBehavior instanceof Nothing) {
                return renderTemplatesForBoundSelection1(v1.value0.template)(v22.value0.update)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1479, column 21 - line 1501, column 67): " + [v1.value0.updateBehavior.constructor.name]);
            })();
            var allElements = append12(enterElements)(updateElements);
            var combinedChildMap = foldl4(union2)(empty4)(enterChildMaps);
            var doc = (function() {
              if (v22.value0.enter instanceof PendingSelection) {
                return v22.value0.enter.value0.document;
              }
              ;
              if (v22.value0.update instanceof BoundSelection) {
                return v22.value0.update.value0.document;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1515, column 12 - line 1516, column 43): " + [v22.value0.update.constructor.name]);
            })();
            var allData = (function() {
              if (v22.value0.enter instanceof PendingSelection) {
                return v22.value0.enter.value0.pendingData;
              }
              ;
              return [];
            })();
            var updateData = (function() {
              if (v22.value0.update instanceof BoundSelection) {
                return v22.value0.update.value0.data;
              }
              ;
              return [];
            })();
            var boundSel = new BoundSelection({
              elements: allElements,
              data: append12(allData)(updateData),
              indices: new Just(range2(0)(length3(allElements) - 1 | 0)),
              document: doc
            });
            var selectionsMap = insert2(v1.value0.name)(boundSel)(combinedChildMap);
            var firstElement = (function() {
              var v3 = head2(allElements);
              if (v3 instanceof Just) {
                return v3.value0;
              }
              ;
              if (v3 instanceof Nothing) {
                return createElementWithNS(Group.value)(doc)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1540, column 19 - line 1542, column 45): " + [v3.constructor.name]);
            })();
            return new Tuple(firstElement, selectionsMap);
          };
        }
        ;
        if (v1 instanceof SceneNestedJoin) {
          var innerData = join2(map19(v1.value0.decompose)(v1.value0.joinData));
          return function __do7() {
            var v22 = joinDataWithKey1(innerData)(jsonStringify_)(v1.value0.key)(v2)();
            (function() {
              if (v1.value0.exitBehavior instanceof Just) {
                if (v1.value0.exitBehavior.value0.transition instanceof Just) {
                  var pairs = getExitingElementDatumPairs(v22.value0.exit);
                  return liftEffect2(applyExitTransitionToElements(v1.value0.exitBehavior.value0.transition.value0)(pairs)(v1.value0.exitBehavior.value0.attrs))();
                }
                ;
                if (v1.value0.exitBehavior.value0.transition instanceof Nothing) {
                  setAttrsExit1(v1.value0.exitBehavior.value0.attrs)(v22.value0.exit)();
                  remove1(v22.value0.exit)();
                  return unit;
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1593, column 7 - line 1601, column 20): " + [v1.value0.exitBehavior.value0.transition.constructor.name]);
              }
              ;
              if (v1.value0.exitBehavior instanceof Nothing) {
                remove1(v22.value0.exit)();
                return unit;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1591, column 3 - line 1604, column 16): " + [v1.value0.exitBehavior.constructor.name]);
            })();
            var enterElementsAndMaps = (function() {
              if (v1.value0.enterBehavior instanceof Just) {
                var modifiedTemplate = function(datum2) {
                  var v3 = v1.value0.template(datum2);
                  if (v3 instanceof Node2) {
                    return new Node2({
                      name: v3.value0.name,
                      elemType: v3.value0.elemType,
                      behaviors: v3.value0.behaviors,
                      children: v3.value0.children,
                      attrs: append12(v3.value0.attrs)(v1.value0.enterBehavior.value0.initialAttrs)
                    });
                  }
                  ;
                  return v3;
                };
                var rendered = renderTemplatesForPendingSelection(dictOrd)(modifiedTemplate)(v22.value0.enter)();
                (function() {
                  if (v1.value0.enterBehavior.value0.transition instanceof Just) {
                    var enterElements2 = map19(fst)(rendered);
                    var pendingData = (function() {
                      if (v22.value0.enter instanceof PendingSelection) {
                        return v22.value0.enter.value0.pendingData;
                      }
                      ;
                      throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1637, column 41 - line 1638, column 54): " + [v22.value0.enter.constructor.name]);
                    })();
                    var pairs = zipWith2(Tuple.create)(enterElements2)(pendingData);
                    return liftEffect2(traverseWithIndex_2(function(index7) {
                      return function(v4) {
                        var finalAttrs = (function() {
                          var v5 = v1.value0.template(v4.value1);
                          if (v5 instanceof Node2) {
                            return v5.value0.attrs;
                          }
                          ;
                          return [];
                        })();
                        return applyTransitionToSingleElement(v1.value0.enterBehavior.value0.transition.value0)(index7)(v4.value0)(v4.value1)(finalAttrs);
                      };
                    })(pairs))();
                  }
                  ;
                  if (v1.value0.enterBehavior.value0.transition instanceof Nothing) {
                    return unit;
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1632, column 7 - line 1648, column 29): " + [v1.value0.enterBehavior.value0.transition.constructor.name]);
                })();
                return rendered;
              }
              ;
              if (v1.value0.enterBehavior instanceof Nothing) {
                return renderTemplatesForPendingSelection(dictOrd)(v1.value0.template)(v22.value0.enter)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1621, column 27 - line 1651, column 92): " + [v1.value0.enterBehavior.constructor.name]);
            })();
            var updateElements = (function() {
              if (v1.value0.updateBehavior instanceof Just) {
                if (v1.value0.updateBehavior.value0.transition instanceof Just) {
                  var pairs = getBoundElementDatumPairs(v22.value0.update);
                  liftEffect2(traverseWithIndex_2(function(index7) {
                    return function(v4) {
                      return applyTransitionToSingleElement(v1.value0.updateBehavior.value0.transition.value0)(index7)(v4.value0)(v4.value1)(v1.value0.updateBehavior.value0.attrs);
                    };
                  })(pairs))();
                  return getElementsFromBoundSelection(v22.value0.update);
                }
                ;
                if (v1.value0.updateBehavior.value0.transition instanceof Nothing) {
                  setAttrs1(v1.value0.updateBehavior.value0.attrs)(v22.value0.update)();
                  return renderTemplatesForBoundSelection1(v1.value0.template)(v22.value0.update)();
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1657, column 7 - line 1670, column 86): " + [v1.value0.updateBehavior.value0.transition.constructor.name]);
              }
              ;
              if (v1.value0.updateBehavior instanceof Nothing) {
                return renderTemplatesForBoundSelection1(v1.value0.template)(v22.value0.update)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1654, column 21 - line 1671, column 91): " + [v1.value0.updateBehavior.constructor.name]);
            })();
            var enterElements = map19(fst)(enterElementsAndMaps);
            var allElements = append12(enterElements)(updateElements);
            var enterChildMaps = map19(snd)(enterElementsAndMaps);
            var combinedChildMap = foldl4(union2)(empty4)(enterChildMaps);
            var doc = (function() {
              if (v22.value0.enter instanceof PendingSelection) {
                return v22.value0.enter.value0.document;
              }
              ;
              if (v22.value0.update instanceof BoundSelection) {
                return v22.value0.update.value0.document;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1690, column 12 - line 1691, column 43): " + [v22.value0.update.constructor.name]);
            })();
            var boundSel = new BoundSelection({
              elements: allElements,
              data: innerData,
              indices: new Just(range2(0)(length3(allElements) - 1 | 0)),
              document: doc
            });
            var selectionsMap = insert2(v1.value0.name)(boundSel)(combinedChildMap);
            var firstElement = (function() {
              var v5 = head2(allElements);
              if (v5 instanceof Just) {
                return v5.value0;
              }
              ;
              if (v5 instanceof Nothing) {
                return createElementWithNS(Group.value)(doc)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1705, column 19 - line 1707, column 45): " + [v5.constructor.name]);
            })();
            return new Tuple(firstElement, selectionsMap);
          };
        }
        ;
        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1241, column 1 - line 1246, column 74): " + [v2.constructor.name, v1.constructor.name]);
      };
    };
  };
  var renderNestedTemplatesForPendingSelection = function(dictOrd) {
    return function(decomposer) {
      return function(templateFn) {
        return function(wrapperType) {
          return function(pendingSel) {
            var v2 = (function() {
              if (pendingSel instanceof PendingSelection) {
                return pendingSel.value0;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1728, column 68 - line 1729, column 34): " + [pendingSel.constructor.name]);
            })();
            return traverseWithIndex2(function(idx) {
              return function(outerDatum) {
                var parentIdx = mod2(idx)(length3(v2.parentElements));
                var v1 = index(v2.parentElements)(parentIdx);
                if (v1 instanceof Nothing) {
                  return unsafeCrashWith("renderNestedTemplatesForPendingSelection: no parent elements");
                }
                ;
                if (v1 instanceof Just) {
                  return function __do7() {
                    var wrapperElement = createElementWithNS(wrapperType)(v2.document)();
                    var wrapperNode = toNode(wrapperElement);
                    var parentNode3 = toNode(v1.value0);
                    appendChild2(wrapperNode)(parentNode3)();
                    var innerDataArray = decomposer(outerDatum);
                    var innerMaps = traverse2(function(innerDatumErased) {
                      var tree2 = templateFn(innerDatumErased);
                      var singleParentSel = new EmptySelection({
                        parentElements: [wrapperElement],
                        document: v2.document
                      });
                      return function __do8() {
                        var v22 = renderNodeHelperWithDatum(dictOrd)(singleParentSel)(tree2)(new Just(innerDatumErased))();
                        return v22.value1;
                      };
                    })(innerDataArray)();
                    var combinedInnerMap = foldl4(union2)(empty4)(innerMaps);
                    return new Tuple(wrapperElement, combinedInnerMap);
                  };
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1734, column 9 - line 1766, column 57): " + [v1.constructor.name]);
              };
            })(v2.pendingData);
          };
        };
      };
    };
  };
  var renderTree2 = function(dictOrd) {
    var renderNodeHelper1 = renderNodeHelper(dictOrd);
    return function(parent2) {
      return function(tree2) {
        return function __do7() {
          var v2 = renderNodeHelper1(parent2)(tree2)();
          return v2.value1;
        };
      };
    };
  };
  var appendChildInheriting = function(dictMonadEffect) {
    var liftEffect118 = liftEffect(dictMonadEffect);
    return function(elemType) {
      return function(attrs) {
        return function(v2) {
          return liftEffect118((function() {
            var v1 = (function() {
              if (v2 instanceof BoundSelection) {
                return v2.value0;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 492, column 82 - line 493, column 28): " + [v2.constructor.name]);
            })();
            return function __do7() {
              var childElements = traverseWithIndex2(function(idx) {
                return function(v22) {
                  return function __do8() {
                    var child = createElementWithNS(elemType)(v1.document)();
                    setElementData_(v22.value1)(child)();
                    applyAttributes(child)(v22.value1)(idx)(attrs)();
                    var childNode = toNode(child);
                    var parentNode3 = toNode(v22.value0);
                    appendChild2(childNode)(parentNode3)();
                    return child;
                  };
                };
              })(zipWith2(Tuple.create)(v1.elements)(v1.data))();
              return new BoundSelection({
                elements: childElements,
                data: v1.data,
                indices: Nothing.value,
                document: v1.document
              });
            };
          })());
        };
      };
    };
  };
  var appendChild3 = function(dictMonadEffect) {
    var liftEffect118 = liftEffect(dictMonadEffect);
    return function(elemType) {
      return function(attrs) {
        return function(v2) {
          return liftEffect118((function() {
            var v1 = (function() {
              if (v2 instanceof EmptySelection) {
                return v2.value0;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 400, column 55 - line 401, column 28): " + [v2.constructor.name]);
            })();
            return function __do7() {
              var elements = traverse2(function(parent2) {
                return function __do8() {
                  var element4 = createElementWithNS(elemType)(v1.document)();
                  applyAttributes(element4)(unit)(0)(attrs)();
                  var elementNode = toNode(element4);
                  var parentNode3 = toNode(parent2);
                  appendChild2(elementNode)(parentNode3)();
                  return element4;
                };
              })(v1.parentElements)();
              return new EmptySelection({
                parentElements: elements,
                document: v1.document
              });
            };
          })());
        };
      };
    };
  };
  var append7 = function(dictMonadEffect) {
    var liftEffect118 = liftEffect(dictMonadEffect);
    return function(elemType) {
      return function(attrs) {
        return function(v2) {
          return liftEffect118((function() {
            var v1 = (function() {
              if (v2 instanceof PendingSelection) {
                return v2.value0;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 205, column 77 - line 206, column 30): " + [v2.constructor.name]);
            })();
            var parent2 = (function() {
              var v22 = head2(v1.parentElements);
              if (v22 instanceof Just) {
                return v22.value0;
              }
              ;
              if (v22 instanceof Nothing) {
                return unsafeIndex3(v1.parentElements)(0);
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 211, column 14 - line 213, column 68): " + [v22.constructor.name]);
            })();
            return function __do7() {
              var elements = traverseWithIndex2(function(arrayIndex) {
                return function(datum2) {
                  var logicalIndex = (function() {
                    if (v1.indices instanceof Just) {
                      return unsafeIndex3(v1.indices.value0)(arrayIndex);
                    }
                    ;
                    if (v1.indices instanceof Nothing) {
                      return arrayIndex;
                    }
                    ;
                    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 218, column 22 - line 220, column 30): " + [v1.indices.constructor.name]);
                  })();
                  return function __do8() {
                    var element4 = createElementWithNS(elemType)(v1.document)();
                    applyAttributes(element4)(datum2)(logicalIndex)(attrs)();
                    setElementData_(datum2)(element4)();
                    var elementNode = toNode(element4);
                    var parentNode3 = toNode(parent2);
                    appendChild2(elementNode)(parentNode3)();
                    return element4;
                  };
                };
              })(v1.pendingData)();
              return new BoundSelection({
                elements,
                data: v1.pendingData,
                indices: v1.indices,
                document: v1.document
              });
            };
          })());
        };
      };
    };
  };
  var append32 = /* @__PURE__ */ append7(monadEffectEffect);
  var appendData = function(dictMonadEffect) {
    var liftEffect118 = liftEffect(dictMonadEffect);
    return function(dictFoldable) {
      var fromFoldable44 = fromFoldable3(dictFoldable);
      return function(elemType) {
        return function(foldableData) {
          return function(attrs) {
            return function(emptySelection) {
              return liftEffect118((function() {
                var v2 = (function() {
                  if (emptySelection instanceof EmptySelection) {
                    return emptySelection.value0;
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 808, column 55 - line 809, column 28): " + [emptySelection.constructor.name]);
                })();
                var dataArray = fromFoldable44(foldableData);
                var pendingSelection = new PendingSelection({
                  parentElements: v2.parentElements,
                  pendingData: dataArray,
                  indices: new Just(range2(0)(length3(dataArray) - 1 | 0)),
                  document: v2.document
                });
                return append32(elemType)(attrs)(pendingSelection);
              })());
            };
          };
        };
      };
    };
  };
  var renderData = function(dictMonadEffect) {
    var Monad0 = dictMonadEffect.Monad0();
    var Bind1 = Monad0.Bind1();
    var bind142 = bind(Bind1);
    var joinData22 = joinData2(dictMonadEffect);
    var append42 = append7(dictMonadEffect);
    var pure128 = pure(Monad0.Applicative0());
    var applyPerDatumAttrs1 = applyPerDatumAttrs(dictMonadEffect);
    var discard220 = discard2(Bind1);
    var remove22 = remove3(dictMonadEffect);
    var merge1 = merge(dictMonadEffect);
    return function(dictFoldable) {
      var joinData32 = joinData22(dictFoldable);
      return function(dictOrd) {
        var joinData4 = joinData32(dictOrd);
        return function(elemType) {
          return function(foldableData) {
            return function(selector) {
              return function(emptySelection) {
                return function(enterAttrs) {
                  return function(updateAttrs) {
                    return function(exitAttrs) {
                      return bind142(joinData4(foldableData)(selector)(emptySelection))(function(v2) {
                        return bind142(bind142(append42(elemType)([])(v2.value0.enter))(function(bound) {
                          if (enterAttrs instanceof Nothing) {
                            return pure128(bound);
                          }
                          ;
                          if (enterAttrs instanceof Just) {
                            return applyPerDatumAttrs1(enterAttrs.value0)(bound);
                          }
                          ;
                          throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 761, column 5 - line 763, column 55): " + [enterAttrs.constructor.name]);
                        }))(function(enterBound) {
                          return bind142((function() {
                            if (updateAttrs instanceof Nothing) {
                              return pure128(v2.value0.update);
                            }
                            ;
                            if (updateAttrs instanceof Just) {
                              return applyPerDatumAttrs1(updateAttrs.value0)(v2.value0.update);
                            }
                            ;
                            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 766, column 18 - line 768, column 54): " + [updateAttrs.constructor.name]);
                          })())(function(updateBound) {
                            return discard220((function() {
                              if (exitAttrs instanceof Nothing) {
                                return remove22(v2.value0.exit);
                              }
                              ;
                              if (exitAttrs instanceof Just) {
                                return bind142(applyPerDatumAttrs1(exitAttrs.value0)(v2.value0.exit))(function() {
                                  return remove22(v2.value0.exit);
                                });
                              }
                              ;
                              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 771, column 3 - line 775, column 18): " + [exitAttrs.constructor.name]);
                            })())(function() {
                              return merge1(enterBound)(updateBound);
                            });
                          });
                        });
                      });
                    };
                  };
                };
              };
            };
          };
        };
      };
    };
  };

  // output/Unsafe.Reference/foreign.js
  function reallyUnsafeRefEq(a3) {
    return function(b10) {
      return a3 === b10;
    };
  }

  // output/Unsafe.Reference/index.js
  var unsafeRefEq = reallyUnsafeRefEq;

  // output/PSD3.Interpreter.D3/index.js
  var select5 = /* @__PURE__ */ select4(monadEffectEffect);
  var selectAll2 = /* @__PURE__ */ selectAll(monadEffectEffect);
  var selectAllWithData2 = /* @__PURE__ */ selectAllWithData(monadEffectEffect);
  var renderData2 = /* @__PURE__ */ renderData(monadEffectEffect);
  var appendData2 = /* @__PURE__ */ appendData(monadEffectEffect);
  var joinData3 = /* @__PURE__ */ joinData2(monadEffectEffect);
  var joinDataWithKey2 = /* @__PURE__ */ joinDataWithKey(monadEffectEffect);
  var append8 = /* @__PURE__ */ append7(monadEffectEffect);
  var setAttrs3 = /* @__PURE__ */ setAttrs2(monadEffectEffect);
  var setAttrsExit2 = /* @__PURE__ */ setAttrsExit(monadEffectEffect);
  var remove5 = /* @__PURE__ */ remove3(monadEffectEffect);
  var clear4 = /* @__PURE__ */ clear3(monadEffectEffect);
  var merge2 = /* @__PURE__ */ merge(monadEffectEffect);
  var appendChild4 = /* @__PURE__ */ appendChild3(monadEffectEffect);
  var appendChildInheriting2 = /* @__PURE__ */ appendChildInheriting(monadEffectEffect);
  var map20 = /* @__PURE__ */ map(functorMap);
  var show3 = /* @__PURE__ */ show(showNumber);
  var show12 = /* @__PURE__ */ show(showBoolean);
  var traverseWithIndex_3 = /* @__PURE__ */ traverseWithIndex_(applicativeEffect)(foldableWithIndexArray);
  var unsafeIndex4 = /* @__PURE__ */ unsafeIndex();
  var traverse_3 = /* @__PURE__ */ traverse_(applicativeEffect)(foldableArray);
  var D3v2Selection_ = function(x32) {
    return x32;
  };
  var monadEffectD3v2M = monadEffectEffect;
  var monadD3v2M = monadEffect;
  var selectionMD3v2Selection_D = {
    select: function(selector) {
      return function __do7() {
        var sel = select5(selector)();
        return sel;
      };
    },
    selectAll: function(selector) {
      return function(v2) {
        return function __do7() {
          var result = selectAll2(selector)(v2)();
          return result;
        };
      };
    },
    openSelection: function(v2) {
      return function(selector) {
        return function __do7() {
          var result = selectAll2(selector)(v2)();
          return result;
        };
      };
    },
    selectAllWithData: function(selector) {
      return function(v2) {
        return function __do7() {
          var result = selectAllWithData2(selector)(v2)();
          return result;
        };
      };
    },
    renderData: function(dictFoldable) {
      var renderData1 = renderData2(dictFoldable);
      return function(dictOrd) {
        var renderData22 = renderData1(dictOrd);
        return function(elemType) {
          return function(foldableData) {
            return function(selector) {
              return function(v2) {
                return function(enterAttrs) {
                  return function(updateAttrs) {
                    return function(exitAttrs) {
                      return function __do7() {
                        var result = renderData22(elemType)(foldableData)(selector)(v2)(enterAttrs)(updateAttrs)(exitAttrs)();
                        return result;
                      };
                    };
                  };
                };
              };
            };
          };
        };
      };
    },
    appendData: function(dictFoldable) {
      var appendData1 = appendData2(dictFoldable);
      return function(elemType) {
        return function(foldableData) {
          return function(attrs) {
            return function(v2) {
              return function __do7() {
                var result = appendData1(elemType)(foldableData)(attrs)(v2)();
                return result;
              };
            };
          };
        };
      };
    },
    joinData: function(dictFoldable) {
      var joinData12 = joinData3(dictFoldable);
      return function(dictOrd) {
        var joinData22 = joinData12(dictOrd);
        return function(foldableData) {
          return function(selector) {
            return function(v2) {
              return function __do7() {
                var v1 = joinData22(foldableData)(selector)(v2)();
                return new JoinResult({
                  enter: v1.value0.enter,
                  update: v1.value0.update,
                  exit: v1.value0.exit
                });
              };
            };
          };
        };
      };
    },
    joinDataWithKey: function(dictFoldable) {
      var joinDataWithKey12 = joinDataWithKey2(dictFoldable);
      return function(dictOrd) {
        var joinDataWithKey22 = joinDataWithKey12(dictOrd.Eq0());
        return function(foldableData) {
          return function(keyFn) {
            return function(selector) {
              return function(v2) {
                return function __do7() {
                  var v1 = joinDataWithKey22(foldableData)(keyFn)(selector)(v2)();
                  return new JoinResult({
                    enter: v1.value0.enter,
                    update: v1.value0.update,
                    exit: v1.value0.exit
                  });
                };
              };
            };
          };
        };
      };
    },
    updateJoin: function(dictFoldable) {
      var joinDataWithKey12 = joinDataWithKey2(dictFoldable);
      return function(dictOrd) {
        var joinDataWithKey22 = joinDataWithKey12(dictOrd.Eq0());
        return function(v2) {
          return function(_elemType) {
            return function(foldableData) {
              return function(keyFn) {
                return function(selector) {
                  return function __do7() {
                    var v1 = joinDataWithKey22(foldableData)(keyFn)(selector)(v2)();
                    return new JoinResult({
                      enter: v1.value0.enter,
                      update: v1.value0.update,
                      exit: v1.value0.exit
                    });
                  };
                };
              };
            };
          };
        };
      };
    },
    append: function(elemType) {
      return function(attrs) {
        return function(v2) {
          return function __do7() {
            var result = append8(elemType)(attrs)(v2)();
            return result;
          };
        };
      };
    },
    setAttrs: function(attrs) {
      return function(v2) {
        return function __do7() {
          var result = setAttrs3(attrs)(v2)();
          return result;
        };
      };
    },
    setAttrsExit: function(attrs) {
      return function(v2) {
        return function __do7() {
          var result = setAttrsExit2(attrs)(v2)();
          return result;
        };
      };
    },
    remove: function(v2) {
      return remove5(v2);
    },
    clear: function(selector) {
      return clear4(selector);
    },
    merge: function(v2) {
      return function(v1) {
        return function __do7() {
          var result = merge2(v2)(v1)();
          return result;
        };
      };
    },
    appendChild: function(elemType) {
      return function(attrs) {
        return function(v2) {
          return function __do7() {
            var result = appendChild4(elemType)(attrs)(v2)();
            return result;
          };
        };
      };
    },
    appendChildInheriting: function(elemType) {
      return function(attrs) {
        return function(v2) {
          return function __do7() {
            var result = appendChildInheriting2(elemType)(attrs)(v2)();
            return result;
          };
        };
      };
    },
    on: function(behavior) {
      return function(v2) {
        return function __do7() {
          var result = on3(behavior)(v2)();
          return result;
        };
      };
    },
    renderTree: function(dictOrd) {
      var renderTree75 = renderTree2(dictOrd);
      return function(v2) {
        return function(tree2) {
          return function __do7() {
            var selectionsMap = renderTree75(v2)(tree2)();
            return map20(D3v2Selection_)(selectionsMap);
          };
        };
      };
    },
    Monad0: function() {
      return monadD3v2M;
    }
  };
  var bindD3v2M = bindEffect;
  var applicativeD3v2M = applicativeEffect;
  var runD3v2M = function(v2) {
    return v2;
  };
  var reselectD3v2 = function(name16) {
    return function(selectionsMap) {
      var unwrappedMap = map20(function(v2) {
        return v2;
      })(selectionsMap);
      return function __do7() {
        var result = reselect(name16)(unwrappedMap)();
        return result;
      };
    };
  };
  var attributeValueToString2 = function(v2) {
    if (v2 instanceof StringValue) {
      return v2.value0;
    }
    ;
    if (v2 instanceof NumberValue) {
      return show3(v2.value0);
    }
    ;
    if (v2 instanceof BooleanValue) {
      return show12(v2.value0);
    }
    ;
    throw new Error("Failed pattern match at PSD3.Interpreter.D3 (line 291, column 1 - line 291, column 51): " + [v2.constructor.name]);
  };
  var transitionMD3v2Selection_ = {
    withTransition: function(config) {
      return function(v2) {
        return function(attrs) {
          var v1 = (function() {
            if (v2 instanceof BoundSelection) {
              return v2.value0;
            }
            ;
            throw new Error("Failed pattern match at PSD3.Interpreter.D3 (line 154, column 65 - line 155, column 44): " + [v2.constructor.name]);
          })();
          var paired = zipWith2(function(d) {
            return function(e) {
              return {
                datum: d,
                element: e
              };
            };
          })(v1.data)(v1.elements);
          return traverseWithIndex_3(function(arrayIndex) {
            return function(v22) {
              var logicalIndex = (function() {
                if (v1.indices instanceof Just) {
                  return unsafeIndex4(v1.indices.value0)(arrayIndex);
                }
                ;
                if (v1.indices instanceof Nothing) {
                  return arrayIndex;
                }
                ;
                throw new Error("Failed pattern match at PSD3.Interpreter.D3 (line 164, column 26 - line 166, column 34): " + [v1.indices.constructor.name]);
              })();
              return function __do7() {
                var transition3 = createTransition_(config.duration)(maybeMillisecondsToNullable(config.delay))(maybeEasingToNullable(config.easing))(v22.element)();
                return traverse_3(function(attr46) {
                  if (attr46 instanceof StaticAttr) {
                    return transitionSetAttribute_(attr46.value0)(attributeValueToString2(attr46.value1))(transition3);
                  }
                  ;
                  if (attr46 instanceof DataAttr) {
                    return transitionSetAttribute_(attr46.value0)(attributeValueToString2(attr46.value2(v22.datum)))(transition3);
                  }
                  ;
                  if (attr46 instanceof IndexedAttr) {
                    return transitionSetAttribute_(attr46.value0)(attributeValueToString2(attr46.value2(v22.datum)(logicalIndex)))(transition3);
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Interpreter.D3 (line 176, column 34 - line 184, column 112): " + [attr46.constructor.name]);
                })(attrs)();
              };
            };
          })(paired);
        };
      };
    },
    withTransitionExit: function(config) {
      return function(v2) {
        return function(attrs) {
          var v1 = (function() {
            if (v2 instanceof ExitingSelection) {
              return v2.value0;
            }
            ;
            throw new Error("Failed pattern match at PSD3.Interpreter.D3 (line 188, column 56 - line 189, column 46): " + [v2.constructor.name]);
          })();
          var paired = zipWith2(function(d) {
            return function(e) {
              return {
                datum: d,
                element: e
              };
            };
          })(v1.data)(v1.elements);
          return traverseWithIndex_3(function(index7) {
            return function(v22) {
              return function __do7() {
                var transition3 = createTransition_(config.duration)(maybeMillisecondsToNullable(config.delay))(maybeEasingToNullable(config.easing))(v22.element)();
                traverse_3(function(attr46) {
                  if (attr46 instanceof StaticAttr) {
                    return transitionSetAttribute_(attr46.value0)(attributeValueToString2(attr46.value1))(transition3);
                  }
                  ;
                  if (attr46 instanceof DataAttr) {
                    return transitionSetAttribute_(attr46.value0)(attributeValueToString2(attr46.value2(v22.datum)))(transition3);
                  }
                  ;
                  if (attr46 instanceof IndexedAttr) {
                    return transitionSetAttribute_(attr46.value0)(attributeValueToString2(attr46.value2(v22.datum)(index7)))(transition3);
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Interpreter.D3 (line 205, column 34 - line 213, column 105): " + [attr46.constructor.name]);
                })(attrs)();
                return transitionRemove_(transition3)();
              };
            };
          })(paired);
        };
      };
    },
    withTransitionStaggered: function(config) {
      return function(delayFn) {
        return function(v2) {
          return function(attrs) {
            var v1 = (function() {
              if (v2 instanceof BoundSelection) {
                return v2.value0;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Interpreter.D3 (line 220, column 65 - line 221, column 44): " + [v2.constructor.name]);
            })();
            var paired = zipWith2(function(d) {
              return function(e) {
                return {
                  datum: d,
                  element: e
                };
              };
            })(v1.data)(v1.elements);
            return traverseWithIndex_3(function(arrayIndex) {
              return function(v22) {
                var logicalIndex = (function() {
                  if (v1.indices instanceof Just) {
                    return unsafeIndex4(v1.indices.value0)(arrayIndex);
                  }
                  ;
                  if (v1.indices instanceof Nothing) {
                    return arrayIndex;
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Interpreter.D3 (line 230, column 26 - line 232, column 34): " + [v1.indices.constructor.name]);
                })();
                var v3 = delayFn(v22.datum)(logicalIndex);
                return function __do7() {
                  var transition3 = createTransition_(config.duration)(toNullable(new Just(v3)))(maybeEasingToNullable(config.easing))(v22.element)();
                  return traverse_3(function(attr46) {
                    if (attr46 instanceof StaticAttr) {
                      return transitionSetAttribute_(attr46.value0)(attributeValueToString2(attr46.value1))(transition3);
                    }
                    ;
                    if (attr46 instanceof DataAttr) {
                      return transitionSetAttribute_(attr46.value0)(attributeValueToString2(attr46.value2(v22.datum)))(transition3);
                    }
                    ;
                    if (attr46 instanceof IndexedAttr) {
                      return transitionSetAttribute_(attr46.value0)(attributeValueToString2(attr46.value2(v22.datum)(logicalIndex)))(transition3);
                    }
                    ;
                    throw new Error("Failed pattern match at PSD3.Interpreter.D3 (line 245, column 34 - line 253, column 112): " + [attr46.constructor.name]);
                  })(attrs)();
                };
              };
            })(paired);
          };
        };
      };
    },
    withTransitionExitStaggered: function(config) {
      return function(delayFn) {
        return function(v2) {
          return function(attrs) {
            var v1 = (function() {
              if (v2 instanceof ExitingSelection) {
                return v2.value0;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Interpreter.D3 (line 257, column 56 - line 258, column 46): " + [v2.constructor.name]);
            })();
            var paired = zipWith2(function(d) {
              return function(e) {
                return {
                  datum: d,
                  element: e
                };
              };
            })(v1.data)(v1.elements);
            return traverseWithIndex_3(function(index7) {
              return function(v22) {
                var v3 = delayFn(v22.datum)(index7);
                return function __do7() {
                  var transition3 = createTransition_(config.duration)(toNullable(new Just(v3)))(maybeEasingToNullable(config.easing))(v22.element)();
                  traverse_3(function(attr46) {
                    if (attr46 instanceof StaticAttr) {
                      return transitionSetAttribute_(attr46.value0)(attributeValueToString2(attr46.value1))(transition3);
                    }
                    ;
                    if (attr46 instanceof DataAttr) {
                      return transitionSetAttribute_(attr46.value0)(attributeValueToString2(attr46.value2(v22.datum)))(transition3);
                    }
                    ;
                    if (attr46 instanceof IndexedAttr) {
                      return transitionSetAttribute_(attr46.value0)(attributeValueToString2(attr46.value2(v22.datum)(index7)))(transition3);
                    }
                    ;
                    throw new Error("Failed pattern match at PSD3.Interpreter.D3 (line 277, column 34 - line 285, column 105): " + [attr46.constructor.name]);
                  })(attrs)();
                  return transitionRemove_(transition3)();
                };
              };
            })(paired);
          };
        };
      };
    },
    Monad0: function() {
      return monadD3v2M;
    }
  };

  // output/PSD3.Shared.FlareData/foreign.js
  var getName = (node) => node.name || "";
  var getValue = (node) => node.value || 0;
  var getChildren_ = (node) => {
    if (node.children && Array.isArray(node.children) && node.children.length > 0) {
      return node.children;
    }
    return null;
  };

  // output/PSD3.Shared.FlareData/index.js
  var getChildren = function($1) {
    return toMaybe(getChildren_($1));
  };

  // output/D3.Viz.AnimatedTreeClusterv2/index.js
  var show4 = /* @__PURE__ */ show(showNumber);
  var bind3 = /* @__PURE__ */ bind(bindArray);
  var fromFoldable7 = /* @__PURE__ */ fromFoldable3(foldableList);
  var append13 = /* @__PURE__ */ append(semigroupArray);
  var fromFoldable13 = /* @__PURE__ */ fromFoldable(foldableArray);
  var map21 = /* @__PURE__ */ map(functorArray);
  var bind1 = /* @__PURE__ */ bind(bindD3v2M);
  var select6 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var appendChild5 = /* @__PURE__ */ appendChild(selectionMD3v2Selection_D);
  var pure4 = /* @__PURE__ */ pure(applicativeD3v2M);
  var openSelection2 = /* @__PURE__ */ openSelection(selectionMD3v2Selection_D);
  var updateJoin2 = /* @__PURE__ */ updateJoin(selectionMD3v2Selection_D)(foldableArray)(ordString);
  var discard3 = /* @__PURE__ */ discard(discardUnit)(bindD3v2M);
  var remove6 = /* @__PURE__ */ remove(selectionMD3v2Selection_D);
  var append22 = /* @__PURE__ */ append5(selectionMD3v2Selection_D);
  var v3Static2 = /* @__PURE__ */ v3Static(showNumber);
  var setAttrs4 = /* @__PURE__ */ setAttrs(selectionMD3v2Selection_D);
  var withTransition2 = /* @__PURE__ */ withTransition(transitionMD3v2Selection_);
  var v3AttrFn2 = /* @__PURE__ */ v3AttrFn(showNumber);
  var TreeLayout = /* @__PURE__ */ (function() {
    function TreeLayout2() {
    }
    ;
    TreeLayout2.value = new TreeLayout2();
    return TreeLayout2;
  })();
  var ClusterLayout = /* @__PURE__ */ (function() {
    function ClusterLayout2() {
    }
    ;
    ClusterLayout2.value = new ClusterLayout2();
    return ClusterLayout2;
  })();
  var showLayoutType = {
    show: function(v2) {
      if (v2 instanceof TreeLayout) {
        return "Tree (Reingold-Tilford)";
      }
      ;
      if (v2 instanceof ClusterLayout) {
        return "Cluster (Dendrogram)";
      }
      ;
      throw new Error("Failed pattern match at D3.Viz.AnimatedTreeClusterv2 (line 33, column 1 - line 35, column 46): " + [v2.constructor.name]);
    }
  };
  var verticalLinkPath = function(x113) {
    return function(y114) {
      return function(x211) {
        return function(y211) {
          var midY = (y114 + y211) / 2;
          return "M" + (show4(x113) + ("," + (show4(y114) + (" C" + (show4(x113) + ("," + (show4(midY) + (" " + (show4(x211) + ("," + (show4(midY) + (" " + (show4(x211) + ("," + show4(y211)))))))))))))));
        };
      };
    };
  };
  var transitionConfig = /* @__PURE__ */ transition(1500);
  var toggleLayout = function(v2) {
    if (v2 instanceof TreeLayout) {
      return ClusterLayout.value;
    }
    ;
    if (v2 instanceof ClusterLayout) {
      return TreeLayout.value;
    }
    ;
    throw new Error("Failed pattern match at D3.Viz.AnimatedTreeClusterv2 (line 38, column 1 - line 38, column 41): " + [v2.constructor.name]);
  };
  var nodeKey = function(node) {
    return node.name;
  };
  var makeLinks = function(t2) {
    var val = head(t2);
    var children3 = tail(t2);
    var grandchildLinks = bind3(fromFoldable7(children3))(makeLinks);
    var childLinks = bind3(fromFoldable7(children3))(function(child) {
      var childVal = head(child);
      return [{
        source: {
          name: val.name,
          x: val.x,
          y: val.y
        },
        target: {
          name: childVal.name,
          x: childVal.x,
          y: childVal.y
        }
      }];
    });
    return append13(childLinks)(grandchildLinks);
  };
  var linkKey = function(link5) {
    return link5.source.name + ("->" + link5.target.name);
  };
  var hierDataToTree = function(hierData) {
    var value20 = getValue(hierData);
    var name16 = getName(hierData);
    var childrenMaybe = getChildren(hierData);
    var childrenList = (function() {
      if (childrenMaybe instanceof Nothing) {
        return Nil.value;
      }
      ;
      if (childrenMaybe instanceof Just) {
        return fromFoldable13(map21(hierDataToTree)(childrenMaybe.value0));
      }
      ;
      throw new Error("Failed pattern match at D3.Viz.AnimatedTreeClusterv2 (line 49, column 20 - line 51, column 76): " + [childrenMaybe.constructor.name]);
    })();
    return mkTree({
      name: name16,
      value: value20,
      x: 0,
      y: 0,
      depth: 0,
      height: 0
    })(childrenList);
  };
  var flattenTree = /* @__PURE__ */ fromFoldable3(/* @__PURE__ */ foldableCofree(foldableList));
  var draw = function(flareData) {
    return function(selector) {
      return runD3v2M((function() {
        var dataTree = hierDataToTree(flareData);
        return bind1(select6(selector))(function(container) {
          return bind1(appendChild5(SVG.value)([v3StaticStr("viewBox")("0 0 " + (show4(1200) + (" " + show4(900)))), v3StaticStr("class")("animated-tree4-cluster4")])(container))(function(svg2) {
            return bind1(appendChild5(Group.value)([v3StaticStr("class")("links")])(svg2))(function(linksGroup) {
              return bind1(appendChild5(Group.value)([v3StaticStr("class")("nodes")])(svg2))(function(nodesGroup) {
                return pure4({
                  dataTree,
                  linksGroup,
                  nodesGroup,
                  chartWidth: 1200,
                  chartHeight: 900
                });
              });
            });
          });
        });
      })());
    };
  };
  var animationStep = function(dataTree) {
    return function(linksGroup) {
      return function(nodesGroup) {
        return function(chartWidth) {
          return function(chartHeight) {
            return function(currentLayout) {
              return runD3v2M((function() {
                var positioned = (function() {
                  if (currentLayout instanceof TreeLayout) {
                    var config = {
                      layerScale: defaultTreeConfig.layerScale,
                      minSeparation: defaultTreeConfig.minSeparation,
                      separation: defaultTreeConfig.separation,
                      size: {
                        width: chartWidth,
                        height: chartHeight
                      }
                    };
                    return treeWithSorting(config)(dataTree);
                  }
                  ;
                  if (currentLayout instanceof ClusterLayout) {
                    var config = {
                      minSeparation: defaultClusterConfig.minSeparation,
                      size: {
                        width: chartWidth,
                        height: chartHeight
                      }
                    };
                    return cluster(config)(dataTree);
                  }
                  ;
                  throw new Error("Failed pattern match at D3.Viz.AnimatedTreeClusterv2 (line 152, column 18 - line 162, column 34): " + [currentLayout.constructor.name]);
                })();
                var nodes3 = flattenTree(positioned);
                var links3 = makeLinks(positioned);
                return bind1(openSelection2(linksGroup)("path"))(function(linksSelection) {
                  return bind1(updateJoin2(linksSelection)(Path.value)(links3)(linkKey)("path"))(function(v2) {
                    return discard3(remove6(v2.value0.exit))(function() {
                      var linkPathFn = function(link5) {
                        return verticalLinkPath(link5.source.x)(link5.source.y)(link5.target.x)(link5.target.y);
                      };
                      return bind1(append22(Path.value)([v3StaticStr("fill")("none"), v3StaticStr("stroke")("#555"), v3Static2("stroke-width")(1.5), v3StaticStr("class")("link"), v3AttrFnStr("d")(linkPathFn)])(v2.value0.enter))(function() {
                        return bind1(setAttrs4([v3StaticStr("fill")("none"), v3StaticStr("stroke")("#555"), v3Static2("stroke-width")(1.5), v3StaticStr("class")("link")])(v2.value0.update))(function() {
                          return discard3(withTransition2(transitionConfig)(v2.value0.update)([v3AttrFnStr("d")(linkPathFn)]))(function() {
                            return bind1(openSelection2(nodesGroup)("circle"))(function(nodesSelection) {
                              return bind1(updateJoin2(nodesSelection)(Circle.value)(nodes3)(nodeKey)("circle"))(function(v1) {
                                return discard3(remove6(v1.value0.exit))(function() {
                                  return bind1(append22(Circle.value)([v3Static2("r")(4), v3StaticStr("fill")("#999"), v3StaticStr("stroke")("#555"), v3Static2("stroke-width")(1.5), v3StaticStr("class")("node"), v3AttrFn2("cx")(function(v22) {
                                    return v22.x;
                                  }), v3AttrFn2("cy")(function(v22) {
                                    return v22.y;
                                  })])(v1.value0.enter))(function() {
                                    return bind1(setAttrs4([v3Static2("r")(4), v3StaticStr("fill")("#999"), v3StaticStr("stroke")("#555"), v3Static2("stroke-width")(1.5), v3StaticStr("class")("node")])(v1.value0.update))(function() {
                                      return discard3(withTransition2(transitionConfig)(v1.value0.update)([v3AttrFn2("cx")(function(v22) {
                                        return v22.x;
                                      }), v3AttrFn2("cy")(function(v22) {
                                        return v22.y;
                                      })]))(function() {
                                        return pure4(unit);
                                      });
                                    });
                                  });
                                });
                              });
                            });
                          });
                        });
                      });
                    });
                  });
                });
              })());
            };
          };
        };
      };
    };
  };

  // output/Effect.Aff/foreign.js
  var Aff = (function() {
    var EMPTY = {};
    var PURE = "Pure";
    var THROW = "Throw";
    var CATCH = "Catch";
    var SYNC = "Sync";
    var ASYNC = "Async";
    var BIND = "Bind";
    var BRACKET = "Bracket";
    var FORK = "Fork";
    var SEQ = "Sequential";
    var MAP = "Map";
    var APPLY = "Apply";
    var ALT = "Alt";
    var CONS = "Cons";
    var RESUME = "Resume";
    var RELEASE = "Release";
    var FINALIZER = "Finalizer";
    var FINALIZED = "Finalized";
    var FORKED = "Forked";
    var FIBER = "Fiber";
    var THUNK = "Thunk";
    function Aff2(tag, _1, _2, _3) {
      this.tag = tag;
      this._1 = _1;
      this._2 = _2;
      this._3 = _3;
    }
    function AffCtr(tag) {
      var fn = function(_1, _2, _3) {
        return new Aff2(tag, _1, _2, _3);
      };
      fn.tag = tag;
      return fn;
    }
    function nonCanceler2(error4) {
      return new Aff2(PURE, void 0);
    }
    function runEff(eff) {
      try {
        eff();
      } catch (error4) {
        setTimeout(function() {
          throw error4;
        }, 0);
      }
    }
    function runSync(left2, right2, eff) {
      try {
        return right2(eff());
      } catch (error4) {
        return left2(error4);
      }
    }
    function runAsync(left2, eff, k) {
      try {
        return eff(k)();
      } catch (error4) {
        k(left2(error4))();
        return nonCanceler2;
      }
    }
    var Scheduler = (function() {
      var limit = 1024;
      var size6 = 0;
      var ix = 0;
      var queue = new Array(limit);
      var draining = false;
      function drain() {
        var thunk;
        draining = true;
        while (size6 !== 0) {
          size6--;
          thunk = queue[ix];
          queue[ix] = void 0;
          ix = (ix + 1) % limit;
          thunk();
        }
        draining = false;
      }
      return {
        isDraining: function() {
          return draining;
        },
        enqueue: function(cb) {
          var i2, tmp;
          if (size6 === limit) {
            tmp = draining;
            drain();
            draining = tmp;
          }
          queue[(ix + size6) % limit] = cb;
          size6++;
          if (!draining) {
            drain();
          }
        }
      };
    })();
    function Supervisor(util2) {
      var fibers = {};
      var fiberId = 0;
      var count = 0;
      return {
        register: function(fiber) {
          var fid = fiberId++;
          fiber.onComplete({
            rethrow: true,
            handler: function(result) {
              return function() {
                count--;
                delete fibers[fid];
              };
            }
          })();
          fibers[fid] = fiber;
          count++;
        },
        isEmpty: function() {
          return count === 0;
        },
        killAll: function(killError, cb) {
          return function() {
            if (count === 0) {
              return cb();
            }
            var killCount = 0;
            var kills = {};
            function kill2(fid) {
              kills[fid] = fibers[fid].kill(killError, function(result) {
                return function() {
                  delete kills[fid];
                  killCount--;
                  if (util2.isLeft(result) && util2.fromLeft(result)) {
                    setTimeout(function() {
                      throw util2.fromLeft(result);
                    }, 0);
                  }
                  if (killCount === 0) {
                    cb();
                  }
                };
              })();
            }
            for (var k in fibers) {
              if (fibers.hasOwnProperty(k)) {
                killCount++;
                kill2(k);
              }
            }
            fibers = {};
            fiberId = 0;
            count = 0;
            return function(error4) {
              return new Aff2(SYNC, function() {
                for (var k2 in kills) {
                  if (kills.hasOwnProperty(k2)) {
                    kills[k2]();
                  }
                }
              });
            };
          };
        }
      };
    }
    var SUSPENDED = 0;
    var CONTINUE = 1;
    var STEP_BIND = 2;
    var STEP_RESULT = 3;
    var PENDING = 4;
    var RETURN = 5;
    var COMPLETED = 6;
    function Fiber(util2, supervisor, aff) {
      var runTick = 0;
      var status = SUSPENDED;
      var step5 = aff;
      var fail3 = null;
      var interrupt = null;
      var bhead = null;
      var btail = null;
      var attempts = null;
      var bracketCount = 0;
      var joinId = 0;
      var joins = null;
      var rethrow = true;
      function run3(localRunTick) {
        var tmp, result, attempt;
        while (true) {
          tmp = null;
          result = null;
          attempt = null;
          switch (status) {
            case STEP_BIND:
              status = CONTINUE;
              try {
                step5 = bhead(step5);
                if (btail === null) {
                  bhead = null;
                } else {
                  bhead = btail._1;
                  btail = btail._2;
                }
              } catch (e) {
                status = RETURN;
                fail3 = util2.left(e);
                step5 = null;
              }
              break;
            case STEP_RESULT:
              if (util2.isLeft(step5)) {
                status = RETURN;
                fail3 = step5;
                step5 = null;
              } else if (bhead === null) {
                status = RETURN;
              } else {
                status = STEP_BIND;
                step5 = util2.fromRight(step5);
              }
              break;
            case CONTINUE:
              switch (step5.tag) {
                case BIND:
                  if (bhead) {
                    btail = new Aff2(CONS, bhead, btail);
                  }
                  bhead = step5._2;
                  status = CONTINUE;
                  step5 = step5._1;
                  break;
                case PURE:
                  if (bhead === null) {
                    status = RETURN;
                    step5 = util2.right(step5._1);
                  } else {
                    status = STEP_BIND;
                    step5 = step5._1;
                  }
                  break;
                case SYNC:
                  status = STEP_RESULT;
                  step5 = runSync(util2.left, util2.right, step5._1);
                  break;
                case ASYNC:
                  status = PENDING;
                  step5 = runAsync(util2.left, step5._1, function(result2) {
                    return function() {
                      if (runTick !== localRunTick) {
                        return;
                      }
                      runTick++;
                      Scheduler.enqueue(function() {
                        if (runTick !== localRunTick + 1) {
                          return;
                        }
                        status = STEP_RESULT;
                        step5 = result2;
                        run3(runTick);
                      });
                    };
                  });
                  return;
                case THROW:
                  status = RETURN;
                  fail3 = util2.left(step5._1);
                  step5 = null;
                  break;
                // Enqueue the Catch so that we can call the error handler later on
                // in case of an exception.
                case CATCH:
                  if (bhead === null) {
                    attempts = new Aff2(CONS, step5, attempts, interrupt);
                  } else {
                    attempts = new Aff2(CONS, step5, new Aff2(CONS, new Aff2(RESUME, bhead, btail), attempts, interrupt), interrupt);
                  }
                  bhead = null;
                  btail = null;
                  status = CONTINUE;
                  step5 = step5._1;
                  break;
                // Enqueue the Bracket so that we can call the appropriate handlers
                // after resource acquisition.
                case BRACKET:
                  bracketCount++;
                  if (bhead === null) {
                    attempts = new Aff2(CONS, step5, attempts, interrupt);
                  } else {
                    attempts = new Aff2(CONS, step5, new Aff2(CONS, new Aff2(RESUME, bhead, btail), attempts, interrupt), interrupt);
                  }
                  bhead = null;
                  btail = null;
                  status = CONTINUE;
                  step5 = step5._1;
                  break;
                case FORK:
                  status = STEP_RESULT;
                  tmp = Fiber(util2, supervisor, step5._2);
                  if (supervisor) {
                    supervisor.register(tmp);
                  }
                  if (step5._1) {
                    tmp.run();
                  }
                  step5 = util2.right(tmp);
                  break;
                case SEQ:
                  status = CONTINUE;
                  step5 = sequential4(util2, supervisor, step5._1);
                  break;
              }
              break;
            case RETURN:
              bhead = null;
              btail = null;
              if (attempts === null) {
                status = COMPLETED;
                step5 = interrupt || fail3 || step5;
              } else {
                tmp = attempts._3;
                attempt = attempts._1;
                attempts = attempts._2;
                switch (attempt.tag) {
                  // We cannot recover from an unmasked interrupt. Otherwise we should
                  // continue stepping, or run the exception handler if an exception
                  // was raised.
                  case CATCH:
                    if (interrupt && interrupt !== tmp && bracketCount === 0) {
                      status = RETURN;
                    } else if (fail3) {
                      status = CONTINUE;
                      step5 = attempt._2(util2.fromLeft(fail3));
                      fail3 = null;
                    }
                    break;
                  // We cannot resume from an unmasked interrupt or exception.
                  case RESUME:
                    if (interrupt && interrupt !== tmp && bracketCount === 0 || fail3) {
                      status = RETURN;
                    } else {
                      bhead = attempt._1;
                      btail = attempt._2;
                      status = STEP_BIND;
                      step5 = util2.fromRight(step5);
                    }
                    break;
                  // If we have a bracket, we should enqueue the handlers,
                  // and continue with the success branch only if the fiber has
                  // not been interrupted. If the bracket acquisition failed, we
                  // should not run either.
                  case BRACKET:
                    bracketCount--;
                    if (fail3 === null) {
                      result = util2.fromRight(step5);
                      attempts = new Aff2(CONS, new Aff2(RELEASE, attempt._2, result), attempts, tmp);
                      if (interrupt === tmp || bracketCount > 0) {
                        status = CONTINUE;
                        step5 = attempt._3(result);
                      }
                    }
                    break;
                  // Enqueue the appropriate handler. We increase the bracket count
                  // because it should not be cancelled.
                  case RELEASE:
                    attempts = new Aff2(CONS, new Aff2(FINALIZED, step5, fail3), attempts, interrupt);
                    status = CONTINUE;
                    if (interrupt && interrupt !== tmp && bracketCount === 0) {
                      step5 = attempt._1.killed(util2.fromLeft(interrupt))(attempt._2);
                    } else if (fail3) {
                      step5 = attempt._1.failed(util2.fromLeft(fail3))(attempt._2);
                    } else {
                      step5 = attempt._1.completed(util2.fromRight(step5))(attempt._2);
                    }
                    fail3 = null;
                    bracketCount++;
                    break;
                  case FINALIZER:
                    bracketCount++;
                    attempts = new Aff2(CONS, new Aff2(FINALIZED, step5, fail3), attempts, interrupt);
                    status = CONTINUE;
                    step5 = attempt._1;
                    break;
                  case FINALIZED:
                    bracketCount--;
                    status = RETURN;
                    step5 = attempt._1;
                    fail3 = attempt._2;
                    break;
                }
              }
              break;
            case COMPLETED:
              for (var k in joins) {
                if (joins.hasOwnProperty(k)) {
                  rethrow = rethrow && joins[k].rethrow;
                  runEff(joins[k].handler(step5));
                }
              }
              joins = null;
              if (interrupt && fail3) {
                setTimeout(function() {
                  throw util2.fromLeft(fail3);
                }, 0);
              } else if (util2.isLeft(step5) && rethrow) {
                setTimeout(function() {
                  if (rethrow) {
                    throw util2.fromLeft(step5);
                  }
                }, 0);
              }
              return;
            case SUSPENDED:
              status = CONTINUE;
              break;
            case PENDING:
              return;
          }
        }
      }
      function onComplete(join8) {
        return function() {
          if (status === COMPLETED) {
            rethrow = rethrow && join8.rethrow;
            join8.handler(step5)();
            return function() {
            };
          }
          var jid = joinId++;
          joins = joins || {};
          joins[jid] = join8;
          return function() {
            if (joins !== null) {
              delete joins[jid];
            }
          };
        };
      }
      function kill2(error4, cb) {
        return function() {
          if (status === COMPLETED) {
            cb(util2.right(void 0))();
            return function() {
            };
          }
          var canceler = onComplete({
            rethrow: false,
            handler: function() {
              return cb(util2.right(void 0));
            }
          })();
          switch (status) {
            case SUSPENDED:
              interrupt = util2.left(error4);
              status = COMPLETED;
              step5 = interrupt;
              run3(runTick);
              break;
            case PENDING:
              if (interrupt === null) {
                interrupt = util2.left(error4);
              }
              if (bracketCount === 0) {
                if (status === PENDING) {
                  attempts = new Aff2(CONS, new Aff2(FINALIZER, step5(error4)), attempts, interrupt);
                }
                status = RETURN;
                step5 = null;
                fail3 = null;
                run3(++runTick);
              }
              break;
            default:
              if (interrupt === null) {
                interrupt = util2.left(error4);
              }
              if (bracketCount === 0) {
                status = RETURN;
                step5 = null;
                fail3 = null;
              }
          }
          return canceler;
        };
      }
      function join7(cb) {
        return function() {
          var canceler = onComplete({
            rethrow: false,
            handler: cb
          })();
          if (status === SUSPENDED) {
            run3(runTick);
          }
          return canceler;
        };
      }
      return {
        kill: kill2,
        join: join7,
        onComplete,
        isSuspended: function() {
          return status === SUSPENDED;
        },
        run: function() {
          if (status === SUSPENDED) {
            if (!Scheduler.isDraining()) {
              Scheduler.enqueue(function() {
                run3(runTick);
              });
            } else {
              run3(runTick);
            }
          }
        }
      };
    }
    function runPar(util2, supervisor, par, cb) {
      var fiberId = 0;
      var fibers = {};
      var killId = 0;
      var kills = {};
      var early = new Error("[ParAff] Early exit");
      var interrupt = null;
      var root3 = EMPTY;
      function kill2(error4, par2, cb2) {
        var step5 = par2;
        var head6 = null;
        var tail3 = null;
        var count = 0;
        var kills2 = {};
        var tmp, kid;
        loop: while (true) {
          tmp = null;
          switch (step5.tag) {
            case FORKED:
              if (step5._3 === EMPTY) {
                tmp = fibers[step5._1];
                kills2[count++] = tmp.kill(error4, function(result) {
                  return function() {
                    count--;
                    if (count === 0) {
                      cb2(result)();
                    }
                  };
                });
              }
              if (head6 === null) {
                break loop;
              }
              step5 = head6._2;
              if (tail3 === null) {
                head6 = null;
              } else {
                head6 = tail3._1;
                tail3 = tail3._2;
              }
              break;
            case MAP:
              step5 = step5._2;
              break;
            case APPLY:
            case ALT:
              if (head6) {
                tail3 = new Aff2(CONS, head6, tail3);
              }
              head6 = step5;
              step5 = step5._1;
              break;
          }
        }
        if (count === 0) {
          cb2(util2.right(void 0))();
        } else {
          kid = 0;
          tmp = count;
          for (; kid < tmp; kid++) {
            kills2[kid] = kills2[kid]();
          }
        }
        return kills2;
      }
      function join7(result, head6, tail3) {
        var fail3, step5, lhs, rhs, tmp, kid;
        if (util2.isLeft(result)) {
          fail3 = result;
          step5 = null;
        } else {
          step5 = result;
          fail3 = null;
        }
        loop: while (true) {
          lhs = null;
          rhs = null;
          tmp = null;
          kid = null;
          if (interrupt !== null) {
            return;
          }
          if (head6 === null) {
            cb(fail3 || step5)();
            return;
          }
          if (head6._3 !== EMPTY) {
            return;
          }
          switch (head6.tag) {
            case MAP:
              if (fail3 === null) {
                head6._3 = util2.right(head6._1(util2.fromRight(step5)));
                step5 = head6._3;
              } else {
                head6._3 = fail3;
              }
              break;
            case APPLY:
              lhs = head6._1._3;
              rhs = head6._2._3;
              if (fail3) {
                head6._3 = fail3;
                tmp = true;
                kid = killId++;
                kills[kid] = kill2(early, fail3 === lhs ? head6._2 : head6._1, function() {
                  return function() {
                    delete kills[kid];
                    if (tmp) {
                      tmp = false;
                    } else if (tail3 === null) {
                      join7(fail3, null, null);
                    } else {
                      join7(fail3, tail3._1, tail3._2);
                    }
                  };
                });
                if (tmp) {
                  tmp = false;
                  return;
                }
              } else if (lhs === EMPTY || rhs === EMPTY) {
                return;
              } else {
                step5 = util2.right(util2.fromRight(lhs)(util2.fromRight(rhs)));
                head6._3 = step5;
              }
              break;
            case ALT:
              lhs = head6._1._3;
              rhs = head6._2._3;
              if (lhs === EMPTY && util2.isLeft(rhs) || rhs === EMPTY && util2.isLeft(lhs)) {
                return;
              }
              if (lhs !== EMPTY && util2.isLeft(lhs) && rhs !== EMPTY && util2.isLeft(rhs)) {
                fail3 = step5 === lhs ? rhs : lhs;
                step5 = null;
                head6._3 = fail3;
              } else {
                head6._3 = step5;
                tmp = true;
                kid = killId++;
                kills[kid] = kill2(early, step5 === lhs ? head6._2 : head6._1, function() {
                  return function() {
                    delete kills[kid];
                    if (tmp) {
                      tmp = false;
                    } else if (tail3 === null) {
                      join7(step5, null, null);
                    } else {
                      join7(step5, tail3._1, tail3._2);
                    }
                  };
                });
                if (tmp) {
                  tmp = false;
                  return;
                }
              }
              break;
          }
          if (tail3 === null) {
            head6 = null;
          } else {
            head6 = tail3._1;
            tail3 = tail3._2;
          }
        }
      }
      function resolve(fiber) {
        return function(result) {
          return function() {
            delete fibers[fiber._1];
            fiber._3 = result;
            join7(result, fiber._2._1, fiber._2._2);
          };
        };
      }
      function run3() {
        var status = CONTINUE;
        var step5 = par;
        var head6 = null;
        var tail3 = null;
        var tmp, fid;
        loop: while (true) {
          tmp = null;
          fid = null;
          switch (status) {
            case CONTINUE:
              switch (step5.tag) {
                case MAP:
                  if (head6) {
                    tail3 = new Aff2(CONS, head6, tail3);
                  }
                  head6 = new Aff2(MAP, step5._1, EMPTY, EMPTY);
                  step5 = step5._2;
                  break;
                case APPLY:
                  if (head6) {
                    tail3 = new Aff2(CONS, head6, tail3);
                  }
                  head6 = new Aff2(APPLY, EMPTY, step5._2, EMPTY);
                  step5 = step5._1;
                  break;
                case ALT:
                  if (head6) {
                    tail3 = new Aff2(CONS, head6, tail3);
                  }
                  head6 = new Aff2(ALT, EMPTY, step5._2, EMPTY);
                  step5 = step5._1;
                  break;
                default:
                  fid = fiberId++;
                  status = RETURN;
                  tmp = step5;
                  step5 = new Aff2(FORKED, fid, new Aff2(CONS, head6, tail3), EMPTY);
                  tmp = Fiber(util2, supervisor, tmp);
                  tmp.onComplete({
                    rethrow: false,
                    handler: resolve(step5)
                  })();
                  fibers[fid] = tmp;
                  if (supervisor) {
                    supervisor.register(tmp);
                  }
              }
              break;
            case RETURN:
              if (head6 === null) {
                break loop;
              }
              if (head6._1 === EMPTY) {
                head6._1 = step5;
                status = CONTINUE;
                step5 = head6._2;
                head6._2 = EMPTY;
              } else {
                head6._2 = step5;
                step5 = head6;
                if (tail3 === null) {
                  head6 = null;
                } else {
                  head6 = tail3._1;
                  tail3 = tail3._2;
                }
              }
          }
        }
        root3 = step5;
        for (fid = 0; fid < fiberId; fid++) {
          fibers[fid].run();
        }
      }
      function cancel(error4, cb2) {
        interrupt = util2.left(error4);
        var innerKills;
        for (var kid in kills) {
          if (kills.hasOwnProperty(kid)) {
            innerKills = kills[kid];
            for (kid in innerKills) {
              if (innerKills.hasOwnProperty(kid)) {
                innerKills[kid]();
              }
            }
          }
        }
        kills = null;
        var newKills = kill2(error4, root3, cb2);
        return function(killError) {
          return new Aff2(ASYNC, function(killCb) {
            return function() {
              for (var kid2 in newKills) {
                if (newKills.hasOwnProperty(kid2)) {
                  newKills[kid2]();
                }
              }
              return nonCanceler2;
            };
          });
        };
      }
      run3();
      return function(killError) {
        return new Aff2(ASYNC, function(killCb) {
          return function() {
            return cancel(killError, killCb);
          };
        });
      };
    }
    function sequential4(util2, supervisor, par) {
      return new Aff2(ASYNC, function(cb) {
        return function() {
          return runPar(util2, supervisor, par, cb);
        };
      });
    }
    Aff2.EMPTY = EMPTY;
    Aff2.Pure = AffCtr(PURE);
    Aff2.Throw = AffCtr(THROW);
    Aff2.Catch = AffCtr(CATCH);
    Aff2.Sync = AffCtr(SYNC);
    Aff2.Async = AffCtr(ASYNC);
    Aff2.Bind = AffCtr(BIND);
    Aff2.Bracket = AffCtr(BRACKET);
    Aff2.Fork = AffCtr(FORK);
    Aff2.Seq = AffCtr(SEQ);
    Aff2.ParMap = AffCtr(MAP);
    Aff2.ParApply = AffCtr(APPLY);
    Aff2.ParAlt = AffCtr(ALT);
    Aff2.Fiber = Fiber;
    Aff2.Supervisor = Supervisor;
    Aff2.Scheduler = Scheduler;
    Aff2.nonCanceler = nonCanceler2;
    return Aff2;
  })();
  var _pure = Aff.Pure;
  var _throwError = Aff.Throw;
  function _catchError(aff) {
    return function(k) {
      return Aff.Catch(aff, k);
    };
  }
  function _map(f) {
    return function(aff) {
      if (aff.tag === Aff.Pure.tag) {
        return Aff.Pure(f(aff._1));
      } else {
        return Aff.Bind(aff, function(value20) {
          return Aff.Pure(f(value20));
        });
      }
    };
  }
  function _bind(aff) {
    return function(k) {
      return Aff.Bind(aff, k);
    };
  }
  function _fork(immediate) {
    return function(aff) {
      return Aff.Fork(immediate, aff);
    };
  }
  var _liftEffect = Aff.Sync;
  function _parAffMap(f) {
    return function(aff) {
      return Aff.ParMap(f, aff);
    };
  }
  function _parAffApply(aff1) {
    return function(aff2) {
      return Aff.ParApply(aff1, aff2);
    };
  }
  var makeAff = Aff.Async;
  function generalBracket(acquire) {
    return function(options2) {
      return function(k) {
        return Aff.Bracket(acquire, options2, k);
      };
    };
  }
  function _makeFiber(util2, aff) {
    return function() {
      return Aff.Fiber(util2, null, aff);
    };
  }
  var _delay = /* @__PURE__ */ (function() {
    function setDelay(n, k) {
      if (n === 0 && typeof setImmediate !== "undefined") {
        return setImmediate(k);
      } else {
        return setTimeout(k, n);
      }
    }
    function clearDelay(n, t2) {
      if (n === 0 && typeof clearImmediate !== "undefined") {
        return clearImmediate(t2);
      } else {
        return clearTimeout(t2);
      }
    }
    return function(right2, ms) {
      return Aff.Async(function(cb) {
        return function() {
          var timer2 = setDelay(ms, cb(right2()));
          return function() {
            return Aff.Sync(function() {
              return right2(clearDelay(ms, timer2));
            });
          };
        };
      });
    };
  })();
  var _sequential = Aff.Seq;

  // output/Control.Monad.Except.Trans/index.js
  var map23 = /* @__PURE__ */ map(functorEither);
  var ExceptT = function(x32) {
    return x32;
  };
  var runExceptT = function(v2) {
    return v2;
  };
  var mapExceptT = function(f) {
    return function(v2) {
      return f(v2);
    };
  };
  var functorExceptT = function(dictFunctor) {
    var map131 = map(dictFunctor);
    return {
      map: function(f) {
        return mapExceptT(map131(map23(f)));
      }
    };
  };
  var monadExceptT = function(dictMonad) {
    return {
      Applicative0: function() {
        return applicativeExceptT(dictMonad);
      },
      Bind1: function() {
        return bindExceptT(dictMonad);
      }
    };
  };
  var bindExceptT = function(dictMonad) {
    var bind100 = bind(dictMonad.Bind1());
    var pure107 = pure(dictMonad.Applicative0());
    return {
      bind: function(v2) {
        return function(k) {
          return bind100(v2)(either(function($193) {
            return pure107(Left.create($193));
          })(function(a3) {
            var v1 = k(a3);
            return v1;
          }));
        };
      },
      Apply0: function() {
        return applyExceptT(dictMonad);
      }
    };
  };
  var applyExceptT = function(dictMonad) {
    var functorExceptT1 = functorExceptT(dictMonad.Bind1().Apply0().Functor0());
    return {
      apply: ap(monadExceptT(dictMonad)),
      Functor0: function() {
        return functorExceptT1;
      }
    };
  };
  var applicativeExceptT = function(dictMonad) {
    return {
      pure: (function() {
        var $194 = pure(dictMonad.Applicative0());
        return function($195) {
          return ExceptT($194(Right.create($195)));
        };
      })(),
      Apply0: function() {
        return applyExceptT(dictMonad);
      }
    };
  };
  var monadThrowExceptT = function(dictMonad) {
    var monadExceptT1 = monadExceptT(dictMonad);
    return {
      throwError: (function() {
        var $204 = pure(dictMonad.Applicative0());
        return function($205) {
          return ExceptT($204(Left.create($205)));
        };
      })(),
      Monad0: function() {
        return monadExceptT1;
      }
    };
  };
  var altExceptT = function(dictSemigroup) {
    var append42 = append(dictSemigroup);
    return function(dictMonad) {
      var Bind1 = dictMonad.Bind1();
      var bind100 = bind(Bind1);
      var pure107 = pure(dictMonad.Applicative0());
      var functorExceptT1 = functorExceptT(Bind1.Apply0().Functor0());
      return {
        alt: function(v2) {
          return function(v1) {
            return bind100(v2)(function(rm) {
              if (rm instanceof Right) {
                return pure107(new Right(rm.value0));
              }
              ;
              if (rm instanceof Left) {
                return bind100(v1)(function(rn) {
                  if (rn instanceof Right) {
                    return pure107(new Right(rn.value0));
                  }
                  ;
                  if (rn instanceof Left) {
                    return pure107(new Left(append42(rm.value0)(rn.value0)));
                  }
                  ;
                  throw new Error("Failed pattern match at Control.Monad.Except.Trans (line 87, column 9 - line 89, column 49): " + [rn.constructor.name]);
                });
              }
              ;
              throw new Error("Failed pattern match at Control.Monad.Except.Trans (line 83, column 5 - line 89, column 49): " + [rm.constructor.name]);
            });
          };
        },
        Functor0: function() {
          return functorExceptT1;
        }
      };
    };
  };

  // output/Control.Monad.Writer.Trans/index.js
  var WriterT = function(x32) {
    return x32;
  };
  var runWriterT = function(v2) {
    return v2;
  };
  var mapWriterT = function(f) {
    return function(v2) {
      return f(v2);
    };
  };
  var functorWriterT = function(dictFunctor) {
    var map131 = map(dictFunctor);
    return {
      map: function(f) {
        return mapWriterT(map131(function(v2) {
          return new Tuple(f(v2.value0), v2.value1);
        }));
      }
    };
  };
  var applyWriterT = function(dictSemigroup) {
    var append42 = append(dictSemigroup);
    return function(dictApply) {
      var apply7 = apply(dictApply);
      var Functor0 = dictApply.Functor0();
      var map131 = map(Functor0);
      var functorWriterT1 = functorWriterT(Functor0);
      return {
        apply: function(v2) {
          return function(v1) {
            var k = function(v3) {
              return function(v4) {
                return new Tuple(v3.value0(v4.value0), append42(v3.value1)(v4.value1));
              };
            };
            return apply7(map131(k)(v2))(v1);
          };
        },
        Functor0: function() {
          return functorWriterT1;
        }
      };
    };
  };
  var bindWriterT = function(dictSemigroup) {
    var append42 = append(dictSemigroup);
    var applyWriterT1 = applyWriterT(dictSemigroup);
    return function(dictBind) {
      var bind100 = bind(dictBind);
      var Apply0 = dictBind.Apply0();
      var map131 = map(Apply0.Functor0());
      var applyWriterT2 = applyWriterT1(Apply0);
      return {
        bind: function(v2) {
          return function(k) {
            return bind100(v2)(function(v1) {
              var v22 = k(v1.value0);
              return map131(function(v3) {
                return new Tuple(v3.value0, append42(v1.value1)(v3.value1));
              })(v22);
            });
          };
        },
        Apply0: function() {
          return applyWriterT2;
        }
      };
    };
  };
  var applicativeWriterT = function(dictMonoid) {
    var mempty3 = mempty(dictMonoid);
    var applyWriterT1 = applyWriterT(dictMonoid.Semigroup0());
    return function(dictApplicative) {
      var pure107 = pure(dictApplicative);
      var applyWriterT2 = applyWriterT1(dictApplicative.Apply0());
      return {
        pure: function(a3) {
          return pure107(new Tuple(a3, mempty3));
        },
        Apply0: function() {
          return applyWriterT2;
        }
      };
    };
  };
  var monadWriterT = function(dictMonoid) {
    var applicativeWriterT1 = applicativeWriterT(dictMonoid);
    var bindWriterT1 = bindWriterT(dictMonoid.Semigroup0());
    return function(dictMonad) {
      var applicativeWriterT22 = applicativeWriterT1(dictMonad.Applicative0());
      var bindWriterT2 = bindWriterT1(dictMonad.Bind1());
      return {
        Applicative0: function() {
          return applicativeWriterT22;
        },
        Bind1: function() {
          return bindWriterT2;
        }
      };
    };
  };
  var monadTellWriterT = function(dictMonoid) {
    var Semigroup0 = dictMonoid.Semigroup0();
    var monadWriterT1 = monadWriterT(dictMonoid);
    return function(dictMonad) {
      var monadWriterT2 = monadWriterT1(dictMonad);
      return {
        tell: (function() {
          var $262 = pure(dictMonad.Applicative0());
          var $263 = Tuple.create(unit);
          return function($264) {
            return WriterT($262($263($264)));
          };
        })(),
        Semigroup0: function() {
          return Semigroup0;
        },
        Monad1: function() {
          return monadWriterT2;
        }
      };
    };
  };

  // output/Control.Parallel.Class/index.js
  var sequential = function(dict) {
    return dict.sequential;
  };
  var parallel = function(dict) {
    return dict.parallel;
  };

  // output/Control.Parallel/index.js
  var identity9 = /* @__PURE__ */ identity(categoryFn);
  var parTraverse_ = function(dictParallel) {
    var sequential4 = sequential(dictParallel);
    var parallel4 = parallel(dictParallel);
    return function(dictApplicative) {
      var traverse_10 = traverse_(dictApplicative);
      return function(dictFoldable) {
        var traverse_14 = traverse_10(dictFoldable);
        return function(f) {
          var $51 = traverse_14(function($53) {
            return parallel4(f($53));
          });
          return function($52) {
            return sequential4($51($52));
          };
        };
      };
    };
  };
  var parSequence_ = function(dictParallel) {
    var parTraverse_1 = parTraverse_(dictParallel);
    return function(dictApplicative) {
      var parTraverse_2 = parTraverse_1(dictApplicative);
      return function(dictFoldable) {
        return parTraverse_2(dictFoldable)(identity9);
      };
    };
  };

  // output/Effect.Unsafe/foreign.js
  var unsafePerformEffect = function(f) {
    return f();
  };

  // output/Effect.Aff/index.js
  var $runtime_lazy5 = function(name16, moduleName, init4) {
    var state3 = 0;
    var val;
    return function(lineNumber) {
      if (state3 === 2) return val;
      if (state3 === 1) throw new ReferenceError(name16 + " was needed before it finished initializing (module " + moduleName + ", line " + lineNumber + ")", moduleName, lineNumber);
      state3 = 1;
      val = init4();
      state3 = 2;
      return val;
    };
  };
  var pure5 = /* @__PURE__ */ pure(applicativeEffect);
  var $$void6 = /* @__PURE__ */ $$void(functorEffect);
  var map24 = /* @__PURE__ */ map(functorEffect);
  var Canceler = function(x32) {
    return x32;
  };
  var suspendAff = /* @__PURE__ */ _fork(false);
  var functorParAff = {
    map: _parAffMap
  };
  var functorAff = {
    map: _map
  };
  var map110 = /* @__PURE__ */ map(functorAff);
  var forkAff = /* @__PURE__ */ _fork(true);
  var ffiUtil = /* @__PURE__ */ (function() {
    var unsafeFromRight = function(v2) {
      if (v2 instanceof Right) {
        return v2.value0;
      }
      ;
      if (v2 instanceof Left) {
        return unsafeCrashWith("unsafeFromRight: Left");
      }
      ;
      throw new Error("Failed pattern match at Effect.Aff (line 412, column 21 - line 414, column 54): " + [v2.constructor.name]);
    };
    var unsafeFromLeft = function(v2) {
      if (v2 instanceof Left) {
        return v2.value0;
      }
      ;
      if (v2 instanceof Right) {
        return unsafeCrashWith("unsafeFromLeft: Right");
      }
      ;
      throw new Error("Failed pattern match at Effect.Aff (line 407, column 20 - line 409, column 55): " + [v2.constructor.name]);
    };
    var isLeft = function(v2) {
      if (v2 instanceof Left) {
        return true;
      }
      ;
      if (v2 instanceof Right) {
        return false;
      }
      ;
      throw new Error("Failed pattern match at Effect.Aff (line 402, column 12 - line 404, column 21): " + [v2.constructor.name]);
    };
    return {
      isLeft,
      fromLeft: unsafeFromLeft,
      fromRight: unsafeFromRight,
      left: Left.create,
      right: Right.create
    };
  })();
  var makeFiber = function(aff) {
    return _makeFiber(ffiUtil, aff);
  };
  var launchAff = function(aff) {
    return function __do7() {
      var fiber = makeFiber(aff)();
      fiber.run();
      return fiber;
    };
  };
  var launchAff_ = function($75) {
    return $$void6(launchAff($75));
  };
  var delay = function(v2) {
    return _delay(Right.create, v2);
  };
  var bracket = function(acquire) {
    return function(completed) {
      return generalBracket(acquire)({
        killed: $$const(completed),
        failed: $$const(completed),
        completed: $$const(completed)
      });
    };
  };
  var applyParAff = {
    apply: _parAffApply,
    Functor0: function() {
      return functorParAff;
    }
  };
  var monadAff = {
    Applicative0: function() {
      return applicativeAff;
    },
    Bind1: function() {
      return bindAff;
    }
  };
  var bindAff = {
    bind: _bind,
    Apply0: function() {
      return $lazy_applyAff(0);
    }
  };
  var applicativeAff = {
    pure: _pure,
    Apply0: function() {
      return $lazy_applyAff(0);
    }
  };
  var $lazy_applyAff = /* @__PURE__ */ $runtime_lazy5("applyAff", "Effect.Aff", function() {
    return {
      apply: ap(monadAff),
      Functor0: function() {
        return functorAff;
      }
    };
  });
  var applyAff = /* @__PURE__ */ $lazy_applyAff(73);
  var pure22 = /* @__PURE__ */ pure(applicativeAff);
  var bind12 = /* @__PURE__ */ bind(bindAff);
  var bindFlipped3 = /* @__PURE__ */ bindFlipped(bindAff);
  var $$finally = function(fin) {
    return function(a3) {
      return bracket(pure22(unit))($$const(fin))($$const(a3));
    };
  };
  var parallelAff = {
    parallel: unsafeCoerce2,
    sequential: _sequential,
    Apply0: function() {
      return applyAff;
    },
    Apply1: function() {
      return applyParAff;
    }
  };
  var parallel2 = /* @__PURE__ */ parallel(parallelAff);
  var applicativeParAff = {
    pure: function($76) {
      return parallel2(pure22($76));
    },
    Apply0: function() {
      return applyParAff;
    }
  };
  var monadEffectAff = {
    liftEffect: _liftEffect,
    Monad0: function() {
      return monadAff;
    }
  };
  var liftEffect3 = /* @__PURE__ */ liftEffect(monadEffectAff);
  var effectCanceler = function($77) {
    return Canceler($$const(liftEffect3($77)));
  };
  var joinFiber = function(v2) {
    return makeAff(function(k) {
      return map24(effectCanceler)(v2.join(k));
    });
  };
  var functorFiber = {
    map: function(f) {
      return function(t2) {
        return unsafePerformEffect(makeFiber(map110(f)(joinFiber(t2))));
      };
    }
  };
  var killFiber = function(e) {
    return function(v2) {
      return bind12(liftEffect3(v2.isSuspended))(function(suspended) {
        if (suspended) {
          return liftEffect3($$void6(v2.kill(e, $$const(pure5(unit)))));
        }
        ;
        return makeAff(function(k) {
          return map24(effectCanceler)(v2.kill(e, k));
        });
      });
    };
  };
  var monadThrowAff = {
    throwError: _throwError,
    Monad0: function() {
      return monadAff;
    }
  };
  var monadErrorAff = {
    catchError: _catchError,
    MonadThrow0: function() {
      return monadThrowAff;
    }
  };
  var $$try2 = /* @__PURE__ */ $$try(monadErrorAff);
  var runAff = function(k) {
    return function(aff) {
      return launchAff(bindFlipped3(function($83) {
        return liftEffect3(k($83));
      })($$try2(aff)));
    };
  };
  var runAff_ = function(k) {
    return function(aff) {
      return $$void6(runAff(k)(aff));
    };
  };
  var monadRecAff = {
    tailRecM: function(k) {
      var go2 = function(a3) {
        return bind12(k(a3))(function(res) {
          if (res instanceof Done) {
            return pure22(res.value0);
          }
          ;
          if (res instanceof Loop) {
            return go2(res.value0);
          }
          ;
          throw new Error("Failed pattern match at Effect.Aff (line 104, column 7 - line 106, column 23): " + [res.constructor.name]);
        });
      };
      return go2;
    },
    Monad0: function() {
      return monadAff;
    }
  };
  var nonCanceler = /* @__PURE__ */ $$const(/* @__PURE__ */ pure22(unit));

  // output/Effect.Aff.Class/index.js
  var monadAffAff = {
    liftAff: /* @__PURE__ */ identity(categoryFn),
    MonadEffect0: function() {
      return monadEffectAff;
    }
  };
  var liftAff = function(dict) {
    return dict.liftAff;
  };

  // output/Data.Exists/index.js
  var runExists = unsafeCoerce2;
  var mkExists = unsafeCoerce2;

  // output/Data.Coyoneda/index.js
  var CoyonedaF = /* @__PURE__ */ (function() {
    function CoyonedaF2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    CoyonedaF2.create = function(value0) {
      return function(value1) {
        return new CoyonedaF2(value0, value1);
      };
    };
    return CoyonedaF2;
  })();
  var unCoyoneda = function(f) {
    return function(v2) {
      return runExists(function(v1) {
        return f(v1.value0)(v1.value1);
      })(v2);
    };
  };
  var coyoneda = function(k) {
    return function(fi) {
      return mkExists(new CoyonedaF(k, fi));
    };
  };
  var functorCoyoneda = {
    map: function(f) {
      return function(v2) {
        return runExists(function(v1) {
          return coyoneda(function($180) {
            return f(v1.value0($180));
          })(v1.value1);
        })(v2);
      };
    }
  };
  var liftCoyoneda = /* @__PURE__ */ coyoneda(/* @__PURE__ */ identity(categoryFn));

  // output/Halogen.Data.OrdBox/index.js
  var OrdBox = /* @__PURE__ */ (function() {
    function OrdBox2(value0, value1, value22) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
    }
    ;
    OrdBox2.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return new OrdBox2(value0, value1, value22);
        };
      };
    };
    return OrdBox2;
  })();
  var mkOrdBox = function(dictOrd) {
    return OrdBox.create(eq(dictOrd.Eq0()))(compare(dictOrd));
  };
  var eqOrdBox = {
    eq: function(v2) {
      return function(v1) {
        return v2.value0(v2.value2)(v1.value2);
      };
    }
  };
  var ordOrdBox = {
    compare: function(v2) {
      return function(v1) {
        return v2.value1(v2.value2)(v1.value2);
      };
    },
    Eq0: function() {
      return eqOrdBox;
    }
  };

  // output/Halogen.Data.Slot/index.js
  var ordTuple2 = /* @__PURE__ */ ordTuple(ordString)(ordOrdBox);
  var pop1 = /* @__PURE__ */ pop(ordTuple2);
  var lookup1 = /* @__PURE__ */ lookup(ordTuple2);
  var insert1 = /* @__PURE__ */ insert(ordTuple2);
  var pop2 = function() {
    return function(dictIsSymbol) {
      var reflectSymbol2 = reflectSymbol(dictIsSymbol);
      return function(dictOrd) {
        var mkOrdBox2 = mkOrdBox(dictOrd);
        return function(sym) {
          return function(key2) {
            return function(v2) {
              return pop1(new Tuple(reflectSymbol2(sym), mkOrdBox2(key2)))(v2);
            };
          };
        };
      };
    };
  };
  var lookup3 = function() {
    return function(dictIsSymbol) {
      var reflectSymbol2 = reflectSymbol(dictIsSymbol);
      return function(dictOrd) {
        var mkOrdBox2 = mkOrdBox(dictOrd);
        return function(sym) {
          return function(key2) {
            return function(v2) {
              return lookup1(new Tuple(reflectSymbol2(sym), mkOrdBox2(key2)))(v2);
            };
          };
        };
      };
    };
  };
  var insert3 = function() {
    return function(dictIsSymbol) {
      var reflectSymbol2 = reflectSymbol(dictIsSymbol);
      return function(dictOrd) {
        var mkOrdBox2 = mkOrdBox(dictOrd);
        return function(sym) {
          return function(key2) {
            return function(val) {
              return function(v2) {
                return insert1(new Tuple(reflectSymbol2(sym), mkOrdBox2(key2)))(val)(v2);
              };
            };
          };
        };
      };
    };
  };
  var foreachSlot = function(dictApplicative) {
    var traverse_10 = traverse_(dictApplicative)(foldableMap);
    return function(v2) {
      return function(k) {
        return traverse_10(function($54) {
          return k($54);
        })(v2);
      };
    };
  };
  var empty6 = empty4;

  // output/Data.String.Common/foreign.js
  var replaceAll = function(s1) {
    return function(s22) {
      return function(s3) {
        return s3.replace(new RegExp(s1.replace(/[-\/\\^$*+?.()|[\]{}]/g, "\\$&"), "g"), s22);
      };
    };
  };
  var split = function(sep) {
    return function(s3) {
      return s3.split(sep);
    };
  };
  var trim = function(s3) {
    return s3.trim();
  };
  var joinWith = function(s3) {
    return function(xs) {
      return xs.join(s3);
    };
  };

  // output/Data.String.Common/index.js
  var $$null4 = function(s3) {
    return s3 === "";
  };

  // output/DOM.HTML.Indexed.InputType/index.js
  var InputButton = /* @__PURE__ */ (function() {
    function InputButton2() {
    }
    ;
    InputButton2.value = new InputButton2();
    return InputButton2;
  })();
  var InputCheckbox = /* @__PURE__ */ (function() {
    function InputCheckbox2() {
    }
    ;
    InputCheckbox2.value = new InputCheckbox2();
    return InputCheckbox2;
  })();
  var InputColor = /* @__PURE__ */ (function() {
    function InputColor2() {
    }
    ;
    InputColor2.value = new InputColor2();
    return InputColor2;
  })();
  var InputDate = /* @__PURE__ */ (function() {
    function InputDate2() {
    }
    ;
    InputDate2.value = new InputDate2();
    return InputDate2;
  })();
  var InputDatetimeLocal = /* @__PURE__ */ (function() {
    function InputDatetimeLocal2() {
    }
    ;
    InputDatetimeLocal2.value = new InputDatetimeLocal2();
    return InputDatetimeLocal2;
  })();
  var InputEmail = /* @__PURE__ */ (function() {
    function InputEmail2() {
    }
    ;
    InputEmail2.value = new InputEmail2();
    return InputEmail2;
  })();
  var InputFile = /* @__PURE__ */ (function() {
    function InputFile2() {
    }
    ;
    InputFile2.value = new InputFile2();
    return InputFile2;
  })();
  var InputHidden = /* @__PURE__ */ (function() {
    function InputHidden2() {
    }
    ;
    InputHidden2.value = new InputHidden2();
    return InputHidden2;
  })();
  var InputImage = /* @__PURE__ */ (function() {
    function InputImage2() {
    }
    ;
    InputImage2.value = new InputImage2();
    return InputImage2;
  })();
  var InputMonth = /* @__PURE__ */ (function() {
    function InputMonth2() {
    }
    ;
    InputMonth2.value = new InputMonth2();
    return InputMonth2;
  })();
  var InputNumber = /* @__PURE__ */ (function() {
    function InputNumber2() {
    }
    ;
    InputNumber2.value = new InputNumber2();
    return InputNumber2;
  })();
  var InputPassword = /* @__PURE__ */ (function() {
    function InputPassword2() {
    }
    ;
    InputPassword2.value = new InputPassword2();
    return InputPassword2;
  })();
  var InputRadio = /* @__PURE__ */ (function() {
    function InputRadio2() {
    }
    ;
    InputRadio2.value = new InputRadio2();
    return InputRadio2;
  })();
  var InputRange = /* @__PURE__ */ (function() {
    function InputRange2() {
    }
    ;
    InputRange2.value = new InputRange2();
    return InputRange2;
  })();
  var InputReset = /* @__PURE__ */ (function() {
    function InputReset2() {
    }
    ;
    InputReset2.value = new InputReset2();
    return InputReset2;
  })();
  var InputSearch = /* @__PURE__ */ (function() {
    function InputSearch2() {
    }
    ;
    InputSearch2.value = new InputSearch2();
    return InputSearch2;
  })();
  var InputSubmit = /* @__PURE__ */ (function() {
    function InputSubmit2() {
    }
    ;
    InputSubmit2.value = new InputSubmit2();
    return InputSubmit2;
  })();
  var InputTel = /* @__PURE__ */ (function() {
    function InputTel2() {
    }
    ;
    InputTel2.value = new InputTel2();
    return InputTel2;
  })();
  var InputText = /* @__PURE__ */ (function() {
    function InputText2() {
    }
    ;
    InputText2.value = new InputText2();
    return InputText2;
  })();
  var InputTime = /* @__PURE__ */ (function() {
    function InputTime2() {
    }
    ;
    InputTime2.value = new InputTime2();
    return InputTime2;
  })();
  var InputUrl = /* @__PURE__ */ (function() {
    function InputUrl2() {
    }
    ;
    InputUrl2.value = new InputUrl2();
    return InputUrl2;
  })();
  var InputWeek = /* @__PURE__ */ (function() {
    function InputWeek2() {
    }
    ;
    InputWeek2.value = new InputWeek2();
    return InputWeek2;
  })();
  var renderInputType = function(v2) {
    if (v2 instanceof InputButton) {
      return "button";
    }
    ;
    if (v2 instanceof InputCheckbox) {
      return "checkbox";
    }
    ;
    if (v2 instanceof InputColor) {
      return "color";
    }
    ;
    if (v2 instanceof InputDate) {
      return "date";
    }
    ;
    if (v2 instanceof InputDatetimeLocal) {
      return "datetime-local";
    }
    ;
    if (v2 instanceof InputEmail) {
      return "email";
    }
    ;
    if (v2 instanceof InputFile) {
      return "file";
    }
    ;
    if (v2 instanceof InputHidden) {
      return "hidden";
    }
    ;
    if (v2 instanceof InputImage) {
      return "image";
    }
    ;
    if (v2 instanceof InputMonth) {
      return "month";
    }
    ;
    if (v2 instanceof InputNumber) {
      return "number";
    }
    ;
    if (v2 instanceof InputPassword) {
      return "password";
    }
    ;
    if (v2 instanceof InputRadio) {
      return "radio";
    }
    ;
    if (v2 instanceof InputRange) {
      return "range";
    }
    ;
    if (v2 instanceof InputReset) {
      return "reset";
    }
    ;
    if (v2 instanceof InputSearch) {
      return "search";
    }
    ;
    if (v2 instanceof InputSubmit) {
      return "submit";
    }
    ;
    if (v2 instanceof InputTel) {
      return "tel";
    }
    ;
    if (v2 instanceof InputText) {
      return "text";
    }
    ;
    if (v2 instanceof InputTime) {
      return "time";
    }
    ;
    if (v2 instanceof InputUrl) {
      return "url";
    }
    ;
    if (v2 instanceof InputWeek) {
      return "week";
    }
    ;
    throw new Error("Failed pattern match at DOM.HTML.Indexed.InputType (line 33, column 19 - line 55, column 22): " + [v2.constructor.name]);
  };

  // output/DOM.HTML.Indexed.StepValue/index.js
  var show5 = /* @__PURE__ */ show(showNumber);
  var Any = /* @__PURE__ */ (function() {
    function Any2() {
    }
    ;
    Any2.value = new Any2();
    return Any2;
  })();
  var Step = /* @__PURE__ */ (function() {
    function Step3(value0) {
      this.value0 = value0;
    }
    ;
    Step3.create = function(value0) {
      return new Step3(value0);
    };
    return Step3;
  })();
  var renderStepValue = function(v2) {
    if (v2 instanceof Any) {
      return "any";
    }
    ;
    if (v2 instanceof Step) {
      return show5(v2.value0);
    }
    ;
    throw new Error("Failed pattern match at DOM.HTML.Indexed.StepValue (line 13, column 19 - line 15, column 19): " + [v2.constructor.name]);
  };

  // output/Halogen.Query.Input/index.js
  var RefUpdate = /* @__PURE__ */ (function() {
    function RefUpdate2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    RefUpdate2.create = function(value0) {
      return function(value1) {
        return new RefUpdate2(value0, value1);
      };
    };
    return RefUpdate2;
  })();
  var Action = /* @__PURE__ */ (function() {
    function Action3(value0) {
      this.value0 = value0;
    }
    ;
    Action3.create = function(value0) {
      return new Action3(value0);
    };
    return Action3;
  })();

  // output/Halogen.VDom.Machine/index.js
  var Step2 = /* @__PURE__ */ (function() {
    function Step3(value0, value1, value22, value32) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
      this.value3 = value32;
    }
    ;
    Step3.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return function(value32) {
            return new Step3(value0, value1, value22, value32);
          };
        };
      };
    };
    return Step3;
  })();
  var unStep = unsafeCoerce2;
  var step2 = function(v2, a3) {
    return v2.value2(v2.value1, a3);
  };
  var mkStep = unsafeCoerce2;
  var halt = function(v2) {
    return v2.value3(v2.value1);
  };
  var extract2 = /* @__PURE__ */ unStep(function(v2) {
    return v2.value0;
  });

  // output/Halogen.VDom.Types/index.js
  var map25 = /* @__PURE__ */ map(functorArray);
  var map111 = /* @__PURE__ */ map(functorTuple);
  var Text2 = /* @__PURE__ */ (function() {
    function Text3(value0) {
      this.value0 = value0;
    }
    ;
    Text3.create = function(value0) {
      return new Text3(value0);
    };
    return Text3;
  })();
  var Elem = /* @__PURE__ */ (function() {
    function Elem2(value0, value1, value22, value32) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
      this.value3 = value32;
    }
    ;
    Elem2.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return function(value32) {
            return new Elem2(value0, value1, value22, value32);
          };
        };
      };
    };
    return Elem2;
  })();
  var Keyed = /* @__PURE__ */ (function() {
    function Keyed2(value0, value1, value22, value32) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
      this.value3 = value32;
    }
    ;
    Keyed2.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return function(value32) {
            return new Keyed2(value0, value1, value22, value32);
          };
        };
      };
    };
    return Keyed2;
  })();
  var Widget = /* @__PURE__ */ (function() {
    function Widget2(value0) {
      this.value0 = value0;
    }
    ;
    Widget2.create = function(value0) {
      return new Widget2(value0);
    };
    return Widget2;
  })();
  var Grafted = /* @__PURE__ */ (function() {
    function Grafted2(value0) {
      this.value0 = value0;
    }
    ;
    Grafted2.create = function(value0) {
      return new Grafted2(value0);
    };
    return Grafted2;
  })();
  var Graft = /* @__PURE__ */ (function() {
    function Graft2(value0, value1, value22) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
    }
    ;
    Graft2.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return new Graft2(value0, value1, value22);
        };
      };
    };
    return Graft2;
  })();
  var unGraft = function(f) {
    return function($61) {
      return f($61);
    };
  };
  var graft = unsafeCoerce2;
  var bifunctorGraft = {
    bimap: function(f) {
      return function(g2) {
        return unGraft(function(v2) {
          return graft(new Graft(function($63) {
            return f(v2.value0($63));
          }, function($64) {
            return g2(v2.value1($64));
          }, v2.value2));
        });
      };
    }
  };
  var bimap2 = /* @__PURE__ */ bimap(bifunctorGraft);
  var runGraft = /* @__PURE__ */ unGraft(function(v2) {
    var go2 = function(v22) {
      if (v22 instanceof Text2) {
        return new Text2(v22.value0);
      }
      ;
      if (v22 instanceof Elem) {
        return new Elem(v22.value0, v22.value1, v2.value0(v22.value2), map25(go2)(v22.value3));
      }
      ;
      if (v22 instanceof Keyed) {
        return new Keyed(v22.value0, v22.value1, v2.value0(v22.value2), map25(map111(go2))(v22.value3));
      }
      ;
      if (v22 instanceof Widget) {
        return new Widget(v2.value1(v22.value0));
      }
      ;
      if (v22 instanceof Grafted) {
        return new Grafted(bimap2(v2.value0)(v2.value1)(v22.value0));
      }
      ;
      throw new Error("Failed pattern match at Halogen.VDom.Types (line 86, column 7 - line 86, column 27): " + [v22.constructor.name]);
    };
    return go2(v2.value2);
  });

  // output/Halogen.VDom.Util/foreign.js
  function unsafeGetAny(key2, obj) {
    return obj[key2];
  }
  function unsafeHasAny(key2, obj) {
    return obj.hasOwnProperty(key2);
  }
  function unsafeSetAny(key2, val, obj) {
    obj[key2] = val;
  }
  function forE2(a3, f) {
    var b10 = [];
    for (var i2 = 0; i2 < a3.length; i2++) {
      b10.push(f(i2, a3[i2]));
    }
    return b10;
  }
  function forEachE(a3, f) {
    for (var i2 = 0; i2 < a3.length; i2++) {
      f(a3[i2]);
    }
  }
  function forInE(o, f) {
    var ks = Object.keys(o);
    for (var i2 = 0; i2 < ks.length; i2++) {
      var k = ks[i2];
      f(k, o[k]);
    }
  }
  function diffWithIxE(a1, a22, f1, f2, f3) {
    var a3 = [];
    var l1 = a1.length;
    var l2 = a22.length;
    var i2 = 0;
    while (1) {
      if (i2 < l1) {
        if (i2 < l2) {
          a3.push(f1(i2, a1[i2], a22[i2]));
        } else {
          f2(i2, a1[i2]);
        }
      } else if (i2 < l2) {
        a3.push(f3(i2, a22[i2]));
      } else {
        break;
      }
      i2++;
    }
    return a3;
  }
  function strMapWithIxE(as, fk, f) {
    var o = {};
    for (var i2 = 0; i2 < as.length; i2++) {
      var a3 = as[i2];
      var k = fk(a3);
      o[k] = f(k, i2, a3);
    }
    return o;
  }
  function diffWithKeyAndIxE(o1, as, fk, f1, f2, f3) {
    var o2 = {};
    for (var i2 = 0; i2 < as.length; i2++) {
      var a3 = as[i2];
      var k = fk(a3);
      if (o1.hasOwnProperty(k)) {
        o2[k] = f1(k, i2, o1[k], a3);
      } else {
        o2[k] = f3(k, i2, a3);
      }
    }
    for (var k in o1) {
      if (k in o2) {
        continue;
      }
      f2(k, o1[k]);
    }
    return o2;
  }
  function refEq2(a3, b10) {
    return a3 === b10;
  }
  function createTextNode2(s3, doc) {
    return doc.createTextNode(s3);
  }
  function setTextContent2(s3, n) {
    n.textContent = s3;
  }
  function createElement2(ns, name16, doc) {
    if (ns != null) {
      return doc.createElementNS(ns, name16);
    } else {
      return doc.createElement(name16);
    }
  }
  function insertChildIx(i2, a3, b10) {
    var n = b10.childNodes.item(i2) || null;
    if (n !== a3) {
      b10.insertBefore(a3, n);
    }
  }
  function removeChild2(a3, b10) {
    if (b10 && a3.parentNode === b10) {
      b10.removeChild(a3);
    }
  }
  function parentNode2(a3) {
    return a3.parentNode;
  }
  function setAttribute2(ns, attr46, val, el) {
    if (ns != null) {
      el.setAttributeNS(ns, attr46, val);
    } else {
      el.setAttribute(attr46, val);
    }
  }
  function removeAttribute2(ns, attr46, el) {
    if (ns != null) {
      el.removeAttributeNS(ns, attr46);
    } else {
      el.removeAttribute(attr46);
    }
  }
  function hasAttribute2(ns, attr46, el) {
    if (ns != null) {
      return el.hasAttributeNS(ns, attr46);
    } else {
      return el.hasAttribute(attr46);
    }
  }
  function addEventListener(ev, listener, el) {
    el.addEventListener(ev, listener, false);
  }
  function removeEventListener(ev, listener, el) {
    el.removeEventListener(ev, listener, false);
  }
  var jsUndefined = void 0;

  // output/Foreign.Object.ST/foreign.js
  var newImpl = function() {
    return {};
  };

  // output/Halogen.VDom.Util/index.js
  var unsafeLookup = unsafeGetAny;
  var unsafeFreeze2 = unsafeCoerce2;
  var pokeMutMap = unsafeSetAny;
  var newMutMap = newImpl;

  // output/Halogen.VDom.DOM/index.js
  var $runtime_lazy6 = function(name16, moduleName, init4) {
    var state3 = 0;
    var val;
    return function(lineNumber) {
      if (state3 === 2) return val;
      if (state3 === 1) throw new ReferenceError(name16 + " was needed before it finished initializing (module " + moduleName + ", line " + lineNumber + ")", moduleName, lineNumber);
      state3 = 1;
      val = init4();
      state3 = 2;
      return val;
    };
  };
  var haltWidget = function(v2) {
    return halt(v2.widget);
  };
  var $lazy_patchWidget = /* @__PURE__ */ $runtime_lazy6("patchWidget", "Halogen.VDom.DOM", function() {
    return function(state3, vdom) {
      if (vdom instanceof Grafted) {
        return $lazy_patchWidget(291)(state3, runGraft(vdom.value0));
      }
      ;
      if (vdom instanceof Widget) {
        var res = step2(state3.widget, vdom.value0);
        var res$prime = unStep(function(v2) {
          return mkStep(new Step2(v2.value0, {
            build: state3.build,
            widget: res
          }, $lazy_patchWidget(296), haltWidget));
        })(res);
        return res$prime;
      }
      ;
      haltWidget(state3);
      return state3.build(vdom);
    };
  });
  var patchWidget = /* @__PURE__ */ $lazy_patchWidget(286);
  var haltText = function(v2) {
    var parent2 = parentNode2(v2.node);
    return removeChild2(v2.node, parent2);
  };
  var $lazy_patchText = /* @__PURE__ */ $runtime_lazy6("patchText", "Halogen.VDom.DOM", function() {
    return function(state3, vdom) {
      if (vdom instanceof Grafted) {
        return $lazy_patchText(82)(state3, runGraft(vdom.value0));
      }
      ;
      if (vdom instanceof Text2) {
        if (state3.value === vdom.value0) {
          return mkStep(new Step2(state3.node, state3, $lazy_patchText(85), haltText));
        }
        ;
        if (otherwise) {
          var nextState = {
            build: state3.build,
            node: state3.node,
            value: vdom.value0
          };
          setTextContent2(vdom.value0, state3.node);
          return mkStep(new Step2(state3.node, nextState, $lazy_patchText(89), haltText));
        }
        ;
      }
      ;
      haltText(state3);
      return state3.build(vdom);
    };
  });
  var patchText = /* @__PURE__ */ $lazy_patchText(77);
  var haltKeyed = function(v2) {
    var parent2 = parentNode2(v2.node);
    removeChild2(v2.node, parent2);
    forInE(v2.children, function(v1, s3) {
      return halt(s3);
    });
    return halt(v2.attrs);
  };
  var haltElem = function(v2) {
    var parent2 = parentNode2(v2.node);
    removeChild2(v2.node, parent2);
    forEachE(v2.children, halt);
    return halt(v2.attrs);
  };
  var eqElemSpec = function(ns1, v2, ns2, v1) {
    var $63 = v2 === v1;
    if ($63) {
      if (ns1 instanceof Just && (ns2 instanceof Just && ns1.value0 === ns2.value0)) {
        return true;
      }
      ;
      if (ns1 instanceof Nothing && ns2 instanceof Nothing) {
        return true;
      }
      ;
      return false;
    }
    ;
    return false;
  };
  var $lazy_patchElem = /* @__PURE__ */ $runtime_lazy6("patchElem", "Halogen.VDom.DOM", function() {
    return function(state3, vdom) {
      if (vdom instanceof Grafted) {
        return $lazy_patchElem(135)(state3, runGraft(vdom.value0));
      }
      ;
      if (vdom instanceof Elem && eqElemSpec(state3.ns, state3.name, vdom.value0, vdom.value1)) {
        var v2 = length3(vdom.value3);
        var v1 = length3(state3.children);
        if (v1 === 0 && v2 === 0) {
          var attrs2 = step2(state3.attrs, vdom.value2);
          var nextState = {
            build: state3.build,
            node: state3.node,
            attrs: attrs2,
            ns: vdom.value0,
            name: vdom.value1,
            children: state3.children
          };
          return mkStep(new Step2(state3.node, nextState, $lazy_patchElem(149), haltElem));
        }
        ;
        var onThis = function(v22, s3) {
          return halt(s3);
        };
        var onThese = function(ix, s3, v22) {
          var res = step2(s3, v22);
          insertChildIx(ix, extract2(res), state3.node);
          return res;
        };
        var onThat = function(ix, v22) {
          var res = state3.build(v22);
          insertChildIx(ix, extract2(res), state3.node);
          return res;
        };
        var children22 = diffWithIxE(state3.children, vdom.value3, onThese, onThis, onThat);
        var attrs2 = step2(state3.attrs, vdom.value2);
        var nextState = {
          build: state3.build,
          node: state3.node,
          attrs: attrs2,
          ns: vdom.value0,
          name: vdom.value1,
          children: children22
        };
        return mkStep(new Step2(state3.node, nextState, $lazy_patchElem(172), haltElem));
      }
      ;
      haltElem(state3);
      return state3.build(vdom);
    };
  });
  var patchElem = /* @__PURE__ */ $lazy_patchElem(130);
  var $lazy_patchKeyed = /* @__PURE__ */ $runtime_lazy6("patchKeyed", "Halogen.VDom.DOM", function() {
    return function(state3, vdom) {
      if (vdom instanceof Grafted) {
        return $lazy_patchKeyed(222)(state3, runGraft(vdom.value0));
      }
      ;
      if (vdom instanceof Keyed && eqElemSpec(state3.ns, state3.name, vdom.value0, vdom.value1)) {
        var v2 = length3(vdom.value3);
        if (state3.length === 0 && v2 === 0) {
          var attrs2 = step2(state3.attrs, vdom.value2);
          var nextState = {
            build: state3.build,
            node: state3.node,
            attrs: attrs2,
            ns: vdom.value0,
            name: vdom.value1,
            children: state3.children,
            length: 0
          };
          return mkStep(new Step2(state3.node, nextState, $lazy_patchKeyed(237), haltKeyed));
        }
        ;
        var onThis = function(v22, s3) {
          return halt(s3);
        };
        var onThese = function(v22, ix$prime, s3, v3) {
          var res = step2(s3, v3.value1);
          insertChildIx(ix$prime, extract2(res), state3.node);
          return res;
        };
        var onThat = function(v22, ix, v3) {
          var res = state3.build(v3.value1);
          insertChildIx(ix, extract2(res), state3.node);
          return res;
        };
        var children22 = diffWithKeyAndIxE(state3.children, vdom.value3, fst, onThese, onThis, onThat);
        var attrs2 = step2(state3.attrs, vdom.value2);
        var nextState = {
          build: state3.build,
          node: state3.node,
          attrs: attrs2,
          ns: vdom.value0,
          name: vdom.value1,
          children: children22,
          length: v2
        };
        return mkStep(new Step2(state3.node, nextState, $lazy_patchKeyed(261), haltKeyed));
      }
      ;
      haltKeyed(state3);
      return state3.build(vdom);
    };
  });
  var patchKeyed = /* @__PURE__ */ $lazy_patchKeyed(217);
  var buildWidget = function(v2, build, w) {
    var res = v2.buildWidget(v2)(w);
    var res$prime = unStep(function(v1) {
      return mkStep(new Step2(v1.value0, {
        build,
        widget: res
      }, patchWidget, haltWidget));
    })(res);
    return res$prime;
  };
  var buildText = function(v2, build, s3) {
    var node = createTextNode2(s3, v2.document);
    var state3 = {
      build,
      node,
      value: s3
    };
    return mkStep(new Step2(node, state3, patchText, haltText));
  };
  var buildKeyed = function(v2, build, ns1, name1, as1, ch1) {
    var el = createElement2(toNullable(ns1), name1, v2.document);
    var node = toNode(el);
    var onChild = function(v1, ix, v22) {
      var res = build(v22.value1);
      insertChildIx(ix, extract2(res), node);
      return res;
    };
    var children3 = strMapWithIxE(ch1, fst, onChild);
    var attrs = v2.buildAttributes(el)(as1);
    var state3 = {
      build,
      node,
      attrs,
      ns: ns1,
      name: name1,
      children: children3,
      length: length3(ch1)
    };
    return mkStep(new Step2(node, state3, patchKeyed, haltKeyed));
  };
  var buildElem = function(v2, build, ns1, name1, as1, ch1) {
    var el = createElement2(toNullable(ns1), name1, v2.document);
    var node = toNode(el);
    var onChild = function(ix, child) {
      var res = build(child);
      insertChildIx(ix, extract2(res), node);
      return res;
    };
    var children3 = forE2(ch1, onChild);
    var attrs = v2.buildAttributes(el)(as1);
    var state3 = {
      build,
      node,
      attrs,
      ns: ns1,
      name: name1,
      children: children3
    };
    return mkStep(new Step2(node, state3, patchElem, haltElem));
  };
  var buildVDom = function(spec) {
    var $lazy_build = $runtime_lazy6("build", "Halogen.VDom.DOM", function() {
      return function(v2) {
        if (v2 instanceof Text2) {
          return buildText(spec, $lazy_build(59), v2.value0);
        }
        ;
        if (v2 instanceof Elem) {
          return buildElem(spec, $lazy_build(60), v2.value0, v2.value1, v2.value2, v2.value3);
        }
        ;
        if (v2 instanceof Keyed) {
          return buildKeyed(spec, $lazy_build(61), v2.value0, v2.value1, v2.value2, v2.value3);
        }
        ;
        if (v2 instanceof Widget) {
          return buildWidget(spec, $lazy_build(62), v2.value0);
        }
        ;
        if (v2 instanceof Grafted) {
          return $lazy_build(63)(runGraft(v2.value0));
        }
        ;
        throw new Error("Failed pattern match at Halogen.VDom.DOM (line 58, column 27 - line 63, column 52): " + [v2.constructor.name]);
      };
    });
    var build = $lazy_build(58);
    return build;
  };

  // output/Foreign/foreign.js
  function typeOf(value20) {
    return typeof value20;
  }
  function tagOf(value20) {
    return Object.prototype.toString.call(value20).slice(8, -1);
  }
  var isArray = Array.isArray || function(value20) {
    return Object.prototype.toString.call(value20) === "[object Array]";
  };

  // output/Data.List.NonEmpty/index.js
  var singleton7 = /* @__PURE__ */ (function() {
    var $200 = singleton2(plusList);
    return function($201) {
      return NonEmptyList($200($201));
    };
  })();
  var head3 = function(v2) {
    return v2.value0;
  };
  var cons3 = function(y32) {
    return function(v2) {
      return new NonEmpty(y32, new Cons(v2.value0, v2.value1));
    };
  };

  // output/Data.String.CodeUnits/foreign.js
  var fromCharArray = function(a3) {
    return a3.join("");
  };
  var toCharArray = function(s3) {
    return s3.split("");
  };
  var singleton8 = function(c2) {
    return c2;
  };
  var length7 = function(s3) {
    return s3.length;
  };
  var _indexOf = function(just) {
    return function(nothing) {
      return function(x32) {
        return function(s3) {
          var i2 = s3.indexOf(x32);
          return i2 === -1 ? nothing : just(i2);
        };
      };
    };
  };
  var take3 = function(n) {
    return function(s3) {
      return s3.substr(0, n);
    };
  };
  var drop3 = function(n) {
    return function(s3) {
      return s3.substring(n);
    };
  };
  var splitAt = function(i2) {
    return function(s3) {
      return { before: s3.substring(0, i2), after: s3.substring(i2) };
    };
  };

  // output/Data.String.Unsafe/foreign.js
  var charAt = function(i2) {
    return function(s3) {
      if (i2 >= 0 && i2 < s3.length) return s3.charAt(i2);
      throw new Error("Data.String.Unsafe.charAt: Invalid index.");
    };
  };

  // output/Data.String.CodeUnits/index.js
  var stripPrefix = function(v2) {
    return function(str23) {
      var v1 = splitAt(length7(v2))(str23);
      var $20 = v1.before === v2;
      if ($20) {
        return new Just(v1.after);
      }
      ;
      return Nothing.value;
    };
  };
  var indexOf = /* @__PURE__ */ (function() {
    return _indexOf(Just.create)(Nothing.value);
  })();
  var contains3 = function(pat) {
    var $23 = indexOf(pat);
    return function($24) {
      return isJust($23($24));
    };
  };

  // output/Foreign/index.js
  var show6 = /* @__PURE__ */ show(showString);
  var show13 = /* @__PURE__ */ show(showInt);
  var ForeignError = /* @__PURE__ */ (function() {
    function ForeignError2(value0) {
      this.value0 = value0;
    }
    ;
    ForeignError2.create = function(value0) {
      return new ForeignError2(value0);
    };
    return ForeignError2;
  })();
  var TypeMismatch = /* @__PURE__ */ (function() {
    function TypeMismatch2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    TypeMismatch2.create = function(value0) {
      return function(value1) {
        return new TypeMismatch2(value0, value1);
      };
    };
    return TypeMismatch2;
  })();
  var ErrorAtIndex = /* @__PURE__ */ (function() {
    function ErrorAtIndex2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    ErrorAtIndex2.create = function(value0) {
      return function(value1) {
        return new ErrorAtIndex2(value0, value1);
      };
    };
    return ErrorAtIndex2;
  })();
  var ErrorAtProperty = /* @__PURE__ */ (function() {
    function ErrorAtProperty2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    ErrorAtProperty2.create = function(value0) {
      return function(value1) {
        return new ErrorAtProperty2(value0, value1);
      };
    };
    return ErrorAtProperty2;
  })();
  var unsafeToForeign = unsafeCoerce2;
  var unsafeFromForeign = unsafeCoerce2;
  var renderForeignError = function(v2) {
    if (v2 instanceof ForeignError) {
      return v2.value0;
    }
    ;
    if (v2 instanceof ErrorAtIndex) {
      return "Error at array index " + (show13(v2.value0) + (": " + renderForeignError(v2.value1)));
    }
    ;
    if (v2 instanceof ErrorAtProperty) {
      return "Error at property " + (show6(v2.value0) + (": " + renderForeignError(v2.value1)));
    }
    ;
    if (v2 instanceof TypeMismatch) {
      return "Type mismatch: expected " + (v2.value0 + (", found " + v2.value1));
    }
    ;
    throw new Error("Failed pattern match at Foreign (line 78, column 1 - line 78, column 45): " + [v2.constructor.name]);
  };
  var fail = function(dictMonad) {
    var $153 = throwError(monadThrowExceptT(dictMonad));
    return function($154) {
      return $153(singleton7($154));
    };
  };
  var unsafeReadTagged = function(dictMonad) {
    var pure128 = pure(applicativeExceptT(dictMonad));
    var fail1 = fail(dictMonad);
    return function(tag) {
      return function(value20) {
        if (tagOf(value20) === tag) {
          return pure128(unsafeFromForeign(value20));
        }
        ;
        if (otherwise) {
          return fail1(new TypeMismatch(tag, tagOf(value20)));
        }
        ;
        throw new Error("Failed pattern match at Foreign (line 123, column 1 - line 123, column 104): " + [tag.constructor.name, value20.constructor.name]);
      };
    };
  };
  var readBoolean = function(dictMonad) {
    return unsafeReadTagged(dictMonad)("Boolean");
  };
  var readString = function(dictMonad) {
    return unsafeReadTagged(dictMonad)("String");
  };

  // output/Foreign.Object/foreign.js
  var empty7 = {};
  function _lookup(no, yes, k, m2) {
    return k in m2 ? yes(m2[k]) : no;
  }
  function toArrayWithKey(f) {
    return function(m2) {
      var r29 = [];
      for (var k in m2) {
        if (hasOwnProperty.call(m2, k)) {
          r29.push(f(k)(m2[k]));
        }
      }
      return r29;
    };
  }
  var keys2 = Object.keys || toArrayWithKey(function(k) {
    return function() {
      return k;
    };
  });

  // output/Foreign.Object/index.js
  var lookup4 = /* @__PURE__ */ (function() {
    return runFn4(_lookup)(Nothing.value)(Just.create);
  })();

  // output/Web.Event.EventTarget/foreign.js
  function eventListener(fn) {
    return function() {
      return function(event) {
        return fn(event)();
      };
    };
  }
  function addEventListener2(type2) {
    return function(listener) {
      return function(useCapture) {
        return function(target7) {
          return function() {
            return target7.addEventListener(type2, listener, useCapture);
          };
        };
      };
    };
  }
  function removeEventListener2(type2) {
    return function(listener) {
      return function(useCapture) {
        return function(target7) {
          return function() {
            return target7.removeEventListener(type2, listener, useCapture);
          };
        };
      };
    };
  }

  // output/Halogen.VDom.DOM.Prop/index.js
  var $runtime_lazy7 = function(name16, moduleName, init4) {
    var state3 = 0;
    var val;
    return function(lineNumber) {
      if (state3 === 2) return val;
      if (state3 === 1) throw new ReferenceError(name16 + " was needed before it finished initializing (module " + moduleName + ", line " + lineNumber + ")", moduleName, lineNumber);
      state3 = 1;
      val = init4();
      state3 = 2;
      return val;
    };
  };
  var Created = /* @__PURE__ */ (function() {
    function Created2(value0) {
      this.value0 = value0;
    }
    ;
    Created2.create = function(value0) {
      return new Created2(value0);
    };
    return Created2;
  })();
  var Removed = /* @__PURE__ */ (function() {
    function Removed2(value0) {
      this.value0 = value0;
    }
    ;
    Removed2.create = function(value0) {
      return new Removed2(value0);
    };
    return Removed2;
  })();
  var Attribute = /* @__PURE__ */ (function() {
    function Attribute2(value0, value1, value22) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
    }
    ;
    Attribute2.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return new Attribute2(value0, value1, value22);
        };
      };
    };
    return Attribute2;
  })();
  var Property = /* @__PURE__ */ (function() {
    function Property2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    Property2.create = function(value0) {
      return function(value1) {
        return new Property2(value0, value1);
      };
    };
    return Property2;
  })();
  var Handler = /* @__PURE__ */ (function() {
    function Handler2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    Handler2.create = function(value0) {
      return function(value1) {
        return new Handler2(value0, value1);
      };
    };
    return Handler2;
  })();
  var Ref = /* @__PURE__ */ (function() {
    function Ref2(value0) {
      this.value0 = value0;
    }
    ;
    Ref2.create = function(value0) {
      return new Ref2(value0);
    };
    return Ref2;
  })();
  var unsafeGetProperty = unsafeGetAny;
  var setProperty = unsafeSetAny;
  var removeProperty = function(key2, el) {
    var v2 = hasAttribute2(nullImpl, key2, el);
    if (v2) {
      return removeAttribute2(nullImpl, key2, el);
    }
    ;
    var v1 = typeOf(unsafeGetAny(key2, el));
    if (v1 === "string") {
      return unsafeSetAny(key2, "", el);
    }
    ;
    if (key2 === "rowSpan") {
      return unsafeSetAny(key2, 1, el);
    }
    ;
    if (key2 === "colSpan") {
      return unsafeSetAny(key2, 1, el);
    }
    ;
    return unsafeSetAny(key2, jsUndefined, el);
  };
  var propToStrKey = function(v2) {
    if (v2 instanceof Attribute && v2.value0 instanceof Just) {
      return "attr/" + (v2.value0.value0 + (":" + v2.value1));
    }
    ;
    if (v2 instanceof Attribute) {
      return "attr/:" + v2.value1;
    }
    ;
    if (v2 instanceof Property) {
      return "prop/" + v2.value0;
    }
    ;
    if (v2 instanceof Handler) {
      return "handler/" + v2.value0;
    }
    ;
    if (v2 instanceof Ref) {
      return "ref";
    }
    ;
    throw new Error("Failed pattern match at Halogen.VDom.DOM.Prop (line 182, column 16 - line 187, column 16): " + [v2.constructor.name]);
  };
  var propFromString = unsafeCoerce2;
  var propFromNumber = unsafeCoerce2;
  var propFromInt = unsafeCoerce2;
  var propFromBoolean = unsafeCoerce2;
  var buildProp = function(emit) {
    return function(el) {
      var removeProp = function(prevEvents) {
        return function(v2, v1) {
          if (v1 instanceof Attribute) {
            return removeAttribute2(toNullable(v1.value0), v1.value1, el);
          }
          ;
          if (v1 instanceof Property) {
            return removeProperty(v1.value0, el);
          }
          ;
          if (v1 instanceof Handler) {
            var handler3 = unsafeLookup(v1.value0, prevEvents);
            return removeEventListener(v1.value0, fst(handler3), el);
          }
          ;
          if (v1 instanceof Ref) {
            return unit;
          }
          ;
          throw new Error("Failed pattern match at Halogen.VDom.DOM.Prop (line 169, column 5 - line 179, column 18): " + [v1.constructor.name]);
        };
      };
      var mbEmit = function(v2) {
        if (v2 instanceof Just) {
          return emit(v2.value0)();
        }
        ;
        return unit;
      };
      var haltProp = function(state3) {
        var v2 = lookup4("ref")(state3.props);
        if (v2 instanceof Just && v2.value0 instanceof Ref) {
          return mbEmit(v2.value0.value0(new Removed(el)));
        }
        ;
        return unit;
      };
      var diffProp = function(prevEvents, events) {
        return function(v2, v1, v11, v22) {
          if (v11 instanceof Attribute && v22 instanceof Attribute) {
            var $66 = v11.value2 === v22.value2;
            if ($66) {
              return v22;
            }
            ;
            setAttribute2(toNullable(v22.value0), v22.value1, v22.value2, el);
            return v22;
          }
          ;
          if (v11 instanceof Property && v22 instanceof Property) {
            var v4 = refEq2(v11.value1, v22.value1);
            if (v4) {
              return v22;
            }
            ;
            if (v22.value0 === "value") {
              var elVal = unsafeGetProperty("value", el);
              var $75 = refEq2(elVal, v22.value1);
              if ($75) {
                return v22;
              }
              ;
              setProperty(v22.value0, v22.value1, el);
              return v22;
            }
            ;
            setProperty(v22.value0, v22.value1, el);
            return v22;
          }
          ;
          if (v11 instanceof Handler && v22 instanceof Handler) {
            var handler3 = unsafeLookup(v22.value0, prevEvents);
            write(v22.value1)(snd(handler3))();
            pokeMutMap(v22.value0, handler3, events);
            return v22;
          }
          ;
          return v22;
        };
      };
      var applyProp = function(events) {
        return function(v2, v1, v22) {
          if (v22 instanceof Attribute) {
            setAttribute2(toNullable(v22.value0), v22.value1, v22.value2, el);
            return v22;
          }
          ;
          if (v22 instanceof Property) {
            setProperty(v22.value0, v22.value1, el);
            return v22;
          }
          ;
          if (v22 instanceof Handler) {
            var v3 = unsafeGetAny(v22.value0, events);
            if (unsafeHasAny(v22.value0, events)) {
              write(v22.value1)(snd(v3))();
              return v22;
            }
            ;
            var ref2 = $$new(v22.value1)();
            var listener = eventListener(function(ev) {
              return function __do7() {
                var f$prime = read(ref2)();
                return mbEmit(f$prime(ev));
              };
            })();
            pokeMutMap(v22.value0, new Tuple(listener, ref2), events);
            addEventListener(v22.value0, listener, el);
            return v22;
          }
          ;
          if (v22 instanceof Ref) {
            mbEmit(v22.value0(new Created(el)));
            return v22;
          }
          ;
          throw new Error("Failed pattern match at Halogen.VDom.DOM.Prop (line 113, column 5 - line 135, column 15): " + [v22.constructor.name]);
        };
      };
      var $lazy_patchProp = $runtime_lazy7("patchProp", "Halogen.VDom.DOM.Prop", function() {
        return function(state3, ps2) {
          var events = newMutMap();
          var onThis = removeProp(state3.events);
          var onThese = diffProp(state3.events, events);
          var onThat = applyProp(events);
          var props = diffWithKeyAndIxE(state3.props, ps2, propToStrKey, onThese, onThis, onThat);
          var nextState = {
            events: unsafeFreeze2(events),
            props
          };
          return mkStep(new Step2(unit, nextState, $lazy_patchProp(100), haltProp));
        };
      });
      var patchProp = $lazy_patchProp(87);
      var renderProp = function(ps1) {
        var events = newMutMap();
        var ps1$prime = strMapWithIxE(ps1, propToStrKey, applyProp(events));
        var state3 = {
          events: unsafeFreeze2(events),
          props: ps1$prime
        };
        return mkStep(new Step2(unit, state3, patchProp, haltProp));
      };
      return renderProp;
    };
  };

  // output/Halogen.HTML.Core/index.js
  var HTML = function(x32) {
    return x32;
  };
  var widget = function($28) {
    return HTML(Widget.create($28));
  };
  var toPropValue = function(dict) {
    return dict.toPropValue;
  };
  var text5 = function($29) {
    return HTML(Text2.create($29));
  };
  var prop = function(dictIsProp) {
    var toPropValue1 = toPropValue(dictIsProp);
    return function(v2) {
      var $31 = Property.create(v2);
      return function($32) {
        return $31(toPropValue1($32));
      };
    };
  };
  var isPropString = {
    toPropValue: propFromString
  };
  var isPropStepValue = {
    toPropValue: function($36) {
      return propFromString(renderStepValue($36));
    }
  };
  var isPropNumber = {
    toPropValue: propFromNumber
  };
  var isPropInt = {
    toPropValue: propFromInt
  };
  var isPropInputType = {
    toPropValue: function($45) {
      return propFromString(renderInputType($45));
    }
  };
  var isPropBoolean = {
    toPropValue: propFromBoolean
  };
  var handler = /* @__PURE__ */ (function() {
    return Handler.create;
  })();
  var element = function(ns) {
    return function(name16) {
      return function(props) {
        return function(children3) {
          return new Elem(ns, name16, props, children3);
        };
      };
    };
  };
  var attr = function(ns) {
    return function(v2) {
      return Attribute.create(ns)(v2);
    };
  };

  // output/Control.Applicative.Free/index.js
  var identity10 = /* @__PURE__ */ identity(categoryFn);
  var Pure = /* @__PURE__ */ (function() {
    function Pure2(value0) {
      this.value0 = value0;
    }
    ;
    Pure2.create = function(value0) {
      return new Pure2(value0);
    };
    return Pure2;
  })();
  var Lift = /* @__PURE__ */ (function() {
    function Lift3(value0) {
      this.value0 = value0;
    }
    ;
    Lift3.create = function(value0) {
      return new Lift3(value0);
    };
    return Lift3;
  })();
  var Ap = /* @__PURE__ */ (function() {
    function Ap2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    Ap2.create = function(value0) {
      return function(value1) {
        return new Ap2(value0, value1);
      };
    };
    return Ap2;
  })();
  var mkAp = function(fba) {
    return function(fb) {
      return new Ap(fba, fb);
    };
  };
  var liftFreeAp = /* @__PURE__ */ (function() {
    return Lift.create;
  })();
  var goLeft = function(dictApplicative) {
    var pure107 = pure(dictApplicative);
    return function(fStack) {
      return function(valStack) {
        return function(nat) {
          return function(func) {
            return function(count) {
              if (func instanceof Pure) {
                return new Tuple(new Cons({
                  func: pure107(func.value0),
                  count
                }, fStack), valStack);
              }
              ;
              if (func instanceof Lift) {
                return new Tuple(new Cons({
                  func: nat(func.value0),
                  count
                }, fStack), valStack);
              }
              ;
              if (func instanceof Ap) {
                return goLeft(dictApplicative)(fStack)(cons3(func.value1)(valStack))(nat)(func.value0)(count + 1 | 0);
              }
              ;
              throw new Error("Failed pattern match at Control.Applicative.Free (line 102, column 41 - line 105, column 81): " + [func.constructor.name]);
            };
          };
        };
      };
    };
  };
  var goApply = function(dictApplicative) {
    var apply7 = apply(dictApplicative.Apply0());
    return function(fStack) {
      return function(vals) {
        return function(gVal) {
          if (fStack instanceof Nil) {
            return new Left(gVal);
          }
          ;
          if (fStack instanceof Cons) {
            var gRes = apply7(fStack.value0.func)(gVal);
            var $31 = fStack.value0.count === 1;
            if ($31) {
              if (fStack.value1 instanceof Nil) {
                return new Left(gRes);
              }
              ;
              return goApply(dictApplicative)(fStack.value1)(vals)(gRes);
            }
            ;
            if (vals instanceof Nil) {
              return new Left(gRes);
            }
            ;
            if (vals instanceof Cons) {
              return new Right(new Tuple(new Cons({
                func: gRes,
                count: fStack.value0.count - 1 | 0
              }, fStack.value1), new NonEmpty(vals.value0, vals.value1)));
            }
            ;
            throw new Error("Failed pattern match at Control.Applicative.Free (line 83, column 11 - line 88, column 50): " + [vals.constructor.name]);
          }
          ;
          throw new Error("Failed pattern match at Control.Applicative.Free (line 72, column 3 - line 88, column 50): " + [fStack.constructor.name]);
        };
      };
    };
  };
  var functorFreeAp = {
    map: function(f) {
      return function(x32) {
        return mkAp(new Pure(f))(x32);
      };
    }
  };
  var foldFreeAp = function(dictApplicative) {
    var goApply1 = goApply(dictApplicative);
    var pure107 = pure(dictApplicative);
    var goLeft1 = goLeft(dictApplicative);
    return function(nat) {
      return function(z2) {
        var go2 = function($copy_v) {
          var $tco_done = false;
          var $tco_result;
          function $tco_loop(v2) {
            if (v2.value1.value0 instanceof Pure) {
              var v1 = goApply1(v2.value0)(v2.value1.value1)(pure107(v2.value1.value0.value0));
              if (v1 instanceof Left) {
                $tco_done = true;
                return v1.value0;
              }
              ;
              if (v1 instanceof Right) {
                $copy_v = v1.value0;
                return;
              }
              ;
              throw new Error("Failed pattern match at Control.Applicative.Free (line 54, column 17 - line 56, column 24): " + [v1.constructor.name]);
            }
            ;
            if (v2.value1.value0 instanceof Lift) {
              var v1 = goApply1(v2.value0)(v2.value1.value1)(nat(v2.value1.value0.value0));
              if (v1 instanceof Left) {
                $tco_done = true;
                return v1.value0;
              }
              ;
              if (v1 instanceof Right) {
                $copy_v = v1.value0;
                return;
              }
              ;
              throw new Error("Failed pattern match at Control.Applicative.Free (line 57, column 17 - line 59, column 24): " + [v1.constructor.name]);
            }
            ;
            if (v2.value1.value0 instanceof Ap) {
              var nextVals = new NonEmpty(v2.value1.value0.value1, v2.value1.value1);
              $copy_v = goLeft1(v2.value0)(nextVals)(nat)(v2.value1.value0.value0)(1);
              return;
            }
            ;
            throw new Error("Failed pattern match at Control.Applicative.Free (line 53, column 5 - line 62, column 47): " + [v2.value1.value0.constructor.name]);
          }
          ;
          while (!$tco_done) {
            $tco_result = $tco_loop($copy_v);
          }
          ;
          return $tco_result;
        };
        return go2(new Tuple(Nil.value, singleton7(z2)));
      };
    };
  };
  var retractFreeAp = function(dictApplicative) {
    return foldFreeAp(dictApplicative)(identity10);
  };
  var applyFreeAp = {
    apply: function(fba) {
      return function(fb) {
        return mkAp(fba)(fb);
      };
    },
    Functor0: function() {
      return functorFreeAp;
    }
  };
  var applicativeFreeAp = /* @__PURE__ */ (function() {
    return {
      pure: Pure.create,
      Apply0: function() {
        return applyFreeAp;
      }
    };
  })();
  var foldFreeAp1 = /* @__PURE__ */ foldFreeAp(applicativeFreeAp);
  var hoistFreeAp = function(f) {
    return foldFreeAp1(function($54) {
      return liftFreeAp(f($54));
    });
  };

  // output/Halogen.Query.ChildQuery/index.js
  var unChildQueryBox = unsafeCoerce2;

  // output/Halogen.Subscription/index.js
  var $$void7 = /* @__PURE__ */ $$void(functorEffect);
  var coerce3 = /* @__PURE__ */ coerce();
  var bind4 = /* @__PURE__ */ bind(bindEffect);
  var append9 = /* @__PURE__ */ append(semigroupArray);
  var traverse_4 = /* @__PURE__ */ traverse_(applicativeEffect);
  var traverse_1 = /* @__PURE__ */ traverse_4(foldableArray);
  var unsubscribe = function(v2) {
    return v2;
  };
  var subscribe = function(v2) {
    return function(k) {
      return v2(function($76) {
        return $$void7(k($76));
      });
    };
  };
  var notify = function(v2) {
    return function(a3) {
      return v2(a3);
    };
  };
  var makeEmitter = coerce3;
  var functorEmitter = {
    map: function(f) {
      return function(v2) {
        return function(k) {
          return v2(function($77) {
            return k(f($77));
          });
        };
      };
    }
  };
  var create4 = function __do() {
    var subscribers = $$new([])();
    return {
      emitter: function(k) {
        return function __do7() {
          modify_2(function(v2) {
            return append9(v2)([k]);
          })(subscribers)();
          return modify_2(deleteBy(unsafeRefEq)(k))(subscribers);
        };
      },
      listener: function(a3) {
        return bind4(read(subscribers))(traverse_1(function(k) {
          return k(a3);
        }));
      }
    };
  };

  // output/Halogen.Query.HalogenM/index.js
  var identity11 = /* @__PURE__ */ identity(categoryFn);
  var SubscriptionId = function(x32) {
    return x32;
  };
  var ForkId = function(x32) {
    return x32;
  };
  var State = /* @__PURE__ */ (function() {
    function State2(value0) {
      this.value0 = value0;
    }
    ;
    State2.create = function(value0) {
      return new State2(value0);
    };
    return State2;
  })();
  var Subscribe = /* @__PURE__ */ (function() {
    function Subscribe2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    Subscribe2.create = function(value0) {
      return function(value1) {
        return new Subscribe2(value0, value1);
      };
    };
    return Subscribe2;
  })();
  var Unsubscribe = /* @__PURE__ */ (function() {
    function Unsubscribe2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    Unsubscribe2.create = function(value0) {
      return function(value1) {
        return new Unsubscribe2(value0, value1);
      };
    };
    return Unsubscribe2;
  })();
  var Lift2 = /* @__PURE__ */ (function() {
    function Lift3(value0) {
      this.value0 = value0;
    }
    ;
    Lift3.create = function(value0) {
      return new Lift3(value0);
    };
    return Lift3;
  })();
  var ChildQuery2 = /* @__PURE__ */ (function() {
    function ChildQuery3(value0) {
      this.value0 = value0;
    }
    ;
    ChildQuery3.create = function(value0) {
      return new ChildQuery3(value0);
    };
    return ChildQuery3;
  })();
  var Raise = /* @__PURE__ */ (function() {
    function Raise2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    Raise2.create = function(value0) {
      return function(value1) {
        return new Raise2(value0, value1);
      };
    };
    return Raise2;
  })();
  var Par = /* @__PURE__ */ (function() {
    function Par2(value0) {
      this.value0 = value0;
    }
    ;
    Par2.create = function(value0) {
      return new Par2(value0);
    };
    return Par2;
  })();
  var Fork = /* @__PURE__ */ (function() {
    function Fork2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    Fork2.create = function(value0) {
      return function(value1) {
        return new Fork2(value0, value1);
      };
    };
    return Fork2;
  })();
  var Join2 = /* @__PURE__ */ (function() {
    function Join3(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    Join3.create = function(value0) {
      return function(value1) {
        return new Join3(value0, value1);
      };
    };
    return Join3;
  })();
  var Kill = /* @__PURE__ */ (function() {
    function Kill2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    Kill2.create = function(value0) {
      return function(value1) {
        return new Kill2(value0, value1);
      };
    };
    return Kill2;
  })();
  var GetRef = /* @__PURE__ */ (function() {
    function GetRef2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    GetRef2.create = function(value0) {
      return function(value1) {
        return new GetRef2(value0, value1);
      };
    };
    return GetRef2;
  })();
  var HalogenM = function(x32) {
    return x32;
  };
  var unsubscribe2 = function(sid) {
    return liftF(new Unsubscribe(sid, unit));
  };
  var subscribe2 = function(es) {
    return liftF(new Subscribe(function(v2) {
      return es;
    }, identity11));
  };
  var ordSubscriptionId = ordInt;
  var ordForkId = ordInt;
  var monadHalogenM = freeMonad;
  var monadStateHalogenM = {
    state: function($181) {
      return HalogenM(liftF(State.create($181)));
    },
    Monad0: function() {
      return monadHalogenM;
    }
  };
  var monadEffectHalogenM = function(dictMonadEffect) {
    return {
      liftEffect: (function() {
        var $186 = liftEffect(dictMonadEffect);
        return function($187) {
          return HalogenM(liftF(Lift2.create($186($187))));
        };
      })(),
      Monad0: function() {
        return monadHalogenM;
      }
    };
  };
  var monadAffHalogenM = function(dictMonadAff) {
    var monadEffectHalogenM1 = monadEffectHalogenM(dictMonadAff.MonadEffect0());
    return {
      liftAff: (function() {
        var $188 = liftAff(dictMonadAff);
        return function($189) {
          return HalogenM(liftF(Lift2.create($188($189))));
        };
      })(),
      MonadEffect0: function() {
        return monadEffectHalogenM1;
      }
    };
  };
  var kill = function(fid) {
    return liftF(new Kill(fid, unit));
  };
  var functorHalogenM = freeFunctor;
  var fork = function(hmu) {
    return liftF(new Fork(hmu, identity11));
  };
  var bindHalogenM = freeBind;
  var bind5 = /* @__PURE__ */ bind(bindHalogenM);
  var applicativeHalogenM = freeApplicative;
  var pure6 = /* @__PURE__ */ pure(applicativeHalogenM);
  var monadRecHalogenM = {
    tailRecM: function(k) {
      return function(a3) {
        return bind5(k(a3))(function(v2) {
          if (v2 instanceof Loop) {
            return tailRecM(monadRecHalogenM)(k)(v2.value0);
          }
          ;
          if (v2 instanceof Done) {
            return pure6(v2.value0);
          }
          ;
          throw new Error("Failed pattern match at Halogen.Query.HalogenM (line 105, column 26 - line 107, column 21): " + [v2.constructor.name]);
        });
      };
    },
    Monad0: function() {
      return monadHalogenM;
    }
  };

  // output/Halogen.Query.HalogenQ/index.js
  var Initialize = /* @__PURE__ */ (function() {
    function Initialize52(value0) {
      this.value0 = value0;
    }
    ;
    Initialize52.create = function(value0) {
      return new Initialize52(value0);
    };
    return Initialize52;
  })();
  var Finalize = /* @__PURE__ */ (function() {
    function Finalize6(value0) {
      this.value0 = value0;
    }
    ;
    Finalize6.create = function(value0) {
      return new Finalize6(value0);
    };
    return Finalize6;
  })();
  var Receive = /* @__PURE__ */ (function() {
    function Receive3(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    Receive3.create = function(value0) {
      return function(value1) {
        return new Receive3(value0, value1);
      };
    };
    return Receive3;
  })();
  var Action2 = /* @__PURE__ */ (function() {
    function Action3(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    Action3.create = function(value0) {
      return function(value1) {
        return new Action3(value0, value1);
      };
    };
    return Action3;
  })();
  var Query = /* @__PURE__ */ (function() {
    function Query3(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    Query3.create = function(value0) {
      return function(value1) {
        return new Query3(value0, value1);
      };
    };
    return Query3;
  })();

  // output/Halogen.VDom.Thunk/index.js
  var $runtime_lazy8 = function(name16, moduleName, init4) {
    var state3 = 0;
    var val;
    return function(lineNumber) {
      if (state3 === 2) return val;
      if (state3 === 1) throw new ReferenceError(name16 + " was needed before it finished initializing (module " + moduleName + ", line " + lineNumber + ")", moduleName, lineNumber);
      state3 = 1;
      val = init4();
      state3 = 2;
      return val;
    };
  };
  var unsafeEqThunk = function(v2, v1) {
    return refEq2(v2.value0, v1.value0) && (refEq2(v2.value1, v1.value1) && v2.value1(v2.value3, v1.value3));
  };
  var runThunk = function(v2) {
    return v2.value2(v2.value3);
  };
  var buildThunk = function(toVDom) {
    var haltThunk = function(state3) {
      return halt(state3.vdom);
    };
    var $lazy_patchThunk = $runtime_lazy8("patchThunk", "Halogen.VDom.Thunk", function() {
      return function(state3, t2) {
        var $48 = unsafeEqThunk(state3.thunk, t2);
        if ($48) {
          return mkStep(new Step2(extract2(state3.vdom), state3, $lazy_patchThunk(112), haltThunk));
        }
        ;
        var vdom = step2(state3.vdom, toVDom(runThunk(t2)));
        return mkStep(new Step2(extract2(vdom), {
          vdom,
          thunk: t2
        }, $lazy_patchThunk(115), haltThunk));
      };
    });
    var patchThunk = $lazy_patchThunk(108);
    var renderThunk = function(spec) {
      return function(t2) {
        var vdom = buildVDom(spec)(toVDom(runThunk(t2)));
        return mkStep(new Step2(extract2(vdom), {
          thunk: t2,
          vdom
        }, patchThunk, haltThunk));
      };
    };
    return renderThunk;
  };

  // output/Halogen.Component/index.js
  var voidLeft2 = /* @__PURE__ */ voidLeft(functorHalogenM);
  var traverse_5 = /* @__PURE__ */ traverse_(applicativeHalogenM)(foldableMaybe);
  var map26 = /* @__PURE__ */ map(functorHalogenM);
  var pure7 = /* @__PURE__ */ pure(applicativeHalogenM);
  var lookup5 = /* @__PURE__ */ lookup3();
  var pop3 = /* @__PURE__ */ pop2();
  var insert4 = /* @__PURE__ */ insert3();
  var ComponentSlot = /* @__PURE__ */ (function() {
    function ComponentSlot2(value0) {
      this.value0 = value0;
    }
    ;
    ComponentSlot2.create = function(value0) {
      return new ComponentSlot2(value0);
    };
    return ComponentSlot2;
  })();
  var ThunkSlot = /* @__PURE__ */ (function() {
    function ThunkSlot2(value0) {
      this.value0 = value0;
    }
    ;
    ThunkSlot2.create = function(value0) {
      return new ThunkSlot2(value0);
    };
    return ThunkSlot2;
  })();
  var unComponentSlot = unsafeCoerce2;
  var unComponent = unsafeCoerce2;
  var mkEval = function(args) {
    return function(v2) {
      if (v2 instanceof Initialize) {
        return voidLeft2(traverse_5(args.handleAction)(args.initialize))(v2.value0);
      }
      ;
      if (v2 instanceof Finalize) {
        return voidLeft2(traverse_5(args.handleAction)(args.finalize))(v2.value0);
      }
      ;
      if (v2 instanceof Receive) {
        return voidLeft2(traverse_5(args.handleAction)(args.receive(v2.value0)))(v2.value1);
      }
      ;
      if (v2 instanceof Action2) {
        return voidLeft2(args.handleAction(v2.value0))(v2.value1);
      }
      ;
      if (v2 instanceof Query) {
        return unCoyoneda(function(g2) {
          var $45 = map26(maybe(v2.value1(unit))(g2));
          return function($46) {
            return $45(args.handleQuery($46));
          };
        })(v2.value0);
      }
      ;
      throw new Error("Failed pattern match at Halogen.Component (line 182, column 15 - line 192, column 71): " + [v2.constructor.name]);
    };
  };
  var mkComponentSlot = unsafeCoerce2;
  var mkComponent = unsafeCoerce2;
  var defaultEval = /* @__PURE__ */ (function() {
    return {
      handleAction: $$const(pure7(unit)),
      handleQuery: $$const(pure7(Nothing.value)),
      receive: $$const(Nothing.value),
      initialize: Nothing.value,
      finalize: Nothing.value
    };
  })();
  var componentSlot = function() {
    return function(dictIsSymbol) {
      var lookup111 = lookup5(dictIsSymbol);
      var pop12 = pop3(dictIsSymbol);
      var insert19 = insert4(dictIsSymbol);
      return function(dictOrd) {
        var lookup211 = lookup111(dictOrd);
        var pop22 = pop12(dictOrd);
        var insert23 = insert19(dictOrd);
        return function(label5) {
          return function(p2) {
            return function(comp) {
              return function(input3) {
                return function(output2) {
                  return mkComponentSlot({
                    get: lookup211(label5)(p2),
                    pop: pop22(label5)(p2),
                    set: insert23(label5)(p2),
                    component: comp,
                    input: input3,
                    output: output2
                  });
                };
              };
            };
          };
        };
      };
    };
  };

  // output/Halogen.HTML.Elements/index.js
  var pure8 = /* @__PURE__ */ pure(applicativeMaybe);
  var elementNS = function($15) {
    return element(pure8($15));
  };
  var element2 = /* @__PURE__ */ (function() {
    return element(Nothing.value);
  })();
  var em = /* @__PURE__ */ element2("em");
  var em_ = /* @__PURE__ */ em([]);
  var footer = /* @__PURE__ */ element2("footer");
  var h1 = /* @__PURE__ */ element2("h1");
  var h1_ = /* @__PURE__ */ h1([]);
  var h2 = /* @__PURE__ */ element2("h2");
  var h2_ = /* @__PURE__ */ h2([]);
  var h3 = /* @__PURE__ */ element2("h3");
  var h3_ = /* @__PURE__ */ h3([]);
  var h4 = /* @__PURE__ */ element2("h4");
  var h4_ = /* @__PURE__ */ h4([]);
  var header = /* @__PURE__ */ element2("header");
  var hr = function(props) {
    return element2("hr")(props)([]);
  };
  var img = function(props) {
    return element2("img")(props)([]);
  };
  var input = function(props) {
    return element2("input")(props)([]);
  };
  var label4 = /* @__PURE__ */ element2("label");
  var label_ = /* @__PURE__ */ label4([]);
  var li = /* @__PURE__ */ element2("li");
  var li_ = /* @__PURE__ */ li([]);
  var main = /* @__PURE__ */ element2("main");
  var main_ = /* @__PURE__ */ main([]);
  var nav = /* @__PURE__ */ element2("nav");
  var ol = /* @__PURE__ */ element2("ol");
  var ol_ = /* @__PURE__ */ ol([]);
  var option = /* @__PURE__ */ element2("option");
  var p = /* @__PURE__ */ element2("p");
  var p_ = /* @__PURE__ */ p([]);
  var pre = /* @__PURE__ */ element2("pre");
  var pre_ = /* @__PURE__ */ pre([]);
  var section = /* @__PURE__ */ element2("section");
  var select7 = /* @__PURE__ */ element2("select");
  var span4 = /* @__PURE__ */ element2("span");
  var span_ = /* @__PURE__ */ span4([]);
  var strong = /* @__PURE__ */ element2("strong");
  var strong_ = /* @__PURE__ */ strong([]);
  var summary = /* @__PURE__ */ element2("summary");
  var summary_ = /* @__PURE__ */ summary([]);
  var table = /* @__PURE__ */ element2("table");
  var tbody = /* @__PURE__ */ element2("tbody");
  var tbody_ = /* @__PURE__ */ tbody([]);
  var td = /* @__PURE__ */ element2("td");
  var td_ = /* @__PURE__ */ td([]);
  var th = /* @__PURE__ */ element2("th");
  var th_ = /* @__PURE__ */ th([]);
  var thead = /* @__PURE__ */ element2("thead");
  var thead_ = /* @__PURE__ */ thead([]);
  var tr = /* @__PURE__ */ element2("tr");
  var tr_ = /* @__PURE__ */ tr([]);
  var ul = /* @__PURE__ */ element2("ul");
  var ul_ = /* @__PURE__ */ ul([]);
  var div2 = /* @__PURE__ */ element2("div");
  var div_ = /* @__PURE__ */ div2([]);
  var details = /* @__PURE__ */ element2("details");
  var code = /* @__PURE__ */ element2("code");
  var code_ = /* @__PURE__ */ code([]);
  var button2 = /* @__PURE__ */ element2("button");
  var aside = /* @__PURE__ */ element2("aside");
  var a = /* @__PURE__ */ element2("a");

  // output/Control.Monad.Except/index.js
  var unwrap3 = /* @__PURE__ */ unwrap();
  var runExcept = function($3) {
    return unwrap3(runExceptT($3));
  };

  // output/Foreign.Index/foreign.js
  function unsafeReadPropImpl(f, s3, key2, value20) {
    return value20 == null ? f : s3(value20[key2]);
  }

  // output/Foreign.Index/index.js
  var unsafeReadProp = function(dictMonad) {
    var fail3 = fail(dictMonad);
    var pure107 = pure(applicativeExceptT(dictMonad));
    return function(k) {
      return function(value20) {
        return unsafeReadPropImpl(fail3(new TypeMismatch("object", typeOf(value20))), pure107, k, value20);
      };
    };
  };
  var readProp = function(dictMonad) {
    return unsafeReadProp(dictMonad);
  };

  // output/Web.Event.Event/foreign.js
  function _currentTarget(e) {
    return e.currentTarget;
  }

  // output/Web.Event.Event/index.js
  var currentTarget = function($5) {
    return toMaybe(_currentTarget($5));
  };

  // output/Web.HTML.Event.EventTypes/index.js
  var input2 = "input";
  var domcontentloaded = "DOMContentLoaded";
  var change = "change";

  // output/Web.UIEvent.KeyboardEvent.EventTypes/index.js
  var keydown = "keydown";

  // output/Web.UIEvent.MouseEvent.EventTypes/index.js
  var click2 = "click";

  // output/Halogen.HTML.Events/index.js
  var map27 = /* @__PURE__ */ map(functorMaybe);
  var composeKleisli2 = /* @__PURE__ */ composeKleisli(bindMaybe);
  var composeKleisliFlipped2 = /* @__PURE__ */ composeKleisliFlipped(/* @__PURE__ */ bindExceptT(monadIdentity));
  var readProp2 = /* @__PURE__ */ readProp(monadIdentity);
  var readString2 = /* @__PURE__ */ readString(monadIdentity);
  var mouseHandler = unsafeCoerce2;
  var keyHandler = unsafeCoerce2;
  var handler$prime = function(et) {
    return function(f) {
      return handler(et)(function(ev) {
        return map27(Action.create)(f(ev));
      });
    };
  };
  var handler2 = function(et) {
    return function(f) {
      return handler(et)(function(ev) {
        return new Just(new Action(f(ev)));
      });
    };
  };
  var onClick = /* @__PURE__ */ (function() {
    var $15 = handler2(click2);
    return function($16) {
      return $15(mouseHandler($16));
    };
  })();
  var onKeyDown = /* @__PURE__ */ (function() {
    var $23 = handler2(keydown);
    return function($24) {
      return $23(keyHandler($24));
    };
  })();
  var addForeignPropHandler = function(key2) {
    return function(prop5) {
      return function(reader) {
        return function(f) {
          var go2 = function(a3) {
            return composeKleisliFlipped2(reader)(readProp2(prop5))(unsafeToForeign(a3));
          };
          return handler$prime(key2)(composeKleisli2(currentTarget)(function(e) {
            return either($$const(Nothing.value))(function($85) {
              return Just.create(f($85));
            })(runExcept(go2(e)));
          }));
        };
      };
    };
  };
  var onChecked = /* @__PURE__ */ addForeignPropHandler(change)("checked")(/* @__PURE__ */ readBoolean(monadIdentity));
  var onValueChange = /* @__PURE__ */ addForeignPropHandler(change)("value")(readString2);
  var onValueInput = /* @__PURE__ */ addForeignPropHandler(input2)("value")(readString2);

  // output/Halogen.HTML.Properties/index.js
  var unwrap4 = /* @__PURE__ */ unwrap();
  var prop2 = function(dictIsProp) {
    return prop(dictIsProp);
  };
  var prop1 = /* @__PURE__ */ prop2(isPropBoolean);
  var prop22 = /* @__PURE__ */ prop2(isPropString);
  var prop3 = /* @__PURE__ */ prop2(isPropInt);
  var prop4 = /* @__PURE__ */ prop2(isPropNumber);
  var rel4 = /* @__PURE__ */ prop22("rel");
  var src9 = /* @__PURE__ */ prop22("src");
  var step3 = /* @__PURE__ */ prop2(isPropStepValue)("step");
  var tabIndex2 = /* @__PURE__ */ prop3("tabIndex");
  var target6 = /* @__PURE__ */ prop22("target");
  var title2 = /* @__PURE__ */ prop22("title");
  var type_18 = function(dictIsProp) {
    return prop2(dictIsProp)("type");
  };
  var value12 = function(dictIsProp) {
    return prop2(dictIsProp)("value");
  };
  var placeholder3 = /* @__PURE__ */ prop22("placeholder");
  var min5 = /* @__PURE__ */ prop4("min");
  var max6 = /* @__PURE__ */ prop4("max");
  var id3 = /* @__PURE__ */ prop22("id");
  var href4 = /* @__PURE__ */ prop22("href");
  var $$for = /* @__PURE__ */ prop22("htmlFor");
  var disabled10 = /* @__PURE__ */ prop1("disabled");
  var colSpan2 = /* @__PURE__ */ prop3("colSpan");
  var classes = /* @__PURE__ */ (function() {
    var $32 = prop22("className");
    var $33 = joinWith(" ");
    var $34 = map(functorArray)(unwrap4);
    return function($35) {
      return $32($33($34($35)));
    };
  })();
  var class_ = /* @__PURE__ */ (function() {
    var $36 = prop22("className");
    return function($37) {
      return $36(unwrap4($37));
    };
  })();
  var checked2 = /* @__PURE__ */ prop1("checked");
  var attr2 = /* @__PURE__ */ (function() {
    return attr(Nothing.value);
  })();
  var style = /* @__PURE__ */ attr2("style");
  var alt5 = /* @__PURE__ */ prop22("alt");

  // output/Affjax/foreign.js
  function _ajax(platformSpecificDriver, timeoutErrorMessageIdent, requestFailedMessageIdent, mkHeader, options2) {
    return function(errback, callback) {
      var xhr = platformSpecificDriver.newXHR();
      var fixedUrl = platformSpecificDriver.fixupUrl(options2.url, xhr);
      xhr.open(options2.method || "GET", fixedUrl, true, options2.username, options2.password);
      if (options2.headers) {
        try {
          for (var i2 = 0, header2; (header2 = options2.headers[i2]) != null; i2++) {
            xhr.setRequestHeader(header2.field, header2.value);
          }
        } catch (e) {
          errback(e);
        }
      }
      var onerror = function(msgIdent) {
        return function() {
          errback(new Error(msgIdent));
        };
      };
      xhr.onerror = onerror(requestFailedMessageIdent);
      xhr.ontimeout = onerror(timeoutErrorMessageIdent);
      xhr.onload = function() {
        callback({
          status: xhr.status,
          statusText: xhr.statusText,
          headers: xhr.getAllResponseHeaders().split("\r\n").filter(function(header3) {
            return header3.length > 0;
          }).map(function(header3) {
            var i3 = header3.indexOf(":");
            return mkHeader(header3.substring(0, i3))(header3.substring(i3 + 2));
          }),
          body: xhr.response
        });
      };
      xhr.responseType = options2.responseType;
      xhr.withCredentials = options2.withCredentials;
      xhr.timeout = options2.timeout;
      xhr.send(options2.content);
      return function(error4, cancelErrback, cancelCallback) {
        try {
          xhr.abort();
        } catch (e) {
          return cancelErrback(e);
        }
        return cancelCallback();
      };
    };
  }

  // output/Data.MediaType.Common/index.js
  var applicationJSON = "application/json";
  var applicationFormURLEncoded = "application/x-www-form-urlencoded";

  // output/Affjax.RequestBody/index.js
  var ArrayView = /* @__PURE__ */ (function() {
    function ArrayView2(value0) {
      this.value0 = value0;
    }
    ;
    ArrayView2.create = function(value0) {
      return new ArrayView2(value0);
    };
    return ArrayView2;
  })();
  var Blob = /* @__PURE__ */ (function() {
    function Blob3(value0) {
      this.value0 = value0;
    }
    ;
    Blob3.create = function(value0) {
      return new Blob3(value0);
    };
    return Blob3;
  })();
  var Document = /* @__PURE__ */ (function() {
    function Document3(value0) {
      this.value0 = value0;
    }
    ;
    Document3.create = function(value0) {
      return new Document3(value0);
    };
    return Document3;
  })();
  var $$String = /* @__PURE__ */ (function() {
    function $$String3(value0) {
      this.value0 = value0;
    }
    ;
    $$String3.create = function(value0) {
      return new $$String3(value0);
    };
    return $$String3;
  })();
  var FormData = /* @__PURE__ */ (function() {
    function FormData2(value0) {
      this.value0 = value0;
    }
    ;
    FormData2.create = function(value0) {
      return new FormData2(value0);
    };
    return FormData2;
  })();
  var FormURLEncoded = /* @__PURE__ */ (function() {
    function FormURLEncoded2(value0) {
      this.value0 = value0;
    }
    ;
    FormURLEncoded2.create = function(value0) {
      return new FormURLEncoded2(value0);
    };
    return FormURLEncoded2;
  })();
  var Json = /* @__PURE__ */ (function() {
    function Json3(value0) {
      this.value0 = value0;
    }
    ;
    Json3.create = function(value0) {
      return new Json3(value0);
    };
    return Json3;
  })();
  var toMediaType = function(v2) {
    if (v2 instanceof FormURLEncoded) {
      return new Just(applicationFormURLEncoded);
    }
    ;
    if (v2 instanceof Json) {
      return new Just(applicationJSON);
    }
    ;
    return Nothing.value;
  };

  // output/Affjax.RequestHeader/index.js
  var unwrap5 = /* @__PURE__ */ unwrap();
  var Accept = /* @__PURE__ */ (function() {
    function Accept2(value0) {
      this.value0 = value0;
    }
    ;
    Accept2.create = function(value0) {
      return new Accept2(value0);
    };
    return Accept2;
  })();
  var ContentType = /* @__PURE__ */ (function() {
    function ContentType2(value0) {
      this.value0 = value0;
    }
    ;
    ContentType2.create = function(value0) {
      return new ContentType2(value0);
    };
    return ContentType2;
  })();
  var RequestHeader = /* @__PURE__ */ (function() {
    function RequestHeader2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    RequestHeader2.create = function(value0) {
      return function(value1) {
        return new RequestHeader2(value0, value1);
      };
    };
    return RequestHeader2;
  })();
  var value13 = function(v2) {
    if (v2 instanceof Accept) {
      return unwrap5(v2.value0);
    }
    ;
    if (v2 instanceof ContentType) {
      return unwrap5(v2.value0);
    }
    ;
    if (v2 instanceof RequestHeader) {
      return v2.value1;
    }
    ;
    throw new Error("Failed pattern match at Affjax.RequestHeader (line 26, column 1 - line 26, column 33): " + [v2.constructor.name]);
  };
  var name15 = function(v2) {
    if (v2 instanceof Accept) {
      return "Accept";
    }
    ;
    if (v2 instanceof ContentType) {
      return "Content-Type";
    }
    ;
    if (v2 instanceof RequestHeader) {
      return v2.value0;
    }
    ;
    throw new Error("Failed pattern match at Affjax.RequestHeader (line 21, column 1 - line 21, column 32): " + [v2.constructor.name]);
  };

  // output/Affjax.ResponseFormat/index.js
  var identity12 = /* @__PURE__ */ identity(categoryFn);
  var $$ArrayBuffer = /* @__PURE__ */ (function() {
    function $$ArrayBuffer2(value0) {
      this.value0 = value0;
    }
    ;
    $$ArrayBuffer2.create = function(value0) {
      return new $$ArrayBuffer2(value0);
    };
    return $$ArrayBuffer2;
  })();
  var Blob2 = /* @__PURE__ */ (function() {
    function Blob3(value0) {
      this.value0 = value0;
    }
    ;
    Blob3.create = function(value0) {
      return new Blob3(value0);
    };
    return Blob3;
  })();
  var Document2 = /* @__PURE__ */ (function() {
    function Document3(value0) {
      this.value0 = value0;
    }
    ;
    Document3.create = function(value0) {
      return new Document3(value0);
    };
    return Document3;
  })();
  var Json2 = /* @__PURE__ */ (function() {
    function Json3(value0) {
      this.value0 = value0;
    }
    ;
    Json3.create = function(value0) {
      return new Json3(value0);
    };
    return Json3;
  })();
  var $$String2 = /* @__PURE__ */ (function() {
    function $$String3(value0) {
      this.value0 = value0;
    }
    ;
    $$String3.create = function(value0) {
      return new $$String3(value0);
    };
    return $$String3;
  })();
  var Ignore = /* @__PURE__ */ (function() {
    function Ignore2(value0) {
      this.value0 = value0;
    }
    ;
    Ignore2.create = function(value0) {
      return new Ignore2(value0);
    };
    return Ignore2;
  })();
  var toResponseType = function(v2) {
    if (v2 instanceof $$ArrayBuffer) {
      return "arraybuffer";
    }
    ;
    if (v2 instanceof Blob2) {
      return "blob";
    }
    ;
    if (v2 instanceof Document2) {
      return "document";
    }
    ;
    if (v2 instanceof Json2) {
      return "text";
    }
    ;
    if (v2 instanceof $$String2) {
      return "text";
    }
    ;
    if (v2 instanceof Ignore) {
      return "";
    }
    ;
    throw new Error("Failed pattern match at Affjax.ResponseFormat (line 44, column 3 - line 50, column 19): " + [v2.constructor.name]);
  };
  var toMediaType2 = function(v2) {
    if (v2 instanceof Json2) {
      return new Just(applicationJSON);
    }
    ;
    return Nothing.value;
  };
  var string = /* @__PURE__ */ (function() {
    return new $$String2(identity12);
  })();
  var json = /* @__PURE__ */ (function() {
    return new Json2(identity12);
  })();
  var ignore = /* @__PURE__ */ (function() {
    return new Ignore(identity12);
  })();

  // output/Affjax.ResponseHeader/index.js
  var ResponseHeader = /* @__PURE__ */ (function() {
    function ResponseHeader2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    ResponseHeader2.create = function(value0) {
      return function(value1) {
        return new ResponseHeader2(value0, value1);
      };
    };
    return ResponseHeader2;
  })();

  // output/Data.Argonaut.Core/foreign.js
  function id4(x32) {
    return x32;
  }
  function stringify(j) {
    return JSON.stringify(j);
  }

  // output/Data.Argonaut.Core/index.js
  var jsonEmptyObject = /* @__PURE__ */ id4(empty7);

  // output/Data.Argonaut.Parser/foreign.js
  function _jsonParser(fail3, succ, s3) {
    try {
      return succ(JSON.parse(s3));
    } catch (e) {
      return fail3(e.message);
    }
  }

  // output/Data.Argonaut.Parser/index.js
  var jsonParser = function(j) {
    return _jsonParser(Left.create, Right.create, j);
  };

  // output/JSURI/foreign.js
  function encodeURIComponent_to_RFC3986(input3) {
    return input3.replace(/[!'()*]/g, function(c2) {
      return "%" + c2.charCodeAt(0).toString(16);
    });
  }
  function _encodeFormURLComponent(fail3, succeed, input3) {
    try {
      return succeed(encodeURIComponent_to_RFC3986(encodeURIComponent(input3)).replace(/%20/g, "+"));
    } catch (err) {
      return fail3(err);
    }
  }
  function _decodeURIComponent(fail3, succeed, input3) {
    try {
      return succeed(decodeURIComponent(input3));
    } catch (err) {
      return fail3(err);
    }
  }

  // output/JSURI/index.js
  var encodeFormURLComponent = /* @__PURE__ */ (function() {
    return runFn3(_encodeFormURLComponent)($$const(Nothing.value))(Just.create);
  })();
  var $$decodeURIComponent = /* @__PURE__ */ (function() {
    return runFn3(_decodeURIComponent)($$const(Nothing.value))(Just.create);
  })();

  // output/Data.FormURLEncoded/index.js
  var apply2 = /* @__PURE__ */ apply(applyMaybe);
  var map28 = /* @__PURE__ */ map(functorMaybe);
  var traverse3 = /* @__PURE__ */ traverse(traversableArray)(applicativeMaybe);
  var toArray3 = function(v2) {
    return v2;
  };
  var encode = /* @__PURE__ */ (function() {
    var encodePart = function(v2) {
      if (v2.value1 instanceof Nothing) {
        return encodeFormURLComponent(v2.value0);
      }
      ;
      if (v2.value1 instanceof Just) {
        return apply2(map28(function(key2) {
          return function(val) {
            return key2 + ("=" + val);
          };
        })(encodeFormURLComponent(v2.value0)))(encodeFormURLComponent(v2.value1.value0));
      }
      ;
      throw new Error("Failed pattern match at Data.FormURLEncoded (line 37, column 16 - line 39, column 114): " + [v2.constructor.name]);
    };
    var $37 = map28(joinWith("&"));
    var $38 = traverse3(encodePart);
    return function($39) {
      return $37($38(toArray3($39)));
    };
  })();

  // output/Data.HTTP.Method/index.js
  var OPTIONS = /* @__PURE__ */ (function() {
    function OPTIONS2() {
    }
    ;
    OPTIONS2.value = new OPTIONS2();
    return OPTIONS2;
  })();
  var GET2 = /* @__PURE__ */ (function() {
    function GET3() {
    }
    ;
    GET3.value = new GET3();
    return GET3;
  })();
  var HEAD = /* @__PURE__ */ (function() {
    function HEAD2() {
    }
    ;
    HEAD2.value = new HEAD2();
    return HEAD2;
  })();
  var POST2 = /* @__PURE__ */ (function() {
    function POST3() {
    }
    ;
    POST3.value = new POST3();
    return POST3;
  })();
  var PUT = /* @__PURE__ */ (function() {
    function PUT2() {
    }
    ;
    PUT2.value = new PUT2();
    return PUT2;
  })();
  var DELETE = /* @__PURE__ */ (function() {
    function DELETE2() {
    }
    ;
    DELETE2.value = new DELETE2();
    return DELETE2;
  })();
  var TRACE = /* @__PURE__ */ (function() {
    function TRACE2() {
    }
    ;
    TRACE2.value = new TRACE2();
    return TRACE2;
  })();
  var CONNECT = /* @__PURE__ */ (function() {
    function CONNECT2() {
    }
    ;
    CONNECT2.value = new CONNECT2();
    return CONNECT2;
  })();
  var PROPFIND = /* @__PURE__ */ (function() {
    function PROPFIND2() {
    }
    ;
    PROPFIND2.value = new PROPFIND2();
    return PROPFIND2;
  })();
  var PROPPATCH = /* @__PURE__ */ (function() {
    function PROPPATCH2() {
    }
    ;
    PROPPATCH2.value = new PROPPATCH2();
    return PROPPATCH2;
  })();
  var MKCOL = /* @__PURE__ */ (function() {
    function MKCOL2() {
    }
    ;
    MKCOL2.value = new MKCOL2();
    return MKCOL2;
  })();
  var COPY = /* @__PURE__ */ (function() {
    function COPY2() {
    }
    ;
    COPY2.value = new COPY2();
    return COPY2;
  })();
  var MOVE = /* @__PURE__ */ (function() {
    function MOVE2() {
    }
    ;
    MOVE2.value = new MOVE2();
    return MOVE2;
  })();
  var LOCK = /* @__PURE__ */ (function() {
    function LOCK2() {
    }
    ;
    LOCK2.value = new LOCK2();
    return LOCK2;
  })();
  var UNLOCK = /* @__PURE__ */ (function() {
    function UNLOCK2() {
    }
    ;
    UNLOCK2.value = new UNLOCK2();
    return UNLOCK2;
  })();
  var PATCH = /* @__PURE__ */ (function() {
    function PATCH2() {
    }
    ;
    PATCH2.value = new PATCH2();
    return PATCH2;
  })();
  var unCustomMethod = function(v2) {
    return v2;
  };
  var showMethod = {
    show: function(v2) {
      if (v2 instanceof OPTIONS) {
        return "OPTIONS";
      }
      ;
      if (v2 instanceof GET2) {
        return "GET";
      }
      ;
      if (v2 instanceof HEAD) {
        return "HEAD";
      }
      ;
      if (v2 instanceof POST2) {
        return "POST";
      }
      ;
      if (v2 instanceof PUT) {
        return "PUT";
      }
      ;
      if (v2 instanceof DELETE) {
        return "DELETE";
      }
      ;
      if (v2 instanceof TRACE) {
        return "TRACE";
      }
      ;
      if (v2 instanceof CONNECT) {
        return "CONNECT";
      }
      ;
      if (v2 instanceof PROPFIND) {
        return "PROPFIND";
      }
      ;
      if (v2 instanceof PROPPATCH) {
        return "PROPPATCH";
      }
      ;
      if (v2 instanceof MKCOL) {
        return "MKCOL";
      }
      ;
      if (v2 instanceof COPY) {
        return "COPY";
      }
      ;
      if (v2 instanceof MOVE) {
        return "MOVE";
      }
      ;
      if (v2 instanceof LOCK) {
        return "LOCK";
      }
      ;
      if (v2 instanceof UNLOCK) {
        return "UNLOCK";
      }
      ;
      if (v2 instanceof PATCH) {
        return "PATCH";
      }
      ;
      throw new Error("Failed pattern match at Data.HTTP.Method (line 43, column 1 - line 59, column 23): " + [v2.constructor.name]);
    }
  };
  var print6 = /* @__PURE__ */ either(/* @__PURE__ */ show(showMethod))(unCustomMethod);

  // output/Effect.Aff.Compat/index.js
  var fromEffectFnAff = function(v2) {
    return makeAff(function(k) {
      return function __do7() {
        var v1 = v2(function($9) {
          return k(Left.create($9))();
        }, function($10) {
          return k(Right.create($10))();
        });
        return function(e) {
          return makeAff(function(k2) {
            return function __do8() {
              v1(e, function($11) {
                return k2(Left.create($11))();
              }, function($12) {
                return k2(Right.create($12))();
              });
              return nonCanceler;
            };
          });
        };
      };
    });
  };

  // output/Affjax/index.js
  var pure9 = /* @__PURE__ */ pure(/* @__PURE__ */ applicativeExceptT(monadIdentity));
  var fail2 = /* @__PURE__ */ fail(monadIdentity);
  var unsafeReadTagged2 = /* @__PURE__ */ unsafeReadTagged(monadIdentity);
  var alt6 = /* @__PURE__ */ alt(/* @__PURE__ */ altExceptT(semigroupNonEmptyList)(monadIdentity));
  var composeKleisliFlipped3 = /* @__PURE__ */ composeKleisliFlipped(/* @__PURE__ */ bindExceptT(monadIdentity));
  var map29 = /* @__PURE__ */ map(functorMaybe);
  var any3 = /* @__PURE__ */ any(foldableArray)(heytingAlgebraBoolean);
  var eq3 = /* @__PURE__ */ eq(eqString);
  var bindFlipped4 = /* @__PURE__ */ bindFlipped(bindMaybe);
  var map112 = /* @__PURE__ */ map(functorArray);
  var mapFlipped3 = /* @__PURE__ */ mapFlipped(functorAff);
  var $$try3 = /* @__PURE__ */ $$try(monadErrorAff);
  var pure1 = /* @__PURE__ */ pure(applicativeAff);
  var RequestContentError = /* @__PURE__ */ (function() {
    function RequestContentError2(value0) {
      this.value0 = value0;
    }
    ;
    RequestContentError2.create = function(value0) {
      return new RequestContentError2(value0);
    };
    return RequestContentError2;
  })();
  var ResponseBodyError = /* @__PURE__ */ (function() {
    function ResponseBodyError2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    ResponseBodyError2.create = function(value0) {
      return function(value1) {
        return new ResponseBodyError2(value0, value1);
      };
    };
    return ResponseBodyError2;
  })();
  var TimeoutError = /* @__PURE__ */ (function() {
    function TimeoutError2() {
    }
    ;
    TimeoutError2.value = new TimeoutError2();
    return TimeoutError2;
  })();
  var RequestFailedError = /* @__PURE__ */ (function() {
    function RequestFailedError2() {
    }
    ;
    RequestFailedError2.value = new RequestFailedError2();
    return RequestFailedError2;
  })();
  var XHROtherError = /* @__PURE__ */ (function() {
    function XHROtherError2(value0) {
      this.value0 = value0;
    }
    ;
    XHROtherError2.create = function(value0) {
      return new XHROtherError2(value0);
    };
    return XHROtherError2;
  })();
  var request = function(driver2) {
    return function(req2) {
      var parseJSON = function(v3) {
        if (v3 === "") {
          return pure9(jsonEmptyObject);
        }
        ;
        return either(function($74) {
          return fail2(ForeignError.create($74));
        })(pure9)(jsonParser(v3));
      };
      var fromResponse = (function() {
        if (req2.responseFormat instanceof $$ArrayBuffer) {
          return unsafeReadTagged2("ArrayBuffer");
        }
        ;
        if (req2.responseFormat instanceof Blob2) {
          return unsafeReadTagged2("Blob");
        }
        ;
        if (req2.responseFormat instanceof Document2) {
          return function(x32) {
            return alt6(unsafeReadTagged2("Document")(x32))(alt6(unsafeReadTagged2("XMLDocument")(x32))(unsafeReadTagged2("HTMLDocument")(x32)));
          };
        }
        ;
        if (req2.responseFormat instanceof Json2) {
          return composeKleisliFlipped3(function($75) {
            return req2.responseFormat.value0(parseJSON($75));
          })(unsafeReadTagged2("String"));
        }
        ;
        if (req2.responseFormat instanceof $$String2) {
          return unsafeReadTagged2("String");
        }
        ;
        if (req2.responseFormat instanceof Ignore) {
          return $$const(req2.responseFormat.value0(pure9(unit)));
        }
        ;
        throw new Error("Failed pattern match at Affjax (line 274, column 18 - line 283, column 57): " + [req2.responseFormat.constructor.name]);
      })();
      var extractContent = function(v3) {
        if (v3 instanceof ArrayView) {
          return new Right(v3.value0(unsafeToForeign));
        }
        ;
        if (v3 instanceof Blob) {
          return new Right(unsafeToForeign(v3.value0));
        }
        ;
        if (v3 instanceof Document) {
          return new Right(unsafeToForeign(v3.value0));
        }
        ;
        if (v3 instanceof $$String) {
          return new Right(unsafeToForeign(v3.value0));
        }
        ;
        if (v3 instanceof FormData) {
          return new Right(unsafeToForeign(v3.value0));
        }
        ;
        if (v3 instanceof FormURLEncoded) {
          return note("Body contains values that cannot be encoded as application/x-www-form-urlencoded")(map29(unsafeToForeign)(encode(v3.value0)));
        }
        ;
        if (v3 instanceof Json) {
          return new Right(unsafeToForeign(stringify(v3.value0)));
        }
        ;
        throw new Error("Failed pattern match at Affjax (line 235, column 20 - line 250, column 69): " + [v3.constructor.name]);
      };
      var addHeader = function(mh) {
        return function(hs) {
          if (mh instanceof Just && !any3(on(eq3)(name15)(mh.value0))(hs)) {
            return snoc3(hs)(mh.value0);
          }
          ;
          return hs;
        };
      };
      var headers = function(reqContent) {
        return addHeader(map29(ContentType.create)(bindFlipped4(toMediaType)(reqContent)))(addHeader(map29(Accept.create)(toMediaType2(req2.responseFormat)))(req2.headers));
      };
      var ajaxRequest = function(v3) {
        return {
          method: print6(req2.method),
          url: req2.url,
          headers: map112(function(h7) {
            return {
              field: name15(h7),
              value: value13(h7)
            };
          })(headers(req2.content)),
          content: v3,
          responseType: toResponseType(req2.responseFormat),
          username: toNullable(req2.username),
          password: toNullable(req2.password),
          withCredentials: req2.withCredentials,
          timeout: fromMaybe(0)(map29(function(v1) {
            return v1;
          })(req2.timeout))
        };
      };
      var send = function(content3) {
        return mapFlipped3($$try3(fromEffectFnAff(_ajax(driver2, "AffjaxTimeoutErrorMessageIdent", "AffjaxRequestFailedMessageIdent", ResponseHeader.create, ajaxRequest(content3)))))(function(v3) {
          if (v3 instanceof Right) {
            var v1 = runExcept(fromResponse(v3.value0.body));
            if (v1 instanceof Left) {
              return new Left(new ResponseBodyError(head3(v1.value0), v3.value0));
            }
            ;
            if (v1 instanceof Right) {
              return new Right({
                headers: v3.value0.headers,
                status: v3.value0.status,
                statusText: v3.value0.statusText,
                body: v1.value0
              });
            }
            ;
            throw new Error("Failed pattern match at Affjax (line 209, column 9 - line 211, column 52): " + [v1.constructor.name]);
          }
          ;
          if (v3 instanceof Left) {
            return new Left((function() {
              var message2 = message(v3.value0);
              var $61 = message2 === "AffjaxTimeoutErrorMessageIdent";
              if ($61) {
                return TimeoutError.value;
              }
              ;
              var $62 = message2 === "AffjaxRequestFailedMessageIdent";
              if ($62) {
                return RequestFailedError.value;
              }
              ;
              return new XHROtherError(v3.value0);
            })());
          }
          ;
          throw new Error("Failed pattern match at Affjax (line 207, column 144 - line 219, column 28): " + [v3.constructor.name]);
        });
      };
      if (req2.content instanceof Nothing) {
        return send(toNullable(Nothing.value));
      }
      ;
      if (req2.content instanceof Just) {
        var v2 = extractContent(req2.content.value0);
        if (v2 instanceof Right) {
          return send(toNullable(new Just(v2.value0)));
        }
        ;
        if (v2 instanceof Left) {
          return pure1(new Left(new RequestContentError(v2.value0)));
        }
        ;
        throw new Error("Failed pattern match at Affjax (line 199, column 7 - line 203, column 48): " + [v2.constructor.name]);
      }
      ;
      throw new Error("Failed pattern match at Affjax (line 195, column 3 - line 203, column 48): " + [req2.content.constructor.name]);
    };
  };
  var printError = function(v2) {
    if (v2 instanceof RequestContentError) {
      return "There was a problem with the request content: " + v2.value0;
    }
    ;
    if (v2 instanceof ResponseBodyError) {
      return "There was a problem with the response body: " + renderForeignError(v2.value0);
    }
    ;
    if (v2 instanceof TimeoutError) {
      return "There was a problem making the request: timeout";
    }
    ;
    if (v2 instanceof RequestFailedError) {
      return "There was a problem making the request: request failed";
    }
    ;
    if (v2 instanceof XHROtherError) {
      return "There was a problem making the request: " + message(v2.value0);
    }
    ;
    throw new Error("Failed pattern match at Affjax (line 113, column 14 - line 123, column 66): " + [v2.constructor.name]);
  };
  var defaultRequest = /* @__PURE__ */ (function() {
    return {
      method: new Left(GET2.value),
      url: "/",
      headers: [],
      content: Nothing.value,
      username: Nothing.value,
      password: Nothing.value,
      withCredentials: false,
      responseFormat: ignore,
      timeout: Nothing.value
    };
  })();
  var get4 = function(driver2) {
    return function(rf) {
      return function(u2) {
        return request(driver2)({
          method: defaultRequest.method,
          headers: defaultRequest.headers,
          content: defaultRequest.content,
          username: defaultRequest.username,
          password: defaultRequest.password,
          withCredentials: defaultRequest.withCredentials,
          timeout: defaultRequest.timeout,
          url: u2,
          responseFormat: rf
        });
      };
    };
  };

  // output/Affjax.Web/foreign.js
  var driver = {
    newXHR: function() {
      return new XMLHttpRequest();
    },
    fixupUrl: function(url2) {
      return url2 || "/";
    }
  };

  // output/Affjax.Web/index.js
  var get5 = /* @__PURE__ */ get4(driver);

  // output/PSD3.Shared.DataLoader/index.js
  var bind6 = /* @__PURE__ */ bind(bindAff);
  var pure10 = /* @__PURE__ */ pure(applicativeAff);
  var LocalOnly = /* @__PURE__ */ (function() {
    function LocalOnly2() {
    }
    ;
    LocalOnly2.value = new LocalOnly2();
    return LocalOnly2;
  })();
  var RemoteOnly = /* @__PURE__ */ (function() {
    function RemoteOnly2() {
    }
    ;
    RemoteOnly2.value = new RemoteOnly2();
    return RemoteOnly2;
  })();
  var LocalFirst = /* @__PURE__ */ (function() {
    function LocalFirst2() {
    }
    ;
    LocalFirst2.value = new LocalFirst2();
    return LocalFirst2;
  })();
  var RemoteFirst = /* @__PURE__ */ (function() {
    function RemoteFirst2() {
    }
    ;
    RemoteFirst2.value = new RemoteFirst2();
    return RemoteFirst2;
  })();
  var NetworkError = /* @__PURE__ */ (function() {
    function NetworkError2(value0) {
      this.value0 = value0;
    }
    ;
    NetworkError2.create = function(value0) {
      return new NetworkError2(value0);
    };
    return NetworkError2;
  })();
  var ParseError = /* @__PURE__ */ (function() {
    function ParseError2(value0) {
      this.value0 = value0;
    }
    ;
    ParseError2.create = function(value0) {
      return new ParseError2(value0);
    };
    return ParseError2;
  })();
  var FileNotFound = /* @__PURE__ */ (function() {
    function FileNotFound2(value0) {
      this.value0 = value0;
    }
    ;
    FileNotFound2.create = function(value0) {
      return new FileNotFound2(value0);
    };
    return FileNotFound2;
  })();
  var ConfigError = /* @__PURE__ */ (function() {
    function ConfigError2(value0) {
      this.value0 = value0;
    }
    ;
    ConfigError2.create = function(value0) {
      return new ConfigError2(value0);
    };
    return ConfigError2;
  })();
  var showLoadError = {
    show: function(v2) {
      if (v2 instanceof NetworkError) {
        return "Network Error: " + v2.value0;
      }
      ;
      if (v2 instanceof ParseError) {
        return "Parse Error: " + v2.value0;
      }
      ;
      if (v2 instanceof FileNotFound) {
        return "File Not Found: " + v2.value0;
      }
      ;
      if (v2 instanceof ConfigError) {
        return "Configuration Error: " + v2.value0;
      }
      ;
      throw new Error("Failed pattern match at PSD3.Shared.DataLoader (line 58, column 1 - line 62, column 58): " + [v2.constructor.name]);
    }
  };
  var loadRemoteText = function(baseUrl) {
    return function(path18) {
      var fullUrl = baseUrl + ("/" + path18);
      return bind6(get5(string)(fullUrl))(function(result) {
        return pure10((function() {
          if (result instanceof Left) {
            return new Left(new NetworkError("Failed to load remote text from " + (fullUrl + (": " + printError(result.value0)))));
          }
          ;
          if (result instanceof Right) {
            return new Right(result.value0.body);
          }
          ;
          throw new Error("Failed pattern match at PSD3.Shared.DataLoader (line 222, column 10 - line 226, column 26): " + [result.constructor.name]);
        })());
      });
    };
  };
  var loadRemoteJSON = function(baseUrl) {
    return function(path18) {
      var fullUrl = baseUrl + ("/" + path18);
      return bind6(get5(json)(fullUrl))(function(result) {
        return pure10((function() {
          if (result instanceof Left) {
            return new Left(new NetworkError("Failed to load remote JSON from " + (fullUrl + (": " + printError(result.value0)))));
          }
          ;
          if (result instanceof Right) {
            return new Right(result.value0.body);
          }
          ;
          throw new Error("Failed pattern match at PSD3.Shared.DataLoader (line 83, column 10 - line 87, column 26): " + [result.constructor.name]);
        })());
      });
    };
  };
  var loadLocalText = function(path18) {
    return bind6(get5(string)(path18))(function(result) {
      return pure10((function() {
        if (result instanceof Left) {
          return new Left(new NetworkError("Failed to load local text from " + (path18 + (": " + printError(result.value0)))));
        }
        ;
        if (result instanceof Right) {
          return new Right(result.value0.body);
        }
        ;
        throw new Error("Failed pattern match at PSD3.Shared.DataLoader (line 211, column 10 - line 215, column 26): " + [result.constructor.name]);
      })());
    });
  };
  var loadText = function(config) {
    return function(path18) {
      if (config.strategy instanceof LocalOnly) {
        return loadLocalText(path18);
      }
      ;
      if (config.strategy instanceof RemoteOnly) {
        if (config.baseUrl instanceof Nothing) {
          return pure10(new Left(new ConfigError("RemoteOnly strategy requires baseUrl")));
        }
        ;
        if (config.baseUrl instanceof Just) {
          return loadRemoteText(config.baseUrl.value0)(path18);
        }
        ;
        throw new Error("Failed pattern match at PSD3.Shared.DataLoader (line 234, column 17 - line 236, column 40): " + [config.baseUrl.constructor.name]);
      }
      ;
      if (config.strategy instanceof LocalFirst) {
        if (config.baseUrl instanceof Nothing) {
          return loadLocalText(path18);
        }
        ;
        if (config.baseUrl instanceof Just) {
          return bind6(loadLocalText(path18))(function(localResult) {
            if (localResult instanceof Right) {
              return pure10(new Right(localResult.value0));
            }
            ;
            if (localResult instanceof Left) {
              return loadRemoteText(config.baseUrl.value0)(path18);
            }
            ;
            throw new Error("Failed pattern match at PSD3.Shared.DataLoader (line 242, column 7 - line 244, column 42): " + [localResult.constructor.name]);
          });
        }
        ;
        throw new Error("Failed pattern match at PSD3.Shared.DataLoader (line 238, column 17 - line 244, column 42): " + [config.baseUrl.constructor.name]);
      }
      ;
      if (config.strategy instanceof RemoteFirst) {
        if (config.baseUrl instanceof Nothing) {
          return loadLocalText(path18);
        }
        ;
        if (config.baseUrl instanceof Just) {
          return bind6(loadRemoteText(config.baseUrl.value0)(path18))(function(remoteResult) {
            if (remoteResult instanceof Right) {
              return pure10(new Right(remoteResult.value0));
            }
            ;
            if (remoteResult instanceof Left) {
              return loadLocalText(path18);
            }
            ;
            throw new Error("Failed pattern match at PSD3.Shared.DataLoader (line 250, column 7 - line 252, column 37): " + [remoteResult.constructor.name]);
          });
        }
        ;
        throw new Error("Failed pattern match at PSD3.Shared.DataLoader (line 246, column 18 - line 252, column 37): " + [config.baseUrl.constructor.name]);
      }
      ;
      throw new Error("Failed pattern match at PSD3.Shared.DataLoader (line 230, column 24 - line 252, column 37): " + [config.strategy.constructor.name]);
    };
  };
  var loadTextWithFallback = function(config) {
    return function(path18) {
      return bind6(loadText(config)(path18))(function(result) {
        return pure10((function() {
          if (result instanceof Right) {
            return result.value0;
          }
          ;
          if (result instanceof Left) {
            return "";
          }
          ;
          throw new Error("Failed pattern match at PSD3.Shared.DataLoader (line 258, column 10 - line 260, column 17): " + [result.constructor.name]);
        })());
      });
    };
  };
  var loadLocalJSON = function(path18) {
    return bind6(get5(json)(path18))(function(result) {
      return pure10((function() {
        if (result instanceof Left) {
          return new Left(new NetworkError("Failed to load local JSON from " + (path18 + (": " + printError(result.value0)))));
        }
        ;
        if (result instanceof Right) {
          return new Right(result.value0.body);
        }
        ;
        throw new Error("Failed pattern match at PSD3.Shared.DataLoader (line 72, column 10 - line 76, column 26): " + [result.constructor.name]);
      })());
    });
  };
  var loadJSON = function(config) {
    return function(path18) {
      if (config.strategy instanceof LocalOnly) {
        return loadLocalJSON(path18);
      }
      ;
      if (config.strategy instanceof RemoteOnly) {
        if (config.baseUrl instanceof Nothing) {
          return pure10(new Left(new ConfigError("RemoteOnly strategy requires baseUrl")));
        }
        ;
        if (config.baseUrl instanceof Just) {
          return loadRemoteJSON(config.baseUrl.value0)(path18);
        }
        ;
        throw new Error("Failed pattern match at PSD3.Shared.DataLoader (line 95, column 17 - line 97, column 40): " + [config.baseUrl.constructor.name]);
      }
      ;
      if (config.strategy instanceof LocalFirst) {
        if (config.baseUrl instanceof Nothing) {
          return loadLocalJSON(path18);
        }
        ;
        if (config.baseUrl instanceof Just) {
          return bind6(loadLocalJSON(path18))(function(localResult) {
            if (localResult instanceof Right) {
              return pure10(new Right(localResult.value0));
            }
            ;
            if (localResult instanceof Left) {
              return loadRemoteJSON(config.baseUrl.value0)(path18);
            }
            ;
            throw new Error("Failed pattern match at PSD3.Shared.DataLoader (line 103, column 7 - line 105, column 42): " + [localResult.constructor.name]);
          });
        }
        ;
        throw new Error("Failed pattern match at PSD3.Shared.DataLoader (line 99, column 17 - line 105, column 42): " + [config.baseUrl.constructor.name]);
      }
      ;
      if (config.strategy instanceof RemoteFirst) {
        if (config.baseUrl instanceof Nothing) {
          return loadLocalJSON(path18);
        }
        ;
        if (config.baseUrl instanceof Just) {
          return bind6(loadRemoteJSON(config.baseUrl.value0)(path18))(function(remoteResult) {
            if (remoteResult instanceof Right) {
              return pure10(new Right(remoteResult.value0));
            }
            ;
            if (remoteResult instanceof Left) {
              return loadLocalJSON(path18);
            }
            ;
            throw new Error("Failed pattern match at PSD3.Shared.DataLoader (line 111, column 7 - line 113, column 37): " + [remoteResult.constructor.name]);
          });
        }
        ;
        throw new Error("Failed pattern match at PSD3.Shared.DataLoader (line 107, column 18 - line 113, column 37): " + [config.baseUrl.constructor.name]);
      }
      ;
      throw new Error("Failed pattern match at PSD3.Shared.DataLoader (line 91, column 24 - line 113, column 37): " + [config.strategy.constructor.name]);
    };
  };
  var loadJSONWithFallback = function(config) {
    return function(path18) {
      return function(fallback) {
        return bind6(loadJSON(config)(path18))(function(result) {
          return pure10((function() {
            if (result instanceof Right) {
              return result.value0;
            }
            ;
            if (result instanceof Left) {
              return fallback;
            }
            ;
            throw new Error("Failed pattern match at PSD3.Shared.DataLoader (line 120, column 10 - line 122, column 23): " + [result.constructor.name]);
          })());
        });
      };
    };
  };
  var defaultConfig = /* @__PURE__ */ (function() {
    return {
      strategy: LocalOnly.value,
      baseUrl: Nothing.value
    };
  })();
  var simpleLoadJSON = function(path18) {
    return loadJSONWithFallback(defaultConfig)(path18)({
      name: "error",
      children: []
    });
  };
  var simpleLoadText = function(path18) {
    return loadTextWithFallback(defaultConfig)(path18);
  };

  // output/Component.AnimatedTreeCluster/index.js
  var show7 = /* @__PURE__ */ show(showLayoutType);
  var discard4 = /* @__PURE__ */ discard(discardUnit)(bindHalogenM);
  var bind7 = /* @__PURE__ */ bind(bindHalogenM);
  var modify_3 = /* @__PURE__ */ modify_(monadStateHalogenM);
  var get6 = /* @__PURE__ */ get(monadStateHalogenM);
  var Initialize2 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var ToggleLayout = /* @__PURE__ */ (function() {
    function ToggleLayout2() {
    }
    ;
    ToggleLayout2.value = new ToggleLayout2();
    return ToggleLayout2;
  })();
  var render3 = function(state3) {
    return div2([classes(["animated-tree-cluster-page"])])([div2([classes(["page-header"])])([h1_([text5("Animated Tree \u2194 Cluster")]), p([classes(["page-description"])])([text5("Smooth transitions between Tree (Reingold-Tilford) and Cluster (dendrogram) layouts using proper D3 data joins with stable keys.")])]), div2([classes(["controls"])])([button2([classes(["button"]), onClick(function(v2) {
      return ToggleLayout.value;
    })])([text5("Switch to " + show7(toggleLayout(state3.currentLayout)))]), p([classes(["current-layout"])])([text5("Current: " + show7(state3.currentLayout))])]), div2([classes(["viz-container"]), id3("animated-tree-cluster")])([])]);
  };
  var handleAction = function(dictMonadAff) {
    var monadEffectHalogenM2 = monadEffectHalogenM(dictMonadAff.MonadEffect0());
    var log8 = log3(monadEffectHalogenM2);
    var liftAff2 = liftAff(monadAffHalogenM(dictMonadAff));
    var liftEffect54 = liftEffect(monadEffectHalogenM2);
    return function(v2) {
      if (v2 instanceof Initialize2) {
        return discard4(log8("AnimatedTreeCluster: Initializing"))(function() {
          return discard4(liftAff2(delay(100)))(function() {
            return bind7(liftAff2(simpleLoadJSON("./data/flare-2.json")))(function(flareJson) {
              return bind7(liftEffect54(draw(flareJson)("#animated-tree-cluster")))(function(vizState) {
                return discard4(modify_3(function(v1) {
                  var $23 = {};
                  for (var $24 in v1) {
                    if ({}.hasOwnProperty.call(v1, $24)) {
                      $23[$24] = v1[$24];
                    }
                    ;
                  }
                  ;
                  $23.vizState = new Just(vizState);
                  return $23;
                }))(function() {
                  return discard4(liftEffect54(animationStep(vizState.dataTree)(vizState.linksGroup)(vizState.nodesGroup)(vizState.chartWidth)(vizState.chartHeight)(TreeLayout.value)))(function() {
                    return log8("AnimatedTreeCluster: Initialized");
                  });
                });
              });
            });
          });
        });
      }
      ;
      if (v2 instanceof ToggleLayout) {
        return bind7(get6)(function(state3) {
          var newLayout = toggleLayout(state3.currentLayout);
          return discard4(log8("Toggling to " + show7(newLayout)))(function() {
            return discard4(modify_3(function(v1) {
              var $26 = {};
              for (var $27 in v1) {
                if ({}.hasOwnProperty.call(v1, $27)) {
                  $26[$27] = v1[$27];
                }
                ;
              }
              ;
              $26.currentLayout = newLayout;
              return $26;
            }))(function() {
              if (state3.vizState instanceof Nothing) {
                return log8("No viz state available");
              }
              ;
              if (state3.vizState instanceof Just) {
                return liftEffect54(animationStep(state3.vizState.value0.dataTree)(state3.vizState.value0.linksGroup)(state3.vizState.value0.nodesGroup)(state3.vizState.value0.chartWidth)(state3.vizState.value0.chartHeight)(newLayout));
              }
              ;
              throw new Error("Failed pattern match at Component.AnimatedTreeCluster (line 105, column 5 - line 114, column 20): " + [state3.vizState.constructor.name]);
            });
          });
        });
      }
      ;
      throw new Error("Failed pattern match at Component.AnimatedTreeCluster (line 73, column 16 - line 114, column 20): " + [v2.constructor.name]);
    };
  };
  var component = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return {
          currentLayout: TreeLayout.value,
          vizState: Nothing.value
        };
      },
      render: render3,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction(dictMonadAff),
        initialize: new Just(Initialize2.value)
      })
    });
  };

  // output/CodeSnippets/index.js
  var snippet_wealthHealth_content = 'module D3.Viz.TreeAPI.WealthHealthDraw where\n\nimport Prelude\n\nimport Data.Int (floor)\nimport Data.Number (log, sqrt)\nimport Effect (Effect)\nimport PSD3.Internal.Capabilities.Selection (select, renderTree)\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_)\nimport PSD3.Internal.Selection.Types (ElementType(..), SEmpty)\nimport PSD3.AST (Tree)\nimport PSD3.AST as T\nimport PSD3.Internal.Behavior.Types (Behavior(..), MouseEventInfo)\nimport PSD3.Tooltip (showTooltip, hideTooltip)\nimport PSD3.Expr.Integration (v3Attr, v3AttrStr, v3AttrFn, v3AttrFnStr)\nimport PSD3.Expr.Expr (lit, str)\nimport Web.DOM.Element (Element)\n\n-- | Type alias for a nation data point ready for visualization\ntype NationPoint =\n  { name :: String\n  , income :: Number\n  , population :: Number\n  , lifeExpectancy :: Number\n  , region :: String -- Region name for display\n  , regionColor :: String -- Color for the region\n  }\n\n-- | Configuration for visualization dimensions and margins\ntype VizConfig =\n  { width :: Number\n  , height :: Number\n  , marginTop :: Number\n  , marginRight :: Number\n  , marginBottom :: Number\n  , marginLeft :: Number\n  }\n\ndefaultConfig :: VizConfig\ndefaultConfig =\n  { width: 960.0\n  , height: 560.0\n  , marginTop: 20.0\n  , marginRight: 20.0\n  , marginBottom: 35.0\n  , marginLeft: 40.0\n  }\n\n-- | Scale functions\nscaleX :: VizConfig -> Number -> Number\nscaleX config income =\n  let\n    -- Logarithmic scale for income ($200 to $100,000)\n    minLog = 5.298317 -- log(200)\n    maxLog = 11.512925 -- log(100000)\n    logIncome = if income > 0.0 then log income else minLog\n    normalized = (logIncome - minLog) / (maxLog - minLog)\n    rangeWidth = config.width - config.marginLeft - config.marginRight\n  in\n    config.marginLeft + (normalized * rangeWidth)\n\nscaleY :: VizConfig -> Number -> Number\nscaleY config lifeExpectancy =\n  let\n    -- Linear scale for life expectancy (14 to 86 years)\n    minLife = 14.0\n    maxLife = 86.0\n    normalized = (lifeExpectancy - minLife) / (maxLife - minLife)\n    rangeHeight = config.height - config.marginTop - config.marginBottom\n  in\n    config.height - config.marginBottom - (normalized * rangeHeight)\n\nscaleRadius :: Number -> Number\nscaleRadius population =\n  let\n    -- Square root scale for population (area proportional to population)\n    minRadius = 3.0\n    maxRadius = 80.0\n    maxPop = 5000000000.0 -- 5 billion\n    normalized = population / maxPop\n    scaled = sqrt normalized * maxRadius\n  in\n    max minRadius scaled\n\n-- | Format income values for axis labels\nformatIncome :: Number -> String\nformatIncome value\n  | value >= 1000.0 = "$" <> show (floor (value / 1000.0)) <> "k"\n  | otherwise = "$" <> show (floor value)\n\n-- | Tick values for axes\nxTicks :: Array Number\nxTicks = [ 200.0, 500.0, 1000.0, 2000.0, 5000.0, 10000.0, 20000.0, 50000.0, 100000.0 ]\n\nyTicks :: Array Number\nyTicks = [ 20.0, 30.0, 40.0, 50.0, 60.0, 70.0, 80.0 ]\n\n-- | Build vertical grid line\nverticalGridLine :: VizConfig -> Number -> Tree NationPoint\nverticalGridLine config tickValue =\n  T.elem Line\n    [ v3Attr "x1" (lit (0.5 + scaleX config tickValue))\n    , v3Attr "x2" (lit (0.5 + scaleX config tickValue))\n    , v3Attr "y1" (lit config.marginTop)\n    , v3Attr "y2" (lit (config.height - config.marginBottom))\n    ]\n\n-- | Build horizontal grid line\nhorizontalGridLine :: VizConfig -> Number -> Tree NationPoint\nhorizontalGridLine config tickValue =\n  T.elem Line\n    [ v3Attr "y1" (lit (0.5 + scaleY config tickValue))\n    , v3Attr "y2" (lit (0.5 + scaleY config tickValue))\n    , v3Attr "x1" (lit config.marginLeft)\n    , v3Attr "x2" (lit (config.width - config.marginRight))\n    ]\n\n-- | Build x-axis tick mark and label\nxAxisTick :: VizConfig -> Number -> Tree NationPoint\nxAxisTick config tickValue =\n  T.named Group "x-tick" []\n    `T.withChildren`\n      [ T.elem Line\n          [ v3Attr "x1" (lit (scaleX config tickValue))\n          , v3Attr "x2" (lit (scaleX config tickValue))\n          , v3Attr "y1" (lit (config.height - config.marginBottom))\n          , v3Attr "y2" (lit (config.height - config.marginBottom + 6.0))\n          , v3AttrStr "stroke" (str "#333")\n          , v3Attr "stroke-width" (lit 1.0)\n          ]\n      , T.elem Text\n          [ v3Attr "x" (lit (scaleX config tickValue))\n          , v3Attr "y" (lit (config.height - config.marginBottom + 15.0))\n          , v3AttrStr "text-anchor" (str "middle")\n          , v3Attr "font-size" (lit 10.0)\n          , v3AttrStr "fill" (str "#333")\n          , v3AttrStr "textContent" (str (formatIncome tickValue))\n          ]\n      ]\n\n-- | Build y-axis tick mark and label\nyAxisTick :: VizConfig -> Number -> Tree NationPoint\nyAxisTick config tickValue =\n  T.named Group "y-tick" []\n    `T.withChildren`\n      [ T.elem Line\n          [ v3Attr "x1" (lit (config.marginLeft - 6.0))\n          , v3Attr "x2" (lit config.marginLeft)\n          , v3Attr "y1" (lit (scaleY config tickValue))\n          , v3Attr "y2" (lit (scaleY config tickValue))\n          , v3AttrStr "stroke" (str "#333")\n          , v3Attr "stroke-width" (lit 1.0)\n          ]\n      , T.elem Text\n          [ v3Attr "x" (lit (config.marginLeft - 10.0))\n          , v3Attr "y" (lit (scaleY config tickValue + 3.0))\n          , v3AttrStr "text-anchor" (str "end")\n          , v3Attr "font-size" (lit 10.0)\n          , v3AttrStr "fill" (str "#333")\n          , v3AttrStr "textContent" (str (show $ floor tickValue))\n          ]\n      ]\n\n-- | Initialize the visualization - creates SVG structure and returns update function\ninitWealthHealth :: String -> Effect (Array NationPoint -> Effect Unit)\ninitWealthHealth selector = runD3v2M do\n  container <- select selector :: _ (D3v2Selection_ SEmpty Element Unit)\n\n  let config = defaultConfig\n\n  -- Build the static visualization tree (without data-bound circles)\n  let\n    staticTree :: Tree NationPoint\n    staticTree =\n      T.named SVG "svg"\n        [ v3Attr "width" (lit config.width)\n        , v3Attr "height" (lit config.height)\n        , v3AttrStr "viewBox" (str ("0 0 " <> show config.width <> " " <> show config.height))\n        , v3AttrStr "class" (str "wealth-health-viz")\n        ]\n        `T.withChildren`\n          [ -- Grid lines\n            T.named Group "grid"\n              [ v3AttrStr "stroke" (str "currentColor")\n              , v3Attr "stroke-opacity" (lit 0.1)\n              ]\n              `T.withChildren`\n                ( map (verticalGridLine config) xTicks <>\n                    map (horizontalGridLine config) yTicks\n                )\n\n          -- X-axis\n          , T.named Group "x-axis" []\n              `T.withChildren`\n                [ T.elem Line\n                    [ v3Attr "x1" (lit config.marginLeft)\n                    , v3Attr "y1" (lit (config.height - config.marginBottom))\n                    , v3Attr "x2" (lit (config.width - config.marginRight))\n                    , v3Attr "y2" (lit (config.height - config.marginBottom))\n                    , v3AttrStr "stroke" (str "#333")\n                    , v3Attr "stroke-width" (lit 1.5)\n                    ]\n                ]\n\n          -- X-axis ticks\n          , T.named Group "x-ticks" []\n              `T.withChildren` map (xAxisTick config) xTicks\n\n          -- X-axis label\n          , T.elem Text\n              [ v3Attr "x" (lit (config.width / 2.0))\n              , v3Attr "y" (lit (config.height - 5.0))\n              , v3AttrStr "text-anchor" (str "middle")\n              , v3Attr "font-size" (lit 14.0)\n              , v3AttrStr "fill" (str "#333")\n              , v3AttrStr "textContent" (str "Income per Person (GDP/capita, PPP$ inflation-adjusted)")\n              ]\n\n          -- Y-axis\n          , T.named Group "y-axis" []\n              `T.withChildren`\n                [ T.elem Line\n                    [ v3Attr "x1" (lit config.marginLeft)\n                    , v3Attr "y1" (lit config.marginTop)\n                    , v3Attr "x2" (lit config.marginLeft)\n                    , v3Attr "y2" (lit (config.height - config.marginBottom))\n                    , v3AttrStr "stroke" (str "#333")\n                    , v3Attr "stroke-width" (lit 1.5)\n                    ]\n                ]\n\n          -- Y-axis ticks\n          , T.named Group "y-ticks" []\n              `T.withChildren` map (yAxisTick config) yTicks\n\n          -- Y-axis label\n          , T.elem Text\n              [ v3Attr "x" (lit 15.0)\n              , v3Attr "y" (lit (config.height / 2.0))\n              , v3AttrStr "text-anchor" (str "middle")\n              , v3Attr "font-size" (lit 14.0)\n              , v3AttrStr "fill" (str "#333")\n              , v3AttrStr "textContent" (str "Life Expectancy (years)")\n              ]\n\n          -- Empty group for nations (will be populated by update function)\n          , T.named Group "nations-container" [ v3AttrStr "class" (str "nations") ] `T.withChildren` []\n          ]\n\n  -- Render the static structure\n  _ <- renderTree container staticTree\n\n  -- Return the update function using declarative TreeAPI\n  pure $ \\nations -> runD3v2M do\n    -- Select the nations container\n    nationsContainer <- select "#wealth-health-viz .nations" :: _ (D3v2Selection_ SEmpty Element Unit)\n\n    -- Build nations tree with declarative data join and behaviors\n    -- TreeAPI handles enter/update/exit automatically\n    let\n      nationsTree :: Tree NationPoint\n      nationsTree =\n        T.joinData "nations" "circle" nations $ \\_ ->\n          T.elem Circle\n            [ v3AttrFn "cx" ((\\n -> scaleX config n.income) :: NationPoint -> Number)\n            , v3AttrFn "cy" ((\\n -> scaleY config n.lifeExpectancy) :: NationPoint -> Number)\n            , v3AttrFn "r" ((\\n -> scaleRadius n.population) :: NationPoint -> Number)\n            , v3AttrFnStr "fill" ((_.regionColor) :: NationPoint -> String)\n            , v3Attr "fill-opacity" (lit 0.7)\n            , v3AttrStr "stroke" (str "#333")\n            , v3Attr "stroke-width" (lit 0.5)\n            , v3AttrStr "class" (str "nation-circle")\n            ]\n            `T.withBehaviors`\n              [ -- Tooltip on mouse enter\n                MouseEnterWithInfo \\(info :: MouseEventInfo NationPoint) -> do\n                  let nation = info.datum\n                  let\n                    content = "<strong>" <> nation.name <> "</strong><br/>"\n                      <> "Region: "\n                      <> nation.region\n                      <> "<br/>"\n                      <> "Income: $"\n                      <> show (floor nation.income)\n                      <> "<br/>"\n                      <> "Life Expectancy: "\n                      <> show (floor nation.lifeExpectancy)\n                      <> " years<br/>"\n                      <> "Population: "\n                      <> formatPopulation nation.population\n                  showTooltip content info.clientX info.clientY\n              , -- Hide tooltip on mouse leave\n                MouseLeaveWithInfo \\(_ :: MouseEventInfo NationPoint) -> hideTooltip\n              ]\n\n    -- Render the tree (handles enter/update/exit internally)\n    _ <- renderTree nationsContainer nationsTree\n\n    pure unit\n\n-- | Format population for display\nformatPopulation :: Number -> String\nformatPopulation n\n  | n >= 1000000000.0 = show (floor (n / 1000000000.0)) <> "B"\n  | n >= 1000000.0 = show (floor (n / 1000000.0)) <> "M"\n  | n >= 1000.0 = show (floor (n / 1000.0)) <> "K"\n  | otherwise = show (floor n)\n';
  var snippet_v3Transition_content = '-- | Expression Transition Demo - Declarative Transitions with v3 Expressions\n-- |\n-- | This demonstrates the fully declarative approach to transitions:\n-- | - sceneJoin defines enter behavior with initial state + transition\n-- | - Template defines final state using v3 expressions\n-- | - No Map lookup, no unsafeCoerce - type flows through the tree\n-- |\n-- | Key insight: Transitions belong IN the tree structure, not after it.\n-- | This keeps the datum type chain intact.\nmodule D3.Viz.TreeAPI.V3TransitionDemo where\n\nimport Prelude hiding (add)\n\nimport Data.Maybe (Maybe(..))\nimport Data.Time.Duration (Milliseconds(..))\nimport Effect (Effect)\nimport Effect.Class (liftEffect)\nimport Effect.Console as Console\nimport Type.Proxy (Proxy(..))\n\n-- v2 infrastructure\nimport PSD3.Expr.Integration (v3Attr, v3AttrStr, v3AttrFn, v3AttrFnStr)\nimport PSD3.Internal.Capabilities.Selection (select, renderTree)\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_)\nimport PSD3.Internal.Selection.Types (ElementType(..), SEmpty)\nimport PSD3.Internal.Transition.Types (staggeredTransition)\nimport PSD3.AST (Tree)\nimport PSD3.AST as T\nimport Web.DOM.Element (Element)\n\n-- v3 DSL\nimport PSD3.Expr.Expr (class NumExpr, lit, str)\nimport PSD3.Expr.Datum (class DatumExpr, field)\nimport PSD3.Expr.Sugar ((*:), (+:))\nimport PSD3.Expr.Interpreter.CodeGen (CodeGen, runCodeGen)\nimport PSD3.Expr.Interpreter.Eval (EvalD, runEvalD)\n\n-- =============================================================================\n-- Data Type\n-- =============================================================================\n\ntype CircleData =\n  { id :: Int\n  , x :: Number -- X position\n  , y :: Number -- Y position\n  , value :: Number -- 0 to 100 (affects radius and color)\n  }\n\ntype CircleRow = (id :: Int, x :: Number, y :: Number, value :: Number)\n\n-- Circle data with positions spread out\ncircleData :: Array CircleData\ncircleData =\n  [ { id: 1, x: 80.0, y: 80.0, value: 30.0 }\n  , { id: 2, x: 160.0, y: 220.0, value: 60.0 }\n  , { id: 3, x: 250.0, y: 60.0, value: 90.0 }\n  , { id: 4, x: 340.0, y: 200.0, value: 45.0 }\n  , { id: 5, x: 420.0, y: 100.0, value: 75.0 }\n  ]\n\n-- =============================================================================\n-- v3 Expressions (Polymorphic!)\n-- =============================================================================\n\n-- | X position from datum\nposX :: forall repr. NumExpr repr => DatumExpr repr CircleRow => repr Number\nposX = field (Proxy :: Proxy "x")\n\n-- | Y position from datum\nposY :: forall repr. NumExpr repr => DatumExpr repr CircleRow => repr Number\nposY = field (Proxy :: Proxy "y")\n\n-- | Radius based on value: (value * 0.2) + 8\n-- | Higher values = larger circles\ncircleRadius :: forall repr. NumExpr repr => DatumExpr repr CircleRow => repr Number\ncircleRadius = valueField *: 0.2 +: 8.0\n  where\n  valueField = field (Proxy :: Proxy "value")\n\n-- =============================================================================\n-- v3\u2192v2 Integration\n-- =============================================================================\n\n-- | Evaluate v3 expression with datum (for templates)\nevalExpr :: forall a. EvalD CircleData a -> CircleData -> a\nevalExpr expr datum = runEvalD expr datum 0\n\n-- =============================================================================\n-- Browser Demo\n-- =============================================================================\n\nv3TransitionDemo :: Effect Unit\nv3TransitionDemo = runD3v2M do\n  container <- select "#viz" :: _ (D3v2Selection_ SEmpty Element Unit)\n\n  -- Fully declarative tree with transitions INSIDE the structure\n  -- No Map lookup needed - type flows through the entire tree\n  let\n    tree :: Tree CircleData\n    tree =\n      T.named SVG "svg"\n        [ v3Attr "width" (lit 500.0)\n        , v3Attr "height" (lit 300.0)\n        , v3AttrStr "viewBox" (str "0 0 500 300")\n        , v3AttrStr "id" (str "v3-transition-svg")\n        , v3AttrStr "class" (str "v3-demo")\n        ]\n        `T.withChild`\n          -- sceneJoin: template = final state, enterBehavior = initial state + transition\n          ( T.sceneJoin "circles" "circle" circleData\n              -- Template defines FINAL state (where elements end up)\n              ( \\d -> T.elem Circle\n                  [ v3Attr "cx" (lit (evalExpr posX d)) -- v3: final X position\n                  , v3Attr "cy" (lit (evalExpr posY d)) -- v3: final Y position\n                  , v3Attr "r" (lit (evalExpr circleRadius d)) -- v3: radius from value\n                  , v3AttrStr "fill" (str "#e67e22") -- final color (orange)\n                  , v3AttrStr "stroke" (str "white")\n                  , v3Attr "stroke-width" (lit 2.0)\n                  ]\n              )\n              -- Behaviors: enter starts at center, transitions to final with stagger\n              { keyFn: Nothing  -- No updates in this demo\n              , enterBehavior: Just\n                  { initialAttrs:\n                      [ v3Attr "cx" (lit 250.0) -- start at center X\n                      , v3Attr "cy" (lit 150.0) -- start at center Y\n                      , v3AttrStr "fill" (str "#3498db") -- start color (blue)\n                      ]\n                  , transition: Just (staggeredTransition (Milliseconds 600.0) 100.0)\n                  -- Each element delays 100ms more than previous\n                  }\n              , updateBehavior: Nothing\n              , exitBehavior: Nothing\n              }\n          )\n\n  -- Log what we\'re demonstrating\n  liftEffect do\n    Console.log "=== Expression Declarative Staggered Transition Demo ==="\n    Console.log ""\n    Console.log "v3 Expressions (final positions):"\n    Console.log $ "  posX         \u2192 " <> runCodeGen (posX :: CodeGen Number)\n    Console.log $ "  posY         \u2192 " <> runCodeGen (posY :: CodeGen Number)\n    Console.log $ "  circleRadius \u2192 " <> runCodeGen (circleRadius :: CodeGen Number)\n    Console.log ""\n    Console.log "Approach: Fully declarative with sceneJoin + staggeredTransition"\n    Console.log "  \u2022 Template defines final state (v3 expressions)"\n    Console.log "  \u2022 enterBehavior defines initial state + staggered transition"\n    Console.log "  \u2022 staggeredTransition: 600ms duration, 100ms stagger per element"\n    Console.log "  \u2022 No Map lookup, no unsafeCoerce - type flows through tree"\n    Console.log ""\n\n  -- Render - transitions happen automatically!\n  _ <- renderTree container tree\n\n  liftEffect do\n    Console.log "Staggered transition triggered by renderTree!"\n    Console.log ""\n    Console.log "Key insights:"\n    Console.log "  1. Transitions belong IN the tree structure"\n    Console.log "  2. staggerDelay in TransitionConfig handles per-element delays"\n    Console.log "  3. The datum type chain stays intact from definition to render"\n';
  var snippet_v3Parabola_content = '-- | Expression DSL Parabola Demo - Live Browser Rendering\n-- |\n-- | This demonstrates the v3 "Finally Tagless" DSL rendering to actual DOM via D3.\n-- |\n-- | The same polymorphic expressions produce:\n-- |   - Runtime values for D3 (EvalD)\n-- |   - Source code for display (CodeGen)\n-- |   - SVG strings for server-side (SVGD) - not shown here\n-- |\n-- | This is the "money shot" - same expression, three different outputs!\nmodule D3.Viz.TreeAPI.V3ParabolaDemo where\n\nimport Prelude hiding (add)\n\nimport Data.Map as Map\nimport Data.Maybe (Maybe(..))\nimport Effect (Effect)\nimport Effect.Class (liftEffect)\nimport Effect.Console as Console\nimport Type.Proxy (Proxy(..))\n\n-- v2 infrastructure for D3 rendering\nimport PSD3.Expr.Integration (v3Attr, v3AttrStr, v3AttrFn, v3AttrFnStr)\nimport PSD3.Internal.Capabilities.Selection (select, renderTree)\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_)\nimport PSD3.Internal.Selection.Types (ElementType(..), SEmpty)\nimport PSD3.AST (Tree)\nimport PSD3.AST as T\nimport Web.DOM.Element (Element)\n\n-- v3 DSL imports\nimport PSD3.Expr.Expr (class NumExpr, lit, add, str)\nimport PSD3.Expr.Datum (class DatumExpr, field)\nimport PSD3.Expr.Sugar ((*:), (+:))\nimport PSD3.Expr.Interpreter.CodeGen (CodeGen, runCodeGen)\nimport PSD3.Expr.Interpreter.Eval (EvalD, runEvalD)\n\n-- =============================================================================\n-- Data Type\n-- =============================================================================\n\ntype ParabolaPoint = { x :: Number, y :: Number }\n\ntype ParabolaRow = ( x :: Number, y :: Number )\n\n-- Sample data: y = x\xB2\nparabolaData :: Array ParabolaPoint\nparabolaData =\n  [ { x: -10.0, y: 100.0 }\n  , { x: -7.5, y: 56.25 }\n  , { x: -5.0, y: 25.0 }\n  , { x: -2.5, y: 6.25 }\n  , { x: 0.0, y: 0.0 }\n  , { x: 2.5, y: 6.25 }\n  , { x: 5.0, y: 25.0 }\n  , { x: 7.5, y: 56.25 }\n  , { x: 10.0, y: 100.0 }\n  ]\n\n-- =============================================================================\n-- v3 Expressions (Polymorphic!)\n-- =============================================================================\n\n-- | Scale X coordinate: (x + 5) * 30 + 50\n-- |\n-- | This expression is polymorphic over ANY repr that implements the typeclasses.\n-- | It can produce: Number (EvalD), String (CodeGen), String (SVGD)\nscaleX :: forall repr. NumExpr repr => DatumExpr repr ParabolaRow => repr Number\nscaleX = (xField +: 5.0) *: 30.0 +: 50.0\n  where\n    xField = field (Proxy :: Proxy "x")\n\n-- | Scale Y coordinate: 200 - (y * 1.8)\nscaleY :: forall repr. NumExpr repr => DatumExpr repr ParabolaRow => repr Number\nscaleY = add (lit 200.0) (yField *: (-1.8))\n  where\n    yField = field (Proxy :: Proxy "y")\n\n-- | Point radius based on distance from origin\n-- | Larger radius for points near the vertex\npointRadius :: forall repr. NumExpr repr => DatumExpr repr ParabolaRow => repr Number\npointRadius = add (lit 6.0) (yField *: (-0.05))\n  where\n    yField = field (Proxy :: Proxy "y")\n\n-- =============================================================================\n-- v3\u2192v2 Integration: Evaluate expressions with datum\n-- =============================================================================\n\n-- | Evaluate a v3 expression with a datum to get a concrete value\n-- | This bridges v3 polymorphic expressions \u2192 v2 static attributes\nevalExpr :: forall a. EvalD ParabolaPoint a -> ParabolaPoint -> a\nevalExpr expr datum = runEvalD expr datum 0\n\n-- =============================================================================\n-- Browser Demo\n-- =============================================================================\n\nv3ParabolaDemo :: Effect Unit\nv3ParabolaDemo = runD3v2M do\n  container <- select "#viz" :: _ (D3v2Selection_ SEmpty Element Unit)\n\n  -- Define the visualization tree using v3 expressions\n  -- The template callback receives each datum, we evaluate v3 expressions with it\n  let tree :: Tree ParabolaPoint\n      tree =\n        T.named SVG "svg"\n          [ v3Attr "width" (lit 400.0)\n          , v3Attr "height" (lit 250.0)\n          , v3AttrStr "viewBox" (str "0 0 400 250")\n          , v3AttrStr "id" (str "v3-parabola-svg")\n          , v3AttrStr "class" (str "v3-demo")\n          ]\n          `T.withChild`\n            (T.joinData "points" "circle" parabolaData $ \\d ->\n              -- v3 expressions are evaluated with datum \u2192 static v2 attributes\n              T.elem Circle\n                [ v3Attr "cx" (lit (evalExpr scaleX d))       -- v3 expression evaluated!\n                , v3Attr "cy" (lit (evalExpr scaleY d))       -- v3 expression evaluated!\n                , v3Attr "r" (lit (evalExpr pointRadius d))  -- v3 expression evaluated!\n                , v3AttrStr "fill" (str "#3498db")\n                , v3AttrStr "stroke" (str "white")\n                , v3Attr "stroke-width" (lit 2.0)\n                ])\n\n  -- Render to DOM via D3!\n  selections <- renderTree container tree\n\n  -- Log the "money shot" - same expressions, different outputs\n  liftEffect do\n    Console.log "=== Expression DSL Parabola Demo: Live D3 Rendering ==="\n    Console.log ""\n    Console.log "v3 Expressions (polymorphic definitions):"\n    Console.log "  scaleX = (x + 5) * 30 + 50"\n    Console.log "  scaleY = 200 + (y * -1.8)"\n    Console.log ""\n    Console.log "CodeGen output (PureScript source):"\n    Console.log $ "  scaleX \u2192 " <> runCodeGen (scaleX :: CodeGen Number)\n    Console.log $ "  scaleY \u2192 " <> runCodeGen (scaleY :: CodeGen Number)\n    Console.log ""\n    Console.log "EvalD output (D3 runtime values for sample point):"\n    let pt = { x: -10.0, y: 100.0 }  -- Sample point\n    let cxVal = runEvalD scaleX pt 0\n    let cyVal = runEvalD scaleY pt 0\n    Console.log $ "  { x: " <> show pt.x <> ", y: " <> show pt.y <> " } \u2192 cx=" <> show cxVal <> ", cy=" <> show cyVal\n    Console.log ""\n    Console.log "Same expression, three outputs:"\n    Console.log "  \u2022 CodeGen: produces PureScript source code"\n    Console.log "  \u2022 EvalD: produces runtime Number values for D3"\n    Console.log "  \u2022 SVGD: produces SVG attribute strings (server-side)"\n    Console.log ""\n\n    case Map.lookup "points" selections of\n      Just _ -> Console.log "\u2713 Points rendered to DOM via D3 (check browser!)"\n      Nothing -> Console.log "\u2717 No points selection found"\n';
  var snippet_v3GUP_content = `-- | Expression DSL General Update Pattern Demo
-- |
-- | The classic D3 "letters" example reimagined with:
-- | - v3 polymorphic expressions for computed attributes
-- | - sceneJoin with declarative enter/update/exit behaviors
-- | - Staggered transitions for visual appeal
-- |
-- | Data changes trigger the full GUP cycle:
-- | - ENTER: New letters fade in from above
-- | - UPDATE: Existing letters slide to new positions
-- | - EXIT: Removed letters fade out and drop
module D3.Viz.TreeAPI.V3GUPDemo
  ( v3GUPDemo
  , updateWithLetters
  , initV3GUP
  , LetterDatum
  ) where

import Prelude hiding (add)

import Data.Array as Array
import Data.Int (toNumber)
import Data.Maybe (Maybe(..))
import Data.String.CodeUnits as SCU
import Data.Time.Duration (Milliseconds(..))
import Effect (Effect)
import Effect.Class (liftEffect)
import Effect.Console as Console
import Type.Proxy (Proxy(..))

-- v2 infrastructure
import PSD3.Internal.Attribute (Attribute)
import PSD3.Expr.Friendly (num, text, attr, from, viewBox, width, height, x, y, fill, opacity, fontSize, textAnchor, dominantBaseline, textContent)
import PSD3.Internal.Capabilities.Selection (select, renderTree)
import PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_)
import PSD3.Internal.Selection.Types (ElementType(..), SEmpty)
import PSD3.Internal.Transition.Types (Easing(..), transitionWith)
import PSD3.AST (Tree)
import PSD3.AST as T
import Web.DOM.Element (Element)

-- v3 DSL
import PSD3.Expr.Expr (class NumExpr)
import PSD3.Expr.Datum (class DatumExpr, field)
import PSD3.Expr.Sugar ((*:), (+:))
import PSD3.Expr.Interpreter.CodeGen (CodeGen, runCodeGen)
import PSD3.Expr.Interpreter.Eval (EvalD, runEvalD)

-- =============================================================================
-- Data Type
-- =============================================================================

-- | Each letter has an index (for positioning) and the character
type LetterDatum =
  { letter :: String
  , index :: Number  -- Number for v3 expression compatibility
  }

type LetterRow = (letter :: String, index :: Number)

-- =============================================================================
-- v3 Expressions (Polymorphic!)
-- =============================================================================

-- | X position based on index: index * 40 + 50
letterX :: forall repr. NumExpr repr => DatumExpr repr LetterRow => repr Number
letterX = indexField *: 40.0 +: 50.0
  where
    indexField = field (Proxy :: Proxy "index")

-- | Y position (constant for update state)
letterY :: Number
letterY = 100.0

-- =============================================================================
-- v3 -> v2 Integration
-- =============================================================================

-- | Evaluate v3 expression with datum
evalExpr :: forall a. EvalD LetterDatum a -> LetterDatum -> a
evalExpr expr datum = runEvalD expr datum 0

-- =============================================================================
-- GUP Tree with Full Enter/Update/Exit
-- =============================================================================

-- | Create the GUP tree for letters
-- |
-- | ENTER: Letters start above (y=20), invisible, then fade in and drop to y=100
-- | UPDATE: Letters slide horizontally to new positions
-- | EXIT: Letters fade out and drop below (y=180)
createLettersTree :: Array LetterDatum -> Tree LetterDatum
createLettersTree letters =
  T.sceneJoin "letters" "text" letters
    -- Template: FINAL state for each letter (where they end up after enter/update)
    (\\d -> T.elem Text
      [ x $ num (evalExpr letterX d)   -- v3: computed X position
      , y $ num letterY                -- Final Y position
      , fontSize $ num 32.0
      , textAnchor $ text "middle"
      , dominantBaseline $ text "middle"
      , fill $ text "#2c3e50"
      , opacity $ num 1.0
      -- The text content is set via a special TextContent attribute
      , textContent $ text d.letter
      ])
    -- Behaviors for enter/update/exit
    { keyFn: Just _.letter       -- Identity by letter, not by index!
    , enterBehavior: Just
        { initialAttrs:
            [ y $ num 20.0              -- Start above
            , opacity $ num 0.0         -- Start invisible
            , fill $ text "#27ae60"      -- Green for entering
            ]
        , transition: Just $ transitionWith
            { duration: Milliseconds 750.0
            , delay: Nothing
            , staggerDelay: Just 50.0  -- Stagger enter
            , easing: Just BounceOut   -- Bouncy entrance!
            }
        }
    , updateBehavior: Just
        { attrs:
            -- Update attributes (slide to new position)
            [ from "x" (\\d' -> evalExpr letterX d')
            , y $ num letterY
            , fill $ text "#2c3e50"  -- Dark for stable
            , opacity $ num 1.0
            ]
        , transition: Just $ transitionWith
            { duration: Milliseconds 500.0
            , delay: Nothing
            , staggerDelay: Just 30.0  -- Stagger update
            , easing: Just CubicInOut
            }
        }
    , exitBehavior: Just
        { attrs:
            [ y $ num 180.0             -- Drop below
            , opacity $ num 0.0         -- Fade out
            , fill $ text "#e74c3c"      -- Red for exiting
            ]
        , transition: Just $ transitionWith
            { duration: Milliseconds 500.0
            , delay: Nothing
            , staggerDelay: Just 40.0  -- Stagger exit
            , easing: Just CubicIn
            }
        }
    }

-- =============================================================================
-- Public API
-- =============================================================================

-- | Initialize the GUP demo - creates SVG container and renders initial letters
v3GUPDemo :: Effect Unit
v3GUPDemo = do
  Console.log "=== Expression DSL General Update Pattern Demo ==="
  Console.log ""
  Console.log "v3 Expression for X position:"
  Console.log $ "  letterX = " <> runCodeGen (letterX :: CodeGen Number)
  Console.log ""
  Console.log "Starting with: A B C D E F G"
  Console.log ""

  -- Create the SVG container first
  runD3v2M do
    container <- select "#viz" :: _ (D3v2Selection_ SEmpty Element Unit)
    let svgTree :: Tree Unit
        svgTree =
          T.named SVG "svg"
            [ width $ num 600.0
            , height $ num 200.0
            , viewBox 0.0 0.0 600.0 200.0
            , attr "id" $ text "v3-gup-svg"
            , attr "class" $ text "v3-gup-demo"
            ]
            \`T.withChild\`
              T.elem Group []  -- Empty group placeholder
    _ <- renderTree container svgTree
    pure unit

  -- Initial render with ABCDEFG
  updateWithLetters "ABCDEFG"

-- | Update the visualization with a new set of letters
-- |
-- | This triggers the full GUP cycle:
-- | - Letters not in old set: ENTER (fade in from above)
-- | - Letters in both sets: UPDATE (slide to new position)
-- | - Letters not in new set: EXIT (fade out and drop)
updateWithLetters :: String -> Effect Unit
updateWithLetters letterString = runD3v2M do
  -- Select into the existing SVG (not #viz)
  svg <- select "#v3-gup-svg" :: _ (D3v2Selection_ SEmpty Element Unit)

  -- Convert string to array of LetterDatum with indices
  let letters = Array.mapWithIndex
        (\\i c -> { letter: SCU.singleton c, index: toNumber i })
        (SCU.toCharArray letterString)

  liftEffect $ Console.log $ "Updating to: " <> letterString <> " (" <> show (Array.length letters) <> " letters)"

  -- Just the letters tree - renders INTO the existing SVG
  let tree :: Tree LetterDatum
      tree = createLettersTree letters

  -- Render - sceneJoin handles enter/update/exit automatically!
  _ <- renderTree svg tree

  liftEffect do
    Console.log "GUP cycle complete!"
    Console.log "  - New letters entered (green, bounced in from above)"
    Console.log "  - Existing letters updated (slid to new positions)"
    Console.log "  - Removed letters exited (red, faded and dropped)"

-- | Initialize the V3 GUP demo in a given container
-- | Returns an update function that accepts an array of characters
-- | Compatible with the GUPv2 API for drop-in replacement
initV3GUP :: String -> Effect (Array Char -> Effect Unit)
initV3GUP containerSelector = do
  -- Create unique SVG ID based on selector
  let svgId = "v3-gup-svg-" <> filterAlphaNum containerSelector
      svgSelector = "#" <> svgId

  -- Create the SVG container
  runD3v2M do
    container <- select containerSelector :: _ (D3v2Selection_ SEmpty Element Unit)
    let svgTree :: Tree Unit
        svgTree =
          T.named SVG "svg"
            [ width $ num 800.0
            , height $ num 500.0
            , viewBox 0.0 (-50.0) 800.0 500.0
            , attr "id" $ text svgId
            , attr "class" $ text "v3-gup-demo d3svg gup"
            ]
            \`T.withChild\`
              T.elem Group []  -- Empty group placeholder
    _ <- renderTree container svgTree
    pure unit

  -- Return update function
  pure \\letters -> runD3v2M do
    svg <- select svgSelector :: _ (D3v2Selection_ SEmpty Element Unit)

    -- Convert Char array to LetterDatum array with indices
    let letterData = Array.mapWithIndex
          (\\i c -> { letter: SCU.singleton c, index: toNumber i })
          letters

    -- Render the letters tree
    let tree :: Tree LetterDatum
        tree = createLettersTree letterData

    _ <- renderTree svg tree
    pure unit

-- | Filter string to alphanumeric characters only (for ID generation)
filterAlphaNum :: String -> String
filterAlphaNum s = SCU.fromCharArray $ Array.filter isAlphaNum (SCU.toCharArray s)
  where
    isAlphaNum c =
      (c >= 'a' && c <= 'z') ||
      (c >= 'A' && c <= 'Z') ||
      (c >= '0' && c <= '9')
`;
  var snippet_treemap_content = 'module D3.Viz.TreeAPI.TreemapViz where\n\nimport Prelude\n\nimport Data.Array as Array\nimport Data.Either (Either(..))\nimport Data.Maybe (Maybe(..))\nimport Effect (Effect)\nimport Effect.Aff (launchAff_)\nimport Effect.Class (liftEffect)\nimport Effect.Console as Console\nimport PSD3.Shared.Data (HierData, getName, getValue, getChildren, loadDataFile, DataFile(..), parseFlareJson)\nimport DataViz.Layout.Hierarchy.Core (hierarchy, sum) as H\nimport DataViz.Layout.Hierarchy.Types (ValuedNode(..))\nimport DataViz.Layout.Hierarchy.Treemap (TreemapNode(..), defaultTreemapConfig, treemap, squarify, phi)\nimport PSD3.Expr.Friendly (num, text, attr, viewBox, width, height, x, y, fill, stroke, strokeWidth, textAnchor, fontSize, textContent)\nimport PSD3.Internal.Capabilities.Selection (select, renderTree)\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_)\nimport PSD3.Internal.Selection.Types (ElementType(..), SEmpty)\nimport PSD3.AST as T\nimport Web.DOM.Element (Element)\n\n-- | Color palette\ncolors :: Array String\ncolors = [ "#e7ba52", "#c7c7c7", "#aec7e8", "#1f77b4", "#9467bd" ]\n\ngetColor :: Int -> String\ngetColor depth = case colors Array.!! (depth `mod` Array.length colors) of\n  Just c -> c\n  Nothing -> "#cccccc"\n\n-- | Get all leaves\ngetLeaves :: forall a. TreemapNode a -> Array (TreemapNode a)\ngetLeaves node@(TNode n) =\n  if Array.length n.children == 0 then [ node ]\n  else n.children >>= getLeaves\n\n-- | Map over ValuedNode to transform the data type\nmapValuedNode :: forall a b. (a -> b) -> ValuedNode a -> ValuedNode b\nmapValuedNode f (VNode n) =\n  VNode\n    { data_: f n.data_\n    , depth: n.depth\n    , height: n.height\n    , parent: Nothing -- Parent references are dropped\n    , children: map (mapValuedNode f) n.children\n    , value: n.value\n    }\n\n-- | Draw treemap\ndrawTreemap :: String -> HierData -> Effect Unit\ndrawTreemap selector flareData = runD3v2M do\n  container <- select selector :: _ (D3v2Selection_ SEmpty Element Unit)\n\n  -- Reduced from 900x600 to fit within tutorial-section max-width (832px)\n  let chartWidth = 750.0\n  let chartHeight = 500.0\n\n  -- Build hierarchy using HierData directly, then map to extract names\n  let h = H.hierarchy flareData getChildren\n  let valued = H.sum h getValue\n\n  -- Map to convert HierData to String (just the name)\n  let stringValued = mapValuedNode getName valued\n\n  -- Apply treemap layout\n  let\n    config = defaultTreemapConfig\n      { size = { width: chartWidth, height: chartHeight }\n      , tile = squarify phi\n      }\n  let layout = treemap config stringValued\n  let leaves = getLeaves layout\n\n  liftEffect $ Console.log $ "Rendering treemap: " <> show (Array.length leaves) <> " rectangles"\n\n  -- Build tree\n  let\n    tree :: T.Tree (TreemapNode String)\n    tree =\n      T.named SVG "svg"\n        [ width $ num chartWidth\n        , height $ num chartHeight\n        , viewBox 0.0 0.0 chartWidth chartHeight\n        , attr "class" $ text "treemap-viz"\n        ]\n        `T.withChild`\n          ( T.joinData "rects" "g" leaves $ \\(TNode node) ->\n              T.named Group ("rect-" <> node.data_)\n                [ attr "class" $ text "node" ]\n                `T.withChildren`\n                  [ T.elem Rect\n                      [ x $ num node.x0\n                      , y $ num node.y0\n                      , width $ num (node.x1 - node.x0)\n                      , height $ num (node.y1 - node.y0)\n                      , fill $ text (getColor node.depth)\n                      , attr "fill-opacity" $ num 0.6\n                      , stroke $ text "#fff"\n                      , strokeWidth $ num 1.0\n                      ]\n                  , T.elem Text\n                      [ x $ num ((node.x0 + node.x1) / 2.0)\n                      , y $ num ((node.y0 + node.y1) / 2.0)\n                      , textContent $ text node.data_\n                      , textAnchor $ text "middle"\n                      , fontSize $ num 9.0\n                      , attr "fill-opacity" $ num (if (node.x1 - node.x0) > 30.0 && (node.y1 - node.y0) > 15.0 then 1.0 else 0.0)\n                      ]\n                  ]\n          )\n\n  _ <- renderTree container tree\n\n  liftEffect $ Console.log "=== Treemap Layout (Tree API) ==="\n\n-- | Main entry point\ntreemapViz :: String -> Effect Unit\ntreemapViz selector = launchAff_ do\n  result <- loadDataFile FlareJSON\n  case result of\n    Left err -> liftEffect $ Console.log $ "Failed to load Flare data: " <> err\n    Right jsonString -> liftEffect $ drawTreemap selector (parseFlareJson jsonString)\n';
  var snippet_treeViz_content = `module D3.Viz.TreeAPI.TreeViz where

import Prelude

import Data.Array as Array
import Data.Either (Either(..))
import Data.List (List(..))
import Control.Comonad.Cofree (head, tail)
import Data.Tree (Tree, mkTree)
import Effect (Effect)
import Effect.Aff (launchAff_)
import Effect.Class (liftEffect)
import Effect.Console as Console
import PSD3.Shared.Data (loadFlareData)
import DataViz.Layout.Hierarchy.Tree (tree, defaultTreeConfig)
import PSD3.Expr.Friendly (num, text, attr, viewBox, width, height, cx, cy, r, x, y, fill, stroke, strokeWidth, fontSize, textAnchor, textContent, path)
import PSD3.Internal.Capabilities.Selection (select, renderTree)
import PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_, reselectD3v2)
import PSD3.Internal.Selection.Types (ElementType(..), SEmpty)
import PSD3.AST as T
import Web.DOM.Element (Element)

-- | Hierarchy node type (matches loadFlareData output)
type HierNode = { name :: String, value :: Number, x :: Number, y :: Number, depth :: Int, height :: Int }

-- | Link data type
type LinkDatum = { source :: { x :: Number, y :: Number }, target :: { x :: Number, y :: Number } }

-- | Create links from parent to children
makeLinks
  :: forall r
   . Tree { x :: Number, y :: Number | r }
  -> Array { source :: { x :: Number, y :: Number }, target :: { x :: Number, y :: Number } }
makeLinks tree' = Array.fromFoldable $ makeLinksList tree'
  where
  makeLinksList
    :: Tree { x :: Number, y :: Number | r }
    -> List { source :: { x :: Number, y :: Number }, target :: { x :: Number, y :: Number } }
  makeLinksList t =
    let
      val = head t
      children = tail t
      childLinks = children >>= \\child ->
        let childVal = head child
        in Cons { source: { x: val.x, y: val.y }, target: { x: childVal.x, y: childVal.y } } Nil
      grandchildLinks = children >>= makeLinksList
    in
      childLinks <> grandchildLinks

-- | Link path generator (curved links)
linkPath :: Number -> Number -> Number -> Number -> String
linkPath x1' y1' x2' y2' =
  "M" <> show x1' <> "," <> show y1'
    <> "C"
    <> show x1'
    <> ","
    <> show ((y1' + y2') / 2.0)
    <> " "
    <> show x2'
    <> ","
    <> show ((y1' + y2') / 2.0)
    <> " "
    <> show x2'
    <> ","
    <> show y2'

-- | Draw tree hierarchy with loaded data
drawTree :: String -> Tree HierNode -> Effect Unit
drawTree selector flareTree = runD3v2M do
  container <- select selector :: _ (D3v2Selection_ SEmpty Element Unit)

  let chartWidth = 800.0
  let chartHeight = 600.0
  let padding = 40.0

  -- Apply Tree layout
  let
    config = defaultTreeConfig
      { size =
          { width: chartWidth - (2.0 * padding)
          , height: chartHeight - (2.0 * padding)
          }
      }
  let positioned = tree config flareTree

  -- Flatten to arrays
  let nodes = Array.fromFoldable positioned
  let links = makeLinks positioned

  liftEffect $ Console.log $ "Rendering " <> show (Array.length nodes) <> " nodes, " <> show (Array.length links) <> " links"

  -- First tree: SVG container with links (datum type: link data)
  let
    linksTree :: T.Tree LinkDatum
    linksTree =
      T.named SVG "svg"
        [ width $ num chartWidth
        , height $ num chartHeight
        , viewBox 0.0 0.0 chartWidth chartHeight
        , attr "class" $ text "simple-hierarchy-tree"
        ]
        \`T.withChild\`
          ( T.named Group "chartGroup"
              [ attr "class" $ text "tree-content" ]
              \`T.withChild\`
                ( T.named Group "linksGroup"
                    [ attr "class" $ text "links" ]
                    \`T.withChild\`
                      ( T.joinData "links" "path" links $ \\link ->
                          T.elem Path
                            [ path $ text ( linkPath
                                    (link.source.x + padding)
                                    (link.source.y + padding)
                                    (link.target.x + padding)
                                    (link.target.y + padding)
                                )
                            , fill $ text "none"
                            , stroke $ text "#999"
                            , strokeWidth $ num 1.5
                            , attr "class" $ text "link"
                            ]
                      )
                )
          )

  -- Render links first (underlaying)
  linksSelections <- renderTree container linksTree

  -- Second tree: Nodes on top (datum type: HierNode)
  -- Reselect the chartGroup from rendered selections (not global CSS selector!)
  chartGroupSel <- liftEffect $ reselectD3v2 "chartGroup" linksSelections

  let
    nodesTree :: T.Tree HierNode
    nodesTree =
      T.named Group "nodesGroup"
        [ attr "class" $ text "nodes" ]
        \`T.withChild\`
          ( T.joinData "nodeGroups" "g" nodes $ \\node ->
              T.named Group ("node-" <> node.name)
                [ attr "class" $ text "node" ]
                \`T.withChildren\`
                  [ T.elem Circle
                      [ cx $ num (node.x + padding)
                      , cy $ num (node.y + padding)
                      , r $ num 6.0
                      , fill $ text "#69b3a2"
                      , stroke $ text "#fff"
                      , strokeWidth $ num 2.0
                      ]
                  , T.elem Text
                      [ x $ num (node.x + padding + 10.0)
                      , y $ num (node.y + padding + 4.0)
                      , textContent $ text node.name
                      , fontSize $ num 12.0
                      , textAnchor $ text "start"
                      ]
                  ]
          )

  -- Render nodes on top (overlaying)
  nodesSelections <- renderTree chartGroupSel nodesTree

  liftEffect do
    Console.log "=== Tree Layout (Tree API) ==="
    Console.log ""
    Console.log $ "Rendered " <> show (Array.length nodes) <> " nodes, " <> show (Array.length links) <> " links"
    Console.log "Flare visualization toolkit hierarchy"
    Console.log ""

-- | Main entry point - loads Flare data then renders
treeViz :: String -> Effect Unit
treeViz selector = launchAff_ do
  result <- loadFlareData
  case result of
    Left err -> liftEffect $ Console.log $ "Failed to load Flare data: " <> err
    Right flareTree -> liftEffect $ drawTree selector flareTree
`;
  var snippet_threeLittleDimensions_content = 'module D3.Viz.TreeAPI.ThreeLittleDimensionsExample where\n\nimport Prelude\n\nimport Data.Array as Array\nimport Data.Map as Map\nimport Data.Maybe (Maybe(..))\nimport Effect (Effect)\nimport Effect.Class (liftEffect)\nimport Effect.Console as Console\nimport PSD3.Expr.Integration (v3AttrStr)\nimport PSD3.Expr.Expr (str)\nimport PSD3.Internal.Capabilities.Selection (select, renderTree)\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_)\nimport PSD3.Internal.Selection.Types (ElementType(..), SEmpty)\nimport PSD3.AST as T\nimport Web.DOM.Element (Element)\n\n-- | Nested data structure: array of arrays\ntype Matrix = Array (Array Int)\n\n-- | Sample 3x3 matrix\nmatrixData :: Matrix\nmatrixData = [ [ 1, 2, 3 ], [ 4, 5, 6 ], [ 7, 8, 9 ] ]\n\n-- | Three Little Dimensions using declarative tree API\n-- | This demonstrates nested data joins: outer array \u2192 rows, inner arrays \u2192 cells\nthreeLittleDimensions :: Effect Unit\nthreeLittleDimensions = runD3v2M do\n  container <- select "#viz" :: _ (D3v2Selection_ SEmpty Element Unit)\n\n  -- The challenge: how to represent nested decomposition in a tree?\n  -- Outer datum type: Array Int (a row)\n  -- Inner datum type: Int (a cell value)\n\n  -- Approach: Use nestedJoin to handle datum type decomposition\n  -- Outer type: Array Int (a row)\n  -- Inner type: Int (a cell value)\n  let\n    tree :: T.Tree (Array Int)\n    tree =\n      T.named Table "table"\n        [ v3AttrStr "class" (str "nested-data-table") ]\n        `T.withChild`\n          -- nestedJoin handles the type change from Array Int \u2192 Int\n          -- identity is the decomposer: it just returns the row data as-is\n          ( T.nestedJoin "rows" "tr" matrixData identity $ \\cellValue ->\n              -- cellValue :: Int (decomposed from Array Int)\n              T.elem Td\n                [ v3AttrStr "class" (str "table-cell")\n                , v3AttrStr "textContent" (str (show cellValue))\n                ]\n          )\n\n  -- Render the tree\n  selections <- renderTree container tree\n\n  liftEffect do\n    Console.log "=== Three Little Dimensions (Tree API) ==="\n    Console.log ""\n\n    case Map.lookup "table" selections of\n      Just _ -> Console.log "\u2713 Table created"\n      Nothing -> Console.log "\u2717 Missing table"\n\n    case Map.lookup "rows" selections of\n      Just _ -> Console.log $ "\u2713 Rows created (" <> show (Array.length matrixData) <> ")"\n      Nothing -> Console.log "\u2717 Missing rows"\n\n    case Map.lookup "cells" selections of\n      Just _ ->\n        let\n          totalCells = Array.foldl (\\acc row -> acc + Array.length row) 0 matrixData\n        in\n          Console.log $ "\u2713 Cells created (" <> show totalCells <> " total)"\n      Nothing -> Console.log "\u2717 Missing cells"\n\n    Console.log ""\n    Console.log "Expected: 3x3 table with numbers 1-9"\n';
  var snippet_threeLittleCircles_content = 'module D3.Viz.TreeAPI.ThreeLittleCircles where\n\nimport Prelude\n\nimport Data.Map as Map\nimport Data.Maybe (Maybe(..))\nimport Effect (Effect)\nimport Effect.Class (liftEffect)\nimport Effect.Console as Console\nimport PSD3.Expr.Friendly (num, text, attr, viewBox, width, height, cx, cy, r, fill)\nimport PSD3.Internal.Capabilities.Selection (select, renderTree)\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_)\nimport PSD3.Internal.Selection.Types (ElementType(..), SEmpty)\nimport PSD3.AST (Tree, joinData)\nimport PSD3.AST as T\nimport Web.DOM.Element (Element)\n\n-- | Three Little Circles - The classic D3 example using declarative tree API\n-- |\n-- | This demonstrates:\n-- | - Data joins with the declarative API\n-- | - Template functions that customize each element based on datum\n-- | - Polymorphic attributes (functions of datum)\n\ntype CircleData =\n  { x :: Number\n  , y :: Number\n  , r :: Number\n  , color :: String\n  }\n\ncircleData :: Array CircleData\ncircleData =\n  [ { x: 100.0, y: 100.0, r: 40.0, color: "red" }\n  , { x: 200.0, y: 100.0, r: 30.0, color: "green" }\n  , { x: 300.0, y: 100.0, r: 50.0, color: "blue" }\n  ]\n\nthreeLittleCircles :: Effect Unit\nthreeLittleCircles = runD3v2M do\n  container <- select "#viz" :: _ (D3v2Selection_ SEmpty Element Unit)\n\n  -- Define the tree with a DATA JOIN\n  -- Note: The datum type is CircleData because we\'re using joinData with CircleData\n  let tree :: Tree CircleData\n      tree =\n        T.named SVG "svg"\n          [ width $ num 400.0\n          , height $ num 200.0\n          , viewBox 0.0 0.0 400.0 200.0\n          , attr "id" $ text "three-circles-svg"\n          , attr "class" $ text "tree-api-example"\n          ]\n          `T.withChild`\n            -- Here\'s the magic: joinData creates N copies of the template\n            (joinData "circles" "circle" circleData $ \\d ->\n              T.elem Circle\n                [ cx $ num d.x\n                , cy $ num d.y\n                , r $ num d.r\n                , fill $ text d.color\n                ])\n\n  -- Render the tree\n  selections <- renderTree container tree\n\n  liftEffect do\n    Console.log "=== Three Little Circles (Declarative API) ==="\n    Console.log ""\n    Console.log "Structure: SVG \u2192 [Circle \xD7 3] (via joinData)"\n    Console.log ""\n\n    case Map.lookup "svg" selections of\n      Just _ -> Console.log "\u2713 SVG created"\n      Nothing -> Console.log "\u2717 Missing SVG"\n\n    case Map.lookup "circles" selections of\n      Just _ -> Console.log "\u2713 Circles collection created (3 circles via data join)"\n      Nothing -> Console.log "\u2717 Missing circles collection"\n\n    Console.log ""\n    Console.log "Expected result:"\n    Console.log "  - Red circle (r=40) at (100, 100)"\n    Console.log "  - Green circle (r=30) at (200, 100)"\n    Console.log "  - Blue circle (r=50) at (300, 100)"\n    Console.log ""\n    Console.log "Check the browser to verify!"\n';
  var snippet_threeLittleCirclesTransition_content = 'module D3.Viz.TreeAPI.ThreeLittleCirclesTransition where\n\n-- | Three Little Circles with Transitions using Tree API\n-- |\n-- | Demonstrates:\n-- | - Initial render with Tree API\n-- | - Re-rendering with updated data\n-- | - Transitions between states\n-- | - Click handlers with onClick behavior\n-- |\n-- | Based on Mike Bostock\'s "Three Little Circles" (https://bost.ocks.org/mike/circles/)\n\nimport Prelude\n\nimport Data.Int (toNumber)\nimport Data.Map as Map\nimport Data.Maybe (Maybe(..))\nimport Data.Time.Duration (Milliseconds(..))\nimport Effect (Effect)\nimport Effect.Console (log)\nimport Effect.Ref as Ref\nimport PSD3.Expr.Friendly (num, text, attr, from, fromStr, viewBox, width, height, cx, cy, r, fill, opacity)\nimport PSD3.Internal.Capabilities.Selection (renderTree, select)\nimport PSD3.Internal.Capabilities.Transition (withTransition)\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_)\nimport PSD3.Internal.Selection.Types (ElementType(..), SBoundOwns, SEmpty)\nimport PSD3.Internal.Transition.Types (transitionWith)\nimport PSD3.AST as T\nimport Partial.Unsafe (unsafePartial, unsafeCrashWith)\nimport Web.DOM.Element (Element)\n\n-- | Circle data type\ntype CircleData = Int\n\n-- | State of the circles visualization\ndata CircleState = StateGreen | StateRGB\n\nderive instance Eq CircleState\n\ninstance Show CircleState where\n  show StateGreen = "StateGreen"\n  show StateRGB = "StateRGB"\n\n-- | Toggle between states\ntoggleState :: CircleState -> CircleState\ntoggleState StateGreen = StateRGB\ntoggleState StateRGB = StateRGB -- Stay in RGB state once shown\n\n-- | Transition circles to a given state\ntransitionToState :: D3v2Selection_ SBoundOwns Element CircleData -> CircleState -> Effect Unit\ntransitionToState circlesSel state = runD3v2M do\n  let\n    transitionConfig = transitionWith\n      { duration: Milliseconds 1000.0\n      , delay: Nothing\n      , staggerDelay: Nothing\n      , easing: Nothing\n      }\n\n  case state of\n    StateGreen ->\n      -- Three green circles in a row\n      withTransition transitionConfig circlesSel\n        [ fromStr "fill" colorFnGreen\n        , from "cx" cxFnGreen\n        , from "cy" cyFnGreen\n        , r $ num 40.0\n        , attr "fill-opacity" $ num 1.0 -- Fully opaque\n        ]\n    StateRGB ->\n      withTransition transitionConfig circlesSel\n        [ fromStr "fill" colorFnRGB\n        , from "cx" cxFnRGB\n        , from "cy" cyFnRGB\n        , r $ num 60.0 -- Increased from 30 to 60 for proper overlap and color mixing\n        , attr "fill-opacity" $ num 0.5 -- Semi-transparent for color mixing\n        ]\n\n  pure unit\n  where\n  -- Green state: all circles green\n  colorFnGreen :: CircleData -> String\n  colorFnGreen _ = "#00ff00"\n\n  cxFnGreen :: CircleData -> Number\n  cxFnGreen d = 100.0 + toNumber d * 100.0 -- Spaced 100px apart\n\n  cyFnGreen :: CircleData -> Number\n  cyFnGreen _ = 125.0 -- All at same height\n\n  -- RGB colors: Red, Green, Blue\n  colorFnRGB :: CircleData -> String\n  colorFnRGB d = case d of\n    0 -> "#ff0000" -- Red\n    1 -> "#00ff00" -- Green\n    _ -> "#0000ff" -- Blue\n\n  -- RGB X positions: form triangle with overlap\n  cxFnRGB :: CircleData -> Number\n  cxFnRGB d = case d of\n    0 -> 150.0 -- Red on left\n    1 -> 250.0 -- Green on right\n    _ -> 200.0 -- Blue in center\n\n  -- RGB Y positions: red/green at bottom, blue at top\n  cyFnRGB :: CircleData -> Number\n  cyFnRGB d = case d of\n    0 -> 130.0 -- Red at bottom\n    1 -> 130.0 -- Green at bottom\n    _ -> 70.0 -- Blue at top\n\n-- | Draw three circles with visible initial state\nthreeLittleCirclesTransition :: String -> Effect { stateRef :: Ref.Ref CircleState, circlesSel :: D3v2Selection_ SBoundOwns Element CircleData }\nthreeLittleCirclesTransition selector = do\n  -- Create state ref - start with green circles\n  stateRef <- Ref.new StateGreen\n\n  runD3v2M do\n    container <- select selector :: _ (D3v2Selection_ SEmpty Element Unit)\n\n    -- Initial tree: three green circles in a row\n    let\n      initialTree :: T.Tree CircleData\n      initialTree =\n        T.named SVG "svg"\n          [ width $ num 400.0\n          , height $ num 250.0\n          , viewBox 0.0 0.0 400.0 250.0\n          , attr "id" $ text "three-circles-transition-tree"\n          ]\n          `T.withChild`\n            ( T.joinData "circles" "circle" [ 0, 1, 2 ] $ \\d ->\n                T.elem Circle\n                  [ fill $ text "#00ff00" -- Start green\n                  , cx $ num (100.0 + toNumber d * 100.0) -- Three in a row\n                  , cy $ num 125.0\n                  , r $ num 40.0\n                  , attr "fill-opacity" $ num 1.0\n                  ]\n            )\n\n    -- Render initial state\n    selections <- renderTree container initialTree\n\n    -- Extract the circles selection for transitions\n    let\n      circlesSel = case Map.lookup "circles" selections of\n        Just sel -> sel\n        Nothing -> unsafePartial $ unsafeCrashWith "circles selection not found"\n\n    -- Return the state ref and selection so external button can trigger transition\n    pure { stateRef, circlesSel }\n\n-- | Helper to create transition function for a button\n-- | Call this after threeLittleCirclesTransition to get a function to attach to a button\ncreateTransitionTrigger :: { stateRef :: Ref.Ref CircleState, circlesSel :: D3v2Selection_ SBoundOwns Element CircleData } -> Effect Unit\ncreateTransitionTrigger { stateRef, circlesSel } = do\n  currentState <- Ref.read stateRef\n  let newState = toggleState currentState\n  Ref.write newState stateRef\n  log $ "Transitioning to: " <> show newState\n  transitionToState circlesSel newState\n';
  var snippet_sunburst_content = 'module D3.Viz.TreeAPI.SunburstViz where\n\nimport Prelude\n\nimport Data.Array as Array\nimport Data.Either (Either(..))\nimport Data.Maybe (Maybe(..))\nimport Data.Number (pi, cos, sin)\nimport Effect (Effect)\nimport Effect.Aff (launchAff_)\nimport Effect.Class (liftEffect)\nimport Effect.Console as Console\nimport PSD3.Shared.Data (HierData, getName, getValue, getChildren, loadDataFile, DataFile(..), parseFlareJson)\nimport DataViz.Layout.Hierarchy.Partition (HierarchyData(..), PartitionNode(..), defaultPartitionConfig, hierarchy, partition)\nimport PSD3.Expr.Friendly (num, text, attr, viewBox, width, height, fill, stroke, strokeWidth, opacity, path)\nimport PSD3.Internal.Capabilities.Selection (select, renderTree)\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_)\nimport PSD3.Internal.Selection.Types (ElementType(..), SEmpty)\nimport PSD3.AST as T\nimport Web.DOM.Element (Element)\n\n-- | Convert HierData to Partition\'s HierarchyData\n-- | Non-leaf nodes use Nothing for value so hierarchy computes sum of children\ntoHierarchyData :: HierData -> HierarchyData String\ntoHierarchyData node =\n  let\n    children = getChildren node\n    -- Only leaf nodes have explicit values; non-leaf nodes sum children\n    nodeValue = case children of\n      Nothing -> Just (getValue node)\n      Just _ -> Nothing\n  in\n    HierarchyData\n      { data_: getName node\n      , value: nodeValue\n      , children: map (map toHierarchyData) children\n      }\n\n-- | Color palette\ncolors :: Array String\ncolors = [ "#e7ba52", "#c7c7c7", "#aec7e8", "#1f77b4", "#9467bd" ]\n\ngetColor :: Int -> String\ngetColor depth = case colors Array.!! (depth `mod` Array.length colors) of\n  Just c -> c\n  Nothing -> "#cccccc"\n\n-- | Get all nodes (recursive traversal)\ngetAllNodes :: forall a. PartitionNode a -> Array (PartitionNode a)\ngetAllNodes node@(PartNode n) =\n  if Array.length n.children == 0 then [ node ]\n  else [ node ] <> (n.children >>= getAllNodes)\n\n-- | Convert partition coordinates to sunburst arc path\n-- | x0, x1 are normalized [0,1] representing angles around the circle\n-- | y0, y1 are normalized [0,1] representing radius from center\narcPath :: Number -> Number -> Number -> Number -> Number -> String\narcPath x0_ y0_ x1_ y1_ radius =\n  let\n    -- Convert normalized x to angles (0 to 2\u03C0)\n    startAngle = x0_ * 2.0 * pi\n    endAngle = x1_ * 2.0 * pi\n\n    -- Convert normalized y to radius\n    innerRadius = y0_ * radius\n    outerRadius = y1_ * radius\n\n    -- Calculate arc points\n    x00 = cos startAngle * innerRadius\n    y00 = sin startAngle * innerRadius\n    x01 = cos endAngle * innerRadius\n    y01 = sin endAngle * innerRadius\n    x10 = cos startAngle * outerRadius\n    y10 = sin startAngle * outerRadius\n    x11 = cos endAngle * outerRadius\n    y11 = sin endAngle * outerRadius\n\n    -- Large arc flag: 1 if angle > \u03C0, 0 otherwise\n    largeArc = if (endAngle - startAngle) > pi then 1 else 0\n  in\n    -- SVG path for arc segment\n    "M" <> show x10 <> "," <> show y10\n      <> "A"\n      <> show outerRadius\n      <> ","\n      <> show outerRadius\n      <> " 0 "\n      <> show largeArc\n      <> " 1 "\n      <> show x11\n      <> ","\n      <> show y11\n      <> "L"\n      <> show x01\n      <> ","\n      <> show y01\n      <> "A"\n      <> show innerRadius\n      <> ","\n      <> show innerRadius\n      <> " 0 "\n      <> show largeArc\n      <> " 0 "\n      <> show x00\n      <> ","\n      <> show y00\n      <>\n        "Z"\n\n-- | Draw sunburst diagram\ndrawSunburst :: String -> HierData -> Effect Unit\ndrawSunburst selector flareData = runD3v2M do\n  container <- select selector :: _ (D3v2Selection_ SEmpty Element Unit)\n\n  -- Reduced from 900 to fit within tutorial-section max-width (832px)\n  let chartSize = 700.0\n  let radius = chartSize / 2.0\n\n  -- Convert to HierarchyData\n  let hierData = toHierarchyData flareData\n\n  -- Convert to PartitionNode hierarchy\n  let partRoot = hierarchy hierData\n\n  -- Apply partition layout (creates normalized coordinates)\n  let\n    config = defaultPartitionConfig\n      { size = { width: 1.0, height: 1.0 } -- Normalized for conversion to polar\n      , padding = 0.001 -- Small padding for visibility\n      }\n  let partitioned = partition config partRoot\n\n  -- Get all nodes except root (root would be full circle)\n  let allNodes = getAllNodes partitioned\n  let nodes = Array.filter (\\(PartNode n) -> n.depth > 0) allNodes\n\n  liftEffect $ Console.log $ "Rendering sunburst: " <> show (Array.length nodes) <> " arcs"\n\n  -- Build tree using TreeAPI\n  let\n    tree :: T.Tree (PartitionNode String)\n    tree =\n      T.named SVG "svg"\n        [ width $ num chartSize\n        , height $ num chartSize\n        , viewBox (-radius) (-radius) chartSize chartSize\n        , attr "class" $ text "sunburst-viz"\n        ]\n        `T.withChild`\n          ( T.joinData "arcs" "g" nodes $ \\(PartNode node) ->\n              T.named Group ("arc-" <> node.data_)\n                [ attr "class" $ text "node" ]\n                `T.withChild`\n                  ( T.elem Path\n                      [ path $ text (arcPath node.x0 node.y0 node.x1 node.y1 radius)\n                      , fill $ text (getColor node.depth)\n                      , attr "fill-opacity" $ num 0.7\n                      , stroke $ text "#fff"\n                      , strokeWidth $ num 1.0\n                      ]\n                  )\n          )\n\n  _ <- renderTree container tree\n\n  liftEffect $ Console.log "=== Sunburst Diagram ===="\n\n-- | Main entry point\nsunburstViz :: String -> Effect Unit\nsunburstViz selector = launchAff_ do\n  result <- loadDataFile FlareJSON\n  case result of\n    Left err -> liftEffect $ Console.log $ "Failed to load Flare data: " <> err\n    Right jsonString -> liftEffect $ drawSunburst selector (parseFlareJson jsonString)\n';
  var snippet_splom_content = '-- | SPLOM Visualization\n-- |\n-- | Brushable Scatterplot Matrix using PSD3 library APIs.\n-- | Demonstrates:\n-- | - PSD3.Scale for scales (linear, domain, range, ticks, invert, nice)\n-- | - PSD3.Brush for brush interaction\n-- | - PSD3 Tree API for declarative rendering\n-- |\n-- | This is a pure PureScript implementation with no local FFI.\n-- | State is managed externally (e.g., by a Halogen component).\nmodule D3.Viz.SPLOM.SPLOM\n  ( -- Types\n    SPLOMConfig\n  , SPLOMState\n  , DimensionScale\n  , BrushBounds\n  , Cell\n  -- State management\n  , initialState\n  , defaultConfig\n  -- Rendering\n  , renderSPLOM\n  , updatePointVisibility\n  -- Brush interaction\n  , attachBrushes\n  , clearBrushSelection\n  , isPointSelected\n  -- Queries\n  , getSelectedCount\n  , getTotalCount\n  ) where\n\nimport Prelude\n\nimport Data.Array (filter, length, mapWithIndex, mapMaybe, concat)\nimport Data.Array as Array\nimport Data.Foldable (minimum, maximum, for_)\nimport Data.Traversable (traverse)\nimport Data.Int (toNumber)\nimport Data.Int as Int\nimport Data.Maybe (Maybe(..), fromMaybe)\nimport Data.Number (floor) as Number\nimport Data.String.CodeUnits as StringCU\nimport Effect (Effect)\nimport Effect.Console as Console\nimport PSD3.Scale as Scale\nimport PSD3.Scale (ContinuousScale, applyScale, ticks, nice)\nimport PSD3.Internal.Attribute (Attribute)\nimport PSD3.Expr.Integration (v3Attr, v3AttrStr)\nimport PSD3.Expr.Expr (lit, str)\nimport PSD3.Brush (attachBrush, clearBrush, BrushHandle, BrushSelection, BrushConfig)\nimport PSD3.Internal.Capabilities.Selection (select, renderTree, clear)\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2M)\nimport PSD3.Internal.Selection.Types (ElementType(..)) as ET\nimport PSD3.AST (Tree)\nimport PSD3.AST as T\nimport D3.Viz.SPLOM.Types (Penguin, NumericDimension, dimensionLabel, dimensionKey, getDimensionValue, speciesColor, allDimensions)\nimport Web.DOM.ParentNode (querySelector, QuerySelector(..))\nimport Web.HTML (window)\nimport Web.HTML.Window (document)\nimport Web.HTML.HTMLDocument (toParentNode)\n\n-- | Configuration for SPLOM visualization\ntype SPLOMConfig =\n  { cellSize :: Number\n  , cellPadding :: Number\n  , matrixPadding :: Number\n  , pointRadius :: Number\n  , tickCount :: Int\n  , dimensions :: Array NumericDimension\n  }\n\n-- | Default configuration\ndefaultConfig :: SPLOMConfig\ndefaultConfig =\n  { cellSize: 120.0\n  , cellPadding: 12.0\n  , matrixPadding: 50.0\n  , pointRadius: 2.5\n  , tickCount: 5\n  , dimensions: allDimensions\n  }\n\n-- | Brush selection in data space\ntype BrushBounds =\n  { dimX :: NumericDimension\n  , dimY :: NumericDimension\n  , xMin :: Number\n  , xMax :: Number\n  , yMin :: Number\n  , yMax :: Number\n  }\n\n-- | Cell in the matrix\ntype Cell =\n  { row :: Int\n  , col :: Int\n  , dimX :: NumericDimension\n  , dimY :: NumericDimension\n  }\n\n-- | Scale for a dimension\ntype DimensionScale =\n  { dimension :: NumericDimension\n  , scale :: ContinuousScale\n  }\n\n-- | SPLOM state (managed externally, e.g., by Halogen component)\ntype SPLOMState =\n  { penguins :: Array Penguin\n  , validPenguins :: Array Penguin\n  , config :: SPLOMConfig\n  , scales :: Array DimensionScale\n  , selection :: Maybe BrushBounds\n  , brushHandles :: Array { cell :: Cell, handle :: BrushHandle }\n  , activeBrushCell :: Maybe Cell\n  , containerSelector :: String\n  }\n\n-- | Create initial state from penguins data\ninitialState :: String -> Array Penguin -> SPLOMState\ninitialState containerSelector penguins =\n  let\n    config = defaultConfig\n    validPenguins = filterValidPenguins config.dimensions penguins\n    scales = createScales validPenguins config.dimensions config.cellPadding config.cellSize\n  in\n    { penguins\n    , validPenguins\n    , config\n    , scales\n    , selection: Nothing\n    , brushHandles: []\n    , activeBrushCell: Nothing\n    , containerSelector\n    }\n\n-- | Filter penguins to those with all dimension values\nfilterValidPenguins :: Array NumericDimension -> Array Penguin -> Array Penguin\nfilterValidPenguins dimensions penguins =\n  filter (\\p ->\n    Array.all (\\dim -> case getDimensionValue dim p of\n      Just _ -> true\n      Nothing -> false\n    ) dimensions\n  ) penguins\n\n-- | Create scales for all dimensions\ncreateScales :: Array Penguin -> Array NumericDimension -> Number -> Number -> Array DimensionScale\ncreateScales penguins dimensions cellPadding cellSize =\n  dimensions <#> \\dim ->\n    let\n      values = mapMaybe (getDimensionValue dim) penguins\n      minVal = fromMaybe 0.0 $ minimum values\n      maxVal = fromMaybe 100.0 $ maximum values\n      scale = Scale.linear\n        # Scale.domain [minVal, maxVal]\n        # Scale.range [cellPadding, cellSize - cellPadding]\n        # nice\n    in\n      { dimension: dim, scale }\n\n-- | Find scale for a dimension\nfindScale :: NumericDimension -> Array DimensionScale -> Maybe ContinuousScale\nfindScale dim scales =\n  Array.find (\\s -> s.dimension == dim) scales <#> _.scale\n\n-- | Check if point is within selection\nisPointSelected :: Maybe BrushBounds -> Penguin -> Boolean\nisPointSelected Nothing _ = true\nisPointSelected (Just bounds) penguin =\n  case getDimensionValue bounds.dimX penguin, getDimensionValue bounds.dimY penguin of\n    Just xVal, Just yVal ->\n      xVal >= bounds.xMin && xVal <= bounds.xMax &&\n      yVal >= bounds.yMin && yVal <= bounds.yMax\n    _, _ -> false\n\n-- | Generate cells for matrix\ngenerateCells :: Array NumericDimension -> Array Cell\ngenerateCells dimensions =\n  concat $ mapWithIndex (\\row dimY ->\n    mapWithIndex (\\col dimX ->\n      { row, col, dimX, dimY }\n    ) dimensions\n  ) dimensions\n\n-- | Get off-diagonal cells only\noffDiagonalCells :: Array Cell -> Array Cell\noffDiagonalCells = filter (\\c -> c.row /= c.col)\n\n-- | Get selected count\ngetSelectedCount :: SPLOMState -> Int\ngetSelectedCount state =\n  length $ filter (isPointSelected state.selection) state.validPenguins\n\n-- | Get total count\ngetTotalCount :: SPLOMState -> Int\ngetTotalCount state = length state.validPenguins\n\n-- =============================================================================\n-- Rendering\n-- =============================================================================\n\n-- | Render the SPLOM with current state (full re-render, clears container)\nrenderSPLOM :: SPLOMState -> Effect Unit\nrenderSPLOM state = runD3v2M $ renderSPLOMWithState state\n\n-- | Update point visibility without full re-render\n-- | This is much faster than full re-render and preserves brush elements\nupdatePointVisibility :: SPLOMState -> Effect Unit\nupdatePointVisibility state =\n  case state.selection of\n    Nothing ->\n      -- No selection - show all points\n      updatePointVisibility_ state.containerSelector Nothing state.config.pointRadius\n    Just bounds ->\n      -- Convert to FFI-friendly format with string dimension keys\n      let ffiSelection =\n            { dimX: dimensionKey bounds.dimX\n            , dimY: dimensionKey bounds.dimY\n            , xMin: bounds.xMin\n            , xMax: bounds.xMax\n            , yMin: bounds.yMin\n            , yMax: bounds.yMax\n            }\n      in updatePointVisibility_ state.containerSelector (Just ffiSelection) state.config.pointRadius\n\n-- | FFI-friendly selection bounds (uses string keys instead of ADT)\ntype FFIBrushBounds =\n  { dimX :: String\n  , dimY :: String\n  , xMin :: Number\n  , xMax :: Number\n  , yMin :: Number\n  , yMax :: Number\n  }\n\n-- | FFI for updating point visibility\nforeign import updatePointVisibility_\n  :: String              -- Container selector\n  -> Maybe FFIBrushBounds -- Current selection bounds (with string dimension keys)\n  -> Number              -- Point radius when selected\n  -> Effect Unit\n\n-- | Internal render function\nrenderSPLOMWithState :: SPLOMState -> D3v2M Unit\nrenderSPLOMWithState state = do\n  -- Clear existing content first to avoid duplicate SVGs\n  clear state.containerSelector\n\n  container <- select state.containerSelector\n\n  let n = length state.config.dimensions\n  let totalSize = toNumber n * state.config.cellSize + state.config.matrixPadding * 2.0\n  let cells = generateCells state.config.dimensions\n\n  -- Build tree\n  let tree = buildSPLOMTree state cells totalSize\n\n  -- Render\n  _ <- renderTree container tree\n  pure unit\n\n-- | Build the complete SPLOM tree\nbuildSPLOMTree :: SPLOMState -> Array Cell -> Number -> Tree Penguin\nbuildSPLOMTree state cells totalSize =\n  T.named ET.SVG "svg"\n    [ v3Attr "width" (lit totalSize)\n    , v3Attr "height" (lit totalSize)\n    , v3AttrStr "viewBox" (str ("0 0 " <> show totalSize <> " " <> show totalSize))\n    , v3AttrStr "class" (str "splom-svg")\n    , v3AttrStr "id" (str "splom-matrix")\n    ]\n    `T.withChildren`\n      [ -- Background\n        T.elem ET.Rect\n          [ v3Attr "width" (lit totalSize)\n          , v3Attr "height" (lit totalSize)\n          , v3AttrStr "fill" (str "white")\n          ]\n\n      , -- All cells\n        T.named ET.Group "cells" [] `T.withChildren`\n          (cells <#> buildCell state)\n\n      , -- Axis labels\n        buildAxisLabels state\n      ]\n\n-- | Build a single cell\nbuildCell :: SPLOMState -> Cell -> Tree Penguin\nbuildCell state cell =\n  let\n    cellSize = state.config.cellSize\n    isDiagonal = cell.row == cell.col\n    mXScale = findScale cell.dimX state.scales\n    mYScale = findScale cell.dimY state.scales\n\n    -- Filter penguins valid for this cell\n    cellPenguins = filter (\\p ->\n      case getDimensionValue cell.dimX p, getDimensionValue cell.dimY p of\n        Just _, Just _ -> true\n        _, _ -> false\n    ) state.validPenguins\n\n    cellId = "cell-" <> show cell.row <> "-" <> show cell.col\n  in\n    T.named ET.Group cellId\n      [ v3AttrStr "id" (str cellId)\n      , v3AttrStr "class" (str $ if isDiagonal then "cell diagonal" else "cell off-diagonal")\n      , v3AttrStr "transform" (str ("translate(" <> show (state.config.matrixPadding + toNumber cell.col * cellSize) <> ","\n                               <> show (state.config.matrixPadding + toNumber cell.row * cellSize) <> ")"))\n      ]\n      `T.withChildren`\n        ([ -- Cell frame\n           T.elem ET.Rect\n             [ v3AttrStr "class" (str "cell-frame")\n             , v3Attr "width" (lit cellSize)\n             , v3Attr "height" (lit cellSize)\n             , v3AttrStr "fill" (str "none")\n             , v3AttrStr "stroke" (str "#aaa")\n             , v3Attr "stroke-width" (lit 0.5)\n             ]\n         ] <> (if isDiagonal\n               then buildDiagonalContent state cellPenguins cell mXScale\n               else buildOffDiagonalContent state cellPenguins cell mXScale mYScale))\n\n-- | Build diagonal cell content (label + scatter)\nbuildDiagonalContent :: SPLOMState -> Array Penguin -> Cell -> Maybe ContinuousScale -> Array (Tree Penguin)\nbuildDiagonalContent state penguins cell mScale =\n  case mScale of\n    Nothing -> []\n    Just scale ->\n      let\n        cellSize = state.config.cellSize\n        padding = state.config.cellPadding\n        tickValues = ticks state.config.tickCount scale\n\n        -- Get domain bounds from the scale\n        -- We use the tick values to find min/max\n        allTicks = ticks 10 scale\n        minVal = fromMaybe 0.0 $ minimum allTicks\n        maxVal = fromMaybe 100.0 $ maximum allTicks\n\n        -- Inverted Y scale for SW-NE diagonal\n        yScaleInverted = Scale.linear\n          # Scale.domain [minVal, maxVal]\n          # Scale.range [cellSize - padding, padding]\n\n        label = dimensionLabel cell.dimX\n        shortLabel = shortenLabel label\n\n      in\n        [ -- Grid lines (vertical)\n          T.named ET.Group "grid-v" [] `T.withChildren`\n            (tickValues <#> \\tick ->\n              T.elem ET.Line\n                [ v3Attr "x1" (lit (applyScale scale tick))\n                , v3Attr "x2" (lit (applyScale scale tick))\n                , v3Attr "y1" (lit padding)\n                , v3Attr "y2" (lit (cellSize - padding))\n                , v3AttrStr "stroke" (str "#eee")\n                , v3Attr "stroke-width" (lit 0.5)\n                ])\n\n        , -- Grid lines (horizontal)\n          T.named ET.Group "grid-h" [] `T.withChildren`\n            (tickValues <#> \\tick ->\n              T.elem ET.Line\n                [ v3Attr "x1" (lit padding)\n                , v3Attr "x2" (lit (cellSize - padding))\n                , v3Attr "y1" (lit (applyScale scale tick))\n                , v3Attr "y2" (lit (applyScale scale tick))\n                , v3AttrStr "stroke" (str "#eee")\n                , v3Attr "stroke-width" (lit 0.5)\n                ])\n\n        , -- Label\n          T.elem ET.Text\n            [ v3AttrStr "class" (str "cell-label")\n            , v3Attr "x" (lit (padding + 4.0))\n            , v3Attr "y" (lit (padding + 12.0))\n            , v3Attr "font-size" (lit 11.0)\n            , v3AttrStr "font-weight" (str "bold")\n            , v3AttrStr "fill" (str "#333")\n            , v3AttrStr "textContent" (str shortLabel)\n            ]\n\n        , -- Identity line (SW-NE)\n          T.elem ET.Line\n            [ v3AttrStr "class" (str "identity-line")\n            , v3Attr "x1" (lit (applyScale scale minVal))\n            , v3Attr "y1" (lit (applyScale yScaleInverted minVal))\n            , v3Attr "x2" (lit (applyScale scale maxVal))\n            , v3Attr "y2" (lit (applyScale yScaleInverted maxVal))\n            , v3AttrStr "stroke" (str "#333")\n            , v3Attr "stroke-width" (lit 1.0)\n            , v3AttrStr "stroke-dasharray" (str "2,2")\n            ]\n\n        , -- Diagonal scatter points\n          T.named ET.Group "diag-points" [] `T.withChildren`\n            (mapMaybe (\\p ->\n              case getDimensionValue cell.dimX p of\n                Just val -> Just $\n                  T.elem ET.Circle\n                    [ v3AttrStr "class" (str "diag-point")\n                    , v3Attr "cx" (lit (applyScale scale val))\n                    , v3Attr "cy" (lit (applyScale yScaleInverted val))\n                    , v3Attr "r" (lit 1.5)\n                    , v3AttrStr "fill" (str (speciesColor p.species))\n                    , v3Attr "fill-opacity" (lit 0.7)\n                    ]\n                Nothing -> Nothing\n            ) penguins)\n        ]\n\n-- | Build off-diagonal cell content (scatter plot)\nbuildOffDiagonalContent :: SPLOMState -> Array Penguin -> Cell -> Maybe ContinuousScale -> Maybe ContinuousScale -> Array (Tree Penguin)\nbuildOffDiagonalContent state penguins cell mXScale mYScale =\n  case mXScale, mYScale of\n    Just xScale, Just yScale ->\n      let\n        cellSize = state.config.cellSize\n        padding = state.config.cellPadding\n        xTicks = ticks state.config.tickCount xScale\n        yTicks = ticks state.config.tickCount yScale\n\n      in\n        [ -- Vertical grid lines\n          T.named ET.Group "grid-v" [] `T.withChildren`\n            (xTicks <#> \\tick ->\n              T.elem ET.Line\n                [ v3Attr "x1" (lit (applyScale xScale tick))\n                , v3Attr "x2" (lit (applyScale xScale tick))\n                , v3Attr "y1" (lit padding)\n                , v3Attr "y2" (lit (cellSize - padding))\n                , v3AttrStr "stroke" (str "#eee")\n                , v3Attr "stroke-width" (lit 0.5)\n                ])\n\n        , -- Horizontal grid lines\n          T.named ET.Group "grid-h" [] `T.withChildren`\n            (yTicks <#> \\tick ->\n              T.elem ET.Line\n                [ v3Attr "x1" (lit padding)\n                , v3Attr "x2" (lit (cellSize - padding))\n                , v3Attr "y1" (lit (applyScale yScale tick))\n                , v3Attr "y2" (lit (applyScale yScale tick))\n                , v3AttrStr "stroke" (str "#eee")\n                , v3Attr "stroke-width" (lit 0.5)\n                ])\n\n        , -- Scatter points\n          T.named ET.Group "points" [] `T.withChildren`\n            (mapMaybe (\\p ->\n              case getDimensionValue cell.dimX p, getDimensionValue cell.dimY p of\n                Just xVal, Just yVal ->\n                  let\n                    selected = isPointSelected state.selection p\n                    pointOpacity = if selected then 0.7 else 0.1\n                    pointRadius = if selected then state.config.pointRadius else 1.5\n                    -- Store all dimension values as data attributes for FFI access\n                    billLen = fromMaybe 0.0 p.billLength\n                    billDep = fromMaybe 0.0 p.billDepth\n                    flipLen = fromMaybe 0.0 p.flipperLength\n                    bodyMas = fromMaybe 0.0 p.bodyMass\n                  in Just $\n                    T.elem ET.Circle\n                      [ v3AttrStr "class" (str "point")\n                      , v3Attr "cx" (lit (applyScale xScale xVal))\n                      , v3Attr "cy" (lit (applyScale yScale yVal))\n                      , v3Attr "r" (lit pointRadius)\n                      , v3AttrStr "fill" (str (speciesColor p.species))\n                      , v3Attr "fill-opacity" (lit pointOpacity)\n                      , v3AttrStr "stroke" (str "none")\n                      , dataAttr "bill-length" billLen\n                      , dataAttr "bill-depth" billDep\n                      , dataAttr "flipper-length" flipLen\n                      , dataAttr "body-mass" bodyMas\n                      ]\n                _, _ -> Nothing\n            ) penguins)\n\n        , -- Brush overlay (empty group for brush attachment)\n          T.named ET.Group "brush" [ v3AttrStr "class" (str "brush") ]\n        ]\n    _, _ -> []\n\n-- | Build axis labels\nbuildAxisLabels :: SPLOMState -> Tree Penguin\nbuildAxisLabels state =\n  let\n    n = length state.scales\n    cellSize = state.config.cellSize\n    padding = state.config.matrixPadding\n  in\n    T.named ET.Group "axis-labels" []\n      `T.withChildren`\n        (concat\n          [ -- Bottom axis labels\n            mapWithIndex (\\i dimScale ->\n              let\n                tickValues = ticks state.config.tickCount dimScale.scale\n                xOffset = padding + toNumber i * cellSize\n              in\n                T.named ET.Group ("axis-bottom-" <> show i)\n                  [ v3AttrStr "transform" (str ("translate(" <> show xOffset <> "," <> show (padding + toNumber n * cellSize) <> ")")) ]\n                  `T.withChildren`\n                    (tickValues <#> \\tick ->\n                      T.elem ET.Text\n                        [ v3Attr "x" (lit (applyScale dimScale.scale tick))\n                        , v3Attr "y" (lit 12.0)\n                        , v3AttrStr "text-anchor" (str "middle")\n                        , v3Attr "font-size" (lit 8.0)\n                        , v3AttrStr "fill" (str "#666")\n                        , v3AttrStr "textContent" (str (formatTick tick))\n                        ])\n            ) state.scales\n\n          , -- Left axis labels\n            mapWithIndex (\\i dimScale ->\n              let\n                tickValues = ticks state.config.tickCount dimScale.scale\n                yOffset = padding + toNumber i * cellSize\n              in\n                T.named ET.Group ("axis-left-" <> show i)\n                  [ v3AttrStr "transform" (str ("translate(" <> show padding <> "," <> show yOffset <> ")")) ]\n                  `T.withChildren`\n                    (tickValues <#> \\tick ->\n                      T.elem ET.Text\n                        [ v3Attr "x" (lit (-4.0))\n                        , v3Attr "y" (lit (applyScale dimScale.scale tick))\n                        , v3AttrStr "text-anchor" (str "end")\n                        , v3AttrStr "dominant-baseline" (str "middle")\n                        , v3Attr "font-size" (lit 8.0)\n                        , v3AttrStr "fill" (str "#666")\n                        , v3AttrStr "textContent" (str (formatTick tick))\n                        ])\n            ) state.scales\n          ])\n\n-- =============================================================================\n-- Brush Interaction\n-- =============================================================================\n\n-- | Brush event callback type\ntype BrushCallback = BrushSelection -> Cell -> Effect Unit\n\n-- | Attach brushes to all off-diagonal cells\n-- | Returns the brush handles for storage in component state\nattachBrushes\n  :: SPLOMState\n  -> BrushCallback      -- Called on brush move\n  -> BrushCallback      -- Called on brush end\n  -> Effect (Array { cell :: Cell, handle :: BrushHandle })\nattachBrushes state onBrush onEnd = do\n  let cells = offDiagonalCells $ generateCells state.config.dimensions\n  let padding = state.config.cellPadding\n  let cellSize = state.config.cellSize\n\n  -- Attach brush to each off-diagonal cell\n  handles <- Array.catMaybes <$> (traverse (attachBrushToCell padding cellSize onBrush onEnd) cells)\n  pure handles\n\n-- | Attach brush to a single cell\nattachBrushToCell\n  :: Number\n  -> Number\n  -> BrushCallback\n  -> BrushCallback\n  -> Cell\n  -> Effect (Maybe { cell :: Cell, handle :: BrushHandle })\nattachBrushToCell padding cellSize onBrush onEnd cell = do\n  let cellSelector = "#splom-matrix #cell-" <> show cell.row <> "-" <> show cell.col <> " .brush"\n\n  -- Find the brush group element\n  doc <- window >>= document\n  mElement <- querySelector (QuerySelector cellSelector) (toParentNode doc)\n\n  case mElement of\n    Nothing -> do\n      Console.log $ "Brush element not found for cell " <> show cell.row <> "-" <> show cell.col\n      pure Nothing\n    Just element -> do\n      -- Create brush config\n      let brushConfig :: BrushConfig\n          brushConfig =\n            { extent:\n                { x0: padding\n                , y0: padding\n                , x1: cellSize - padding\n                , y1: cellSize - padding\n                }\n            , onStart: Nothing  -- Don\'t use onStart - causes event cascades when clearing other brushes\n            , onBrush: Just \\event -> onBrush event.selection cell\n            , onEnd: Just \\event -> onEnd event.selection cell\n            }\n\n      -- Attach brush\n      handle <- attachBrush element brushConfig\n      pure $ Just { cell, handle }\n\n-- | Clear all brush selections\nclearBrushSelection :: Array { cell :: Cell, handle :: BrushHandle } -> Effect Unit\nclearBrushSelection handles =\n  for_ handles \\bh -> clearBrush bh.handle\n\n-- =============================================================================\n-- Helpers\n-- =============================================================================\n\n-- | Create a data-* attribute for storing values on DOM elements\ndataAttr :: forall datum. String -> Number -> Attribute datum\ndataAttr name value = v3Attr ("data-" <> name) (lit value)\n\n-- | Format tick value for display\nformatTick :: Number -> String\nformatTick value\n  | value >= 1000.0 = show (Number.floor (value / 100.0) / 10.0) <> "k"\n  | value == Number.floor value = show (fromMaybe 0 $ Int.fromNumber value)\n  | otherwise = show (Number.floor (value * 10.0) / 10.0)\n\n-- | Shorten dimension label\nshortenLabel :: String -> String\nshortenLabel label =\n  replaceSubstring " (mm)" "" (replaceSubstring " (g)" "" label)\n\n-- | Simple substring replacement\nreplaceSubstring :: String -> String -> String -> String\nreplaceSubstring search replacement str =\n  go 0 str\n  where\n    searchLen = StringCU.length search\n    go idx s\n      | idx > StringCU.length s - searchLen = s\n      | StringCU.take searchLen (StringCU.drop idx s) == search =\n          StringCU.take idx s <> replacement <> StringCU.drop (idx + searchLen) s\n      | otherwise = go (idx + 1) s\n';
  var snippet_simpleTree_content = 'module D3.Viz.TreeAPI.SimpleTreeExample where\n\nimport Prelude\n\nimport Data.Map as Map\nimport Data.Maybe (Maybe(..))\nimport Effect (Effect)\nimport Effect.Class (liftEffect)\nimport Effect.Console as Console\nimport PSD3.Internal.Capabilities.Selection (select, renderTree)\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_)\nimport PSD3.Internal.Selection.Types (ElementType(..), SEmpty)\nimport PSD3.AST (Tree)\nimport PSD3.AST as T\nimport PSD3.Expr.Friendly (num, text, attr, viewBox, width, height, cx, cy, r, x, y, fill, textAnchor, textContent)\nimport Web.DOM.Element (Element)\n\n-- | Simple test: Render a basic tree structure without data joins\n-- |\n-- | Structure:\n-- | ```\n-- | div#viz\n-- |   \u2514\u2500 svg (800x600)\n-- |      \u2514\u2500 g.container\n-- |         \u251C\u2500 circle (at 100, 100)\n-- |         \u2514\u2500 text (at 100, 130)\n-- | ```\ntestSimpleTree :: Effect Unit\ntestSimpleTree = runD3v2M do\n  -- Select the container\n  container <- select "#viz" :: _  (D3v2Selection_ SEmpty Element Unit)\n\n  -- Define the tree structure using the declarative API\n  let tree :: Tree Unit\n      tree =\n        T.named SVG "svg" [width $ num 800.0, height $ num 600.0, viewBox 0.0 0.0 800.0 600.0, attr "id" $ text "simple-tree-svg"]\n          `T.withChild`\n            (T.named Group "container" [attr "class" $ text "container"]\n              `T.withChildren`\n                [ T.named Circle "circle" [cx $ num 100.0, cy $ num 100.0, r $ num 20.0, fill $ text "steelblue"]\n                , T.named Text "text" [x $ num 100.0, y $ num 130.0, textContent $ text "Hello Tree API!", textAnchor $ text "middle"]\n                ])\n\n  -- Render the tree\n  selections <- renderTree container tree\n\n  -- Log what we got back\n  liftEffect do\n    case Map.lookup "svg" selections of\n      Just _ -> Console.log "\u2713 Found svg selection"\n      Nothing -> Console.log "\u2717 Missing svg selection"\n\n    case Map.lookup "container" selections of\n      Just _ -> Console.log "\u2713 Found container selection"\n      Nothing -> Console.log "\u2717 Missing container selection"\n\n    case Map.lookup "circle" selections of\n      Just _ -> Console.log "\u2713 Found circle selection"\n      Nothing -> Console.log "\u2717 Missing circle selection"\n\n    case Map.lookup "text" selections of\n      Just _ -> Console.log "\u2713 Found text selection"\n      Nothing -> Console.log "\u2717 Missing text selection"\n\n    Console.log "Simple tree rendering complete!"\n';
  var snippet_simpleForce_content = '-- | Simplest Force Graph Example\n-- |\n-- | A minimal force-directed graph with hardcoded data.\n-- | Uses TreeAPI with declarative behaviors.\nmodule D3.Viz.SimpleForceGraph\n  ( simpleForceGraph\n  ) where\n\nimport Prelude\n\nimport Data.Nullable (null)\nimport Effect (Effect)\nimport Effect.Class (liftEffect)\nimport Effect.Ref as Ref\nimport PSD3.ForceEngine.Simulation as Sim\nimport PSD3.ForceEngine.Simulation (SimulationNode, SwizzledLink)\nimport PSD3.ForceEngine.Types (ForceSpec(..), defaultManyBody, defaultCollide, defaultCenter, defaultLink)\nimport PSD3.ForceEngine.Links (swizzleLinks)\nimport PSD3.Expr.Friendly (num, text, attr, viewBox, width, height, r, fill, stroke, strokeWidth, from)\nimport PSD3.Internal.Behavior.Types (Behavior(..), DragConfig(..), ScaleExtent(..), defaultZoom)\nimport PSD3.Internal.Behavior.FFI as BehaviorFFI\nimport PSD3.Internal.Capabilities.Selection (select, renderTree)\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_)\nimport PSD3.Internal.Selection.Types (ElementType(..), SEmpty)\nimport PSD3.AST as T\nimport Web.DOM.Element (Element)\n\n-- =============================================================================\n-- Types\n-- =============================================================================\n\n-- SimulationNode already includes id :: Int, so just add name for display\ntype Node = SimulationNode (name :: String)\ntype Link = { source :: Int, target :: Int }\ntype SLink = SwizzledLink (name :: String) (index :: Int)\n\n-- =============================================================================\n-- Data\n-- =============================================================================\n\nnodes :: Array Node\nnodes =\n  [ { id: 0, name: "A", x: 0.0, y: 0.0, vx: 0.0, vy: 0.0, fx: null, fy: null }\n  , { id: 1, name: "B", x: 0.0, y: 0.0, vx: 0.0, vy: 0.0, fx: null, fy: null }\n  , { id: 2, name: "C", x: 0.0, y: 0.0, vx: 0.0, vy: 0.0, fx: null, fy: null }\n  , { id: 3, name: "D", x: 0.0, y: 0.0, vx: 0.0, vy: 0.0, fx: null, fy: null }\n  , { id: 4, name: "E", x: 0.0, y: 0.0, vx: 0.0, vy: 0.0, fx: null, fy: null }\n  ]\n\nlinks :: Array Link\nlinks =\n  [ { source: 0, target: 1 }\n  , { source: 0, target: 2 }\n  , { source: 1, target: 2 }\n  , { source: 2, target: 3 }\n  , { source: 3, target: 4 }\n  , { source: 4, target: 0 }\n  ]\n\n-- =============================================================================\n-- Constants\n-- =============================================================================\n\nsimulationId :: String\nsimulationId = "simple-force"\n\n-- =============================================================================\n-- Visualization\n-- =============================================================================\n\nsimpleForceGraph :: String -> Effect (Effect Unit)\nsimpleForceGraph selector = do\n  let swizzled = swizzleLinks nodes links \\src tgt i _ -> { source: src, target: tgt, index: i }\n\n  -- Create simulation\n  sim <- Sim.create Sim.defaultConfig\n  Sim.setNodes nodes sim\n  Sim.setLinks links sim\n  Sim.addForce (ManyBody "charge" defaultManyBody { strength = -200.0 }) sim\n  Sim.addForce (Collide "collide" defaultCollide { radius = 20.0 }) sim\n  Sim.addForce (Center "center" defaultCenter) sim\n  Sim.addForce (Link "links" defaultLink { distance = 50.0 }) sim\n\n  -- Register simulation for declarative drag\n  BehaviorFFI.registerSimulation_ simulationId (Sim.reheat sim)\n\n  -- Create state ref for tick updates\n  stateRef <- Ref.new { nodes, swizzled }\n\n  -- Render initial DOM structure using TreeAPI\n  runD3v2M do\n    container <- select selector :: _ (D3v2Selection_ SEmpty Element Unit)\n    let\n      containerTree :: T.Tree Unit\n      containerTree =\n        T.named SVG "svg"\n          [ width $ num 400.0, height $ num 300.0, viewBox (-200.0) (-150.0) 400.0 300.0, attr "id" $ text "simple-force-svg" ]\n          `T.withBehaviors` [ Zoom $ defaultZoom (ScaleExtent 0.5 4.0) "#simple-force-zoom-group" ]\n          `T.withChildren`\n            [ T.named Group "zoom-group" [ attr "id" $ text "simple-force-zoom-group" ]\n                `T.withChildren`\n                  [ T.named Group "links-group" [ attr "id" $ text "simple-force-links" ]\n                  , T.named Group "nodes-group" [ attr "id" $ text "simple-force-nodes" ]\n                  ]\n            ]\n    _ <- renderTree container containerTree\n    pure unit\n\n  -- Tick handler renders with TreeAPI\n  Sim.onTick (tick stateRef selector) sim\n  Sim.start sim\n\n  -- Return cleanup\n  pure do\n    Sim.stop sim\n    BehaviorFFI.unregisterSimulation_ simulationId\n\n-- | Tick handler - renders nodes and links with current positions\ntick :: Ref.Ref { nodes :: Array Node, swizzled :: Array SLink } -> String -> Effect Unit\ntick stateRef _selector = runD3v2M do\n  state <- liftEffect $ Ref.read stateRef\n\n  -- Select the groups\n  linksGroup <- select "#simple-force-links" :: _ (D3v2Selection_ SEmpty Element Unit)\n  nodesGroup <- select "#simple-force-nodes" :: _ (D3v2Selection_ SEmpty Element Unit)\n\n  -- Render links\n  let\n    linksTree = T.joinData "links" "line" state.swizzled $ \\_ ->\n      T.elem Line\n        [ from "x1" (_.source.x :: SLink -> Number)\n        , from "y1" (_.source.y :: SLink -> Number)\n        , from "x2" (_.target.x :: SLink -> Number)\n        , from "y2" (_.target.y :: SLink -> Number)\n        , stroke $ text "#999"\n        , strokeWidth $ num 2.0\n        ]\n  _ <- renderTree linksGroup linksTree\n\n  -- Render nodes with drag behavior\n  let\n    nodesTree = T.joinData "nodes" "circle" state.nodes $ \\_ ->\n      T.elem Circle\n        [ from "cx" (_.x :: Node -> Number)\n        , from "cy" (_.y :: Node -> Number)\n        , r $ num 10.0\n        , fill $ text "#69b3a2"\n        , stroke $ text "#fff"\n        , strokeWidth $ num 2.0\n        ]\n        `T.withBehaviors` [ Drag (SimulationDrag simulationId) ]\n  _ <- renderTree nodesGroup nodesTree\n\n  pure unit\n';
  var snippet_scatterPlot_content = 'module D3.Viz.TreeAPI.ScatterPlotExample where\n\nimport Prelude\n\nimport Data.Array (length)\nimport Data.Foldable (maximum, minimum)\nimport Data.Map as Map\nimport Data.Maybe (Maybe(..), fromMaybe)\nimport Effect (Effect)\nimport Effect.Class (liftEffect)\nimport Effect.Console as Console\nimport PSD3.Expr.Friendly (num, text, attr, viewBox, width, height, cx, cy, r, fill, opacity, transform)\nimport PSD3.Internal.Capabilities.Selection (select, renderTree)\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_)\nimport PSD3.Internal.Selection.Types (ElementType(..), SEmpty)\nimport PSD3.AST (Tree, joinData)\nimport PSD3.AST as T\nimport Web.DOM.Element (Element)\n\n-- | Data point with x, y coordinates\ntype Point = { x :: Number, y :: Number }\n\n-- | Sample scatter plot data\nscatterData :: Array Point\nscatterData =\n  [ { x: 10.0, y: 20.0 }\n  , { x: 25.0, y: 45.0 }\n  , { x: 40.0, y: 30.0 }\n  , { x: 55.0, y: 70.0 }\n  , { x: 70.0, y: 50.0 }\n  , { x: 85.0, y: 85.0 }\n  , { x: 100.0, y: 65.0 }\n  , { x: 115.0, y: 90.0 }\n  , { x: 130.0, y: 75.0 }\n  , { x: 145.0, y: 95.0 }\n  ]\n\n-- | Chart dimensions\ntype Dimensions =\n  { width :: Number\n  , height :: Number\n  , marginTop :: Number\n  , marginRight :: Number\n  , marginBottom :: Number\n  , marginLeft :: Number\n  }\n\ndefaultDims :: Dimensions\ndefaultDims =\n  { width: 600.0\n  , height: 400.0\n  , marginTop: 20.0\n  , marginRight: 20.0\n  , marginBottom: 40.0\n  , marginLeft: 50.0\n  }\n\ninnerWidth :: Dimensions -> Number\ninnerWidth dims = dims.width - dims.marginLeft - dims.marginRight\n\ninnerHeight :: Dimensions -> Number\ninnerHeight dims = dims.height - dims.marginTop - dims.marginBottom\n\n-- | Scatter plot using declarative tree API\nscatterPlot :: Effect Unit\nscatterPlot = runD3v2M do\n  container <- select "#viz" :: _ (D3v2Selection_ SEmpty Element Unit)\n\n  let dims = defaultDims\n  let iWidth = innerWidth dims\n  let iHeight = innerHeight dims\n\n  -- Calculate data extents\n  let xValues = map _.x scatterData\n  let yValues = map _.y scatterData\n  let minX = fromMaybe 0.0 $ minimum xValues\n  let maxX = fromMaybe 100.0 $ maximum xValues\n  let minY = fromMaybe 0.0 $ minimum yValues\n  let maxY = fromMaybe 100.0 $ maximum yValues\n\n  -- Simple linear scale functions\n  let xScale val = ((val - minX) / (maxX - minX)) * iWidth\n  let yScale val = iHeight - ((val - minY) / (maxY - minY)) * iHeight\n\n  -- Define the tree structure\n  let tree :: Tree Point\n      tree =\n        T.named SVG "svg"\n          [ width $ num dims.width\n          , height $ num dims.height\n          , viewBox 0.0 0.0 dims.width dims.height\n          , attr "class" $ text "scatter-plot-tree"\n          ]\n          `T.withChild`\n            (T.named Group "chartGroup"\n              [ attr "class" $ text "chart-content"\n              , transform $ text ("translate(" <> show dims.marginLeft <> "," <> show dims.marginTop <> ")")\n              ]\n              `T.withChild`\n                -- Data join for points\n                (joinData "points" "circle" scatterData $ \\point ->\n                  T.elem Circle\n                    [ cx $ num (xScale point.x)\n                    , cy $ num (yScale point.y)\n                    , r $ num 6.0\n                    , fill $ text "#e74c3c"\n                    , opacity $ num 0.7\n                    , attr "class" $ text "point"\n                    ]\n                ))\n\n  -- Render the tree\n  selections <- renderTree container tree\n\n  liftEffect do\n    Console.log "=== Scatter Plot (Tree API) ==="\n    Console.log ""\n    Console.log $ "Rendered " <> show (length scatterData) <> " points"\n\n    case Map.lookup "svg" selections of\n      Just _ -> Console.log "\u2713 SVG created"\n      Nothing -> Console.log "\u2717 Missing SVG"\n\n    case Map.lookup "chartGroup" selections of\n      Just _ -> Console.log "\u2713 Chart group created"\n      Nothing -> Console.log "\u2717 Missing chart group"\n\n    case Map.lookup "points" selections of\n      Just _ -> Console.log "\u2713 Points collection created"\n      Nothing -> Console.log "\u2717 Missing points collection"\n\n    Console.log ""\n    Console.log "Expected: 10 red circles showing scatter pattern"\n';
  var snippet_sankey_content = 'module D3.Viz.TreeAPI.SankeyDiagram where\n\n-- | Sankey diagram visualization using TreeAPI\n-- | Pure PureScript layout with declarative TreeAPI rendering\n-- | Uses v3 expressions for computed attributes\n\nimport Prelude\n\nimport Data.Array as Array\nimport Data.Maybe (Maybe(..))\nimport Data.String.CodeUnits (indexOf)\nimport Data.String.Pattern (Pattern(..))\nimport Effect (Effect)\nimport Effect.Class (liftEffect)\nimport Effect.Console as Console\nimport Type.Proxy (Proxy(..))\nimport DataViz.Layout.Sankey.CSV (parseSankeyCSV)\nimport DataViz.Layout.Sankey.Compute (computeLayout)\nimport DataViz.Layout.Sankey.Path (generateLinkPath)\nimport DataViz.Layout.Sankey.Types (SankeyLink, SankeyNode, NodeID(..), LinkID(..))\nimport PSD3.Expr.Friendly (num, text, attr, viewBox, width, height, x, y, fill, stroke, strokeWidth, opacity, path)\nimport PSD3.Internal.Capabilities.Selection (renderTree, select)\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_, reselectD3v2)\nimport PSD3.Internal.Selection.Types (ElementType(..), SEmpty)\nimport PSD3.AST as T\nimport Web.DOM.Element (Element)\n\n-- v3 DSL imports\nimport PSD3.Expr.Expr (class NumExpr, class BoolExpr, class CompareExpr, class StringExpr, ifThenElse, add)\nimport PSD3.Expr.Datum (class DatumExpr, field)\nimport PSD3.Expr.Sugar ((+:), (-:), (/:), (<.), s)\nimport PSD3.Expr.Interpreter.Eval (EvalD, runEvalD)\n\n-- | Indexed link for data join (ensures unique keys)\nnewtype IndexedLink = IndexedLink { index :: Int, link :: SankeyLink }\n\ninstance Eq IndexedLink where\n  eq (IndexedLink a) (IndexedLink b) = a.index == b.index\n\ninstance Ord IndexedLink where\n  compare (IndexedLink a) (IndexedLink b) = compare a.index b.index\n\n-- | Indexed node for data join\nnewtype IndexedNode = IndexedNode { index :: Int, node :: SankeyNode }\n\ninstance Eq IndexedNode where\n  eq (IndexedNode a) (IndexedNode b) = a.index == b.index\n\ninstance Ord IndexedNode where\n  compare (IndexedNode a) (IndexedNode b) = compare a.index b.index\n\n-- =============================================================================\n-- v3 Expressions for Label Positioning\n-- =============================================================================\n\n-- | Flattened node data for v3 expression access\n-- | We add chartWidth to the datum so conditional positioning works\ntype LabelDatum =\n  { name :: String\n  , x0 :: Number\n  , x1 :: Number\n  , y0 :: Number\n  , y1 :: Number\n  , color :: String\n  , chartWidth :: Number  -- Baked in for conditional positioning\n  }\n\n-- Row type for v3 DatumExpr\ntype LabelRow = (name :: String, x0 :: Number, x1 :: Number, y0 :: Number, y1 :: Number, color :: String, chartWidth :: Number)\n\n-- | Convert SankeyNode to LabelDatum with chart width\ntoLabelDatum :: Number -> SankeyNode -> LabelDatum\ntoLabelDatum chartWidth node =\n  { name: node.name\n  , x0: node.x0\n  , x1: node.x1\n  , y0: node.y0\n  , y1: node.y1\n  , color: node.color\n  , chartWidth\n  }\n\n-- Field accessors for v3\nlabelX0 :: forall repr. DatumExpr repr LabelRow => repr Number\nlabelX0 = field (Proxy :: Proxy "x0")\n\nlabelX1 :: forall repr. DatumExpr repr LabelRow => repr Number\nlabelX1 = field (Proxy :: Proxy "x1")\n\nlabelY0 :: forall repr. DatumExpr repr LabelRow => repr Number\nlabelY0 = field (Proxy :: Proxy "y0")\n\nlabelY1 :: forall repr. DatumExpr repr LabelRow => repr Number\nlabelY1 = field (Proxy :: Proxy "y1")\n\nlabelChartWidth :: forall repr. DatumExpr repr LabelRow => repr Number\nlabelChartWidth = field (Proxy :: Proxy "chartWidth")\n\n-- | v3 expression: Label X position\n-- | If node is on left half, position right of node; otherwise left\nlabelXExpr :: forall repr. NumExpr repr => BoolExpr repr => CompareExpr repr => DatumExpr repr LabelRow => repr Number\nlabelXExpr = ifThenElse\n  (labelX0 <. (labelChartWidth /: 2.0))  -- If on left half of chart\n  (labelX1 +: 6.0)                        -- Position to the right of node\n  (labelX0 -: 6.0)                        -- Position to the left of node\n\n-- | v3 expression: Label Y position (vertically centered on node)\nlabelYExpr :: forall repr. NumExpr repr => DatumExpr repr LabelRow => repr Number\nlabelYExpr = add labelY0 labelY1 /: 2.0\n\n-- | v3 expression: Text anchor based on node position\nlabelAnchorExpr :: forall repr. NumExpr repr => BoolExpr repr => CompareExpr repr => StringExpr repr => DatumExpr repr LabelRow => repr String\nlabelAnchorExpr = ifThenElse\n  (labelX0 <. (labelChartWidth /: 2.0))\n  (s "start")\n  (s "end")\n\n-- | Evaluate v3 expression for label datum\nevalLabelNum :: EvalD LabelDatum Number -> LabelDatum -> Number\nevalLabelNum expr datum = runEvalD expr datum 0\n\nevalLabelStr :: EvalD LabelDatum String -> LabelDatum -> String\nevalLabelStr expr datum = runEvalD expr datum 0\n\n-- | Check if a color string is a gradient URL reference\nisGradientColor :: String -> Boolean\nisGradientColor color = case indexOf (Pattern "url(#sankey-gradient-") color of\n  Just _ -> true\n  Nothing -> false\n\n-- | Newtype for gradient data\nnewtype GradientSpec = GradientSpec\n  { id :: String\n  , sourceColor :: String\n  , targetColor :: String\n  , sourceX :: Number\n  , targetX :: Number\n  }\n\n-- | Look up node by ID\nfindNodeById :: Array SankeyNode -> NodeID -> Maybe SankeyNode\nfindNodeById nodes nodeId = Array.find (\\n -> n.index == nodeId) nodes\n\n-- | Create gradient specs for links that need gradients\ncreateGradientSpecs :: Array SankeyNode -> Array SankeyLink -> Array GradientSpec\ncreateGradientSpecs nodes links = Array.mapMaybe mkGradientSpec links\n  where\n    mkGradientSpec :: SankeyLink -> Maybe GradientSpec\n    mkGradientSpec link =\n      if isGradientColor link.color then do\n        sourceNode <- findNodeById nodes link.sourceIndex\n        targetNode <- findNodeById nodes link.targetIndex\n        let (LinkID idx) = link.index\n        pure $ GradientSpec\n          { id: "sankey-gradient-" <> show idx\n          , sourceColor: sourceNode.color\n          , targetColor: targetNode.color\n          , sourceX: sourceNode.x1  -- Right edge of source\n          , targetX: targetNode.x0  -- Left edge of target\n          }\n      else Nothing\n\n-- | Draw Sankey diagram with TreeAPI\ndrawSankey\n  :: String\n  -> String\n  -> Number\n  -> Number\n  -> Effect Unit\ndrawSankey csvData containerSelector w h = runD3v2M do\n  liftEffect $ Console.log "=== Drawing Sankey with TreeAPI ==="\n\n  -- Select container\n  container <- select containerSelector :: _ (D3v2Selection_ SEmpty Element Unit)\n\n  -- Parse CSV and compute layout (pure PureScript!)\n  let linkInputs = parseSankeyCSV csvData\n  liftEffect $ Console.log $ "Parsed " <> show (Array.length linkInputs) <> " links from CSV"\n\n  let layoutResult = computeLayout linkInputs w h\n  liftEffect $ Console.log $ "Layout computed: " <> show (Array.length layoutResult.nodes) <> " nodes, "\n    <> show (Array.length layoutResult.links)\n    <> " links"\n\n  -- Wrap nodes and links with indices for unique keys\n  let indexedNodes = Array.mapWithIndex (\\i node -> IndexedNode { index: i, node }) layoutResult.nodes\n  let indexedLinks = Array.mapWithIndex (\\i link -> IndexedLink { index: i, link }) layoutResult.links\n\n  -- Create gradient definitions for links that use SourceTargetGradient\n  let gradientSpecs = createGradientSpecs layoutResult.nodes layoutResult.links\n  liftEffect $ Console.log $ "Created " <> show (Array.length gradientSpecs) <> " gradient definitions"\n\n  -- Build gradient trees (each gradient is a linearGradient element with two stops)\n  let\n    mkGradientTree :: GradientSpec -> T.Tree Unit\n    mkGradientTree (GradientSpec spec) =\n      T.named LinearGradient spec.id\n        [ attr "id" $ text spec.id\n        , attr "gradientUnits" $ text "userSpaceOnUse"  -- Use absolute pixel coordinates\n        , attr "x1" $ num spec.sourceX\n        , attr "x2" $ num spec.targetX\n        , attr "y1" $ num 0.0  -- Horizontal gradient\n        , attr "y2" $ num 0.0\n        ]\n        `T.withChildren`\n          [ T.elem Stop [ attr "offset" $ text "0%", attr "stop-color" $ text spec.sourceColor ]\n          , T.elem Stop [ attr "offset" $ text "100%", attr "stop-color" $ text spec.targetColor ]\n          ]\n\n    -- Build defs children (empty if no gradients needed)\n    defsChildren :: Array (T.Tree Unit)\n    defsChildren = map mkGradientTree gradientSpecs\n\n  -- Declarative tree structure (SVG groups only, no data)\n  let\n    sankeyTree :: T.Tree Unit\n    sankeyTree =\n      T.named SVG "svg"\n        [ width $ num w\n        , height $ num h\n        , viewBox 0.0 0.0 w h\n        , attr "id" $ text "sankey-svg"\n        , attr "class" $ text "sankey"\n        ]\n        `T.withChildren`\n          ( [ T.named Defs "defs" [] `T.withChildren` defsChildren\n            , T.named Group "linksGroup" [ attr "class" $ text "links" ]\n            , T.named Group "nodesGroup" [ attr "class" $ text "nodes" ]\n            , T.named Group "labelsGroup" [ attr "class" $ text "labels" ]\n            ]\n          )\n\n  -- Render structure\n  selections <- renderTree container sankeyTree\n\n  -- Reselect groups for data rendering\n  linksGroupSel <- liftEffect $ reselectD3v2 "linksGroup" selections\n  nodesGroupSel <- liftEffect $ reselectD3v2 "nodesGroup" selections\n  labelsGroupSel <- liftEffect $ reselectD3v2 "labelsGroup" selections\n\n  -- Render links (filled paths - ribbons)\n  let\n    linksTree :: T.Tree IndexedLink\n    linksTree =\n      T.joinData "linkElements" "path" indexedLinks $ \\(IndexedLink il) ->\n        let\n          link = il.link\n        in\n          T.elem Path\n            [ attr "class" $ text "sankey-link"\n            , path $ text $ generateLinkPath layoutResult.nodes link\n            , fill $ text link.color\n            , opacity $ num 0.5\n            ]\n\n  _ <- renderTree linksGroupSel linksTree\n\n  -- Render nodes (rectangles)\n  let\n    nodesTree :: T.Tree IndexedNode\n    nodesTree =\n      T.joinData "nodeElements" "rect" indexedNodes $ \\(IndexedNode in_) ->\n        let\n          node = in_.node\n        in\n          T.elem Rect\n            [ attr "class" $ text "sankey-node"\n            , x $ num node.x0\n            , y $ num node.y0\n            , width $ num (node.x1 - node.x0)\n            , height $ num (node.y1 - node.y0)\n            , fill $ text node.color\n            , stroke $ text "#000"\n            , strokeWidth $ num 1.0\n            , opacity $ num 0.3\n            ]\n\n  _ <- renderTree nodesGroupSel nodesTree\n\n  -- Render labels using v3 expressions for conditional positioning\n  -- Convert nodes to LabelDatum with chartWidth baked in\n  let labelData = map (\\(IndexedNode in_) -> toLabelDatum w in_.node) indexedNodes\n\n  let\n    labelsTree :: T.Tree LabelDatum\n    labelsTree =\n      T.joinData "labelElements" "text" labelData $ \\datum ->\n        -- v3 expressions evaluate the conditional positioning logic\n        T.elem Text\n          [ attr "class" $ text "sankey-label"\n          , x $ num (evalLabelNum labelXExpr datum)      -- v3: if x0 < w/2 then x1+6 else x0-6\n          , y $ num (evalLabelNum labelYExpr datum)      -- v3: (y0 + y1) / 2\n          , attr "text-anchor" $ text (evalLabelStr labelAnchorExpr datum)  -- v3: if x0 < w/2 then "start" else "end"\n          , fill $ text "#000"\n          , attr "text-content" $ text datum.name\n          ]\n\n  _ <- renderTree labelsGroupSel labelsTree\n\n  liftEffect $ Console.log "Sankey diagram rendered with TreeAPI"\n\n  pure unit\n\n-- | Entry point with fixed dimensions for Tour page\nstartSankey :: String -> String -> Effect Unit\nstartSankey csvData containerSelector = do\n  -- Fixed dimensions for embedded view\n  -- Reduced from 900 to 750 to fit within tutorial-section max-width (52rem = 832px)\n  let w = 750.0\n  let h = 500.0\n\n  drawSankey csvData containerSelector w h\n';
  var snippet_radialTree_content = 'module D3.Viz.TreeAPI.RadialTreeViz where\n\nimport Prelude\n\nimport Data.Array as Array\nimport Data.Either (Either(..))\nimport Data.List (List(..))\nimport Data.Number (pi, cos, sin)\nimport DataViz.Layout.Hierarchy.Link (linkBezierRadialCartesian)\nimport Control.Comonad.Cofree (head, tail)\nimport Data.Tree (Tree, mkTree)\nimport Effect (Effect)\nimport Effect.Aff (launchAff_)\nimport Effect.Class (liftEffect)\nimport Effect.Console as Console\nimport PSD3.Shared.Data (loadFlareData)\nimport DataViz.Layout.Hierarchy.Tree (tree, defaultTreeConfig)\nimport PSD3.Expr.Friendly (num, text, attr, viewBox, width, height, cx, cy, r, x, y, fill, stroke, strokeWidth, transform, path, textAnchor, fontSize, textContent)\nimport PSD3.Internal.Capabilities.Selection (select, renderTree)\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_, reselectD3v2)\nimport PSD3.Internal.Selection.Types (ElementType(..), SEmpty)\nimport PSD3.AST as T\nimport Web.DOM.Element (Element)\n\n-- | Hierarchy node type (matches loadFlareData output)\ntype HierNode = { name :: String, value :: Number, x :: Number, y :: Number, depth :: Int, height :: Int }\n\n-- | Link data type\ntype LinkDatum = { source :: { x :: Number, y :: Number }, target :: { x :: Number, y :: Number } }\n\n-- | Radial projection: convert (x, y) to polar coordinates\n-- | x is mapped to angle, y (depth) is mapped to radius\nradialPoint :: forall r. { x :: Number, y :: Number | r } -> Number -> Number -> { x :: Number, y :: Number }\nradialPoint node w h =\n  let\n    -- Map x to angle (0 to 2\u03C0)\n    angle = (node.x / w) * 2.0 * pi - (pi / 2.0) -- Start at top (-\u03C0/2)\n    -- Map y (depth) to radius\n    minDim = if w < h then w else h\n    rad = (node.y / h) * (minDim / 2.0) * 0.85 -- Scale to 85% of radius\n  in\n    { x: rad * cos angle\n    , y: rad * sin angle\n    }\n\n-- | Apply radial projection to a tree\nprojectRadial :: forall r. Number -> Number -> Tree { x :: Number, y :: Number | r } -> Tree { x :: Number, y :: Number | r }\nprojectRadial w h t =\n  let\n    val = head t\n    children = tail t\n    projected = radialPoint val w h\n    projectedChildren = map (projectRadial w h) children\n  in\n    mkTree (val { x = projected.x, y = projected.y }) projectedChildren\n\n-- | Create links from parent to children\nmakeLinks\n  :: forall r\n   . Tree { x :: Number, y :: Number | r }\n  -> Array { source :: { x :: Number, y :: Number }, target :: { x :: Number, y :: Number } }\nmakeLinks tree\' = Array.fromFoldable $ makeLinksList tree\'\n  where\n  makeLinksList\n    :: Tree { x :: Number, y :: Number | r }\n    -> List { source :: { x :: Number, y :: Number }, target :: { x :: Number, y :: Number } }\n  makeLinksList t =\n    let\n      val = head t\n      children = tail t\n      childLinks = children >>= \\child ->\n        let childVal = head child\n        in Cons { source: { x: val.x, y: val.y }, target: { x: childVal.x, y: childVal.y } } Nil\n      grandchildLinks = children >>= makeLinksList\n    in\n      childLinks <> grandchildLinks\n\n-- | Radial link path generator (re-export from library)\nradialLinkPath :: Number -> Number -> Number -> Number -> String\nradialLinkPath = linkBezierRadialCartesian\n\n-- | Draw radial tree hierarchy with loaded data\ndrawRadialTree :: String -> Tree HierNode -> Effect Unit\ndrawRadialTree selector flareTree = runD3v2M do\n  container <- select selector :: _ (D3v2Selection_ SEmpty Element Unit)\n\n  -- Reduced from 1000 to fit within tutorial-section max-width (832px)\n  let chartSize = 700.0\n  let centerX = chartSize / 2.0\n  let centerY = chartSize / 2.0\n\n  -- Apply Tree layout\n  let\n    config = defaultTreeConfig\n      { size = { width: chartSize, height: chartSize } }\n  let positioned = tree config flareTree\n\n  -- Apply radial projection to all nodes\n  let radialTree = projectRadial chartSize chartSize positioned\n\n  -- Flatten to arrays\n  let nodes = Array.fromFoldable radialTree\n  let links = makeLinks radialTree\n\n  liftEffect $ Console.log $ "Rendering radial tree: " <> show (Array.length nodes) <> " nodes, " <> show (Array.length links) <> " links"\n\n  -- First tree: SVG container with links (datum type: link data)\n  let\n    linksTree :: T.Tree LinkDatum\n    linksTree =\n      T.named SVG "svg"\n        [ width $ num chartSize\n        , height $ num chartSize\n        , viewBox 0.0 0.0 chartSize chartSize\n        , attr "class" $ text "radial-tree-viz"\n        ]\n        `T.withChild`\n          ( T.named Group "chartGroup"\n              [ attr "class" $ text "tree-content"\n              , transform $ text ("translate(" <> show centerX <> "," <> show centerY <> ")")\n              ]\n              `T.withChild`\n                ( T.named Group "linksGroup"\n                    [ attr "class" $ text "links" ]\n                    `T.withChild`\n                      ( T.joinData "links" "path" links $ \\link ->\n                          T.elem Path\n                            [ path $ text ( radialLinkPath\n                                    link.source.x\n                                    link.source.y\n                                    link.target.x\n                                    link.target.y\n                                )\n                            , fill $ text "none"\n                            , stroke $ text "#999"\n                            , strokeWidth $ num 1.5\n                            , attr "class" $ text "link"\n                            ]\n                      )\n                )\n          )\n\n  -- Render links first (underlaying)\n  linksSelections <- renderTree container linksTree\n\n  -- Second tree: Nodes on top (datum type: HierNode)\n  -- Reselect the chartGroup from rendered selections (not global CSS selector!)\n  chartGroupSel <- liftEffect $ reselectD3v2 "chartGroup" linksSelections\n\n  let\n    nodesTree :: T.Tree HierNode\n    nodesTree =\n      T.named Group "nodesGroup"\n        [ attr "class" $ text "nodes" ]\n        `T.withChild`\n          ( T.joinData "nodeGroups" "g" nodes $ \\node ->\n              T.named Group ("node-" <> node.name)\n                [ attr "class" $ text "node" ]\n                `T.withChildren`\n                  [ T.elem Circle\n                      [ cx $ num node.x\n                      , cy $ num node.y\n                      , r $ num 3.0\n                      , fill $ text "#69b3a2"\n                      , stroke $ text "#fff"\n                      , strokeWidth $ num 1.5\n                      ]\n                  , T.elem Text\n                      [ x $ num node.x\n                      , y $ num node.y\n                      , textContent $ text node.name\n                      , fontSize $ num 9.0\n                      , textAnchor $ text "start"\n                      , transform $ text "translate(6, 3)"\n                      ]\n                  ]\n          )\n\n  -- Render nodes on top (overlaying)\n  _ <- renderTree chartGroupSel nodesTree\n\n  liftEffect do\n    Console.log "=== Radial Tree Layout (Tree API) ==="\n    Console.log ""\n    Console.log "Flare visualization toolkit hierarchy (radial)"\n    Console.log ""\n\n-- | Main entry point - loads Flare data then renders\nradialTreeViz :: String -> Effect Unit\nradialTreeViz selector = launchAff_ do\n  result <- loadFlareData\n  case result of\n    Left err -> liftEffect $ Console.log $ "Failed to load Flare data: " <> err\n    Right flareTree -> liftEffect $ drawRadialTree selector flareTree\n';
  var snippet_radialStackedBar_content = 'module D3.Viz.TreeAPI.RadialStackedBarExample where\n\nimport Prelude\n\nimport Data.Array (groupBy, length, sortBy)\nimport Data.Array as Array\nimport Data.Array.NonEmpty as NEA\nimport Data.Either (Either(..))\nimport Data.Foldable (sum, maximum)\nimport Data.Function (on)\nimport Data.Int (toNumber)\nimport Data.Maybe (Maybe(..), fromMaybe)\nimport Data.Number (pi, cos, sin)\nimport Data.Number as Number\nimport Data.String (Pattern(..), split, trim)\nimport Effect (Effect)\nimport Effect.Aff (Aff, launchAff_)\nimport Effect.Class (liftEffect)\nimport Effect.Console as Console\nimport PSD3.Shared.Data (DataFile(..), loadDataFile, parseCSVRow)\nimport PSD3.Expr.Integration (v3Attr, v3AttrStr)\nimport PSD3.Expr.Expr (lit, str)\nimport PSD3.Internal.Capabilities.Selection (select, renderTree)\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_)\nimport PSD3.Internal.Selection.Types (ElementType(..), SEmpty)\nimport PSD3.AST (Tree)\nimport PSD3.AST as T\nimport Web.DOM.Element (Element)\n\n-- | Radial Stacked Bar Chart - polar coordinates visualization\n-- |\n-- | Data: US population by state and age (all 50 states + DC)\n-- | Visual: States arranged in a circle, age groups stacked radially\n-- |\n-- | Key concepts: Polar coordinates, arc paths, radial stacking, nestedJoin\n\ntype GroupedBarData =\n  { state :: String\n  , age :: String\n  , population :: Number\n  }\n\ntype AgeSegment =\n  { age :: String\n  , population :: Number\n  , innerRadius :: Number\n  , outerRadius :: Number\n  }\n\ntype StateData =\n  { state :: String\n  , stateIndex :: Int\n  , ageSegments :: Array AgeSegment\n  , totalPopulation :: Number\n  }\n\n-- | Parse CSV row into population data\nparsePopulationRow :: String -> Array GroupedBarData\nparsePopulationRow line =\n  case parseCSVRow line of\n    [ state, under5Str, age5to13Str, age14to17Str, age18to24Str, age25to44Str, age45to64Str, age65plusStr ] -> do\n      let\n        under5 = fromMaybe 0.0 $ Number.fromString (trim under5Str)\n        age5to13 = fromMaybe 0.0 $ Number.fromString (trim age5to13Str)\n        age14to17 = fromMaybe 0.0 $ Number.fromString (trim age14to17Str)\n        age18to24 = fromMaybe 0.0 $ Number.fromString (trim age18to24Str)\n        age25to44 = fromMaybe 0.0 $ Number.fromString (trim age25to44Str)\n        age45to64 = fromMaybe 0.0 $ Number.fromString (trim age45to64Str)\n        age65plus = fromMaybe 0.0 $ Number.fromString (trim age65plusStr)\n      [ { state: trim state, age: "<10", population: under5 + age5to13 * 0.5 }\n      , { state: trim state, age: "10-19", population: age5to13 * 0.5 + age14to17 }\n      , { state: trim state, age: "20-29", population: age18to24 + age25to44 * 0.25 }\n      , { state: trim state, age: "30-39", population: age25to44 * 0.5 }\n      , { state: trim state, age: "40-49", population: age25to44 * 0.25 }\n      , { state: trim state, age: "50-59", population: age45to64 * 0.6 }\n      , { state: trim state, age: "60-69", population: age45to64 * 0.4 }\n      , { state: trim state, age: "70-79", population: age65plus * 0.6 }\n      , { state: trim state, age: "\u226580", population: age65plus * 0.4 }\n      ]\n    _ -> []\n\n-- | Load population data from CSV\nloadPopulationData :: Aff (Array GroupedBarData)\nloadPopulationData = do\n  result <- loadDataFile USPopulationStateAgeCSV\n  case result of\n    Left err -> do\n      liftEffect $ Console.log $ "Failed to load population data: " <> err\n      pure []\n    Right body -> do\n      let lines = split (Pattern "\\n") body\n      let dataLines = Array.drop 1 lines -- Skip header\n      let parsed = Array.concatMap parsePopulationRow dataLines\n      liftEffect $ Console.log $ "Loaded " <> show (Array.length parsed) <> " population data points"\n      pure parsed\n\n-- Age group colors (Spectral scheme)\nageColors :: Array String\nageColors =\n  [ "#d53e4f" -- <10\n  , "#f46d43" -- 10-19\n  , "#fdae61" -- 20-29\n  , "#fee08b" -- 30-39\n  , "#e6f598" -- 40-49\n  , "#abdda4" -- 50-59\n  , "#66c2a5" -- 60-69\n  , "#3288bd" -- 70-79\n  , "#5e4fa2" -- \u226580\n  ]\n\n-- Get color for age group index\ngetAgeColor :: Int -> String\ngetAgeColor idx = fromMaybe "#999" $ Array.index ageColors idx\n\n-- Get color for age group name\ngetAgeColorByName :: String -> String\ngetAgeColorByName age = case age of\n  "<10" -> "#d53e4f"\n  "10-19" -> "#f46d43"\n  "20-29" -> "#fdae61"\n  "30-39" -> "#fee08b"\n  "40-49" -> "#e6f598"\n  "50-59" -> "#abdda4"\n  "60-69" -> "#66c2a5"\n  "70-79" -> "#3288bd"\n  "\u226580" -> "#5e4fa2"\n  _ -> "#999"\n\n-- Format large numbers with SI prefix (millions)\nformatSI :: Number -> String\nformatSI n =\n  if n >= 1000000.0 then show (n / 1000000.0) <> "M"\n  else show n\n\n-- Group data by state and calculate radial positions\nprepareRadialData :: Array GroupedBarData -> Array StateData\nprepareRadialData dataPoints =\n  let\n    grouped = groupBy (\\a b -> a.state == b.state) $ sortBy (compare `on` _.state) dataPoints\n\n    -- Find max total across ALL states for global scaling\n    allTotals = map (\\g -> sum $ map _.population $ NEA.toArray g) grouped\n    maxTotal = fromMaybe 1.0 $ maximum allTotals\n\n    innerRadius = 80.0\n    outerRadius = 300.0\n    radiusRange = outerRadius - innerRadius\n\n  in\n    Array.mapWithIndex (toStateData maxTotal innerRadius radiusRange) grouped\n  where\n  toStateData :: Number -> Number -> Number -> Int -> NEA.NonEmptyArray GroupedBarData -> StateData\n  toStateData maxTotal innerR radiusRange stateIndex group =\n    let\n      first = NEA.head group\n      points = NEA.toArray group\n      total = sum $ map _.population points\n\n      -- Calculate cumulative radii for stacking, scaled by global max\n      segments = Array.foldl\n        ( \\acc item ->\n            let\n              prevRadius = case Array.last acc.result of\n                Just prev -> prev.outerRadius\n                Nothing -> innerR\n              -- Scale by global max, not local total\n              thickness = (item.population / maxTotal) * radiusRange\n            in\n              { result: Array.snoc acc.result\n                  { age: item.age\n                  , population: item.population\n                  , innerRadius: prevRadius\n                  , outerRadius: prevRadius + thickness\n                  }\n              }\n        )\n        { result: [] }\n        points\n\n    in\n      { state: first.state\n      , stateIndex\n      , ageSegments: segments.result\n      , totalPopulation: total\n      }\n\n-- Create an arc path in SVG\n-- startAngle and endAngle in radians, innerRadius and outerRadius in pixels\narcPath :: Number -> Number -> Number -> Number -> String\narcPath startAngle endAngle innerRadius outerRadius =\n  let -- Outer arc\n    outerStartX = outerRadius * cos startAngle\n    outerStartY = outerRadius * sin startAngle\n    outerEndX = outerRadius * cos endAngle\n    outerEndY = outerRadius * sin endAngle\n\n    -- Inner arc\n    innerEndX = innerRadius * cos endAngle\n    innerEndY = innerRadius * sin endAngle\n    innerStartX = innerRadius * cos startAngle\n    innerStartY = innerRadius * sin startAngle\n\n    largeArc = if (endAngle - startAngle) > pi then 1 else 0\n\n  in\n    "M" <> show outerStartX <> "," <> show outerStartY\n      <> " A"\n      <> show outerRadius\n      <> ","\n      <> show outerRadius\n      <> " 0 "\n      <> show largeArc\n      <> ",1 "\n      <> show outerEndX\n      <> ","\n      <> show outerEndY\n      <> " L"\n      <> show innerEndX\n      <> ","\n      <> show innerEndY\n      <> " A"\n      <> show innerRadius\n      <> ","\n      <> show innerRadius\n      <> " 0 "\n      <> show largeArc\n      <> ",0 "\n      <> show innerStartX\n      <> ","\n      <> show innerStartY\n      <>\n        " Z"\n\n-- | Draw radial stacked bar chart with loaded data\ndrawRadialStackedBar :: String -> Array GroupedBarData -> Effect Unit\ndrawRadialStackedBar selector populationData = runD3v2M do\n  container <- select selector :: _ (D3v2Selection_ SEmpty Element Unit)\n\n  -- Prepare data\n  let\n    states = prepareRadialData populationData\n    stateCount = toNumber $ length states\n    anglePerState = (2.0 * pi) / stateCount\n\n    -- Calculate max total for grid lines\n    allTotals = map _.totalPopulation states\n    maxTotal = fromMaybe 1.0 $ maximum allTotals\n\n    -- Grid line values (25%, 50%, 75%, 100%)\n    gridValues = [ 0.25 * maxTotal, 0.5 * maxTotal, 0.75 * maxTotal, maxTotal ]\n\n    -- Age groups for legend\n    ageGroups = [ "<10", "10-19", "20-29", "30-39", "40-49", "50-59", "60-69", "70-79", "\u226580" ]\n\n    -- Radii\n    innerRadius = 80.0\n    outerRadius = 300.0\n    radiusRange = outerRadius - innerRadius\n\n    -- Helper to scale value to radius\n    radiusScale :: Number -> Number\n    radiusScale v = innerRadius + (v / maxTotal) * radiusRange\n\n    -- SVG dimensions\n    svgSize = 700.0\n    centerX = svgSize / 2.0\n    centerY = svgSize / 2.0\n\n    -- Helper to create grid line elements (circle + label with stroke outline)\n    makeGridLine :: Number -> Array (Tree Unit)\n    makeGridLine value =\n      let\n        gridRadius = radiusScale value\n      in\n        [ T.elem Circle\n            [ v3Attr "r" (lit gridRadius)\n            , v3AttrStr "stroke" (str "#000000")\n            , v3Attr "stroke-opacity" (lit 0.5)\n            , v3AttrStr "fill" (str "none")\n            , v3AttrStr "class" (str "grid-circle")\n            ]\n        , T.elem Text\n            [ v3Attr "y" (lit (-gridRadius))\n            , v3Attr "dy" (lit 5.6)\n            , v3AttrStr "text-content" (str (formatSI value))\n            , v3AttrStr "stroke" (str "#ffffff")\n            , v3Attr "stroke-width" (lit 5.0)\n            , v3AttrStr "fill" (str "none")\n            , v3AttrStr "class" (str "grid-label-bg")\n            ]\n        , T.elem Text\n            [ v3Attr "y" (lit (-gridRadius))\n            , v3Attr "dy" (lit 5.6)\n            , v3AttrStr "text-content" (str (formatSI value))\n            , v3AttrStr "fill" (str "#000000")\n            , v3AttrStr "class" (str "grid-label")\n            ]\n        ]\n\n    -- Helper to create legend items\n    makeLegendItem :: Int -> String -> Tree Unit\n    makeLegendItem idx age =\n      let\n        ageCount = length ageGroups\n        yOffset = (toNumber ageCount / 2.0 - toNumber idx - 1.0) * 20.0\n      in\n        T.named Group ("legend-" <> age)\n          [ v3AttrStr "transform" (str ("translate(-40," <> show yOffset <> ")"))\n          , v3AttrStr "class" (str "legend-item")\n          ]\n          `T.withChildren`\n            [ T.elem Rect\n                [ v3Attr "width" (lit 18.0)\n                , v3Attr "height" (lit 18.0)\n                , v3AttrStr "fill" (str (getAgeColorByName age))\n                ]\n            , T.elem Text\n                [ v3Attr "x" (lit 24.0)\n                , v3Attr "y" (lit 9.0)\n                , v3Attr "dy" (lit 5.6)\n                , v3AttrStr "text-content" (str age)\n                , v3AttrStr "class" (str "legend-label")\n                ]\n            ]\n\n  -- Build tree using nestedJoin\n  -- Note: The tree type is Unit because grid lines/legend are Unit, not StateData\n  let\n    tree :: Tree Unit\n    tree =\n      T.named SVG "svg"\n        [ v3Attr "width" (lit svgSize)\n        , v3Attr "height" (lit svgSize)\n        , v3AttrStr "viewBox" (str ("0 0 " <> show svgSize <> " " <> show svgSize))\n        , v3AttrStr "class" (str "radial-stacked-bar")\n        ]\n        `T.withChild`\n          ( T.named Group "plot-area"\n              [ v3AttrStr "transform" (str ("translate(" <> show centerX <> "," <> show centerY <> ")")) ]\n              `T.withChildren`\n                [ -- Circular grid lines\n                  T.named Group "y-axis" [ v3AttrStr "text-anchor" (str "middle") ]\n                    `T.withChildren`\n                      ( [ T.elem Text\n                            [ v3Attr "y" (lit (-(outerRadius + 10.0)))\n                            , v3Attr "font-size" (lit 12.0)\n                            , v3AttrStr "text-content" (str "Population")\n                            , v3AttrStr "class" (str "axis-label")\n                            ]\n                        ] <> Array.concatMap makeGridLine gridValues\n                      )\n                , -- Color legend\n                  T.named Group "legend" []\n                    `T.withChildren` (Array.mapWithIndex makeLegendItem ageGroups)\n                , -- Data arcs - manually build without nestedJoin to maintain Tree Unit type\n                  T.named Group "data-arcs" []\n                    `T.withChildren` (Array.concatMap makeStateArcs states)\n                , -- State labels\n                  T.named Group "state-labels" []\n                    `T.withChildren` (map makeStateLabel states)\n                ]\n          )\n\n    -- Helper to create arcs for a single state\n    makeStateArcs :: StateData -> Array (Tree Unit)\n    makeStateArcs stateData =\n      Array.mapWithIndex\n        ( \\ageIdx segment ->\n            let\n              stateIdx = stateData.stateIndex\n              startAngle = toNumber stateIdx * anglePerState - (pi / 2.0)\n              endAngle = startAngle + anglePerState\n            in\n              T.elem Path\n                [ v3AttrStr "d" (str (arcPath startAngle endAngle segment.innerRadius segment.outerRadius))\n                , v3AttrStr "fill" (str (getAgeColor ageIdx))\n                , v3AttrStr "class" (str "age-arc")\n                ]\n        )\n        stateData.ageSegments\n\n    -- Helper to create state label\n    makeStateLabel :: StateData -> Tree Unit\n    makeStateLabel stateData =\n      let\n        stateIdx = stateData.stateIndex\n        startAngle = toNumber stateIdx * anglePerState - (pi / 2.0)\n        labelAngle = startAngle + (anglePerState / 2.0)\n        labelRadius = 320.0\n        labelX = labelRadius * cos labelAngle\n        labelY = labelRadius * sin labelAngle\n        rotation = (labelAngle * 180.0 / pi) + 90.0\n      in\n        T.elem Text\n          [ v3Attr "x" (lit labelX)\n          , v3Attr "y" (lit labelY)\n          , v3AttrStr "text-anchor" (str "middle")\n          , v3Attr "font-size" (lit 10.0)\n          , v3AttrStr "transform" (str ("rotate(" <> show rotation <> " " <> show labelX <> " " <> show labelY <> ")"))\n          , v3AttrStr "text-content" (str stateData.state)\n          , v3AttrStr "class" (str "state-label")\n          ]\n\n  -- Render\n  _ <- renderTree container tree\n\n  liftEffect do\n    Console.log "=== Radial Stacked Bar Chart ==="\n    Console.log ""\n    Console.log ("States: " <> show (length states))\n    Console.log "All 50 US states + DC in polar coordinates"\n    Console.log ""\n\n-- | Main entry point - loads data then renders\nradialStackedBar :: String -> Effect Unit\nradialStackedBar selector = launchAff_ do\n  populationData <- loadPopulationData\n  liftEffect $ drawRadialStackedBar selector populationData\n\n';
  var snippet_partition_content = 'module D3.Viz.TreeAPI.PartitionViz where\n\nimport Prelude\n\nimport Data.Array as Array\nimport Data.Either (Either(..))\nimport Data.Maybe (Maybe(..))\nimport Effect (Effect)\nimport Effect.Aff (launchAff_)\nimport Effect.Class (liftEffect)\nimport Effect.Console as Console\nimport PSD3.Shared.Data (HierData, getName, getValue, getChildren, loadDataFile, DataFile(..), parseFlareJson)\nimport DataViz.Layout.Hierarchy.Partition (HierarchyData(..), PartitionNode(..), defaultPartitionConfig, hierarchy, partition)\nimport PSD3.Expr.Friendly (num, text, attr, viewBox, width, height, x, y, fill, stroke, strokeWidth, textAnchor, fontSize, textContent)\nimport PSD3.Internal.Capabilities.Selection (select, renderTree)\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_)\nimport PSD3.Internal.Selection.Types (ElementType(..), SEmpty)\nimport PSD3.AST as T\nimport Web.DOM.Element (Element)\n\n-- | Convert HierData to Partition\'s HierarchyData\n-- | Non-leaf nodes use Nothing for value so hierarchy computes sum of children\ntoHierarchyData :: HierData -> HierarchyData String\ntoHierarchyData node =\n  let\n    children = getChildren node\n    -- Only leaf nodes have explicit values; non-leaf nodes sum children\n    nodeValue = case children of\n      Nothing -> Just (getValue node)\n      Just _ -> Nothing\n  in\n    HierarchyData\n      { data_: getName node\n      , value: nodeValue\n      , children: map (map toHierarchyData) children\n      }\n\n-- | Color palette\ncolors :: Array String\ncolors = [ "#e7ba52", "#c7c7c7", "#aec7e8", "#1f77b4", "#9467bd" ]\n\ngetColor :: Int -> String\ngetColor depth = case colors Array.!! (depth `mod` Array.length colors) of\n  Just c -> c\n  Nothing -> "#cccccc"\n\n-- | Get all nodes (recursive traversal)\ngetAllNodes :: forall a. PartitionNode a -> Array (PartitionNode a)\ngetAllNodes node@(PartNode n) =\n  if Array.length n.children == 0 then [ node ]\n  else [ node ] <> (n.children >>= getAllNodes)\n\n-- | Draw partition (icicle diagram)\ndrawPartition :: String -> HierData -> Effect Unit\ndrawPartition selector flareData = runD3v2M do\n  container <- select selector :: _ (D3v2Selection_ SEmpty Element Unit)\n\n  -- Reduced from 900x600 to fit within tutorial-section max-width (832px)\n  let chartWidth = 750.0\n  let chartHeight = 500.0\n\n  -- Convert to HierarchyData\n  let hierData = toHierarchyData flareData\n\n  -- Convert to PartitionNode hierarchy\n  let partRoot = hierarchy hierData\n\n  -- Apply partition layout\n  let\n    config = defaultPartitionConfig\n      { size = { width: chartWidth, height: chartHeight }\n      , padding = 1.0\n      }\n  let partitioned = partition config partRoot\n\n  -- Get all nodes\n  let nodes = getAllNodes partitioned\n\n  liftEffect $ Console.log $ "Rendering partition: " <> show (Array.length nodes) <> " rectangles"\n\n  -- Build tree using TreeAPI\n  let\n    tree :: T.Tree (PartitionNode String)\n    tree =\n      T.named SVG "svg"\n        [ width $ num chartWidth\n        , height $ num chartHeight\n        , viewBox 0.0 0.0 chartWidth chartHeight\n        , attr "class" $ text "partition-viz"\n        ]\n        `T.withChild`\n          ( T.joinData "rects" "g" nodes $ \\(PartNode node) ->\n              T.named Group ("rect-" <> node.data_)\n                [ attr "class" $ text "node" ]\n                `T.withChildren`\n                  [ T.elem Rect\n                      [ x $ num node.x0\n                      , y $ num node.y0\n                      , width $ num (node.x1 - node.x0)\n                      , height $ num (node.y1 - node.y0)\n                      , fill $ text (getColor node.depth)\n                      , attr "fill-opacity" $ num 0.7\n                      , stroke $ text "#fff"\n                      , strokeWidth $ num 1.0\n                      ]\n                  , T.elem Text\n                      [ x $ num ((node.x0 + node.x1) / 2.0)\n                      , y $ num ((node.y0 + node.y1) / 2.0)\n                      , textContent $ text node.data_\n                      , textAnchor $ text "middle"\n                      , fontSize $ num 9.0\n                      , attr "fill-opacity" $ num (if (node.x1 - node.x0) > 30.0 && (node.y1 - node.y0) > 15.0 then 1.0 else 0.0)\n                      ]\n                  ]\n          )\n\n  _ <- renderTree container tree\n\n  liftEffect $ Console.log "=== Partition Layout (Icicle) ===="\n\n-- | Main entry point\npartitionViz :: String -> Effect Unit\npartitionViz selector = launchAff_ do\n  result <- loadDataFile FlareJSON\n  case result of\n    Left err -> liftEffect $ Console.log $ "Failed to load Flare data: " <> err\n    Right jsonString -> liftEffect $ drawPartition selector (parseFlareJson jsonString)\n';
  var snippet_pack_content = 'module D3.Viz.TreeAPI.PackViz where\n\nimport Prelude\n\nimport Data.Array as Array\nimport Data.Either (Either(..))\nimport Data.Maybe (Maybe(..))\nimport Effect (Effect)\nimport Effect.Aff (launchAff_)\nimport Effect.Class (liftEffect)\nimport Effect.Console as Console\nimport PSD3.Shared.Data (HierData, getName, getValue, getChildren, loadDataFile, DataFile(..), parseFlareJson)\nimport DataViz.Layout.Hierarchy.Pack (HierarchyData(..), PackNode(..), defaultPackConfig, hierarchy, pack)\nimport PSD3.Expr.Friendly (num, text, attr, viewBox, width, height, r, y, fill, stroke, strokeWidth, fontSize, textAnchor, transform)\nimport PSD3.Internal.Capabilities.Selection (select, renderTree)\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_)\nimport PSD3.Internal.Selection.Types (ElementType(..), SEmpty)\nimport PSD3.AST as T\nimport Web.DOM.Element (Element)\n\n-- | Convert HierData to Pack\'s HierarchyData\ntoHierarchyData :: HierData -> HierarchyData String\ntoHierarchyData node = HierarchyData\n  { data_: getName node\n  , value: Just (getValue node)\n  , children: map (map toHierarchyData) (getChildren node)\n  }\n\n-- | Simple color palette for depth-based coloring\ncolors :: Array String\ncolors =\n  [ "#e7ba52"\n  , "#c7c7c7"\n  , "#aec7e8"\n  , "#1f77b4"\n  , "#9467bd"\n  , "#8c564b"\n  , "#e377c2"\n  , "#7f7f7f"\n  , "#bcbd22"\n  , "#17becf"\n  ]\n\n-- | Get color by depth\ngetColor :: Int -> String\ngetColor depth =\n  let\n    idx = depth `mod` (Array.length colors)\n  in\n    case colors Array.!! idx of\n      Just c -> c\n      Nothing -> "#cccccc"\n\n-- | Get all nodes (recursive traversal)\ngetAllNodes :: forall a. PackNode a -> Array (PackNode a)\ngetAllNodes node@(PackNode n) =\n  if Array.length n.children == 0 then [ node ]\n  else [ node ] <> (n.children >>= getAllNodes)\n\n-- | Draw circle packing with loaded data\ndrawPack :: String -> HierData -> Effect Unit\ndrawPack selector flareData = runD3v2M do\n  container <- select selector :: _ (D3v2Selection_ SEmpty Element Unit)\n\n  -- Reduced from 1000 to fit within tutorial-section max-width (832px)\n  let chartSize = 700.0\n  let centerX = chartSize / 2.0\n  let centerY = chartSize / 2.0\n\n  -- Convert to HierarchyData\n  let hierData = toHierarchyData flareData\n\n  -- Convert to PackNode hierarchy\n  let packRoot = hierarchy hierData\n\n  -- Apply pack layout\n  let\n    config = defaultPackConfig\n      { size = { width: chartSize, height: chartSize }\n      , padding = 2.0\n      }\n  let packed = pack config packRoot\n\n  -- Get all nodes\n  let nodes = getAllNodes packed\n\n  liftEffect $ Console.log $ "Rendering circle pack: " <> show (Array.length nodes) <> " circles"\n\n  -- Build tree using TreeAPI\n  let\n    tree :: T.Tree (PackNode String)\n    tree =\n      T.named SVG "svg"\n        [ width $ num chartSize\n        , height $ num chartSize\n        , viewBox 0.0 0.0 chartSize chartSize\n        , attr "class" $ text "pack-viz"\n        ]\n        `T.withChild`\n          ( T.named Group "chartGroup"\n              [ attr "class" $ text "pack-content" ]\n              `T.withChild`\n                ( T.joinData "circles" "g" nodes $ \\(PackNode node) ->\n                    T.named Group ("circle-" <> node.data_)\n                      [ attr "class" $ text "node"\n                      , transform $ text ("translate(" <> show node.x <> "," <> show node.y <> ")")\n                      ]\n                      `T.withChildren`\n                        [ T.elem Circle\n                            [ r $ num node.r\n                            , fill $ text (getColor node.depth)\n                            , attr "fill-opacity" $ num 0.7\n                            , stroke $ text "#fff"\n                            , strokeWidth $ num 1.0\n                            ]\n                        , T.elem Text\n                            [ attr "text-content" $ text node.data_\n                            , textAnchor $ text "middle"\n                            , y $ num 4.0\n                            , fontSize $ num (if node.r > 20.0 then 10.0 else 8.0)\n                            , attr "fill-opacity" $ num (if node.r > 15.0 then 1.0 else 0.0) -- Hide text in small circles\n                            ]\n                        ]\n                )\n          )\n\n  -- Render\n  _ <- renderTree container tree\n\n  liftEffect do\n    Console.log "=== Circle Packing Layout (Tree API) ==="\n    Console.log ""\n    Console.log "Flare visualization toolkit hierarchy (circle packing)"\n    Console.log ""\n\n-- | Main entry point - loads Flare data then renders\npackViz :: String -> Effect Unit\npackViz selector = launchAff_ do\n  result <- loadDataFile FlareJSON\n  case result of\n    Left err -> liftEffect $ Console.log $ "Failed to load Flare data: " <> err\n    Right jsonString -> do\n      let hierData = parseFlareJson jsonString\n      liftEffect $ drawPack selector hierData\n';
  var snippet_nestedElements_content = 'module D3.Viz.TreeAPI.NestedElementsExample where\n\nimport Prelude\n\nimport Data.Map as Map\nimport Data.Maybe (Maybe(..))\nimport Effect (Effect)\nimport Effect.Class (liftEffect)\nimport Effect.Console as Console\nimport PSD3.Internal.Capabilities.Selection (select, renderTree)\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_)\nimport PSD3.Internal.Selection.Types (ElementType(..), SEmpty)\nimport PSD3.AST (Tree)\nimport PSD3.AST as T\nimport PSD3.Expr.Friendly (num, text, attr, viewBox, width, height, cx, cy, r, x, y, fill, stroke, strokeWidth, fontSize, textAnchor, textContent, transform)\nimport Web.DOM.Element (Element)\n\n-- | Test: Multi-level nested elements (Group \u2192 Circle + Text)\n-- |\n-- | This is the key pattern for visualizations - a container group with\n-- | multiple child elements (shape + label).\n-- |\n-- | This validates that withChildren works correctly and that we can\n-- | create the nested structures that were blocking code-explorer.\ntestNestedElements :: Effect Unit\ntestNestedElements = runD3v2M do\n  container <- select "#viz" :: _ (D3v2Selection_ SEmpty Element Unit)\n\n  -- Define a tree with MULTI-LEVEL NESTING\n  -- This is the pattern: Group \u2192 (Circle + Text)\n  let tree :: Tree Unit\n      tree =\n        T.named SVG "svg"\n          [ width $ num 600.0\n          , height $ num 400.0\n          , viewBox 0.0 0.0 600.0 400.0\n          , attr "id" $ text "nested-example-svg"\n          ]\n          `T.withChild`\n            (T.named Group "mainGroup" [attr "class" $ text "main-group"]\n              `T.withChildren`\n                -- Multiple node groups, each with Circle + Text\n                [ -- Node 1\n                  T.named Group "node1"\n                    [ attr "class" $ text "node"\n                    , transform $ text "translate(100, 100)"\n                    ]\n                    `T.withChildren`\n                      [ T.named Circle "node1Circle"\n                          [ cx $ num 0.0, cy $ num 0.0\n                          , r $ num 25.0\n                          , fill $ text "steelblue"\n                          , stroke $ text "white"\n                          , strokeWidth $ num 2.0\n                          ]\n                      , T.named Text "node1Label"\n                          [ x $ num 0.0, y $ num 40.0\n                          , textContent $ text "Node A"\n                          , textAnchor $ text "middle"\n                          , fontSize $ num 14.0\n                          ]\n                      ]\n\n                , -- Node 2\n                  T.named Group "node2"\n                    [ attr "class" $ text "node"\n                    , transform $ text "translate(300, 150)"\n                    ]\n                    `T.withChildren`\n                      [ T.named Circle "node2Circle"\n                          [ cx $ num 0.0, cy $ num 0.0\n                          , r $ num 20.0\n                          , fill $ text "orange"\n                          , stroke $ text "white"\n                          , strokeWidth $ num 2.0\n                          ]\n                      , T.named Text "node2Label"\n                          [ x $ num 0.0, y $ num 35.0\n                          , textContent $ text "Node B"\n                          , textAnchor $ text "middle"\n                          , fontSize $ num 14.0\n                          ]\n                      ]\n\n                , -- Node 3\n                  T.named Group "node3"\n                    [ attr "class" $ text "node"\n                    , transform $ text "translate(500, 100)"\n                    ]\n                    `T.withChildren`\n                      [ T.named Circle "node3Circle"\n                          [ cx $ num 0.0, cy $ num 0.0\n                          , r $ num 30.0\n                          , fill $ text "green"\n                          , stroke $ text "white"\n                          , strokeWidth $ num 2.0\n                          ]\n                      , T.named Text "node3Label"\n                          [ x $ num 0.0, y $ num 45.0\n                          , textContent $ text "Node C"\n                          , textAnchor $ text "middle"\n                          , fontSize $ num 14.0\n                          ]\n                      ]\n                ])\n\n  -- Render the tree\n  selections <- renderTree container tree\n\n  liftEffect do\n    Console.log "=== Nested Elements Test ==="\n    Console.log ""\n    Console.log "Structure: SVG \u2192 Group \u2192 (Node1, Node2, Node3)"\n    Console.log "           Each Node \u2192 (Circle + Text)"\n    Console.log ""\n\n    -- Verify all selections\n    let checkSelection name = case Map.lookup name selections of\n          Just _ -> Console.log $ "\u2713 " <> name\n          Nothing -> Console.log $ "\u2717 Missing: " <> name\n\n    Console.log "Top-level:"\n    checkSelection "svg"\n    checkSelection "mainGroup"\n\n    Console.log "\\nNode 1 (steelblue at 100, 100):"\n    checkSelection "node1"\n    checkSelection "node1Circle"\n    checkSelection "node1Label"\n\n    Console.log "\\nNode 2 (orange at 300, 150):"\n    checkSelection "node2"\n    checkSelection "node2Circle"\n    checkSelection "node2Label"\n\n    Console.log "\\nNode 3 (green at 500, 100):"\n    checkSelection "node3"\n    checkSelection "node3Circle"\n    checkSelection "node3Label"\n\n    Console.log $ "\\n" <> show (Map.size selections) <> " total selections in map"\n\n    Console.log "\\n=== SUCCESS CRITERIA ==="\n    Console.log "\u2713 Multi-level nesting works (Group \u2192 Circle + Text)"\n    Console.log "\u2713 withChildren handles arrays of subtrees"\n    Console.log "\u2713 All named nodes are accessible via Map"\n    Console.log ""\n    Console.log "NEXT: Need data joins to generate this structure from Array data"\n    Console.log "      instead of manually creating each node."\n';
  var snippet_multiLineChart_content = 'module D3.Viz.TreeAPI.MultiLineChartExample where\n\nimport Prelude\n\nimport Data.Array (findIndex, groupBy, length, mapMaybe, sortBy, uncons)\nimport Data.Array as Data.Array\nimport Data.Array.NonEmpty as NEA\nimport Data.Either (Either(..))\nimport Data.Foldable (maximum, foldl)\nimport Data.Function (on) as F\nimport Data.Int (toNumber)\nimport Data.Maybe (Maybe(..), fromMaybe)\nimport Data.Number as Number\nimport Data.String (Pattern(..), split, trim)\nimport Effect (Effect)\nimport Effect.Aff (Aff, launchAff_)\nimport Effect.Class (liftEffect)\nimport Effect.Console as Console\nimport PSD3.Shared.Data (DataFile(..), loadDataFile, parseCSVRow)\n-- v3 Integration: all attributes via v3Attr/v3AttrStr (no ToAttr typeclass)\nimport PSD3.Expr.Integration (v3Attr, v3AttrStr, v3AttrFnStr)\nimport PSD3.Expr.Expr (lit, str)\nimport PSD3.Axis.Axis (axisBottom, axisLeft, renderAxis, Scale)\nimport PSD3.Internal.Capabilities.Selection (select, renderTree, on)\nimport PSD3.Internal.Behavior.Types (onMouseLeaveWithInfo, onMouseMoveWithInfo, MouseEventInfo)\nimport Data.Map as Map\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_)\nimport PSD3.Internal.Selection.Types (ElementType(..), SEmpty)\nimport PSD3.AST (Tree, joinData)\nimport PSD3.AST as T\nimport PSD3.Tooltip (showTooltip, hideTooltip)\nimport Web.DOM.Element (Element)\nimport Effect.Ref as Ref\nimport Data.Maybe (Maybe(..)) as Maybe\n\n-- | Multi-line chart showing unemployment rates over time for US metro areas\n-- |\n-- | Data: BLS metro area unemployment data (42 cities, 2000-2013)\n-- | Visual: Many light gray lines that highlight dark on hover\n-- |\n-- | Key concept: Hover interaction makes dense overlapping data readable\n\ntype DataPoint =\n  { date :: String     -- Date string (YYYY-MM-DD)\n  , division :: String -- Metro area name\n  , rate :: Number     -- Unemployment rate (percentage)\n  }\n\ntype Series =\n  { division :: String\n  , points :: Array DataPoint\n  }\n\n-- Parse CSV row into DataPoint using centralized CSV parser\nparseDataPoint :: String -> Maybe DataPoint\nparseDataPoint line =\n  case parseCSVRow line of\n    [division, date, rateStr] -> do\n      rate <- Number.fromString (trim rateStr)\n      pure { division: trim division, date: trim date, rate }\n    _ -> Nothing\n\n-- Load and parse CSV data using centralized loader\nloadUnemploymentData :: Aff (Array DataPoint)\nloadUnemploymentData = do\n  result <- loadDataFile MetroUnemploymentCSV\n  case result of\n    Left err -> do\n      liftEffect $ Console.log $ "Failed to load unemployment data: " <> err\n      pure []\n    Right body -> do\n      let lines = split (Pattern "\\n") body\n      let dataLines = Data.Array.drop 1 lines  -- Skip header\n      let parsed = mapMaybe parseDataPoint dataLines\n      liftEffect $ Console.log $ "Loaded " <> show (length parsed) <> " unemployment data points"\n      pure parsed\n\n-- Group data by division\ngroupByDivision :: Array DataPoint -> Array Series\ngroupByDivision dataPoints =\n  let grouped = groupBy (\\a b -> a.division == b.division) $ sortBy (compare `F.on` _.division) dataPoints\n      toSeries group =\n        let first = NEA.head group\n            points = NEA.toArray group\n        in { division: first.division\n           , points: sortBy (compare `F.on` _.date) points\n           }\n  in map toSeries grouped\n\n-- FFI for setTimeout/clearTimeout\nforeign import setTimeout_ :: Effect Unit -> Int -> Effect Int\nforeign import clearTimeout_ :: Int -> Effect Unit\n\n-- Draw the multi-line chart with loaded data\ndrawMultiLineChart :: String -> Array DataPoint -> Effect Unit\ndrawMultiLineChart selector unemploymentData = runD3v2M do\n  container <- select selector :: _ (D3v2Selection_ SEmpty Element Unit)\n\n  -- Timeout ref for debounced tooltip hiding\n  hideTimeoutRef <- liftEffect $ Ref.new (Maybe.Nothing :: Maybe.Maybe Int)\n\n  -- Chart dimensions\n  let margin = { top: 20.0, right: 20.0, bottom: 50.0, left: 60.0 }\n      svgWidth = 928.0\n      svgHeight = 600.0\n      plotWidth = svgWidth - margin.left - margin.right\n      plotHeight = svgHeight - margin.top - margin.bottom\n\n      -- Get all unique dates for x-axis\n      allDates = Data.Array.nub $ map _.date unemploymentData\n      dateCount = toNumber $ length allDates\n\n      -- Scales\n      xScale :: Scale\n      xScale = { domain: { min: 0.0, max: dateCount - 1.0 }, range: { min: 0.0, max: plotWidth } }\n\n      maxRate = fromMaybe 20.0 $ maximum $ map _.rate unemploymentData\n      yScale :: Scale\n      yScale = { domain: { min: 0.0, max: maxRate }, range: { min: plotHeight, max: 0.0 } }\n\n      -- Scale helpers\n      scaleX :: String -> Number\n      scaleX date =\n        let idx = fromMaybe 0 $ findIndex (\\d -> d == date) allDates\n            value = toNumber idx\n            domainSpan = xScale.domain.max - xScale.domain.min\n            rangeSpan = xScale.range.max - xScale.range.min\n            normalized = (value - xScale.domain.min) / domainSpan\n        in xScale.range.min + (normalized * rangeSpan)\n\n      scaleY :: Number -> Number\n      scaleY rate =\n        let domainSpan = yScale.domain.max - yScale.domain.min\n            rangeSpan = yScale.range.max - yScale.range.min\n            normalized = (rate - yScale.domain.min) / domainSpan\n        in yScale.range.min + (normalized * rangeSpan)\n\n      -- Build path string for a series\n      linePath :: Array DataPoint -> String\n      linePath points =\n        case uncons points of\n          Nothing -> ""\n          Just { head: first, tail: rest } ->\n            let moveCmd = "M" <> show (scaleX first.date) <> "," <> show (scaleY first.rate)\n                lineSegments = map (\\p -> "L" <> show (scaleX p.date) <> "," <> show (scaleY p.rate)) rest\n            in moveCmd <> foldl (\\acc seg -> acc <> seg) "" lineSegments\n\n      -- Group data by division\n      series = groupByDivision unemploymentData\n\n  -- Build the tree using v3 attributes exclusively\n  let tree :: Tree Series\n      tree =\n        T.named SVG "svg"\n          [ v3Attr "width" (lit svgWidth)\n          , v3Attr "height" (lit svgHeight)\n          , v3AttrStr "viewBox" (str $ "0 0 " <> show svgWidth <> " " <> show svgHeight)\n          , v3AttrStr "class" (str "multi-line-chart")  -- This class enables hover CSS\n          ]\n          `T.withChild`\n            (T.named Group "plot-area"\n              [ v3AttrStr "transform" (str $ "translate(" <> show margin.left <> "," <> show margin.top <> ")") ]\n              `T.withChildren`\n                [ -- X-axis\n                  T.named Group "x-axis"\n                    [ v3AttrStr "transform" (str $ "translate(0," <> show plotHeight <> ")")\n                    , v3AttrStr "class" (str "x-axis")\n                    ]\n                    `T.withChild` renderAxis (axisBottom xScale)\n\n                , -- Y-axis\n                  T.named Group "y-axis"\n                    [ v3AttrStr "class" (str "y-axis") ]\n                    `T.withChild` renderAxis (axisLeft yScale)\n\n                , -- Y-axis label\n                  T.elem Text\n                    [ v3AttrStr "transform" (str "rotate(-90)")\n                    , v3Attr "x" (lit (-(plotHeight / 2.0)))\n                    , v3Attr "y" (lit (-40.0))\n                    , v3AttrStr "text-anchor" (str "middle")\n                    , v3Attr "font-size" (lit 12.0)\n                    , v3AttrStr "textContent" (str "Unemployment Rate (%)")\n                    ]\n\n                , -- Lines with hover interaction (CSS: .multi-line-chart .line:hover)\n                  -- All lines are light gray (#ddd), dark gray (#333) on hover\n                  joinData "lines" "path" series $ \\_ ->\n                    T.elem Path\n                      [ v3AttrFnStr "d" (\\s -> linePath s.points)\n                      , v3AttrStr "fill" (str "none")\n                      , v3AttrStr "stroke" (str "#ddd")  -- Light gray for all lines\n                      , v3Attr "stroke-width" (lit 1.5)\n                      , v3AttrStr "class" (str "line")  -- CSS uses .multi-line-chart .line for hover\n                      ]\n                ])\n\n  -- Render and get selections\n  selections <- renderTree container tree\n\n  -- Helper to find nearest point by offsetX\n  let findNearestPoint :: Series -> Number -> Maybe DataPoint\n      findNearestPoint s mouseX = do\n        -- Adjust for margin to get plot-relative x\n        let plotX = mouseX - margin.left\n        -- Sort points by date (x position)\n        let sortedPoints = sortBy (compare `F.on` _.date) s.points\n        -- Find nearest by comparing scaled x positions\n        let withDistances = sortedPoints # map \\p ->\n              { point: p, dist: Number.abs (scaleX p.date - plotX) }\n        case Data.Array.head (sortBy (compare `F.on` _.dist) withDistances) of\n          Just { point } -> Just point\n          Nothing -> Nothing\n\n  -- Attach hover with tooltip to lines\n  -- Visual highlighting is handled by CSS (.multi-line-chart .line:hover)\n  -- Tooltip is handled by PureScript via onMouseMoveWithInfo/onMouseLeaveWithInfo\n  -- We use a debounced hide to avoid flickering from tiny mouse movements\n  case Map.lookup "lines" selections of\n    Just linesSel -> do\n      -- Use onMouseMoveWithInfo to continuously update tooltip as mouse moves along line\n      _ <- on (onMouseMoveWithInfo \\(info :: MouseEventInfo Series) -> do\n        -- Cancel any pending hide timeout\n        maybeTimeout <- Ref.read hideTimeoutRef\n        case maybeTimeout of\n          Maybe.Just timeoutId -> do\n            clearTimeout_ timeoutId\n            Ref.write Maybe.Nothing hideTimeoutRef\n          Maybe.Nothing -> pure unit\n\n        -- Find nearest point based on mouse x position\n        case findNearestPoint info.datum info.offsetX of\n          Maybe.Just point -> do\n            let content = "<strong>" <> info.datum.division <> "</strong><br/>"\n                       <> point.date <> ": " <> show point.rate <> "%"\n            showTooltip content info.pageX info.pageY\n          Maybe.Nothing -> pure unit\n        ) linesSel\n\n      -- Use onMouseLeaveWithInfo to hide tooltip with a small delay\n      -- This provides a buffer so tiny mouse movements don\'t immediately cancel the tooltip\n      _ <- on (onMouseLeaveWithInfo \\(_ :: MouseEventInfo Series) -> do\n        -- Set a timeout to hide after 150ms\n        timeoutId <- setTimeout_ hideTooltip 150\n        Ref.write (Maybe.Just timeoutId) hideTimeoutRef\n        ) linesSel\n\n      pure unit\n    Nothing -> pure unit\n\n  liftEffect do\n    Console.log "=== Multi-Line Chart ==="\n    Console.log ""\n    Console.log ("Metro areas: " <> show (length series))\n    Console.log ("Data points: " <> show (length unemploymentData))\n    Console.log ""\n\n-- Main entry point - loads data then renders\nmultiLineChart :: String -> Effect Unit\nmultiLineChart selector = launchAff_ do\n  unemploymentData <- loadUnemploymentData\n  liftEffect $ drawMultiLineChart selector unemploymentData\n\n';
  var snippet_lineChart_content = 'module D3.Viz.TreeAPI.LineChartExample where\n\nimport Prelude\n\nimport Data.Array (length, mapWithIndex, range)\nimport Data.Foldable (maximum, minimum)\nimport Data.Int as Int\nimport Data.Map as Map\nimport Data.Maybe (Maybe(..), fromMaybe)\nimport Data.String (joinWith)\nimport Effect (Effect)\nimport Effect.Class (liftEffect)\nimport Effect.Console as Console\nimport PSD3.Expr.Friendly (num, text, attr, viewBox, width, height, fill, stroke, strokeWidth, transform, path)\nimport PSD3.Internal.Capabilities.Selection (select, renderTree)\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_)\nimport PSD3.Internal.Selection.Types (ElementType(..), SEmpty)\nimport PSD3.AST (Tree)\nimport PSD3.AST as T\nimport Web.DOM.Element (Element)\n\n-- | Data point\ntype Point = { x :: Number, y :: Number }\n\n-- | Sample line data (sine wave)\nlineData :: Array Point\nlineData = mapWithIndex (\\i _ ->\n  let x = (Int.toNumber i) * 0.1\n      y = sin(x * pi) * 50.0 + 50.0\n  in { x, y }\n) (range 0 62)\n\n-- FFI for Math functions\nforeign import sin :: Number -> Number\nforeign import pi :: Number\n\n-- | Chart dimensions\ntype Dimensions =\n  { width :: Number\n  , height :: Number\n  , marginTop :: Number\n  , marginRight :: Number\n  , marginBottom :: Number\n  , marginLeft :: Number\n  }\n\ndefaultDims :: Dimensions\ndefaultDims =\n  { width: 600.0\n  , height: 300.0\n  , marginTop: 20.0\n  , marginRight: 20.0\n  , marginBottom: 40.0\n  , marginLeft: 50.0\n  }\n\ninnerWidth :: Dimensions -> Number\ninnerWidth dims = dims.width - dims.marginLeft - dims.marginRight\n\ninnerHeight :: Dimensions -> Number\ninnerHeight dims = dims.height - dims.marginTop - dims.marginBottom\n\n-- | Generate SVG path data string from points\npointsToPath :: Dimensions -> Array Point -> Number -> Number -> Number -> Number -> String\npointsToPath dims points minX maxX minY maxY =\n  let iWidth = innerWidth dims\n      iHeight = innerHeight dims\n      xScale val = ((val - minX) / (maxX - minX)) * iWidth\n      yScale val = iHeight - ((val - minY) / (maxY - minY)) * iHeight\n\n      toCommand :: Int -> Point -> String\n      toCommand 0 p = "M " <> show (xScale p.x) <> " " <> show (yScale p.y)\n      toCommand _ p = "L " <> show (xScale p.x) <> " " <> show (yScale p.y)\n  in\n    joinWith " " (mapWithIndex toCommand points)\n\n-- | Line chart using declarative tree API\nlineChart :: Effect Unit\nlineChart = runD3v2M do\n  container <- select "#viz" :: _ (D3v2Selection_ SEmpty Element Unit)\n\n  let dims = defaultDims\n\n  -- Calculate data extents\n  let xValues = map _.x lineData\n  let yValues = map _.y lineData\n  let minX = fromMaybe 0.0 $ minimum xValues\n  let maxX = fromMaybe 10.0 $ maximum xValues\n  let minY = fromMaybe 0.0 $ minimum yValues\n  let maxY = fromMaybe 100.0 $ maximum yValues\n\n  -- Generate path data\n  let pathData = pointsToPath dims lineData minX maxX minY maxY\n\n  -- Define the tree structure\n  let tree :: Tree Unit\n      tree =\n        T.named SVG "svg"\n          [ width $ num dims.width\n          , height $ num dims.height\n          , viewBox 0.0 0.0 dims.width dims.height\n          , attr "class" $ text "line-chart-tree"\n          ]\n          `T.withChild`\n            (T.named Group "chartGroup"\n              [ attr "class" $ text "chart-content"\n              , transform $ text ("translate(" <> show dims.marginLeft <> "," <> show dims.marginTop <> ")")\n              ]\n              `T.withChild`\n                -- Single path element for the line\n                (T.named Path "line"\n                  [ path $ text pathData\n                  , fill $ text "none"\n                  , stroke $ text "#2ecc71"\n                  , strokeWidth $ num 2.0\n                  , attr "class" $ text "line"\n                  ]\n                ))\n\n  -- Render the tree\n  selections <- renderTree container tree\n\n  liftEffect do\n    Console.log "=== Line Chart (Tree API) ==="\n    Console.log ""\n    Console.log $ "Rendered line with " <> show (length lineData) <> " points"\n\n    case Map.lookup "svg" selections of\n      Just _ -> Console.log "\u2713 SVG created"\n      Nothing -> Console.log "\u2717 Missing SVG"\n\n    case Map.lookup "chartGroup" selections of\n      Just _ -> Console.log "\u2713 Chart group created"\n      Nothing -> Console.log "\u2717 Missing chart group"\n\n    case Map.lookup "line" selections of\n      Just _ -> Console.log "\u2713 Line path created"\n      Nothing -> Console.log "\u2717 Missing line path"\n\n    Console.log ""\n    Console.log "Expected: Green sine wave curve"\n';
  var snippet_lesMis_content = '-- | Les Mis\xE9rables Force-Directed Graph (V3 Architecture)\n-- |\n-- | A clean, simple force-directed graph using the ForceEngine library.\n-- | Uses TreeAPI with declarative behaviors for rendering.\n-- |\n-- | NO FFI in this demo - all D3 interaction goes through library modules.\nmodule D3.Viz.LesMisV3.Draw\n  ( startLesMis\n  ) where\n\nimport Prelude\n\nimport D3.Viz.LesMisV3.Model (LesMisModel, LesMisNode)\nimport Data.Number (sqrt)\nimport Effect (Effect)\nimport Effect.Class (liftEffect)\nimport Effect.Ref as Ref\nimport PSD3.ForceEngine.Simulation as Sim\nimport PSD3.ForceEngine.Types (ForceSpec(..), defaultManyBody, defaultCollide, defaultLink, defaultCenter)\nimport PSD3.ForceEngine.Links (swizzleLinks)\nimport PSD3.Scale (schemeCategory10At)\nimport PSD3.Expr.Friendly (num, text, attr, viewBox, width, height, r, stroke, strokeWidth, opacity, from, fromStr)\nimport PSD3.Internal.Behavior.FFI as BehaviorFFI\nimport PSD3.Internal.Behavior.Types (Behavior(..), DragConfig(..), ScaleExtent(..), defaultZoom)\nimport PSD3.Internal.Capabilities.Selection (select, renderTree)\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_)\nimport PSD3.Internal.Selection.Types (ElementType(..), SEmpty)\nimport PSD3.AST as T\nimport Web.DOM.Element (Element)\n\n-- =============================================================================\n-- Types\n-- =============================================================================\n\n-- | Swizzled link (source/target are node references, not indices)\ntype SwizzledLink =\n  { source :: LesMisNode\n  , target :: LesMisNode\n  , value :: Number\n  , index :: Int\n  }\n\n-- =============================================================================\n-- Constants\n-- =============================================================================\n\nsvgWidth :: Number\nsvgWidth = 900.0\n\nsvgHeight :: Number\nsvgHeight = 600.0\n\n-- | Simulation ID for the registry\n-- | Separate from GUPDemo to avoid interference\nsimulationId :: String\nsimulationId = "lesmis-main"\n\n-- =============================================================================\n-- Entry Point\n-- =============================================================================\n\n-- | Clone a node to create an independent copy\n-- | This prevents mutations (like fx/fy from drag) from affecting other simulations\ncloneNode :: LesMisNode -> LesMisNode\ncloneNode n = { id: n.id, name: n.name, group: n.group, x: n.x, y: n.y, vx: n.vx, vy: n.vy, fx: n.fx, fy: n.fy }\n\n-- | Start the Les Mis\xE9rables force-directed graph\n-- | Returns a cleanup function to stop the simulation\nstartLesMis :: LesMisModel -> String -> Effect (Effect Unit)\nstartLesMis model containerSelector = do\n  -- Clone nodes to have independent data from other visualizations\n  let clonedNodes = map cloneNode model.nodes\n\n  -- Swizzle links using cloned nodes\n  let swizzledLinks = swizzleLinks clonedNodes model.links \\src tgt i link ->\n        { source: src, target: tgt, index: i, value: link.value }\n\n  -- Create simulation using library API\n  sim <- Sim.create Sim.defaultConfig\n  Sim.setNodes clonedNodes sim\n  Sim.setLinks model.links sim\n\n  -- Register simulation for declarative drag\n  BehaviorFFI.registerSimulation_ simulationId (Sim.reheat sim)\n\n  -- Add forces using declarative ForceSpec\n  Sim.addForce (ManyBody "charge" defaultManyBody { strength = -100.0, distanceMax = 500.0 }) sim\n  Sim.addForce (Collide "collision" defaultCollide { radius = 5.0, strength = 1.0, iterations = 1 }) sim\n  Sim.addForce (Center "center" defaultCenter { x = 0.0, y = 0.0, strength = 0.1 }) sim\n  Sim.addForce (Link "links" defaultLink { distance = 30.0, strength = 0.5, iterations = 1 }) sim\n\n  -- Create state ref for tick updates\n  stateRef <- Ref.new { nodes: clonedNodes, links: swizzledLinks }\n\n  -- Render initial SVG structure using TreeAPI\n  runD3v2M do\n    container <- select containerSelector :: _ (D3v2Selection_ SEmpty Element Unit)\n    let containerTree :: T.Tree Unit\n        containerTree =\n          T.named SVG "svg"\n            [ width $ num svgWidth\n            , height $ num svgHeight\n            , viewBox ((-svgWidth) / 2.0) ((-svgHeight) / 2.0) svgWidth svgHeight\n            , attr "id" $ text "lesmis-v3-svg"\n            , attr "class" $ text "lesmis-v3"\n            ]\n            `T.withBehaviors` [ Zoom $ defaultZoom (ScaleExtent 0.1 10.0) "#lesmis-zoom-group" ]\n            `T.withChildren`\n              [ T.named Group "zoom-group" [ attr "id" $ text "lesmis-zoom-group", attr "class" $ text "zoom-group" ]\n                  `T.withChildren`\n                    [ T.named Group "links" [ attr "id" $ text "lesmis-links", attr "class" $ text "links" ]\n                    , T.named Group "nodes" [ attr "id" $ text "lesmis-nodes", attr "class" $ text "nodes" ]\n                    ]\n              ]\n    _ <- renderTree container containerTree\n    pure unit\n\n  -- Set tick callback to update DOM using TreeAPI\n  Sim.onTick (updateDOM stateRef) sim\n\n  -- Start simulation\n  Sim.start sim\n\n  -- Return cleanup function (also unregisters simulation)\n  pure do\n    Sim.stop sim\n    BehaviorFFI.unregisterSimulation_ simulationId\n\n-- =============================================================================\n-- DOM Updates (on each tick) - using TreeAPI\n-- =============================================================================\n\n-- | Update DOM positions based on current node positions\n-- | Called on each simulation tick\nupdateDOM :: Ref.Ref { nodes :: Array LesMisNode, links :: Array SwizzledLink } -> Effect Unit\nupdateDOM stateRef = runD3v2M do\n  state <- liftEffect $ Ref.read stateRef\n\n  -- Select the groups\n  linksGroup <- select "#lesmis-links" :: _ (D3v2Selection_ SEmpty Element Unit)\n  nodesGroup <- select "#lesmis-nodes" :: _ (D3v2Selection_ SEmpty Element Unit)\n\n  -- Render links\n  let linksTree = T.joinData "links" "line" state.links $ \\_ ->\n        T.elem Line\n          [ from "x1" (_.source.x :: SwizzledLink -> Number)\n          , from "y1" (_.source.y :: SwizzledLink -> Number)\n          , from "x2" (_.target.x :: SwizzledLink -> Number)\n          , from "y2" (_.target.y :: SwizzledLink -> Number)\n          , from "stroke-width" ((\\link -> sqrt link.value) :: SwizzledLink -> Number)\n          , stroke $ text "#999"\n          , opacity $ num 0.6\n          ]\n  _ <- renderTree linksGroup linksTree\n\n  -- Render nodes with drag behavior\n  let nodesTree = T.joinData "nodes" "circle" state.nodes $ \\_ ->\n        T.elem Circle\n          [ from "cx" (_.x :: LesMisNode -> Number)\n          , from "cy" (_.y :: LesMisNode -> Number)\n          , r $ num 5.0\n          , fromStr "fill" ((\\node -> schemeCategory10At node.group) :: LesMisNode -> String)\n          , stroke $ text "#fff"\n          , strokeWidth $ num 1.5\n          ]\n          `T.withBehaviors` [ Drag (SimulationDrag simulationId) ]\n  _ <- renderTree nodesGroup nodesTree\n\n  pure unit\n';
  var snippet_horizontalTree_content = `module D3.Viz.TreeAPI.HorizontalTreeViz where

import Prelude

import Data.Array as Array
import Data.Either (Either(..))
import Data.List (List(..))
import Control.Comonad.Cofree (head, tail)
import Data.Tree (Tree, mkTree)
import Effect (Effect)
import Effect.Aff (launchAff_)
import Effect.Class (liftEffect)
import Effect.Console as Console
import PSD3.Shared.Data (loadFlareData)
import DataViz.Layout.Hierarchy.Tree (tree, defaultTreeConfig)
import PSD3.Expr.Friendly (num, text, attr, viewBox, width, height, cx, cy, r, x, y, fill, stroke, strokeWidth, path, textAnchor, fontSize, textContent)
import PSD3.Internal.Capabilities.Selection (select, renderTree)
import PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_, reselectD3v2)
import PSD3.Internal.Selection.Types (ElementType(..), SEmpty)
import PSD3.AST as T
import Web.DOM.Element (Element)

-- | Hierarchy node type (matches loadFlareData output)
type HierNode = { name :: String, value :: Number, x :: Number, y :: Number, depth :: Int, height :: Int }

-- | Link data type
type LinkDatum = { source :: { x :: Number, y :: Number }, target :: { x :: Number, y :: Number } }

-- | Swap x and y coordinates for horizontal orientation
swapXY :: forall r. Tree { x :: Number, y :: Number | r } -> Tree { x :: Number, y :: Number | r }
swapXY t =
  let
    val = head t
    children = tail t
    swappedChildren = map swapXY children
  in
    mkTree (val { x = val.y, y = val.x }) swappedChildren

-- | Create links from parent to children
makeLinks
  :: forall r
   . Tree { x :: Number, y :: Number | r }
  -> Array { source :: { x :: Number, y :: Number }, target :: { x :: Number, y :: Number } }
makeLinks tree' = Array.fromFoldable $ makeLinksList tree'
  where
  makeLinksList
    :: Tree { x :: Number, y :: Number | r }
    -> List { source :: { x :: Number, y :: Number }, target :: { x :: Number, y :: Number } }
  makeLinksList t =
    let
      val = head t
      children = tail t
      childLinks = children >>= \\child ->
        let childVal = head child
        in Cons { source: { x: val.x, y: val.y }, target: { x: childVal.x, y: childVal.y } } Nil
      grandchildLinks = children >>= makeLinksList
    in
      childLinks <> grandchildLinks

-- | Horizontal link path generator (draws from left to right)
linkPath :: Number -> Number -> Number -> Number -> String
linkPath x1' y1' x2' y2' =
  "M" <> show x1' <> "," <> show y1'
    <> "C"
    <> show ((x1' + x2') / 2.0)
    <> ","
    <> show y1'
    <> " "
    <> show ((x1' + x2') / 2.0)
    <> ","
    <> show y2'
    <> " "
    <> show x2'
    <> ","
    <> show y2'

-- | Draw horizontal tree hierarchy with loaded data
drawHorizontalTree :: String -> Tree HierNode -> Effect Unit
drawHorizontalTree selector flareTree = runD3v2M do
  container <- select selector :: _ (D3v2Selection_ SEmpty Element Unit)

  -- Reduced from 1200x800 to fit within tutorial-section max-width (832px)
  let chartWidth = 750.0
  let chartHeight = 500.0
  let padding = 40.0

  -- Apply Tree layout with swapped dimensions
  -- For horizontal tree, we swap width/height so the tree grows left-to-right
  let
    config = defaultTreeConfig
      { size =
          { width: chartHeight - (2.0 * padding)
          , height: chartWidth - (2.0 * padding)
          }
      }
  let positioned = tree config flareTree

  -- Swap x and y for horizontal orientation
  let horizontalTree = swapXY positioned

  -- Flatten to arrays
  let nodes = Array.fromFoldable horizontalTree
  let links = makeLinks horizontalTree

  liftEffect $ Console.log $ "Rendering horizontal tree: " <> show (Array.length nodes) <> " nodes, " <> show (Array.length links) <> " links"

  -- First tree: SVG container with links (datum type: link data)
  let
    linksTree :: T.Tree LinkDatum
    linksTree =
      T.named SVG "svg"
        [ width $ num chartWidth
        , height $ num chartHeight
        , viewBox 0.0 0.0 chartWidth chartHeight
        , attr "class" $ text "horizontal-tree-viz"
        ]
        \`T.withChild\`
          ( T.named Group "chartGroup"
              [ attr "class" $ text "tree-content" ]
              \`T.withChild\`
                ( T.named Group "linksGroup"
                    [ attr "class" $ text "links" ]
                    \`T.withChild\`
                      ( T.joinData "links" "path" links $ \\link ->
                          T.elem Path
                            [ path $ text ( linkPath
                                    (link.source.x + padding)
                                    (link.source.y + padding)
                                    (link.target.x + padding)
                                    (link.target.y + padding)
                                )
                            , fill $ text "none"
                            , stroke $ text "#999"
                            , strokeWidth $ num 1.5
                            , attr "class" $ text "link"
                            ]
                      )
                )
          )

  -- Render links first (underlaying)
  linksSelections <- renderTree container linksTree

  -- Second tree: Nodes on top (datum type: HierNode)
  -- Reselect the chartGroup from rendered selections (not global CSS selector!)
  chartGroupSel <- liftEffect $ reselectD3v2 "chartGroup" linksSelections

  let
    nodesTree :: T.Tree HierNode
    nodesTree =
      T.named Group "nodesGroup"
        [ attr "class" $ text "nodes" ]
        \`T.withChild\`
          ( T.joinData "nodeGroups" "g" nodes $ \\node ->
              T.named Group ("node-" <> node.name)
                [ attr "class" $ text "node" ]
                \`T.withChildren\`
                  [ T.elem Circle
                      [ cx $ num (node.x + padding)
                      , cy $ num (node.y + padding)
                      , r $ num 4.0
                      , fill $ text "#69b3a2"
                      , stroke $ text "#fff"
                      , strokeWidth $ num 1.5
                      ]
                  , T.elem Text
                      [ x $ num (node.x + padding + 8.0)
                      , y $ num (node.y + padding + 4.0)
                      , textContent $ text node.name
                      , fontSize $ num 10.0
                      , textAnchor $ text "start"
                      ]
                  ]
          )

  -- Render nodes on top (overlaying)
  _ <- renderTree chartGroupSel nodesTree

  liftEffect do
    Console.log "=== Horizontal Tree Layout (Tree API) ==="
    Console.log ""
    Console.log "Flare visualization toolkit hierarchy (horizontal)"
    Console.log ""

-- | Main entry point - loads Flare data then renders
horizontalTreeViz :: String -> Effect Unit
horizontalTreeViz selector = launchAff_ do
  result <- loadFlareData
  case result of
    Left err -> liftEffect $ Console.log $ "Failed to load Flare data: " <> err
    Right flareTree -> liftEffect $ drawHorizontalTree selector flareTree
`;
  var snippet_groupedBarChart_content = 'module D3.Viz.TreeAPI.GroupedBarChartExample where\n\nimport Prelude\n\nimport Data.Array (filter, findIndex, nub)\nimport Data.Array as Array\nimport Data.Either (Either(..))\nimport Data.Foldable (maximum)\nimport Data.Int as Int\nimport Data.Map as Map\nimport Data.Maybe (Maybe(..), fromMaybe)\nimport Data.Number as Number\nimport Data.String (Pattern(..), split, trim)\nimport Effect (Effect)\nimport Effect.Aff (Aff, launchAff_)\nimport Effect.Class (liftEffect)\nimport Effect.Console as Console\nimport PSD3.Shared.Data (DataFile(..), loadDataFile, parseCSVRow)\nimport PSD3.Expr.Integration (v3Attr, v3AttrStr, v3AttrFn, v3AttrFnStr)\nimport PSD3.Expr.Expr (lit, str)\nimport PSD3.Axis.Axis (axisBottom, axisLeft, renderAxis, Scale)\nimport PSD3.Internal.Capabilities.Selection (select, renderTree)\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_, reselectD3v2)\nimport PSD3.Internal.Selection.Types (ElementType(..), SEmpty)\nimport PSD3.AST as T\nimport Web.DOM.Element (Element)\n\n-- | Grouped Bar Chart Data (State population by age group)\ntype GroupedBarData =\n  { state :: String\n  , age :: String\n  , population :: Number\n  }\n\n-- | Parse CSV row into population data\n-- | CSV format: State,Under 5 Years,5 to 13 Years,14 to 17 Years,18 to 24 Years,25 to 44 Years,45 to 64 Years,65 Years and Over\n-- | Map to 9 age categories: <10, 10-19, 20-29, 30-39, 40-49, 50-59, 60-69, 70-79, \u226580\nparsePopulationRow :: String -> Array GroupedBarData\nparsePopulationRow line =\n  case parseCSVRow line of\n    [ state, under5Str, age5to13Str, age14to17Str, age18to24Str, age25to44Str, age45to64Str, age65plusStr ] -> do\n      let\n        under5 = fromMaybe 0.0 $ Number.fromString (trim under5Str)\n        age5to13 = fromMaybe 0.0 $ Number.fromString (trim age5to13Str)\n        age14to17 = fromMaybe 0.0 $ Number.fromString (trim age14to17Str)\n        age18to24 = fromMaybe 0.0 $ Number.fromString (trim age18to24Str)\n        age25to44 = fromMaybe 0.0 $ Number.fromString (trim age25to44Str)\n        age45to64 = fromMaybe 0.0 $ Number.fromString (trim age45to64Str)\n        age65plus = fromMaybe 0.0 $ Number.fromString (trim age65plusStr)\n      [ { state: trim state, age: "<10", population: under5 + age5to13 * 0.5 }\n      , { state: trim state, age: "10-19", population: age5to13 * 0.5 + age14to17 }\n      , { state: trim state, age: "20-29", population: age18to24 + age25to44 * 0.25 }\n      , { state: trim state, age: "30-39", population: age25to44 * 0.5 }\n      , { state: trim state, age: "40-49", population: age25to44 * 0.25 }\n      , { state: trim state, age: "50-59", population: age45to64 * 0.6 }\n      , { state: trim state, age: "60-69", population: age45to64 * 0.4 }\n      , { state: trim state, age: "70-79", population: age65plus * 0.6 }\n      , { state: trim state, age: "\u226580", population: age65plus * 0.4 }\n      ]\n    _ -> []\n\n-- | Load population data from CSV\nloadPopulationData :: Aff (Array GroupedBarData)\nloadPopulationData = do\n  result <- loadDataFile USPopulationStateAgeCSV\n  case result of\n    Left err -> do\n      liftEffect $ Console.log $ "Failed to load population data: " <> err\n      pure []\n    Right body -> do\n      let lines = split (Pattern "\\n") body\n      let dataLines = Array.drop 1 lines -- Skip header\n      let parsed = Array.concatMap parsePopulationRow dataLines\n      liftEffect $ Console.log $ "Loaded " <> show (Array.length parsed) <> " population data points"\n      pure parsed\n\n-- | Chart dimensions\ntype Dimensions =\n  { width :: Number\n  , height :: Number\n  , marginTop :: Number\n  , marginRight :: Number\n  , marginBottom :: Number\n  , marginLeft :: Number\n  }\n\ndefaultDims :: Dimensions\ndefaultDims =\n  { width: 800.0\n  , height: 500.0\n  , marginTop: 20.0\n  , marginRight: 20.0\n  , marginBottom: 60.0\n  , marginLeft: 60.0\n  }\n\ninnerWidth :: Dimensions -> Number\ninnerWidth dims = dims.width - dims.marginLeft - dims.marginRight\n\ninnerHeight :: Dimensions -> Number\ninnerHeight dims = dims.height - dims.marginTop - dims.marginBottom\n\n-- | Group data by state\ntype StateGroup = { state :: String, bars :: Array GroupedBarData }\n\ngroupByState :: Array GroupedBarData -> Array StateGroup\ngroupByState data\' =\n  let\n    states = nub $ map _.state data\'\n    getStateData st = filter (\\d -> d.state == st) data\'\n  in\n    map (\\st -> { state: st, bars: getStateData st }) states\n\n-- | Get all unique age groups\ngetAges :: Array GroupedBarData -> Array String\ngetAges = nub <<< map _.age\n\n-- | Color scale for age groups\ncolorForAge :: String -> String\ncolorForAge "<10" = "#e8384f"\ncolorForAge "10-19" = "#fd612c"\ncolorForAge "20-29" = "#fd8d3c"\ncolorForAge "30-39" = "#feb078"\ncolorForAge "40-49" = "#ffe0b3"\ncolorForAge "50-59" = "#d7eaf3"\ncolorForAge "60-69" = "#abd9e9"\ncolorForAge "70-79" = "#74add1"\ncolorForAge "\u226580" = "#4575b4"\ncolorForAge _ = "#999"\n\n-- | Grouped bar chart using Tree API\n-- |\n-- | This demonstrates:\n-- | - Nested joins: states \u2192 bars within each state\n-- | - Multiple data series with color encoding\n-- | - Axes with proper scales\n-- | Draw grouped bar chart with loaded data\ndrawGroupedBarChart :: String -> Array GroupedBarData -> Effect Unit\ndrawGroupedBarChart selector populationData = runD3v2M do\n  container <- select selector :: _ (D3v2Selection_ SEmpty Element Unit)\n\n  let dims = defaultDims\n  let iWidth = innerWidth dims\n  let iHeight = innerHeight dims\n\n  -- Group data by state\n  let stateGroups = groupByState populationData\n  let ages = getAges populationData\n  let numStates = Array.length stateGroups\n  let numAges = Array.length ages\n\n  -- Calculate bar dimensions\n  let groupWidth = iWidth / Int.toNumber numStates\n  let barWidth = groupWidth / Int.toNumber numAges * 0.9\n\n  -- Calculate scales\n  let populationValues = map _.population populationData\n  let maxPop = fromMaybe 6000000.0 $ maximum populationValues\n\n  -- X scale maps state index to position\n  let\n    xScale :: Scale\n    xScale =\n      { domain: { min: 0.0, max: Int.toNumber numStates }\n      , range: { min: 0.0, max: iWidth }\n      }\n\n  -- Y scale maps population to height\n  let\n    yScale :: Scale\n    yScale =\n      { domain: { min: 0.0, max: maxPop }\n      , range: { min: iHeight, max: 0.0 }\n      }\n\n  -- Create axes\n  let xAxis = axisBottom xScale\n  let yAxis = axisLeft yScale\n\n  -- First tree: SVG container with axes\n  let\n    axesTree :: T.Tree Unit\n    axesTree =\n      T.named SVG "svg"\n        [ v3Attr "width" (lit dims.width)\n        , v3Attr "height" (lit dims.height)\n        , v3AttrStr "viewBox" (str ("0 0 " <> show dims.width <> " " <> show dims.height))\n        , v3AttrStr "class" (str "grouped-bar-chart")\n        ]\n        `T.withChild`\n          ( T.named Group "chartGroup"\n              [ v3AttrStr "class" (str "chart-content")\n              , v3AttrStr "transform" (str ("translate(" <> show dims.marginLeft <> "," <> show dims.marginTop <> ")"))\n              ]\n              `T.withChildren`\n                [ -- X axis\n                  T.named Group "xAxis"\n                    [ v3AttrStr "transform" (str ("translate(0," <> show iHeight <> ")"))\n                    , v3AttrStr "class" (str "x-axis")\n                    ]\n                    `T.withChild`\n                      renderAxis xAxis\n                , -- Y axis\n                  T.named Group "yAxis"\n                    [ v3AttrStr "class" (str "y-axis")\n                    ]\n                    `T.withChild`\n                      renderAxis yAxis\n                ]\n          )\n\n  -- Render axes\n  axesSelections <- renderTree container axesTree\n\n  -- Second tree: Grouped bars\n  -- Extract the chartGroup selection for the second render\n  chartGroupSel <- liftEffect $ reselectD3v2 "chartGroup" axesSelections\n\n  -- Use nestedJoin to create state groups \u2192 bars\n  let\n    barsTree :: T.Tree StateGroup\n    barsTree =\n      T.nestedJoin "stateGroups" "g" stateGroups (_.bars) $ \\bar ->\n        -- bar :: GroupedBarData\n        -- Calculate position for this bar\n        let\n          -- Find which state this bar belongs to\n          stateIdx = fromMaybe 0 $ findIndex (\\g -> g.state == bar.state) stateGroups\n          -- Find which age group this is\n          ageIdx = fromMaybe 0 $ findIndex (\\a -> a == bar.age) ages\n\n          -- X position: state position + age offset\n          xPos = Int.toNumber stateIdx * groupWidth + Int.toNumber ageIdx * barWidth\n\n          -- Y position and height from population\n          yPos = iHeight - ((bar.population / maxPop) * iHeight)\n          barHeight = (bar.population / maxPop) * iHeight\n        in\n          T.elem Rect\n            [ v3Attr "x" (lit xPos)\n            , v3Attr "y" (lit yPos)\n            , v3Attr "width" (lit barWidth)\n            , v3Attr "height" (lit barHeight)\n            , v3AttrStr "fill" (str (colorForAge bar.age))\n            , v3AttrStr "class" (str "bar")\n            ]\n\n  -- Render bars\n  barsSelections <- renderTree chartGroupSel barsTree\n\n  liftEffect do\n    Console.log "=== Grouped Bar Chart (Tree API) ==="\n    Console.log ""\n    Console.log $ "Rendered " <> show (Array.length populationData) <> " bars in "\n      <> show numStates\n      <> " groups"\n\n    case Map.lookup "svg" axesSelections of\n      Just _ -> Console.log "\u2713 SVG created"\n      Nothing -> Console.log "\u2717 Missing SVG"\n\n-- | Main entry point - loads data then renders\ngroupedBarChart :: String -> Effect Unit\ngroupedBarChart selector = launchAff_ do\n  populationData <- loadPopulationData\n  liftEffect $ drawGroupedBarChart selector populationData\n';
  var snippet_edgeBundle_content = 'module D3.Viz.TreeAPI.EdgeBundleViz where\n\nimport Prelude\n\nimport Data.Array as Array\nimport Data.Either (Either(..))\nimport Data.Number (cos, sin, pi)\nimport Effect (Effect)\nimport Effect.Aff (launchAff_)\nimport Effect.Class (liftEffect)\nimport Effect.Console as Console\nimport PSD3.Shared.Data (loadFlareImportsData, FlareImportRecord)\nimport DataViz.Layout.Hierarchy.EdgeBundle as EdgeBundle\nimport PSD3.Expr.Friendly (num, text, attr, viewBox, width, height, x, y, fill, stroke, opacity, path, fontSize, transform)\nimport PSD3.Internal.Capabilities.Selection (select, renderTree)\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_, reselectD3v2)\nimport PSD3.Internal.Selection.Types (ElementType(..), SEmpty)\nimport PSD3.AST as T\nimport Web.DOM.Element (Element)\n\n-- | Link data type for rendering\ntype LinkDatum = { path :: String, source :: String, target :: String }\n\n-- | Node data type for rendering\ntype NodeDatum =\n  { fullName :: String\n  , shortName :: String\n  , cartX :: Number\n  , cartY :: Number\n  , isLeaf :: Boolean\n  , outgoingCount :: Int\n  , incomingCount :: Int\n  }\n\n-- | Draw edge bundle visualization\ndrawEdgeBundle :: String -> Array FlareImportRecord -> Effect Unit\ndrawEdgeBundle selector importData = runD3v2M do\n  container <- select selector :: _ (D3v2Selection_ SEmpty Element Unit)\n\n  -- Layout parameters\n  let chartSize = 700.0\n  let centerX = chartSize / 2.0\n  let centerY = chartSize / 2.0\n  let outerRadius = 300.0\n  let innerRadius = 50.0\n\n  -- Compute edge bundle layout using our PureScript implementation\n  let\n    config =\n      { getName: _.name\n      , getImports: _.imports\n      , beta: 0.85\n      , innerRadius: innerRadius\n      , outerRadius: outerRadius\n      }\n\n  let result = EdgeBundle.edgeBundle config importData\n\n  -- Convert to rendering types\n  let nodes = Array.filter _.isLeaf result.nodes\n  let links = result.links\n\n  liftEffect $ Console.log $ "Edge bundle: " <> show (Array.length nodes) <> " leaf nodes, " <> show (Array.length links) <> " links"\n\n  -- Create links tree\n  let\n    linksTree :: T.Tree LinkDatum\n    linksTree =\n      T.named SVG "svg"\n        [ width $ num chartSize\n        , height $ num chartSize\n        , viewBox 0.0 0.0 chartSize chartSize\n        , attr "class" $ text "edge-bundle-viz"\n        ]\n        `T.withChild`\n          ( T.named Group "chartGroup"\n              [ attr "class" $ text "edge-bundle-content"\n              , transform $ text ("translate(" <> show centerX <> "," <> show centerY <> ")")\n              ]\n              `T.withChild`\n                ( T.named Group "linksGroup"\n                    [ attr "class" $ text "links" ]\n                    `T.withChild`\n                      ( T.joinData "links" "path" links $ \\link ->\n                          T.elem Path\n                            [ path $ text link.path\n                            , fill $ text "none"\n                            , stroke $ text "steelblue"\n                            , opacity $ num 0.4\n                            , attr "stroke-width" $ num 1.5\n                            , attr "class" $ text "link"\n                            ]\n                      )\n                )\n          )\n\n  -- Render links first\n  linksSelections <- renderTree container linksTree\n\n  -- Reselect chartGroup for nodes\n  chartGroupSel <- liftEffect $ reselectD3v2 "chartGroup" linksSelections\n\n  -- Convert nodes to rendering format\n  let\n    nodeData = map\n      ( \\n ->\n          { fullName: n.fullName\n          , shortName: n.shortName\n          , cartX: n.cartX\n          , cartY: n.cartY\n          , isLeaf: n.isLeaf\n          , outgoingCount: n.outgoingCount\n          , incomingCount: n.incomingCount\n          }\n      )\n      nodes\n\n  -- Calculate text rotation for radial labels\n  let\n    getTextRotation node =\n      let\n        angle = radiansToDegrees (atan2 node.cartY node.cartX)\n      in\n        if angle > 90.0 || angle < -90.0 then angle + 180.0\n        else angle\n\n  let\n    getTextAnchor node =\n      let\n        angle = radiansToDegrees (atan2 node.cartY node.cartX)\n      in\n        if angle > 90.0 || angle < -90.0 then "end"\n        else "start"\n\n  let\n    getTextOffset node =\n      let\n        angle = radiansToDegrees (atan2 node.cartY node.cartX)\n      in\n        if angle > 90.0 || angle < -90.0 then -6.0\n        else 6.0\n\n  -- Create nodes tree\n  let\n    nodesTree :: T.Tree NodeDatum\n    nodesTree =\n      T.named Group "nodesGroup"\n        [ attr "class" $ text "nodes" ]\n        `T.withChild`\n          ( T.joinData "nodeLabels" "text" nodeData $ \\node ->\n              T.elem Text\n                [ x $ num node.cartX\n                , y $ num node.cartY\n                , attr "text-content" $ text node.shortName\n                , fontSize $ num 8.0\n                , attr "text-anchor" $ text (getTextAnchor node)\n                , transform $ text ("rotate(" <> show (getTextRotation node) <> "," <> show node.cartX <> "," <> show node.cartY <> ") translate(" <> show (getTextOffset node) <> ", 3)")\n                , attr "class" $ text "node-label"\n                ]\n          )\n\n  -- Render nodes\n  _ <- renderTree chartGroupSel nodesTree\n\n  liftEffect do\n    Console.log "=== Hierarchical Edge Bundling (PureScript) ==="\n    Console.log "Flare library class dependencies"\n\n-- | Helper: convert radians to degrees\nradiansToDegrees :: Number -> Number\nradiansToDegrees rad = rad * 180.0 / pi\n\n-- | Helper: atan2 (using Math)\nforeign import atan2 :: Number -> Number -> Number\n\n-- | Main entry point\nedgeBundleViz :: String -> Effect Unit\nedgeBundleViz selector = launchAff_ do\n  result <- loadFlareImportsData\n  case result of\n    Left err -> liftEffect $ Console.log $ "Failed to load flare-imports data: " <> err\n    Right importData -> liftEffect $ drawEdgeBundle selector importData\n';
  var snippet_cluster_content = `module D3.Viz.TreeAPI.ClusterViz where

import Prelude

import Data.Array as Array
import Data.Either (Either(..))
import Data.List (List(..))
import Control.Comonad.Cofree (head, tail)
import Data.Tree (Tree, mkTree)
import Effect (Effect)
import Effect.Aff (launchAff_)
import Effect.Class (liftEffect)
import Effect.Console as Console
import PSD3.Shared.Data (loadFlareData)
import DataViz.Layout.Hierarchy.Cluster (cluster, defaultClusterConfig)
import PSD3.Expr.Friendly (num, text, attr, viewBox, width, height, cx, cy, r, x, y, fill, stroke, strokeWidth, fontSize, textAnchor, textContent, path)
import PSD3.Internal.Capabilities.Selection (select, renderTree)
import PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_, reselectD3v2)
import PSD3.Internal.Selection.Types (ElementType(..), SEmpty)
import PSD3.AST as T
import Web.DOM.Element (Element)

-- | Hierarchy node type (matches loadFlareData output)
type HierNode = { name :: String, value :: Number, x :: Number, y :: Number, depth :: Int, height :: Int }

-- | Link data type
type LinkDatum = { source :: { x :: Number, y :: Number }, target :: { x :: Number, y :: Number } }

-- | Create links from parent to children
makeLinks
  :: forall r
   . Tree { x :: Number, y :: Number | r }
  -> Array { source :: { x :: Number, y :: Number }, target :: { x :: Number, y :: Number } }
makeLinks tree' = Array.fromFoldable $ makeLinksList tree'
  where
  makeLinksList
    :: Tree { x :: Number, y :: Number | r }
    -> List { source :: { x :: Number, y :: Number }, target :: { x :: Number, y :: Number } }
  makeLinksList t =
    let
      val = head t
      children = tail t
      childLinks = children >>= \\child ->
        let childVal = head child
        in Cons { source: { x: val.x, y: val.y }, target: { x: childVal.x, y: childVal.y } } Nil
      grandchildLinks = children >>= makeLinksList
    in
      childLinks <> grandchildLinks

-- | Dendrogram link path generator (vertical with stepped Bezier)
-- | Creates orthogonal "elbow" connectors
linkPath :: Number -> Number -> Number -> Number -> String
linkPath x1' y1' x2' y2' =
  let
    midY = (y1' + y2') / 2.0
  in
    "M" <> show x1' <> "," <> show y1'
      <> " C"
      <> show x1'
      <> ","
      <> show midY
      <> " "
      <> show x2'
      <> ","
      <> show midY
      <> " "
      <> show x2'
      <> ","
      <> show y2'

-- | Draw cluster (dendrogram) hierarchy with loaded data
drawCluster :: String -> Tree HierNode -> Effect Unit
drawCluster selector flareTree = runD3v2M do
  container <- select selector :: _ (D3v2Selection_ SEmpty Element Unit)

  -- Reduced from 1200x800 to fit within tutorial-section max-width (832px)
  let chartWidth = 750.0
  let chartHeight = 500.0
  let padding = 40.0

  -- Apply Cluster layout (height field already computed by data loader)
  let
    config = defaultClusterConfig
      { size =
          { width: chartWidth - (2.0 * padding)
          , height: chartHeight - (2.0 * padding)
          }
      }
  let positioned = cluster config flareTree

  -- Flatten to arrays
  let nodes = Array.fromFoldable positioned
  let links = makeLinks positioned

  liftEffect $ Console.log $ "Rendering cluster (dendrogram): " <> show (Array.length nodes) <> " nodes, " <> show (Array.length links) <> " links"

  -- First tree: SVG container with links (datum type: link data)
  let
    linksTree :: T.Tree LinkDatum
    linksTree =
      T.named SVG "svg"
        [ width $ num chartWidth
        , height $ num chartHeight
        , viewBox 0.0 0.0 chartWidth chartHeight
        , attr "class" $ text "cluster-viz"
        ]
        \`T.withChild\`
          ( T.named Group "chartGroup"
              [ attr "class" $ text "tree-content" ]
              \`T.withChild\`
                ( T.named Group "linksGroup"
                    [ attr "class" $ text "links" ]
                    \`T.withChild\`
                      ( T.joinData "links" "path" links $ \\link ->
                          T.elem Path
                            [ path $ text ( linkPath
                                    (link.source.x + padding)
                                    (link.source.y + padding)
                                    (link.target.x + padding)
                                    (link.target.y + padding)
                                )
                            , fill $ text "none"
                            , stroke $ text "#999"
                            , strokeWidth $ num 1.5
                            , attr "class" $ text "link"
                            ]
                      )
                )
          )

  -- Render links first (underlaying)
  linksSelections <- renderTree container linksTree

  -- Second tree: Nodes on top (datum type: HierNode)
  -- Reselect the chartGroup from rendered selections (not global CSS selector!)
  chartGroupSel <- liftEffect $ reselectD3v2 "chartGroup" linksSelections

  let
    nodesTree :: T.Tree HierNode
    nodesTree =
      T.named Group "nodesGroup"
        [ attr "class" $ text "nodes" ]
        \`T.withChild\`
          ( T.joinData "nodeGroups" "g" nodes $ \\node ->
              T.named Group ("node-" <> node.name)
                [ attr "class" $ text "node" ]
                \`T.withChildren\`
                  [ T.elem Circle
                      [ cx $ num (node.x + padding)
                      , cy $ num (node.y + padding)
                      , r $ num 4.0
                      , fill $ text "#69b3a2"
                      , stroke $ text "#fff"
                      , strokeWidth $ num 1.5
                      ]
                  , T.elem Text
                      [ x $ num (node.x + padding + 8.0)
                      , y $ num (node.y + padding + 4.0)
                      , textContent $ text node.name
                      , fontSize $ num 10.0
                      , textAnchor $ text "start"
                      ]
                  ]
          )

  -- Render nodes on top (overlaying)
  _ <- renderTree chartGroupSel nodesTree

  liftEffect do
    Console.log "=== Cluster Layout (Dendrogram, Tree API) ==="
    Console.log ""
    Console.log "Flare visualization toolkit hierarchy (cluster/dendrogram)"
    Console.log ""

-- | Main entry point - loads Flare data then renders
clusterViz :: String -> Effect Unit
clusterViz selector = launchAff_ do
  result <- loadFlareData
  case result of
    Left err -> liftEffect $ Console.log $ "Failed to load Flare data: " <> err
    Right flareTree -> liftEffect $ drawCluster selector flareTree
`;
  var snippet_chord_content = 'module D3.Viz.TreeAPI.ChordDiagram where\n\n-- | Chord diagram visualization using TreeAPI\n-- | Based on Baton Rouge bridge traffic analysis example\n-- | Inspired by: https://www.streetlightdata.com/planning-bridges-louisiana/\n-- | Uses v3 expressions for label positioning with trig functions\n\nimport Prelude hiding (add, sub, mul)\n\nimport Data.Array (index, length, mapWithIndex, (!!))\nimport Data.Either (Either(..))\nimport Data.Map as Map\nimport Data.Maybe (Maybe(..), fromMaybe)\nimport Data.Tuple (Tuple(..))\nimport Effect (Effect)\nimport Effect.Aff (launchAff_)\nimport Effect.Class (liftEffect)\nimport Effect.Console as Console\nimport Type.Proxy (Proxy(..))\nimport PSD3.Shared.Data (loadBridgesData)\nimport PSD3.Internal.FFI (arcGenerator_, arcPath_, chordArray_, chordGroups_, chordLayoutWithPadAngle_, ribbonGenerator_, ribbonPath_, setArcInnerRadius_, setArcOuterRadius_, setRibbonRadius_)\nimport PSD3.Internal.Types (Datum_)\nimport PSD3.Expr.Friendly (num, text, attr, viewBox, width, height, x, y, fill, stroke, strokeWidth, opacity, path, fontSize)\nimport PSD3.Internal.Capabilities.Selection (renderTree, select)\nimport PSD3.Interpreter.D3 (D3v2Selection_, reselectD3v2, runD3v2M)\nimport PSD3.Internal.Selection.Types (ElementType(..), SEmpty)\nimport PSD3.AST as T\nimport Unsafe.Coerce (unsafeCoerce)\nimport Web.DOM.Element (Element)\n\n-- v3 DSL imports\nimport PSD3.Expr.Expr (class NumExpr, class BoolExpr, class CompareExpr, class StringExpr, class TrigExpr, ifThenElse, add, sub, mul)\nimport PSD3.Expr.Expr (pi, cos, sin) as V3\nimport PSD3.Expr.Datum (class DatumExpr, field)\nimport PSD3.Expr.Sugar ((/:), (>.), s)\nimport PSD3.Expr.Interpreter.Eval (EvalD, runEvalD)\n\n-- | Traffic flow matrix (11 regions of Baton Rouge)\ntype TrafficMatrix = Array (Array Number)\n\n-- | Region labels for Baton Rouge traffic analysis\ntype RegionLabels = Array String\n\n-- | Baton Rouge regions\nbatonRougeRegions :: RegionLabels\nbatonRougeRegions =\n  [ "WBR" -- West Baton Rouge\n  , "Pointe Coupee"\n  , "Iberville"\n  , "EBR - M" -- East Baton Rouge - Main\n  , "EBR - S" -- East Baton Rouge - South\n  , "Ascension"\n  , "Livingston"\n  , "I-10 Lafayette"\n  , "US 190 Opelousas"\n  , "I-10 NOLA"\n  , "I-12"\n  ]\n\n-- | Color palette for regions (color-by-origin like the example)\n-- | This is keyed by region name, not index, to handle alphabetical sorting\nregionColorMap :: Map.Map String String\nregionColorMap = Map.fromFoldable\n  [ Tuple "WBR" "#d62728" -- Red (dominant in image)\n  , Tuple "Pointe Coupee" "#ff9896" -- Light red\n  , Tuple "Point Coupe" "#ff9896" -- Light red (alternate spelling)\n  , Tuple "Iberville" "#e7969c" -- Pink red\n  , Tuple "EBR-M" "#5ab4ac" -- Teal\n  , Tuple "EBR - M" "#5ab4ac" -- Teal (with spaces)\n  , Tuple "EBR-S" "#c7eae5" -- Light teal\n  , Tuple "EBR - S" "#c7eae5" -- Light teal (with spaces)\n  , Tuple "Ascension" "#80cdc1" -- Medium teal\n  , Tuple "Livingston" "#d8daeb" -- Light purple\n  , Tuple "I-10 Lafayette" "#b2abd2" -- Purple\n  , Tuple "US-190 Opelousas" "#ff7f0e" -- Orange\n  , Tuple "US 190 Opelousas" "#ff7f0e" -- Orange (alternate)\n  , Tuple "I-10 NOLA" "#ffbb78" -- Light orange\n  , Tuple "I-12" "#98df8a" -- Light green\n  ]\n\n-- | Get color for a region by name\ngetRegionColor :: RegionLabels -> Int -> String\ngetRegionColor labels idx = case index labels idx of\n  Just label -> case Map.lookup label regionColorMap of\n    Just color -> color\n    Nothing -> "#999999" -- Default gray for unknown regions\n  Nothing -> "#999999"\n\n-- | Sample traffic matrix (values guesstimated from image, original data not available)\nbatonRougeTraffic :: TrafficMatrix\nbatonRougeTraffic =\n  [ [ 0.0, 10.0, 5.0, 80.0, 20.0, 15.0, 8.0, 12.0, 6.0, 4.0, 3.0 ] -- WBR\n  , [ 10.0, 0.0, 3.0, 15.0, 8.0, 5.0, 2.0, 4.0, 1.0, 1.0, 1.0 ] -- Pointe Coupee\n  , [ 5.0, 3.0, 0.0, 20.0, 12.0, 8.0, 4.0, 3.0, 2.0, 1.0, 1.0 ] -- Iberville\n  , [ 80.0, 15.0, 20.0, 0.0, 40.0, 30.0, 25.0, 18.0, 15.0, 10.0, 8.0 ] -- EBR - M (main hub)\n  , [ 20.0, 8.0, 12.0, 40.0, 0.0, 35.0, 20.0, 15.0, 10.0, 8.0, 6.0 ] -- EBR - S\n  , [ 15.0, 5.0, 8.0, 30.0, 35.0, 0.0, 18.0, 12.0, 8.0, 6.0, 4.0 ] -- Ascension\n  , [ 8.0, 2.0, 4.0, 25.0, 20.0, 18.0, 0.0, 10.0, 6.0, 4.0, 3.0 ] -- Livingston\n  , [ 12.0, 4.0, 3.0, 18.0, 15.0, 12.0, 10.0, 0.0, 5.0, 3.0, 2.0 ] -- I-10 Lafayette\n  , [ 6.0, 1.0, 2.0, 15.0, 10.0, 8.0, 6.0, 5.0, 0.0, 2.0, 1.0 ] -- US 190\n  , [ 4.0, 1.0, 1.0, 10.0, 8.0, 6.0, 4.0, 3.0, 2.0, 0.0, 1.0 ] -- I-10 NOLA\n  , [ 3.0, 1.0, 1.0, 8.0, 6.0, 4.0, 3.0, 2.0, 1.0, 1.0, 0.0 ] -- I-12\n  ]\n\n-- | Accessor helpers for chord data\ngetSourceIndex :: Datum_ -> Int\ngetSourceIndex d = (unsafeCoerce d).source.index\n\ngetTargetIndex :: Datum_ -> Int\ngetTargetIndex d = (unsafeCoerce d).target.index\n\ngetSourceValue :: Datum_ -> Number\ngetSourceValue d = (unsafeCoerce d).source.value\n\ngetTargetValue :: Datum_ -> Number\ngetTargetValue d = (unsafeCoerce d).target.value\n\ngetGroupIndex :: Datum_ -> Int\ngetGroupIndex d = (unsafeCoerce d).index\n\n-- | Get the index of the dominant flow direction (larger value)\n-- | This colors ribbons by where the larger flow originates\ngetDominantFlowIndex :: Datum_ -> Int\ngetDominantFlowIndex d =\n  let\n    sourceVal = getSourceValue d\n    targetVal = getTargetValue d\n  in\n    if sourceVal >= targetVal then getSourceIndex d\n    else getTargetIndex d\n\n-- | Indexed arc for data join\nnewtype IndexedArc = IndexedArc { index :: Int, datum :: Datum_ }\n\ninstance Eq IndexedArc where\n  eq (IndexedArc a) (IndexedArc b) = a.index == b.index\n\ninstance Ord IndexedArc where\n  compare (IndexedArc a) (IndexedArc b) = compare a.index b.index\n\n-- | Indexed ribbon for data join\nnewtype IndexedRibbon = IndexedRibbon { index :: Int, datum :: Datum_ }\n\ninstance Eq IndexedRibbon where\n  eq (IndexedRibbon a) (IndexedRibbon b) = a.index == b.index\n\ninstance Ord IndexedRibbon where\n  compare (IndexedRibbon a) (IndexedRibbon b) = compare a.index b.index\n\n-- =============================================================================\n-- v3 Expressions for Chord Label Positioning\n-- =============================================================================\n\n-- | Flattened label data for v3 expression access\n-- | Contains the angle (midpoint of arc) and radius for positioning\ntype ChordLabelDatum =\n  { label :: String\n  , startAngle :: Number\n  , endAngle :: Number\n  , labelRadius :: Number  -- outerR + offset\n  }\n\n-- Row type for v3 DatumExpr\ntype ChordLabelRow = (label :: String, startAngle :: Number, endAngle :: Number, labelRadius :: Number)\n\n-- Field accessors\nchordStartAngle :: forall repr. DatumExpr repr ChordLabelRow => repr Number\nchordStartAngle = field (Proxy :: Proxy "startAngle")\n\nchordEndAngle :: forall repr. DatumExpr repr ChordLabelRow => repr Number\nchordEndAngle = field (Proxy :: Proxy "endAngle")\n\nchordLabelRadius :: forall repr. DatumExpr repr ChordLabelRow => repr Number\nchordLabelRadius = field (Proxy :: Proxy "labelRadius")\n\n-- | v3 expression: Angle at midpoint of arc\nchordMidAngle :: forall repr. NumExpr repr => DatumExpr repr ChordLabelRow => repr Number\nchordMidAngle = add chordStartAngle chordEndAngle /: 2.0\n\n-- | v3 expression: Label X position using trig\n-- | X = labelRadius * cos(angle - \u03C0/2)\n-- | The -\u03C0/2 rotates from D3\'s "12 o\'clock = 0" to standard "3 o\'clock = 0"\nchordLabelX :: forall repr. NumExpr repr => TrigExpr repr => DatumExpr repr ChordLabelRow => repr Number\nchordLabelX = mul chordLabelRadius (V3.cos (sub chordMidAngle (V3.pi /: 2.0)))\n\n-- | v3 expression: Label Y position using trig\n-- | Y = labelRadius * sin(angle - \u03C0/2)\nchordLabelY :: forall repr. NumExpr repr => TrigExpr repr => DatumExpr repr ChordLabelRow => repr Number\nchordLabelY = mul chordLabelRadius (V3.sin (sub chordMidAngle (V3.pi /: 2.0)))\n\n-- | v3 expression: Text anchor based on angle\n-- | Right side (angle < \u03C0): "start", Left side (angle > \u03C0): "end"\nchordLabelAnchor :: forall repr. NumExpr repr => BoolExpr repr => CompareExpr repr => StringExpr repr => TrigExpr repr => DatumExpr repr ChordLabelRow => repr String\nchordLabelAnchor = ifThenElse\n  (chordMidAngle >. V3.pi)\n  (s "end")\n  (s "start")\n\n-- | Evaluate v3 expressions\nevalChordNum :: EvalD ChordLabelDatum Number -> ChordLabelDatum -> Number\nevalChordNum expr datum = runEvalD expr datum 0\n\nevalChordStr :: EvalD ChordLabelDatum String -> ChordLabelDatum -> String\nevalChordStr expr datum = runEvalD expr datum 0\n\n-- | Convert IndexedArc to ChordLabelDatum for v3 expression evaluation\ntoChordLabelDatum :: RegionLabels -> Number -> IndexedArc -> ChordLabelDatum\ntoChordLabelDatum labels outerR (IndexedArc ia) =\n  let\n    idx = getGroupIndex ia.datum\n    label = fromMaybe "" (labels !! idx)\n    groupData = unsafeCoerce ia.datum :: { startAngle :: Number, endAngle :: Number }\n  in\n    { label\n    , startAngle: groupData.startAngle\n    , endAngle: groupData.endAngle\n    , labelRadius: outerR + 8.0  -- Close to the arc\n    }\n\n-- | Draw Chord diagram with TreeAPI\ndrawChord\n  :: TrafficMatrix\n  -> RegionLabels\n  -> String\n  -> Number\n  -> Number\n  -> Effect Unit\ndrawChord matrix labels containerSelector w h = runD3v2M do\n  liftEffect $ Console.log "=== Drawing Chord Diagram with TreeAPI ==="\n\n  -- Select container\n  container <- select containerSelector :: _ (D3v2Selection_ SEmpty Element Unit)\n\n  -- Dimensions\n  let outerR = 280.0\n  let innerR = 270.0\n  let centerX = w / 2.0\n  let centerY = h / 2.0\n\n  -- Create chord layout with padding between arcs (like the example)\n  -- padAngle of 0.05 radians (~3 degrees) creates nice visual separation\n  let chordData = chordLayoutWithPadAngle_ matrix 0.05\n  let groups = chordGroups_ chordData\n  let chords = chordArray_ chordData\n\n  liftEffect $ Console.log $ "Chord layout: " <> show (length groups) <> " groups, " <> show (length chords) <> " chords"\n\n  -- Wrap data with indices\n  let indexedGroups = mapWithIndex (\\i d -> IndexedArc { index: i, datum: d }) groups\n  let indexedChords = mapWithIndex (\\i d -> IndexedRibbon { index: i, datum: d }) chords\n\n  -- Create generators\n  let ribbonGen = setRibbonRadius_ (ribbonGenerator_ unit) innerR\n  let\n    arcGen = setArcOuterRadius_\n      (setArcInnerRadius_ (arcGenerator_ unit) innerR)\n      outerR\n\n  -- Declarative tree structure\n  let\n    chordTree :: T.Tree Unit\n    chordTree =\n      T.named SVG "svg"\n        [ width $ num w\n        , height $ num h\n        , viewBox 0.0 0.0 w h\n        , attr "id" $ text "chord-svg"\n        , attr "class" $ text "chord-diagram"\n        ]\n        `T.withChild`\n          ( T.named Group "centerGroup"\n              [ attr "transform" $ text ("translate(" <> show centerX <> "," <> show centerY <> ")")\n              , attr "class" $ text "chord-group"\n              ]\n              `T.withChildren`\n                [ T.named Group "ribbonsGroup" [ attr "class" $ text "ribbons" ]\n                , T.named Group "arcsGroup" [ attr "class" $ text "arcs" ]\n                , T.named Group "labelsGroup" [ attr "class" $ text "labels" ]\n                ]\n          )\n\n  -- Render structure\n  selections <- renderTree container chordTree\n\n  -- Reselect groups\n  ribbonsGroupSel <- liftEffect $ reselectD3v2 "ribbonsGroup" selections\n  arcsGroupSel <- liftEffect $ reselectD3v2 "arcsGroup" selections\n  labelsGroupSel <- liftEffect $ reselectD3v2 "labelsGroup" selections\n\n  -- Render ribbons (colored by dominant flow direction)\n  let\n    ribbonsTree :: T.Tree IndexedRibbon\n    ribbonsTree =\n      T.joinData "ribbonElements" "path" indexedChords $ \\(IndexedRibbon ir) ->\n        let\n          dominantIdx = getDominantFlowIndex ir.datum\n          color = getRegionColor labels dominantIdx\n        in\n          T.elem Path\n            [ attr "class" $ text "ribbon"\n            , path $ text (ribbonPath_ ribbonGen ir.datum)\n            , fill $ text color\n            , opacity $ num 0.67\n            , stroke $ text "#000000"\n            , strokeWidth $ num 0.5\n            ]\n\n  _ <- renderTree ribbonsGroupSel ribbonsTree\n\n  -- Render arcs (outer segments)\n  let\n    arcsTree :: T.Tree IndexedArc\n    arcsTree =\n      T.joinData "arcElements" "path" indexedGroups $ \\(IndexedArc ia) ->\n        let\n          idx = getGroupIndex ia.datum\n          color = getRegionColor labels idx\n        in\n          T.elem Path\n            [ attr "class" $ text "arc"\n            , path $ text (arcPath_ arcGen ia.datum)\n            , fill $ text color\n            , stroke $ text "#ffffff"\n            , strokeWidth $ num 2.0\n            ]\n\n  _ <- renderTree arcsGroupSel arcsTree\n\n  -- Render labels using v3 expressions for polar positioning\n  -- Convert arcs to ChordLabelDatum with labelRadius baked in\n  let chordLabelData = map (toChordLabelDatum labels outerR) indexedGroups\n\n  let\n    labelsTree :: T.Tree ChordLabelDatum\n    labelsTree =\n      T.joinData "labelElements" "text" chordLabelData $ \\datum ->\n        -- v3 expressions with TrigExpr calculate polar coordinates\n        T.elem Text\n          [ attr "class" $ text "chord-label"\n          , x $ num (evalChordNum chordLabelX datum)      -- v3: labelRadius * cos(midAngle - \u03C0/2)\n          , y $ num (evalChordNum chordLabelY datum)      -- v3: labelRadius * sin(midAngle - \u03C0/2)\n          , attr "text-anchor" $ text (evalChordStr chordLabelAnchor datum)  -- v3: if midAngle > \u03C0 then "end" else "start"\n          , fill $ text "#000"\n          , attr "text-content" $ text datum.label\n          , fontSize $ num 10.0\n          ]\n\n  _ <- renderTree labelsGroupSel labelsTree\n\n  liftEffect $ Console.log "Chord diagram rendered with TreeAPI"\n\n  pure unit\n\n-- | Entry point with fixed dimensions for Tour page\n-- | Loads data from bridges.csv\nstartChord :: String -> Effect Unit\nstartChord containerSelector = launchAff_ do\n  let w = 700.0\n  let h = 700.0\n\n  -- Load bridges data from CSV\n  result <- loadBridgesData\n  case result of\n    Left err -> liftEffect $ Console.log $ "Failed to load bridges data: " <> err\n    Right bridgeData -> liftEffect $ drawChord bridgeData.matrix bridgeData.labels containerSelector w h\n';
  var snippet_barChart_content = 'module D3.Viz.TreeAPI.BarChartExample where\n\nimport Prelude\n\nimport Data.Array (length)\nimport Data.Foldable (maximum)\nimport Data.Int as Int\nimport Data.Map as Map\nimport Data.Maybe (Maybe(..), fromMaybe)\nimport Effect (Effect)\nimport Effect.Class (liftEffect)\nimport Effect.Console as Console\nimport PSD3.Expr.Friendly (num, text, attr, viewBox, width, height, x, y, fill, stroke, strokeWidth, transform)\nimport PSD3.Axis.Axis (axisBottom, axisLeft, renderAxis, Scale)\nimport PSD3.Internal.Capabilities.Selection (select, renderTree)\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_, reselectD3v2)\nimport PSD3.Internal.Selection.Types (ElementType(..), SEmpty)\nimport PSD3.AST (Tree)\nimport PSD3.AST as T\nimport Web.DOM.Element (Element)\n\n-- | Simple data point\ntype DataPoint = { x :: Number, y :: Number }\n\n-- | Sample data\nsampleData :: Array DataPoint\nsampleData =\n  [ { x: 1.0, y: 30.0 }\n  , { x: 2.0, y: 80.0 }\n  , { x: 3.0, y: 45.0 }\n  , { x: 4.0, y: 60.0 }\n  , { x: 5.0, y: 20.0 }\n  , { x: 6.0, y: 90.0 }\n  , { x: 7.0, y: 55.0 }\n  ]\n\n-- | Chart dimensions\ntype Dimensions =\n  { width :: Number\n  , height :: Number\n  , marginTop :: Number\n  , marginRight :: Number\n  , marginBottom :: Number\n  , marginLeft :: Number\n  }\n\ndefaultDims :: Dimensions\ndefaultDims =\n  { width: 600.0\n  , height: 400.0\n  , marginTop: 20.0\n  , marginRight: 20.0\n  , marginBottom: 40.0\n  , marginLeft: 50.0\n  }\n\ninnerWidth :: Dimensions -> Number\ninnerWidth dims = dims.width - dims.marginLeft - dims.marginRight\n\ninnerHeight :: Dimensions -> Number\ninnerHeight dims = dims.height - dims.marginTop - dims.marginBottom\n\n-- | Bar chart using declarative tree API\nbarChart :: Effect Unit\nbarChart = runD3v2M do\n  container <- select "#viz" :: _ (D3v2Selection_ SEmpty Element Unit)\n\n  let dims = defaultDims\n  let iWidth = innerWidth dims\n  let iHeight = innerHeight dims\n\n  -- Calculate data extents\n  let yValues = map _.y sampleData\n  let minY = 0.0 -- Start bars from zero\n  let maxY = fromMaybe 100.0 $ maximum yValues\n\n  -- Calculate bar width (80% of available space per bar)\n  let numBars = length sampleData\n  let barWidth = if numBars > 0 then (iWidth / (Int.toNumber numBars)) * 0.8 else 0.0\n\n  -- KEY: Create scales to map data values \u2192 pixel positions\n  -- Scales are the bridge between data space and visual space\n  let\n    xScale :: Scale\n    xScale =\n      { domain: { min: 1.0, max: Int.toNumber numBars } -- Data range\n      , range: { min: 0.0, max: iWidth } -- Pixel range\n      }\n\n  let\n    yScale :: Scale\n    yScale =\n      { domain: { min: minY, max: maxY } -- Data range (0 to max value)\n      , range: { min: iHeight, max: 0.0 } -- Pixel range (inverted for SVG coords)\n      }\n\n  -- Create axes\n  let xAxis = axisBottom xScale\n  let yAxis = axisLeft yScale\n\n  -- First, render the SVG container with axes (datum type: Unit)\n  let\n    axesTree :: Tree Unit\n    axesTree =\n      T.named SVG "svg"\n        [ width $ num dims.width\n        , height $ num dims.height\n        , viewBox 0.0 0.0 dims.width dims.height\n        , attr "class" $ text "bar-chart-tree"\n        ]\n        `T.withChild`\n          ( T.named Group "chartGroup"\n              [ attr "class" $ text "chart-content"\n              , transform $ text ("translate(" <> show dims.marginLeft <> "," <> show dims.marginTop <> ")")\n              ]\n              `T.withChildren`\n                [ -- X axis\n                  T.named Group "xAxis"\n                    [ transform $ text ("translate(0," <> show iHeight <> ")")\n                    , attr "class" $ text "x-axis"\n                    ]\n                    `T.withChild`\n                      renderAxis xAxis\n                , -- Y axis\n                  T.named Group "yAxis"\n                    [ attr "class" $ text "y-axis"\n                    ]\n                    `T.withChild`\n                      renderAxis yAxis\n                ]\n          )\n\n  -- Render axes first (underlaying)\n  axesSelections <- renderTree container axesTree\n\n  -- KEY: Reselect the chartGroup for layered rendering\n  -- This allows us to render bars on top of axes\n  chartGroupSel <- liftEffect $ reselectD3v2 "chartGroup" axesSelections\n\n  -- KEY: Data join creates one rect per data point\n  let\n    barsTree :: Tree DataPoint\n    barsTree =\n      T.joinData "bars" "rect" sampleData $ \\point ->\n        -- Calculate bar position and dimensions from data\n        let\n          xPos = (point.x - 1.0) * (iWidth / (Int.toNumber numBars)) + ((iWidth / (Int.toNumber numBars)) - barWidth) / 2.0\n          yPos = iHeight - ((point.y - minY) / (maxY - minY) * iHeight) -- Manual scale calculation\n          barHeight = iHeight - yPos -- Bar grows from baseline\n        in\n          T.elem Rect\n            [ x $ num xPos -- Horizontal position\n            , y $ num yPos -- Top of bar (SVG coords from top-left)\n            , width $ num barWidth -- Bar width\n            , height $ num barHeight -- Bar height (grows downward in SVG)\n            , fill $ text "#4a90e2"\n            , stroke $ text "#357abd"\n            , strokeWidth $ num 1.0\n            , attr "class" $ text "bar"\n            ]\n\n  -- Render bars into the chart group (overlaying)\n  barsSelections <- renderTree chartGroupSel barsTree\n\n  liftEffect do\n    Console.log "=== Bar Chart (Tree API) ==="\n    Console.log ""\n    Console.log $ "Rendered " <> show (length sampleData) <> " bars with axes"\n\n    case Map.lookup "svg" axesSelections of\n      Just _ -> Console.log "\u2713 SVG created"\n      Nothing -> Console.log "\u2717 Missing SVG"\n\n    case Map.lookup "chartGroup" axesSelections of\n      Just _ -> Console.log "\u2713 Chart group created"\n      Nothing -> Console.log "\u2717 Missing chart group"\n\n    case Map.lookup "xAxis" axesSelections of\n      Just _ -> Console.log "\u2713 X axis created"\n      Nothing -> Console.log "\u2717 Missing X axis"\n\n    case Map.lookup "yAxis" axesSelections of\n      Just _ -> Console.log "\u2713 Y axis created"\n      Nothing -> Console.log "\u2717 Missing Y axis"\n\n    case Map.lookup "bars" barsSelections of\n      Just _ -> Console.log "\u2713 Bars collection created"\n      Nothing -> Console.log "\u2717 Missing bars collection"\n\n    Console.log ""\n    Console.log "Expected: 7 blue bars of varying heights with X and Y axes"\n';
  var snippet_anscombesQuartet_content = 'module D3.Viz.TreeAPI.AnscombesQuartet where\n\nimport Prelude\n\nimport Data.Array (length, index)\nimport Data.Foldable (sum)\nimport Data.Int (toNumber)\nimport Data.Maybe (fromMaybe)\nimport Data.Number (pow, sqrt)\nimport Effect (Effect)\nimport Effect.Class (liftEffect)\nimport Effect.Console as Console\nimport PSD3.Axis.Axis (axisBottom, axisLeft, renderAxis)\nimport PSD3.Internal.Capabilities.Selection (select, renderTree)\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_)\nimport PSD3.Internal.Selection.Types (ElementType(..), SEmpty)\nimport PSD3.AST (Tree, joinData)\nimport PSD3.AST as T\nimport PSD3.Expr.Integration (v3Attr, v3AttrStr, v3AttrFn)\nimport PSD3.Expr.Expr (lit, str)\nimport Web.DOM.Element (Element)\n\n-- | Anscombe\'s Quartet - Why visualization matters\n-- |\n-- | Four datasets with IDENTICAL statistics but DIFFERENT distributions\n-- | This demonstrates why summary statistics alone are misleading\n-- |\n-- | Key insight: You MUST visualize data to understand it\n\ntype Point = { x :: Number, y :: Number }\n\ntype Dataset =\n  { name :: String\n  , data :: Array Point\n  , stats :: Statistics\n  }\n\ntype Statistics =\n  { meanX :: Number\n  , meanY :: Number\n  , varianceX :: Number\n  , varianceY :: Number\n  , correlation :: Number\n  }\n\n-- Anscombe\'s original datasets\ndataset1 :: Array Point\ndataset1 =\n  [ { x: 10.0, y: 8.04 }\n  , { x: 8.0, y: 6.95 }\n  , { x: 13.0, y: 7.58 }\n  , { x: 9.0, y: 8.81 }\n  , { x: 11.0, y: 8.33 }\n  , { x: 14.0, y: 9.96 }\n  , { x: 6.0, y: 7.24 }\n  , { x: 4.0, y: 4.26 }\n  , { x: 12.0, y: 10.84 }\n  , { x: 7.0, y: 4.82 }\n  , { x: 5.0, y: 5.68 }\n  ]\n\ndataset2 :: Array Point\ndataset2 =\n  [ { x: 10.0, y: 9.14 }\n  , { x: 8.0, y: 8.14 }\n  , { x: 13.0, y: 8.74 }\n  , { x: 9.0, y: 8.77 }\n  , { x: 11.0, y: 9.26 }\n  , { x: 14.0, y: 8.10 }\n  , { x: 6.0, y: 6.13 }\n  , { x: 4.0, y: 3.10 }\n  , { x: 12.0, y: 9.13 }\n  , { x: 7.0, y: 7.26 }\n  , { x: 5.0, y: 4.74 }\n  ]\n\ndataset3 :: Array Point\ndataset3 =\n  [ { x: 10.0, y: 7.46 }\n  , { x: 8.0, y: 6.77 }\n  , { x: 13.0, y: 12.74 }\n  , { x: 9.0, y: 7.11 }\n  , { x: 11.0, y: 7.81 }\n  , { x: 14.0, y: 8.84 }\n  , { x: 6.0, y: 6.08 }\n  , { x: 4.0, y: 5.39 }\n  , { x: 12.0, y: 8.15 }\n  , { x: 7.0, y: 6.42 }\n  , { x: 5.0, y: 5.73 }\n  ]\n\ndataset4 :: Array Point\ndataset4 =\n  [ { x: 8.0, y: 6.58 }\n  , { x: 8.0, y: 5.76 }\n  , { x: 8.0, y: 7.71 }\n  , { x: 8.0, y: 8.84 }\n  , { x: 8.0, y: 8.47 }\n  , { x: 8.0, y: 7.04 }\n  , { x: 8.0, y: 5.25 }\n  , { x: 19.0, y: 12.50 }\n  , { x: 8.0, y: 5.56 }\n  , { x: 8.0, y: 7.91 }\n  , { x: 8.0, y: 6.89 }\n  ]\n\n-- Calculate statistics for a dataset\ncalculateStats :: Array Point -> Statistics\ncalculateStats points =\n  let n = toNumber (length points)\n      xs = map _.x points\n      ys = map _.y points\n\n      meanX = sum xs / n\n      meanY = sum ys / n\n\n      varianceX = (sum (map (\\x -> pow (x - meanX) 2.0) xs)) / (n - 1.0)\n      varianceY = (sum (map (\\y -> pow (y - meanY) 2.0) ys)) / (n - 1.0)\n\n      -- Pearson correlation coefficient\n      covariance = (sum (map (\\p -> (p.x - meanX) * (p.y - meanY)) points)) / (n - 1.0)\n      correlation = covariance / (sqrt varianceX * sqrt varianceY)\n\n  in { meanX, meanY, varianceX, varianceY, correlation }\n\n-- All four datasets with statistics\nallDatasets :: Array Dataset\nallDatasets =\n  [ { name: "A", data: dataset1, stats: calculateStats dataset1 }\n  , { name: "B", data: dataset2, stats: calculateStats dataset2 }\n  , { name: "C", data: dataset3, stats: calculateStats dataset3 }\n  , { name: "D", data: dataset4, stats: calculateStats dataset4 }\n  ]\n\nanscombesQuartet :: String -> Effect Unit\nanscombesQuartet selector = runD3v2M do\n  container <- select selector :: _ (D3v2Selection_ SEmpty Element Unit)\n\n  -- Layout parameters\n  -- Compact size for foundational example\n  let plotSize = 140.0\n      margin = { top: 20.0, right: 20.0, bottom: 40.0, left: 50.0 }\n      plotWidth = plotSize - margin.left - margin.right\n      plotHeight = plotSize - margin.top - margin.bottom\n      gap = 20.0\n\n      -- Shared scales across all plots\n      xScale = { domain: { min: 0.0, max: 20.0 }, range: { min: 0.0, max: plotWidth } }\n      yScale = { domain: { min: 0.0, max: 14.0 }, range: { min: plotHeight, max: 0.0 } }\n\n      -- Scale helper functions\n      scaleX :: Number -> Number\n      scaleX value =\n        let domainSpan = xScale.domain.max - xScale.domain.min\n            rangeSpan = xScale.range.max - xScale.range.min\n            normalized = (value - xScale.domain.min) / domainSpan\n        in xScale.range.min + (normalized * rangeSpan)\n\n      scaleY :: Number -> Number\n      scaleY value =\n        let domainSpan = yScale.domain.max - yScale.domain.min\n            rangeSpan = yScale.range.max - yScale.range.min\n            normalized = (value - yScale.domain.min) / domainSpan\n        in yScale.range.min + (normalized * rangeSpan)\n\n      -- Calculate position for each plot in a 2x2 grid\n      getPlotX :: Int -> Number\n      getPlotX idx = if idx `mod` 2 == 0 then 0.0 else plotSize + gap\n\n      getPlotY :: Int -> Number\n      getPlotY idx = if idx < 2 then 0.0 else plotSize + gap\n\n  -- Build a single scatterplot with stats\n  let buildPlot :: Int -> Dataset -> Tree Point\n      buildPlot idx dataset =\n        T.named Group ("plot-" <> show idx)\n          [ v3AttrStr "transform" (str ("translate(" <> show (getPlotX idx) <> "," <> show (getPlotY idx) <> ")"))\n          , v3AttrStr "class" (str "anscombe-plot")\n          ]\n          `T.withChildren`\n            [ -- Title\n              T.elem Text\n                [ v3Attr "x" (lit (plotSize / 2.0))\n                , v3Attr "y" (lit 10.0)\n                , v3AttrStr "text-anchor" (str "middle")\n                , v3AttrStr "class" (str "plot-title")\n                , v3AttrStr "textContent" (str dataset.name)\n                ]\n\n            , -- Main plot area\n              T.named Group "plot-area"\n                [ v3AttrStr "transform" (str ("translate(" <> show margin.left <> "," <> show margin.top <> ")")) ]\n                `T.withChildren`\n                  [ -- X-axis\n                    T.named Group "x-axis"\n                      [ v3AttrStr "transform" (str ("translate(0," <> show plotHeight <> ")")) ]\n                      `T.withChild` renderAxis (axisBottom xScale)\n\n                  , -- Y-axis\n                    T.named Group "y-axis"\n                      []\n                      `T.withChild` renderAxis (axisLeft yScale)\n\n                  , -- Data points\n                    joinData ("points-" <> show idx) "circle" dataset.data $ \\d ->\n                      T.elem Circle\n                        [ v3Attr "cx" (lit (scaleX d.x))\n                        , v3Attr "cy" (lit (scaleY d.y))\n                        , v3Attr "r" (lit 3.0)\n                        , v3AttrStr "fill" (str "steelblue")\n                        ]\n                  ]\n            ]\n\n  -- Build all four plots\n  let svgWidth = (plotSize * 2.0) + gap\n      svgHeight = (plotSize * 2.0) + gap\n\n      tree :: Tree Point\n      tree =\n        T.named SVG "svg"\n          [ v3Attr "width" (lit svgWidth)\n          , v3Attr "height" (lit svgHeight)\n          , v3AttrStr "viewBox" (str ("0 0 " <> show svgWidth <> " " <> show svgHeight))\n          , v3AttrStr "id" (str "anscombes-quartet-svg")\n          , v3AttrStr "class" (str "tree-api-example")\n          ]\n          `T.withChildren`\n            [ buildPlot 0 (getDataset 0)\n            , buildPlot 1 (getDataset 1)\n            , buildPlot 2 (getDataset 2)\n            , buildPlot 3 (getDataset 3)\n            ]\n\n      -- Safe dataset getter with fallback\n      getDataset :: Int -> Dataset\n      getDataset idx = fromMaybe (allDatasets `index` 0 # fromMaybe emptyDataset) (allDatasets `index` idx)\n\n      emptyDataset :: Dataset\n      emptyDataset = { name: "Empty", data: [], stats: { meanX: 0.0, meanY: 0.0, varianceX: 0.0, varianceY: 0.0, correlation: 0.0 } }\n\n  -- Render the tree\n  _ <- renderTree container tree\n\n  liftEffect do\n    Console.log "=== Anscombe\'s Quartet ==="\n    Console.log ""\n    Console.log "Four datasets with IDENTICAL statistics:"\n    Console.log "  - Mean X \u2248 9.0"\n    Console.log "  - Mean Y \u2248 7.5"\n    Console.log "  - Variance X \u2248 11.0"\n    Console.log "  - Variance Y \u2248 4.1"\n    Console.log "  - Correlation \u2248 0.816"\n    Console.log ""\n    Console.log "But look at the plots - completely different distributions!"\n    Console.log "  I: Linear relationship"\n    Console.log "  II: Curved relationship"\n    Console.log "  III: Linear with outlier"\n    Console.log "  IV: Vertical line with outlier"\n    Console.log ""\n    Console.log "THIS IS WHY VISUALIZATION MATTERS."\n    Console.log "Summary statistics alone don\'t tell the story."\n    Console.log ""\n\n-- Helper to format numbers to 2 decimal places\nformatNum :: Number -> String\nformatNum n =\n  let rounded = (n * 100.0) / 100.0  -- Simple rounding\n  in show rounded\n\n';
  var snippet_animatedTreeCluster_content = 'module D3.Viz.TreeAPI.AnimatedTreeCluster where\n\n-- | Animated transition between Tree (Reingold-Tilford) and Cluster (dendrogram) layouts\n-- | TreeAPI implementation using sceneJoin for declarative enter/update/exit\n\nimport Prelude hiding (add, sub, mul)\n\nimport Data.Array as Array\nimport Data.List (List(..), fromFoldable)\nimport Data.Maybe (Maybe(..))\nimport Data.Time.Duration (Milliseconds(..))\nimport Control.Comonad.Cofree (head, tail)\nimport Data.Tree (Tree, mkTree)\nimport Effect (Effect)\nimport Effect.Class (liftEffect)\nimport Effect.Console as Console\nimport Type.Proxy (Proxy(..))\nimport PSD3.Shared.FlareData (HierData, getName, getValue, getChildren)\nimport PSD3.Internal.Capabilities.Selection (renderTree, select)\nimport PSD3.Interpreter.D3 (runD3v2M, D3v2Selection_, reselectD3v2)\nimport PSD3.Internal.Selection.Types (ElementType(..), SEmpty)\nimport PSD3.Internal.Transition.Types (TransitionConfig, transition)\nimport PSD3.AST as T\nimport DataViz.Layout.Hierarchy.Cluster (cluster, defaultClusterConfig)\nimport DataViz.Layout.Hierarchy.Tree (treeWithSorting, defaultTreeConfig)\nimport Web.DOM.Element (Element)\n\n-- v3 DSL imports\nimport PSD3.Expr.Expr (class NumExpr)\nimport PSD3.Expr.Datum (class DatumExpr, field)\nimport PSD3.Expr.Path (linkVertical)\nimport PSD3.Expr.Interpreter.Eval (EvalD, runEvalD)\nimport PSD3.Expr.Friendly (num, text, attr, viewBox, width, height, cx, cy, r, fill, stroke, strokeWidth, path)\n\n-- | Layout type\ndata LayoutType = TreeLayout | ClusterLayout\n\nderive instance Eq LayoutType\n\ninstance Show LayoutType where\n  show TreeLayout = "Tree (Reingold-Tilford)"\n  show ClusterLayout = "Cluster (Dendrogram)"\n\n-- | Toggle between layouts\ntoggleLayout :: LayoutType -> LayoutType\ntoggleLayout TreeLayout = ClusterLayout\ntoggleLayout ClusterLayout = TreeLayout\n\n-- | Tree model with position data\ntype TreeModel = { name :: String, value :: Number, x :: Number, y :: Number, depth :: Int, height :: Int }\ntype TreeModelRow = (name :: String, value :: Number, x :: Number, y :: Number, depth :: Int, height :: Int)\n\n-- | Link data with source/target positions\ntype LinkData =\n  { name :: String  -- Unique key: "source->target"\n  , sourceX :: Number\n  , sourceY :: Number\n  , targetX :: Number\n  , targetY :: Number\n  }\ntype LinkRow = (name :: String, sourceX :: Number, sourceY :: Number, targetX :: Number, targetY :: Number)\n\n-- =============================================================================\n-- v3 Expressions\n-- =============================================================================\n\n-- | Node X position\nnodeX :: forall repr. NumExpr repr => DatumExpr repr TreeModelRow => repr Number\nnodeX = field (Proxy :: Proxy "x")\n\n-- | Node Y position\nnodeY :: forall repr. NumExpr repr => DatumExpr repr TreeModelRow => repr Number\nnodeY = field (Proxy :: Proxy "y")\n\n-- | Link path using v3 PathExpr\n-- | linkVertical creates a smooth bezier curve between source and target\nlinkSourceX :: forall repr. NumExpr repr => DatumExpr repr LinkRow => repr Number\nlinkSourceX = field (Proxy :: Proxy "sourceX")\n\nlinkSourceY :: forall repr. NumExpr repr => DatumExpr repr LinkRow => repr Number\nlinkSourceY = field (Proxy :: Proxy "sourceY")\n\nlinkTargetX :: forall repr. NumExpr repr => DatumExpr repr LinkRow => repr Number\nlinkTargetX = field (Proxy :: Proxy "targetX")\n\nlinkTargetY :: forall repr. NumExpr repr => DatumExpr repr LinkRow => repr Number\nlinkTargetY = field (Proxy :: Proxy "targetY")\n\n-- | Evaluate v3 expressions\nevalNode :: forall a. EvalD TreeModel a -> TreeModel -> a\nevalNode expr datum = runEvalD expr datum 0\n\nevalLink :: forall a. EvalD LinkData a -> LinkData -> a\nevalLink expr datum = runEvalD expr datum 0\n\n-- =============================================================================\n-- Data Conversion\n-- =============================================================================\n\n-- | Convert HierData to Data.Tree with both depth and height fields\nhierDataToTree :: HierData -> Tree TreeModel\nhierDataToTree hierData =\n  let\n    name = getName hierData\n    value = getValue hierData\n    childrenMaybe = getChildren hierData\n    childrenList = case childrenMaybe of\n      Nothing -> Nil\n      Just childrenArray -> fromFoldable $ map hierDataToTree childrenArray\n  in\n    mkTree { name, value, x: 0.0, y: 0.0, depth: 0, height: 0 } childrenList\n\n-- | Flatten tree to array\nflattenTree :: forall r. Tree { name :: String | r } -> Array { name :: String | r }\nflattenTree = Array.fromFoldable\n\n-- | Create links from tree structure\nmakeLinks :: forall r. Tree { name :: String, x :: Number, y :: Number | r } -> Array LinkData\nmakeLinks t =\n  let\n    val = head t\n    children = tail t\n    childLinks = Array.fromFoldable children >>= \\child ->\n      let childVal = head child\n      in [ { name: val.name <> "->" <> childVal.name\n           , sourceX: val.x\n           , sourceY: val.y\n           , targetX: childVal.x\n           , targetY: childVal.y\n           } ]\n    grandchildLinks = Array.fromFoldable children >>= makeLinks\n  in\n    childLinks <> grandchildLinks\n\n-- | Vertical link path using v3 PathExpr\nverticalLinkPathV3 :: LinkData -> String\nverticalLinkPathV3 link = runEvalD (linkVertical linkSourceX linkSourceY linkTargetX linkTargetY) link 0\n\n-- | Key functions for sceneJoin\nnodeKey :: TreeModel -> String\nnodeKey node = node.name\n\nlinkKey :: LinkData -> String\nlinkKey link = link.name\n\n-- | Transition config for animations\ntransitionConfig :: TransitionConfig\ntransitionConfig = transition (Milliseconds 1500.0)\n\n-- =============================================================================\n-- TreeAPI Implementation\n-- =============================================================================\n\n-- | Viz state returned from draw\ntype VizState =\n  { dataTree :: Tree TreeModel\n  , chartWidth :: Number\n  , chartHeight :: Number\n  }\n\n-- | Draw the animated tree/cluster visualization using TreeAPI with sceneJoin\n-- | Uses the two-phase approach: render structure first, then data-driven subtrees\ndraw :: HierData -> String -> LayoutType -> Effect VizState\ndraw flareData selector currentLayout = runD3v2M do\n  let chartWidth = 1200.0\n  let chartHeight = 900.0\n\n  liftEffect $ Console.log $ "=== Drawing AnimatedTreeCluster with TreeAPI (sceneJoin) ==="\n  liftEffect $ Console.log $ "Layout: " <> show currentLayout\n\n  -- Convert to Data.Tree\n  let dataTree = hierDataToTree flareData\n\n  -- Apply layout\n  let positioned = case currentLayout of\n        TreeLayout ->\n          let config = defaultTreeConfig { size = { width: chartWidth, height: chartHeight } }\n          in treeWithSorting config dataTree\n        ClusterLayout ->\n          let config = defaultClusterConfig { size = { width: chartWidth, height: chartHeight } }\n          in cluster config dataTree\n\n  -- Flatten nodes and create links\n  let nodes = flattenTree positioned\n  let links = makeLinks positioned\n\n  liftEffect $ Console.log $ "Nodes: " <> show (Array.length nodes) <> ", Links: " <> show (Array.length links)\n\n  -- Select container\n  container <- select selector :: _ (D3v2Selection_ SEmpty Element Unit)\n\n  -- Phase 1: Build the structure tree (no data joins yet)\n  let\n    structureTree :: T.Tree Unit\n    structureTree =\n      T.named SVG "svg"\n        [ viewBox 0.0 0.0 chartWidth chartHeight\n        , attr "class" $ text "animated-tree-cluster"\n        , width $ num chartWidth\n        , height $ num chartHeight\n        ]\n        `T.withChildren`\n          [ T.named Group "linksGroup" [ attr "class" $ text "links" ]\n          , T.named Group "nodesGroup" [ attr "class" $ text "nodes" ]\n          ]\n\n  -- Render structure\n  selections <- renderTree container structureTree\n\n  -- Reselect groups for data rendering\n  linksGroupSel <- liftEffect $ reselectD3v2 "linksGroup" selections\n  nodesGroupSel <- liftEffect $ reselectD3v2 "nodesGroup" selections\n\n  -- Phase 2: Render links with sceneJoin\n  let\n    linksTree :: T.Tree LinkData\n    linksTree =\n      T.sceneJoin "linkElements" "path" links\n        (\\link -> T.elem Path\n          [ attr "class" $ text "link"\n          , path $ text (verticalLinkPathV3 link)\n          , fill $ text "none"\n          , stroke $ text "#555"\n          , strokeWidth $ num 1.5\n          ])\n        { keyFn: Just linkKey\n        , enterBehavior: Just\n            { initialAttrs: []  -- Start with correct path (no position animation on enter)\n            , transition: Nothing  -- Instant enter\n            }\n        , updateBehavior: Just\n            { attrs: []\n            , transition: Just transitionConfig  -- Animate path changes\n            }\n        , exitBehavior: Just\n            { attrs: []\n            , transition: Nothing  -- Instant exit\n            }\n        }\n\n  _ <- renderTree linksGroupSel linksTree\n\n  -- Phase 3: Render nodes with sceneJoin\n  let\n    nodesTree :: T.Tree TreeModel\n    nodesTree =\n      T.sceneJoin "nodeElements" "circle" nodes\n        (\\node -> T.elem Circle\n          [ attr "class" $ text "node"\n          , cx $ num (evalNode nodeX node)  -- v3: node.x\n          , cy $ num (evalNode nodeY node)  -- v3: node.y\n          , r $ num 4.0\n          , fill $ text "#999"\n          , stroke $ text "#555"\n          , strokeWidth $ num 1.5\n          ])\n        { keyFn: Just nodeKey\n        , enterBehavior: Just\n            { initialAttrs: []  -- Start at final position (no animation on enter)\n            , transition: Nothing\n            }\n        , updateBehavior: Just\n            { attrs: []\n            , transition: Just transitionConfig  -- Animate position changes\n            }\n        , exitBehavior: Just\n            { attrs: []\n            , transition: Nothing\n            }\n        }\n\n  _ <- renderTree nodesGroupSel nodesTree\n\n  liftEffect $ Console.log "Rendered with TreeAPI sceneJoin"\n\n  pure { dataTree, chartWidth, chartHeight }\n\n-- | Update existing visualization with new layout\n-- | This re-renders with new positions, and sceneJoin handles the transitions\nupdate :: Tree TreeModel -> String -> Number -> Number -> LayoutType -> Effect Unit\nupdate dataTree selector chartWidth chartHeight currentLayout = runD3v2M do\n  liftEffect $ Console.log $ "=== Updating AnimatedTreeCluster to " <> show currentLayout <> " ==="\n\n  -- Apply layout\n  let positioned = case currentLayout of\n        TreeLayout ->\n          let config = defaultTreeConfig { size = { width: chartWidth, height: chartHeight } }\n          in treeWithSorting config dataTree\n        ClusterLayout ->\n          let config = defaultClusterConfig { size = { width: chartWidth, height: chartHeight } }\n          in cluster config dataTree\n\n  -- Flatten nodes and create links\n  let nodes = flattenTree positioned\n  let links = makeLinks positioned\n\n  -- Select existing groups (structure already rendered)\n  linksGroupSel <- select (selector <> " .links") :: _ (D3v2Selection_ SEmpty Element Unit)\n  nodesGroupSel <- select (selector <> " .nodes") :: _ (D3v2Selection_ SEmpty Element Unit)\n\n  -- Re-render links with new positions - sceneJoin\'s updateBehavior handles transitions\n  let\n    linksTree :: T.Tree LinkData\n    linksTree =\n      T.sceneJoin "linkElements" "path" links\n        (\\link -> T.elem Path\n          [ attr "class" $ text "link"\n          , path $ text (verticalLinkPathV3 link)\n          , fill $ text "none"\n          , stroke $ text "#555"\n          , strokeWidth $ num 1.5\n          ])\n        { keyFn: Just linkKey\n        , enterBehavior: Nothing\n        , updateBehavior: Just\n            { attrs: []\n            , transition: Just transitionConfig\n            }\n        , exitBehavior: Nothing\n        }\n\n  _ <- renderTree linksGroupSel linksTree\n\n  -- Re-render nodes with new positions\n  let\n    nodesTree :: T.Tree TreeModel\n    nodesTree =\n      T.sceneJoin "nodeElements" "circle" nodes\n        (\\node -> T.elem Circle\n          [ attr "class" $ text "node"\n          , cx $ num (evalNode nodeX node)\n          , cy $ num (evalNode nodeY node)\n          , r $ num 4.0\n          , fill $ text "#999"\n          , stroke $ text "#555"\n          , strokeWidth $ num 1.5\n          ])\n        { keyFn: Just nodeKey\n        , enterBehavior: Nothing\n        , updateBehavior: Just\n            { attrs: []\n            , transition: Just transitionConfig\n            }\n        , exitBehavior: Nothing\n        }\n\n  _ <- renderTree nodesGroupSel nodesTree\n\n  liftEffect $ Console.log "Update complete with sceneJoin transitions"\n\n  pure unit\n';
  var getSnippet = function(name16) {
    if (name16 === "threeLittleCircles") {
      return snippet_threeLittleCircles_content;
    }
    ;
    if (name16 === "threeLittleCirclesTransition") {
      return snippet_threeLittleCirclesTransition_content;
    }
    ;
    if (name16 === "simpleTree") {
      return snippet_simpleTree_content;
    }
    ;
    if (name16 === "nestedElements") {
      return snippet_nestedElements_content;
    }
    ;
    if (name16 === "threeLittleDimensions") {
      return snippet_threeLittleDimensions_content;
    }
    ;
    if (name16 === "barChart") {
      return snippet_barChart_content;
    }
    ;
    if (name16 === "scatterPlot") {
      return snippet_scatterPlot_content;
    }
    ;
    if (name16 === "lineChart") {
      return snippet_lineChart_content;
    }
    ;
    if (name16 === "groupedBarChart") {
      return snippet_groupedBarChart_content;
    }
    ;
    if (name16 === "multiLineChart") {
      return snippet_multiLineChart_content;
    }
    ;
    if (name16 === "radialStackedBar") {
      return snippet_radialStackedBar_content;
    }
    ;
    if (name16 === "anscombesQuartet") {
      return snippet_anscombesQuartet_content;
    }
    ;
    if (name16 === "wealthHealth") {
      return snippet_wealthHealth_content;
    }
    ;
    if (name16 === "splom") {
      return snippet_splom_content;
    }
    ;
    if (name16 === "treeViz") {
      return snippet_treeViz_content;
    }
    ;
    if (name16 === "radialTree") {
      return snippet_radialTree_content;
    }
    ;
    if (name16 === "horizontalTree") {
      return snippet_horizontalTree_content;
    }
    ;
    if (name16 === "cluster") {
      return snippet_cluster_content;
    }
    ;
    if (name16 === "treemap") {
      return snippet_treemap_content;
    }
    ;
    if (name16 === "sunburst") {
      return snippet_sunburst_content;
    }
    ;
    if (name16 === "pack") {
      return snippet_pack_content;
    }
    ;
    if (name16 === "partition") {
      return snippet_partition_content;
    }
    ;
    if (name16 === "animatedTreeCluster") {
      return snippet_animatedTreeCluster_content;
    }
    ;
    if (name16 === "sankey") {
      return snippet_sankey_content;
    }
    ;
    if (name16 === "chord") {
      return snippet_chord_content;
    }
    ;
    if (name16 === "edgeBundle") {
      return snippet_edgeBundle_content;
    }
    ;
    if (name16 === "simpleForce") {
      return snippet_simpleForce_content;
    }
    ;
    if (name16 === "lesMis") {
      return snippet_lesMis_content;
    }
    ;
    if (name16 === "v3Parabola") {
      return snippet_v3Parabola_content;
    }
    ;
    if (name16 === "v3Transition") {
      return snippet_v3Transition_content;
    }
    ;
    if (name16 === "v3GUP") {
      return snippet_v3GUP_content;
    }
    ;
    return "Snippet not found: " + name16;
  };

  // output/Data.Array.NonEmpty/index.js
  var fromJust5 = /* @__PURE__ */ fromJust();
  var toArray4 = function(v2) {
    return v2;
  };
  var adaptMaybe = function(f) {
    return function($126) {
      return fromJust5(f(toArray4($126)));
    };
  };
  var head4 = /* @__PURE__ */ adaptMaybe(head2);
  var adaptAny = function(f) {
    return function($128) {
      return f(toArray4($128));
    };
  };
  var index4 = /* @__PURE__ */ adaptAny(index);

  // output/Data.String.CodePoints/foreign.js
  var hasArrayFrom = typeof Array.from === "function";
  var hasStringIterator = typeof Symbol !== "undefined" && Symbol != null && typeof Symbol.iterator !== "undefined" && typeof String.prototype[Symbol.iterator] === "function";
  var hasFromCodePoint = typeof String.prototype.fromCodePoint === "function";
  var hasCodePointAt = typeof String.prototype.codePointAt === "function";
  var _unsafeCodePointAt0 = function(fallback) {
    return hasCodePointAt ? function(str23) {
      return str23.codePointAt(0);
    } : fallback;
  };
  var _codePointAt = function(fallback) {
    return function(Just2) {
      return function(Nothing2) {
        return function(unsafeCodePointAt02) {
          return function(index7) {
            return function(str23) {
              var length10 = str23.length;
              if (index7 < 0 || index7 >= length10) return Nothing2;
              if (hasStringIterator) {
                var iter = str23[Symbol.iterator]();
                for (var i2 = index7; ; --i2) {
                  var o = iter.next();
                  if (o.done) return Nothing2;
                  if (i2 === 0) return Just2(unsafeCodePointAt02(o.value));
                }
              }
              return fallback(index7)(str23);
            };
          };
        };
      };
    };
  };
  var _singleton = function(fallback) {
    return hasFromCodePoint ? String.fromCodePoint : fallback;
  };
  var _take = function(fallback) {
    return function(n) {
      if (hasStringIterator) {
        return function(str23) {
          var accum = "";
          var iter = str23[Symbol.iterator]();
          for (var i2 = 0; i2 < n; ++i2) {
            var o = iter.next();
            if (o.done) return accum;
            accum += o.value;
          }
          return accum;
        };
      }
      return fallback(n);
    };
  };
  var _toCodePointArray = function(fallback) {
    return function(unsafeCodePointAt02) {
      if (hasArrayFrom) {
        return function(str23) {
          return Array.from(str23, unsafeCodePointAt02);
        };
      }
      return fallback;
    };
  };

  // output/Data.String.CodePoints/index.js
  var $runtime_lazy9 = function(name16, moduleName, init4) {
    var state3 = 0;
    var val;
    return function(lineNumber) {
      if (state3 === 2) return val;
      if (state3 === 1) throw new ReferenceError(name16 + " was needed before it finished initializing (module " + moduleName + ", line " + lineNumber + ")", moduleName, lineNumber);
      state3 = 1;
      val = init4();
      state3 = 2;
      return val;
    };
  };
  var fromEnum2 = /* @__PURE__ */ fromEnum(boundedEnumChar);
  var map30 = /* @__PURE__ */ map(functorMaybe);
  var unfoldr2 = /* @__PURE__ */ unfoldr(unfoldableArray);
  var div3 = /* @__PURE__ */ div(euclideanRingInt);
  var mod3 = /* @__PURE__ */ mod(euclideanRingInt);
  var compare6 = /* @__PURE__ */ compare(ordInt);
  var unsurrogate = function(lead) {
    return function(trail) {
      return (((lead - 55296 | 0) * 1024 | 0) + (trail - 56320 | 0) | 0) + 65536 | 0;
    };
  };
  var isTrail = function(cu) {
    return 56320 <= cu && cu <= 57343;
  };
  var isLead = function(cu) {
    return 55296 <= cu && cu <= 56319;
  };
  var uncons5 = function(s3) {
    var v2 = length7(s3);
    if (v2 === 0) {
      return Nothing.value;
    }
    ;
    if (v2 === 1) {
      return new Just({
        head: fromEnum2(charAt(0)(s3)),
        tail: ""
      });
    }
    ;
    var cu1 = fromEnum2(charAt(1)(s3));
    var cu0 = fromEnum2(charAt(0)(s3));
    var $43 = isLead(cu0) && isTrail(cu1);
    if ($43) {
      return new Just({
        head: unsurrogate(cu0)(cu1),
        tail: drop3(2)(s3)
      });
    }
    ;
    return new Just({
      head: cu0,
      tail: drop3(1)(s3)
    });
  };
  var unconsButWithTuple = function(s3) {
    return map30(function(v2) {
      return new Tuple(v2.head, v2.tail);
    })(uncons5(s3));
  };
  var toCodePointArrayFallback = function(s3) {
    return unfoldr2(unconsButWithTuple)(s3);
  };
  var unsafeCodePointAt0Fallback = function(s3) {
    var cu0 = fromEnum2(charAt(0)(s3));
    var $47 = isLead(cu0) && length7(s3) > 1;
    if ($47) {
      var cu1 = fromEnum2(charAt(1)(s3));
      var $48 = isTrail(cu1);
      if ($48) {
        return unsurrogate(cu0)(cu1);
      }
      ;
      return cu0;
    }
    ;
    return cu0;
  };
  var unsafeCodePointAt0 = /* @__PURE__ */ _unsafeCodePointAt0(unsafeCodePointAt0Fallback);
  var toCodePointArray = /* @__PURE__ */ _toCodePointArray(toCodePointArrayFallback)(unsafeCodePointAt0);
  var length9 = function($74) {
    return length3(toCodePointArray($74));
  };
  var indexOf2 = function(p2) {
    return function(s3) {
      return map30(function(i2) {
        return length9(take3(i2)(s3));
      })(indexOf(p2)(s3));
    };
  };
  var fromCharCode2 = /* @__PURE__ */ (function() {
    var $75 = toEnumWithDefaults(boundedEnumChar)(bottom(boundedChar))(top(boundedChar));
    return function($76) {
      return singleton8($75($76));
    };
  })();
  var singletonFallback = function(v2) {
    if (v2 <= 65535) {
      return fromCharCode2(v2);
    }
    ;
    var lead = div3(v2 - 65536 | 0)(1024) + 55296 | 0;
    var trail = mod3(v2 - 65536 | 0)(1024) + 56320 | 0;
    return fromCharCode2(lead) + fromCharCode2(trail);
  };
  var singleton10 = /* @__PURE__ */ _singleton(singletonFallback);
  var takeFallback = function(v2) {
    return function(v1) {
      if (v2 < 1) {
        return "";
      }
      ;
      var v22 = uncons5(v1);
      if (v22 instanceof Just) {
        return singleton10(v22.value0.head) + takeFallback(v2 - 1 | 0)(v22.value0.tail);
      }
      ;
      return v1;
    };
  };
  var take4 = /* @__PURE__ */ _take(takeFallback);
  var splitAt3 = function(i2) {
    return function(s3) {
      var before = take4(i2)(s3);
      return {
        before,
        after: drop3(length7(before))(s3)
      };
    };
  };
  var eqCodePoint = {
    eq: function(x32) {
      return function(y32) {
        return x32 === y32;
      };
    }
  };
  var ordCodePoint = {
    compare: function(x32) {
      return function(y32) {
        return compare6(x32)(y32);
      };
    },
    Eq0: function() {
      return eqCodePoint;
    }
  };
  var drop5 = function(n) {
    return function(s3) {
      return drop3(length7(take4(n)(s3)))(s3);
    };
  };
  var codePointAtFallback = function($copy_n) {
    return function($copy_s) {
      var $tco_var_n = $copy_n;
      var $tco_done = false;
      var $tco_result;
      function $tco_loop(n, s3) {
        var v2 = uncons5(s3);
        if (v2 instanceof Just) {
          var $66 = n === 0;
          if ($66) {
            $tco_done = true;
            return new Just(v2.value0.head);
          }
          ;
          $tco_var_n = n - 1 | 0;
          $copy_s = v2.value0.tail;
          return;
        }
        ;
        $tco_done = true;
        return Nothing.value;
      }
      ;
      while (!$tco_done) {
        $tco_result = $tco_loop($tco_var_n, $copy_s);
      }
      ;
      return $tco_result;
    };
  };
  var codePointAt = function(v2) {
    return function(v1) {
      if (v2 < 0) {
        return Nothing.value;
      }
      ;
      if (v2 === 0 && v1 === "") {
        return Nothing.value;
      }
      ;
      if (v2 === 0) {
        return new Just(unsafeCodePointAt0(v1));
      }
      ;
      return _codePointAt(codePointAtFallback)(Just.create)(Nothing.value)(unsafeCodePointAt0)(v2)(v1);
    };
  };
  var boundedCodePoint = {
    bottom: 0,
    top: 1114111,
    Ord0: function() {
      return ordCodePoint;
    }
  };
  var boundedEnumCodePoint = /* @__PURE__ */ (function() {
    return {
      cardinality: 1114111 + 1 | 0,
      fromEnum: function(v2) {
        return v2;
      },
      toEnum: function(n) {
        if (n >= 0 && n <= 1114111) {
          return new Just(n);
        }
        ;
        if (otherwise) {
          return Nothing.value;
        }
        ;
        throw new Error("Failed pattern match at Data.String.CodePoints (line 63, column 1 - line 68, column 26): " + [n.constructor.name]);
      },
      Bounded0: function() {
        return boundedCodePoint;
      },
      Enum1: function() {
        return $lazy_enumCodePoint(0);
      }
    };
  })();
  var $lazy_enumCodePoint = /* @__PURE__ */ $runtime_lazy9("enumCodePoint", "Data.String.CodePoints", function() {
    return {
      succ: defaultSucc(toEnum(boundedEnumCodePoint))(fromEnum(boundedEnumCodePoint)),
      pred: defaultPred(toEnum(boundedEnumCodePoint))(fromEnum(boundedEnumCodePoint)),
      Ord0: function() {
        return ordCodePoint;
      }
    };
  });

  // output/Data.String.Regex/foreign.js
  var regexImpl = function(left2) {
    return function(right2) {
      return function(s1) {
        return function(s22) {
          try {
            return right2(new RegExp(s1, s22));
          } catch (e) {
            return left2(e.message);
          }
        };
      };
    };
  };
  var _match = function(just) {
    return function(nothing) {
      return function(r29) {
        return function(s3) {
          var m2 = s3.match(r29);
          if (m2 == null || m2.length === 0) {
            return nothing;
          } else {
            for (var i2 = 0; i2 < m2.length; i2++) {
              m2[i2] = m2[i2] == null ? nothing : just(m2[i2]);
            }
            return just(m2);
          }
        };
      };
    };
  };

  // output/Data.String.Regex/index.js
  var renderFlags = function(v2) {
    return (function() {
      if (v2.global) {
        return "g";
      }
      ;
      return "";
    })() + ((function() {
      if (v2.ignoreCase) {
        return "i";
      }
      ;
      return "";
    })() + ((function() {
      if (v2.multiline) {
        return "m";
      }
      ;
      return "";
    })() + ((function() {
      if (v2.dotAll) {
        return "s";
      }
      ;
      return "";
    })() + ((function() {
      if (v2.sticky) {
        return "y";
      }
      ;
      return "";
    })() + (function() {
      if (v2.unicode) {
        return "u";
      }
      ;
      return "";
    })()))));
  };
  var regex = function(s3) {
    return function(f) {
      return regexImpl(Left.create)(Right.create)(s3)(renderFlags(f));
    };
  };
  var parseFlags = function(s3) {
    return {
      global: contains3("g")(s3),
      ignoreCase: contains3("i")(s3),
      multiline: contains3("m")(s3),
      dotAll: contains3("s")(s3),
      sticky: contains3("y")(s3),
      unicode: contains3("u")(s3)
    };
  };
  var match = /* @__PURE__ */ (function() {
    return _match(Just.create)(Nothing.value);
  })();

  // output/Color/index.js
  var clamp2 = /* @__PURE__ */ clamp(ordInt);
  var max7 = /* @__PURE__ */ max(ordInt);
  var min6 = /* @__PURE__ */ min(ordInt);
  var clamp1 = /* @__PURE__ */ clamp(ordNumber);
  var bind8 = /* @__PURE__ */ bind(bindMaybe);
  var map31 = /* @__PURE__ */ map(functorMaybe);
  var join3 = /* @__PURE__ */ join(bindMaybe);
  var alt7 = /* @__PURE__ */ alt(altMaybe);
  var pure11 = /* @__PURE__ */ pure(applicativeMaybe);
  var HSLA = /* @__PURE__ */ (function() {
    function HSLA2(value0, value1, value22, value32) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
      this.value3 = value32;
    }
    ;
    HSLA2.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return function(value32) {
            return new HSLA2(value0, value1, value22, value32);
          };
        };
      };
    };
    return HSLA2;
  })();
  var modPos = function(x32) {
    return function(y32) {
      return remainder(remainder(x32)(y32) + y32)(y32);
    };
  };
  var rgba2 = function(red$prime) {
    return function(green$prime) {
      return function(blue$prime) {
        return function(alpha) {
          var red2 = clamp2(0)(255)(red$prime);
          var r29 = toNumber(red2) / 255;
          var green2 = clamp2(0)(255)(green$prime);
          var g2 = toNumber(green2) / 255;
          var blue2 = clamp2(0)(255)(blue$prime);
          var maxChroma = max7(max7(red2)(green2))(blue2);
          var minChroma = min6(min6(red2)(green2))(blue2);
          var chroma = maxChroma - minChroma | 0;
          var chroma$prime = toNumber(chroma) / 255;
          var lightness = toNumber(maxChroma + minChroma | 0) / (255 * 2);
          var saturation = (function() {
            if (chroma === 0) {
              return 0;
            }
            ;
            if (otherwise) {
              return chroma$prime / (1 - abs(2 * lightness - 1));
            }
            ;
            throw new Error("Failed pattern match at Color (line 160, column 3 - line 162, column 64): ");
          })();
          var b10 = toNumber(blue2) / 255;
          var hue$prime = function(v2) {
            if (v2 === 0) {
              return 0;
            }
            ;
            if (maxChroma === red2) {
              return modPos((g2 - b10) / chroma$prime)(6);
            }
            ;
            if (maxChroma === green2) {
              return (b10 - r29) / chroma$prime + 2;
            }
            ;
            if (otherwise) {
              return (r29 - g2) / chroma$prime + 4;
            }
            ;
            throw new Error("Failed pattern match at Color (line 150, column 3 - line 150, column 15): " + [v2.constructor.name]);
          };
          var hue = 60 * hue$prime(chroma);
          return new HSLA(hue, saturation, lightness, alpha);
        };
      };
    };
  };
  var hsla2 = function(h7) {
    return function(s3) {
      return function(l2) {
        return function(a3) {
          var s$prime = clamp1(0)(1)(s3);
          var l$prime = clamp1(0)(1)(l2);
          var a$prime = clamp1(0)(1)(a3);
          return new HSLA(h7, s$prime, l$prime, a$prime);
        };
      };
    };
  };
  var hsl2 = function(h7) {
    return function(s3) {
      return function(l2) {
        return hsla2(h7)(s3)(l2)(1);
      };
    };
  };
  var fromHexString = function(str23) {
    var parseHex = (function() {
      var $160 = fromMaybe(0);
      var $161 = fromStringAs(hexadecimal);
      return function($162) {
        return $160($161($162));
      };
    })();
    var isShort = length9(str23) < 6;
    var hush = either($$const(Nothing.value))(Just.create);
    var pair = "([0-9a-f][0-9a-f])";
    var single = "([0-9a-f])";
    var variant = (function() {
      if (isShort) {
        return single + (single + (single + (single + "?")));
      }
      ;
      return pair + (pair + (pair + (pair + "?")));
    })();
    var mPattern = regex("^#(?:" + (variant + ")$"))(parseFlags("i"));
    return bind8(hush(mPattern))(function(pattern2) {
      return bind8(match(pattern2)(str23))(function(groups) {
        return bind8(map31(parseHex)(join3(index4(groups)(1))))(function(r29) {
          return bind8(map31(parseHex)(join3(index4(groups)(2))))(function(g2) {
            return bind8(map31(parseHex)(join3(index4(groups)(3))))(function(b10) {
              return bind8(map31(parseHex)(alt7(join3(index4(groups)(4)))(pure11((function() {
                if (isShort) {
                  return "f";
                }
                ;
                return "ff";
              })()))))(function(a3) {
                if (isShort) {
                  var alpha = toNumber(clamp2(0)(15)(a3)) / 15;
                  return pure11(rgba2((16 * r29 | 0) + r29 | 0)((16 * g2 | 0) + g2 | 0)((16 * b10 | 0) + b10 | 0)(alpha));
                }
                ;
                var alpha = toNumber(clamp2(0)(255)(a3)) / 255;
                return pure11(rgba2(r29)(g2)(b10)(alpha));
              });
            });
          });
        });
      });
    });
  };
  var clipHue = function(v2) {
    var $124 = 360 === v2;
    if ($124) {
      return v2;
    }
    ;
    return modPos(v2)(360);
  };
  var toRGBA$prime = function(v2) {
    var h$prime = clipHue(v2.value0) / 60;
    var chr = (1 - abs(2 * v2.value2 - 1)) * v2.value1;
    var m2 = v2.value2 - chr / 2;
    var x32 = chr * (1 - abs(remainder(h$prime)(2) - 1));
    var col2 = (function() {
      if (h$prime < 1) {
        return {
          r: chr,
          g: x32,
          b: 0
        };
      }
      ;
      if (1 <= h$prime && h$prime < 2) {
        return {
          r: x32,
          g: chr,
          b: 0
        };
      }
      ;
      if (2 <= h$prime && h$prime < 3) {
        return {
          r: 0,
          g: chr,
          b: x32
        };
      }
      ;
      if (3 <= h$prime && h$prime < 4) {
        return {
          r: 0,
          g: x32,
          b: chr
        };
      }
      ;
      if (4 <= h$prime && h$prime < 5) {
        return {
          r: x32,
          g: 0,
          b: chr
        };
      }
      ;
      if (otherwise) {
        return {
          r: chr,
          g: 0,
          b: x32
        };
      }
      ;
      throw new Error("Failed pattern match at Color (line 356, column 3 - line 362, column 43): ");
    })();
    return {
      r: col2.r + m2,
      g: col2.g + m2,
      b: col2.b + m2,
      a: v2.value3
    };
  };
  var toRGBA = function(col2) {
    var c2 = toRGBA$prime(col2);
    var g2 = round2(255 * c2.g);
    var r29 = round2(255 * c2.r);
    var b10 = round2(255 * c2.b);
    return {
      r: r29,
      g: g2,
      b: b10,
      a: c2.a
    };
  };
  var toHexString = function(color2) {
    var toHex = function(num41) {
      var repr = toStringAs(hexadecimal)(num41);
      var $152 = length9(repr) === 1;
      if ($152) {
        return "0" + repr;
      }
      ;
      return repr;
    };
    var c2 = toRGBA(color2);
    var alpha = (function() {
      if (c2.a === 1) {
        return "";
      }
      ;
      if (otherwise) {
        return toHex(round2(255 * c2.a));
      }
      ;
      throw new Error("Failed pattern match at Color (line 429, column 3 - line 431, column 46): ");
    })();
    return "#" + (toHex(c2.r) + (toHex(c2.g) + (toHex(c2.b) + alpha)));
  };
  var black = /* @__PURE__ */ hsl2(0)(0)(0);

  // output/PSD3.Expr.Datum/index.js
  var field = function(dict) {
    return dict.field;
  };

  // output/PSD3.Expr.Expr/index.js
  var sub2 = function(dict) {
    return dict.sub;
  };
  var str = function(dict) {
    return dict.str;
  };
  var sin2 = function(dict) {
    return dict.sin;
  };
  var pi3 = function(dict) {
    return dict.pi;
  };
  var mul2 = function(dict) {
    return dict.mul;
  };
  var lt = function(dict) {
    return dict.lt;
  };
  var lit = function(dict) {
    return dict.lit;
  };
  var ifThenElse = function(dict) {
    return dict.ifThenElse;
  };
  var gt = function(dict) {
    return dict.gt;
  };
  var div4 = function(dict) {
    return dict.div;
  };
  var cos2 = function(dict) {
    return dict.cos;
  };
  var add4 = function(dict) {
    return dict.add;
  };

  // output/PSD3.Expr.Friendly/index.js
  var show8 = /* @__PURE__ */ show(showNumber);
  var toAttributeValueString = {
    toAttrValue: /* @__PURE__ */ identity(categoryFn)
  };
  var toAttributeValueNumber = {
    toAttrValue: show8
  };
  var viewBox = function(minX) {
    return function(minY) {
      return function(w) {
        return function(h7) {
          return new StaticAttr("viewBox", new StringValue(show8(minX) + (" " + (show8(minY) + (" " + (show8(w) + (" " + show8(h7))))))));
        };
      };
    };
  };
  var toAttrValue = function(dict) {
    return dict.toAttrValue;
  };
  var timesN = function(dictNumExpr) {
    var mul4 = mul2(dictNumExpr);
    var lit22 = lit(dictNumExpr);
    return function(a3) {
      return function(b10) {
        return mul4(a3)(lit22(b10));
      };
    };
  };
  var text6 = function(dictStringExpr) {
    return str(dictStringExpr);
  };
  var pt = function(dictStringExpr) {
    var str23 = str(dictStringExpr);
    return function(n) {
      return str23(show8(n) + "pt");
    };
  };
  var plusN = function(dictNumExpr) {
    var add8 = add4(dictNumExpr);
    var lit22 = lit(dictNumExpr);
    return function(a3) {
      return function(b10) {
        return add8(a3)(lit22(b10));
      };
    };
  };
  var num = function(dictNumExpr) {
    return lit(dictNumExpr);
  };
  var hex2 = function(dictStringExpr) {
    var str23 = str(dictStringExpr);
    return function(s3) {
      return str23(toHexString(fromMaybe(black)(fromHexString(s3))));
    };
  };
  var fromStr = function(name16) {
    return function(f) {
      return new DataAttr(name16, UnknownSource.value, function(d) {
        return new StringValue(f(d));
      });
    };
  };
  var from3 = function(dictShow) {
    var show140 = show(dictShow);
    return function(name16) {
      return function(f) {
        return new DataAttr(name16, UnknownSource.value, function(d) {
          return new StringValue(show140(f(d)));
        });
      };
    };
  };
  var field2 = function(dictIsSymbol) {
    return function() {
      return function(dictDatumExpr) {
        return field(dictDatumExpr)(dictIsSymbol)()($$Proxy.value);
      };
    };
  };
  var attr3 = function(dictToAttributeValue) {
    var toAttrValue1 = toAttrValue(dictToAttributeValue);
    return function(name16) {
      return function(expr) {
        return new DataAttr(name16, UnknownSource.value, function(d) {
          return new StringValue(toAttrValue1(runEvalD(expr)(d)(0)));
        });
      };
    };
  };
  var cx = function(dictToAttributeValue) {
    return attr3(dictToAttributeValue)("cx");
  };
  var cy = function(dictToAttributeValue) {
    return attr3(dictToAttributeValue)("cy");
  };
  var dominantBaseline = function(dictToAttributeValue) {
    return attr3(dictToAttributeValue)("dominant-baseline");
  };
  var fill = function(dictToAttributeValue) {
    return attr3(dictToAttributeValue)("fill");
  };
  var fontSize = function(dictToAttributeValue) {
    return attr3(dictToAttributeValue)("font-size");
  };
  var height8 = function(dictToAttributeValue) {
    return attr3(dictToAttributeValue)("height");
  };
  var opacity = function(dictToAttributeValue) {
    return attr3(dictToAttributeValue)("opacity");
  };
  var path = function(dictToAttributeValue) {
    return attr3(dictToAttributeValue)("d");
  };
  var r = function(dictToAttributeValue) {
    return attr3(dictToAttributeValue)("r");
  };
  var stroke = function(dictToAttributeValue) {
    return attr3(dictToAttributeValue)("stroke");
  };
  var strokeWidth = function(dictToAttributeValue) {
    return attr3(dictToAttributeValue)("stroke-width");
  };
  var textAnchor = function(dictToAttributeValue) {
    return attr3(dictToAttributeValue)("text-anchor");
  };
  var textContent2 = function(dictToAttributeValue) {
    return attr3(dictToAttributeValue)("textContent");
  };
  var transform2 = function(dictToAttributeValue) {
    return attr3(dictToAttributeValue)("transform");
  };
  var width8 = function(dictToAttributeValue) {
    return attr3(dictToAttributeValue)("width");
  };
  var x = function(dictToAttributeValue) {
    return attr3(dictToAttributeValue)("x");
  };
  var x1 = function(dictToAttributeValue) {
    return attr3(dictToAttributeValue)("x1");
  };
  var x2 = function(dictToAttributeValue) {
    return attr3(dictToAttributeValue)("x2");
  };
  var y = function(dictToAttributeValue) {
    return attr3(dictToAttributeValue)("y");
  };
  var y1 = function(dictToAttributeValue) {
    return attr3(dictToAttributeValue)("y1");
  };
  var y2 = function(dictToAttributeValue) {
    return attr3(dictToAttributeValue)("y2");
  };

  // output/PSD3.ForceEngine.Links/foreign.js
  var buildIntSet = (arr) => new Set(arr);
  var intSetMember = (key2) => (set3) => set3.has(key2);
  var buildIntMap_ = (pairs) => {
    const map131 = /* @__PURE__ */ new Map();
    for (let i2 = 0; i2 < pairs.length; i2++) {
      map131.set(pairs[i2].key, pairs[i2].value);
    }
    return map131;
  };
  var intMapLookup_ = (key2) => (map131) => map131.get(key2);
  var isNull2 = (x32) => x32 == null;

  // output/PSD3.ForceEngine.Links/index.js
  var show9 = /* @__PURE__ */ show(showInt);
  var map32 = /* @__PURE__ */ map(functorArray);
  var bind9 = /* @__PURE__ */ bind(bindMaybe);
  var pure12 = /* @__PURE__ */ pure(applicativeMaybe);
  var unsafeArrayIndex = function(arr) {
    return function(i2) {
      var v2 = index(arr)(i2);
      if (v2 instanceof Just) {
        return v2.value0;
      }
      ;
      if (v2 instanceof Nothing) {
        return unsafeCrashWith("swizzleLinks: Array index out of bounds: " + show9(i2));
      }
      ;
      throw new Error("Failed pattern match at PSD3.ForceEngine.Links (line 115, column 26 - line 117, column 85): " + [v2.constructor.name]);
    };
  };
  var swizzleLinks = function(nodes3) {
    return function(links3) {
      return function(transform17) {
        var swizzle = function(i2) {
          return function(link5) {
            var tgt = unsafeArrayIndex(nodes3)(link5.target);
            var src10 = unsafeArrayIndex(nodes3)(link5.source);
            return transform17(src10)(tgt)(i2)(link5);
          };
        };
        return mapWithIndex3(swizzle)(links3);
      };
    };
  };
  var intMapLookup = function(key2) {
    return function(m2) {
      var result = intMapLookup_(key2)(m2);
      var $10 = isNull2(result);
      if ($10) {
        return Nothing.value;
      }
      ;
      return new Just(result);
    };
  };
  var filterLinksToSubset = function(getIndex) {
    return function(nodes3) {
      return function(links3) {
        var nodeIndices = buildIntSet(map32(getIndex)(nodes3));
        return filter(function(l2) {
          return intSetMember(l2.source)(nodeIndices) && intSetMember(l2.target)(nodeIndices);
        })(links3);
      };
    };
  };
  var buildIntMap = function(getIndex) {
    return function(nodes3) {
      return buildIntMap_(map32(function(n) {
        return {
          key: getIndex(n),
          value: n
        };
      })(nodes3));
    };
  };
  var swizzleLinksByIndex = function(getIndex) {
    return function(nodes3) {
      return function(links3) {
        return function(transform17) {
          var swizzle = function(nodeMap2) {
            return function(link5) {
              return bind9(intMapLookup(link5.source)(nodeMap2))(function(srcNode) {
                return bind9(intMapLookup(link5.target)(nodeMap2))(function(tgtNode) {
                  return pure12({
                    src: srcNode,
                    tgt: tgtNode,
                    link: link5
                  });
                });
              });
            };
          };
          var reindex = function(i2) {
            return function(v2) {
              return transform17(v2.src)(v2.tgt)(i2)(v2.link);
            };
          };
          var nodeMap = buildIntMap(getIndex)(nodes3);
          return mapWithIndex3(reindex)(mapMaybe(swizzle(nodeMap))(links3));
        };
      };
    };
  };

  // output/PSD3.ForceEngine.Simulation/foreign.js
  function updateGridXWithFn_(xFn) {
    return function(nodesRef) {
      return function() {
        const nodes3 = nodesRef.value;
        for (let i2 = 0; i2 < nodes3.length; i2++) {
          const node = nodes3[i2];
          node.gridX = xFn(node);
        }
      };
    };
  }
  function updateGridYWithFn_(yFn) {
    return function(nodesRef) {
      return function() {
        const nodes3 = nodesRef.value;
        for (let i2 = 0; i2 < nodes3.length; i2++) {
          const node = nodes3[i2];
          node.gridY = yFn(node);
        }
      };
    };
  }

  // node_modules/d3-force/src/center.js
  function center_default(x32, y32) {
    var nodes3, strength = 1;
    if (x32 == null) x32 = 0;
    if (y32 == null) y32 = 0;
    function force2() {
      var i2, n = nodes3.length, node, sx = 0, sy = 0;
      for (i2 = 0; i2 < n; ++i2) {
        node = nodes3[i2], sx += node.x, sy += node.y;
      }
      for (sx = (sx / n - x32) * strength, sy = (sy / n - y32) * strength, i2 = 0; i2 < n; ++i2) {
        node = nodes3[i2], node.x -= sx, node.y -= sy;
      }
    }
    force2.initialize = function(_) {
      nodes3 = _;
    };
    force2.x = function(_) {
      return arguments.length ? (x32 = +_, force2) : x32;
    };
    force2.y = function(_) {
      return arguments.length ? (y32 = +_, force2) : y32;
    };
    force2.strength = function(_) {
      return arguments.length ? (strength = +_, force2) : strength;
    };
    return force2;
  }

  // node_modules/d3-quadtree/src/add.js
  function add_default(d) {
    const x32 = +this._x.call(null, d), y32 = +this._y.call(null, d);
    return add5(this.cover(x32, y32), x32, y32, d);
  }
  function add5(tree2, x32, y32, d) {
    if (isNaN(x32) || isNaN(y32)) return tree2;
    var parent2, node = tree2._root, leaf = { data: d }, x0 = tree2._x0, y0 = tree2._y0, x113 = tree2._x1, y114 = tree2._y1, xm, ym, xp, yp, right2, bottom3, i2, j;
    if (!node) return tree2._root = leaf, tree2;
    while (node.length) {
      if (right2 = x32 >= (xm = (x0 + x113) / 2)) x0 = xm;
      else x113 = xm;
      if (bottom3 = y32 >= (ym = (y0 + y114) / 2)) y0 = ym;
      else y114 = ym;
      if (parent2 = node, !(node = node[i2 = bottom3 << 1 | right2])) return parent2[i2] = leaf, tree2;
    }
    xp = +tree2._x.call(null, node.data);
    yp = +tree2._y.call(null, node.data);
    if (x32 === xp && y32 === yp) return leaf.next = node, parent2 ? parent2[i2] = leaf : tree2._root = leaf, tree2;
    do {
      parent2 = parent2 ? parent2[i2] = new Array(4) : tree2._root = new Array(4);
      if (right2 = x32 >= (xm = (x0 + x113) / 2)) x0 = xm;
      else x113 = xm;
      if (bottom3 = y32 >= (ym = (y0 + y114) / 2)) y0 = ym;
      else y114 = ym;
    } while ((i2 = bottom3 << 1 | right2) === (j = (yp >= ym) << 1 | xp >= xm));
    return parent2[j] = node, parent2[i2] = leaf, tree2;
  }
  function addAll(data) {
    var d, i2, n = data.length, x32, y32, xz = new Array(n), yz = new Array(n), x0 = Infinity, y0 = Infinity, x113 = -Infinity, y114 = -Infinity;
    for (i2 = 0; i2 < n; ++i2) {
      if (isNaN(x32 = +this._x.call(null, d = data[i2])) || isNaN(y32 = +this._y.call(null, d))) continue;
      xz[i2] = x32;
      yz[i2] = y32;
      if (x32 < x0) x0 = x32;
      if (x32 > x113) x113 = x32;
      if (y32 < y0) y0 = y32;
      if (y32 > y114) y114 = y32;
    }
    if (x0 > x113 || y0 > y114) return this;
    this.cover(x0, y0).cover(x113, y114);
    for (i2 = 0; i2 < n; ++i2) {
      add5(this, xz[i2], yz[i2], data[i2]);
    }
    return this;
  }

  // node_modules/d3-quadtree/src/cover.js
  function cover_default(x32, y32) {
    if (isNaN(x32 = +x32) || isNaN(y32 = +y32)) return this;
    var x0 = this._x0, y0 = this._y0, x113 = this._x1, y114 = this._y1;
    if (isNaN(x0)) {
      x113 = (x0 = Math.floor(x32)) + 1;
      y114 = (y0 = Math.floor(y32)) + 1;
    } else {
      var z2 = x113 - x0 || 1, node = this._root, parent2, i2;
      while (x0 > x32 || x32 >= x113 || y0 > y32 || y32 >= y114) {
        i2 = (y32 < y0) << 1 | x32 < x0;
        parent2 = new Array(4), parent2[i2] = node, node = parent2, z2 *= 2;
        switch (i2) {
          case 0:
            x113 = x0 + z2, y114 = y0 + z2;
            break;
          case 1:
            x0 = x113 - z2, y114 = y0 + z2;
            break;
          case 2:
            x113 = x0 + z2, y0 = y114 - z2;
            break;
          case 3:
            x0 = x113 - z2, y0 = y114 - z2;
            break;
        }
      }
      if (this._root && this._root.length) this._root = node;
    }
    this._x0 = x0;
    this._y0 = y0;
    this._x1 = x113;
    this._y1 = y114;
    return this;
  }

  // node_modules/d3-quadtree/src/data.js
  function data_default2() {
    var data = [];
    this.visit(function(node) {
      if (!node.length) do
        data.push(node.data);
      while (node = node.next);
    });
    return data;
  }

  // node_modules/d3-quadtree/src/extent.js
  function extent_default(_) {
    return arguments.length ? this.cover(+_[0][0], +_[0][1]).cover(+_[1][0], +_[1][1]) : isNaN(this._x0) ? void 0 : [[this._x0, this._y0], [this._x1, this._y1]];
  }

  // node_modules/d3-quadtree/src/quad.js
  function quad_default(node, x0, y0, x113, y114) {
    this.node = node;
    this.x0 = x0;
    this.y0 = y0;
    this.x1 = x113;
    this.y1 = y114;
  }

  // node_modules/d3-quadtree/src/find.js
  function find_default(x32, y32, radius) {
    var data, x0 = this._x0, y0 = this._y0, x113, y114, x211, y211, x33 = this._x1, y33 = this._y1, quads = [], node = this._root, q3, i2;
    if (node) quads.push(new quad_default(node, x0, y0, x33, y33));
    if (radius == null) radius = Infinity;
    else {
      x0 = x32 - radius, y0 = y32 - radius;
      x33 = x32 + radius, y33 = y32 + radius;
      radius *= radius;
    }
    while (q3 = quads.pop()) {
      if (!(node = q3.node) || (x113 = q3.x0) > x33 || (y114 = q3.y0) > y33 || (x211 = q3.x1) < x0 || (y211 = q3.y1) < y0) continue;
      if (node.length) {
        var xm = (x113 + x211) / 2, ym = (y114 + y211) / 2;
        quads.push(
          new quad_default(node[3], xm, ym, x211, y211),
          new quad_default(node[2], x113, ym, xm, y211),
          new quad_default(node[1], xm, y114, x211, ym),
          new quad_default(node[0], x113, y114, xm, ym)
        );
        if (i2 = (y32 >= ym) << 1 | x32 >= xm) {
          q3 = quads[quads.length - 1];
          quads[quads.length - 1] = quads[quads.length - 1 - i2];
          quads[quads.length - 1 - i2] = q3;
        }
      } else {
        var dx = x32 - +this._x.call(null, node.data), dy = y32 - +this._y.call(null, node.data), d2 = dx * dx + dy * dy;
        if (d2 < radius) {
          var d = Math.sqrt(radius = d2);
          x0 = x32 - d, y0 = y32 - d;
          x33 = x32 + d, y33 = y32 + d;
          data = node.data;
        }
      }
    }
    return data;
  }

  // node_modules/d3-quadtree/src/remove.js
  function remove_default3(d) {
    if (isNaN(x32 = +this._x.call(null, d)) || isNaN(y32 = +this._y.call(null, d))) return this;
    var parent2, node = this._root, retainer, previous, next2, x0 = this._x0, y0 = this._y0, x113 = this._x1, y114 = this._y1, x32, y32, xm, ym, right2, bottom3, i2, j;
    if (!node) return this;
    if (node.length) while (true) {
      if (right2 = x32 >= (xm = (x0 + x113) / 2)) x0 = xm;
      else x113 = xm;
      if (bottom3 = y32 >= (ym = (y0 + y114) / 2)) y0 = ym;
      else y114 = ym;
      if (!(parent2 = node, node = node[i2 = bottom3 << 1 | right2])) return this;
      if (!node.length) break;
      if (parent2[i2 + 1 & 3] || parent2[i2 + 2 & 3] || parent2[i2 + 3 & 3]) retainer = parent2, j = i2;
    }
    while (node.data !== d) if (!(previous = node, node = node.next)) return this;
    if (next2 = node.next) delete node.next;
    if (previous) return next2 ? previous.next = next2 : delete previous.next, this;
    if (!parent2) return this._root = next2, this;
    next2 ? parent2[i2] = next2 : delete parent2[i2];
    if ((node = parent2[0] || parent2[1] || parent2[2] || parent2[3]) && node === (parent2[3] || parent2[2] || parent2[1] || parent2[0]) && !node.length) {
      if (retainer) retainer[j] = node;
      else this._root = node;
    }
    return this;
  }
  function removeAll(data) {
    for (var i2 = 0, n = data.length; i2 < n; ++i2) this.remove(data[i2]);
    return this;
  }

  // node_modules/d3-quadtree/src/root.js
  function root_default() {
    return this._root;
  }

  // node_modules/d3-quadtree/src/size.js
  function size_default2() {
    var size6 = 0;
    this.visit(function(node) {
      if (!node.length) do
        ++size6;
      while (node = node.next);
    });
    return size6;
  }

  // node_modules/d3-quadtree/src/visit.js
  function visit_default(callback) {
    var quads = [], q3, node = this._root, child, x0, y0, x113, y114;
    if (node) quads.push(new quad_default(node, this._x0, this._y0, this._x1, this._y1));
    while (q3 = quads.pop()) {
      if (!callback(node = q3.node, x0 = q3.x0, y0 = q3.y0, x113 = q3.x1, y114 = q3.y1) && node.length) {
        var xm = (x0 + x113) / 2, ym = (y0 + y114) / 2;
        if (child = node[3]) quads.push(new quad_default(child, xm, ym, x113, y114));
        if (child = node[2]) quads.push(new quad_default(child, x0, ym, xm, y114));
        if (child = node[1]) quads.push(new quad_default(child, xm, y0, x113, ym));
        if (child = node[0]) quads.push(new quad_default(child, x0, y0, xm, ym));
      }
    }
    return this;
  }

  // node_modules/d3-quadtree/src/visitAfter.js
  function visitAfter_default(callback) {
    var quads = [], next2 = [], q3;
    if (this._root) quads.push(new quad_default(this._root, this._x0, this._y0, this._x1, this._y1));
    while (q3 = quads.pop()) {
      var node = q3.node;
      if (node.length) {
        var child, x0 = q3.x0, y0 = q3.y0, x113 = q3.x1, y114 = q3.y1, xm = (x0 + x113) / 2, ym = (y0 + y114) / 2;
        if (child = node[0]) quads.push(new quad_default(child, x0, y0, xm, ym));
        if (child = node[1]) quads.push(new quad_default(child, xm, y0, x113, ym));
        if (child = node[2]) quads.push(new quad_default(child, x0, ym, xm, y114));
        if (child = node[3]) quads.push(new quad_default(child, xm, ym, x113, y114));
      }
      next2.push(q3);
    }
    while (q3 = next2.pop()) {
      callback(q3.node, q3.x0, q3.y0, q3.x1, q3.y1);
    }
    return this;
  }

  // node_modules/d3-quadtree/src/x.js
  function defaultX(d) {
    return d[0];
  }
  function x_default(_) {
    return arguments.length ? (this._x = _, this) : this._x;
  }

  // node_modules/d3-quadtree/src/y.js
  function defaultY(d) {
    return d[1];
  }
  function y_default(_) {
    return arguments.length ? (this._y = _, this) : this._y;
  }

  // node_modules/d3-quadtree/src/quadtree.js
  function quadtree(nodes3, x32, y32) {
    var tree2 = new Quadtree(x32 == null ? defaultX : x32, y32 == null ? defaultY : y32, NaN, NaN, NaN, NaN);
    return nodes3 == null ? tree2 : tree2.addAll(nodes3);
  }
  function Quadtree(x32, y32, x0, y0, x113, y114) {
    this._x = x32;
    this._y = y32;
    this._x0 = x0;
    this._y0 = y0;
    this._x1 = x113;
    this._y1 = y114;
    this._root = void 0;
  }
  function leaf_copy(leaf) {
    var copy4 = { data: leaf.data }, next2 = copy4;
    while (leaf = leaf.next) next2 = next2.next = { data: leaf.data };
    return copy4;
  }
  var treeProto = quadtree.prototype = Quadtree.prototype;
  treeProto.copy = function() {
    var copy4 = new Quadtree(this._x, this._y, this._x0, this._y0, this._x1, this._y1), node = this._root, nodes3, child;
    if (!node) return copy4;
    if (!node.length) return copy4._root = leaf_copy(node), copy4;
    nodes3 = [{ source: node, target: copy4._root = new Array(4) }];
    while (node = nodes3.pop()) {
      for (var i2 = 0; i2 < 4; ++i2) {
        if (child = node.source[i2]) {
          if (child.length) nodes3.push({ source: child, target: node.target[i2] = new Array(4) });
          else node.target[i2] = leaf_copy(child);
        }
      }
    }
    return copy4;
  };
  treeProto.add = add_default;
  treeProto.addAll = addAll;
  treeProto.cover = cover_default;
  treeProto.data = data_default2;
  treeProto.extent = extent_default;
  treeProto.find = find_default;
  treeProto.remove = remove_default3;
  treeProto.removeAll = removeAll;
  treeProto.root = root_default;
  treeProto.size = size_default2;
  treeProto.visit = visit_default;
  treeProto.visitAfter = visitAfter_default;
  treeProto.x = x_default;
  treeProto.y = y_default;

  // node_modules/d3-force/src/constant.js
  function constant_default5(x32) {
    return function() {
      return x32;
    };
  }

  // node_modules/d3-force/src/jiggle.js
  function jiggle_default(random2) {
    return (random2() - 0.5) * 1e-6;
  }

  // node_modules/d3-force/src/collide.js
  function x3(d) {
    return d.x + d.vx;
  }
  function y3(d) {
    return d.y + d.vy;
  }
  function collide_default(radius) {
    var nodes3, radii, random2, strength = 1, iterations = 1;
    if (typeof radius !== "function") radius = constant_default5(radius == null ? 1 : +radius);
    function force2() {
      var i2, n = nodes3.length, tree2, node, xi, yi, ri, ri2;
      for (var k = 0; k < iterations; ++k) {
        tree2 = quadtree(nodes3, x3, y3).visitAfter(prepare);
        for (i2 = 0; i2 < n; ++i2) {
          node = nodes3[i2];
          ri = radii[node.index], ri2 = ri * ri;
          xi = node.x + node.vx;
          yi = node.y + node.vy;
          tree2.visit(apply7);
        }
      }
      function apply7(quad, x0, y0, x113, y114) {
        var data = quad.data, rj = quad.r, r29 = ri + rj;
        if (data) {
          if (data.index > node.index) {
            var x32 = xi - data.x - data.vx, y32 = yi - data.y - data.vy, l2 = x32 * x32 + y32 * y32;
            if (l2 < r29 * r29) {
              if (x32 === 0) x32 = jiggle_default(random2), l2 += x32 * x32;
              if (y32 === 0) y32 = jiggle_default(random2), l2 += y32 * y32;
              l2 = (r29 - (l2 = Math.sqrt(l2))) / l2 * strength;
              node.vx += (x32 *= l2) * (r29 = (rj *= rj) / (ri2 + rj));
              node.vy += (y32 *= l2) * r29;
              data.vx -= x32 * (r29 = 1 - r29);
              data.vy -= y32 * r29;
            }
          }
          return;
        }
        return x0 > xi + r29 || x113 < xi - r29 || y0 > yi + r29 || y114 < yi - r29;
      }
    }
    function prepare(quad) {
      if (quad.data) return quad.r = radii[quad.data.index];
      for (var i2 = quad.r = 0; i2 < 4; ++i2) {
        if (quad[i2] && quad[i2].r > quad.r) {
          quad.r = quad[i2].r;
        }
      }
    }
    function initialize() {
      if (!nodes3) return;
      var i2, n = nodes3.length, node;
      radii = new Array(n);
      for (i2 = 0; i2 < n; ++i2) node = nodes3[i2], radii[node.index] = +radius(node, i2, nodes3);
    }
    force2.initialize = function(_nodes, _random) {
      nodes3 = _nodes;
      random2 = _random;
      initialize();
    };
    force2.iterations = function(_) {
      return arguments.length ? (iterations = +_, force2) : iterations;
    };
    force2.strength = function(_) {
      return arguments.length ? (strength = +_, force2) : strength;
    };
    force2.radius = function(_) {
      return arguments.length ? (radius = typeof _ === "function" ? _ : constant_default5(+_), initialize(), force2) : radius;
    };
    return force2;
  }

  // node_modules/d3-force/src/link.js
  function index6(d) {
    return d.index;
  }
  function find4(nodeById, nodeId) {
    var node = nodeById.get(nodeId);
    if (!node) throw new Error("node not found: " + nodeId);
    return node;
  }
  function link_default(links3) {
    var id5 = index6, strength = defaultStrength, strengths, distance = constant_default5(30), distances, nodes3, count, bias, random2, iterations = 1;
    if (links3 == null) links3 = [];
    function defaultStrength(link5) {
      return 1 / Math.min(count[link5.source.index], count[link5.target.index]);
    }
    function force2(alpha) {
      for (var k = 0, n = links3.length; k < iterations; ++k) {
        for (var i2 = 0, link5, source3, target7, x32, y32, l2, b10; i2 < n; ++i2) {
          link5 = links3[i2], source3 = link5.source, target7 = link5.target;
          x32 = target7.x + target7.vx - source3.x - source3.vx || jiggle_default(random2);
          y32 = target7.y + target7.vy - source3.y - source3.vy || jiggle_default(random2);
          l2 = Math.sqrt(x32 * x32 + y32 * y32);
          l2 = (l2 - distances[i2]) / l2 * alpha * strengths[i2];
          x32 *= l2, y32 *= l2;
          target7.vx -= x32 * (b10 = bias[i2]);
          target7.vy -= y32 * b10;
          source3.vx += x32 * (b10 = 1 - b10);
          source3.vy += y32 * b10;
        }
      }
    }
    function initialize() {
      if (!nodes3) return;
      var i2, n = nodes3.length, m2 = links3.length, nodeById = new Map(nodes3.map((d, i3) => [id5(d, i3, nodes3), d])), link5;
      for (i2 = 0, count = new Array(n); i2 < m2; ++i2) {
        link5 = links3[i2], link5.index = i2;
        if (typeof link5.source !== "object") link5.source = find4(nodeById, link5.source);
        if (typeof link5.target !== "object") link5.target = find4(nodeById, link5.target);
        count[link5.source.index] = (count[link5.source.index] || 0) + 1;
        count[link5.target.index] = (count[link5.target.index] || 0) + 1;
      }
      for (i2 = 0, bias = new Array(m2); i2 < m2; ++i2) {
        link5 = links3[i2], bias[i2] = count[link5.source.index] / (count[link5.source.index] + count[link5.target.index]);
      }
      strengths = new Array(m2), initializeStrength();
      distances = new Array(m2), initializeDistance();
    }
    function initializeStrength() {
      if (!nodes3) return;
      for (var i2 = 0, n = links3.length; i2 < n; ++i2) {
        strengths[i2] = +strength(links3[i2], i2, links3);
      }
    }
    function initializeDistance() {
      if (!nodes3) return;
      for (var i2 = 0, n = links3.length; i2 < n; ++i2) {
        distances[i2] = +distance(links3[i2], i2, links3);
      }
    }
    force2.initialize = function(_nodes, _random) {
      nodes3 = _nodes;
      random2 = _random;
      initialize();
    };
    force2.links = function(_) {
      return arguments.length ? (links3 = _, initialize(), force2) : links3;
    };
    force2.id = function(_) {
      return arguments.length ? (id5 = _, force2) : id5;
    };
    force2.iterations = function(_) {
      return arguments.length ? (iterations = +_, force2) : iterations;
    };
    force2.strength = function(_) {
      return arguments.length ? (strength = typeof _ === "function" ? _ : constant_default5(+_), initializeStrength(), force2) : strength;
    };
    force2.distance = function(_) {
      return arguments.length ? (distance = typeof _ === "function" ? _ : constant_default5(+_), initializeDistance(), force2) : distance;
    };
    return force2;
  }

  // node_modules/d3-force/src/simulation.js
  function x4(d) {
    return d.x;
  }
  function y4(d) {
    return d.y;
  }
  var initialAngle = Math.PI * (3 - Math.sqrt(5));

  // node_modules/d3-force/src/manyBody.js
  function manyBody_default() {
    var nodes3, node, random2, alpha, strength = constant_default5(-30), strengths, distanceMin2 = 1, distanceMax2 = Infinity, theta2 = 0.81;
    function force2(_) {
      var i2, n = nodes3.length, tree2 = quadtree(nodes3, x4, y4).visitAfter(accumulate);
      for (alpha = _, i2 = 0; i2 < n; ++i2) node = nodes3[i2], tree2.visit(apply7);
    }
    function initialize() {
      if (!nodes3) return;
      var i2, n = nodes3.length, node2;
      strengths = new Array(n);
      for (i2 = 0; i2 < n; ++i2) node2 = nodes3[i2], strengths[node2.index] = +strength(node2, i2, nodes3);
    }
    function accumulate(quad) {
      var strength2 = 0, q3, c2, weight = 0, x32, y32, i2;
      if (quad.length) {
        for (x32 = y32 = i2 = 0; i2 < 4; ++i2) {
          if ((q3 = quad[i2]) && (c2 = Math.abs(q3.value))) {
            strength2 += q3.value, weight += c2, x32 += c2 * q3.x, y32 += c2 * q3.y;
          }
        }
        quad.x = x32 / weight;
        quad.y = y32 / weight;
      } else {
        q3 = quad;
        q3.x = q3.data.x;
        q3.y = q3.data.y;
        do
          strength2 += strengths[q3.data.index];
        while (q3 = q3.next);
      }
      quad.value = strength2;
    }
    function apply7(quad, x113, _, x211) {
      if (!quad.value) return true;
      var x32 = quad.x - node.x, y32 = quad.y - node.y, w = x211 - x113, l2 = x32 * x32 + y32 * y32;
      if (w * w / theta2 < l2) {
        if (l2 < distanceMax2) {
          if (x32 === 0) x32 = jiggle_default(random2), l2 += x32 * x32;
          if (y32 === 0) y32 = jiggle_default(random2), l2 += y32 * y32;
          if (l2 < distanceMin2) l2 = Math.sqrt(distanceMin2 * l2);
          node.vx += x32 * quad.value * alpha / l2;
          node.vy += y32 * quad.value * alpha / l2;
        }
        return true;
      } else if (quad.length || l2 >= distanceMax2) return;
      if (quad.data !== node || quad.next) {
        if (x32 === 0) x32 = jiggle_default(random2), l2 += x32 * x32;
        if (y32 === 0) y32 = jiggle_default(random2), l2 += y32 * y32;
        if (l2 < distanceMin2) l2 = Math.sqrt(distanceMin2 * l2);
      }
      do
        if (quad.data !== node) {
          w = strengths[quad.data.index] * alpha / l2;
          node.vx += x32 * w;
          node.vy += y32 * w;
        }
      while (quad = quad.next);
    }
    force2.initialize = function(_nodes, _random) {
      nodes3 = _nodes;
      random2 = _random;
      initialize();
    };
    force2.strength = function(_) {
      return arguments.length ? (strength = typeof _ === "function" ? _ : constant_default5(+_), initialize(), force2) : strength;
    };
    force2.distanceMin = function(_) {
      return arguments.length ? (distanceMin2 = _ * _, force2) : Math.sqrt(distanceMin2);
    };
    force2.distanceMax = function(_) {
      return arguments.length ? (distanceMax2 = _ * _, force2) : Math.sqrt(distanceMax2);
    };
    force2.theta = function(_) {
      return arguments.length ? (theta2 = _ * _, force2) : Math.sqrt(theta2);
    };
    return force2;
  }

  // node_modules/d3-force/src/radial.js
  function radial_default(radius, x32, y32) {
    var nodes3, strength = constant_default5(0.1), strengths, radiuses;
    if (typeof radius !== "function") radius = constant_default5(+radius);
    if (x32 == null) x32 = 0;
    if (y32 == null) y32 = 0;
    function force2(alpha) {
      for (var i2 = 0, n = nodes3.length; i2 < n; ++i2) {
        var node = nodes3[i2], dx = node.x - x32 || 1e-6, dy = node.y - y32 || 1e-6, r29 = Math.sqrt(dx * dx + dy * dy), k = (radiuses[i2] - r29) * strengths[i2] * alpha / r29;
        node.vx += dx * k;
        node.vy += dy * k;
      }
    }
    function initialize() {
      if (!nodes3) return;
      var i2, n = nodes3.length;
      strengths = new Array(n);
      radiuses = new Array(n);
      for (i2 = 0; i2 < n; ++i2) {
        radiuses[i2] = +radius(nodes3[i2], i2, nodes3);
        strengths[i2] = isNaN(radiuses[i2]) ? 0 : +strength(nodes3[i2], i2, nodes3);
      }
    }
    force2.initialize = function(_) {
      nodes3 = _, initialize();
    };
    force2.strength = function(_) {
      return arguments.length ? (strength = typeof _ === "function" ? _ : constant_default5(+_), initialize(), force2) : strength;
    };
    force2.radius = function(_) {
      return arguments.length ? (radius = typeof _ === "function" ? _ : constant_default5(+_), initialize(), force2) : radius;
    };
    force2.x = function(_) {
      return arguments.length ? (x32 = +_, force2) : x32;
    };
    force2.y = function(_) {
      return arguments.length ? (y32 = +_, force2) : y32;
    };
    return force2;
  }

  // node_modules/d3-force/src/x.js
  function x_default2(x32) {
    var strength = constant_default5(0.1), nodes3, strengths, xz;
    if (typeof x32 !== "function") x32 = constant_default5(x32 == null ? 0 : +x32);
    function force2(alpha) {
      for (var i2 = 0, n = nodes3.length, node; i2 < n; ++i2) {
        node = nodes3[i2], node.vx += (xz[i2] - node.x) * strengths[i2] * alpha;
      }
    }
    function initialize() {
      if (!nodes3) return;
      var i2, n = nodes3.length;
      strengths = new Array(n);
      xz = new Array(n);
      for (i2 = 0; i2 < n; ++i2) {
        strengths[i2] = isNaN(xz[i2] = +x32(nodes3[i2], i2, nodes3)) ? 0 : +strength(nodes3[i2], i2, nodes3);
      }
    }
    force2.initialize = function(_) {
      nodes3 = _;
      initialize();
    };
    force2.strength = function(_) {
      return arguments.length ? (strength = typeof _ === "function" ? _ : constant_default5(+_), initialize(), force2) : strength;
    };
    force2.x = function(_) {
      return arguments.length ? (x32 = typeof _ === "function" ? _ : constant_default5(+_), initialize(), force2) : x32;
    };
    return force2;
  }

  // node_modules/d3-force/src/y.js
  function y_default2(y32) {
    var strength = constant_default5(0.1), nodes3, strengths, yz;
    if (typeof y32 !== "function") y32 = constant_default5(y32 == null ? 0 : +y32);
    function force2(alpha) {
      for (var i2 = 0, n = nodes3.length, node; i2 < n; ++i2) {
        node = nodes3[i2], node.vy += (yz[i2] - node.y) * strengths[i2] * alpha;
      }
    }
    function initialize() {
      if (!nodes3) return;
      var i2, n = nodes3.length;
      strengths = new Array(n);
      yz = new Array(n);
      for (i2 = 0; i2 < n; ++i2) {
        strengths[i2] = isNaN(yz[i2] = +y32(nodes3[i2], i2, nodes3)) ? 0 : +strength(nodes3[i2], i2, nodes3);
      }
    }
    force2.initialize = function(_) {
      nodes3 = _;
      initialize();
    };
    force2.strength = function(_) {
      return arguments.length ? (strength = typeof _ === "function" ? _ : constant_default5(+_), initialize(), force2) : strength;
    };
    force2.y = function(_) {
      return arguments.length ? (y32 = typeof _ === "function" ? _ : constant_default5(+_), initialize(), force2) : y32;
    };
    return force2;
  }

  // output/PSD3.ForceEngine.Core/foreign.js
  function createManyBody_(config) {
    const force2 = manyBody_default().strength(config.strength).theta(config.theta).distanceMin(config.distanceMin).distanceMax(config.distanceMax);
    return force2;
  }
  function createCollide_(config) {
    const force2 = collide_default().radius(config.radius).strength(config.strength).iterations(config.iterations);
    return force2;
  }
  function createLink_(config) {
    const force2 = link_default().id((d) => d.id).distance(config.distance).strength(config.strength).iterations(config.iterations);
    return force2;
  }
  function createCenter_(config) {
    const force2 = center_default(config.x, config.y).strength(config.strength);
    return force2;
  }
  function createForceX_(config) {
    const force2 = x_default2(config.x).strength(config.strength);
    return force2;
  }
  function createForceY_(config) {
    const force2 = y_default2(config.y).strength(config.strength);
    return force2;
  }
  function createRadial_(config) {
    const force2 = radial_default(config.radius, config.x, config.y).strength(config.strength);
    return force2;
  }
  function createManyBodyFiltered_(config) {
    const force2 = manyBody_default().strength(function(d) {
      return config.filter(d) ? config.strength : 0;
    }).theta(config.theta).distanceMin(config.distanceMin).distanceMax(config.distanceMax);
    return force2;
  }
  function createRadialFiltered_(config) {
    const force2 = radial_default(config.radius, config.x, config.y).strength(function(d) {
      return config.filter(d) ? config.strength : 0;
    });
    return force2;
  }
  function createCollideDynamic_(config) {
    const force2 = collide_default().radius(function(d) {
      return config.radiusAccessor(d);
    }).strength(config.strength).iterations(config.iterations);
    return force2;
  }
  var forceXDebugCount = 0;
  function createForceXDynamic_(config) {
    const force2 = x_default2().x(function(d) {
      const target7 = config.xAccessor(d);
      if (forceXDebugCount < 5 && d.id >= 93) {
        const dist = Math.abs(d.x - target7);
        console.log(`[ForceXDynamic] module ${d.id} (${d.name?.substring(0, 20)}) -> gridX=${target7?.toFixed(0)}, x=${d.x?.toFixed(0)}, dist=${dist.toFixed(0)}`);
        forceXDebugCount++;
      }
      return target7;
    }).strength(config.strength);
    return force2;
  }
  function createForceYDynamic_(config) {
    const force2 = y_default2().y(function(d) {
      return config.yAccessor(d);
    }).strength(config.strength);
    return force2;
  }
  function createForceXGrid_(strength) {
    return x_default2().x((d) => d.gridX).strength(strength);
  }
  function createForceYGrid_(strength) {
    return y_default2().y((d) => d.gridY).strength(strength);
  }
  function initializeForce_(force2) {
    return function(nodes3) {
      return function() {
        const start4 = performance.now();
        if (force2.initialize) {
          force2.initialize(nodes3, Math.random);
        }
        const elapsed = performance.now() - start4;
        if (elapsed > 1) {
          console.log(`[InitForce] Took ${elapsed.toFixed(1)}ms for ${nodes3.length} nodes`);
        }
        return force2;
      };
    };
  }
  function initializeLinkForce_(force2) {
    return function(nodes3) {
      return function(links3) {
        return function() {
          if (force2.initialize) {
            force2.initialize(nodes3, Math.random);
          }
          const linksCopy = links3.map((l2) => ({ ...l2 }));
          force2.links(linksCopy);
          return force2;
        };
      };
    };
  }
  function applyForce_(force2) {
    return function(alpha) {
      return function() {
        const start4 = performance.now();
        force2(alpha);
        const elapsed = performance.now() - start4;
      };
    };
  }
  var integrateDebugCount = 0;
  function integratePositions_(nodes3) {
    return function(velocityDecay) {
      return function() {
        const start4 = performance.now();
        if (integrateDebugCount % 100 === 0) {
          const freeNode = nodes3.find((n) => n.fx == null);
          if (freeNode) {
            console.log(`[IntegrateDebug tick=${integrateDebugCount}] free node ${freeNode.id}: x=${freeNode.x?.toFixed(1)}, y=${freeNode.y?.toFixed(1)}, vx=${freeNode.vx?.toFixed(3)}, vy=${freeNode.vy?.toFixed(3)}`);
          } else {
            console.log(`[IntegrateDebug tick=${integrateDebugCount}] NO FREE NODES! All ${nodes3.length} nodes have fx set`);
          }
        }
        integrateDebugCount++;
        for (let i2 = 0; i2 < nodes3.length; i2++) {
          const node = nodes3[i2];
          if (node.fx != null) {
            node.x = node.fx;
            node.vx = 0;
          } else {
            node.vx *= velocityDecay;
            node.x += node.vx;
          }
          if (node.fy != null) {
            node.y = node.fy;
            node.vy = 0;
          } else {
            node.vy *= velocityDecay;
            node.y += node.vy;
          }
        }
        const elapsed = performance.now() - start4;
        if (elapsed > 2) {
          console.log(`[Integrate] Took ${elapsed.toFixed(1)}ms for ${nodes3.length} nodes`);
        }
      };
    };
  }
  function decayAlpha_(alpha) {
    return function(alphaMin) {
      return function(alphaDecay) {
        return function(alphaTarget) {
          const newAlpha = alpha + (alphaTarget - alpha) * alphaDecay;
          return newAlpha < alphaMin ? 0 : newAlpha;
        };
      };
    };
  }
  function initializeNodes_(nodes3) {
    return function() {
      for (let i2 = 0; i2 < nodes3.length; i2++) {
        const node = nodes3[i2];
        node.index = i2;
        if (node.vx === void 0) node.vx = 0;
        if (node.vy === void 0) node.vy = 0;
        if (node.x === void 0) node.x = Math.random() * 100 - 50;
        if (node.y === void 0) node.y = Math.random() * 100 - 50;
        if (node.id === 93) {
          node.__simMarker__ = true;
          console.log(`[InitNodes] Marked node 93 with __simMarker__, x=${node.x?.toFixed(1)}`);
        }
      }
    };
  }
  var tickStats = { count: 0, totalTime: 0, maxTime: 0, lastReport: Date.now() };
  var lastTickEnd = performance.now();
  var gapStats = { total: 0, max: 0, count: 0 };
  var USE_SETTIMEOUT = true;
  var FRAME_TIME = 8;
  function requestAnimationFrame_(callback) {
    return function() {
      const scheduleTime = performance.now();
      const gapSinceLastTick = scheduleTime - lastTickEnd;
      let id5;
      const handler3 = function(timestamp) {
        const fireTime = performance.now();
        const waitTime = fireTime - scheduleTime;
        const start4 = performance.now();
        callback(timestamp || fireTime)();
        const elapsed = performance.now() - start4;
        lastTickEnd = performance.now();
        tickStats.count++;
        tickStats.totalTime += elapsed;
        tickStats.maxTime = Math.max(tickStats.maxTime, elapsed);
        gapStats.total += waitTime;
        gapStats.max = Math.max(gapStats.max, waitTime);
        gapStats.count++;
        const now3 = Date.now();
        if (now3 - tickStats.lastReport > 2e3) {
          const avg = tickStats.totalTime / tickStats.count;
          const avgGap = gapStats.total / gapStats.count;
          console.log(`[AnimLoop] ${tickStats.count} ticks, work=${avg.toFixed(1)}ms, wait=${avgGap.toFixed(0)}ms (max=${gapStats.max.toFixed(0)}ms) [${USE_SETTIMEOUT ? "setTimeout" : "rAF"}]`);
          tickStats = { count: 0, totalTime: 0, maxTime: 0, lastReport: now3 };
          gapStats = { total: 0, max: 0, count: 0 };
        }
      };
      if (USE_SETTIMEOUT) {
        id5 = setTimeout(handler3, FRAME_TIME);
        return function() {
          clearTimeout(id5);
        };
      } else {
        id5 = requestAnimationFrame(handler3);
        return function() {
          cancelAnimationFrame(id5);
        };
      }
    };
  }
  function newCancelRef() {
    return function() {
      return { cancel: function() {
      } };
    };
  }
  function setCancelRef(ref2) {
    return function(cancel) {
      return function() {
        ref2.cancel = cancel;
      };
    };
  }
  function getCancelRef(ref2) {
    return function() {
      return ref2.cancel;
    };
  }

  // output/PSD3.ForceEngine.Core/index.js
  var bind10 = /* @__PURE__ */ bind(bindEffect);
  var when3 = /* @__PURE__ */ when(applicativeEffect);
  var identity13 = /* @__PURE__ */ identity(categoryFn);
  var for_2 = /* @__PURE__ */ for_(applicativeEffect)(foldableArray);
  var startAnimation = function(onFrame) {
    return function __do7() {
      var cancelRef = newCancelRef();
      var loop2 = function(timestamp) {
        return function __do8() {
          var $$continue = onFrame(timestamp)();
          return when3($$continue)(function __do9() {
            var cancel2 = requestAnimationFrame_(loop2)();
            return setCancelRef(cancelRef)(cancel2)();
          })();
        };
      };
      var cancel = requestAnimationFrame_(loop2)();
      setCancelRef(cancelRef)(cancel)();
      return bind10(getCancelRef(cancelRef))(identity13);
    };
  };
  var integratePositions = integratePositions_;
  var initializeNodes = initializeNodes_;
  var initializeLinkForce = initializeLinkForce_;
  var initializeForce = initializeForce_;
  var decayAlpha = decayAlpha_;
  var createRadialFiltered = createRadialFiltered_;
  var createRadial = createRadial_;
  var createManyBodyFiltered = createManyBodyFiltered_;
  var createManyBody = createManyBody_;
  var createLink = createLink_;
  var createForceYGrid = createForceYGrid_;
  var createForceYDynamic = createForceYDynamic_;
  var createForceY = createForceY_;
  var createForceXGrid = createForceXGrid_;
  var createForceXDynamic = createForceXDynamic_;
  var createForceX = createForceX_;
  var createCollideDynamic = createCollideDynamic_;
  var createCollide = createCollide_;
  var createCenter = createCenter_;
  var applyForce = applyForce_;
  var applyForces = function(forces) {
    return function(alpha) {
      return for_2(forces)(function(f) {
        return applyForce(f)(alpha);
      });
    };
  };

  // output/PSD3.ForceEngine.Types/index.js
  var ManyBody = /* @__PURE__ */ (function() {
    function ManyBody2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    ManyBody2.create = function(value0) {
      return function(value1) {
        return new ManyBody2(value0, value1);
      };
    };
    return ManyBody2;
  })();
  var Collide = /* @__PURE__ */ (function() {
    function Collide2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    Collide2.create = function(value0) {
      return function(value1) {
        return new Collide2(value0, value1);
      };
    };
    return Collide2;
  })();
  var Link = /* @__PURE__ */ (function() {
    function Link3(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    Link3.create = function(value0) {
      return function(value1) {
        return new Link3(value0, value1);
      };
    };
    return Link3;
  })();
  var Center = /* @__PURE__ */ (function() {
    function Center3(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    Center3.create = function(value0) {
      return function(value1) {
        return new Center3(value0, value1);
      };
    };
    return Center3;
  })();
  var PositionX = /* @__PURE__ */ (function() {
    function PositionX2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    PositionX2.create = function(value0) {
      return function(value1) {
        return new PositionX2(value0, value1);
      };
    };
    return PositionX2;
  })();
  var PositionY = /* @__PURE__ */ (function() {
    function PositionY2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    PositionY2.create = function(value0) {
      return function(value1) {
        return new PositionY2(value0, value1);
      };
    };
    return PositionY2;
  })();
  var Radial = /* @__PURE__ */ (function() {
    function Radial3(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    Radial3.create = function(value0) {
      return function(value1) {
        return new Radial3(value0, value1);
      };
    };
    return Radial3;
  })();
  var defaultSimParams = {
    alpha: 1,
    alphaMin: 1e-3,
    alphaDecay: 0.01,
    alphaTarget: 0,
    velocityDecay: 0.4
  };
  var defaultManyBody = /* @__PURE__ */ (function() {
    return {
      strength: -30,
      theta: 0.9,
      distanceMin: 1,
      distanceMax: 1e10
    };
  })();
  var defaultLink = {
    distance: 30,
    strength: 1,
    iterations: 1
  };
  var defaultCollide = {
    radius: 1,
    strength: 1,
    iterations: 1
  };
  var defaultCenter = {
    x: 0,
    y: 0,
    strength: 1
  };

  // output/PSD3.ForceEngine.Simulation/index.js
  var for_3 = /* @__PURE__ */ for_(applicativeEffect);
  var for_1 = /* @__PURE__ */ for_3(foldableArray);
  var toUnfoldable4 = /* @__PURE__ */ toUnfoldable2(unfoldableArray);
  var pure13 = /* @__PURE__ */ pure(applicativeEffect);
  var $$delete4 = /* @__PURE__ */ $$delete2(ordString);
  var when4 = /* @__PURE__ */ when(applicativeEffect);
  var fromFoldable8 = /* @__PURE__ */ fromFoldable3(foldableList);
  var unless2 = /* @__PURE__ */ unless(applicativeEffect);
  var for_22 = /* @__PURE__ */ for_3(foldableMaybe);
  var $$void8 = /* @__PURE__ */ $$void(functorEffect);
  var insert6 = /* @__PURE__ */ insert(ordString);
  var stop = function(sim) {
    return function __do7() {
      write(false)(sim.running)();
      var cancel = read(sim.cancelAnimation)();
      return cancel();
    };
  };
  var setNodes = function(nodes3) {
    return function(sim) {
      return function __do7() {
        initializeNodes(nodes3)();
        write(nodes3)(sim.nodes)();
        var forces = read(sim.forces)();
        return for_1(toUnfoldable4(forces))(function(v2) {
          return function __do8() {
            initializeForce(v2.value1)(nodes3)();
            return unit;
          };
        })();
      };
    };
  };
  var setLinks = function(links3) {
    return function(sim) {
      return write(links3)(sim.links);
    };
  };
  var removeForce = function(name16) {
    return function(sim) {
      return modify_2($$delete4(name16))(sim.forces);
    };
  };
  var onTick = function(callback) {
    return function(sim) {
      return write(callback)(sim.tickCallback);
    };
  };
  var invokeTickCallback = function(sim) {
    if (sim.callbacks instanceof Nothing) {
      return pure13(unit);
    }
    ;
    if (sim.callbacks instanceof Just) {
      return function __do7() {
        var callback = read(sim.callbacks.value0.onTick)();
        return callback();
      };
    }
    ;
    throw new Error("Failed pattern match at PSD3.ForceEngine.Simulation (line 514, column 26 - line 518, column 13): " + [sim.callbacks.constructor.name]);
  };
  var invokeStopCallback = function(sim) {
    if (sim.callbacks instanceof Nothing) {
      return pure13(unit);
    }
    ;
    if (sim.callbacks instanceof Just) {
      return function __do7() {
        var callback = read(sim.callbacks.value0.onStop)();
        return callback();
      };
    }
    ;
    throw new Error("Failed pattern match at PSD3.ForceEngine.Simulation (line 504, column 26 - line 508, column 13): " + [sim.callbacks.constructor.name]);
  };
  var invokeStartCallback = function(sim) {
    if (sim.callbacks instanceof Nothing) {
      return pure13(unit);
    }
    ;
    if (sim.callbacks instanceof Just) {
      return function __do7() {
        var callback = read(sim.callbacks.value0.onStart)();
        return callback();
      };
    }
    ;
    throw new Error("Failed pattern match at PSD3.ForceEngine.Simulation (line 494, column 27 - line 498, column 13): " + [sim.callbacks.constructor.name]);
  };
  var getNodes = function(sim) {
    return read(sim.nodes);
  };
  var getLinks = function(sim) {
    return read(sim.links);
  };
  var getCallbacks = function(sim) {
    return sim.callbacks;
  };
  var defaultConfig2 = /* @__PURE__ */ (function() {
    return {
      alphaMin: defaultSimParams.alphaMin,
      alphaDecay: defaultSimParams.alphaDecay,
      alphaTarget: defaultSimParams.alphaTarget,
      velocityDecay: defaultSimParams.velocityDecay
    };
  })();
  var createWithCallbacks = function(config) {
    return function(cbs) {
      return function __do7() {
        var nodesRef = $$new([])();
        var linksRef = $$new([])();
        var forcesRef = $$new(empty4)();
        var alphaRef = $$new(1)();
        var prevAlphaRef = $$new(1)();
        var runningRef = $$new(false)();
        var cancelRef = $$new(pure13(unit))();
        var tickRef = $$new(pure13(unit))();
        return {
          nodes: nodesRef,
          links: linksRef,
          forces: forcesRef,
          alpha: alphaRef,
          prevAlpha: prevAlphaRef,
          config,
          running: runningRef,
          cancelAnimation: cancelRef,
          tickCallback: tickRef,
          callbacks: new Just(cbs)
        };
      };
    };
  };
  var create5 = function(config) {
    return function __do7() {
      var nodesRef = $$new([])();
      var linksRef = $$new([])();
      var forcesRef = $$new(empty4)();
      var alphaRef = $$new(1)();
      var prevAlphaRef = $$new(1)();
      var runningRef = $$new(false)();
      var cancelRef = $$new(pure13(unit))();
      var tickRef = $$new(pure13(unit))();
      return {
        nodes: nodesRef,
        links: linksRef,
        forces: forcesRef,
        alpha: alphaRef,
        prevAlpha: prevAlphaRef,
        config,
        running: runningRef,
        cancelAnimation: cancelRef,
        tickCallback: tickRef,
        callbacks: Nothing.value
      };
    };
  };
  var checkAlphaThresholds = function(prevAlpha) {
    return function(newAlpha) {
      return function(sim) {
        var crossedThreshold = function(prev) {
          return function($$new2) {
            return function(thresh) {
              return prev > thresh && $$new2 <= thresh;
            };
          };
        };
        var alphaThresholds = [0.5, 0.1, 0.01];
        if (sim.callbacks instanceof Nothing) {
          return pure13(unit);
        }
        ;
        if (sim.callbacks instanceof Just) {
          return for_1(alphaThresholds)(function(threshold) {
            return when4(crossedThreshold(prevAlpha)(newAlpha)(threshold))(function __do7() {
              var callback = read(sim.callbacks.value0.onAlphaThreshold)();
              return callback(newAlpha)();
            });
          });
        }
        ;
        throw new Error("Failed pattern match at PSD3.ForceEngine.Simulation (line 527, column 47 - line 534, column 26): " + [sim.callbacks.constructor.name]);
      };
    };
  };
  var tick = function(sim) {
    return function __do7() {
      var nodes3 = read(sim.nodes)();
      var forces = read(sim.forces)();
      var alpha = read(sim.alpha)();
      var prevAlpha = read(sim.prevAlpha)();
      var forceHandles = fromFoldable8(values(forces));
      applyForces(forceHandles)(alpha)();
      integratePositions(nodes3)(sim.config.velocityDecay)();
      var newAlpha = decayAlpha(alpha)(sim.config.alphaMin)(sim.config.alphaDecay)(sim.config.alphaTarget);
      write(newAlpha)(sim.alpha)();
      write(alpha)(sim.prevAlpha)();
      var legacyCallback = read(sim.tickCallback)();
      legacyCallback();
      invokeTickCallback(sim)();
      checkAlphaThresholds(prevAlpha)(newAlpha)(sim)();
      return newAlpha;
    };
  };
  var start3 = function(sim) {
    return function __do7() {
      var alreadyRunning = read(sim.running)();
      return unless2(alreadyRunning)(function __do8() {
        write(true)(sim.running)();
        invokeStartCallback(sim)();
        var cancel = startAnimation(function(v2) {
          return function __do9() {
            var running = read(sim.running)();
            if (running) {
              var newAlpha = tick(sim)();
              var shouldContinue = newAlpha > 0;
              unless2(shouldContinue)(function __do10() {
                write(false)(sim.running)();
                return invokeStopCallback(sim)();
              })();
              return shouldContinue;
            }
            ;
            return false;
          };
        })();
        return write(cancel)(sim.cancelAnimation)();
      })();
    };
  };
  var reheat = function(sim) {
    return function __do7() {
      write(1)(sim.alpha)();
      var running = read(sim.running)();
      return unless2(running)(start3(sim))();
    };
  };
  var updateGridXYAndReinit = function(mXFn) {
    return function(mYFn) {
      return function(forceXHandle) {
        return function(mForceYHandle) {
          return function(sim) {
            return function __do7() {
              for_22(mXFn)(function(xFn) {
                return updateGridXWithFn_(xFn)(sim.nodes);
              })();
              for_22(mYFn)(function(yFn) {
                return updateGridYWithFn_(yFn)(sim.nodes);
              })();
              var currentNodes = read(sim.nodes)();
              initializeForce(forceXHandle)(currentNodes)();
              for_22(mForceYHandle)(function(forceYHandle) {
                return $$void8(initializeForce(forceYHandle)(currentNodes));
              })();
              return reheat(sim)();
            };
          };
        };
      };
    };
  };
  var addForce = function(spec) {
    return function(sim) {
      var forceName = function(v2) {
        if (v2 instanceof ManyBody) {
          return v2.value0;
        }
        ;
        if (v2 instanceof Collide) {
          return v2.value0;
        }
        ;
        if (v2 instanceof Link) {
          return v2.value0;
        }
        ;
        if (v2 instanceof Center) {
          return v2.value0;
        }
        ;
        if (v2 instanceof PositionX) {
          return v2.value0;
        }
        ;
        if (v2 instanceof PositionY) {
          return v2.value0;
        }
        ;
        if (v2 instanceof Radial) {
          return v2.value0;
        }
        ;
        throw new Error("Failed pattern match at PSD3.ForceEngine.Simulation (line 335, column 15 - line 342, column 20): " + [v2.constructor.name]);
      };
      return function __do7() {
        var nodes3 = read(sim.nodes)();
        var links3 = read(sim.links)();
        var handle = (function() {
          if (spec instanceof ManyBody) {
            var h7 = createManyBody(spec.value1);
            return initializeForce(h7)(nodes3)();
          }
          ;
          if (spec instanceof Collide) {
            var h7 = createCollide(spec.value1);
            return initializeForce(h7)(nodes3)();
          }
          ;
          if (spec instanceof Link) {
            var h7 = createLink(spec.value1);
            return initializeLinkForce(h7)(nodes3)(links3)();
          }
          ;
          if (spec instanceof Center) {
            var h7 = createCenter(spec.value1);
            return initializeForce(h7)(nodes3)();
          }
          ;
          if (spec instanceof PositionX) {
            var h7 = createForceX(spec.value1);
            return initializeForce(h7)(nodes3)();
          }
          ;
          if (spec instanceof PositionY) {
            var h7 = createForceY(spec.value1);
            return initializeForce(h7)(nodes3)();
          }
          ;
          if (spec instanceof Radial) {
            var h7 = createRadial(spec.value1);
            return initializeForce(h7)(nodes3)();
          }
          ;
          throw new Error("Failed pattern match at PSD3.ForceEngine.Simulation (line 302, column 13 - line 329, column 35): " + [spec.constructor.name]);
        })();
        var name16 = forceName(spec);
        return modify_2(insert6(name16)(handle))(sim.forces)();
      };
    };
  };

  // output/D3.Viz.SimpleForceGraph/index.js
  var bind11 = /* @__PURE__ */ bind(bindD3v2M);
  var liftEffect4 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var select9 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var from4 = /* @__PURE__ */ from3(showNumber);
  var stroke2 = /* @__PURE__ */ stroke(toAttributeValueString);
  var text7 = /* @__PURE__ */ text6(stringExprEvalD);
  var strokeWidth2 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var num2 = /* @__PURE__ */ num(numExprEvalD);
  var renderTree3 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D);
  var ordRecord2 = /* @__PURE__ */ ordRecord();
  var ordRecordCons2 = /* @__PURE__ */ ordRecordCons(ordRecordNil)();
  var ordNullable2 = /* @__PURE__ */ ordNullable(ordNumber);
  var ordRecord1 = /* @__PURE__ */ ordRecord2(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons2({
    reflectSymbol: function() {
      return "y";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "x";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "vy";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "vx";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "name";
    }
  })(ordString))()({
    reflectSymbol: function() {
      return "id";
    }
  })(ordInt))()({
    reflectSymbol: function() {
      return "fy";
    }
  })(ordNullable2))()({
    reflectSymbol: function() {
      return "fx";
    }
  })(ordNullable2));
  var renderTree1 = /* @__PURE__ */ renderTree3(/* @__PURE__ */ ordRecord2(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons2({
    reflectSymbol: function() {
      return "target";
    }
  })(ordRecord1))()({
    reflectSymbol: function() {
      return "source";
    }
  })(ordRecord1))()({
    reflectSymbol: function() {
      return "index";
    }
  })(ordInt)));
  var r2 = /* @__PURE__ */ r(toAttributeValueNumber);
  var fill2 = /* @__PURE__ */ fill(toAttributeValueString);
  var renderTree22 = /* @__PURE__ */ renderTree3(ordRecord1);
  var pure14 = /* @__PURE__ */ pure(applicativeD3v2M);
  var width9 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var height9 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr4 = /* @__PURE__ */ attr3(toAttributeValueString);
  var renderTree32 = /* @__PURE__ */ renderTree3(ordUnit);
  var simulationId = "simple-force";
  var tick2 = function(stateRef) {
    return function(_selector) {
      return runD3v2M(bind11(liftEffect4(read(stateRef)))(function(state3) {
        return bind11(select9("#simple-force-links"))(function(linksGroup) {
          return bind11(select9("#simple-force-nodes"))(function(nodesGroup) {
            var linksTree = joinData("links")("line")(state3.swizzled)(function(v2) {
              return elem3(Line.value)([from4("x1")(function(v1) {
                return v1.source.x;
              }), from4("y1")(function(v1) {
                return v1.source.y;
              }), from4("x2")(function(v1) {
                return v1.target.x;
              }), from4("y2")(function(v1) {
                return v1.target.y;
              }), stroke2(text7("#999")), strokeWidth2(num2(2))]);
            });
            return bind11(renderTree1(linksGroup)(linksTree))(function() {
              var nodesTree = joinData("nodes")("circle")(state3.nodes)(function(v2) {
                return withBehaviors(elem3(Circle.value)([from4("cx")(function(v1) {
                  return v1.x;
                }), from4("cy")(function(v1) {
                  return v1.y;
                }), r2(num2(10)), fill2(text7("#69b3a2")), stroke2(text7("#fff")), strokeWidth2(num2(2))]))([new Drag(new SimulationDrag(simulationId))]);
              });
              return bind11(renderTree22(nodesGroup)(nodesTree))(function() {
                return pure14(unit);
              });
            });
          });
        });
      }));
    };
  };
  var nodes = [{
    id: 0,
    name: "A",
    x: 0,
    y: 0,
    vx: 0,
    vy: 0,
    fx: nullImpl,
    fy: nullImpl
  }, {
    id: 1,
    name: "B",
    x: 0,
    y: 0,
    vx: 0,
    vy: 0,
    fx: nullImpl,
    fy: nullImpl
  }, {
    id: 2,
    name: "C",
    x: 0,
    y: 0,
    vx: 0,
    vy: 0,
    fx: nullImpl,
    fy: nullImpl
  }, {
    id: 3,
    name: "D",
    x: 0,
    y: 0,
    vx: 0,
    vy: 0,
    fx: nullImpl,
    fy: nullImpl
  }, {
    id: 4,
    name: "E",
    x: 0,
    y: 0,
    vx: 0,
    vy: 0,
    fx: nullImpl,
    fy: nullImpl
  }];
  var links = [{
    source: 0,
    target: 1
  }, {
    source: 0,
    target: 2
  }, {
    source: 1,
    target: 2
  }, {
    source: 2,
    target: 3
  }, {
    source: 3,
    target: 4
  }, {
    source: 4,
    target: 0
  }];
  var simpleForceGraph = function(selector) {
    var swizzled = swizzleLinks(nodes)(links)(function(src10) {
      return function(tgt) {
        return function(i2) {
          return function(v2) {
            return {
              source: src10,
              target: tgt,
              index: i2
            };
          };
        };
      };
    });
    return function __do7() {
      var sim = create5(defaultConfig2)();
      setNodes(nodes)(sim)();
      setLinks(links)(sim)();
      addForce(new ManyBody("charge", {
        theta: defaultManyBody.theta,
        distanceMin: defaultManyBody.distanceMin,
        distanceMax: defaultManyBody.distanceMax,
        strength: -200
      }))(sim)();
      addForce(new Collide("collide", {
        strength: defaultCollide.strength,
        iterations: defaultCollide.iterations,
        radius: 20
      }))(sim)();
      addForce(new Center("center", defaultCenter))(sim)();
      addForce(new Link("links", {
        strength: defaultLink.strength,
        iterations: defaultLink.iterations,
        distance: 50
      }))(sim)();
      registerSimulation_(simulationId)(reheat(sim))();
      var stateRef = $$new({
        nodes,
        swizzled
      })();
      runD3v2M(bind11(select9(selector))(function(container) {
        var containerTree = withChildren(withBehaviors(named(SVG.value)("svg")([width9(num2(400)), height9(num2(300)), viewBox(-200)(-150)(400)(300), attr4("id")(text7("simple-force-svg"))]))([new Zoom(defaultZoom(new ScaleExtent(0.5, 4))("#simple-force-zoom-group"))]))([withChildren(named(Group.value)("zoom-group")([attr4("id")(text7("simple-force-zoom-group"))]))([named(Group.value)("links-group")([attr4("id")(text7("simple-force-links"))]), named(Group.value)("nodes-group")([attr4("id")(text7("simple-force-nodes"))])])]);
        return bind11(renderTree32(container)(containerTree))(function() {
          return pure14(unit);
        });
      }))();
      onTick(tick2(stateRef)(selector))(sim)();
      start3(sim)();
      return function __do8() {
        stop(sim)();
        return unregisterSimulation_(simulationId)();
      };
    };
  };

  // output/Data.Number.Format/foreign.js
  function wrap3(method2) {
    return function(d) {
      return function(num41) {
        return method2.apply(num41, [d]);
      };
    };
  }
  var toPrecisionNative = wrap3(Number.prototype.toPrecision);
  var toFixedNative = wrap3(Number.prototype.toFixed);
  var toExponentialNative = wrap3(Number.prototype.toExponential);
  function toString(num41) {
    return num41.toString();
  }

  // output/Data.Number.Format/index.js
  var clamp3 = /* @__PURE__ */ clamp(ordInt);
  var Precision = /* @__PURE__ */ (function() {
    function Precision2(value0) {
      this.value0 = value0;
    }
    ;
    Precision2.create = function(value0) {
      return new Precision2(value0);
    };
    return Precision2;
  })();
  var Fixed = /* @__PURE__ */ (function() {
    function Fixed2(value0) {
      this.value0 = value0;
    }
    ;
    Fixed2.create = function(value0) {
      return new Fixed2(value0);
    };
    return Fixed2;
  })();
  var Exponential = /* @__PURE__ */ (function() {
    function Exponential3(value0) {
      this.value0 = value0;
    }
    ;
    Exponential3.create = function(value0) {
      return new Exponential3(value0);
    };
    return Exponential3;
  })();
  var toStringWith = function(v2) {
    if (v2 instanceof Precision) {
      return toPrecisionNative(v2.value0);
    }
    ;
    if (v2 instanceof Fixed) {
      return toFixedNative(v2.value0);
    }
    ;
    if (v2 instanceof Exponential) {
      return toExponentialNative(v2.value0);
    }
    ;
    throw new Error("Failed pattern match at Data.Number.Format (line 59, column 1 - line 59, column 43): " + [v2.constructor.name]);
  };
  var fixed = /* @__PURE__ */ (function() {
    var $9 = clamp3(0)(20);
    return function($10) {
      return Fixed.create($9($10));
    };
  })();

  // output/PSD3.Axis.Axis/index.js
  var map33 = /* @__PURE__ */ map(functorArray);
  var show10 = /* @__PURE__ */ show(showNumber);
  var str2 = /* @__PURE__ */ str(stringExprEvalD);
  var v3Attr2 = /* @__PURE__ */ v3Attr(showNumber);
  var lit2 = /* @__PURE__ */ lit(numExprEvalD);
  var append14 = /* @__PURE__ */ append(semigroupArray);
  var Top = /* @__PURE__ */ (function() {
    function Top2() {
    }
    ;
    Top2.value = new Top2();
    return Top2;
  })();
  var Right2 = /* @__PURE__ */ (function() {
    function Right4() {
    }
    ;
    Right4.value = new Right4();
    return Right4;
  })();
  var Bottom = /* @__PURE__ */ (function() {
    function Bottom2() {
    }
    ;
    Bottom2.value = new Bottom2();
    return Bottom2;
  })();
  var Left2 = /* @__PURE__ */ (function() {
    function Left4() {
    }
    ;
    Left4.value = new Left4();
    return Left4;
  })();
  var generateTicks = function(scale) {
    return function(count) {
      var step5 = (scale.domain.max - scale.domain.min) / toNumber(count);
      return map33(function(i2) {
        return scale.domain.min + toNumber(i2) * step5;
      })(range2(0)(count));
    };
  };
  var defaultTickFormat = function(n) {
    var $18 = n === 0;
    if ($18) {
      return "0";
    }
    ;
    return toStringWith(fixed(1))(n);
  };
  var defaultAxisConfig = /* @__PURE__ */ (function() {
    return {
      tickSize: 6,
      tickPadding: 3,
      tickCount: 10,
      tickFormat: Nothing.value
    };
  })();
  var axisLeft = function(scale) {
    return {
      orientation: Left2.value,
      scale,
      config: defaultAxisConfig
    };
  };
  var axisBottom = function(scale) {
    return {
      orientation: Bottom.value,
      scale,
      config: defaultAxisConfig
    };
  };
  var applyScale = function(scale) {
    return function(value20) {
      var rangeSpan = scale.range.max - scale.range.min;
      var domainSpan = scale.domain.max - scale.domain.min;
      var normalized = (value20 - scale.domain.min) / domainSpan;
      return scale.range.min + normalized * rangeSpan;
    };
  };
  var renderAxis = function(ax) {
    var ticks3 = generateTicks(ax.scale)(ax.config.tickCount);
    var formatter = fromMaybe(defaultTickFormat)(ax.config.tickFormat);
    var v2 = (function() {
      if (ax.orientation instanceof Bottom) {
        return {
          domainPath: "M" + (show10(ax.scale.range.min) + (",0H" + show10(ax.scale.range.max))),
          tickTransform: function(pos) {
            return "translate(" + (show10(pos) + ",0)");
          },
          tickLine: {
            x1: 0,
            y1: 0,
            x2: 0,
            y2: ax.config.tickSize
          },
          tickText: {
            x: 0,
            y: ax.config.tickSize + ax.config.tickPadding,
            anchor: "middle",
            dyVal: 7
          }
        };
      }
      ;
      if (ax.orientation instanceof Left2) {
        return {
          domainPath: "M0," + (show10(ax.scale.range.min) + ("V" + show10(ax.scale.range.max))),
          tickTransform: function(pos) {
            return "translate(0," + (show10(pos) + ")");
          },
          tickLine: {
            x1: -ax.config.tickSize,
            y1: 0,
            x2: 0,
            y2: 0
          },
          tickText: {
            x: -(ax.config.tickSize + ax.config.tickPadding),
            y: 0,
            anchor: "end",
            dyVal: 3
          }
        };
      }
      ;
      if (ax.orientation instanceof Top) {
        return {
          domainPath: "M" + (show10(ax.scale.range.min) + (",0H" + show10(ax.scale.range.max))),
          tickTransform: function(pos) {
            return "translate(" + (show10(pos) + ",0)");
          },
          tickLine: {
            x1: 0,
            y1: -ax.config.tickSize,
            x2: 0,
            y2: 0
          },
          tickText: {
            x: 0,
            y: -(ax.config.tickSize + ax.config.tickPadding),
            anchor: "middle",
            dyVal: 0
          }
        };
      }
      ;
      if (ax.orientation instanceof Right2) {
        return {
          domainPath: "M0," + (show10(ax.scale.range.min) + ("V" + show10(ax.scale.range.max))),
          tickTransform: function(pos) {
            return "translate(0," + (show10(pos) + ")");
          },
          tickLine: {
            x1: 0,
            y1: 0,
            x2: ax.config.tickSize,
            y2: 0
          },
          tickText: {
            x: ax.config.tickSize + ax.config.tickPadding,
            y: 0,
            anchor: "start",
            dyVal: 3
          }
        };
      }
      ;
      throw new Error("Failed pattern match at PSD3.Axis.Axis (line 120, column 57 - line 144, column 10): " + [ax.orientation.constructor.name]);
    })();
    var tickElements = map33(function(tickValue) {
      var pos = applyScale(ax.scale)(tickValue);
      return withChildren(elem3(Group.value)([v3AttrStr("class")(str2("tick")), v3AttrStr("transform")(str2(v2.tickTransform(pos)))]))([elem3(Line.value)([v3Attr2("x1")(lit2(v2.tickLine.x1)), v3Attr2("y1")(lit2(v2.tickLine.y1)), v3Attr2("x2")(lit2(v2.tickLine.x2)), v3Attr2("y2")(lit2(v2.tickLine.y2)), v3AttrStr("stroke")(str2("currentColor"))]), elem3(Text.value)([v3Attr2("x")(lit2(v2.tickText.x)), v3Attr2("y")(lit2(v2.tickText.y)), v3AttrStr("text-anchor")(str2(v2.tickText.anchor)), v3Attr2("dy")(lit2(v2.tickText.dyVal)), v3AttrStr("fill")(str2("currentColor")), v3Attr2("font-size")(lit2(10)), v3AttrStr("textContent")(str2(formatter(tickValue)))])]);
    })(ticks3);
    return withChildren(elem3(Group.value)([v3AttrStr("class")(str2("axis")), v3AttrStr("fill")(str2("none")), v3Attr2("font-size")(lit2(10)), v3AttrStr("stroke")(str2("currentColor"))]))(append14([elem3(Path.value)([v3AttrStr("class")(str2("domain")), v3AttrStr("stroke")(str2("currentColor")), v3AttrStr("d")(str2(v2.domainPath))])])(tickElements));
  };

  // output/D3.Viz.TreeAPI.AnscombesQuartet/index.js
  var show11 = /* @__PURE__ */ show(showNumber);
  var map34 = /* @__PURE__ */ map(functorArray);
  var sum2 = /* @__PURE__ */ sum(foldableArray)(semiringNumber);
  var bind13 = /* @__PURE__ */ bind(bindD3v2M);
  var select10 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var mod4 = /* @__PURE__ */ mod(euclideanRingInt);
  var show14 = /* @__PURE__ */ show(showInt);
  var str3 = /* @__PURE__ */ str(stringExprEvalD);
  var v3Attr3 = /* @__PURE__ */ v3Attr(showNumber);
  var lit3 = /* @__PURE__ */ lit(numExprEvalD);
  var renderTree4 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(/* @__PURE__ */ ordRecord()(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(ordRecordNil)()({
    reflectSymbol: function() {
      return "y";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "x";
    }
  })(ordNumber)));
  var liftEffect5 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var dataset4 = [{
    x: 8,
    y: 6.58
  }, {
    x: 8,
    y: 5.76
  }, {
    x: 8,
    y: 7.71
  }, {
    x: 8,
    y: 8.84
  }, {
    x: 8,
    y: 8.47
  }, {
    x: 8,
    y: 7.04
  }, {
    x: 8,
    y: 5.25
  }, {
    x: 19,
    y: 12.5
  }, {
    x: 8,
    y: 5.56
  }, {
    x: 8,
    y: 7.91
  }, {
    x: 8,
    y: 6.89
  }];
  var dataset3 = [{
    x: 10,
    y: 7.46
  }, {
    x: 8,
    y: 6.77
  }, {
    x: 13,
    y: 12.74
  }, {
    x: 9,
    y: 7.11
  }, {
    x: 11,
    y: 7.81
  }, {
    x: 14,
    y: 8.84
  }, {
    x: 6,
    y: 6.08
  }, {
    x: 4,
    y: 5.39
  }, {
    x: 12,
    y: 8.15
  }, {
    x: 7,
    y: 6.42
  }, {
    x: 5,
    y: 5.73
  }];
  var dataset2 = [{
    x: 10,
    y: 9.14
  }, {
    x: 8,
    y: 8.14
  }, {
    x: 13,
    y: 8.74
  }, {
    x: 9,
    y: 8.77
  }, {
    x: 11,
    y: 9.26
  }, {
    x: 14,
    y: 8.1
  }, {
    x: 6,
    y: 6.13
  }, {
    x: 4,
    y: 3.1
  }, {
    x: 12,
    y: 9.13
  }, {
    x: 7,
    y: 7.26
  }, {
    x: 5,
    y: 4.74
  }];
  var dataset1 = [{
    x: 10,
    y: 8.04
  }, {
    x: 8,
    y: 6.95
  }, {
    x: 13,
    y: 7.58
  }, {
    x: 9,
    y: 8.81
  }, {
    x: 11,
    y: 8.33
  }, {
    x: 14,
    y: 9.96
  }, {
    x: 6,
    y: 7.24
  }, {
    x: 4,
    y: 4.26
  }, {
    x: 12,
    y: 10.84
  }, {
    x: 7,
    y: 4.82
  }, {
    x: 5,
    y: 5.68
  }];
  var calculateStats = function(points) {
    var ys = map34(function(v2) {
      return v2.y;
    })(points);
    var xs = map34(function(v2) {
      return v2.x;
    })(points);
    var n = toNumber(length3(points));
    var meanY = sum2(ys) / n;
    var varianceY = sum2(map34(function(y32) {
      return pow(y32 - meanY)(2);
    })(ys)) / (n - 1);
    var meanX = sum2(xs) / n;
    var varianceX = sum2(map34(function(x32) {
      return pow(x32 - meanX)(2);
    })(xs)) / (n - 1);
    var covariance = sum2(map34(function(p2) {
      return (p2.x - meanX) * (p2.y - meanY);
    })(points)) / (n - 1);
    var correlation = covariance / (sqrt(varianceX) * sqrt(varianceY));
    return {
      meanX,
      meanY,
      varianceX,
      varianceY,
      correlation
    };
  };
  var allDatasets = [{
    name: "A",
    data: dataset1,
    stats: /* @__PURE__ */ calculateStats(dataset1)
  }, {
    name: "B",
    data: dataset2,
    stats: /* @__PURE__ */ calculateStats(dataset2)
  }, {
    name: "C",
    data: dataset3,
    stats: /* @__PURE__ */ calculateStats(dataset3)
  }, {
    name: "D",
    data: dataset4,
    stats: /* @__PURE__ */ calculateStats(dataset4)
  }];
  var anscombesQuartet = function(selector) {
    return runD3v2M(bind13(select10(selector))(function(container) {
      var margin = {
        top: 20,
        right: 20,
        bottom: 40,
        left: 50
      };
      var plotHeight = 140 - margin.top - margin.bottom;
      var yScale = {
        domain: {
          min: 0,
          max: 14
        },
        range: {
          min: plotHeight,
          max: 0
        }
      };
      var scaleY5 = function(value20) {
        var rangeSpan = yScale.range.max - yScale.range.min;
        var domainSpan = yScale.domain.max - yScale.domain.min;
        var normalized = (value20 - yScale.domain.min) / domainSpan;
        return yScale.range.min + normalized * rangeSpan;
      };
      var plotWidth = 140 - margin.left - margin.right;
      var xScale = {
        domain: {
          min: 0,
          max: 20
        },
        range: {
          min: 0,
          max: plotWidth
        }
      };
      var scaleX5 = function(value20) {
        var rangeSpan = xScale.range.max - xScale.range.min;
        var domainSpan = xScale.domain.max - xScale.domain.min;
        var normalized = (value20 - xScale.domain.min) / domainSpan;
        return xScale.range.min + normalized * rangeSpan;
      };
      var getPlotX = function(idx) {
        var $37 = mod4(idx)(2) === 0;
        if ($37) {
          return 0;
        }
        ;
        return 140 + 20;
      };
      var getPlotY = function(idx) {
        var $38 = idx < 2;
        if ($38) {
          return 0;
        }
        ;
        return 140 + 20;
      };
      var buildPlot = function(idx) {
        return function(dataset) {
          return withChildren(named(Group.value)("plot-" + show14(idx))([v3AttrStr("transform")(str3("translate(" + (show11(getPlotX(idx)) + ("," + (show11(getPlotY(idx)) + ")"))))), v3AttrStr("class")(str3("anscombe-plot"))]))([elem3(Text.value)([v3Attr3("x")(lit3(140 / 2)), v3Attr3("y")(lit3(10)), v3AttrStr("text-anchor")(str3("middle")), v3AttrStr("class")(str3("plot-title")), v3AttrStr("textContent")(str3(dataset.name))]), withChildren(named(Group.value)("plot-area")([v3AttrStr("transform")(str3("translate(" + (show11(margin.left) + ("," + (show11(margin.top) + ")")))))]))([withChild(named(Group.value)("x-axis")([v3AttrStr("transform")(str3("translate(0," + (show11(plotHeight) + ")")))]))(renderAxis(axisBottom(xScale))), withChild(named(Group.value)("y-axis")([]))(renderAxis(axisLeft(yScale))), joinData("points-" + show14(idx))("circle")(dataset.data)(function(d) {
            return elem3(Circle.value)([v3Attr3("cx")(lit3(scaleX5(d.x))), v3Attr3("cy")(lit3(scaleY5(d.y))), v3Attr3("r")(lit3(3)), v3AttrStr("fill")(str3("steelblue"))]);
          })])]);
        };
      };
      var svgWidth4 = 140 * 2 + 20;
      var svgHeight4 = 140 * 2 + 20;
      var emptyDataset = {
        name: "Empty",
        data: [],
        stats: {
          meanX: 0,
          meanY: 0,
          varianceX: 0,
          varianceY: 0,
          correlation: 0
        }
      };
      var getDataset = function(idx) {
        return fromMaybe(fromMaybe(emptyDataset)(index(allDatasets)(0)))(index(allDatasets)(idx));
      };
      var tree2 = withChildren(named(SVG.value)("svg")([v3Attr3("width")(lit3(svgWidth4)), v3Attr3("height")(lit3(svgHeight4)), v3AttrStr("viewBox")(str3("0 0 " + (show11(svgWidth4) + (" " + show11(svgHeight4))))), v3AttrStr("id")(str3("anscombes-quartet-svg")), v3AttrStr("class")(str3("tree-api-example"))]))([buildPlot(0)(getDataset(0)), buildPlot(1)(getDataset(1)), buildPlot(2)(getDataset(2)), buildPlot(3)(getDataset(3))]);
      return bind13(renderTree4(container)(tree2))(function() {
        return liftEffect5(function __do7() {
          log2("=== Anscombe's Quartet ===")();
          log2("")();
          log2("Four datasets with IDENTICAL statistics:")();
          log2("  - Mean X \u2248 9.0")();
          log2("  - Mean Y \u2248 7.5")();
          log2("  - Variance X \u2248 11.0")();
          log2("  - Variance Y \u2248 4.1")();
          log2("  - Correlation \u2248 0.816")();
          log2("")();
          log2("But look at the plots - completely different distributions!")();
          log2("  I: Linear relationship")();
          log2("  II: Curved relationship")();
          log2("  III: Linear with outlier")();
          log2("  IV: Vertical line with outlier")();
          log2("")();
          log2("THIS IS WHY VISUALIZATION MATTERS.")();
          log2("Summary statistics alone don't tell the story.")();
          return log2("")();
        });
      });
    }));
  };

  // output/D3.Viz.TreeAPI.BarChartExample/index.js
  var bind14 = /* @__PURE__ */ bind(bindD3v2M);
  var map35 = /* @__PURE__ */ map(functorArray);
  var maximum4 = /* @__PURE__ */ maximum(ordNumber)(foldableArray);
  var width10 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var num3 = /* @__PURE__ */ num(numExprEvalD);
  var height10 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr5 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text8 = /* @__PURE__ */ text6(stringExprEvalD);
  var transform3 = /* @__PURE__ */ transform2(toAttributeValueString);
  var show15 = /* @__PURE__ */ show(showNumber);
  var renderTree5 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D);
  var renderTree12 = /* @__PURE__ */ renderTree5(ordUnit);
  var liftEffect6 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var x5 = /* @__PURE__ */ x(toAttributeValueNumber);
  var y5 = /* @__PURE__ */ y(toAttributeValueNumber);
  var fill3 = /* @__PURE__ */ fill(toAttributeValueString);
  var stroke3 = /* @__PURE__ */ stroke(toAttributeValueString);
  var strokeWidth3 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var renderTree23 = /* @__PURE__ */ renderTree5(/* @__PURE__ */ ordRecord()(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(ordRecordNil)()({
    reflectSymbol: function() {
      return "y";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "x";
    }
  })(ordNumber)));
  var show16 = /* @__PURE__ */ show(showInt);
  var lookup6 = /* @__PURE__ */ lookup(ordString);
  var sampleData = [{
    x: 1,
    y: 30
  }, {
    x: 2,
    y: 80
  }, {
    x: 3,
    y: 45
  }, {
    x: 4,
    y: 60
  }, {
    x: 5,
    y: 20
  }, {
    x: 6,
    y: 90
  }, {
    x: 7,
    y: 55
  }];
  var innerWidth2 = function(dims) {
    return dims.width - dims.marginLeft - dims.marginRight;
  };
  var innerHeight2 = function(dims) {
    return dims.height - dims.marginTop - dims.marginBottom;
  };
  var defaultDims = {
    width: 600,
    height: 400,
    marginTop: 20,
    marginRight: 20,
    marginBottom: 40,
    marginLeft: 50
  };
  var barChart = /* @__PURE__ */ runD3v2M(/* @__PURE__ */ bind14(/* @__PURE__ */ select(selectionMD3v2Selection_D)("#viz"))(function(container) {
    var iWidth = innerWidth2(defaultDims);
    var iHeight = innerHeight2(defaultDims);
    var yValues = map35(function(v2) {
      return v2.y;
    })(sampleData);
    var maxY = fromMaybe(100)(maximum4(yValues));
    var numBars = length3(sampleData);
    var barWidth = (function() {
      var $49 = numBars > 0;
      if ($49) {
        return iWidth / toNumber(numBars) * 0.8;
      }
      ;
      return 0;
    })();
    var xScale = {
      domain: {
        min: 1,
        max: toNumber(numBars)
      },
      range: {
        min: 0,
        max: iWidth
      }
    };
    var yScale = {
      domain: {
        min: 0,
        max: maxY
      },
      range: {
        min: iHeight,
        max: 0
      }
    };
    var xAxis = axisBottom(xScale);
    var yAxis = axisLeft(yScale);
    var axesTree = withChild(named(SVG.value)("svg")([width10(num3(defaultDims.width)), height10(num3(defaultDims.height)), viewBox(0)(0)(defaultDims.width)(defaultDims.height), attr5("class")(text8("bar-chart-tree"))]))(withChildren(named(Group.value)("chartGroup")([attr5("class")(text8("chart-content")), transform3(text8("translate(" + (show15(defaultDims.marginLeft) + ("," + (show15(defaultDims.marginTop) + ")")))))]))([withChild(named(Group.value)("xAxis")([transform3(text8("translate(0," + (show15(iHeight) + ")"))), attr5("class")(text8("x-axis"))]))(renderAxis(xAxis)), withChild(named(Group.value)("yAxis")([attr5("class")(text8("y-axis"))]))(renderAxis(yAxis))]));
    return bind14(renderTree12(container)(axesTree))(function(axesSelections) {
      return bind14(liftEffect6(reselectD3v2("chartGroup")(axesSelections)))(function(chartGroupSel) {
        var barsTree = joinData("bars")("rect")(sampleData)(function(point3) {
          var yPos = iHeight - (point3.y - 0) / (maxY - 0) * iHeight;
          var xPos = (point3.x - 1) * (iWidth / toNumber(numBars)) + (iWidth / toNumber(numBars) - barWidth) / 2;
          var barHeight = iHeight - yPos;
          return elem3(Rect.value)([x5(num3(xPos)), y5(num3(yPos)), width10(num3(barWidth)), height10(num3(barHeight)), fill3(text8("#4a90e2")), stroke3(text8("#357abd")), strokeWidth3(num3(1)), attr5("class")(text8("bar"))]);
        });
        return bind14(renderTree23(chartGroupSel)(barsTree))(function(barsSelections) {
          return liftEffect6(function __do7() {
            log2("=== Bar Chart (Tree API) ===")();
            log2("")();
            log2("Rendered " + (show16(length3(sampleData)) + " bars with axes"))();
            (function() {
              var v2 = lookup6("svg")(axesSelections);
              if (v2 instanceof Just) {
                return log2("\u2713 SVG created")();
              }
              ;
              if (v2 instanceof Nothing) {
                return log2("\u2717 Missing SVG")();
              }
              ;
              throw new Error("Failed pattern match at D3.Viz.TreeAPI.BarChartExample (line 170, column 5 - line 172, column 45): " + [v2.constructor.name]);
            })();
            (function() {
              var v2 = lookup6("chartGroup")(axesSelections);
              if (v2 instanceof Just) {
                return log2("\u2713 Chart group created")();
              }
              ;
              if (v2 instanceof Nothing) {
                return log2("\u2717 Missing chart group")();
              }
              ;
              throw new Error("Failed pattern match at D3.Viz.TreeAPI.BarChartExample (line 174, column 5 - line 176, column 53): " + [v2.constructor.name]);
            })();
            (function() {
              var v2 = lookup6("xAxis")(axesSelections);
              if (v2 instanceof Just) {
                return log2("\u2713 X axis created")();
              }
              ;
              if (v2 instanceof Nothing) {
                return log2("\u2717 Missing X axis")();
              }
              ;
              throw new Error("Failed pattern match at D3.Viz.TreeAPI.BarChartExample (line 178, column 5 - line 180, column 48): " + [v2.constructor.name]);
            })();
            (function() {
              var v2 = lookup6("yAxis")(axesSelections);
              if (v2 instanceof Just) {
                return log2("\u2713 Y axis created")();
              }
              ;
              if (v2 instanceof Nothing) {
                return log2("\u2717 Missing Y axis")();
              }
              ;
              throw new Error("Failed pattern match at D3.Viz.TreeAPI.BarChartExample (line 182, column 5 - line 184, column 48): " + [v2.constructor.name]);
            })();
            (function() {
              var v2 = lookup6("bars")(barsSelections);
              if (v2 instanceof Just) {
                return log2("\u2713 Bars collection created")();
              }
              ;
              if (v2 instanceof Nothing) {
                return log2("\u2717 Missing bars collection")();
              }
              ;
              throw new Error("Failed pattern match at D3.Viz.TreeAPI.BarChartExample (line 186, column 5 - line 188, column 57): " + [v2.constructor.name]);
            })();
            log2("")();
            return log2("Expected: 7 blue bars of varying heights with X and Y axes")();
          });
        });
      });
    });
  }));

  // output/PSD3.Expr.Sugar/index.js
  var subOp = function(dictNumExpr) {
    return sub2(dictNumExpr);
  };
  var subLit = function(dictNumExpr) {
    var sub4 = sub2(dictNumExpr);
    var lit22 = lit(dictNumExpr);
    return function(a3) {
      return function(b10) {
        return sub4(a3)(lit22(b10));
      };
    };
  };
  var s = function(dictStringExpr) {
    return str(dictStringExpr);
  };
  var mulLit = function(dictNumExpr) {
    var mul4 = mul2(dictNumExpr);
    var lit22 = lit(dictNumExpr);
    return function(a3) {
      return function(b10) {
        return mul4(a3)(lit22(b10));
      };
    };
  };
  var ltOp = function(dictCompareExpr) {
    return lt(dictCompareExpr);
  };
  var gtOp = function(dictCompareExpr) {
    return gt(dictCompareExpr);
  };
  var divLit = function(dictNumExpr) {
    var div8 = div4(dictNumExpr);
    var lit22 = lit(dictNumExpr);
    return function(a3) {
      return function(b10) {
        return div8(a3)(lit22(b10));
      };
    };
  };
  var addOp = function(dictNumExpr) {
    return add4(dictNumExpr);
  };
  var addLit = function(dictNumExpr) {
    var add8 = add4(dictNumExpr);
    var lit22 = lit(dictNumExpr);
    return function(a3) {
      return function(b10) {
        return add8(a3)(lit22(b10));
      };
    };
  };

  // node_modules/d3-shape/src/constant.js
  function constant_default6(x32) {
    return function constant3() {
      return x32;
    };
  }

  // node_modules/d3-shape/src/math.js
  var abs3 = Math.abs;
  var atan23 = Math.atan2;
  var cos3 = Math.cos;
  var max8 = Math.max;
  var min7 = Math.min;
  var sin3 = Math.sin;
  var sqrt2 = Math.sqrt;
  var epsilon = 1e-12;
  var pi4 = Math.PI;
  var halfPi2 = pi4 / 2;
  var tau2 = 2 * pi4;
  function acos3(x32) {
    return x32 > 1 ? 0 : x32 < -1 ? pi4 : Math.acos(x32);
  }
  function asin3(x32) {
    return x32 >= 1 ? halfPi2 : x32 <= -1 ? -halfPi2 : Math.asin(x32);
  }

  // node_modules/d3-path/src/path.js
  var pi5 = Math.PI;
  var tau3 = 2 * pi5;
  var epsilon3 = 1e-6;
  var tauEpsilon = tau3 - epsilon3;
  function append10(strings) {
    this._ += strings[0];
    for (let i2 = 1, n = strings.length; i2 < n; ++i2) {
      this._ += arguments[i2] + strings[i2];
    }
  }
  function appendRound(digits) {
    let d = Math.floor(digits);
    if (!(d >= 0)) throw new Error(`invalid digits: ${digits}`);
    if (d > 15) return append10;
    const k = 10 ** d;
    return function(strings) {
      this._ += strings[0];
      for (let i2 = 1, n = strings.length; i2 < n; ++i2) {
        this._ += Math.round(arguments[i2] * k) / k + strings[i2];
      }
    };
  }
  var Path2 = class {
    constructor(digits) {
      this._x0 = this._y0 = // start of current subpath
      this._x1 = this._y1 = null;
      this._ = "";
      this._append = digits == null ? append10 : appendRound(digits);
    }
    moveTo(x32, y32) {
      this._append`M${this._x0 = this._x1 = +x32},${this._y0 = this._y1 = +y32}`;
    }
    closePath() {
      if (this._x1 !== null) {
        this._x1 = this._x0, this._y1 = this._y0;
        this._append`Z`;
      }
    }
    lineTo(x32, y32) {
      this._append`L${this._x1 = +x32},${this._y1 = +y32}`;
    }
    quadraticCurveTo(x113, y114, x32, y32) {
      this._append`Q${+x113},${+y114},${this._x1 = +x32},${this._y1 = +y32}`;
    }
    bezierCurveTo(x113, y114, x211, y211, x32, y32) {
      this._append`C${+x113},${+y114},${+x211},${+y211},${this._x1 = +x32},${this._y1 = +y32}`;
    }
    arcTo(x113, y114, x211, y211, r29) {
      x113 = +x113, y114 = +y114, x211 = +x211, y211 = +y211, r29 = +r29;
      if (r29 < 0) throw new Error(`negative radius: ${r29}`);
      let x0 = this._x1, y0 = this._y1, x212 = x211 - x113, y212 = y211 - y114, x01 = x0 - x113, y01 = y0 - y114, l01_2 = x01 * x01 + y01 * y01;
      if (this._x1 === null) {
        this._append`M${this._x1 = x113},${this._y1 = y114}`;
      } else if (!(l01_2 > epsilon3)) ;
      else if (!(Math.abs(y01 * x212 - y212 * x01) > epsilon3) || !r29) {
        this._append`L${this._x1 = x113},${this._y1 = y114}`;
      } else {
        let x202 = x211 - x0, y202 = y211 - y0, l21_2 = x212 * x212 + y212 * y212, l20_2 = x202 * x202 + y202 * y202, l21 = Math.sqrt(l21_2), l01 = Math.sqrt(l01_2), l2 = r29 * Math.tan((pi5 - Math.acos((l21_2 + l01_2 - l20_2) / (2 * l21 * l01))) / 2), t01 = l2 / l01, t21 = l2 / l21;
        if (Math.abs(t01 - 1) > epsilon3) {
          this._append`L${x113 + t01 * x01},${y114 + t01 * y01}`;
        }
        this._append`A${r29},${r29},0,0,${+(y01 * x202 > x01 * y202)},${this._x1 = x113 + t21 * x212},${this._y1 = y114 + t21 * y212}`;
      }
    }
    arc(x32, y32, r29, a0, a1, ccw) {
      x32 = +x32, y32 = +y32, r29 = +r29, ccw = !!ccw;
      if (r29 < 0) throw new Error(`negative radius: ${r29}`);
      let dx = r29 * Math.cos(a0), dy = r29 * Math.sin(a0), x0 = x32 + dx, y0 = y32 + dy, cw = 1 ^ ccw, da = ccw ? a0 - a1 : a1 - a0;
      if (this._x1 === null) {
        this._append`M${x0},${y0}`;
      } else if (Math.abs(this._x1 - x0) > epsilon3 || Math.abs(this._y1 - y0) > epsilon3) {
        this._append`L${x0},${y0}`;
      }
      if (!r29) return;
      if (da < 0) da = da % tau3 + tau3;
      if (da > tauEpsilon) {
        this._append`A${r29},${r29},0,1,${cw},${x32 - dx},${y32 - dy}A${r29},${r29},0,1,${cw},${this._x1 = x0},${this._y1 = y0}`;
      } else if (da > epsilon3) {
        this._append`A${r29},${r29},0,${+(da >= pi5)},${cw},${this._x1 = x32 + r29 * Math.cos(a1)},${this._y1 = y32 + r29 * Math.sin(a1)}`;
      }
    }
    rect(x32, y32, w, h7) {
      this._append`M${this._x0 = this._x1 = +x32},${this._y0 = this._y1 = +y32}h${w = +w}v${+h7}h${-w}Z`;
    }
    toString() {
      return this._;
    }
  };
  function path2() {
    return new Path2();
  }
  path2.prototype = Path2.prototype;

  // node_modules/d3-shape/src/path.js
  function withPath(shape2) {
    let digits = 3;
    shape2.digits = function(_) {
      if (!arguments.length) return digits;
      if (_ == null) {
        digits = null;
      } else {
        const d = Math.floor(_);
        if (!(d >= 0)) throw new RangeError(`invalid digits: ${_}`);
        digits = d;
      }
      return shape2;
    };
    return () => new Path2(digits);
  }

  // node_modules/d3-shape/src/arc.js
  function arcInnerRadius(d) {
    return d.innerRadius;
  }
  function arcOuterRadius(d) {
    return d.outerRadius;
  }
  function arcStartAngle(d) {
    return d.startAngle;
  }
  function arcEndAngle(d) {
    return d.endAngle;
  }
  function arcPadAngle(d) {
    return d && d.padAngle;
  }
  function intersect2(x0, y0, x113, y114, x211, y211, x32, y32) {
    var x102 = x113 - x0, y102 = y114 - y0, x322 = x32 - x211, y322 = y32 - y211, t2 = y322 * x102 - x322 * y102;
    if (t2 * t2 < epsilon) return;
    t2 = (x322 * (y0 - y211) - y322 * (x0 - x211)) / t2;
    return [x0 + t2 * x102, y0 + t2 * y102];
  }
  function cornerTangents(x0, y0, x113, y114, r1, rc, cw) {
    var x01 = x0 - x113, y01 = y0 - y114, lo = (cw ? rc : -rc) / sqrt2(x01 * x01 + y01 * y01), ox = lo * y01, oy = -lo * x01, x114 = x0 + ox, y115 = y0 + oy, x102 = x113 + ox, y102 = y114 + oy, x00 = (x114 + x102) / 2, y00 = (y115 + y102) / 2, dx = x102 - x114, dy = y102 - y115, d2 = dx * dx + dy * dy, r29 = r1 - rc, D = x114 * y102 - x102 * y115, d = (dy < 0 ? -1 : 1) * sqrt2(max8(0, r29 * r29 * d2 - D * D)), cx0 = (D * dy - dx * d) / d2, cy0 = (-D * dx - dy * d) / d2, cx1 = (D * dy + dx * d) / d2, cy1 = (-D * dx + dy * d) / d2, dx0 = cx0 - x00, dy0 = cy0 - y00, dx1 = cx1 - x00, dy1 = cy1 - y00;
    if (dx0 * dx0 + dy0 * dy0 > dx1 * dx1 + dy1 * dy1) cx0 = cx1, cy0 = cy1;
    return {
      cx: cx0,
      cy: cy0,
      x01: -ox,
      y01: -oy,
      x11: cx0 * (r1 / r29 - 1),
      y11: cy0 * (r1 / r29 - 1)
    };
  }
  function arc_default() {
    var innerRadius = arcInnerRadius, outerRadius = arcOuterRadius, cornerRadius = constant_default6(0), padRadius = null, startAngle = arcStartAngle, endAngle = arcEndAngle, padAngle = arcPadAngle, context = null, path18 = withPath(arc);
    function arc() {
      var buffer, r29, r0 = +innerRadius.apply(this, arguments), r1 = +outerRadius.apply(this, arguments), a0 = startAngle.apply(this, arguments) - halfPi2, a1 = endAngle.apply(this, arguments) - halfPi2, da = abs3(a1 - a0), cw = a1 > a0;
      if (!context) context = buffer = path18();
      if (r1 < r0) r29 = r1, r1 = r0, r0 = r29;
      if (!(r1 > epsilon)) context.moveTo(0, 0);
      else if (da > tau2 - epsilon) {
        context.moveTo(r1 * cos3(a0), r1 * sin3(a0));
        context.arc(0, 0, r1, a0, a1, !cw);
        if (r0 > epsilon) {
          context.moveTo(r0 * cos3(a1), r0 * sin3(a1));
          context.arc(0, 0, r0, a1, a0, cw);
        }
      } else {
        var a01 = a0, a11 = a1, a00 = a0, a10 = a1, da0 = da, da1 = da, ap2 = padAngle.apply(this, arguments) / 2, rp2 = ap2 > epsilon && (padRadius ? +padRadius.apply(this, arguments) : sqrt2(r0 * r0 + r1 * r1)), rc = min7(abs3(r1 - r0) / 2, +cornerRadius.apply(this, arguments)), rc0 = rc, rc1 = rc, t02, t12;
        if (rp2 > epsilon) {
          var p0 = asin3(rp2 / r0 * sin3(ap2)), p1 = asin3(rp2 / r1 * sin3(ap2));
          if ((da0 -= p0 * 2) > epsilon) p0 *= cw ? 1 : -1, a00 += p0, a10 -= p0;
          else da0 = 0, a00 = a10 = (a0 + a1) / 2;
          if ((da1 -= p1 * 2) > epsilon) p1 *= cw ? 1 : -1, a01 += p1, a11 -= p1;
          else da1 = 0, a01 = a11 = (a0 + a1) / 2;
        }
        var x01 = r1 * cos3(a01), y01 = r1 * sin3(a01), x102 = r0 * cos3(a10), y102 = r0 * sin3(a10);
        if (rc > epsilon) {
          var x113 = r1 * cos3(a11), y114 = r1 * sin3(a11), x00 = r0 * cos3(a00), y00 = r0 * sin3(a00), oc;
          if (da < pi4) {
            if (oc = intersect2(x01, y01, x00, y00, x113, y114, x102, y102)) {
              var ax = x01 - oc[0], ay = y01 - oc[1], bx = x113 - oc[0], by = y114 - oc[1], kc = 1 / sin3(acos3((ax * bx + ay * by) / (sqrt2(ax * ax + ay * ay) * sqrt2(bx * bx + by * by))) / 2), lc = sqrt2(oc[0] * oc[0] + oc[1] * oc[1]);
              rc0 = min7(rc, (r0 - lc) / (kc - 1));
              rc1 = min7(rc, (r1 - lc) / (kc + 1));
            } else {
              rc0 = rc1 = 0;
            }
          }
        }
        if (!(da1 > epsilon)) context.moveTo(x01, y01);
        else if (rc1 > epsilon) {
          t02 = cornerTangents(x00, y00, x01, y01, r1, rc1, cw);
          t12 = cornerTangents(x113, y114, x102, y102, r1, rc1, cw);
          context.moveTo(t02.cx + t02.x01, t02.cy + t02.y01);
          if (rc1 < rc) context.arc(t02.cx, t02.cy, rc1, atan23(t02.y01, t02.x01), atan23(t12.y01, t12.x01), !cw);
          else {
            context.arc(t02.cx, t02.cy, rc1, atan23(t02.y01, t02.x01), atan23(t02.y11, t02.x11), !cw);
            context.arc(0, 0, r1, atan23(t02.cy + t02.y11, t02.cx + t02.x11), atan23(t12.cy + t12.y11, t12.cx + t12.x11), !cw);
            context.arc(t12.cx, t12.cy, rc1, atan23(t12.y11, t12.x11), atan23(t12.y01, t12.x01), !cw);
          }
        } else context.moveTo(x01, y01), context.arc(0, 0, r1, a01, a11, !cw);
        if (!(r0 > epsilon) || !(da0 > epsilon)) context.lineTo(x102, y102);
        else if (rc0 > epsilon) {
          t02 = cornerTangents(x102, y102, x113, y114, r0, -rc0, cw);
          t12 = cornerTangents(x01, y01, x00, y00, r0, -rc0, cw);
          context.lineTo(t02.cx + t02.x01, t02.cy + t02.y01);
          if (rc0 < rc) context.arc(t02.cx, t02.cy, rc0, atan23(t02.y01, t02.x01), atan23(t12.y01, t12.x01), !cw);
          else {
            context.arc(t02.cx, t02.cy, rc0, atan23(t02.y01, t02.x01), atan23(t02.y11, t02.x11), !cw);
            context.arc(0, 0, r0, atan23(t02.cy + t02.y11, t02.cx + t02.x11), atan23(t12.cy + t12.y11, t12.cx + t12.x11), cw);
            context.arc(t12.cx, t12.cy, rc0, atan23(t12.y11, t12.x11), atan23(t12.y01, t12.x01), !cw);
          }
        } else context.arc(0, 0, r0, a10, a00, cw);
      }
      context.closePath();
      if (buffer) return context = null, buffer + "" || null;
    }
    arc.centroid = function() {
      var r29 = (+innerRadius.apply(this, arguments) + +outerRadius.apply(this, arguments)) / 2, a3 = (+startAngle.apply(this, arguments) + +endAngle.apply(this, arguments)) / 2 - pi4 / 2;
      return [cos3(a3) * r29, sin3(a3) * r29];
    };
    arc.innerRadius = function(_) {
      return arguments.length ? (innerRadius = typeof _ === "function" ? _ : constant_default6(+_), arc) : innerRadius;
    };
    arc.outerRadius = function(_) {
      return arguments.length ? (outerRadius = typeof _ === "function" ? _ : constant_default6(+_), arc) : outerRadius;
    };
    arc.cornerRadius = function(_) {
      return arguments.length ? (cornerRadius = typeof _ === "function" ? _ : constant_default6(+_), arc) : cornerRadius;
    };
    arc.padRadius = function(_) {
      return arguments.length ? (padRadius = _ == null ? null : typeof _ === "function" ? _ : constant_default6(+_), arc) : padRadius;
    };
    arc.startAngle = function(_) {
      return arguments.length ? (startAngle = typeof _ === "function" ? _ : constant_default6(+_), arc) : startAngle;
    };
    arc.endAngle = function(_) {
      return arguments.length ? (endAngle = typeof _ === "function" ? _ : constant_default6(+_), arc) : endAngle;
    };
    arc.padAngle = function(_) {
      return arguments.length ? (padAngle = typeof _ === "function" ? _ : constant_default6(+_), arc) : padAngle;
    };
    arc.context = function(_) {
      return arguments.length ? (context = _ == null ? null : _, arc) : context;
    };
    return arc;
  }

  // node_modules/d3-chord/src/math.js
  var abs4 = Math.abs;
  var cos4 = Math.cos;
  var sin4 = Math.sin;
  var pi6 = Math.PI;
  var halfPi3 = pi6 / 2;
  var tau4 = pi6 * 2;
  var max9 = Math.max;
  var epsilon4 = 1e-12;

  // node_modules/d3-chord/src/chord.js
  function range3(i2, j) {
    return Array.from({ length: j - i2 }, (_, k) => i2 + k);
  }
  function compareValue(compare24) {
    return function(a3, b10) {
      return compare24(
        a3.source.value + a3.target.value,
        b10.source.value + b10.target.value
      );
    };
  }
  function chord_default() {
    return chord(false, false);
  }
  function chord(directed, transpose2) {
    var padAngle = 0, sortGroups = null, sortSubgroups = null, sortChords = null;
    function chord2(matrix) {
      var n = matrix.length, groupSums = new Array(n), groupIndex = range3(0, n), chords = new Array(n * n), groups = new Array(n), k = 0, dx;
      matrix = Float64Array.from({ length: n * n }, transpose2 ? (_, i2) => matrix[i2 % n][i2 / n | 0] : (_, i2) => matrix[i2 / n | 0][i2 % n]);
      for (let i2 = 0; i2 < n; ++i2) {
        let x32 = 0;
        for (let j = 0; j < n; ++j) x32 += matrix[i2 * n + j] + directed * matrix[j * n + i2];
        k += groupSums[i2] = x32;
      }
      k = max9(0, tau4 - padAngle * n) / k;
      dx = k ? padAngle : tau4 / n;
      {
        let x32 = 0;
        if (sortGroups) groupIndex.sort((a3, b10) => sortGroups(groupSums[a3], groupSums[b10]));
        for (const i2 of groupIndex) {
          const x0 = x32;
          if (directed) {
            const subgroupIndex = range3(~n + 1, n).filter((j) => j < 0 ? matrix[~j * n + i2] : matrix[i2 * n + j]);
            if (sortSubgroups) subgroupIndex.sort((a3, b10) => sortSubgroups(a3 < 0 ? -matrix[~a3 * n + i2] : matrix[i2 * n + a3], b10 < 0 ? -matrix[~b10 * n + i2] : matrix[i2 * n + b10]));
            for (const j of subgroupIndex) {
              if (j < 0) {
                const chord3 = chords[~j * n + i2] || (chords[~j * n + i2] = { source: null, target: null });
                chord3.target = { index: i2, startAngle: x32, endAngle: x32 += matrix[~j * n + i2] * k, value: matrix[~j * n + i2] };
              } else {
                const chord3 = chords[i2 * n + j] || (chords[i2 * n + j] = { source: null, target: null });
                chord3.source = { index: i2, startAngle: x32, endAngle: x32 += matrix[i2 * n + j] * k, value: matrix[i2 * n + j] };
              }
            }
            groups[i2] = { index: i2, startAngle: x0, endAngle: x32, value: groupSums[i2] };
          } else {
            const subgroupIndex = range3(0, n).filter((j) => matrix[i2 * n + j] || matrix[j * n + i2]);
            if (sortSubgroups) subgroupIndex.sort((a3, b10) => sortSubgroups(matrix[i2 * n + a3], matrix[i2 * n + b10]));
            for (const j of subgroupIndex) {
              let chord3;
              if (i2 < j) {
                chord3 = chords[i2 * n + j] || (chords[i2 * n + j] = { source: null, target: null });
                chord3.source = { index: i2, startAngle: x32, endAngle: x32 += matrix[i2 * n + j] * k, value: matrix[i2 * n + j] };
              } else {
                chord3 = chords[j * n + i2] || (chords[j * n + i2] = { source: null, target: null });
                chord3.target = { index: i2, startAngle: x32, endAngle: x32 += matrix[i2 * n + j] * k, value: matrix[i2 * n + j] };
                if (i2 === j) chord3.source = chord3.target;
              }
              if (chord3.source && chord3.target && chord3.source.value < chord3.target.value) {
                const source3 = chord3.source;
                chord3.source = chord3.target;
                chord3.target = source3;
              }
            }
            groups[i2] = { index: i2, startAngle: x0, endAngle: x32, value: groupSums[i2] };
          }
          x32 += dx;
        }
      }
      chords = Object.values(chords);
      chords.groups = groups;
      return sortChords ? chords.sort(sortChords) : chords;
    }
    chord2.padAngle = function(_) {
      return arguments.length ? (padAngle = max9(0, _), chord2) : padAngle;
    };
    chord2.sortGroups = function(_) {
      return arguments.length ? (sortGroups = _, chord2) : sortGroups;
    };
    chord2.sortSubgroups = function(_) {
      return arguments.length ? (sortSubgroups = _, chord2) : sortSubgroups;
    };
    chord2.sortChords = function(_) {
      return arguments.length ? (_ == null ? sortChords = null : (sortChords = compareValue(_))._ = _, chord2) : sortChords && sortChords._;
    };
    return chord2;
  }

  // node_modules/d3-chord/src/array.js
  var slice3 = Array.prototype.slice;

  // node_modules/d3-chord/src/constant.js
  function constant_default7(x32) {
    return function() {
      return x32;
    };
  }

  // node_modules/d3-chord/src/ribbon.js
  function defaultSource(d) {
    return d.source;
  }
  function defaultTarget(d) {
    return d.target;
  }
  function defaultRadius(d) {
    return d.radius;
  }
  function defaultStartAngle(d) {
    return d.startAngle;
  }
  function defaultEndAngle(d) {
    return d.endAngle;
  }
  function defaultPadAngle() {
    return 0;
  }
  function ribbon(headRadius) {
    var source3 = defaultSource, target7 = defaultTarget, sourceRadius = defaultRadius, targetRadius = defaultRadius, startAngle = defaultStartAngle, endAngle = defaultEndAngle, padAngle = defaultPadAngle, context = null;
    function ribbon2() {
      var buffer, s3 = source3.apply(this, arguments), t2 = target7.apply(this, arguments), ap2 = padAngle.apply(this, arguments) / 2, argv = slice3.call(arguments), sr = +sourceRadius.apply(this, (argv[0] = s3, argv)), sa0 = startAngle.apply(this, argv) - halfPi3, sa1 = endAngle.apply(this, argv) - halfPi3, tr2 = +targetRadius.apply(this, (argv[0] = t2, argv)), ta0 = startAngle.apply(this, argv) - halfPi3, ta1 = endAngle.apply(this, argv) - halfPi3;
      if (!context) context = buffer = path2();
      if (ap2 > epsilon4) {
        if (abs4(sa1 - sa0) > ap2 * 2 + epsilon4) sa1 > sa0 ? (sa0 += ap2, sa1 -= ap2) : (sa0 -= ap2, sa1 += ap2);
        else sa0 = sa1 = (sa0 + sa1) / 2;
        if (abs4(ta1 - ta0) > ap2 * 2 + epsilon4) ta1 > ta0 ? (ta0 += ap2, ta1 -= ap2) : (ta0 -= ap2, ta1 += ap2);
        else ta0 = ta1 = (ta0 + ta1) / 2;
      }
      context.moveTo(sr * cos4(sa0), sr * sin4(sa0));
      context.arc(0, 0, sr, sa0, sa1);
      if (sa0 !== ta0 || sa1 !== ta1) {
        if (headRadius) {
          var hr2 = +headRadius.apply(this, arguments), tr22 = tr2 - hr2, ta2 = (ta0 + ta1) / 2;
          context.quadraticCurveTo(0, 0, tr22 * cos4(ta0), tr22 * sin4(ta0));
          context.lineTo(tr2 * cos4(ta2), tr2 * sin4(ta2));
          context.lineTo(tr22 * cos4(ta1), tr22 * sin4(ta1));
        } else {
          context.quadraticCurveTo(0, 0, tr2 * cos4(ta0), tr2 * sin4(ta0));
          context.arc(0, 0, tr2, ta0, ta1);
        }
      }
      context.quadraticCurveTo(0, 0, sr * cos4(sa0), sr * sin4(sa0));
      context.closePath();
      if (buffer) return context = null, buffer + "" || null;
    }
    if (headRadius) ribbon2.headRadius = function(_) {
      return arguments.length ? (headRadius = typeof _ === "function" ? _ : constant_default7(+_), ribbon2) : headRadius;
    };
    ribbon2.radius = function(_) {
      return arguments.length ? (sourceRadius = targetRadius = typeof _ === "function" ? _ : constant_default7(+_), ribbon2) : sourceRadius;
    };
    ribbon2.sourceRadius = function(_) {
      return arguments.length ? (sourceRadius = typeof _ === "function" ? _ : constant_default7(+_), ribbon2) : sourceRadius;
    };
    ribbon2.targetRadius = function(_) {
      return arguments.length ? (targetRadius = typeof _ === "function" ? _ : constant_default7(+_), ribbon2) : targetRadius;
    };
    ribbon2.startAngle = function(_) {
      return arguments.length ? (startAngle = typeof _ === "function" ? _ : constant_default7(+_), ribbon2) : startAngle;
    };
    ribbon2.endAngle = function(_) {
      return arguments.length ? (endAngle = typeof _ === "function" ? _ : constant_default7(+_), ribbon2) : endAngle;
    };
    ribbon2.padAngle = function(_) {
      return arguments.length ? (padAngle = typeof _ === "function" ? _ : constant_default7(+_), ribbon2) : padAngle;
    };
    ribbon2.source = function(_) {
      return arguments.length ? (source3 = _, ribbon2) : source3;
    };
    ribbon2.target = function(_) {
      return arguments.length ? (target7 = _, ribbon2) : target7;
    };
    ribbon2.context = function(_) {
      return arguments.length ? (context = _ == null ? null : _, ribbon2) : context;
    };
    return ribbon2;
  }
  function ribbon_default() {
    return ribbon();
  }

  // node_modules/d3-scale-chromatic/src/colors.js
  function colors_default(specifier) {
    var n = specifier.length / 6 | 0, colors5 = new Array(n), i2 = 0;
    while (i2 < n) colors5[i2] = "#" + specifier.slice(i2 * 6, ++i2 * 6);
    return colors5;
  }

  // node_modules/d3-scale-chromatic/src/categorical/category10.js
  var category10_default = colors_default("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");

  // node_modules/d3-scale-chromatic/src/ramp.js
  var ramp_default = (scheme2) => rgbBasis(scheme2[scheme2.length - 1]);

  // node_modules/d3-scale-chromatic/src/diverging/RdYlGn.js
  var scheme = new Array(3).concat(
    "fc8d59ffffbf91cf60",
    "d7191cfdae61a6d96a1a9641",
    "d7191cfdae61ffffbfa6d96a1a9641",
    "d73027fc8d59fee08bd9ef8b91cf601a9850",
    "d73027fc8d59fee08bffffbfd9ef8b91cf601a9850",
    "d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850",
    "d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850",
    "a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837",
    "a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837"
  ).map(colors_default);
  var RdYlGn_default = ramp_default(scheme);

  // node_modules/d3-scale-chromatic/src/sequential-multi/turbo.js
  function turbo_default(t2) {
    t2 = Math.max(0, Math.min(1, t2));
    return "rgb(" + Math.max(0, Math.min(255, Math.round(34.61 + t2 * (1172.33 - t2 * (10793.56 - t2 * (33300.12 - t2 * (38394.49 - t2 * 14825.05))))))) + ", " + Math.max(0, Math.min(255, Math.round(23.31 + t2 * (557.33 + t2 * (1225.33 - t2 * (3574.96 - t2 * (1073.77 + t2 * 707.56))))))) + ", " + Math.max(0, Math.min(255, Math.round(27.2 + t2 * (3211.1 - t2 * (15327.97 - t2 * (27814 - t2 * (22569.18 - t2 * 6838.66))))))) + ")";
  }

  // node_modules/d3-scale-chromatic/src/sequential-multi/viridis.js
  function ramp(range6) {
    var n = range6.length;
    return function(t2) {
      return range6[Math.max(0, Math.min(n - 1, Math.floor(t2 * n)))];
    };
  }
  var viridis_default = ramp(colors_default("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));
  var magma = ramp(colors_default("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf"));
  var inferno = ramp(colors_default("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4"));
  var plasma = ramp(colors_default("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));

  // node_modules/d3-array/src/ascending.js
  function ascending2(a3, b10) {
    return a3 == null || b10 == null ? NaN : a3 < b10 ? -1 : a3 > b10 ? 1 : a3 >= b10 ? 0 : NaN;
  }

  // node_modules/d3-array/src/descending.js
  function descending(a3, b10) {
    return a3 == null || b10 == null ? NaN : b10 < a3 ? -1 : b10 > a3 ? 1 : b10 >= a3 ? 0 : NaN;
  }

  // node_modules/d3-array/src/bisector.js
  function bisector(f) {
    let compare111, compare24, delta;
    if (f.length !== 2) {
      compare111 = ascending2;
      compare24 = (d, x32) => ascending2(f(d), x32);
      delta = (d, x32) => f(d) - x32;
    } else {
      compare111 = f === ascending2 || f === descending ? f : zero3;
      compare24 = f;
      delta = f;
    }
    function left2(a3, x32, lo = 0, hi = a3.length) {
      if (lo < hi) {
        if (compare111(x32, x32) !== 0) return hi;
        do {
          const mid = lo + hi >>> 1;
          if (compare24(a3[mid], x32) < 0) lo = mid + 1;
          else hi = mid;
        } while (lo < hi);
      }
      return lo;
    }
    function right2(a3, x32, lo = 0, hi = a3.length) {
      if (lo < hi) {
        if (compare111(x32, x32) !== 0) return hi;
        do {
          const mid = lo + hi >>> 1;
          if (compare24(a3[mid], x32) <= 0) lo = mid + 1;
          else hi = mid;
        } while (lo < hi);
      }
      return lo;
    }
    function center3(a3, x32, lo = 0, hi = a3.length) {
      const i2 = left2(a3, x32, lo, hi - 1);
      return i2 > lo && delta(a3[i2 - 1], x32) > -delta(a3[i2], x32) ? i2 - 1 : i2;
    }
    return { left: left2, center: center3, right: right2 };
  }
  function zero3() {
    return 0;
  }

  // node_modules/d3-array/src/number.js
  function number(x32) {
    return x32 === null ? NaN : +x32;
  }

  // node_modules/d3-array/src/bisect.js
  var ascendingBisect = bisector(ascending2);
  var bisectRight = ascendingBisect.right;
  var bisectLeft = ascendingBisect.left;
  var bisectCenter = bisector(number).center;
  var bisect_default = bisectRight;

  // node_modules/internmap/src/index.js
  var InternMap = class extends Map {
    constructor(entries, key2 = keyof) {
      super();
      Object.defineProperties(this, { _intern: { value: /* @__PURE__ */ new Map() }, _key: { value: key2 } });
      if (entries != null) for (const [key3, value20] of entries) this.set(key3, value20);
    }
    get(key2) {
      return super.get(intern_get(this, key2));
    }
    has(key2) {
      return super.has(intern_get(this, key2));
    }
    set(key2, value20) {
      return super.set(intern_set(this, key2), value20);
    }
    delete(key2) {
      return super.delete(intern_delete(this, key2));
    }
  };
  function intern_get({ _intern, _key }, value20) {
    const key2 = _key(value20);
    return _intern.has(key2) ? _intern.get(key2) : value20;
  }
  function intern_set({ _intern, _key }, value20) {
    const key2 = _key(value20);
    if (_intern.has(key2)) return _intern.get(key2);
    _intern.set(key2, value20);
    return value20;
  }
  function intern_delete({ _intern, _key }, value20) {
    const key2 = _key(value20);
    if (_intern.has(key2)) {
      value20 = _intern.get(key2);
      _intern.delete(key2);
    }
    return value20;
  }
  function keyof(value20) {
    return value20 !== null && typeof value20 === "object" ? value20.valueOf() : value20;
  }

  // node_modules/d3-array/src/ticks.js
  var e10 = Math.sqrt(50);
  var e5 = Math.sqrt(10);
  var e2 = Math.sqrt(2);
  function tickSpec(start4, stop2, count) {
    const step5 = (stop2 - start4) / Math.max(0, count), power2 = Math.floor(Math.log10(step5)), error4 = step5 / Math.pow(10, power2), factor = error4 >= e10 ? 10 : error4 >= e5 ? 5 : error4 >= e2 ? 2 : 1;
    let i1, i2, inc;
    if (power2 < 0) {
      inc = Math.pow(10, -power2) / factor;
      i1 = Math.round(start4 * inc);
      i2 = Math.round(stop2 * inc);
      if (i1 / inc < start4) ++i1;
      if (i2 / inc > stop2) --i2;
      inc = -inc;
    } else {
      inc = Math.pow(10, power2) * factor;
      i1 = Math.round(start4 / inc);
      i2 = Math.round(stop2 / inc);
      if (i1 * inc < start4) ++i1;
      if (i2 * inc > stop2) --i2;
    }
    if (i2 < i1 && 0.5 <= count && count < 2) return tickSpec(start4, stop2, count * 2);
    return [i1, i2, inc];
  }
  function ticks(start4, stop2, count) {
    stop2 = +stop2, start4 = +start4, count = +count;
    if (!(count > 0)) return [];
    if (start4 === stop2) return [start4];
    const reverse3 = stop2 < start4, [i1, i2, inc] = reverse3 ? tickSpec(stop2, start4, count) : tickSpec(start4, stop2, count);
    if (!(i2 >= i1)) return [];
    const n = i2 - i1 + 1, ticks3 = new Array(n);
    if (reverse3) {
      if (inc < 0) for (let i3 = 0; i3 < n; ++i3) ticks3[i3] = (i2 - i3) / -inc;
      else for (let i3 = 0; i3 < n; ++i3) ticks3[i3] = (i2 - i3) * inc;
    } else {
      if (inc < 0) for (let i3 = 0; i3 < n; ++i3) ticks3[i3] = (i1 + i3) / -inc;
      else for (let i3 = 0; i3 < n; ++i3) ticks3[i3] = (i1 + i3) * inc;
    }
    return ticks3;
  }
  function tickIncrement(start4, stop2, count) {
    stop2 = +stop2, start4 = +start4, count = +count;
    return tickSpec(start4, stop2, count)[2];
  }
  function tickStep(start4, stop2, count) {
    stop2 = +stop2, start4 = +start4, count = +count;
    const reverse3 = stop2 < start4, inc = reverse3 ? tickIncrement(stop2, start4, count) : tickIncrement(start4, stop2, count);
    return (reverse3 ? -1 : 1) * (inc < 0 ? 1 / -inc : inc);
  }

  // node_modules/d3-array/src/quantile.js
  function quantileSorted(values2, p2, valueof = number) {
    if (!(n = values2.length) || isNaN(p2 = +p2)) return;
    if (p2 <= 0 || n < 2) return +valueof(values2[0], 0, values2);
    if (p2 >= 1) return +valueof(values2[n - 1], n - 1, values2);
    var n, i2 = (n - 1) * p2, i0 = Math.floor(i2), value0 = +valueof(values2[i0], i0, values2), value1 = +valueof(values2[i0 + 1], i0 + 1, values2);
    return value0 + (value1 - value0) * (i2 - i0);
  }

  // node_modules/d3-array/src/range.js
  function range4(start4, stop2, step5) {
    start4 = +start4, stop2 = +stop2, step5 = (n = arguments.length) < 2 ? (stop2 = start4, start4 = 0, 1) : n < 3 ? 1 : +step5;
    var i2 = -1, n = Math.max(0, Math.ceil((stop2 - start4) / step5)) | 0, range6 = new Array(n);
    while (++i2 < n) {
      range6[i2] = start4 + i2 * step5;
    }
    return range6;
  }

  // node_modules/d3-scale/src/init.js
  function initRange(domain2, range6) {
    switch (arguments.length) {
      case 0:
        break;
      case 1:
        this.range(domain2);
        break;
      default:
        this.range(range6).domain(domain2);
        break;
    }
    return this;
  }

  // node_modules/d3-scale/src/ordinal.js
  var implicit = Symbol("implicit");
  function ordinal() {
    var index7 = new InternMap(), domain2 = [], range6 = [], unknown = implicit;
    function scale(d) {
      let i2 = index7.get(d);
      if (i2 === void 0) {
        if (unknown !== implicit) return unknown;
        index7.set(d, i2 = domain2.push(d) - 1);
      }
      return range6[i2 % range6.length];
    }
    scale.domain = function(_) {
      if (!arguments.length) return domain2.slice();
      domain2 = [], index7 = new InternMap();
      for (const value20 of _) {
        if (index7.has(value20)) continue;
        index7.set(value20, domain2.push(value20) - 1);
      }
      return scale;
    };
    scale.range = function(_) {
      return arguments.length ? (range6 = Array.from(_), scale) : range6.slice();
    };
    scale.unknown = function(_) {
      return arguments.length ? (unknown = _, scale) : unknown;
    };
    scale.copy = function() {
      return ordinal(domain2, range6).unknown(unknown);
    };
    initRange.apply(scale, arguments);
    return scale;
  }

  // node_modules/d3-scale/src/band.js
  function band() {
    var scale = ordinal().unknown(void 0), domain2 = scale.domain, ordinalRange = scale.range, r0 = 0, r1 = 1, step5, bandwidth2, round4 = false, paddingInner2 = 0, paddingOuter2 = 0, align2 = 0.5;
    delete scale.unknown;
    function rescale() {
      var n = domain2().length, reverse3 = r1 < r0, start4 = reverse3 ? r1 : r0, stop2 = reverse3 ? r0 : r1;
      step5 = (stop2 - start4) / Math.max(1, n - paddingInner2 + paddingOuter2 * 2);
      if (round4) step5 = Math.floor(step5);
      start4 += (stop2 - start4 - step5 * (n - paddingInner2)) * align2;
      bandwidth2 = step5 * (1 - paddingInner2);
      if (round4) start4 = Math.round(start4), bandwidth2 = Math.round(bandwidth2);
      var values2 = range4(n).map(function(i2) {
        return start4 + step5 * i2;
      });
      return ordinalRange(reverse3 ? values2.reverse() : values2);
    }
    scale.domain = function(_) {
      return arguments.length ? (domain2(_), rescale()) : domain2();
    };
    scale.range = function(_) {
      return arguments.length ? ([r0, r1] = _, r0 = +r0, r1 = +r1, rescale()) : [r0, r1];
    };
    scale.rangeRound = function(_) {
      return [r0, r1] = _, r0 = +r0, r1 = +r1, round4 = true, rescale();
    };
    scale.bandwidth = function() {
      return bandwidth2;
    };
    scale.step = function() {
      return step5;
    };
    scale.round = function(_) {
      return arguments.length ? (round4 = !!_, rescale()) : round4;
    };
    scale.padding = function(_) {
      return arguments.length ? (paddingInner2 = Math.min(1, paddingOuter2 = +_), rescale()) : paddingInner2;
    };
    scale.paddingInner = function(_) {
      return arguments.length ? (paddingInner2 = Math.min(1, _), rescale()) : paddingInner2;
    };
    scale.paddingOuter = function(_) {
      return arguments.length ? (paddingOuter2 = +_, rescale()) : paddingOuter2;
    };
    scale.align = function(_) {
      return arguments.length ? (align2 = Math.max(0, Math.min(1, _)), rescale()) : align2;
    };
    scale.copy = function() {
      return band(domain2(), [r0, r1]).round(round4).paddingInner(paddingInner2).paddingOuter(paddingOuter2).align(align2);
    };
    return initRange.apply(rescale(), arguments);
  }
  function pointish(scale) {
    var copy4 = scale.copy;
    scale.padding = scale.paddingOuter;
    delete scale.paddingInner;
    delete scale.paddingOuter;
    scale.copy = function() {
      return pointish(copy4());
    };
    return scale;
  }
  function point() {
    return pointish(band.apply(null, arguments).paddingInner(1));
  }

  // node_modules/d3-scale/src/constant.js
  function constants(x32) {
    return function() {
      return x32;
    };
  }

  // node_modules/d3-scale/src/number.js
  function number2(x32) {
    return +x32;
  }

  // node_modules/d3-scale/src/continuous.js
  var unit2 = [0, 1];
  function identity14(x32) {
    return x32;
  }
  function normalize2(a3, b10) {
    return (b10 -= a3 = +a3) ? function(x32) {
      return (x32 - a3) / b10;
    } : constants(isNaN(b10) ? NaN : 0.5);
  }
  function clamper(a3, b10) {
    var t2;
    if (a3 > b10) t2 = a3, a3 = b10, b10 = t2;
    return function(x32) {
      return Math.max(a3, Math.min(b10, x32));
    };
  }
  function bimap3(domain2, range6, interpolate) {
    var d0 = domain2[0], d1 = domain2[1], r0 = range6[0], r1 = range6[1];
    if (d1 < d0) d0 = normalize2(d1, d0), r0 = interpolate(r1, r0);
    else d0 = normalize2(d0, d1), r0 = interpolate(r0, r1);
    return function(x32) {
      return r0(d0(x32));
    };
  }
  function polymap(domain2, range6, interpolate) {
    var j = Math.min(domain2.length, range6.length) - 1, d = new Array(j), r29 = new Array(j), i2 = -1;
    if (domain2[j] < domain2[0]) {
      domain2 = domain2.slice().reverse();
      range6 = range6.slice().reverse();
    }
    while (++i2 < j) {
      d[i2] = normalize2(domain2[i2], domain2[i2 + 1]);
      r29[i2] = interpolate(range6[i2], range6[i2 + 1]);
    }
    return function(x32) {
      var i3 = bisect_default(domain2, x32, 1, j) - 1;
      return r29[i3](d[i3](x32));
    };
  }
  function copy2(source3, target7) {
    return target7.domain(source3.domain()).range(source3.range()).interpolate(source3.interpolate()).clamp(source3.clamp()).unknown(source3.unknown());
  }
  function transformer() {
    var domain2 = unit2, range6 = unit2, interpolate = value_default, transform17, untransform, unknown, clamp5 = identity14, piecewise, output2, input3;
    function rescale() {
      var n = Math.min(domain2.length, range6.length);
      if (clamp5 !== identity14) clamp5 = clamper(domain2[0], domain2[n - 1]);
      piecewise = n > 2 ? polymap : bimap3;
      output2 = input3 = null;
      return scale;
    }
    function scale(x32) {
      return x32 == null || isNaN(x32 = +x32) ? unknown : (output2 || (output2 = piecewise(domain2.map(transform17), range6, interpolate)))(transform17(clamp5(x32)));
    }
    scale.invert = function(y32) {
      return clamp5(untransform((input3 || (input3 = piecewise(range6, domain2.map(transform17), number_default)))(y32)));
    };
    scale.domain = function(_) {
      return arguments.length ? (domain2 = Array.from(_, number2), rescale()) : domain2.slice();
    };
    scale.range = function(_) {
      return arguments.length ? (range6 = Array.from(_), rescale()) : range6.slice();
    };
    scale.rangeRound = function(_) {
      return range6 = Array.from(_), interpolate = round_default, rescale();
    };
    scale.clamp = function(_) {
      return arguments.length ? (clamp5 = _ ? true : identity14, rescale()) : clamp5 !== identity14;
    };
    scale.interpolate = function(_) {
      return arguments.length ? (interpolate = _, rescale()) : interpolate;
    };
    scale.unknown = function(_) {
      return arguments.length ? (unknown = _, scale) : unknown;
    };
    return function(t2, u2) {
      transform17 = t2, untransform = u2;
      return rescale();
    };
  }
  function continuous() {
    return transformer()(identity14, identity14);
  }

  // node_modules/d3-format/src/formatDecimal.js
  function formatDecimal_default(x32) {
    return Math.abs(x32 = Math.round(x32)) >= 1e21 ? x32.toLocaleString("en").replace(/,/g, "") : x32.toString(10);
  }
  function formatDecimalParts(x32, p2) {
    if ((i2 = (x32 = p2 ? x32.toExponential(p2 - 1) : x32.toExponential()).indexOf("e")) < 0) return null;
    var i2, coefficient = x32.slice(0, i2);
    return [
      coefficient.length > 1 ? coefficient[0] + coefficient.slice(2) : coefficient,
      +x32.slice(i2 + 1)
    ];
  }

  // node_modules/d3-format/src/exponent.js
  function exponent_default(x32) {
    return x32 = formatDecimalParts(Math.abs(x32)), x32 ? x32[1] : NaN;
  }

  // node_modules/d3-format/src/formatGroup.js
  function formatGroup_default(grouping, thousands) {
    return function(value20, width47) {
      var i2 = value20.length, t2 = [], j = 0, g2 = grouping[0], length10 = 0;
      while (i2 > 0 && g2 > 0) {
        if (length10 + g2 + 1 > width47) g2 = Math.max(1, width47 - length10);
        t2.push(value20.substring(i2 -= g2, i2 + g2));
        if ((length10 += g2 + 1) > width47) break;
        g2 = grouping[j = (j + 1) % grouping.length];
      }
      return t2.reverse().join(thousands);
    };
  }

  // node_modules/d3-format/src/formatNumerals.js
  function formatNumerals_default(numerals) {
    return function(value20) {
      return value20.replace(/[0-9]/g, function(i2) {
        return numerals[+i2];
      });
    };
  }

  // node_modules/d3-format/src/formatSpecifier.js
  var re = /^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;
  function formatSpecifier(specifier) {
    if (!(match3 = re.exec(specifier))) throw new Error("invalid format: " + specifier);
    var match3;
    return new FormatSpecifier({
      fill: match3[1],
      align: match3[2],
      sign: match3[3],
      symbol: match3[4],
      zero: match3[5],
      width: match3[6],
      comma: match3[7],
      precision: match3[8] && match3[8].slice(1),
      trim: match3[9],
      type: match3[10]
    });
  }
  formatSpecifier.prototype = FormatSpecifier.prototype;
  function FormatSpecifier(specifier) {
    this.fill = specifier.fill === void 0 ? " " : specifier.fill + "";
    this.align = specifier.align === void 0 ? ">" : specifier.align + "";
    this.sign = specifier.sign === void 0 ? "-" : specifier.sign + "";
    this.symbol = specifier.symbol === void 0 ? "" : specifier.symbol + "";
    this.zero = !!specifier.zero;
    this.width = specifier.width === void 0 ? void 0 : +specifier.width;
    this.comma = !!specifier.comma;
    this.precision = specifier.precision === void 0 ? void 0 : +specifier.precision;
    this.trim = !!specifier.trim;
    this.type = specifier.type === void 0 ? "" : specifier.type + "";
  }
  FormatSpecifier.prototype.toString = function() {
    return this.fill + this.align + this.sign + this.symbol + (this.zero ? "0" : "") + (this.width === void 0 ? "" : Math.max(1, this.width | 0)) + (this.comma ? "," : "") + (this.precision === void 0 ? "" : "." + Math.max(0, this.precision | 0)) + (this.trim ? "~" : "") + this.type;
  };

  // node_modules/d3-format/src/formatTrim.js
  function formatTrim_default(s3) {
    out: for (var n = s3.length, i2 = 1, i0 = -1, i1; i2 < n; ++i2) {
      switch (s3[i2]) {
        case ".":
          i0 = i1 = i2;
          break;
        case "0":
          if (i0 === 0) i0 = i2;
          i1 = i2;
          break;
        default:
          if (!+s3[i2]) break out;
          if (i0 > 0) i0 = 0;
          break;
      }
    }
    return i0 > 0 ? s3.slice(0, i0) + s3.slice(i1 + 1) : s3;
  }

  // node_modules/d3-format/src/formatPrefixAuto.js
  var prefixExponent;
  function formatPrefixAuto_default(x32, p2) {
    var d = formatDecimalParts(x32, p2);
    if (!d) return x32 + "";
    var coefficient = d[0], exponent2 = d[1], i2 = exponent2 - (prefixExponent = Math.max(-8, Math.min(8, Math.floor(exponent2 / 3))) * 3) + 1, n = coefficient.length;
    return i2 === n ? coefficient : i2 > n ? coefficient + new Array(i2 - n + 1).join("0") : i2 > 0 ? coefficient.slice(0, i2) + "." + coefficient.slice(i2) : "0." + new Array(1 - i2).join("0") + formatDecimalParts(x32, Math.max(0, p2 + i2 - 1))[0];
  }

  // node_modules/d3-format/src/formatRounded.js
  function formatRounded_default(x32, p2) {
    var d = formatDecimalParts(x32, p2);
    if (!d) return x32 + "";
    var coefficient = d[0], exponent2 = d[1];
    return exponent2 < 0 ? "0." + new Array(-exponent2).join("0") + coefficient : coefficient.length > exponent2 + 1 ? coefficient.slice(0, exponent2 + 1) + "." + coefficient.slice(exponent2 + 1) : coefficient + new Array(exponent2 - coefficient.length + 2).join("0");
  }

  // node_modules/d3-format/src/formatTypes.js
  var formatTypes_default = {
    "%": (x32, p2) => (x32 * 100).toFixed(p2),
    "b": (x32) => Math.round(x32).toString(2),
    "c": (x32) => x32 + "",
    "d": formatDecimal_default,
    "e": (x32, p2) => x32.toExponential(p2),
    "f": (x32, p2) => x32.toFixed(p2),
    "g": (x32, p2) => x32.toPrecision(p2),
    "o": (x32) => Math.round(x32).toString(8),
    "p": (x32, p2) => formatRounded_default(x32 * 100, p2),
    "r": formatRounded_default,
    "s": formatPrefixAuto_default,
    "X": (x32) => Math.round(x32).toString(16).toUpperCase(),
    "x": (x32) => Math.round(x32).toString(16)
  };

  // node_modules/d3-format/src/identity.js
  function identity_default(x32) {
    return x32;
  }

  // node_modules/d3-format/src/locale.js
  var map36 = Array.prototype.map;
  var prefixes = ["y", "z", "a", "f", "p", "n", "\xB5", "m", "", "k", "M", "G", "T", "P", "E", "Z", "Y"];
  function locale_default(locale3) {
    var group4 = locale3.grouping === void 0 || locale3.thousands === void 0 ? identity_default : formatGroup_default(map36.call(locale3.grouping, Number), locale3.thousands + ""), currencyPrefix = locale3.currency === void 0 ? "" : locale3.currency[0] + "", currencySuffix = locale3.currency === void 0 ? "" : locale3.currency[1] + "", decimal = locale3.decimal === void 0 ? "." : locale3.decimal + "", numerals = locale3.numerals === void 0 ? identity_default : formatNumerals_default(map36.call(locale3.numerals, String)), percent = locale3.percent === void 0 ? "%" : locale3.percent + "", minus = locale3.minus === void 0 ? "\u2212" : locale3.minus + "", nan2 = locale3.nan === void 0 ? "NaN" : locale3.nan + "";
    function newFormat(specifier) {
      specifier = formatSpecifier(specifier);
      var fill41 = specifier.fill, align2 = specifier.align, sign2 = specifier.sign, symbol = specifier.symbol, zero4 = specifier.zero, width47 = specifier.width, comma = specifier.comma, precision = specifier.precision, trim2 = specifier.trim, type2 = specifier.type;
      if (type2 === "n") comma = true, type2 = "g";
      else if (!formatTypes_default[type2]) precision === void 0 && (precision = 12), trim2 = true, type2 = "g";
      if (zero4 || fill41 === "0" && align2 === "=") zero4 = true, fill41 = "0", align2 = "=";
      var prefix = symbol === "$" ? currencyPrefix : symbol === "#" && /[boxX]/.test(type2) ? "0" + type2.toLowerCase() : "", suffix = symbol === "$" ? currencySuffix : /[%p]/.test(type2) ? percent : "";
      var formatType = formatTypes_default[type2], maybeSuffix = /[defgprs%]/.test(type2);
      precision = precision === void 0 ? 6 : /[gprs]/.test(type2) ? Math.max(1, Math.min(21, precision)) : Math.max(0, Math.min(20, precision));
      function format2(value20) {
        var valuePrefix = prefix, valueSuffix = suffix, i2, n, c2;
        if (type2 === "c") {
          valueSuffix = formatType(value20) + valueSuffix;
          value20 = "";
        } else {
          value20 = +value20;
          var valueNegative = value20 < 0 || 1 / value20 < 0;
          value20 = isNaN(value20) ? nan2 : formatType(Math.abs(value20), precision);
          if (trim2) value20 = formatTrim_default(value20);
          if (valueNegative && +value20 === 0 && sign2 !== "+") valueNegative = false;
          valuePrefix = (valueNegative ? sign2 === "(" ? sign2 : minus : sign2 === "-" || sign2 === "(" ? "" : sign2) + valuePrefix;
          valueSuffix = (type2 === "s" ? prefixes[8 + prefixExponent / 3] : "") + valueSuffix + (valueNegative && sign2 === "(" ? ")" : "");
          if (maybeSuffix) {
            i2 = -1, n = value20.length;
            while (++i2 < n) {
              if (c2 = value20.charCodeAt(i2), 48 > c2 || c2 > 57) {
                valueSuffix = (c2 === 46 ? decimal + value20.slice(i2 + 1) : value20.slice(i2)) + valueSuffix;
                value20 = value20.slice(0, i2);
                break;
              }
            }
          }
        }
        if (comma && !zero4) value20 = group4(value20, Infinity);
        var length10 = valuePrefix.length + value20.length + valueSuffix.length, padding2 = length10 < width47 ? new Array(width47 - length10 + 1).join(fill41) : "";
        if (comma && zero4) value20 = group4(padding2 + value20, padding2.length ? width47 - valueSuffix.length : Infinity), padding2 = "";
        switch (align2) {
          case "<":
            value20 = valuePrefix + value20 + valueSuffix + padding2;
            break;
          case "=":
            value20 = valuePrefix + padding2 + value20 + valueSuffix;
            break;
          case "^":
            value20 = padding2.slice(0, length10 = padding2.length >> 1) + valuePrefix + value20 + valueSuffix + padding2.slice(length10);
            break;
          default:
            value20 = padding2 + valuePrefix + value20 + valueSuffix;
            break;
        }
        return numerals(value20);
      }
      format2.toString = function() {
        return specifier + "";
      };
      return format2;
    }
    function formatPrefix2(specifier, value20) {
      var f = newFormat((specifier = formatSpecifier(specifier), specifier.type = "f", specifier)), e = Math.max(-8, Math.min(8, Math.floor(exponent_default(value20) / 3))) * 3, k = Math.pow(10, -e), prefix = prefixes[8 + e / 3];
      return function(value21) {
        return f(k * value21) + prefix;
      };
    }
    return {
      format: newFormat,
      formatPrefix: formatPrefix2
    };
  }

  // node_modules/d3-format/src/defaultLocale.js
  var locale;
  var format;
  var formatPrefix;
  defaultLocale({
    thousands: ",",
    grouping: [3],
    currency: ["$", ""]
  });
  function defaultLocale(definition) {
    locale = locale_default(definition);
    format = locale.format;
    formatPrefix = locale.formatPrefix;
    return locale;
  }

  // node_modules/d3-format/src/precisionFixed.js
  function precisionFixed_default(step5) {
    return Math.max(0, -exponent_default(Math.abs(step5)));
  }

  // node_modules/d3-format/src/precisionPrefix.js
  function precisionPrefix_default(step5, value20) {
    return Math.max(0, Math.max(-8, Math.min(8, Math.floor(exponent_default(value20) / 3))) * 3 - exponent_default(Math.abs(step5)));
  }

  // node_modules/d3-format/src/precisionRound.js
  function precisionRound_default(step5, max25) {
    step5 = Math.abs(step5), max25 = Math.abs(max25) - step5;
    return Math.max(0, exponent_default(max25) - exponent_default(step5)) + 1;
  }

  // node_modules/d3-scale/src/tickFormat.js
  function tickFormat(start4, stop2, count, specifier) {
    var step5 = tickStep(start4, stop2, count), precision;
    specifier = formatSpecifier(specifier == null ? ",f" : specifier);
    switch (specifier.type) {
      case "s": {
        var value20 = Math.max(Math.abs(start4), Math.abs(stop2));
        if (specifier.precision == null && !isNaN(precision = precisionPrefix_default(step5, value20))) specifier.precision = precision;
        return formatPrefix(specifier, value20);
      }
      case "":
      case "e":
      case "g":
      case "p":
      case "r": {
        if (specifier.precision == null && !isNaN(precision = precisionRound_default(step5, Math.max(Math.abs(start4), Math.abs(stop2))))) specifier.precision = precision - (specifier.type === "e");
        break;
      }
      case "f":
      case "%": {
        if (specifier.precision == null && !isNaN(precision = precisionFixed_default(step5))) specifier.precision = precision - (specifier.type === "%") * 2;
        break;
      }
    }
    return format(specifier);
  }

  // node_modules/d3-scale/src/linear.js
  function linearish(scale) {
    var domain2 = scale.domain;
    scale.ticks = function(count) {
      var d = domain2();
      return ticks(d[0], d[d.length - 1], count == null ? 10 : count);
    };
    scale.tickFormat = function(count, specifier) {
      var d = domain2();
      return tickFormat(d[0], d[d.length - 1], count == null ? 10 : count, specifier);
    };
    scale.nice = function(count) {
      if (count == null) count = 10;
      var d = domain2();
      var i0 = 0;
      var i1 = d.length - 1;
      var start4 = d[i0];
      var stop2 = d[i1];
      var prestep;
      var step5;
      var maxIter = 10;
      if (stop2 < start4) {
        step5 = start4, start4 = stop2, stop2 = step5;
        step5 = i0, i0 = i1, i1 = step5;
      }
      while (maxIter-- > 0) {
        step5 = tickIncrement(start4, stop2, count);
        if (step5 === prestep) {
          d[i0] = start4;
          d[i1] = stop2;
          return domain2(d);
        } else if (step5 > 0) {
          start4 = Math.floor(start4 / step5) * step5;
          stop2 = Math.ceil(stop2 / step5) * step5;
        } else if (step5 < 0) {
          start4 = Math.ceil(start4 * step5) / step5;
          stop2 = Math.floor(stop2 * step5) / step5;
        } else {
          break;
        }
        prestep = step5;
      }
      return scale;
    };
    return scale;
  }
  function linear3() {
    var scale = continuous();
    scale.copy = function() {
      return copy2(scale, linear3());
    };
    initRange.apply(scale, arguments);
    return linearish(scale);
  }

  // node_modules/d3-scale/src/nice.js
  function nice(domain2, interval2) {
    domain2 = domain2.slice();
    var i0 = 0, i1 = domain2.length - 1, x0 = domain2[i0], x113 = domain2[i1], t2;
    if (x113 < x0) {
      t2 = i0, i0 = i1, i1 = t2;
      t2 = x0, x0 = x113, x113 = t2;
    }
    domain2[i0] = interval2.floor(x0);
    domain2[i1] = interval2.ceil(x113);
    return domain2;
  }

  // node_modules/d3-scale/src/log.js
  function transformLog(x32) {
    return Math.log(x32);
  }
  function transformExp(x32) {
    return Math.exp(x32);
  }
  function transformLogn(x32) {
    return -Math.log(-x32);
  }
  function transformExpn(x32) {
    return -Math.exp(-x32);
  }
  function pow10(x32) {
    return isFinite(x32) ? +("1e" + x32) : x32 < 0 ? 0 : x32;
  }
  function powp(base3) {
    return base3 === 10 ? pow10 : base3 === Math.E ? Math.exp : (x32) => Math.pow(base3, x32);
  }
  function logp(base3) {
    return base3 === Math.E ? Math.log : base3 === 10 && Math.log10 || base3 === 2 && Math.log2 || (base3 = Math.log(base3), (x32) => Math.log(x32) / base3);
  }
  function reflect(f) {
    return (x32, k) => -f(-x32, k);
  }
  function loggish(transform17) {
    const scale = transform17(transformLog, transformExp);
    const domain2 = scale.domain;
    let base3 = 10;
    let logs;
    let pows;
    function rescale() {
      logs = logp(base3), pows = powp(base3);
      if (domain2()[0] < 0) {
        logs = reflect(logs), pows = reflect(pows);
        transform17(transformLogn, transformExpn);
      } else {
        transform17(transformLog, transformExp);
      }
      return scale;
    }
    scale.base = function(_) {
      return arguments.length ? (base3 = +_, rescale()) : base3;
    };
    scale.domain = function(_) {
      return arguments.length ? (domain2(_), rescale()) : domain2();
    };
    scale.ticks = (count) => {
      const d = domain2();
      let u2 = d[0];
      let v2 = d[d.length - 1];
      const r29 = v2 < u2;
      if (r29) [u2, v2] = [v2, u2];
      let i2 = logs(u2);
      let j = logs(v2);
      let k;
      let t2;
      const n = count == null ? 10 : +count;
      let z2 = [];
      if (!(base3 % 1) && j - i2 < n) {
        i2 = Math.floor(i2), j = Math.ceil(j);
        if (u2 > 0) for (; i2 <= j; ++i2) {
          for (k = 1; k < base3; ++k) {
            t2 = i2 < 0 ? k / pows(-i2) : k * pows(i2);
            if (t2 < u2) continue;
            if (t2 > v2) break;
            z2.push(t2);
          }
        }
        else for (; i2 <= j; ++i2) {
          for (k = base3 - 1; k >= 1; --k) {
            t2 = i2 > 0 ? k / pows(-i2) : k * pows(i2);
            if (t2 < u2) continue;
            if (t2 > v2) break;
            z2.push(t2);
          }
        }
        if (z2.length * 2 < n) z2 = ticks(u2, v2, n);
      } else {
        z2 = ticks(i2, j, Math.min(j - i2, n)).map(pows);
      }
      return r29 ? z2.reverse() : z2;
    };
    scale.tickFormat = (count, specifier) => {
      if (count == null) count = 10;
      if (specifier == null) specifier = base3 === 10 ? "s" : ",";
      if (typeof specifier !== "function") {
        if (!(base3 % 1) && (specifier = formatSpecifier(specifier)).precision == null) specifier.trim = true;
        specifier = format(specifier);
      }
      if (count === Infinity) return specifier;
      const k = Math.max(1, base3 * count / scale.ticks().length);
      return (d) => {
        let i2 = d / pows(Math.round(logs(d)));
        if (i2 * base3 < base3 - 0.5) i2 *= base3;
        return i2 <= k ? specifier(d) : "";
      };
    };
    scale.nice = () => {
      return domain2(nice(domain2(), {
        floor: (x32) => pows(Math.floor(logs(x32))),
        ceil: (x32) => pows(Math.ceil(logs(x32)))
      }));
    };
    return scale;
  }
  function log5() {
    const scale = loggish(transformer()).domain([1, 10]);
    scale.copy = () => copy2(scale, log5()).base(scale.base());
    initRange.apply(scale, arguments);
    return scale;
  }

  // node_modules/d3-scale/src/symlog.js
  function transformSymlog(c2) {
    return function(x32) {
      return Math.sign(x32) * Math.log1p(Math.abs(x32 / c2));
    };
  }
  function transformSymexp(c2) {
    return function(x32) {
      return Math.sign(x32) * Math.expm1(Math.abs(x32)) * c2;
    };
  }
  function symlogish(transform17) {
    var c2 = 1, scale = transform17(transformSymlog(c2), transformSymexp(c2));
    scale.constant = function(_) {
      return arguments.length ? transform17(transformSymlog(c2 = +_), transformSymexp(c2)) : c2;
    };
    return linearish(scale);
  }
  function symlog() {
    var scale = symlogish(transformer());
    scale.copy = function() {
      return copy2(scale, symlog()).constant(scale.constant());
    };
    return initRange.apply(scale, arguments);
  }

  // node_modules/d3-scale/src/pow.js
  function transformPow(exponent2) {
    return function(x32) {
      return x32 < 0 ? -Math.pow(-x32, exponent2) : Math.pow(x32, exponent2);
    };
  }
  function transformSqrt(x32) {
    return x32 < 0 ? -Math.sqrt(-x32) : Math.sqrt(x32);
  }
  function transformSquare(x32) {
    return x32 < 0 ? -x32 * x32 : x32 * x32;
  }
  function powish(transform17) {
    var scale = transform17(identity14, identity14), exponent2 = 1;
    function rescale() {
      return exponent2 === 1 ? transform17(identity14, identity14) : exponent2 === 0.5 ? transform17(transformSqrt, transformSquare) : transform17(transformPow(exponent2), transformPow(1 / exponent2));
    }
    scale.exponent = function(_) {
      return arguments.length ? (exponent2 = +_, rescale()) : exponent2;
    };
    return linearish(scale);
  }
  function pow3() {
    var scale = powish(transformer());
    scale.copy = function() {
      return copy2(scale, pow3()).exponent(scale.exponent());
    };
    initRange.apply(scale, arguments);
    return scale;
  }
  function sqrt3() {
    return pow3.apply(null, arguments).exponent(0.5);
  }

  // node_modules/d3-scale/src/quantile.js
  function quantile2() {
    var domain2 = [], range6 = [], thresholds = [], unknown;
    function rescale() {
      var i2 = 0, n = Math.max(1, range6.length);
      thresholds = new Array(n - 1);
      while (++i2 < n) thresholds[i2 - 1] = quantileSorted(domain2, i2 / n);
      return scale;
    }
    function scale(x32) {
      return x32 == null || isNaN(x32 = +x32) ? unknown : range6[bisect_default(thresholds, x32)];
    }
    scale.invertExtent = function(y32) {
      var i2 = range6.indexOf(y32);
      return i2 < 0 ? [NaN, NaN] : [
        i2 > 0 ? thresholds[i2 - 1] : domain2[0],
        i2 < thresholds.length ? thresholds[i2] : domain2[domain2.length - 1]
      ];
    };
    scale.domain = function(_) {
      if (!arguments.length) return domain2.slice();
      domain2 = [];
      for (let d of _) if (d != null && !isNaN(d = +d)) domain2.push(d);
      domain2.sort(ascending2);
      return rescale();
    };
    scale.range = function(_) {
      return arguments.length ? (range6 = Array.from(_), rescale()) : range6.slice();
    };
    scale.unknown = function(_) {
      return arguments.length ? (unknown = _, scale) : unknown;
    };
    scale.quantiles = function() {
      return thresholds.slice();
    };
    scale.copy = function() {
      return quantile2().domain(domain2).range(range6).unknown(unknown);
    };
    return initRange.apply(scale, arguments);
  }

  // node_modules/d3-scale/src/quantize.js
  function quantize() {
    var x0 = 0, x113 = 1, n = 1, domain2 = [0.5], range6 = [0, 1], unknown;
    function scale(x32) {
      return x32 != null && x32 <= x32 ? range6[bisect_default(domain2, x32, 0, n)] : unknown;
    }
    function rescale() {
      var i2 = -1;
      domain2 = new Array(n);
      while (++i2 < n) domain2[i2] = ((i2 + 1) * x113 - (i2 - n) * x0) / (n + 1);
      return scale;
    }
    scale.domain = function(_) {
      return arguments.length ? ([x0, x113] = _, x0 = +x0, x113 = +x113, rescale()) : [x0, x113];
    };
    scale.range = function(_) {
      return arguments.length ? (n = (range6 = Array.from(_)).length - 1, rescale()) : range6.slice();
    };
    scale.invertExtent = function(y32) {
      var i2 = range6.indexOf(y32);
      return i2 < 0 ? [NaN, NaN] : i2 < 1 ? [x0, domain2[0]] : i2 >= n ? [domain2[n - 1], x113] : [domain2[i2 - 1], domain2[i2]];
    };
    scale.unknown = function(_) {
      return arguments.length ? (unknown = _, scale) : scale;
    };
    scale.thresholds = function() {
      return domain2.slice();
    };
    scale.copy = function() {
      return quantize().domain([x0, x113]).range(range6).unknown(unknown);
    };
    return initRange.apply(linearish(scale), arguments);
  }

  // node_modules/d3-time/src/interval.js
  var t0 = /* @__PURE__ */ new Date();
  var t1 = /* @__PURE__ */ new Date();
  function newInterval(floori, offseti, count, field4) {
    function interval2(date2) {
      return floori(date2 = arguments.length === 0 ? /* @__PURE__ */ new Date() : /* @__PURE__ */ new Date(+date2)), date2;
    }
    interval2.floor = function(date2) {
      return floori(date2 = /* @__PURE__ */ new Date(+date2)), date2;
    };
    interval2.ceil = function(date2) {
      return floori(date2 = new Date(date2 - 1)), offseti(date2, 1), floori(date2), date2;
    };
    interval2.round = function(date2) {
      var d0 = interval2(date2), d1 = interval2.ceil(date2);
      return date2 - d0 < d1 - date2 ? d0 : d1;
    };
    interval2.offset = function(date2, step5) {
      return offseti(date2 = /* @__PURE__ */ new Date(+date2), step5 == null ? 1 : Math.floor(step5)), date2;
    };
    interval2.range = function(start4, stop2, step5) {
      var range6 = [], previous;
      start4 = interval2.ceil(start4);
      step5 = step5 == null ? 1 : Math.floor(step5);
      if (!(start4 < stop2) || !(step5 > 0)) return range6;
      do
        range6.push(previous = /* @__PURE__ */ new Date(+start4)), offseti(start4, step5), floori(start4);
      while (previous < start4 && start4 < stop2);
      return range6;
    };
    interval2.filter = function(test2) {
      return newInterval(function(date2) {
        if (date2 >= date2) while (floori(date2), !test2(date2)) date2.setTime(date2 - 1);
      }, function(date2, step5) {
        if (date2 >= date2) {
          if (step5 < 0) while (++step5 <= 0) {
            while (offseti(date2, -1), !test2(date2)) {
            }
          }
          else while (--step5 >= 0) {
            while (offseti(date2, 1), !test2(date2)) {
            }
          }
        }
      });
    };
    if (count) {
      interval2.count = function(start4, end2) {
        t0.setTime(+start4), t1.setTime(+end2);
        floori(t0), floori(t1);
        return Math.floor(count(t0, t1));
      };
      interval2.every = function(step5) {
        step5 = Math.floor(step5);
        return !isFinite(step5) || !(step5 > 0) ? null : !(step5 > 1) ? interval2 : interval2.filter(field4 ? function(d) {
          return field4(d) % step5 === 0;
        } : function(d) {
          return interval2.count(0, d) % step5 === 0;
        });
      };
    }
    return interval2;
  }

  // node_modules/d3-time/src/millisecond.js
  var millisecond = newInterval(function() {
  }, function(date2, step5) {
    date2.setTime(+date2 + step5);
  }, function(start4, end2) {
    return end2 - start4;
  });
  millisecond.every = function(k) {
    k = Math.floor(k);
    if (!isFinite(k) || !(k > 0)) return null;
    if (!(k > 1)) return millisecond;
    return newInterval(function(date2) {
      date2.setTime(Math.floor(date2 / k) * k);
    }, function(date2, step5) {
      date2.setTime(+date2 + step5 * k);
    }, function(start4, end2) {
      return (end2 - start4) / k;
    });
  };
  var millisecond_default = millisecond;
  var milliseconds = millisecond.range;

  // node_modules/d3-time/src/duration.js
  var durationSecond = 1e3;
  var durationMinute = durationSecond * 60;
  var durationHour = durationMinute * 60;
  var durationDay = durationHour * 24;
  var durationWeek = durationDay * 7;
  var durationMonth = durationDay * 30;
  var durationYear = durationDay * 365;

  // node_modules/d3-time/src/second.js
  var second = newInterval(function(date2) {
    date2.setTime(date2 - date2.getMilliseconds());
  }, function(date2, step5) {
    date2.setTime(+date2 + step5 * durationSecond);
  }, function(start4, end2) {
    return (end2 - start4) / durationSecond;
  }, function(date2) {
    return date2.getUTCSeconds();
  });
  var second_default = second;
  var seconds = second.range;

  // node_modules/d3-time/src/minute.js
  var minute = newInterval(function(date2) {
    date2.setTime(date2 - date2.getMilliseconds() - date2.getSeconds() * durationSecond);
  }, function(date2, step5) {
    date2.setTime(+date2 + step5 * durationMinute);
  }, function(start4, end2) {
    return (end2 - start4) / durationMinute;
  }, function(date2) {
    return date2.getMinutes();
  });
  var minute_default = minute;
  var minutes = minute.range;

  // node_modules/d3-time/src/hour.js
  var hour = newInterval(function(date2) {
    date2.setTime(date2 - date2.getMilliseconds() - date2.getSeconds() * durationSecond - date2.getMinutes() * durationMinute);
  }, function(date2, step5) {
    date2.setTime(+date2 + step5 * durationHour);
  }, function(start4, end2) {
    return (end2 - start4) / durationHour;
  }, function(date2) {
    return date2.getHours();
  });
  var hour_default = hour;
  var hours = hour.range;

  // node_modules/d3-time/src/day.js
  var day = newInterval(
    (date2) => date2.setHours(0, 0, 0, 0),
    (date2, step5) => date2.setDate(date2.getDate() + step5),
    (start4, end2) => (end2 - start4 - (end2.getTimezoneOffset() - start4.getTimezoneOffset()) * durationMinute) / durationDay,
    (date2) => date2.getDate() - 1
  );
  var day_default = day;
  var days = day.range;

  // node_modules/d3-time/src/week.js
  function weekday(i2) {
    return newInterval(function(date2) {
      date2.setDate(date2.getDate() - (date2.getDay() + 7 - i2) % 7);
      date2.setHours(0, 0, 0, 0);
    }, function(date2, step5) {
      date2.setDate(date2.getDate() + step5 * 7);
    }, function(start4, end2) {
      return (end2 - start4 - (end2.getTimezoneOffset() - start4.getTimezoneOffset()) * durationMinute) / durationWeek;
    });
  }
  var sunday = weekday(0);
  var monday = weekday(1);
  var tuesday = weekday(2);
  var wednesday = weekday(3);
  var thursday = weekday(4);
  var friday = weekday(5);
  var saturday = weekday(6);
  var sundays = sunday.range;
  var mondays = monday.range;
  var tuesdays = tuesday.range;
  var wednesdays = wednesday.range;
  var thursdays = thursday.range;
  var fridays = friday.range;
  var saturdays = saturday.range;

  // node_modules/d3-time/src/month.js
  var month = newInterval(function(date2) {
    date2.setDate(1);
    date2.setHours(0, 0, 0, 0);
  }, function(date2, step5) {
    date2.setMonth(date2.getMonth() + step5);
  }, function(start4, end2) {
    return end2.getMonth() - start4.getMonth() + (end2.getFullYear() - start4.getFullYear()) * 12;
  }, function(date2) {
    return date2.getMonth();
  });
  var month_default = month;
  var months = month.range;

  // node_modules/d3-time/src/year.js
  var year = newInterval(function(date2) {
    date2.setMonth(0, 1);
    date2.setHours(0, 0, 0, 0);
  }, function(date2, step5) {
    date2.setFullYear(date2.getFullYear() + step5);
  }, function(start4, end2) {
    return end2.getFullYear() - start4.getFullYear();
  }, function(date2) {
    return date2.getFullYear();
  });
  year.every = function(k) {
    return !isFinite(k = Math.floor(k)) || !(k > 0) ? null : newInterval(function(date2) {
      date2.setFullYear(Math.floor(date2.getFullYear() / k) * k);
      date2.setMonth(0, 1);
      date2.setHours(0, 0, 0, 0);
    }, function(date2, step5) {
      date2.setFullYear(date2.getFullYear() + step5 * k);
    });
  };
  var year_default = year;
  var years = year.range;

  // node_modules/d3-time/src/utcMinute.js
  var utcMinute = newInterval(function(date2) {
    date2.setUTCSeconds(0, 0);
  }, function(date2, step5) {
    date2.setTime(+date2 + step5 * durationMinute);
  }, function(start4, end2) {
    return (end2 - start4) / durationMinute;
  }, function(date2) {
    return date2.getUTCMinutes();
  });
  var utcMinute_default = utcMinute;
  var utcMinutes = utcMinute.range;

  // node_modules/d3-time/src/utcHour.js
  var utcHour = newInterval(function(date2) {
    date2.setUTCMinutes(0, 0, 0);
  }, function(date2, step5) {
    date2.setTime(+date2 + step5 * durationHour);
  }, function(start4, end2) {
    return (end2 - start4) / durationHour;
  }, function(date2) {
    return date2.getUTCHours();
  });
  var utcHour_default = utcHour;
  var utcHours = utcHour.range;

  // node_modules/d3-time/src/utcDay.js
  var utcDay = newInterval(function(date2) {
    date2.setUTCHours(0, 0, 0, 0);
  }, function(date2, step5) {
    date2.setUTCDate(date2.getUTCDate() + step5);
  }, function(start4, end2) {
    return (end2 - start4) / durationDay;
  }, function(date2) {
    return date2.getUTCDate() - 1;
  });
  var utcDay_default = utcDay;
  var utcDays = utcDay.range;

  // node_modules/d3-time/src/utcWeek.js
  function utcWeekday(i2) {
    return newInterval(function(date2) {
      date2.setUTCDate(date2.getUTCDate() - (date2.getUTCDay() + 7 - i2) % 7);
      date2.setUTCHours(0, 0, 0, 0);
    }, function(date2, step5) {
      date2.setUTCDate(date2.getUTCDate() + step5 * 7);
    }, function(start4, end2) {
      return (end2 - start4) / durationWeek;
    });
  }
  var utcSunday = utcWeekday(0);
  var utcMonday = utcWeekday(1);
  var utcTuesday = utcWeekday(2);
  var utcWednesday = utcWeekday(3);
  var utcThursday = utcWeekday(4);
  var utcFriday = utcWeekday(5);
  var utcSaturday = utcWeekday(6);
  var utcSundays = utcSunday.range;
  var utcMondays = utcMonday.range;
  var utcTuesdays = utcTuesday.range;
  var utcWednesdays = utcWednesday.range;
  var utcThursdays = utcThursday.range;
  var utcFridays = utcFriday.range;
  var utcSaturdays = utcSaturday.range;

  // node_modules/d3-time/src/utcMonth.js
  var utcMonth = newInterval(function(date2) {
    date2.setUTCDate(1);
    date2.setUTCHours(0, 0, 0, 0);
  }, function(date2, step5) {
    date2.setUTCMonth(date2.getUTCMonth() + step5);
  }, function(start4, end2) {
    return end2.getUTCMonth() - start4.getUTCMonth() + (end2.getUTCFullYear() - start4.getUTCFullYear()) * 12;
  }, function(date2) {
    return date2.getUTCMonth();
  });
  var utcMonth_default = utcMonth;
  var utcMonths = utcMonth.range;

  // node_modules/d3-time/src/utcYear.js
  var utcYear = newInterval(function(date2) {
    date2.setUTCMonth(0, 1);
    date2.setUTCHours(0, 0, 0, 0);
  }, function(date2, step5) {
    date2.setUTCFullYear(date2.getUTCFullYear() + step5);
  }, function(start4, end2) {
    return end2.getUTCFullYear() - start4.getUTCFullYear();
  }, function(date2) {
    return date2.getUTCFullYear();
  });
  utcYear.every = function(k) {
    return !isFinite(k = Math.floor(k)) || !(k > 0) ? null : newInterval(function(date2) {
      date2.setUTCFullYear(Math.floor(date2.getUTCFullYear() / k) * k);
      date2.setUTCMonth(0, 1);
      date2.setUTCHours(0, 0, 0, 0);
    }, function(date2, step5) {
      date2.setUTCFullYear(date2.getUTCFullYear() + step5 * k);
    });
  };
  var utcYear_default = utcYear;
  var utcYears = utcYear.range;

  // node_modules/d3-time/src/ticks.js
  function ticker(year2, month2, week, day2, hour2, minute2) {
    const tickIntervals = [
      [second_default, 1, durationSecond],
      [second_default, 5, 5 * durationSecond],
      [second_default, 15, 15 * durationSecond],
      [second_default, 30, 30 * durationSecond],
      [minute2, 1, durationMinute],
      [minute2, 5, 5 * durationMinute],
      [minute2, 15, 15 * durationMinute],
      [minute2, 30, 30 * durationMinute],
      [hour2, 1, durationHour],
      [hour2, 3, 3 * durationHour],
      [hour2, 6, 6 * durationHour],
      [hour2, 12, 12 * durationHour],
      [day2, 1, durationDay],
      [day2, 2, 2 * durationDay],
      [week, 1, durationWeek],
      [month2, 1, durationMonth],
      [month2, 3, 3 * durationMonth],
      [year2, 1, durationYear]
    ];
    function ticks3(start4, stop2, count) {
      const reverse3 = stop2 < start4;
      if (reverse3) [start4, stop2] = [stop2, start4];
      const interval2 = count && typeof count.range === "function" ? count : tickInterval(start4, stop2, count);
      const ticks4 = interval2 ? interval2.range(start4, +stop2 + 1) : [];
      return reverse3 ? ticks4.reverse() : ticks4;
    }
    function tickInterval(start4, stop2, count) {
      const target7 = Math.abs(stop2 - start4) / count;
      const i2 = bisector(([, , step6]) => step6).right(tickIntervals, target7);
      if (i2 === tickIntervals.length) return year2.every(tickStep(start4 / durationYear, stop2 / durationYear, count));
      if (i2 === 0) return millisecond_default.every(Math.max(tickStep(start4, stop2, count), 1));
      const [t2, step5] = tickIntervals[target7 / tickIntervals[i2 - 1][2] < tickIntervals[i2][2] / target7 ? i2 - 1 : i2];
      return t2.every(step5);
    }
    return [ticks3, tickInterval];
  }
  var [utcTicks, utcTickInterval] = ticker(utcYear_default, utcMonth_default, utcSunday, utcDay_default, utcHour_default, utcMinute_default);
  var [timeTicks, timeTickInterval] = ticker(year_default, month_default, sunday, day_default, hour_default, minute_default);

  // node_modules/d3-time-format/src/locale.js
  function localDate(d) {
    if (0 <= d.y && d.y < 100) {
      var date2 = new Date(-1, d.m, d.d, d.H, d.M, d.S, d.L);
      date2.setFullYear(d.y);
      return date2;
    }
    return new Date(d.y, d.m, d.d, d.H, d.M, d.S, d.L);
  }
  function utcDate(d) {
    if (0 <= d.y && d.y < 100) {
      var date2 = new Date(Date.UTC(-1, d.m, d.d, d.H, d.M, d.S, d.L));
      date2.setUTCFullYear(d.y);
      return date2;
    }
    return new Date(Date.UTC(d.y, d.m, d.d, d.H, d.M, d.S, d.L));
  }
  function newDate(y32, m2, d) {
    return { y: y32, m: m2, d, H: 0, M: 0, S: 0, L: 0 };
  }
  function formatLocale(locale3) {
    var locale_dateTime = locale3.dateTime, locale_date = locale3.date, locale_time = locale3.time, locale_periods = locale3.periods, locale_weekdays = locale3.days, locale_shortWeekdays = locale3.shortDays, locale_months = locale3.months, locale_shortMonths = locale3.shortMonths;
    var periodRe = formatRe(locale_periods), periodLookup = formatLookup(locale_periods), weekdayRe = formatRe(locale_weekdays), weekdayLookup = formatLookup(locale_weekdays), shortWeekdayRe = formatRe(locale_shortWeekdays), shortWeekdayLookup = formatLookup(locale_shortWeekdays), monthRe = formatRe(locale_months), monthLookup = formatLookup(locale_months), shortMonthRe = formatRe(locale_shortMonths), shortMonthLookup = formatLookup(locale_shortMonths);
    var formats = {
      "a": formatShortWeekday,
      "A": formatWeekday,
      "b": formatShortMonth,
      "B": formatMonth,
      "c": null,
      "d": formatDayOfMonth,
      "e": formatDayOfMonth,
      "f": formatMicroseconds,
      "g": formatYearISO,
      "G": formatFullYearISO,
      "H": formatHour24,
      "I": formatHour12,
      "j": formatDayOfYear,
      "L": formatMilliseconds,
      "m": formatMonthNumber,
      "M": formatMinutes,
      "p": formatPeriod,
      "q": formatQuarter,
      "Q": formatUnixTimestamp,
      "s": formatUnixTimestampSeconds,
      "S": formatSeconds,
      "u": formatWeekdayNumberMonday,
      "U": formatWeekNumberSunday,
      "V": formatWeekNumberISO,
      "w": formatWeekdayNumberSunday,
      "W": formatWeekNumberMonday,
      "x": null,
      "X": null,
      "y": formatYear,
      "Y": formatFullYear,
      "Z": formatZone,
      "%": formatLiteralPercent
    };
    var utcFormats = {
      "a": formatUTCShortWeekday,
      "A": formatUTCWeekday,
      "b": formatUTCShortMonth,
      "B": formatUTCMonth,
      "c": null,
      "d": formatUTCDayOfMonth,
      "e": formatUTCDayOfMonth,
      "f": formatUTCMicroseconds,
      "g": formatUTCYearISO,
      "G": formatUTCFullYearISO,
      "H": formatUTCHour24,
      "I": formatUTCHour12,
      "j": formatUTCDayOfYear,
      "L": formatUTCMilliseconds,
      "m": formatUTCMonthNumber,
      "M": formatUTCMinutes,
      "p": formatUTCPeriod,
      "q": formatUTCQuarter,
      "Q": formatUnixTimestamp,
      "s": formatUnixTimestampSeconds,
      "S": formatUTCSeconds,
      "u": formatUTCWeekdayNumberMonday,
      "U": formatUTCWeekNumberSunday,
      "V": formatUTCWeekNumberISO,
      "w": formatUTCWeekdayNumberSunday,
      "W": formatUTCWeekNumberMonday,
      "x": null,
      "X": null,
      "y": formatUTCYear,
      "Y": formatUTCFullYear,
      "Z": formatUTCZone,
      "%": formatLiteralPercent
    };
    var parses = {
      "a": parseShortWeekday,
      "A": parseWeekday,
      "b": parseShortMonth,
      "B": parseMonth,
      "c": parseLocaleDateTime,
      "d": parseDayOfMonth,
      "e": parseDayOfMonth,
      "f": parseMicroseconds,
      "g": parseYear,
      "G": parseFullYear,
      "H": parseHour24,
      "I": parseHour24,
      "j": parseDayOfYear,
      "L": parseMilliseconds,
      "m": parseMonthNumber,
      "M": parseMinutes,
      "p": parsePeriod,
      "q": parseQuarter,
      "Q": parseUnixTimestamp,
      "s": parseUnixTimestampSeconds,
      "S": parseSeconds,
      "u": parseWeekdayNumberMonday,
      "U": parseWeekNumberSunday,
      "V": parseWeekNumberISO,
      "w": parseWeekdayNumberSunday,
      "W": parseWeekNumberMonday,
      "x": parseLocaleDate,
      "X": parseLocaleTime,
      "y": parseYear,
      "Y": parseFullYear,
      "Z": parseZone,
      "%": parseLiteralPercent
    };
    formats.x = newFormat(locale_date, formats);
    formats.X = newFormat(locale_time, formats);
    formats.c = newFormat(locale_dateTime, formats);
    utcFormats.x = newFormat(locale_date, utcFormats);
    utcFormats.X = newFormat(locale_time, utcFormats);
    utcFormats.c = newFormat(locale_dateTime, utcFormats);
    function newFormat(specifier, formats2) {
      return function(date2) {
        var string2 = [], i2 = -1, j = 0, n = specifier.length, c2, pad2, format2;
        if (!(date2 instanceof Date)) date2 = /* @__PURE__ */ new Date(+date2);
        while (++i2 < n) {
          if (specifier.charCodeAt(i2) === 37) {
            string2.push(specifier.slice(j, i2));
            if ((pad2 = pads[c2 = specifier.charAt(++i2)]) != null) c2 = specifier.charAt(++i2);
            else pad2 = c2 === "e" ? " " : "0";
            if (format2 = formats2[c2]) c2 = format2(date2, pad2);
            string2.push(c2);
            j = i2 + 1;
          }
        }
        string2.push(specifier.slice(j, i2));
        return string2.join("");
      };
    }
    function newParse(specifier, Z) {
      return function(string2) {
        var d = newDate(1900, void 0, 1), i2 = parseSpecifier(d, specifier, string2 += "", 0), week, day2;
        if (i2 != string2.length) return null;
        if ("Q" in d) return new Date(d.Q);
        if ("s" in d) return new Date(d.s * 1e3 + ("L" in d ? d.L : 0));
        if (Z && !("Z" in d)) d.Z = 0;
        if ("p" in d) d.H = d.H % 12 + d.p * 12;
        if (d.m === void 0) d.m = "q" in d ? d.q : 0;
        if ("V" in d) {
          if (d.V < 1 || d.V > 53) return null;
          if (!("w" in d)) d.w = 1;
          if ("Z" in d) {
            week = utcDate(newDate(d.y, 0, 1)), day2 = week.getUTCDay();
            week = day2 > 4 || day2 === 0 ? utcMonday.ceil(week) : utcMonday(week);
            week = utcDay_default.offset(week, (d.V - 1) * 7);
            d.y = week.getUTCFullYear();
            d.m = week.getUTCMonth();
            d.d = week.getUTCDate() + (d.w + 6) % 7;
          } else {
            week = localDate(newDate(d.y, 0, 1)), day2 = week.getDay();
            week = day2 > 4 || day2 === 0 ? monday.ceil(week) : monday(week);
            week = day_default.offset(week, (d.V - 1) * 7);
            d.y = week.getFullYear();
            d.m = week.getMonth();
            d.d = week.getDate() + (d.w + 6) % 7;
          }
        } else if ("W" in d || "U" in d) {
          if (!("w" in d)) d.w = "u" in d ? d.u % 7 : "W" in d ? 1 : 0;
          day2 = "Z" in d ? utcDate(newDate(d.y, 0, 1)).getUTCDay() : localDate(newDate(d.y, 0, 1)).getDay();
          d.m = 0;
          d.d = "W" in d ? (d.w + 6) % 7 + d.W * 7 - (day2 + 5) % 7 : d.w + d.U * 7 - (day2 + 6) % 7;
        }
        if ("Z" in d) {
          d.H += d.Z / 100 | 0;
          d.M += d.Z % 100;
          return utcDate(d);
        }
        return localDate(d);
      };
    }
    function parseSpecifier(d, specifier, string2, j) {
      var i2 = 0, n = specifier.length, m2 = string2.length, c2, parse9;
      while (i2 < n) {
        if (j >= m2) return -1;
        c2 = specifier.charCodeAt(i2++);
        if (c2 === 37) {
          c2 = specifier.charAt(i2++);
          parse9 = parses[c2 in pads ? specifier.charAt(i2++) : c2];
          if (!parse9 || (j = parse9(d, string2, j)) < 0) return -1;
        } else if (c2 != string2.charCodeAt(j++)) {
          return -1;
        }
      }
      return j;
    }
    function parsePeriod(d, string2, i2) {
      var n = periodRe.exec(string2.slice(i2));
      return n ? (d.p = periodLookup.get(n[0].toLowerCase()), i2 + n[0].length) : -1;
    }
    function parseShortWeekday(d, string2, i2) {
      var n = shortWeekdayRe.exec(string2.slice(i2));
      return n ? (d.w = shortWeekdayLookup.get(n[0].toLowerCase()), i2 + n[0].length) : -1;
    }
    function parseWeekday(d, string2, i2) {
      var n = weekdayRe.exec(string2.slice(i2));
      return n ? (d.w = weekdayLookup.get(n[0].toLowerCase()), i2 + n[0].length) : -1;
    }
    function parseShortMonth(d, string2, i2) {
      var n = shortMonthRe.exec(string2.slice(i2));
      return n ? (d.m = shortMonthLookup.get(n[0].toLowerCase()), i2 + n[0].length) : -1;
    }
    function parseMonth(d, string2, i2) {
      var n = monthRe.exec(string2.slice(i2));
      return n ? (d.m = monthLookup.get(n[0].toLowerCase()), i2 + n[0].length) : -1;
    }
    function parseLocaleDateTime(d, string2, i2) {
      return parseSpecifier(d, locale_dateTime, string2, i2);
    }
    function parseLocaleDate(d, string2, i2) {
      return parseSpecifier(d, locale_date, string2, i2);
    }
    function parseLocaleTime(d, string2, i2) {
      return parseSpecifier(d, locale_time, string2, i2);
    }
    function formatShortWeekday(d) {
      return locale_shortWeekdays[d.getDay()];
    }
    function formatWeekday(d) {
      return locale_weekdays[d.getDay()];
    }
    function formatShortMonth(d) {
      return locale_shortMonths[d.getMonth()];
    }
    function formatMonth(d) {
      return locale_months[d.getMonth()];
    }
    function formatPeriod(d) {
      return locale_periods[+(d.getHours() >= 12)];
    }
    function formatQuarter(d) {
      return 1 + ~~(d.getMonth() / 3);
    }
    function formatUTCShortWeekday(d) {
      return locale_shortWeekdays[d.getUTCDay()];
    }
    function formatUTCWeekday(d) {
      return locale_weekdays[d.getUTCDay()];
    }
    function formatUTCShortMonth(d) {
      return locale_shortMonths[d.getUTCMonth()];
    }
    function formatUTCMonth(d) {
      return locale_months[d.getUTCMonth()];
    }
    function formatUTCPeriod(d) {
      return locale_periods[+(d.getUTCHours() >= 12)];
    }
    function formatUTCQuarter(d) {
      return 1 + ~~(d.getUTCMonth() / 3);
    }
    return {
      format: function(specifier) {
        var f = newFormat(specifier += "", formats);
        f.toString = function() {
          return specifier;
        };
        return f;
      },
      parse: function(specifier) {
        var p2 = newParse(specifier += "", false);
        p2.toString = function() {
          return specifier;
        };
        return p2;
      },
      utcFormat: function(specifier) {
        var f = newFormat(specifier += "", utcFormats);
        f.toString = function() {
          return specifier;
        };
        return f;
      },
      utcParse: function(specifier) {
        var p2 = newParse(specifier += "", true);
        p2.toString = function() {
          return specifier;
        };
        return p2;
      }
    };
  }
  var pads = { "-": "", "_": " ", "0": "0" };
  var numberRe = /^\s*\d+/;
  var percentRe = /^%/;
  var requoteRe = /[\\^$*+?|[\]().{}]/g;
  function pad(value20, fill41, width47) {
    var sign2 = value20 < 0 ? "-" : "", string2 = (sign2 ? -value20 : value20) + "", length10 = string2.length;
    return sign2 + (length10 < width47 ? new Array(width47 - length10 + 1).join(fill41) + string2 : string2);
  }
  function requote(s3) {
    return s3.replace(requoteRe, "\\$&");
  }
  function formatRe(names) {
    return new RegExp("^(?:" + names.map(requote).join("|") + ")", "i");
  }
  function formatLookup(names) {
    return new Map(names.map((name16, i2) => [name16.toLowerCase(), i2]));
  }
  function parseWeekdayNumberSunday(d, string2, i2) {
    var n = numberRe.exec(string2.slice(i2, i2 + 1));
    return n ? (d.w = +n[0], i2 + n[0].length) : -1;
  }
  function parseWeekdayNumberMonday(d, string2, i2) {
    var n = numberRe.exec(string2.slice(i2, i2 + 1));
    return n ? (d.u = +n[0], i2 + n[0].length) : -1;
  }
  function parseWeekNumberSunday(d, string2, i2) {
    var n = numberRe.exec(string2.slice(i2, i2 + 2));
    return n ? (d.U = +n[0], i2 + n[0].length) : -1;
  }
  function parseWeekNumberISO(d, string2, i2) {
    var n = numberRe.exec(string2.slice(i2, i2 + 2));
    return n ? (d.V = +n[0], i2 + n[0].length) : -1;
  }
  function parseWeekNumberMonday(d, string2, i2) {
    var n = numberRe.exec(string2.slice(i2, i2 + 2));
    return n ? (d.W = +n[0], i2 + n[0].length) : -1;
  }
  function parseFullYear(d, string2, i2) {
    var n = numberRe.exec(string2.slice(i2, i2 + 4));
    return n ? (d.y = +n[0], i2 + n[0].length) : -1;
  }
  function parseYear(d, string2, i2) {
    var n = numberRe.exec(string2.slice(i2, i2 + 2));
    return n ? (d.y = +n[0] + (+n[0] > 68 ? 1900 : 2e3), i2 + n[0].length) : -1;
  }
  function parseZone(d, string2, i2) {
    var n = /^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(string2.slice(i2, i2 + 6));
    return n ? (d.Z = n[1] ? 0 : -(n[2] + (n[3] || "00")), i2 + n[0].length) : -1;
  }
  function parseQuarter(d, string2, i2) {
    var n = numberRe.exec(string2.slice(i2, i2 + 1));
    return n ? (d.q = n[0] * 3 - 3, i2 + n[0].length) : -1;
  }
  function parseMonthNumber(d, string2, i2) {
    var n = numberRe.exec(string2.slice(i2, i2 + 2));
    return n ? (d.m = n[0] - 1, i2 + n[0].length) : -1;
  }
  function parseDayOfMonth(d, string2, i2) {
    var n = numberRe.exec(string2.slice(i2, i2 + 2));
    return n ? (d.d = +n[0], i2 + n[0].length) : -1;
  }
  function parseDayOfYear(d, string2, i2) {
    var n = numberRe.exec(string2.slice(i2, i2 + 3));
    return n ? (d.m = 0, d.d = +n[0], i2 + n[0].length) : -1;
  }
  function parseHour24(d, string2, i2) {
    var n = numberRe.exec(string2.slice(i2, i2 + 2));
    return n ? (d.H = +n[0], i2 + n[0].length) : -1;
  }
  function parseMinutes(d, string2, i2) {
    var n = numberRe.exec(string2.slice(i2, i2 + 2));
    return n ? (d.M = +n[0], i2 + n[0].length) : -1;
  }
  function parseSeconds(d, string2, i2) {
    var n = numberRe.exec(string2.slice(i2, i2 + 2));
    return n ? (d.S = +n[0], i2 + n[0].length) : -1;
  }
  function parseMilliseconds(d, string2, i2) {
    var n = numberRe.exec(string2.slice(i2, i2 + 3));
    return n ? (d.L = +n[0], i2 + n[0].length) : -1;
  }
  function parseMicroseconds(d, string2, i2) {
    var n = numberRe.exec(string2.slice(i2, i2 + 6));
    return n ? (d.L = Math.floor(n[0] / 1e3), i2 + n[0].length) : -1;
  }
  function parseLiteralPercent(d, string2, i2) {
    var n = percentRe.exec(string2.slice(i2, i2 + 1));
    return n ? i2 + n[0].length : -1;
  }
  function parseUnixTimestamp(d, string2, i2) {
    var n = numberRe.exec(string2.slice(i2));
    return n ? (d.Q = +n[0], i2 + n[0].length) : -1;
  }
  function parseUnixTimestampSeconds(d, string2, i2) {
    var n = numberRe.exec(string2.slice(i2));
    return n ? (d.s = +n[0], i2 + n[0].length) : -1;
  }
  function formatDayOfMonth(d, p2) {
    return pad(d.getDate(), p2, 2);
  }
  function formatHour24(d, p2) {
    return pad(d.getHours(), p2, 2);
  }
  function formatHour12(d, p2) {
    return pad(d.getHours() % 12 || 12, p2, 2);
  }
  function formatDayOfYear(d, p2) {
    return pad(1 + day_default.count(year_default(d), d), p2, 3);
  }
  function formatMilliseconds(d, p2) {
    return pad(d.getMilliseconds(), p2, 3);
  }
  function formatMicroseconds(d, p2) {
    return formatMilliseconds(d, p2) + "000";
  }
  function formatMonthNumber(d, p2) {
    return pad(d.getMonth() + 1, p2, 2);
  }
  function formatMinutes(d, p2) {
    return pad(d.getMinutes(), p2, 2);
  }
  function formatSeconds(d, p2) {
    return pad(d.getSeconds(), p2, 2);
  }
  function formatWeekdayNumberMonday(d) {
    var day2 = d.getDay();
    return day2 === 0 ? 7 : day2;
  }
  function formatWeekNumberSunday(d, p2) {
    return pad(sunday.count(year_default(d) - 1, d), p2, 2);
  }
  function dISO(d) {
    var day2 = d.getDay();
    return day2 >= 4 || day2 === 0 ? thursday(d) : thursday.ceil(d);
  }
  function formatWeekNumberISO(d, p2) {
    d = dISO(d);
    return pad(thursday.count(year_default(d), d) + (year_default(d).getDay() === 4), p2, 2);
  }
  function formatWeekdayNumberSunday(d) {
    return d.getDay();
  }
  function formatWeekNumberMonday(d, p2) {
    return pad(monday.count(year_default(d) - 1, d), p2, 2);
  }
  function formatYear(d, p2) {
    return pad(d.getFullYear() % 100, p2, 2);
  }
  function formatYearISO(d, p2) {
    d = dISO(d);
    return pad(d.getFullYear() % 100, p2, 2);
  }
  function formatFullYear(d, p2) {
    return pad(d.getFullYear() % 1e4, p2, 4);
  }
  function formatFullYearISO(d, p2) {
    var day2 = d.getDay();
    d = day2 >= 4 || day2 === 0 ? thursday(d) : thursday.ceil(d);
    return pad(d.getFullYear() % 1e4, p2, 4);
  }
  function formatZone(d) {
    var z2 = d.getTimezoneOffset();
    return (z2 > 0 ? "-" : (z2 *= -1, "+")) + pad(z2 / 60 | 0, "0", 2) + pad(z2 % 60, "0", 2);
  }
  function formatUTCDayOfMonth(d, p2) {
    return pad(d.getUTCDate(), p2, 2);
  }
  function formatUTCHour24(d, p2) {
    return pad(d.getUTCHours(), p2, 2);
  }
  function formatUTCHour12(d, p2) {
    return pad(d.getUTCHours() % 12 || 12, p2, 2);
  }
  function formatUTCDayOfYear(d, p2) {
    return pad(1 + utcDay_default.count(utcYear_default(d), d), p2, 3);
  }
  function formatUTCMilliseconds(d, p2) {
    return pad(d.getUTCMilliseconds(), p2, 3);
  }
  function formatUTCMicroseconds(d, p2) {
    return formatUTCMilliseconds(d, p2) + "000";
  }
  function formatUTCMonthNumber(d, p2) {
    return pad(d.getUTCMonth() + 1, p2, 2);
  }
  function formatUTCMinutes(d, p2) {
    return pad(d.getUTCMinutes(), p2, 2);
  }
  function formatUTCSeconds(d, p2) {
    return pad(d.getUTCSeconds(), p2, 2);
  }
  function formatUTCWeekdayNumberMonday(d) {
    var dow = d.getUTCDay();
    return dow === 0 ? 7 : dow;
  }
  function formatUTCWeekNumberSunday(d, p2) {
    return pad(utcSunday.count(utcYear_default(d) - 1, d), p2, 2);
  }
  function UTCdISO(d) {
    var day2 = d.getUTCDay();
    return day2 >= 4 || day2 === 0 ? utcThursday(d) : utcThursday.ceil(d);
  }
  function formatUTCWeekNumberISO(d, p2) {
    d = UTCdISO(d);
    return pad(utcThursday.count(utcYear_default(d), d) + (utcYear_default(d).getUTCDay() === 4), p2, 2);
  }
  function formatUTCWeekdayNumberSunday(d) {
    return d.getUTCDay();
  }
  function formatUTCWeekNumberMonday(d, p2) {
    return pad(utcMonday.count(utcYear_default(d) - 1, d), p2, 2);
  }
  function formatUTCYear(d, p2) {
    return pad(d.getUTCFullYear() % 100, p2, 2);
  }
  function formatUTCYearISO(d, p2) {
    d = UTCdISO(d);
    return pad(d.getUTCFullYear() % 100, p2, 2);
  }
  function formatUTCFullYear(d, p2) {
    return pad(d.getUTCFullYear() % 1e4, p2, 4);
  }
  function formatUTCFullYearISO(d, p2) {
    var day2 = d.getUTCDay();
    d = day2 >= 4 || day2 === 0 ? utcThursday(d) : utcThursday.ceil(d);
    return pad(d.getUTCFullYear() % 1e4, p2, 4);
  }
  function formatUTCZone() {
    return "+0000";
  }
  function formatLiteralPercent() {
    return "%";
  }
  function formatUnixTimestamp(d) {
    return +d;
  }
  function formatUnixTimestampSeconds(d) {
    return Math.floor(+d / 1e3);
  }

  // node_modules/d3-time-format/src/defaultLocale.js
  var locale2;
  var timeFormat;
  var timeParse;
  var utcFormat;
  var utcParse;
  defaultLocale2({
    dateTime: "%x, %X",
    date: "%-m/%-d/%Y",
    time: "%-I:%M:%S %p",
    periods: ["AM", "PM"],
    days: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
    shortDays: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
    months: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
    shortMonths: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]
  });
  function defaultLocale2(definition) {
    locale2 = formatLocale(definition);
    timeFormat = locale2.format;
    timeParse = locale2.parse;
    utcFormat = locale2.utcFormat;
    utcParse = locale2.utcParse;
    return locale2;
  }

  // node_modules/d3-scale/src/time.js
  function date(t2) {
    return new Date(t2);
  }
  function number3(t2) {
    return t2 instanceof Date ? +t2 : +/* @__PURE__ */ new Date(+t2);
  }
  function calendar(ticks3, tickInterval, year2, month2, week, day2, hour2, minute2, second2, format2) {
    var scale = continuous(), invert2 = scale.invert, domain2 = scale.domain;
    var formatMillisecond = format2(".%L"), formatSecond = format2(":%S"), formatMinute = format2("%I:%M"), formatHour = format2("%I %p"), formatDay = format2("%a %d"), formatWeek = format2("%b %d"), formatMonth = format2("%B"), formatYear2 = format2("%Y");
    function tickFormat3(date2) {
      return (second2(date2) < date2 ? formatMillisecond : minute2(date2) < date2 ? formatSecond : hour2(date2) < date2 ? formatMinute : day2(date2) < date2 ? formatHour : month2(date2) < date2 ? week(date2) < date2 ? formatDay : formatWeek : year2(date2) < date2 ? formatMonth : formatYear2)(date2);
    }
    scale.invert = function(y32) {
      return new Date(invert2(y32));
    };
    scale.domain = function(_) {
      return arguments.length ? domain2(Array.from(_, number3)) : domain2().map(date);
    };
    scale.ticks = function(interval2) {
      var d = domain2();
      return ticks3(d[0], d[d.length - 1], interval2 == null ? 10 : interval2);
    };
    scale.tickFormat = function(count, specifier) {
      return specifier == null ? tickFormat3 : format2(specifier);
    };
    scale.nice = function(interval2) {
      var d = domain2();
      if (!interval2 || typeof interval2.range !== "function") interval2 = tickInterval(d[0], d[d.length - 1], interval2 == null ? 10 : interval2);
      return interval2 ? domain2(nice(d, interval2)) : scale;
    };
    scale.copy = function() {
      return copy2(scale, calendar(ticks3, tickInterval, year2, month2, week, day2, hour2, minute2, second2, format2));
    };
    return scale;
  }
  function time2() {
    return initRange.apply(calendar(timeTicks, timeTickInterval, year_default, month_default, sunday, day_default, hour_default, minute_default, second_default, timeFormat).domain([new Date(2e3, 0, 1), new Date(2e3, 0, 2)]), arguments);
  }

  // node_modules/d3-scale/src/utcTime.js
  function utcTime() {
    return initRange.apply(calendar(utcTicks, utcTickInterval, utcYear_default, utcMonth_default, utcSunday, utcDay_default, utcHour_default, utcMinute_default, second_default, utcFormat).domain([Date.UTC(2e3, 0, 1), Date.UTC(2e3, 0, 2)]), arguments);
  }

  // output/PSD3.Internal.FFI/foreign.js
  function chordLayoutWithPadAngle_(matrix) {
    return (padAngle) => chord_default().padAngle(padAngle)(matrix);
  }
  function chordGroups_(chordLayout) {
    return chordLayout.groups;
  }
  function chordArray_(chordLayout) {
    return Array.from(chordLayout);
  }
  function ribbonGenerator_() {
    return ribbon_default();
  }
  function arcGenerator_() {
    return arc_default();
  }
  function ribbonPath_(generator) {
    return (chord2) => generator(chord2);
  }
  function arcPath_(generator) {
    return (group4) => generator(group4);
  }
  function setRibbonRadius_(generator) {
    return (radius) => {
      generator.radius(radius);
      return generator;
    };
  }
  function setArcInnerRadius_(generator) {
    return (radius) => {
      generator.innerRadius(radius);
      return generator;
    };
  }
  function setArcOuterRadius_(generator) {
    return (radius) => {
      generator.outerRadius(radius);
      return generator;
    };
  }

  // output/PSD3.Shared.Data/foreign.js
  function parseFlareJson(jsonString) {
    return JSON.parse(jsonString);
  }
  var getName2 = (node) => node.name || "";
  var getValue2 = (node) => node.value || 0;
  var getChildren_2 = (node) => {
    if (node.children && Array.isArray(node.children) && node.children.length > 0) {
      return node.children;
    }
    return null;
  };
  function parseFlareImportsJson(jsonString) {
    return JSON.parse(jsonString);
  }
  var getImportNodeName = (node) => node.name || "";
  var getImportNodeSize = (node) => node.size || 0;
  var getImportNodeImports = (node) => node.imports || [];

  // output/PSD3.Shared.Data/index.js
  var bind15 = /* @__PURE__ */ bind(bindMaybe);
  var pure15 = /* @__PURE__ */ pure(applicativeMaybe);
  var apply3 = /* @__PURE__ */ apply(applyMaybe);
  var map37 = /* @__PURE__ */ map(functorMaybe);
  var lookup7 = /* @__PURE__ */ lookup(ordString);
  var nub3 = /* @__PURE__ */ nub(ordString);
  var bind16 = /* @__PURE__ */ bind(bindArray);
  var sort2 = /* @__PURE__ */ sort(ordString);
  var fromFoldable9 = /* @__PURE__ */ fromFoldable6(ordString)(foldableArray);
  var pure16 = /* @__PURE__ */ pure(applicativeEither);
  var fromFoldable14 = /* @__PURE__ */ fromFoldable(foldableArray);
  var map113 = /* @__PURE__ */ map(functorArray);
  var discard5 = /* @__PURE__ */ discard(discardUnit)(bindAff);
  var log6 = /* @__PURE__ */ log3(monadEffectAff);
  var bind22 = /* @__PURE__ */ bind(bindAff);
  var pure23 = /* @__PURE__ */ pure(applicativeAff);
  var show17 = /* @__PURE__ */ show(showInt);
  var show18 = /* @__PURE__ */ show(/* @__PURE__ */ showArray(showString));
  var traverse_6 = /* @__PURE__ */ traverse_(applicativeAff)(foldableArray);
  var show23 = /* @__PURE__ */ show(/* @__PURE__ */ showArray(showNumber));
  var EnergyCSV = /* @__PURE__ */ (function() {
    function EnergyCSV2() {
    }
    ;
    EnergyCSV2.value = new EnergyCSV2();
    return EnergyCSV2;
  })();
  var FlareJSON = /* @__PURE__ */ (function() {
    function FlareJSON2() {
    }
    ;
    FlareJSON2.value = new FlareJSON2();
    return FlareJSON2;
  })();
  var FlareImportsJSON = /* @__PURE__ */ (function() {
    function FlareImportsJSON2() {
    }
    ;
    FlareImportsJSON2.value = new FlareImportsJSON2();
    return FlareImportsJSON2;
  })();
  var MiserablesJSON = /* @__PURE__ */ (function() {
    function MiserablesJSON2() {
    }
    ;
    MiserablesJSON2.value = new MiserablesJSON2();
    return MiserablesJSON2;
  })();
  var NationsJSON = /* @__PURE__ */ (function() {
    function NationsJSON2() {
    }
    ;
    NationsJSON2.value = new NationsJSON2();
    return NationsJSON2;
  })();
  var MetroUnemploymentCSV = /* @__PURE__ */ (function() {
    function MetroUnemploymentCSV2() {
    }
    ;
    MetroUnemploymentCSV2.value = new MetroUnemploymentCSV2();
    return MetroUnemploymentCSV2;
  })();
  var USPopulationStateAgeCSV = /* @__PURE__ */ (function() {
    function USPopulationStateAgeCSV2() {
    }
    ;
    USPopulationStateAgeCSV2.value = new USPopulationStateAgeCSV2();
    return USPopulationStateAgeCSV2;
  })();
  var BridgesCSV = /* @__PURE__ */ (function() {
    function BridgesCSV2() {
    }
    ;
    BridgesCSV2.value = new BridgesCSV2();
    return BridgesCSV2;
  })();
  var parseCSVRowSemicolon = function(line) {
    var readUntilSemicolon = function(chars2) {
      var v2 = findIndex(function(c2) {
        return c2 === ";";
      })(chars2);
      if (v2 instanceof Just) {
        return {
          field: fromCharArray(slice(0)(v2.value0)(chars2)),
          rest: drop(v2.value0 + 1 | 0)(chars2)
        };
      }
      ;
      if (v2 instanceof Nothing) {
        return {
          field: fromCharArray(chars2),
          rest: []
        };
      }
      ;
      throw new Error("Failed pattern match at PSD3.Shared.Data (line 224, column 5 - line 232, column 10): " + [v2.constructor.name]);
    };
    var findClosingQuote = function($copy_chars) {
      return function($copy_idx) {
        var $tco_var_chars = $copy_chars;
        var $tco_done = false;
        var $tco_result;
        function $tco_loop(chars2, idx) {
          var v2 = index(chars2)(idx);
          if (v2 instanceof Just && v2.value0 === '"') {
            $tco_done = true;
            return {
              field: fromCharArray(slice(0)(idx)(chars2)),
              rest: drop(idx + 1 | 0)(chars2)
            };
          }
          ;
          if (v2 instanceof Just) {
            $tco_var_chars = chars2;
            $copy_idx = idx + 1 | 0;
            return;
          }
          ;
          if (v2 instanceof Nothing) {
            $tco_done = true;
            return {
              field: fromCharArray(chars2),
              rest: []
            };
          }
          ;
          throw new Error("Failed pattern match at PSD3.Shared.Data (line 210, column 5 - line 220, column 10): " + [v2.constructor.name]);
        }
        ;
        while (!$tco_done) {
          $tco_result = $tco_loop($tco_var_chars, $copy_idx);
        }
        ;
        return $tco_result;
      };
    };
    var parseFields = function($copy_chars) {
      return function($copy_acc) {
        var $tco_var_chars = $copy_chars;
        var $tco_done1 = false;
        var $tco_result;
        function $tco_loop(chars2, acc) {
          if ($$null3(chars2)) {
            $tco_done1 = true;
            return acc;
          }
          ;
          if (otherwise) {
            var v2 = head2(chars2);
            if (v2 instanceof Just && v2.value0 === '"') {
              var v1 = findClosingQuote(drop(1)(chars2))(0);
              var nextFields = (function() {
                var $64 = $$null3(v1.rest);
                if ($64) {
                  return [];
                }
                ;
                return drop(1)(v1.rest);
              })();
              $tco_var_chars = nextFields;
              $copy_acc = snoc3(acc)(v1.field);
              return;
            }
            ;
            var v1 = readUntilSemicolon(chars2);
            $tco_var_chars = v1.rest;
            $copy_acc = snoc3(acc)(v1.field);
            return;
          }
          ;
          throw new Error("Failed pattern match at PSD3.Shared.Data (line 186, column 3 - line 186, column 60): " + [chars2.constructor.name, acc.constructor.name]);
        }
        ;
        while (!$tco_done1) {
          $tco_result = $tco_loop($tco_var_chars, $copy_acc);
        }
        ;
        return $tco_result;
      };
    };
    var chars = toCharArray(line);
    return parseFields(chars)([]);
  };
  var parseCSVRow = function(line) {
    var readUntilComma = function(chars2) {
      var v2 = findIndex(function(c2) {
        return c2 === ",";
      })(chars2);
      if (v2 instanceof Just) {
        return {
          field: fromCharArray(slice(0)(v2.value0)(chars2)),
          rest: drop(v2.value0 + 1 | 0)(chars2)
        };
      }
      ;
      if (v2 instanceof Nothing) {
        return {
          field: fromCharArray(chars2),
          rest: []
        };
      }
      ;
      throw new Error("Failed pattern match at PSD3.Shared.Data (line 119, column 5 - line 127, column 10): " + [v2.constructor.name]);
    };
    var findClosingQuote = function($copy_chars) {
      return function($copy_idx) {
        var $tco_var_chars = $copy_chars;
        var $tco_done = false;
        var $tco_result;
        function $tco_loop(chars2, idx) {
          var v2 = index(chars2)(idx);
          if (v2 instanceof Just && v2.value0 === '"') {
            $tco_done = true;
            return {
              field: fromCharArray(slice(0)(idx)(chars2)),
              rest: drop(idx + 1 | 0)(chars2)
            };
          }
          ;
          if (v2 instanceof Just) {
            $tco_var_chars = chars2;
            $copy_idx = idx + 1 | 0;
            return;
          }
          ;
          if (v2 instanceof Nothing) {
            $tco_done = true;
            return {
              field: fromCharArray(chars2),
              rest: []
            };
          }
          ;
          throw new Error("Failed pattern match at PSD3.Shared.Data (line 105, column 5 - line 115, column 10): " + [v2.constructor.name]);
        }
        ;
        while (!$tco_done) {
          $tco_result = $tco_loop($tco_var_chars, $copy_idx);
        }
        ;
        return $tco_result;
      };
    };
    var parseFields = function($copy_chars) {
      return function($copy_acc) {
        var $tco_var_chars = $copy_chars;
        var $tco_done1 = false;
        var $tco_result;
        function $tco_loop(chars2, acc) {
          if ($$null3(chars2)) {
            $tco_done1 = true;
            return acc;
          }
          ;
          if (otherwise) {
            var v2 = head2(chars2);
            if (v2 instanceof Just && v2.value0 === '"') {
              var v1 = findClosingQuote(drop(1)(chars2))(0);
              var nextFields = (function() {
                var $80 = $$null3(v1.rest);
                if ($80) {
                  return [];
                }
                ;
                return drop(1)(v1.rest);
              })();
              $tco_var_chars = nextFields;
              $copy_acc = snoc3(acc)(v1.field);
              return;
            }
            ;
            var v1 = readUntilComma(chars2);
            $tco_var_chars = v1.rest;
            $copy_acc = snoc3(acc)(v1.field);
            return;
          }
          ;
          throw new Error("Failed pattern match at PSD3.Shared.Data (line 81, column 3 - line 81, column 60): " + [chars2.constructor.name, acc.constructor.name]);
        }
        ;
        while (!$tco_done1) {
          $tco_result = $tco_loop($tco_var_chars, $copy_acc);
        }
        ;
        return $tco_result;
      };
    };
    var chars = toCharArray(line);
    return parseFields(chars)([]);
  };
  var parseBridgesCSV = function(csvContent) {
    var parseRow = function(line) {
      var fields = parseCSVRowSemicolon(trim(line));
      return bind15(index(fields)(0))(function(origin3) {
        return bind15(index(fields)(1))(function(destination) {
          return bind15(index(fields)(2))(function(valueStr) {
            return bind15(fromString(trim(valueStr)))(function(value20) {
              return pure15({
                origin: trim(origin3),
                destination: trim(destination),
                value: value20
              });
            });
          });
        });
      });
    };
    var fillMatrixCell = function(labelMap) {
      return function(matrix2) {
        return function(row) {
          var v2 = apply3(map37(Tuple.create)(lookup7(row.origin)(labelMap)))(lookup7(row.destination)(labelMap));
          if (v2 instanceof Just) {
            var v1 = index(matrix2)(v2.value0.value0);
            if (v1 instanceof Just) {
              var updatedRow = updateAt(v2.value0.value1)(row.value)(v1.value0);
              if (updatedRow instanceof Just) {
                var v22 = updateAt(v2.value0.value0)(updatedRow.value0)(matrix2);
                if (v22 instanceof Just) {
                  return v22.value0;
                }
                ;
                if (v22 instanceof Nothing) {
                  return matrix2;
                }
                ;
                throw new Error("Failed pattern match at PSD3.Shared.Data (line 296, column 32 - line 298, column 36): " + [v22.constructor.name]);
              }
              ;
              if (updatedRow instanceof Nothing) {
                return matrix2;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Shared.Data (line 295, column 15 - line 299, column 34): " + [updatedRow.constructor.name]);
            }
            ;
            if (v1 instanceof Nothing) {
              return matrix2;
            }
            ;
            throw new Error("Failed pattern match at PSD3.Shared.Data (line 290, column 9 - line 300, column 28): " + [v1.constructor.name]);
          }
          ;
          if (v2 instanceof Nothing) {
            return matrix2;
          }
          ;
          throw new Error("Failed pattern match at PSD3.Shared.Data (line 288, column 5 - line 301, column 24): " + [v2.constructor.name]);
        };
      };
    };
    var lines = split("\n")(csvContent);
    var nonEmptyLines = filter(function(line) {
      return trim(line) !== "";
    })(lines);
    var dataLines = (function() {
      var v2 = head2(nonEmptyLines);
      if (v2 instanceof Just) {
        var lowerFirst = trim(v2.value0);
        var $98 = lowerFirst === "From;To;Value" || (lowerFirst === "from;to;value" || lowerFirst === "Origin;Destination;Value");
        if ($98) {
          return drop(1)(nonEmptyLines);
        }
        ;
        return nonEmptyLines;
      }
      ;
      if (v2 instanceof Nothing) {
        return nonEmptyLines;
      }
      ;
      throw new Error("Failed pattern match at PSD3.Shared.Data (line 243, column 17 - line 250, column 31): " + [v2.constructor.name]);
    })();
    var parsedRows = mapMaybe(parseRow)(dataLines);
    var allRegions2 = nub3(bind16(parsedRows)(function(row) {
      return [row.origin, row.destination];
    }));
    var labels9 = sort2(allRegions2);
    var n = length3(labels9);
    var labelIndexMap = fromFoldable9(mapWithIndex3(function(i2) {
      return function(label5) {
        return new Tuple(label5, i2);
      };
    })(labels9));
    var emptyMatrix = replicate(n)(replicate(n)(0));
    var matrix = foldl4(fillMatrixCell(labelIndexMap))(emptyMatrix)(parsedRows);
    return pure16({
      matrix,
      labels: labels9
    });
  };
  var getChildren2 = function($125) {
    return toMaybe(getChildren_2($125));
  };
  var hierDataToTree2 = function(hierData) {
    var value20 = getValue2(hierData);
    var name16 = getName2(hierData);
    var childrenMaybe = getChildren2(hierData);
    var childrenList = (function() {
      if (childrenMaybe instanceof Nothing) {
        return Nil.value;
      }
      ;
      if (childrenMaybe instanceof Just) {
        return fromFoldable14(map113(hierDataToTree2)(childrenMaybe.value0));
      }
      ;
      throw new Error("Failed pattern match at PSD3.Shared.Data (line 152, column 20 - line 154, column 76): " + [childrenMaybe.constructor.name]);
    })();
    return mkTree({
      name: name16,
      value: value20,
      x: 0,
      y: 0,
      depth: 0,
      height: 0
    })(childrenList);
  };
  var flareImportNodeToRecord = function(node) {
    return {
      name: getImportNodeName(node),
      size: getImportNodeSize(node),
      imports: getImportNodeImports(node)
    };
  };
  var dataFilePath = function(v2) {
    if (v2 instanceof EnergyCSV) {
      return "./data/energy.csv";
    }
    ;
    if (v2 instanceof FlareJSON) {
      return "./data/flare-2.json";
    }
    ;
    if (v2 instanceof FlareImportsJSON) {
      return "./data/flare-imports.json";
    }
    ;
    if (v2 instanceof MiserablesJSON) {
      return "./data/miserables.json";
    }
    ;
    if (v2 instanceof NationsJSON) {
      return "./data/nations.json";
    }
    ;
    if (v2 instanceof MetroUnemploymentCSV) {
      return "./data/bls-metro-unemployment.csv";
    }
    ;
    if (v2 instanceof USPopulationStateAgeCSV) {
      return "./data/us-population-state-age.csv";
    }
    ;
    if (v2 instanceof BridgesCSV) {
      return "./data/bridges.csv";
    }
    ;
    throw new Error("Failed pattern match at PSD3.Shared.Data (line 36, column 1 - line 36, column 35): " + [v2.constructor.name]);
  };
  var loadDataFile = function(dataFile) {
    var path18 = dataFilePath(dataFile);
    return discard5(log6("Loading data file: " + path18))(function() {
      return bind22(get5(string)(path18))(function(response) {
        if (response instanceof Left) {
          return discard5(log6("Failed to load " + (path18 + (": " + printError(response.value0)))))(function() {
            return pure23(new Left("Failed to load data file: " + printError(response.value0)));
          });
        }
        ;
        if (response instanceof Right) {
          return discard5(log6("Successfully loaded " + path18))(function() {
            return pure23(new Right(response.value0.body));
          });
        }
        ;
        throw new Error("Failed pattern match at PSD3.Shared.Data (line 64, column 3 - line 70, column 24): " + [response.constructor.name]);
      });
    });
  };
  var loadBridgesData = /* @__PURE__ */ (function() {
    return bind22(loadDataFile(BridgesCSV.value))(function(result) {
      if (result instanceof Left) {
        return pure23(new Left(result.value0));
      }
      ;
      if (result instanceof Right) {
        var parsed = parseBridgesCSV(result.value0);
        if (parsed instanceof Right) {
          return discard5(log6("=== Bridges CSV Parsed Data ==="))(function() {
            return discard5(log6("Labels (" + (show17(length3(parsed.value0.labels)) + " regions):")))(function() {
              return discard5(log6(show18(parsed.value0.labels)))(function() {
                return discard5(log6("\nMatrix (rows = from, cols = to):"))(function() {
                  var indexedRows = mapWithIndex3(function(i2) {
                    return function(row) {
                      return {
                        i: i2,
                        row
                      };
                    };
                  })(parsed.value0.matrix);
                  return discard5(traverse_6(function(v2) {
                    var label5 = (function() {
                      var v1 = index(parsed.value0.labels)(v2.i);
                      if (v1 instanceof Just) {
                        return v1.value0;
                      }
                      ;
                      if (v1 instanceof Nothing) {
                        return "?";
                      }
                      ;
                      throw new Error("Failed pattern match at PSD3.Shared.Data (line 322, column 27 - line 324, column 35): " + [v1.constructor.name]);
                    })();
                    return log6(label5 + (": " + show23(v2.row)));
                  })(indexedRows))(function() {
                    return discard5(log6("=== End Bridges Data ==="))(function() {
                      return pure23(new Right(parsed.value0));
                    });
                  });
                });
              });
            });
          });
        }
        ;
        if (parsed instanceof Left) {
          return pure23(new Left(parsed.value0));
        }
        ;
        throw new Error("Failed pattern match at PSD3.Shared.Data (line 311, column 7 - line 330, column 36): " + [parsed.constructor.name]);
      }
      ;
      throw new Error("Failed pattern match at PSD3.Shared.Data (line 307, column 3 - line 330, column 36): " + [result.constructor.name]);
    });
  })();
  var loadFlareData = /* @__PURE__ */ (function() {
    return bind22(loadDataFile(FlareJSON.value))(function(result) {
      if (result instanceof Left) {
        return pure23(new Left(result.value0));
      }
      ;
      if (result instanceof Right) {
        var hierData = parseFlareJson(result.value0);
        var tree2 = hierDataToTree2(hierData);
        return pure23(new Right(tree2));
      }
      ;
      throw new Error("Failed pattern match at PSD3.Shared.Data (line 162, column 3 - line 167, column 24): " + [result.constructor.name]);
    });
  })();
  var loadFlareImportsData = /* @__PURE__ */ (function() {
    return bind22(loadDataFile(FlareImportsJSON.value))(function(result) {
      if (result instanceof Left) {
        return pure23(new Left(result.value0));
      }
      ;
      if (result instanceof Right) {
        var nodes3 = parseFlareImportsJson(result.value0);
        var records = map113(flareImportNodeToRecord)(nodes3);
        return discard5(log6("Loaded flare-imports: " + (show17(length3(records)) + " nodes")))(function() {
          return pure23(new Right(records));
        });
      }
      ;
      throw new Error("Failed pattern match at PSD3.Shared.Data (line 363, column 3 - line 369, column 27): " + [result.constructor.name]);
    });
  })();

  // output/D3.Viz.TreeAPI.ChordDiagram/index.js
  var compare7 = /* @__PURE__ */ compare(ordInt);
  var lookup8 = /* @__PURE__ */ lookup(ordString);
  var startAngleIsSymbol = {
    reflectSymbol: function() {
      return "startAngle";
    }
  };
  var labelRadiusIsSymbol = {
    reflectSymbol: function() {
      return "labelRadius";
    }
  };
  var endAngleIsSymbol = {
    reflectSymbol: function() {
      return "endAngle";
    }
  };
  var discard6 = /* @__PURE__ */ discard(discardUnit)(bindD3v2M);
  var liftEffect7 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var bind17 = /* @__PURE__ */ bind(bindD3v2M);
  var select11 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var show19 = /* @__PURE__ */ show(showInt);
  var width11 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var num4 = /* @__PURE__ */ num(numExprEvalD);
  var height11 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr6 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text9 = /* @__PURE__ */ text6(stringExprEvalD);
  var show110 = /* @__PURE__ */ show(showNumber);
  var renderTree6 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D);
  var renderTree13 = /* @__PURE__ */ renderTree6(ordUnit);
  var path3 = /* @__PURE__ */ path(toAttributeValueString);
  var fill4 = /* @__PURE__ */ fill(toAttributeValueString);
  var opacity2 = /* @__PURE__ */ opacity(toAttributeValueNumber);
  var stroke4 = /* @__PURE__ */ stroke(toAttributeValueString);
  var strokeWidth4 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var map38 = /* @__PURE__ */ map(functorArray);
  var x6 = /* @__PURE__ */ x(toAttributeValueNumber);
  var y6 = /* @__PURE__ */ y(toAttributeValueNumber);
  var fontSize2 = /* @__PURE__ */ fontSize(toAttributeValueNumber);
  var renderTree24 = /* @__PURE__ */ renderTree6(/* @__PURE__ */ ordRecord()(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(ordRecordNil)()(startAngleIsSymbol)(ordNumber))()(labelRadiusIsSymbol)(ordNumber))()({
    reflectSymbol: function() {
      return "label";
    }
  })(ordString))()(endAngleIsSymbol)(ordNumber)));
  var pure17 = /* @__PURE__ */ pure(applicativeD3v2M);
  var bind18 = /* @__PURE__ */ bind(bindAff);
  var liftEffect1 = /* @__PURE__ */ liftEffect(monadEffectAff);
  var eqIndexedRibbon = {
    eq: function(v2) {
      return function(v1) {
        return v2.index === v1.index;
      };
    }
  };
  var ordIndexedRibbon = {
    compare: function(v2) {
      return function(v1) {
        return compare7(v2.index)(v1.index);
      };
    },
    Eq0: function() {
      return eqIndexedRibbon;
    }
  };
  var renderTree33 = /* @__PURE__ */ renderTree6(ordIndexedRibbon);
  var eqIndexedArc = {
    eq: function(v2) {
      return function(v1) {
        return v2.index === v1.index;
      };
    }
  };
  var ordIndexedArc = {
    compare: function(v2) {
      return function(v1) {
        return compare7(v2.index)(v1.index);
      };
    },
    Eq0: function() {
      return eqIndexedArc;
    }
  };
  var renderTree42 = /* @__PURE__ */ renderTree6(ordIndexedArc);
  var regionColorMap = /* @__PURE__ */ (function() {
    return fromFoldable6(ordString)(foldableArray)([new Tuple("WBR", "#d62728"), new Tuple("Pointe Coupee", "#ff9896"), new Tuple("Point Coupe", "#ff9896"), new Tuple("Iberville", "#e7969c"), new Tuple("EBR-M", "#5ab4ac"), new Tuple("EBR - M", "#5ab4ac"), new Tuple("EBR-S", "#c7eae5"), new Tuple("EBR - S", "#c7eae5"), new Tuple("Ascension", "#80cdc1"), new Tuple("Livingston", "#d8daeb"), new Tuple("I-10 Lafayette", "#b2abd2"), new Tuple("US-190 Opelousas", "#ff7f0e"), new Tuple("US 190 Opelousas", "#ff7f0e"), new Tuple("I-10 NOLA", "#ffbb78"), new Tuple("I-12", "#98df8a")]);
  })();
  var getTargetValue = function(d) {
    return d.target.value;
  };
  var getTargetIndex = function(d) {
    return d.target.index;
  };
  var getSourceValue = function(d) {
    return d.source.value;
  };
  var getSourceIndex = function(d) {
    return d.source.index;
  };
  var getRegionColor = function(labels9) {
    return function(idx) {
      var v2 = index(labels9)(idx);
      if (v2 instanceof Just) {
        var v1 = lookup8(v2.value0)(regionColorMap);
        if (v1 instanceof Just) {
          return v1.value0;
        }
        ;
        if (v1 instanceof Nothing) {
          return "#999999";
        }
        ;
        throw new Error("Failed pattern match at D3.Viz.TreeAPI.ChordDiagram (line 84, column 17 - line 86, column 25): " + [v1.constructor.name]);
      }
      ;
      if (v2 instanceof Nothing) {
        return "#999999";
      }
      ;
      throw new Error("Failed pattern match at D3.Viz.TreeAPI.ChordDiagram (line 83, column 29 - line 87, column 23): " + [v2.constructor.name]);
    };
  };
  var getGroupIndex = function(d) {
    return d.index;
  };
  var toChordLabelDatum = function(labels9) {
    return function(outerR) {
      return function(v2) {
        var idx = getGroupIndex(v2.datum);
        var label5 = fromMaybe("")(index(labels9)(idx));
        return {
          label: label5,
          startAngle: v2.datum.startAngle,
          endAngle: v2.datum.endAngle,
          labelRadius: outerR + 8
        };
      };
    };
  };
  var getDominantFlowIndex = function(d) {
    var targetVal = getTargetValue(d);
    var sourceVal = getSourceValue(d);
    var $156 = sourceVal >= targetVal;
    if ($156) {
      return getSourceIndex(d);
    }
    ;
    return getTargetIndex(d);
  };
  var evalChordStr = function(expr) {
    return function(datum2) {
      return runEvalD(expr)(datum2)(0);
    };
  };
  var evalChordNum = function(expr) {
    return function(datum2) {
      return runEvalD(expr)(datum2)(0);
    };
  };
  var chordStartAngle = function(dictDatumExpr) {
    return field(dictDatumExpr)(startAngleIsSymbol)()($$Proxy.value);
  };
  var chordLabelRadius = function(dictDatumExpr) {
    return field(dictDatumExpr)(labelRadiusIsSymbol)()($$Proxy.value);
  };
  var chordEndAngle = function(dictDatumExpr) {
    return field(dictDatumExpr)(endAngleIsSymbol)()($$Proxy.value);
  };
  var chordMidAngle = function(dictNumExpr) {
    var divLit2 = divLit(dictNumExpr);
    var add12 = add4(dictNumExpr);
    return function(dictDatumExpr) {
      return divLit2(add12(chordStartAngle(dictDatumExpr))(chordEndAngle(dictDatumExpr)))(2);
    };
  };
  var chordLabelAnchor = function(dictNumExpr) {
    var chordMidAngle1 = chordMidAngle(dictNumExpr);
    return function(dictBoolExpr) {
      var ifThenElse2 = ifThenElse(dictBoolExpr);
      return function(dictCompareExpr) {
        var gtOp2 = gtOp(dictCompareExpr);
        return function(dictStringExpr) {
          var s3 = s(dictStringExpr);
          return function(dictTrigExpr) {
            var pi9 = pi3(dictTrigExpr);
            return function(dictDatumExpr) {
              return ifThenElse2(gtOp2(chordMidAngle1(dictDatumExpr))(pi9))(s3("end"))(s3("start"));
            };
          };
        };
      };
    };
  };
  var chordLabelAnchor1 = /* @__PURE__ */ chordLabelAnchor(numExprEvalD)(boolExprEvalD)(compareExprEvalD)(stringExprEvalD)(trigExprEvalD)(datumExprEvalD);
  var chordLabelX = function(dictNumExpr) {
    var mul4 = mul2(dictNumExpr);
    var sub4 = sub2(dictNumExpr);
    var chordMidAngle1 = chordMidAngle(dictNumExpr);
    var divLit2 = divLit(dictNumExpr);
    return function(dictTrigExpr) {
      var cos5 = cos2(dictTrigExpr);
      var pi9 = pi3(dictTrigExpr);
      return function(dictDatumExpr) {
        return mul4(chordLabelRadius(dictDatumExpr))(cos5(sub4(chordMidAngle1(dictDatumExpr))(divLit2(pi9)(2))));
      };
    };
  };
  var chordLabelX1 = /* @__PURE__ */ chordLabelX(numExprEvalD)(trigExprEvalD)(datumExprEvalD);
  var chordLabelY = function(dictNumExpr) {
    var mul4 = mul2(dictNumExpr);
    var sub4 = sub2(dictNumExpr);
    var chordMidAngle1 = chordMidAngle(dictNumExpr);
    var divLit2 = divLit(dictNumExpr);
    return function(dictTrigExpr) {
      var sin6 = sin2(dictTrigExpr);
      var pi9 = pi3(dictTrigExpr);
      return function(dictDatumExpr) {
        return mul4(chordLabelRadius(dictDatumExpr))(sin6(sub4(chordMidAngle1(dictDatumExpr))(divLit2(pi9)(2))));
      };
    };
  };
  var chordLabelY1 = /* @__PURE__ */ chordLabelY(numExprEvalD)(trigExprEvalD)(datumExprEvalD);
  var drawChord = function(matrix) {
    return function(labels9) {
      return function(containerSelector) {
        return function(w) {
          return function(h7) {
            return runD3v2M(discard6(liftEffect7(log2("=== Drawing Chord Diagram with TreeAPI ===")))(function() {
              return bind17(select11(containerSelector))(function(container) {
                var centerX = w / 2;
                var centerY = h7 / 2;
                var chordData = chordLayoutWithPadAngle_(matrix)(0.05);
                var groups = chordGroups_(chordData);
                var chords = chordArray_(chordData);
                return discard6(liftEffect7(log2("Chord layout: " + (show19(length3(groups)) + (" groups, " + (show19(length3(chords)) + " chords"))))))(function() {
                  var indexedGroups = mapWithIndex3(function(i2) {
                    return function(d) {
                      return {
                        index: i2,
                        datum: d
                      };
                    };
                  })(groups);
                  var indexedChords = mapWithIndex3(function(i2) {
                    return function(d) {
                      return {
                        index: i2,
                        datum: d
                      };
                    };
                  })(chords);
                  var ribbonGen = setRibbonRadius_(ribbonGenerator_(unit))(270);
                  var arcGen = setArcOuterRadius_(setArcInnerRadius_(arcGenerator_(unit))(270))(280);
                  var chordTree = withChild(named(SVG.value)("svg")([width11(num4(w)), height11(num4(h7)), viewBox(0)(0)(w)(h7), attr6("id")(text9("chord-svg")), attr6("class")(text9("chord-diagram"))]))(withChildren(named(Group.value)("centerGroup")([attr6("transform")(text9("translate(" + (show110(centerX) + ("," + (show110(centerY) + ")"))))), attr6("class")(text9("chord-group"))]))([named(Group.value)("ribbonsGroup")([attr6("class")(text9("ribbons"))]), named(Group.value)("arcsGroup")([attr6("class")(text9("arcs"))]), named(Group.value)("labelsGroup")([attr6("class")(text9("labels"))])]));
                  return bind17(renderTree13(container)(chordTree))(function(selections) {
                    return bind17(liftEffect7(reselectD3v2("ribbonsGroup")(selections)))(function(ribbonsGroupSel) {
                      return bind17(liftEffect7(reselectD3v2("arcsGroup")(selections)))(function(arcsGroupSel) {
                        return bind17(liftEffect7(reselectD3v2("labelsGroup")(selections)))(function(labelsGroupSel) {
                          var ribbonsTree = joinData("ribbonElements")("path")(indexedChords)(function(v2) {
                            var dominantIdx = getDominantFlowIndex(v2.datum);
                            var color2 = getRegionColor(labels9)(dominantIdx);
                            return elem3(Path.value)([attr6("class")(text9("ribbon")), path3(text9(ribbonPath_(ribbonGen)(v2.datum))), fill4(text9(color2)), opacity2(num4(0.67)), stroke4(text9("#000000")), strokeWidth4(num4(0.5))]);
                          });
                          return bind17(renderTree33(ribbonsGroupSel)(ribbonsTree))(function() {
                            var arcsTree = joinData("arcElements")("path")(indexedGroups)(function(v2) {
                              var idx = getGroupIndex(v2.datum);
                              var color2 = getRegionColor(labels9)(idx);
                              return elem3(Path.value)([attr6("class")(text9("arc")), path3(text9(arcPath_(arcGen)(v2.datum))), fill4(text9(color2)), stroke4(text9("#ffffff")), strokeWidth4(num4(2))]);
                            });
                            return bind17(renderTree42(arcsGroupSel)(arcsTree))(function() {
                              var chordLabelData = map38(toChordLabelDatum(labels9)(280))(indexedGroups);
                              var labelsTree = joinData("labelElements")("text")(chordLabelData)(function(datum2) {
                                return elem3(Text.value)([attr6("class")(text9("chord-label")), x6(num4(evalChordNum(chordLabelX1)(datum2))), y6(num4(evalChordNum(chordLabelY1)(datum2))), attr6("text-anchor")(text9(evalChordStr(chordLabelAnchor1)(datum2))), fill4(text9("#000")), attr6("text-content")(text9(datum2.label)), fontSize2(num4(10))]);
                              });
                              return bind17(renderTree24(labelsGroupSel)(labelsTree))(function() {
                                return discard6(liftEffect7(log2("Chord diagram rendered with TreeAPI")))(function() {
                                  return pure17(unit);
                                });
                              });
                            });
                          });
                        });
                      });
                    });
                  });
                });
              });
            }));
          };
        };
      };
    };
  };
  var startChord = function(containerSelector) {
    return launchAff_(bind18(loadBridgesData)(function(result) {
      if (result instanceof Left) {
        return liftEffect1(log2("Failed to load bridges data: " + result.value0));
      }
      ;
      if (result instanceof Right) {
        return liftEffect1(drawChord(result.value0.matrix)(result.value0.labels)(containerSelector)(700)(700));
      }
      ;
      throw new Error("Failed pattern match at D3.Viz.TreeAPI.ChordDiagram (line 363, column 3 - line 365, column 105): " + [result.constructor.name]);
    }));
  };

  // output/D3.Viz.TreeAPI.ClusterViz/index.js
  var bind19 = /* @__PURE__ */ bind(bindList);
  var append11 = /* @__PURE__ */ append(semigroupList);
  var fromFoldable10 = /* @__PURE__ */ fromFoldable3(foldableList);
  var show20 = /* @__PURE__ */ show(showNumber);
  var bind110 = /* @__PURE__ */ bind(bindD3v2M);
  var select12 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var fromFoldable15 = /* @__PURE__ */ fromFoldable3(/* @__PURE__ */ foldableCofree(foldableList));
  var discard7 = /* @__PURE__ */ discard(discardUnit);
  var discard1 = /* @__PURE__ */ discard7(bindD3v2M);
  var liftEffect8 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var show111 = /* @__PURE__ */ show(showInt);
  var width12 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var num5 = /* @__PURE__ */ num(numExprEvalD);
  var height12 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr7 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text10 = /* @__PURE__ */ text6(stringExprEvalD);
  var path4 = /* @__PURE__ */ path(toAttributeValueString);
  var fill5 = /* @__PURE__ */ fill(toAttributeValueString);
  var stroke5 = /* @__PURE__ */ stroke(toAttributeValueString);
  var strokeWidth5 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var renderTree7 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D);
  var ordRecord3 = /* @__PURE__ */ ordRecord();
  var ordRecordCons3 = /* @__PURE__ */ ordRecordCons(ordRecordNil)();
  var ordRecordCons1 = /* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons3({
    reflectSymbol: function() {
      return "y";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "x";
    }
  })(ordNumber);
  var ordRecord12 = /* @__PURE__ */ ordRecord3(ordRecordCons1);
  var renderTree14 = /* @__PURE__ */ renderTree7(/* @__PURE__ */ ordRecord3(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons3({
    reflectSymbol: function() {
      return "target";
    }
  })(ordRecord12))()({
    reflectSymbol: function() {
      return "source";
    }
  })(ordRecord12)));
  var cx2 = /* @__PURE__ */ cx(toAttributeValueNumber);
  var cy2 = /* @__PURE__ */ cy(toAttributeValueNumber);
  var r3 = /* @__PURE__ */ r(toAttributeValueNumber);
  var x7 = /* @__PURE__ */ x(toAttributeValueNumber);
  var y7 = /* @__PURE__ */ y(toAttributeValueNumber);
  var textContent3 = /* @__PURE__ */ textContent2(toAttributeValueString);
  var fontSize3 = /* @__PURE__ */ fontSize(toAttributeValueNumber);
  var textAnchor2 = /* @__PURE__ */ textAnchor(toAttributeValueString);
  var renderTree25 = /* @__PURE__ */ renderTree7(/* @__PURE__ */ ordRecord3(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(ordRecordCons1)()({
    reflectSymbol: function() {
      return "value";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "name";
    }
  })(ordString))()({
    reflectSymbol: function() {
      return "height";
    }
  })(ordInt))()({
    reflectSymbol: function() {
      return "depth";
    }
  })(ordInt)));
  var bind23 = /* @__PURE__ */ bind(bindAff);
  var liftEffect12 = /* @__PURE__ */ liftEffect(monadEffectAff);
  var makeLinks2 = function(tree$prime) {
    var makeLinksList = function(t2) {
      var val = head(t2);
      var children3 = tail(t2);
      var grandchildLinks = bind19(children3)(makeLinksList);
      var childLinks = bind19(children3)(function(child) {
        var childVal = head(child);
        return new Cons({
          source: {
            x: val.x,
            y: val.y
          },
          target: {
            x: childVal.x,
            y: childVal.y
          }
        }, Nil.value);
      });
      return append11(childLinks)(grandchildLinks);
    };
    return fromFoldable10(makeLinksList(tree$prime));
  };
  var linkPath = function(x1$prime) {
    return function(y1$prime) {
      return function(x2$prime) {
        return function(y2$prime) {
          var midY = (y1$prime + y2$prime) / 2;
          return "M" + (show20(x1$prime) + ("," + (show20(y1$prime) + (" C" + (show20(x1$prime) + ("," + (show20(midY) + (" " + (show20(x2$prime) + ("," + (show20(midY) + (" " + (show20(x2$prime) + ("," + show20(y2$prime)))))))))))))));
        };
      };
    };
  };
  var drawCluster = function(selector) {
    return function(flareTree) {
      return runD3v2M(bind110(select12(selector))(function(container) {
        var config = {
          minSeparation: defaultClusterConfig.minSeparation,
          size: {
            width: 750 - 2 * 40,
            height: 500 - 2 * 40
          }
        };
        var positioned = cluster(config)(flareTree);
        var nodes3 = fromFoldable15(positioned);
        var links3 = makeLinks2(positioned);
        return discard1(liftEffect8(log2("Rendering cluster (dendrogram): " + (show111(length3(nodes3)) + (" nodes, " + (show111(length3(links3)) + " links"))))))(function() {
          var linksTree = withChild(named(SVG.value)("svg")([width12(num5(750)), height12(num5(500)), viewBox(0)(0)(750)(500), attr7("class")(text10("cluster-viz"))]))(withChild(named(Group.value)("chartGroup")([attr7("class")(text10("tree-content"))]))(withChild(named(Group.value)("linksGroup")([attr7("class")(text10("links"))]))(joinData("links")("path")(links3)(function(link5) {
            return elem3(Path.value)([path4(text10(linkPath(link5.source.x + 40)(link5.source.y + 40)(link5.target.x + 40)(link5.target.y + 40))), fill5(text10("none")), stroke5(text10("#999")), strokeWidth5(num5(1.5)), attr7("class")(text10("link"))]);
          }))));
          return bind110(renderTree14(container)(linksTree))(function(linksSelections) {
            return bind110(liftEffect8(reselectD3v2("chartGroup")(linksSelections)))(function(chartGroupSel) {
              var nodesTree = withChild(named(Group.value)("nodesGroup")([attr7("class")(text10("nodes"))]))(joinData("nodeGroups")("g")(nodes3)(function(node) {
                return withChildren(named(Group.value)("node-" + node.name)([attr7("class")(text10("node"))]))([elem3(Circle.value)([cx2(num5(node.x + 40)), cy2(num5(node.y + 40)), r3(num5(4)), fill5(text10("#69b3a2")), stroke5(text10("#fff")), strokeWidth5(num5(1.5))]), elem3(Text.value)([x7(num5(node.x + 40 + 8)), y7(num5(node.y + 40 + 4)), textContent3(text10(node.name)), fontSize3(num5(10)), textAnchor2(text10("start"))])]);
              }));
              return bind110(renderTree25(chartGroupSel)(nodesTree))(function() {
                return liftEffect8(function __do7() {
                  log2("=== Cluster Layout (Dendrogram, Tree API) ===")();
                  log2("")();
                  log2("Flare visualization toolkit hierarchy (cluster/dendrogram)")();
                  return log2("")();
                });
              });
            });
          });
        });
      }));
    };
  };
  var clusterViz = function(selector) {
    return launchAff_(bind23(loadFlareData)(function(result) {
      if (result instanceof Left) {
        return liftEffect12(log2("Failed to load Flare data: " + result.value0));
      }
      ;
      if (result instanceof Right) {
        return liftEffect12(drawCluster(selector)(result.value0));
      }
      ;
      throw new Error("Failed pattern match at D3.Viz.TreeAPI.ClusterViz (line 179, column 3 - line 181, column 67): " + [result.constructor.name]);
    }));
  };

  // output/D3.Viz.TreeAPI.EdgeBundleViz/foreign.js
  var atan24 = (y32) => (x32) => Math.atan2(y32, x32);

  // output/DataViz.Layout.Hierarchy.EdgeBundle.Bilink/index.js
  var map39 = /* @__PURE__ */ map(functorArray);
  var foldl6 = /* @__PURE__ */ foldl(foldableArray);
  var lookup9 = /* @__PURE__ */ lookup(ordString);
  var insert7 = /* @__PURE__ */ insert(ordString);
  var append15 = /* @__PURE__ */ append(semigroupArray);
  var fromFoldable11 = /* @__PURE__ */ fromFoldable6(ordString)(foldableArray);
  var BilinkedNode = /* @__PURE__ */ (function() {
    function BilinkedNode2(value0) {
      this.value0 = value0;
    }
    ;
    BilinkedNode2.create = function(value0) {
      return new BilinkedNode2(value0);
    };
    return BilinkedNode2;
  })();
  var nodeToLinks = function(getImports) {
    return function(v2) {
      if (v2.value0.data_ instanceof Nothing) {
        return [];
      }
      ;
      if (v2.value0.data_ instanceof Just) {
        var imports = getImports(v2.value0.data_.value0);
        return map39(function(target7) {
          return {
            source: v2.value0.fullName,
            target: target7
          };
        })(imports);
      }
      ;
      throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.EdgeBundle.Bilink (line 175, column 3 - line 181, column 69): " + [v2.value0.data_.constructor.name]);
    };
  };
  var getOutgoing = function(v2) {
    return v2.value0.outgoing;
  };
  var getIncoming = function(v2) {
    return v2.value0.incoming;
  };
  var getBilinkedFullName = function(v2) {
    return v2.value0.fullName;
  };
  var convertToBilinked = function(v2) {
    return new BilinkedNode({
      name: v2.value0.name,
      fullName: v2.value0.fullName,
      children: map39(convertToBilinked)(v2.value0.children),
      data_: v2.value0.data_,
      depth: v2.value0.depth,
      height: v2.value0.height,
      outgoing: [],
      incoming: []
    });
  };
  var collectLinks = function(getImports) {
    return function(leafNodes) {
      return concatMap(nodeToLinks(getImports))(leafNodes);
    };
  };
  var buildLinkMap = function(getKey) {
    return function(links3) {
      return foldl6(function(acc) {
        return function(link5) {
          var key2 = getKey(link5);
          var existing = fromMaybe([])(lookup9(key2)(acc));
          return insert7(key2)(snoc3(existing)(link5))(acc);
        };
      })(empty4)(links3);
    };
  };
  var applyLinks = function(outgoingMap) {
    return function(incomingMap) {
      return function(v2) {
        var outgoing = fromMaybe([])(lookup9(v2.value0.fullName)(outgoingMap));
        var incoming = fromMaybe([])(lookup9(v2.value0.fullName)(incomingMap));
        var childrenWithLinks = map39(applyLinks(outgoingMap)(incomingMap))(v2.value0.children);
        return new BilinkedNode({
          name: v2.value0.name,
          fullName: v2.value0.fullName,
          data_: v2.value0.data_,
          depth: v2.value0.depth,
          height: v2.value0.height,
          outgoing,
          incoming,
          children: childrenWithLinks
        });
      };
    };
  };
  var allBilinkedNodes = function(v2) {
    return append15([v2])(concatMap(allBilinkedNodes)(v2.value0.children));
  };
  var getLinks2 = function(root3) {
    var allNodes = allBilinkedNodes(root3);
    return concatMap(getOutgoing)(allNodes);
  };
  var allBilinkedLeaves = function(v2) {
    var $60 = $$null3(v2.value0.children);
    if ($60) {
      return [v2];
    }
    ;
    return concatMap(allBilinkedLeaves)(v2.value0.children);
  };
  var bilink = function(getImports) {
    return function(tree2) {
      var initialBilinked = convertToBilinked(tree2);
      var leafNodes = allBilinkedLeaves(initialBilinked);
      var nameMap = fromFoldable11(map39(function(n) {
        return new Tuple(getBilinkedFullName(n), n);
      })(leafNodes));
      var allLinks = collectLinks(getImports)(leafNodes);
      var incomingMap = buildLinkMap(function(v2) {
        return v2.target;
      })(allLinks);
      var outgoingMap = buildLinkMap(function(v2) {
        return v2.source;
      })(allLinks);
      var withLinks = applyLinks(outgoingMap)(incomingMap)(initialBilinked);
      return withLinks;
    };
  };

  // output/DataViz.Layout.Hierarchy.EdgeBundle.BundleCurve/index.js
  var show21 = /* @__PURE__ */ show(showNumber);
  var foldl7 = /* @__PURE__ */ foldl(foldableArray);
  var map40 = /* @__PURE__ */ map(functorArray);
  var toCartesianPoint = function(v2) {
    return {
      x: v2.radius * cos(v2.angle),
      y: v2.radius * sin(v2.angle)
    };
  };
  var lerp = function(a3) {
    return function(b10) {
      return function(t2) {
        return a3 + (b10 - a3) * t2;
      };
    };
  };
  var buildBSplineCurves = function(prev) {
    return function(points) {
      var v2 = length3(points);
      if (v2 === 0) {
        return "";
      }
      ;
      if (v2 === 1) {
        var v1 = head2(points);
        if (v1 instanceof Just) {
          return "L" + (show21(v1.value0.x) + ("," + show21(v1.value0.y)));
        }
        ;
        if (v1 instanceof Nothing) {
          return "";
        }
        ;
        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.EdgeBundle.BundleCurve (line 163, column 10 - line 165, column 20): " + [v1.constructor.name]);
      }
      ;
      var result = foldl7(function(acc) {
        return function(point3) {
          var midY = (acc.prevPoint.y + point3.y) / 2;
          var midX = (acc.prevPoint.x + point3.x) / 2;
          var segment = "Q" + (show21(acc.prevPoint.x) + ("," + (show21(acc.prevPoint.y) + (" " + (show21(midX) + ("," + show21(midY)))))));
          return {
            path: acc.path + segment,
            prevPoint: point3
          };
        };
      })({
        path: "",
        prevPoint: prev
      })(points);
      var finalSegment = (function() {
        var v12 = last(points);
        if (v12 instanceof Just) {
          return "Q" + (show21(result.prevPoint.x) + ("," + (show21(result.prevPoint.y) + (" " + (show21(v12.value0.x) + ("," + show21(v12.value0.y)))))));
        }
        ;
        if (v12 instanceof Nothing) {
          return "";
        }
        ;
        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.EdgeBundle.BundleCurve (line 192, column 24 - line 199, column 24): " + [v12.constructor.name]);
      })();
      return result.path + finalSegment;
    };
  };
  var drawBSpline = function(points) {
    var v2 = uncons4(points);
    if (v2 instanceof Nothing) {
      return "";
    }
    ;
    if (v2 instanceof Just) {
      var v1 = uncons4(v2.value0.tail);
      if (v1 instanceof Nothing) {
        return "M" + (show21(v2.value0.head.x) + ("," + show21(v2.value0.head.y)));
      }
      ;
      if (v1 instanceof Just) {
        var $57 = $$null3(v1.value0.tail);
        if ($57) {
          return "M" + (show21(v2.value0.head.x) + ("," + (show21(v2.value0.head.y) + ("L" + (show21(v1.value0.head.x) + ("," + show21(v1.value0.head.y)))))));
        }
        ;
        var start4 = "M" + (show21(v2.value0.head.x) + ("," + show21(v2.value0.head.y)));
        var curves = buildBSplineCurves(v2.value0.head)(cons2(v1.value0.head)(v1.value0.tail));
        return start4 + curves;
      }
      ;
      throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.EdgeBundle.BundleCurve (line 132, column 7 - line 155, column 30): " + [v1.constructor.name]);
    }
    ;
    throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.EdgeBundle.BundleCurve (line 129, column 3 - line 155, column 30): " + [v2.constructor.name]);
  };
  var applyBundleTension = function(tension) {
    return function(points) {
      var v2 = last(points);
      var v1 = head2(points);
      if (v1 instanceof Just && v2 instanceof Just) {
        var n = length3(points);
        return mapWithIndex3(function(i2) {
          return function(point3) {
            var t2 = toNumber(i2) / toNumber(n - 1 | 0);
            var straightY = lerp(v1.value0.y)(v2.value0.y)(t2);
            var straightX = lerp(v1.value0.x)(v2.value0.x)(t2);
            var bundledY = lerp(straightY)(point3.y)(tension);
            var bundledX = lerp(straightX)(point3.x)(tension);
            return {
              x: bundledX,
              y: bundledY
            };
          };
        })(points);
      }
      ;
      return points;
    };
  };
  var bundlePath = function(tension) {
    return function(points) {
      var v2 = length3(points);
      if (v2 === 0) {
        return "";
      }
      ;
      if (v2 === 1) {
        var v1 = head2(points);
        if (v1 instanceof Just) {
          return "M" + (show21(v1.value0.x) + ("," + show21(v1.value0.y)));
        }
        ;
        if (v1 instanceof Nothing) {
          return "";
        }
        ;
        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.EdgeBundle.BundleCurve (line 46, column 10 - line 48, column 20): " + [v1.constructor.name]);
      }
      ;
      if (v2 === 2) {
        var v1 = last(points);
        var v22 = head2(points);
        if (v22 instanceof Just && v1 instanceof Just) {
          return "M" + (show21(v22.value0.x) + ("," + (show21(v22.value0.y) + ("L" + (show21(v1.value0.x) + ("," + show21(v1.value0.y)))))));
        }
        ;
        return "";
      }
      ;
      var bundled = applyBundleTension(tension)(points);
      return drawBSpline(bundled);
    };
  };
  var bundlePathRadial = function(tension) {
    return function(radialPoints) {
      var cartesian = map40(toCartesianPoint)(radialPoints);
      return bundlePath(tension)(cartesian);
    };
  };

  // output/DataViz.Layout.Hierarchy.EdgeBundle.Hierarchy/index.js
  var map41 = /* @__PURE__ */ map(functorMaybe);
  var map114 = /* @__PURE__ */ map(functorArray);
  var elem4 = /* @__PURE__ */ elem2(eqString);
  var append16 = /* @__PURE__ */ append(semigroupArray);
  var foldl9 = /* @__PURE__ */ foldl(foldableArray);
  var max10 = /* @__PURE__ */ max(ordInt);
  var TreeNode = /* @__PURE__ */ (function() {
    function TreeNode2(value0) {
      this.value0 = value0;
    }
    ;
    TreeNode2.create = function(value0) {
      return new TreeNode2(value0);
    };
    return TreeNode2;
  })();
  var isLeaf = function(v2) {
    return $$null3(v2.value0.children);
  };
  var getFullName = function(v2) {
    return v2.value0.fullName;
  };
  var getAncestors = function(root3) {
    return function(target7) {
      var findPath = function(v2) {
        return function(v1) {
          if (v2.value0.fullName === v1.value0.fullName) {
            return new Just([v2]);
          }
          ;
          if (otherwise) {
            return findMap2(function(child) {
              return map41(cons2(v2))(findPath(child)(new TreeNode(v1.value0)));
            })(v2.value0.children);
          }
          ;
          throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.EdgeBundle.Hierarchy (line 86, column 3 - line 86, column 69): " + [v2.constructor.name, v1.constructor.name]);
        };
      };
      return fromMaybe([])(findPath(root3)(target7));
    };
  };
  var pathBetween = function(root3) {
    return function(source3) {
      return function(target7) {
        var findLCA = function(as) {
          return function(bs) {
            var bNames = map114(getFullName)(bs);
            var common = filter(function(a3) {
              return elem4(getFullName(a3))(bNames);
            })(as);
            return last(common);
          };
        };
        var targetAncestors = getAncestors(root3)(target7);
        var sourceAncestors = getAncestors(root3)(source3);
        var lca = findLCA(sourceAncestors)(targetAncestors);
        var lcaToTarget = (function() {
          if (lca instanceof Nothing) {
            return targetAncestors;
          }
          ;
          if (lca instanceof Just) {
            var lcaName = getFullName(lca.value0);
            return dropWhile(function(n) {
              return getFullName(n) !== lcaName;
            })(targetAncestors);
          }
          ;
          throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.EdgeBundle.Hierarchy (line 119, column 19 - line 125, column 75): " + [lca.constructor.name]);
        })();
        var sourceToLCA = (function() {
          if (lca instanceof Nothing) {
            return sourceAncestors;
          }
          ;
          if (lca instanceof Just) {
            var lcaName = getFullName(lca.value0);
            return reverse2(takeWhile(function(n) {
              return getFullName(n) !== lcaName;
            })(reverse2(sourceAncestors)));
          }
          ;
          throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.EdgeBundle.Hierarchy (line 110, column 19 - line 116, column 107): " + [lca.constructor.name]);
        })();
        return append16(sourceToLCA)(lcaToTarget);
      };
    };
  };
  var findNode = function(targetName) {
    return function(v2) {
      if (v2.value0.fullName === targetName) {
        return new Just(v2);
      }
      ;
      if (otherwise) {
        return findMap2(findNode(targetName))(v2.value0.children);
      }
      ;
      throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.EdgeBundle.Hierarchy (line 75, column 1 - line 75, column 65): " + [targetName.constructor.name, v2.constructor.name]);
    };
  };
  var descendants = function(v2) {
    return append16([v2])(concatMap(descendants)(v2.value0.children));
  };
  var leaves = function(root3) {
    return filter(isLeaf)(descendants(root3));
  };
  var computeHeights = function(v2) {
    var $58 = $$null3(v2.value0.children);
    if ($58) {
      return new TreeNode({
        name: v2.value0.name,
        fullName: v2.value0.fullName,
        children: v2.value0.children,
        data_: v2.value0.data_,
        depth: v2.value0.depth,
        height: 0
      });
    }
    ;
    var childrenWithHeights = map114(computeHeights)(v2.value0.children);
    var maxChildHeight = foldl9(function(acc) {
      return function(v1) {
        return max10(acc)(v1.value0.height);
      };
    })(0)(childrenWithHeights);
    return new TreeNode({
      name: v2.value0.name,
      fullName: v2.value0.fullName,
      data_: v2.value0.data_,
      depth: v2.value0.depth,
      children: childrenWithHeights,
      height: maxChildHeight + 1 | 0
    });
  };
  var addOrUpdateChild = function(name16) {
    return function(newChild) {
      return function(children3) {
        var exists = any2(function(v2) {
          return v2.value0.name === name16;
        })(children3);
        if (exists) {
          return map114(function(v2) {
            var $66 = v2.value0.name === name16;
            if ($66) {
              return newChild;
            }
            ;
            return v2;
          })(children3);
        }
        ;
        return snoc3(children3)(newChild);
      };
    };
  };
  var insertAtPath = function(parts) {
    return function(fullName) {
      return function(nodeData) {
        return function(prefix) {
          return function(v2) {
            var v1 = uncons4(parts);
            if (v1 instanceof Nothing) {
              return new TreeNode(v2.value0);
            }
            ;
            if (v1 instanceof Just) {
              var newPrefix = (function() {
                var $74 = prefix === "";
                if ($74) {
                  return v1.value0.head;
                }
                ;
                return prefix + ("." + v1.value0.head);
              })();
              var newDepth = v2.value0.depth + 1 | 0;
              var $75 = $$null3(v1.value0.tail);
              if ($75) {
                var newLeaf = new TreeNode({
                  name: v1.value0.head,
                  fullName: newPrefix,
                  children: [],
                  data_: new Just(nodeData),
                  depth: newDepth,
                  height: 0
                });
                return new TreeNode({
                  name: v2.value0.name,
                  fullName: v2.value0.fullName,
                  data_: v2.value0.data_,
                  depth: v2.value0.depth,
                  height: v2.value0.height,
                  children: addOrUpdateChild(v1.value0.head)(newLeaf)(v2.value0.children)
                });
              }
              ;
              var existingChild = find2(function(v22) {
                return v22.value0.name === v1.value0.head;
              })(v2.value0.children);
              var childNode = (function() {
                if (existingChild instanceof Just) {
                  return existingChild.value0;
                }
                ;
                if (existingChild instanceof Nothing) {
                  return new TreeNode({
                    name: v1.value0.head,
                    fullName: newPrefix,
                    children: [],
                    data_: Nothing.value,
                    depth: newDepth,
                    height: 0
                  });
                }
                ;
                throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.EdgeBundle.Hierarchy (line 232, column 25 - line 241, column 18): " + [existingChild.constructor.name]);
              })();
              var updatedChild = insertAtPath(v1.value0.tail)(fullName)(nodeData)(newPrefix)(childNode);
              return new TreeNode({
                name: v2.value0.name,
                fullName: v2.value0.fullName,
                data_: v2.value0.data_,
                depth: v2.value0.depth,
                height: v2.value0.height,
                children: addOrUpdateChild(v1.value0.head)(updatedChild)(v2.value0.children)
              });
            }
            ;
            throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.EdgeBundle.Hierarchy (line 205, column 3 - line 246, column 92): " + [v1.constructor.name]);
          };
        };
      };
    };
  };
  var insertNode = function(getName3) {
    return function(root3) {
      return function(nodeData) {
        var fullName = getName3(nodeData);
        var parts = split(".")(fullName);
        return insertAtPath(parts)(fullName)(nodeData)("")(root3);
      };
    };
  };
  var buildHierarchy = function(config) {
    return function(nodes3) {
      var emptyRoot = new TreeNode({
        name: "",
        fullName: "",
        children: [],
        data_: Nothing.value,
        depth: 0,
        height: 0
      });
      var treeWithNodes = foldl9(insertNode(config.getName))(emptyRoot)(nodes3);
      var withHeights = computeHeights(treeWithNodes);
      return withHeights;
    };
  };

  // output/DataViz.Layout.Hierarchy.EdgeBundle.RadialCluster/index.js
  var add1 = /* @__PURE__ */ add(semiringNumber);
  var foldl10 = /* @__PURE__ */ foldl(foldableArray);
  var map42 = /* @__PURE__ */ map(functorArray);
  var RadialNode = /* @__PURE__ */ (function() {
    function RadialNode2(value0) {
      this.value0 = value0;
    }
    ;
    RadialNode2.create = function(value0) {
      return new RadialNode2(value0);
    };
    return RadialNode2;
  })();
  var toCartesian = function(v2) {
    return {
      x: v2.value0.y * cos(v2.value0.x),
      y: v2.value0.y * sin(v2.value0.x)
    };
  };
  var layoutNode = function(config) {
    return function(maxHeight) {
      return function(angleStep) {
        return function(state3) {
          return function(v2) {
            var $24 = $$null3(v2.value0.children);
            if ($24) {
              var newState = {
                currentIndex: state3.currentIndex + 1 | 0
              };
              var angle = config.startAngle + (toNumber(state3.currentIndex) + 0.5) * angleStep;
              return {
                node: new RadialNode({
                  name: v2.value0.name,
                  fullName: v2.value0.fullName,
                  children: [],
                  data_: v2.value0.data_,
                  depth: v2.value0.depth,
                  height: v2.value0.height,
                  x: angle,
                  y: config.outerRadius
                }),
                state: newState
              };
            }
            ;
            var heightRatio = toNumber(v2.value0.height) / toNumber(maxHeight);
            var radius = config.innerRadius + (config.outerRadius - config.innerRadius) * (1 - heightRatio);
            var childResults = foldl10(function(acc) {
              return function(child) {
                var result = layoutNode(config)(maxHeight)(angleStep)(acc.state)(child);
                return {
                  children: snoc3(acc.children)(result.node),
                  state: result.state
                };
              };
            })({
              children: [],
              state: state3
            })(v2.value0.children);
            var childAngles = map42(function(v1) {
              return v1.value0.x;
            })(childResults.children);
            var meanAngle = (function() {
              if (childAngles.length === 0) {
                return 0;
              }
              ;
              return foldl10(add1)(0)(childAngles) / toNumber(length3(childAngles));
            })();
            return {
              node: new RadialNode({
                name: v2.value0.name,
                fullName: v2.value0.fullName,
                children: childResults.children,
                data_: v2.value0.data_,
                depth: v2.value0.depth,
                height: v2.value0.height,
                x: meanAngle,
                y: radius
              }),
              state: childResults.state
            };
          };
        };
      };
    };
  };
  var getMaxHeight = function(v2) {
    return v2.value0.height;
  };
  var radialCluster = function(config) {
    return function(tree2) {
      var maxHeight = getMaxHeight(tree2);
      var leafNodes = leaves(tree2);
      var numLeaves = length3(leafNodes);
      var angleStep = (config.endAngle - config.startAngle) / toNumber(numLeaves);
      var result = layoutNode(config)(maxHeight)(angleStep)({
        currentIndex: 0
      })(tree2);
      return result.node;
    };
  };

  // output/DataViz.Layout.Hierarchy.EdgeBundle/index.js
  var append17 = /* @__PURE__ */ append(semigroupArray);
  var map43 = /* @__PURE__ */ map(functorArray);
  var getRadialShortName = function(v2) {
    return v2.value0.name;
  };
  var getRadialRadius = function(v2) {
    return v2.value0.y;
  };
  var getRadialFullName = function(v2) {
    return v2.value0.fullName;
  };
  var getRadialData = function(v2) {
    return v2.value0.data_;
  };
  var getRadialChildren = function(v2) {
    return v2.value0.children;
  };
  var getRadialAngle = function(v2) {
    return v2.value0.x;
  };
  var getAllRadialNodes = function(v2) {
    return append17([v2])(concatMap(getAllRadialNodes)(v2.value0.children));
  };
  var getAllBilinkedNodes = function(v2) {
    return append17([v2])(concatMap(getAllBilinkedNodes)(v2.value0.children));
  };
  var generateBundledLinks = function(tension) {
    return function(tree2) {
      return function(radialTree2) {
        return function(bilinked) {
          var radialNodes = getAllRadialNodes(radialTree2);
          var allLinks = getLinks2(bilinked);
          var bundled = mapMaybe(function(v2) {
            var v1 = findNode(v2.target)(tree2);
            var v22 = findNode(v2.source)(tree2);
            if (v22 instanceof Just && v1 instanceof Just) {
              var pathNodes = pathBetween(tree2)(v22.value0)(v1.value0);
              var radialPath = mapMaybe(function(pathNode) {
                var name16 = getFullName(pathNode);
                return find2(function(r29) {
                  return getRadialFullName(r29) === name16;
                })(radialNodes);
              })(pathNodes);
              var radialPoints = map43(function(r29) {
                return {
                  angle: getRadialAngle(r29),
                  radius: getRadialRadius(r29)
                };
              })(radialPath);
              var svgPath = bundlePathRadial(tension)(radialPoints);
              return new Just({
                source: v2.source,
                target: v2.target,
                path: svgPath
              });
            }
            ;
            return Nothing.value;
          })(allLinks);
          return bundled;
        };
      };
    };
  };
  var extractPositionedNodes = function(bilinked) {
    return function(radial) {
      var allRadial = getAllRadialNodes(radial);
      var allBilinked = getAllBilinkedNodes(bilinked);
      var merged = mapMaybe(function(rNode) {
        var name16 = getRadialFullName(rNode);
        var maybeBilinked = find2(function(b10) {
          return getBilinkedFullName(b10) === name16;
        })(allBilinked);
        var cart = toCartesian(rNode);
        return new Just({
          fullName: name16,
          shortName: getRadialShortName(rNode),
          x: getRadialAngle(rNode),
          y: getRadialRadius(rNode),
          cartX: cart.x,
          cartY: cart.y,
          data_: getRadialData(rNode),
          isLeaf: $$null3(getRadialChildren(rNode)),
          outgoingCount: (function() {
            if (maybeBilinked instanceof Just) {
              return length3(getOutgoing(maybeBilinked.value0));
            }
            ;
            if (maybeBilinked instanceof Nothing) {
              return 0;
            }
            ;
            throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.EdgeBundle (line 166, column 32 - line 168, column 31): " + [maybeBilinked.constructor.name]);
          })(),
          incomingCount: (function() {
            if (maybeBilinked instanceof Just) {
              return length3(getIncoming(maybeBilinked.value0));
            }
            ;
            if (maybeBilinked instanceof Nothing) {
              return 0;
            }
            ;
            throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.EdgeBundle (line 169, column 32 - line 171, column 31): " + [maybeBilinked.constructor.name]);
          })()
        });
      })(allRadial);
      return merged;
    };
  };
  var edgeBundle = function(config) {
    return function(inputNodes) {
      var tree2 = buildHierarchy({
        getName: config.getName
      })(inputNodes);
      var radialConfig = {
        innerRadius: config.innerRadius,
        outerRadius: config.outerRadius,
        startAngle: 0,
        endAngle: 2 * pi
      };
      var radialTree2 = radialCluster(radialConfig)(tree2);
      var bilinked = bilink(config.getImports)(tree2);
      var bundledLinks = generateBundledLinks(config.beta)(tree2)(radialTree2)(bilinked);
      var positionedNodes = extractPositionedNodes(bilinked)(radialTree2);
      return {
        nodes: positionedNodes,
        links: bundledLinks
      };
    };
  };

  // output/D3.Viz.TreeAPI.EdgeBundleViz/index.js
  var bind20 = /* @__PURE__ */ bind(bindD3v2M);
  var select13 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var discard8 = /* @__PURE__ */ discard(discardUnit);
  var discard12 = /* @__PURE__ */ discard8(bindD3v2M);
  var liftEffect9 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var show24 = /* @__PURE__ */ show(showInt);
  var width13 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var num6 = /* @__PURE__ */ num(numExprEvalD);
  var height13 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr8 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text11 = /* @__PURE__ */ text6(stringExprEvalD);
  var transform4 = /* @__PURE__ */ transform2(toAttributeValueString);
  var show112 = /* @__PURE__ */ show(showNumber);
  var path5 = /* @__PURE__ */ path(toAttributeValueString);
  var fill6 = /* @__PURE__ */ fill(toAttributeValueString);
  var stroke6 = /* @__PURE__ */ stroke(toAttributeValueString);
  var opacity3 = /* @__PURE__ */ opacity(toAttributeValueNumber);
  var attr1 = /* @__PURE__ */ attr3(toAttributeValueNumber);
  var renderTree8 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D);
  var ordRecord4 = /* @__PURE__ */ ordRecord();
  var ordRecordCons4 = /* @__PURE__ */ ordRecordCons(ordRecordNil)();
  var renderTree15 = /* @__PURE__ */ renderTree8(/* @__PURE__ */ ordRecord4(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons4({
    reflectSymbol: function() {
      return "target";
    }
  })(ordString))()({
    reflectSymbol: function() {
      return "source";
    }
  })(ordString))()({
    reflectSymbol: function() {
      return "path";
    }
  })(ordString)));
  var map44 = /* @__PURE__ */ map(functorArray);
  var x8 = /* @__PURE__ */ x(toAttributeValueNumber);
  var y8 = /* @__PURE__ */ y(toAttributeValueNumber);
  var fontSize4 = /* @__PURE__ */ fontSize(toAttributeValueNumber);
  var renderTree26 = /* @__PURE__ */ renderTree8(/* @__PURE__ */ ordRecord4(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons4({
    reflectSymbol: function() {
      return "shortName";
    }
  })(ordString))()({
    reflectSymbol: function() {
      return "outgoingCount";
    }
  })(ordInt))()({
    reflectSymbol: function() {
      return "isLeaf";
    }
  })(ordBoolean))()({
    reflectSymbol: function() {
      return "incomingCount";
    }
  })(ordInt))()({
    reflectSymbol: function() {
      return "fullName";
    }
  })(ordString))()({
    reflectSymbol: function() {
      return "cartY";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "cartX";
    }
  })(ordNumber)));
  var bind111 = /* @__PURE__ */ bind(bindAff);
  var liftEffect13 = /* @__PURE__ */ liftEffect(monadEffectAff);
  var radiansToDegrees = function(rad) {
    return rad * 180 / pi;
  };
  var drawEdgeBundle = function(selector) {
    return function(importData) {
      return runD3v2M(bind20(select13(selector))(function(container) {
        var centerX = 700 / 2;
        var centerY = 700 / 2;
        var config = {
          getName: function(v2) {
            return v2.name;
          },
          getImports: function(v2) {
            return v2.imports;
          },
          beta: 0.85,
          innerRadius: 50,
          outerRadius: 300
        };
        var result = edgeBundle(config)(importData);
        var nodes3 = filter(function(v2) {
          return v2.isLeaf;
        })(result.nodes);
        return discard12(liftEffect9(log2("Edge bundle: " + (show24(length3(nodes3)) + (" leaf nodes, " + (show24(length3(result.links)) + " links"))))))(function() {
          var linksTree = withChild(named(SVG.value)("svg")([width13(num6(700)), height13(num6(700)), viewBox(0)(0)(700)(700), attr8("class")(text11("edge-bundle-viz"))]))(withChild(named(Group.value)("chartGroup")([attr8("class")(text11("edge-bundle-content")), transform4(text11("translate(" + (show112(centerX) + ("," + (show112(centerY) + ")")))))]))(withChild(named(Group.value)("linksGroup")([attr8("class")(text11("links"))]))(joinData("links")("path")(result.links)(function(link5) {
            return elem3(Path.value)([path5(text11(link5.path)), fill6(text11("none")), stroke6(text11("steelblue")), opacity3(num6(0.4)), attr1("stroke-width")(num6(1.5)), attr8("class")(text11("link"))]);
          }))));
          return bind20(renderTree15(container)(linksTree))(function(linksSelections) {
            return bind20(liftEffect9(reselectD3v2("chartGroup")(linksSelections)))(function(chartGroupSel) {
              var nodeData = map44(function(n) {
                return {
                  fullName: n.fullName,
                  shortName: n.shortName,
                  cartX: n.cartX,
                  cartY: n.cartY,
                  isLeaf: n.isLeaf,
                  outgoingCount: n.outgoingCount,
                  incomingCount: n.incomingCount
                };
              })(nodes3);
              var getTextRotation = function(node) {
                var angle = radiansToDegrees(atan24(node.cartY)(node.cartX));
                var $90 = angle > 90 || angle < -90;
                if ($90) {
                  return angle + 180;
                }
                ;
                return angle;
              };
              var getTextAnchor = function(node) {
                var angle = radiansToDegrees(atan24(node.cartY)(node.cartX));
                var $91 = angle > 90 || angle < -90;
                if ($91) {
                  return "end";
                }
                ;
                return "start";
              };
              var getTextOffset = function(node) {
                var angle = radiansToDegrees(atan24(node.cartY)(node.cartX));
                var $92 = angle > 90 || angle < -90;
                if ($92) {
                  return -6;
                }
                ;
                return 6;
              };
              var nodesTree = withChild(named(Group.value)("nodesGroup")([attr8("class")(text11("nodes"))]))(joinData("nodeLabels")("text")(nodeData)(function(node) {
                return elem3(Text.value)([x8(num6(node.cartX)), y8(num6(node.cartY)), attr8("text-content")(text11(node.shortName)), fontSize4(num6(8)), attr8("text-anchor")(text11(getTextAnchor(node))), transform4(text11("rotate(" + (show112(getTextRotation(node)) + ("," + (show112(node.cartX) + ("," + (show112(node.cartY) + (") translate(" + (show112(getTextOffset(node)) + ", 3)"))))))))), attr8("class")(text11("node-label"))]);
              }));
              return bind20(renderTree26(chartGroupSel)(nodesTree))(function() {
                return liftEffect9(function __do7() {
                  log2("=== Hierarchical Edge Bundling (PureScript) ===")();
                  return log2("Flare library class dependencies")();
                });
              });
            });
          });
        });
      }));
    };
  };
  var edgeBundleViz = function(selector) {
    return launchAff_(bind111(loadFlareImportsData)(function(result) {
      if (result instanceof Left) {
        return liftEffect13(log2("Failed to load flare-imports data: " + result.value0));
      }
      ;
      if (result instanceof Right) {
        return liftEffect13(drawEdgeBundle(selector)(result.value0));
      }
      ;
      throw new Error("Failed pattern match at D3.Viz.TreeAPI.EdgeBundleViz (line 180, column 3 - line 182, column 72): " + [result.constructor.name]);
    }));
  };

  // output/D3.Viz.TreeAPI.GroupedBarChartExample/index.js
  var bind21 = /* @__PURE__ */ bind(bindAff);
  var discard9 = /* @__PURE__ */ discard(discardUnit);
  var discard13 = /* @__PURE__ */ discard9(bindAff);
  var liftEffect10 = /* @__PURE__ */ liftEffect(monadEffectAff);
  var pure18 = /* @__PURE__ */ pure(applicativeAff);
  var show25 = /* @__PURE__ */ show(showInt);
  var nub4 = /* @__PURE__ */ nub(ordString);
  var map45 = /* @__PURE__ */ map(functorArray);
  var bind112 = /* @__PURE__ */ bind(bindD3v2M);
  var select14 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var maximum5 = /* @__PURE__ */ maximum(ordNumber)(foldableArray);
  var v3Attr4 = /* @__PURE__ */ v3Attr(showNumber);
  var lit4 = /* @__PURE__ */ lit(numExprEvalD);
  var str4 = /* @__PURE__ */ str(stringExprEvalD);
  var show113 = /* @__PURE__ */ show(showNumber);
  var renderTree9 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D);
  var renderTree16 = /* @__PURE__ */ renderTree9(ordUnit);
  var liftEffect14 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var ordRecord5 = /* @__PURE__ */ ordRecord();
  var ordRecordCons5 = /* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(ordRecordNil)()({
    reflectSymbol: function() {
      return "state";
    }
  })(ordString))();
  var renderTree27 = /* @__PURE__ */ renderTree9(/* @__PURE__ */ ordRecord5(/* @__PURE__ */ ordRecordCons5({
    reflectSymbol: function() {
      return "bars";
    }
  })(/* @__PURE__ */ ordArray(/* @__PURE__ */ ordRecord5(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons5({
    reflectSymbol: function() {
      return "population";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "age";
    }
  })(ordString))))));
  var lookup10 = /* @__PURE__ */ lookup(ordString);
  var parsePopulationRow = function(line) {
    var v2 = parseCSVRow(line);
    if (v2.length === 8) {
      var under5 = fromMaybe(0)(fromString(trim(v2[1])));
      var age65plus = fromMaybe(0)(fromString(trim(v2[7])));
      var age5to13 = fromMaybe(0)(fromString(trim(v2[2])));
      var age45to64 = fromMaybe(0)(fromString(trim(v2[6])));
      var age25to44 = fromMaybe(0)(fromString(trim(v2[5])));
      var age18to24 = fromMaybe(0)(fromString(trim(v2[4])));
      var age14to17 = fromMaybe(0)(fromString(trim(v2[3])));
      return [{
        state: trim(v2[0]),
        age: "<10",
        population: under5 + age5to13 * 0.5
      }, {
        state: trim(v2[0]),
        age: "10-19",
        population: age5to13 * 0.5 + age14to17
      }, {
        state: trim(v2[0]),
        age: "20-29",
        population: age18to24 + age25to44 * 0.25
      }, {
        state: trim(v2[0]),
        age: "30-39",
        population: age25to44 * 0.5
      }, {
        state: trim(v2[0]),
        age: "40-49",
        population: age25to44 * 0.25
      }, {
        state: trim(v2[0]),
        age: "50-59",
        population: age45to64 * 0.6
      }, {
        state: trim(v2[0]),
        age: "60-69",
        population: age45to64 * 0.4
      }, {
        state: trim(v2[0]),
        age: "70-79",
        population: age65plus * 0.6
      }, {
        state: trim(v2[0]),
        age: "\u226580",
        population: age65plus * 0.4
      }];
    }
    ;
    return [];
  };
  var loadPopulationData = /* @__PURE__ */ (function() {
    return bind21(loadDataFile(USPopulationStateAgeCSV.value))(function(result) {
      if (result instanceof Left) {
        return discard13(liftEffect10(log2("Failed to load population data: " + result.value0)))(function() {
          return pure18([]);
        });
      }
      ;
      if (result instanceof Right) {
        var lines = split("\n")(result.value0);
        var dataLines = drop(1)(lines);
        var parsed = concatMap(parsePopulationRow)(dataLines);
        return discard13(liftEffect10(log2("Loaded " + (show25(length3(parsed)) + " population data points"))))(function() {
          return pure18(parsed);
        });
      }
      ;
      throw new Error("Failed pattern match at D3.Viz.TreeAPI.GroupedBarChartExample (line 66, column 3 - line 75, column 18): " + [result.constructor.name]);
    });
  })();
  var innerWidth3 = function(dims) {
    return dims.width - dims.marginLeft - dims.marginRight;
  };
  var innerHeight3 = function(dims) {
    return dims.height - dims.marginTop - dims.marginBottom;
  };
  var groupByState = function(data$prime) {
    var states = nub4(map45(function(v2) {
      return v2.state;
    })(data$prime));
    var getStateData = function(st) {
      return filter(function(d) {
        return d.state === st;
      })(data$prime);
    };
    return map45(function(st) {
      return {
        state: st,
        bars: getStateData(st)
      };
    })(states);
  };
  var getAges = /* @__PURE__ */ (function() {
    var $73 = map45(function(v2) {
      return v2.age;
    });
    return function($74) {
      return nub4($73($74));
    };
  })();
  var defaultDims2 = {
    width: 800,
    height: 500,
    marginTop: 20,
    marginRight: 20,
    marginBottom: 60,
    marginLeft: 60
  };
  var colorForAge = function(v2) {
    if (v2 === "<10") {
      return "#e8384f";
    }
    ;
    if (v2 === "10-19") {
      return "#fd612c";
    }
    ;
    if (v2 === "20-29") {
      return "#fd8d3c";
    }
    ;
    if (v2 === "30-39") {
      return "#feb078";
    }
    ;
    if (v2 === "40-49") {
      return "#ffe0b3";
    }
    ;
    if (v2 === "50-59") {
      return "#d7eaf3";
    }
    ;
    if (v2 === "60-69") {
      return "#abd9e9";
    }
    ;
    if (v2 === "70-79") {
      return "#74add1";
    }
    ;
    if (v2 === "\u226580") {
      return "#4575b4";
    }
    ;
    return "#999";
  };
  var drawGroupedBarChart = function(selector) {
    return function(populationData) {
      return runD3v2M(bind112(select14(selector))(function(container) {
        var iWidth = innerWidth3(defaultDims2);
        var iHeight = innerHeight3(defaultDims2);
        var stateGroups = groupByState(populationData);
        var ages = getAges(populationData);
        var numStates = length3(stateGroups);
        var numAges = length3(ages);
        var groupWidth = iWidth / toNumber(numStates);
        var barWidth = groupWidth / toNumber(numAges) * 0.9;
        var populationValues = map45(function(v2) {
          return v2.population;
        })(populationData);
        var maxPop = fromMaybe(6e6)(maximum5(populationValues));
        var xScale = {
          domain: {
            min: 0,
            max: toNumber(numStates)
          },
          range: {
            min: 0,
            max: iWidth
          }
        };
        var yScale = {
          domain: {
            min: 0,
            max: maxPop
          },
          range: {
            min: iHeight,
            max: 0
          }
        };
        var xAxis = axisBottom(xScale);
        var yAxis = axisLeft(yScale);
        var axesTree = withChild(named(SVG.value)("svg")([v3Attr4("width")(lit4(defaultDims2.width)), v3Attr4("height")(lit4(defaultDims2.height)), v3AttrStr("viewBox")(str4("0 0 " + (show113(defaultDims2.width) + (" " + show113(defaultDims2.height))))), v3AttrStr("class")(str4("grouped-bar-chart"))]))(withChildren(named(Group.value)("chartGroup")([v3AttrStr("class")(str4("chart-content")), v3AttrStr("transform")(str4("translate(" + (show113(defaultDims2.marginLeft) + ("," + (show113(defaultDims2.marginTop) + ")")))))]))([withChild(named(Group.value)("xAxis")([v3AttrStr("transform")(str4("translate(0," + (show113(iHeight) + ")"))), v3AttrStr("class")(str4("x-axis"))]))(renderAxis(xAxis)), withChild(named(Group.value)("yAxis")([v3AttrStr("class")(str4("y-axis"))]))(renderAxis(yAxis))]));
        return bind112(renderTree16(container)(axesTree))(function(axesSelections) {
          return bind112(liftEffect14(reselectD3v2("chartGroup")(axesSelections)))(function(chartGroupSel) {
            var barsTree = nestedJoin("stateGroups")("g")(stateGroups)(function(v2) {
              return v2.bars;
            })(function(bar) {
              var yPos = iHeight - bar.population / maxPop * iHeight;
              var stateIdx = fromMaybe(0)(findIndex(function(g2) {
                return g2.state === bar.state;
              })(stateGroups));
              var barHeight = bar.population / maxPop * iHeight;
              var ageIdx = fromMaybe(0)(findIndex(function(a3) {
                return a3 === bar.age;
              })(ages));
              var xPos = toNumber(stateIdx) * groupWidth + toNumber(ageIdx) * barWidth;
              return elem3(Rect.value)([v3Attr4("x")(lit4(xPos)), v3Attr4("y")(lit4(yPos)), v3Attr4("width")(lit4(barWidth)), v3Attr4("height")(lit4(barHeight)), v3AttrStr("fill")(str4(colorForAge(bar.age))), v3AttrStr("class")(str4("bar"))]);
            });
            return bind112(renderTree27(chartGroupSel)(barsTree))(function(barsSelections) {
              return liftEffect14(function __do7() {
                log2("=== Grouped Bar Chart (Tree API) ===")();
                log2("")();
                log2("Rendered " + (show25(length3(populationData)) + (" bars in " + (show25(numStates) + " groups"))))();
                var v2 = lookup10("svg")(axesSelections);
                if (v2 instanceof Just) {
                  return log2("\u2713 SVG created")();
                }
                ;
                if (v2 instanceof Nothing) {
                  return log2("\u2717 Missing SVG")();
                }
                ;
                throw new Error("Failed pattern match at D3.Viz.TreeAPI.GroupedBarChartExample (line 258, column 5 - line 260, column 45): " + [v2.constructor.name]);
              });
            });
          });
        });
      }));
    };
  };
  var groupedBarChart = function(selector) {
    return launchAff_(bind21(loadPopulationData)(function(populationData) {
      return liftEffect10(drawGroupedBarChart(selector)(populationData));
    }));
  };

  // output/D3.Viz.TreeAPI.HorizontalTreeViz/index.js
  var map46 = /* @__PURE__ */ map(functorList);
  var bind24 = /* @__PURE__ */ bind(bindList);
  var append18 = /* @__PURE__ */ append(semigroupList);
  var fromFoldable16 = /* @__PURE__ */ fromFoldable3(foldableList);
  var show26 = /* @__PURE__ */ show(showNumber);
  var bind113 = /* @__PURE__ */ bind(bindD3v2M);
  var select15 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var fromFoldable17 = /* @__PURE__ */ fromFoldable3(/* @__PURE__ */ foldableCofree(foldableList));
  var discard10 = /* @__PURE__ */ discard(discardUnit);
  var discard14 = /* @__PURE__ */ discard10(bindD3v2M);
  var liftEffect11 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var show114 = /* @__PURE__ */ show(showInt);
  var width14 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var num7 = /* @__PURE__ */ num(numExprEvalD);
  var height14 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr9 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text12 = /* @__PURE__ */ text6(stringExprEvalD);
  var path6 = /* @__PURE__ */ path(toAttributeValueString);
  var fill7 = /* @__PURE__ */ fill(toAttributeValueString);
  var stroke7 = /* @__PURE__ */ stroke(toAttributeValueString);
  var strokeWidth6 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var renderTree10 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D);
  var ordRecord6 = /* @__PURE__ */ ordRecord();
  var ordRecordCons6 = /* @__PURE__ */ ordRecordCons(ordRecordNil)();
  var ordRecordCons12 = /* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons6({
    reflectSymbol: function() {
      return "y";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "x";
    }
  })(ordNumber);
  var ordRecord13 = /* @__PURE__ */ ordRecord6(ordRecordCons12);
  var renderTree17 = /* @__PURE__ */ renderTree10(/* @__PURE__ */ ordRecord6(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons6({
    reflectSymbol: function() {
      return "target";
    }
  })(ordRecord13))()({
    reflectSymbol: function() {
      return "source";
    }
  })(ordRecord13)));
  var cx3 = /* @__PURE__ */ cx(toAttributeValueNumber);
  var cy3 = /* @__PURE__ */ cy(toAttributeValueNumber);
  var r4 = /* @__PURE__ */ r(toAttributeValueNumber);
  var x9 = /* @__PURE__ */ x(toAttributeValueNumber);
  var y9 = /* @__PURE__ */ y(toAttributeValueNumber);
  var textContent4 = /* @__PURE__ */ textContent2(toAttributeValueString);
  var fontSize5 = /* @__PURE__ */ fontSize(toAttributeValueNumber);
  var textAnchor3 = /* @__PURE__ */ textAnchor(toAttributeValueString);
  var renderTree28 = /* @__PURE__ */ renderTree10(/* @__PURE__ */ ordRecord6(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(ordRecordCons12)()({
    reflectSymbol: function() {
      return "value";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "name";
    }
  })(ordString))()({
    reflectSymbol: function() {
      return "height";
    }
  })(ordInt))()({
    reflectSymbol: function() {
      return "depth";
    }
  })(ordInt)));
  var bind25 = /* @__PURE__ */ bind(bindAff);
  var liftEffect15 = /* @__PURE__ */ liftEffect(monadEffectAff);
  var swapXY = function(t2) {
    var val = head(t2);
    var children3 = tail(t2);
    var swappedChildren = map46(swapXY)(children3);
    return mkTree((function() {
      var $85 = {};
      for (var $86 in val) {
        if ({}.hasOwnProperty.call(val, $86)) {
          $85[$86] = val[$86];
        }
        ;
      }
      ;
      $85.x = val.y;
      $85.y = val.x;
      return $85;
    })())(swappedChildren);
  };
  var makeLinks3 = function(tree$prime) {
    var makeLinksList = function(t2) {
      var val = head(t2);
      var children3 = tail(t2);
      var grandchildLinks = bind24(children3)(makeLinksList);
      var childLinks = bind24(children3)(function(child) {
        var childVal = head(child);
        return new Cons({
          source: {
            x: val.x,
            y: val.y
          },
          target: {
            x: childVal.x,
            y: childVal.y
          }
        }, Nil.value);
      });
      return append18(childLinks)(grandchildLinks);
    };
    return fromFoldable16(makeLinksList(tree$prime));
  };
  var linkPath2 = function(x1$prime) {
    return function(y1$prime) {
      return function(x2$prime) {
        return function(y2$prime) {
          return "M" + (show26(x1$prime) + ("," + (show26(y1$prime) + ("C" + (show26((x1$prime + x2$prime) / 2) + ("," + (show26(y1$prime) + (" " + (show26((x1$prime + x2$prime) / 2) + ("," + (show26(y2$prime) + (" " + (show26(x2$prime) + ("," + show26(y2$prime)))))))))))))));
        };
      };
    };
  };
  var drawHorizontalTree = function(selector) {
    return function(flareTree) {
      return runD3v2M(bind113(select15(selector))(function(container) {
        var config = {
          layerScale: defaultTreeConfig.layerScale,
          minSeparation: defaultTreeConfig.minSeparation,
          separation: defaultTreeConfig.separation,
          size: {
            width: 500 - 2 * 40,
            height: 750 - 2 * 40
          }
        };
        var positioned = tree(config)(flareTree);
        var horizontalTree = swapXY(positioned);
        var nodes3 = fromFoldable17(horizontalTree);
        var links3 = makeLinks3(horizontalTree);
        return discard14(liftEffect11(log2("Rendering horizontal tree: " + (show114(length3(nodes3)) + (" nodes, " + (show114(length3(links3)) + " links"))))))(function() {
          var linksTree = withChild(named(SVG.value)("svg")([width14(num7(750)), height14(num7(500)), viewBox(0)(0)(750)(500), attr9("class")(text12("horizontal-tree-viz"))]))(withChild(named(Group.value)("chartGroup")([attr9("class")(text12("tree-content"))]))(withChild(named(Group.value)("linksGroup")([attr9("class")(text12("links"))]))(joinData("links")("path")(links3)(function(link5) {
            return elem3(Path.value)([path6(text12(linkPath2(link5.source.x + 40)(link5.source.y + 40)(link5.target.x + 40)(link5.target.y + 40))), fill7(text12("none")), stroke7(text12("#999")), strokeWidth6(num7(1.5)), attr9("class")(text12("link"))]);
          }))));
          return bind113(renderTree17(container)(linksTree))(function(linksSelections) {
            return bind113(liftEffect11(reselectD3v2("chartGroup")(linksSelections)))(function(chartGroupSel) {
              var nodesTree = withChild(named(Group.value)("nodesGroup")([attr9("class")(text12("nodes"))]))(joinData("nodeGroups")("g")(nodes3)(function(node) {
                return withChildren(named(Group.value)("node-" + node.name)([attr9("class")(text12("node"))]))([elem3(Circle.value)([cx3(num7(node.x + 40)), cy3(num7(node.y + 40)), r4(num7(4)), fill7(text12("#69b3a2")), stroke7(text12("#fff")), strokeWidth6(num7(1.5))]), elem3(Text.value)([x9(num7(node.x + 40 + 8)), y9(num7(node.y + 40 + 4)), textContent4(text12(node.name)), fontSize5(num7(10)), textAnchor3(text12("start"))])]);
              }));
              return bind113(renderTree28(chartGroupSel)(nodesTree))(function() {
                return liftEffect11(function __do7() {
                  log2("=== Horizontal Tree Layout (Tree API) ===")();
                  log2("")();
                  log2("Flare visualization toolkit hierarchy (horizontal)")();
                  return log2("")();
                });
              });
            });
          });
        });
      }));
    };
  };
  var horizontalTreeViz = function(selector) {
    return launchAff_(bind25(loadFlareData)(function(result) {
      if (result instanceof Left) {
        return liftEffect15(log2("Failed to load Flare data: " + result.value0));
      }
      ;
      if (result instanceof Right) {
        return liftEffect15(drawHorizontalTree(selector)(result.value0));
      }
      ;
      throw new Error("Failed pattern match at D3.Viz.TreeAPI.HorizontalTreeViz (line 189, column 3 - line 191, column 74): " + [result.constructor.name]);
    }));
  };

  // output/D3.Viz.TreeAPI.LineChartExample/foreign.js
  var sin5 = Math.sin;
  var pi7 = Math.PI;

  // output/D3.Viz.TreeAPI.LineChartExample/index.js
  var show27 = /* @__PURE__ */ show(showNumber);
  var bind26 = /* @__PURE__ */ bind(bindD3v2M);
  var map47 = /* @__PURE__ */ map(functorArray);
  var minimum4 = /* @__PURE__ */ minimum(ordNumber)(foldableArray);
  var maximum6 = /* @__PURE__ */ maximum(ordNumber)(foldableArray);
  var width15 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var num8 = /* @__PURE__ */ num(numExprEvalD);
  var height15 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr10 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text13 = /* @__PURE__ */ text6(stringExprEvalD);
  var transform5 = /* @__PURE__ */ transform2(toAttributeValueString);
  var path7 = /* @__PURE__ */ path(toAttributeValueString);
  var fill8 = /* @__PURE__ */ fill(toAttributeValueString);
  var stroke8 = /* @__PURE__ */ stroke(toAttributeValueString);
  var strokeWidth7 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var renderTree11 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(ordUnit);
  var liftEffect16 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var show115 = /* @__PURE__ */ show(showInt);
  var lookup11 = /* @__PURE__ */ lookup(ordString);
  var lineData = /* @__PURE__ */ mapWithIndex3(function(i2) {
    return function(v2) {
      var x32 = toNumber(i2) * 0.1;
      var y32 = sin5(x32 * pi7) * 50 + 50;
      return {
        x: x32,
        y: y32
      };
    };
  })(/* @__PURE__ */ range2(0)(62));
  var innerWidth4 = function(dims) {
    return dims.width - dims.marginLeft - dims.marginRight;
  };
  var innerHeight4 = function(dims) {
    return dims.height - dims.marginTop - dims.marginBottom;
  };
  var pointsToPath = function(dims) {
    return function(points) {
      return function(minX) {
        return function(maxX) {
          return function(minY) {
            return function(maxY) {
              var iWidth = innerWidth4(dims);
              var xScale = function(val) {
                return (val - minX) / (maxX - minX) * iWidth;
              };
              var iHeight = innerHeight4(dims);
              var yScale = function(val) {
                return iHeight - (val - minY) / (maxY - minY) * iHeight;
              };
              var toCommand = function(v2) {
                return function(v1) {
                  if (v2 === 0) {
                    return "M " + (show27(xScale(v1.x)) + (" " + show27(yScale(v1.y))));
                  }
                  ;
                  return "L " + (show27(xScale(v1.x)) + (" " + show27(yScale(v1.y))));
                };
              };
              return joinWith(" ")(mapWithIndex3(toCommand)(points));
            };
          };
        };
      };
    };
  };
  var defaultDims3 = {
    width: 600,
    height: 300,
    marginTop: 20,
    marginRight: 20,
    marginBottom: 40,
    marginLeft: 50
  };
  var lineChart = /* @__PURE__ */ runD3v2M(/* @__PURE__ */ bind26(/* @__PURE__ */ select(selectionMD3v2Selection_D)("#viz"))(function(container) {
    var xValues = map47(function(v2) {
      return v2.x;
    })(lineData);
    var yValues = map47(function(v2) {
      return v2.y;
    })(lineData);
    var minX = fromMaybe(0)(minimum4(xValues));
    var maxX = fromMaybe(10)(maximum6(xValues));
    var minY = fromMaybe(0)(minimum4(yValues));
    var maxY = fromMaybe(100)(maximum6(yValues));
    var pathData = pointsToPath(defaultDims3)(lineData)(minX)(maxX)(minY)(maxY);
    var tree2 = withChild(named(SVG.value)("svg")([width15(num8(defaultDims3.width)), height15(num8(defaultDims3.height)), viewBox(0)(0)(defaultDims3.width)(defaultDims3.height), attr10("class")(text13("line-chart-tree"))]))(withChild(named(Group.value)("chartGroup")([attr10("class")(text13("chart-content")), transform5(text13("translate(" + (show27(defaultDims3.marginLeft) + ("," + (show27(defaultDims3.marginTop) + ")")))))]))(named(Path.value)("line")([path7(text13(pathData)), fill8(text13("none")), stroke8(text13("#2ecc71")), strokeWidth7(num8(2)), attr10("class")(text13("line"))])));
    return bind26(renderTree11(container)(tree2))(function(selections) {
      return liftEffect16(function __do7() {
        log2("=== Line Chart (Tree API) ===")();
        log2("")();
        log2("Rendered line with " + (show115(length3(lineData)) + " points"))();
        (function() {
          var v2 = lookup11("svg")(selections);
          if (v2 instanceof Just) {
            return log2("\u2713 SVG created")();
          }
          ;
          if (v2 instanceof Nothing) {
            return log2("\u2717 Missing SVG")();
          }
          ;
          throw new Error("Failed pattern match at D3.Viz.TreeAPI.LineChartExample (line 128, column 5 - line 130, column 45): " + [v2.constructor.name]);
        })();
        (function() {
          var v2 = lookup11("chartGroup")(selections);
          if (v2 instanceof Just) {
            return log2("\u2713 Chart group created")();
          }
          ;
          if (v2 instanceof Nothing) {
            return log2("\u2717 Missing chart group")();
          }
          ;
          throw new Error("Failed pattern match at D3.Viz.TreeAPI.LineChartExample (line 132, column 5 - line 134, column 53): " + [v2.constructor.name]);
        })();
        (function() {
          var v2 = lookup11("line")(selections);
          if (v2 instanceof Just) {
            return log2("\u2713 Line path created")();
          }
          ;
          if (v2 instanceof Nothing) {
            return log2("\u2717 Missing line path")();
          }
          ;
          throw new Error("Failed pattern match at D3.Viz.TreeAPI.LineChartExample (line 136, column 5 - line 138, column 51): " + [v2.constructor.name]);
        })();
        log2("")();
        return log2("Expected: Green sine wave curve")();
      });
    });
  }));

  // output/D3.Viz.TreeAPI.MultiLineChartExample/foreign.js
  function setTimeout_(effect) {
    return (delay2) => () => {
      return setTimeout(() => effect(), delay2);
    };
  }
  function clearTimeout_(timeoutId) {
    return () => {
      clearTimeout(timeoutId);
    };
  }

  // output/PSD3.Tooltip/foreign.js
  var tooltip = null;
  var tooltipConfig = null;
  var ensureTooltip = () => {
    if (!tooltip) {
      tooltip = document.createElement("div");
      tooltip.className = "psd3-tooltip";
      tooltip.style.cssText = `
      position: fixed;
      display: none;
      pointer-events: none;
      z-index: 10000;
    `;
      document.body.appendChild(tooltip);
      if (tooltipConfig) {
        applyConfig(tooltipConfig);
      }
    }
    return tooltip;
  };
  var applyConfig = (config) => {
    const el = ensureTooltip();
    if (config.background) el.style.background = config.background;
    if (config.color) el.style.color = config.color;
    if (config.padding) el.style.padding = config.padding;
    if (config.borderRadius) el.style.borderRadius = config.borderRadius;
    if (config.fontSize) el.style.fontSize = config.fontSize;
    if (config.fontFamily) el.style.fontFamily = config.fontFamily;
    if (config.border) el.style.border = config.border;
    if (config.boxShadow) el.style.boxShadow = config.boxShadow;
    if (config.maxWidth) el.style.maxWidth = config.maxWidth;
    if (config.lineHeight) el.style.lineHeight = config.lineHeight;
    if (config.backdropFilter) {
      el.style.backdropFilter = config.backdropFilter;
      el.style.webkitBackdropFilter = config.backdropFilter;
    }
  };
  var showTooltip_ = (content3) => (x32) => (y32) => () => {
    const el = ensureTooltip();
    el.innerHTML = content3;
    el.style.display = "block";
    const rect2 = el.getBoundingClientRect();
    const viewW = window.innerWidth;
    const viewH = window.innerHeight;
    let posX3 = x32 + 15;
    let posY3 = y32 + 10;
    if (posX3 + rect2.width > viewW) posX3 = x32 - rect2.width - 15;
    if (posY3 + rect2.height > viewH) posY3 = y32 - rect2.height - 10;
    el.style.left = posX3 + "px";
    el.style.top = posY3 + "px";
  };
  var hideTooltip_ = () => {
    ensureTooltip().style.display = "none";
  };

  // output/PSD3.Tooltip/index.js
  var showTooltip = showTooltip_;
  var hideTooltip = hideTooltip_;

  // output/D3.Viz.TreeAPI.MultiLineChartExample/index.js
  var bind27 = /* @__PURE__ */ bind(bindMaybe);
  var pure19 = /* @__PURE__ */ pure(applicativeMaybe);
  var bind114 = /* @__PURE__ */ bind(bindAff);
  var discard11 = /* @__PURE__ */ discard(discardUnit);
  var discard15 = /* @__PURE__ */ discard11(bindAff);
  var liftEffect17 = /* @__PURE__ */ liftEffect(monadEffectAff);
  var pure110 = /* @__PURE__ */ pure(applicativeAff);
  var show28 = /* @__PURE__ */ show(showInt);
  var compare8 = /* @__PURE__ */ compare(ordString);
  var map48 = /* @__PURE__ */ map(functorArray);
  var bind28 = /* @__PURE__ */ bind(bindD3v2M);
  var select16 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var liftEffect18 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var maximum7 = /* @__PURE__ */ maximum(ordNumber)(foldableArray);
  var nub5 = /* @__PURE__ */ nub(ordString);
  var show116 = /* @__PURE__ */ show(showNumber);
  var foldl11 = /* @__PURE__ */ foldl(foldableArray);
  var v3Attr5 = /* @__PURE__ */ v3Attr(showNumber);
  var lit5 = /* @__PURE__ */ lit(numExprEvalD);
  var str5 = /* @__PURE__ */ str(stringExprEvalD);
  var ordRecord7 = /* @__PURE__ */ ordRecord();
  var ordRecordCons7 = /* @__PURE__ */ ordRecordCons(ordRecordNil)();
  var divisionIsSymbol = {
    reflectSymbol: function() {
      return "division";
    }
  };
  var renderTree18 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(/* @__PURE__ */ ordRecord7(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons7({
    reflectSymbol: function() {
      return "points";
    }
  })(/* @__PURE__ */ ordArray(/* @__PURE__ */ ordRecord7(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons7({
    reflectSymbol: function() {
      return "rate";
    }
  })(ordNumber))()(divisionIsSymbol)(ordString))()({
    reflectSymbol: function() {
      return "date";
    }
  })(ordString)))))()(divisionIsSymbol)(ordString)));
  var compare12 = /* @__PURE__ */ compare(ordNumber);
  var discard22 = /* @__PURE__ */ discard11(bindD3v2M);
  var lookup12 = /* @__PURE__ */ lookup(ordString);
  var on4 = /* @__PURE__ */ on2(selectionMD3v2Selection_D);
  var pure32 = /* @__PURE__ */ pure(applicativeD3v2M);
  var parseDataPoint = function(line) {
    var v2 = parseCSVRow(line);
    if (v2.length === 3) {
      return bind27(fromString(trim(v2[2])))(function(rate) {
        return pure19({
          division: trim(v2[0]),
          date: trim(v2[1]),
          rate
        });
      });
    }
    ;
    return Nothing.value;
  };
  var loadUnemploymentData = /* @__PURE__ */ (function() {
    return bind114(loadDataFile(MetroUnemploymentCSV.value))(function(result) {
      if (result instanceof Left) {
        return discard15(liftEffect17(log2("Failed to load unemployment data: " + result.value0)))(function() {
          return pure110([]);
        });
      }
      ;
      if (result instanceof Right) {
        var lines = split("\n")(result.value0);
        var dataLines = drop(1)(lines);
        var parsed = mapMaybe(parseDataPoint)(dataLines);
        return discard15(liftEffect17(log2("Loaded " + (show28(length3(parsed)) + " unemployment data points"))))(function() {
          return pure110(parsed);
        });
      }
      ;
      throw new Error("Failed pattern match at D3.Viz.TreeAPI.MultiLineChartExample (line 67, column 3 - line 76, column 18): " + [result.constructor.name]);
    });
  })();
  var groupByDivision = function(dataPoints) {
    var toSeries = function(group4) {
      var points = toArray4(group4);
      var first = head4(group4);
      return {
        division: first.division,
        points: sortBy(on(compare8)(function(v2) {
          return v2.date;
        }))(points)
      };
    };
    var grouped = groupBy(function(a3) {
      return function(b10) {
        return a3.division === b10.division;
      };
    })(sortBy(on(compare8)(function(v2) {
      return v2.division;
    }))(dataPoints));
    return map48(toSeries)(grouped);
  };
  var drawMultiLineChart = function(selector) {
    return function(unemploymentData) {
      return runD3v2M(bind28(select16(selector))(function(container) {
        return bind28(liftEffect18($$new(Nothing.value)))(function(hideTimeoutRef) {
          var series = groupByDivision(unemploymentData);
          var maxRate = fromMaybe(20)(maximum7(map48(function(v2) {
            return v2.rate;
          })(unemploymentData)));
          var margin = {
            top: 20,
            right: 20,
            bottom: 50,
            left: 60
          };
          var plotHeight = 600 - margin.top - margin.bottom;
          var yScale = {
            domain: {
              min: 0,
              max: maxRate
            },
            range: {
              min: plotHeight,
              max: 0
            }
          };
          var scaleY5 = function(rate) {
            var rangeSpan = yScale.range.max - yScale.range.min;
            var domainSpan = yScale.domain.max - yScale.domain.min;
            var normalized = (rate - yScale.domain.min) / domainSpan;
            return yScale.range.min + normalized * rangeSpan;
          };
          var plotWidth = 928 - margin.left - margin.right;
          var allDates = nub5(map48(function(v2) {
            return v2.date;
          })(unemploymentData));
          var dateCount = toNumber(length3(allDates));
          var xScale = {
            domain: {
              min: 0,
              max: dateCount - 1
            },
            range: {
              min: 0,
              max: plotWidth
            }
          };
          var scaleX5 = function(date2) {
            var rangeSpan = xScale.range.max - xScale.range.min;
            var idx = fromMaybe(0)(findIndex(function(d) {
              return d === date2;
            })(allDates));
            var value20 = toNumber(idx);
            var domainSpan = xScale.domain.max - xScale.domain.min;
            var normalized = (value20 - xScale.domain.min) / domainSpan;
            return xScale.range.min + normalized * rangeSpan;
          };
          var linePath = function(points) {
            var v2 = uncons4(points);
            if (v2 instanceof Nothing) {
              return "";
            }
            ;
            if (v2 instanceof Just) {
              var moveCmd = "M" + (show116(scaleX5(v2.value0.head.date)) + ("," + show116(scaleY5(v2.value0.head.rate))));
              var lineSegments = map48(function(p2) {
                return "L" + (show116(scaleX5(p2.date)) + ("," + show116(scaleY5(p2.rate))));
              })(v2.value0.tail);
              return moveCmd + foldl11(function(acc) {
                return function(seg) {
                  return acc + seg;
                };
              })("")(lineSegments);
            }
            ;
            throw new Error("Failed pattern match at D3.Viz.TreeAPI.MultiLineChartExample (line 141, column 9 - line 146, column 73): " + [v2.constructor.name]);
          };
          var tree2 = withChild(named(SVG.value)("svg")([v3Attr5("width")(lit5(928)), v3Attr5("height")(lit5(600)), v3AttrStr("viewBox")(str5("0 0 " + (show116(928) + (" " + show116(600))))), v3AttrStr("class")(str5("multi-line-chart"))]))(withChildren(named(Group.value)("plot-area")([v3AttrStr("transform")(str5("translate(" + (show116(margin.left) + ("," + (show116(margin.top) + ")")))))]))([withChild(named(Group.value)("x-axis")([v3AttrStr("transform")(str5("translate(0," + (show116(plotHeight) + ")"))), v3AttrStr("class")(str5("x-axis"))]))(renderAxis(axisBottom(xScale))), withChild(named(Group.value)("y-axis")([v3AttrStr("class")(str5("y-axis"))]))(renderAxis(axisLeft(yScale))), elem3(Text.value)([v3AttrStr("transform")(str5("rotate(-90)")), v3Attr5("x")(lit5(-(plotHeight / 2))), v3Attr5("y")(lit5(-40)), v3AttrStr("text-anchor")(str5("middle")), v3Attr5("font-size")(lit5(12)), v3AttrStr("textContent")(str5("Unemployment Rate (%)"))]), joinData("lines")("path")(series)(function(v2) {
            return elem3(Path.value)([v3AttrFnStr("d")(function(s3) {
              return linePath(s3.points);
            }), v3AttrStr("fill")(str5("none")), v3AttrStr("stroke")(str5("#ddd")), v3Attr5("stroke-width")(lit5(1.5)), v3AttrStr("class")(str5("line"))]);
          })]));
          return bind28(renderTree18(container)(tree2))(function(selections) {
            var findNearestPoint = function(s3) {
              return function(mouseX) {
                var plotX = mouseX - margin.left;
                var sortedPoints = sortBy(on(compare8)(function(v3) {
                  return v3.date;
                }))(s3.points);
                var withDistances = map48(function(p2) {
                  return {
                    point: p2,
                    dist: abs(scaleX5(p2.date) - plotX)
                  };
                })(sortedPoints);
                var v2 = head2(sortBy(on(compare12)(function(v1) {
                  return v1.dist;
                }))(withDistances));
                if (v2 instanceof Just) {
                  return new Just(v2.value0.point);
                }
                ;
                if (v2 instanceof Nothing) {
                  return Nothing.value;
                }
                ;
                throw new Error("Failed pattern match at D3.Viz.TreeAPI.MultiLineChartExample (line 211, column 9 - line 213, column 29): " + [v2.constructor.name]);
              };
            };
            return discard22((function() {
              var v2 = lookup12("lines")(selections);
              if (v2 instanceof Just) {
                return bind28(on4(onMouseMoveWithInfo(function(v1) {
                  return function __do7() {
                    var maybeTimeout = read(hideTimeoutRef)();
                    (function() {
                      if (maybeTimeout instanceof Just) {
                        clearTimeout_(maybeTimeout.value0)();
                        return write(Nothing.value)(hideTimeoutRef)();
                      }
                      ;
                      if (maybeTimeout instanceof Nothing) {
                        return unit;
                      }
                      ;
                      throw new Error("Failed pattern match at D3.Viz.TreeAPI.MultiLineChartExample (line 225, column 9 - line 229, column 37): " + [maybeTimeout.constructor.name]);
                    })();
                    var v22 = findNearestPoint(v1.datum)(v1.offsetX);
                    if (v22 instanceof Just) {
                      var content3 = "<strong>" + (v1.datum.division + ("</strong><br/>" + (v22.value0.date + (": " + (show116(v22.value0.rate) + "%")))));
                      return showTooltip(content3)(v1.pageX)(v1.pageY)();
                    }
                    ;
                    if (v22 instanceof Nothing) {
                      return unit;
                    }
                    ;
                    throw new Error("Failed pattern match at D3.Viz.TreeAPI.MultiLineChartExample (line 232, column 9 - line 237, column 37): " + [v22.constructor.name]);
                  };
                }))(v2.value0))(function() {
                  return bind28(on4(onMouseLeaveWithInfo(function(v1) {
                    return function __do7() {
                      var timeoutId = setTimeout_(hideTooltip)(150)();
                      return write(new Just(timeoutId))(hideTimeoutRef)();
                    };
                  }))(v2.value0))(function() {
                    return pure32(unit);
                  });
                });
              }
              ;
              if (v2 instanceof Nothing) {
                return pure32(unit);
              }
              ;
              throw new Error("Failed pattern match at D3.Viz.TreeAPI.MultiLineChartExample (line 219, column 3 - line 249, column 25): " + [v2.constructor.name]);
            })())(function() {
              return liftEffect18(function __do7() {
                log2("=== Multi-Line Chart ===")();
                log2("")();
                log2("Metro areas: " + show28(length3(series)))();
                log2("Data points: " + show28(length3(unemploymentData)))();
                return log2("")();
              });
            });
          });
        });
      }));
    };
  };
  var multiLineChart = function(selector) {
    return launchAff_(bind114(loadUnemploymentData)(function(unemploymentData) {
      return liftEffect17(drawMultiLineChart(selector)(unemploymentData));
    }));
  };

  // output/D3.Viz.TreeAPI.NestedElementsExample/index.js
  var bind29 = /* @__PURE__ */ bind(bindD3v2M);
  var width16 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var num9 = /* @__PURE__ */ num(numExprEvalD);
  var height16 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr11 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text14 = /* @__PURE__ */ text6(stringExprEvalD);
  var transform6 = /* @__PURE__ */ transform2(toAttributeValueString);
  var cx4 = /* @__PURE__ */ cx(toAttributeValueNumber);
  var cy4 = /* @__PURE__ */ cy(toAttributeValueNumber);
  var r5 = /* @__PURE__ */ r(toAttributeValueNumber);
  var fill9 = /* @__PURE__ */ fill(toAttributeValueString);
  var stroke9 = /* @__PURE__ */ stroke(toAttributeValueString);
  var strokeWidth8 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var x10 = /* @__PURE__ */ x(toAttributeValueNumber);
  var y10 = /* @__PURE__ */ y(toAttributeValueNumber);
  var textContent5 = /* @__PURE__ */ textContent2(toAttributeValueString);
  var textAnchor4 = /* @__PURE__ */ textAnchor(toAttributeValueString);
  var fontSize6 = /* @__PURE__ */ fontSize(toAttributeValueNumber);
  var renderTree19 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(ordUnit);
  var liftEffect19 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var lookup13 = /* @__PURE__ */ lookup(ordString);
  var show29 = /* @__PURE__ */ show(showInt);
  var testNestedElements = /* @__PURE__ */ runD3v2M(/* @__PURE__ */ bind29(/* @__PURE__ */ select(selectionMD3v2Selection_D)("#viz"))(function(container) {
    var tree2 = withChild(named(SVG.value)("svg")([width16(num9(600)), height16(num9(400)), viewBox(0)(0)(600)(400), attr11("id")(text14("nested-example-svg"))]))(withChildren(named(Group.value)("mainGroup")([attr11("class")(text14("main-group"))]))([withChildren(named(Group.value)("node1")([attr11("class")(text14("node")), transform6(text14("translate(100, 100)"))]))([named(Circle.value)("node1Circle")([cx4(num9(0)), cy4(num9(0)), r5(num9(25)), fill9(text14("steelblue")), stroke9(text14("white")), strokeWidth8(num9(2))]), named(Text.value)("node1Label")([x10(num9(0)), y10(num9(40)), textContent5(text14("Node A")), textAnchor4(text14("middle")), fontSize6(num9(14))])]), withChildren(named(Group.value)("node2")([attr11("class")(text14("node")), transform6(text14("translate(300, 150)"))]))([named(Circle.value)("node2Circle")([cx4(num9(0)), cy4(num9(0)), r5(num9(20)), fill9(text14("orange")), stroke9(text14("white")), strokeWidth8(num9(2))]), named(Text.value)("node2Label")([x10(num9(0)), y10(num9(35)), textContent5(text14("Node B")), textAnchor4(text14("middle")), fontSize6(num9(14))])]), withChildren(named(Group.value)("node3")([attr11("class")(text14("node")), transform6(text14("translate(500, 100)"))]))([named(Circle.value)("node3Circle")([cx4(num9(0)), cy4(num9(0)), r5(num9(30)), fill9(text14("green")), stroke9(text14("white")), strokeWidth8(num9(2))]), named(Text.value)("node3Label")([x10(num9(0)), y10(num9(45)), textContent5(text14("Node C")), textAnchor4(text14("middle")), fontSize6(num9(14))])])]));
    return bind29(renderTree19(container)(tree2))(function(selections) {
      return liftEffect19(function __do7() {
        log2("=== Nested Elements Test ===")();
        log2("")();
        log2("Structure: SVG \u2192 Group \u2192 (Node1, Node2, Node3)")();
        log2("           Each Node \u2192 (Circle + Text)")();
        log2("")();
        var checkSelection = function(name16) {
          var v2 = lookup13(name16)(selections);
          if (v2 instanceof Just) {
            return log2("\u2713 " + name16);
          }
          ;
          if (v2 instanceof Nothing) {
            return log2("\u2717 Missing: " + name16);
          }
          ;
          throw new Error("Failed pattern match at D3.Viz.TreeAPI.NestedElementsExample (line 118, column 31 - line 120, column 57): " + [v2.constructor.name]);
        };
        log2("Top-level:")();
        checkSelection("svg")();
        checkSelection("mainGroup")();
        log2("\nNode 1 (steelblue at 100, 100):")();
        checkSelection("node1")();
        checkSelection("node1Circle")();
        checkSelection("node1Label")();
        log2("\nNode 2 (orange at 300, 150):")();
        checkSelection("node2")();
        checkSelection("node2Circle")();
        checkSelection("node2Label")();
        log2("\nNode 3 (green at 500, 100):")();
        checkSelection("node3")();
        checkSelection("node3Circle")();
        checkSelection("node3Label")();
        log2("\n" + (show29(size(selections)) + " total selections in map"))();
        log2("\n=== SUCCESS CRITERIA ===")();
        log2("\u2713 Multi-level nesting works (Group \u2192 Circle + Text)")();
        log2("\u2713 withChildren handles arrays of subtrees")();
        log2("\u2713 All named nodes are accessible via Map")();
        log2("")();
        log2("NEXT: Need data joins to generate this structure from Array data")();
        return log2("      instead of manually creating each node.")();
      });
    });
  }));

  // output/DataViz.Layout.Hierarchy.Pack/index.js
  var elemIndex2 = /* @__PURE__ */ elemIndex(eqInt);
  var append19 = /* @__PURE__ */ append(semigroupArray);
  var map49 = /* @__PURE__ */ map(functorArray);
  var min8 = /* @__PURE__ */ min(ordNumber);
  var max11 = /* @__PURE__ */ max(ordNumber);
  var insert8 = /* @__PURE__ */ insert(ordInt);
  var fromFoldable18 = /* @__PURE__ */ fromFoldable6(ordInt)(foldableArray);
  var sortWith2 = /* @__PURE__ */ sortWith(ordNumber);
  var foldl12 = /* @__PURE__ */ foldl(foldableArray);
  var max1 = /* @__PURE__ */ max(ordInt);
  var mod5 = /* @__PURE__ */ mod(euclideanRingInt);
  var compare9 = /* @__PURE__ */ compare(ordInt);
  var compare13 = /* @__PURE__ */ compare(ordNumber);
  var map115 = /* @__PURE__ */ map(functorMaybe);
  var apply4 = /* @__PURE__ */ apply(applyMaybe);
  var bind30 = /* @__PURE__ */ bind(bindMaybe);
  var lookup14 = /* @__PURE__ */ lookup(ordInt);
  var pure20 = /* @__PURE__ */ pure(applicativeMaybe);
  var minimumBy2 = /* @__PURE__ */ minimumBy(foldableArray);
  var comparing2 = /* @__PURE__ */ comparing(ordNumber);
  var PackNode = /* @__PURE__ */ (function() {
    function PackNode2(value0) {
      this.value0 = value0;
    }
    ;
    PackNode2.create = function(value0) {
      return new PackNode2(value0);
    };
    return PackNode2;
  })();
  var NoCollision = /* @__PURE__ */ (function() {
    function NoCollision2() {
    }
    ;
    NoCollision2.value = new NoCollision2();
    return NoCollision2;
  })();
  var CollisionFromJ = /* @__PURE__ */ (function() {
    function CollisionFromJ2(value0) {
      this.value0 = value0;
    }
    ;
    CollisionFromJ2.create = function(value0) {
      return new CollisionFromJ2(value0);
    };
    return CollisionFromJ2;
  })();
  var CollisionFromK = /* @__PURE__ */ (function() {
    function CollisionFromK2(value0) {
      this.value0 = value0;
    }
    ;
    CollisionFromK2.create = function(value0) {
      return new CollisionFromK2(value0);
    };
    return CollisionFromK2;
  })();
  var shortenChainOnly = function(aId) {
    return function(jId) {
      return function(chain) {
        var v2 = elemIndex2(jId)(chain);
        var v1 = elemIndex2(aId)(chain);
        if (v1 instanceof Just && v2 instanceof Just) {
          var $135 = v2.value0 > v1.value0;
          if ($135) {
            var before = take(v1.value0 + 1 | 0)(chain);
            var after = drop(v2.value0)(chain);
            return append19(before)(after);
          }
          ;
          var $136 = v2.value0 < v1.value0;
          if ($136) {
            return slice(v2.value0)(v1.value0 + 1 | 0)(chain);
          }
          ;
          return chain;
        }
        ;
        return chain;
      };
    };
  };
  var scaleToSize = function(config) {
    return function(v2) {
      var scaleNode = function(scale) {
        return function(parentX) {
          return function(parentY) {
            return function(v1) {
              var scaledY = parentY + scale * v1.value0.y;
              var scaledX = parentX + scale * v1.value0.x;
              var scaledR = scale * v1.value0.r;
              return new PackNode({
                data_: v1.value0.data_,
                depth: v1.value0.depth,
                height: v1.value0.height,
                value: v1.value0.value,
                x: scaledX,
                y: scaledY,
                r: scaledR,
                children: map49(scaleNode(scale)(scaledX)(scaledY))(v1.value0.children)
              });
            };
          };
        };
      };
      var k = min8(config.size.width)(config.size.height) / (2 * v2.value0.r);
      var scaledRootR = k * v2.value0.r;
      var centerY = config.size.height / 2;
      var centerX = config.size.width / 2;
      return new PackNode({
        data_: v2.value0.data_,
        depth: v2.value0.depth,
        height: v2.value0.height,
        value: v2.value0.value,
        x: centerX,
        y: centerY,
        r: scaledRootR,
        children: map49(scaleNode(k)(centerX)(centerY))(v2.value0.children)
      });
    };
  };
  var place = function(b10) {
    return function(a3) {
      return function(c2) {
        var dy = b10.y - a3.y;
        var dx = b10.x - a3.x;
        var d2 = dx * dx + dy * dy;
        var $147 = d2 !== 0;
        if ($147) {
          var b22 = (b10.r + c2.r) * (b10.r + c2.r);
          var a22 = (a3.r + c2.r) * (a3.r + c2.r);
          var $148 = a22 > b22;
          if ($148) {
            var x32 = (d2 + b22 - a22) / (2 * d2);
            var y32 = sqrt(max11(0)(b22 / d2 - x32 * x32));
            return {
              x: b10.x - x32 * dx - y32 * dy,
              y: b10.y - x32 * dy + y32 * dx,
              r: c2.r
            };
          }
          ;
          var x32 = (d2 + a22 - b22) / (2 * d2);
          var y32 = sqrt(max11(0)(a22 / d2 - x32 * x32));
          return {
            x: a3.x + x32 * dx - y32 * dy,
            y: a3.y + x32 * dy + y32 * dx,
            r: c2.r
          };
        }
        ;
        return {
          x: a3.x + c2.r,
          y: a3.y,
          r: c2.r
        };
      };
    };
  };
  var insertInChain = function(aId) {
    return function(_bId) {
      return function(newId2) {
        return function(chain) {
          var v2 = elemIndex2(aId)(chain);
          if (v2 instanceof Nothing) {
            return chain;
          }
          ;
          if (v2 instanceof Just) {
            return fromMaybe(chain)(insertAt(v2.value0 + 1 | 0)(newId2)(chain));
          }
          ;
          throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 174, column 3 - line 178, column 62): " + [v2.constructor.name]);
        };
      };
    };
  };
  var insertBetween = function(aId) {
    return function(bId) {
      return function(newCircle) {
        return function(state3) {
          var newCircles = insert8(state3.nextId)(newCircle)(state3.circles);
          var newChain = insertInChain(aId)(bId)(state3.nextId)(state3.frontChain);
          return {
            circles: newCircles,
            frontChain: newChain,
            nextId: state3.nextId + 1 | 0
          };
        };
      };
    };
  };
  var initState = function(c0) {
    return function(c1) {
      return function(c2) {
        var c1$prime = {
          r: c1.r,
          x: c0.r,
          y: 0
        };
        var c0$prime = {
          r: c0.r,
          x: -c1.r,
          y: 0
        };
        var c2$prime = place(c1$prime)(c0$prime)(c2);
        var circles = fromFoldable18([new Tuple(0, c0$prime), new Tuple(1, c1$prime), new Tuple(2, c2$prime)]);
        return {
          circles,
          frontChain: [0, 2, 1],
          nextId: 3
        };
      };
    };
  };
  var hierarchy = function(v2) {
    var go2 = function(node) {
      return function(depth) {
        if (node.children instanceof Nothing) {
          return new PackNode({
            data_: node.data_,
            depth,
            height: 0,
            value: fromMaybe(0)(node.value),
            children: [],
            x: 0,
            y: 0,
            r: 0
          });
        }
        ;
        if (node.children instanceof Just) {
          var childNodes2 = map49(function(v1) {
            return go2(v1)(depth + 1 | 0);
          })(node.children.value0);
          var sortedChildren = sortWith2(function(v1) {
            return -v1.value0.value;
          })(childNodes2);
          var sumValue = foldl12(function(acc) {
            return function(v1) {
              return acc + v1.value0.value;
            };
          })(0)(sortedChildren);
          var childHeights = map49(function(v1) {
            return v1.value0.height;
          })(sortedChildren);
          var maxChildHeight = foldl12(max1)(0)(childHeights);
          return new PackNode({
            data_: node.data_,
            depth,
            height: maxChildHeight + 1 | 0,
            value: sumValue,
            children: sortedChildren,
            x: 0,
            y: 0,
            r: 0
          });
        }
        ;
        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 672, column 5 - line 704, column 14): " + [node.children.constructor.name]);
      };
    };
    return go2(v2)(0);
  };
  var getPrevInChain = function(nodeId) {
    return function(chain) {
      var v2 = elemIndex2(nodeId)(chain);
      if (v2 instanceof Nothing) {
        return Nothing.value;
      }
      ;
      if (v2 instanceof Just) {
        var n = length3(chain);
        var prevIdx = mod5((v2.value0 - 1 | 0) + n | 0)(n);
        return index(chain)(prevIdx);
      }
      ;
      throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 241, column 3 - line 248, column 34): " + [v2.constructor.name]);
    };
  };
  var getNextInChain = function(nodeId) {
    return function(chain) {
      var v2 = elemIndex2(nodeId)(chain);
      if (v2 instanceof Nothing) {
        return Nothing.value;
      }
      ;
      if (v2 instanceof Just) {
        var nextIdx = mod5(v2.value0 + 1 | 0)(length3(chain));
        return index(chain)(nextIdx);
      }
      ;
      throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 230, column 3 - line 236, column 34): " + [v2.constructor.name]);
    };
  };
  var getNextId = function(nodeId) {
    return function(chain) {
      var v2 = elemIndex2(nodeId)(chain);
      if (v2 instanceof Nothing) {
        return Nothing.value;
      }
      ;
      if (v2 instanceof Just) {
        var nextIdx = mod5(v2.value0 + 1 | 0)(length3(chain));
        return index(chain)(nextIdx);
      }
      ;
      throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 138, column 3 - line 144, column 34): " + [v2.constructor.name]);
    };
  };
  var eqPackNode = function(dictEq) {
    var eq27 = eq(dictEq);
    return {
      eq: function(x32) {
        return function(y32) {
          return eq(eqArray(eqPackNode(dictEq)))(x32.value0.children)(y32.value0.children) && eq27(x32.value0.data_)(y32.value0.data_) && x32.value0.depth === y32.value0.depth && x32.value0.height === y32.value0.height && x32.value0.r === y32.value0.r && x32.value0.value === y32.value0.value && x32.value0.x === y32.value0.x && x32.value0.y === y32.value0.y;
        };
      }
    };
  };
  var ordPackNode = function(dictOrd) {
    var compare24 = compare(dictOrd);
    var eqPackNode1 = eqPackNode(dictOrd.Eq0());
    return {
      compare: function(x32) {
        return function(y32) {
          var v2 = compare(ordArray(ordPackNode(dictOrd)))(x32.value0.children)(y32.value0.children);
          if (v2 instanceof LT) {
            return LT.value;
          }
          ;
          if (v2 instanceof GT) {
            return GT.value;
          }
          ;
          var v1 = compare24(x32.value0.data_)(y32.value0.data_);
          if (v1 instanceof LT) {
            return LT.value;
          }
          ;
          if (v1 instanceof GT) {
            return GT.value;
          }
          ;
          var v22 = compare9(x32.value0.depth)(y32.value0.depth);
          if (v22 instanceof LT) {
            return LT.value;
          }
          ;
          if (v22 instanceof GT) {
            return GT.value;
          }
          ;
          var v3 = compare9(x32.value0.height)(y32.value0.height);
          if (v3 instanceof LT) {
            return LT.value;
          }
          ;
          if (v3 instanceof GT) {
            return GT.value;
          }
          ;
          var v4 = compare13(x32.value0.r)(y32.value0.r);
          if (v4 instanceof LT) {
            return LT.value;
          }
          ;
          if (v4 instanceof GT) {
            return GT.value;
          }
          ;
          var v5 = compare13(x32.value0.value)(y32.value0.value);
          if (v5 instanceof LT) {
            return LT.value;
          }
          ;
          if (v5 instanceof GT) {
            return GT.value;
          }
          ;
          var v6 = compare13(x32.value0.x)(y32.value0.x);
          if (v6 instanceof LT) {
            return LT.value;
          }
          ;
          if (v6 instanceof GT) {
            return GT.value;
          }
          ;
          return compare13(x32.value0.y)(y32.value0.y);
        };
      },
      Eq0: function() {
        return eqPackNode1;
      }
    };
  };
  var epsilon6 = 1e-6;
  var intersects = function(a3) {
    return function(b10) {
      var dy = b10.y - a3.y;
      var dx = b10.x - a3.x;
      var dr = a3.r + b10.r - epsilon6;
      return dr > 0 && dr * dr > dx * dx + dy * dy;
    };
  };
  var epsilon5 = 1e-9;
  var enclosesWeak = function(a3) {
    return function(b10) {
      var dy = b10.y - a3.y;
      var dx = b10.x - a3.x;
      var dr = a3.r - b10.r + max11(a3.r)(max11(b10.r)(1)) * epsilon5;
      return dr > 0 && dr * dr > dx * dx + dy * dy;
    };
  };
  var enclosesWeakAll = function(a3) {
    return function(bs) {
      return all2(enclosesWeak(a3))(bs);
    };
  };
  var enclosesNot = function(a3) {
    return function(b10) {
      var dy = b10.y - a3.y;
      var dx = b10.x - a3.x;
      var dr = a3.r - b10.r;
      return dr < 0 || dr * dr < dx * dx + dy * dy;
    };
  };
  var encloseBasis3 = function(a3) {
    return function(b10) {
      return function(c2) {
        var d1 = a3.x * a3.x + a3.y * a3.y - a3.r * a3.r;
        var d2 = d1 - b10.x * b10.x - b10.y * b10.y + b10.r * b10.r;
        var d3 = d1 - c2.x * c2.x - c2.y * c2.y + c2.r * c2.r;
        var c3 = c2.r - a3.r;
        var c22 = b10.r - a3.r;
        var b32 = a3.y - c2.y;
        var b22 = a3.y - b10.y;
        var a32 = a3.x - c2.x;
        var a22 = a3.x - b10.x;
        var ab = a32 * b22 - a22 * b32;
        var xa = (b22 * d3 - b32 * d2) / (ab * 2) - a3.x;
        var xb = (b32 * c22 - b22 * c3) / ab;
        var ya = (a32 * d2 - a22 * d3) / (ab * 2) - a3.y;
        var bigC = xa * xa + ya * ya - a3.r * a3.r;
        var yb = (a22 * c3 - a32 * c22) / ab;
        var bigA = xb * xb + yb * yb - 1;
        var bigB = 2 * (a3.r + xa * xb + ya * yb);
        var r29 = (function() {
          var $182 = abs(bigA) > epsilon6;
          if ($182) {
            return -(bigB + sqrt(bigB * bigB - 4 * bigA * bigC)) / (2 * bigA);
          }
          ;
          return -bigC / bigB;
        })();
        return {
          x: a3.x + xa + xb * r29,
          y: a3.y + ya + yb * r29,
          r: r29
        };
      };
    };
  };
  var encloseBasis2 = function(a3) {
    return function(b10) {
      var y212 = b10.y - a3.y;
      var x212 = b10.x - a3.x;
      var r212 = b10.r - a3.r;
      var l2 = sqrt(x212 * x212 + y212 * y212);
      return {
        x: (a3.x + b10.x + x212 / l2 * r212) / 2,
        y: (a3.y + b10.y + y212 / l2 * r212) / 2,
        r: (l2 + a3.r + b10.r) / 2
      };
    };
  };
  var extendBasis = function(basis2) {
    return function(p2) {
      if (enclosesWeakAll(p2)(basis2)) {
        return [p2];
      }
      ;
      if (otherwise) {
        var n = length3(basis2);
        var findTwoCircleBasis = function($copy_i) {
          var $tco_done = false;
          var $tco_result;
          function $tco_loop(i2) {
            if (i2 >= n) {
              $tco_done = true;
              return Nothing.value;
            }
            ;
            if (otherwise) {
              var v3 = index(basis2)(i2);
              if (v3 instanceof Just) {
                var candidate = encloseBasis2(v3.value0)(p2);
                var $187 = enclosesNot(p2)(v3.value0) && enclosesWeakAll(candidate)(basis2);
                if ($187) {
                  $tco_done = true;
                  return new Just([v3.value0, p2]);
                }
                ;
                $copy_i = i2 + 1 | 0;
                return;
              }
              ;
              if (v3 instanceof Nothing) {
                $copy_i = i2 + 1 | 0;
                return;
              }
              ;
              throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 546, column 13 - line 553, column 52): " + [v3.constructor.name]);
            }
            ;
            throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 542, column 7 - line 542, column 56): " + [i2.constructor.name]);
          }
          ;
          while (!$tco_done) {
            $tco_result = $tco_loop($copy_i);
          }
          ;
          return $tco_result;
        };
        var findInnerPair = function($copy_i) {
          return function($copy_j) {
            var $tco_var_i = $copy_i;
            var $tco_done1 = false;
            var $tco_result;
            function $tco_loop(i2, j) {
              if (j >= n) {
                $tco_done1 = true;
                return Nothing.value;
              }
              ;
              if (otherwise) {
                var v3 = index(basis2)(j);
                var v12 = index(basis2)(i2);
                if (v12 instanceof Just && v3 instanceof Just) {
                  var cjp = encloseBasis2(v3.value0)(p2);
                  var cip = encloseBasis2(v12.value0)(p2);
                  var cij = encloseBasis2(v12.value0)(v3.value0);
                  var candidate = encloseBasis3(v12.value0)(v3.value0)(p2);
                  var $193 = enclosesNot(cij)(p2) && (enclosesNot(cip)(v3.value0) && (enclosesNot(cjp)(v12.value0) && enclosesWeakAll(candidate)(basis2)));
                  if ($193) {
                    $tco_done1 = true;
                    return new Just([v12.value0, v3.value0, p2]);
                  }
                  ;
                  $tco_var_i = i2;
                  $copy_j = j + 1 | 0;
                  return;
                }
                ;
                $tco_var_i = i2;
                $copy_j = j + 1 | 0;
                return;
              }
              ;
              throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 563, column 7 - line 563, column 58): " + [i2.constructor.name, j.constructor.name]);
            }
            ;
            while (!$tco_done1) {
              $tco_result = $tco_loop($tco_var_i, $copy_j);
            }
            ;
            return $tco_result;
          };
        };
        var findThreeCircleBasis = function($copy_i) {
          var $tco_done2 = false;
          var $tco_result;
          function $tco_loop(i2) {
            if (i2 >= (n - 1 | 0)) {
              $tco_done2 = true;
              return Nothing.value;
            }
            ;
            if (otherwise) {
              var v3 = findInnerPair(i2)(i2 + 1 | 0);
              if (v3 instanceof Just) {
                $tco_done2 = true;
                return new Just(v3.value0);
              }
              ;
              if (v3 instanceof Nothing) {
                $copy_i = i2 + 1 | 0;
                return;
              }
              ;
              throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 559, column 13 - line 561, column 54): " + [v3.constructor.name]);
            }
            ;
            throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 555, column 7 - line 555, column 58): " + [i2.constructor.name]);
          }
          ;
          while (!$tco_done2) {
            $tco_result = $tco_loop($copy_i);
          }
          ;
          return $tco_result;
        };
        var v2 = findTwoCircleBasis(0);
        if (v2 instanceof Just) {
          return v2.value0;
        }
        ;
        if (v2 instanceof Nothing) {
          var v1 = findThreeCircleBasis(0);
          if (v1 instanceof Just) {
            return v1.value0;
          }
          ;
          if (v1 instanceof Nothing) {
            return basis2;
          }
          ;
          throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 536, column 11 - line 538, column 29): " + [v1.constructor.name]);
        }
        ;
        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 533, column 7 - line 538, column 29): " + [v2.constructor.name]);
      }
      ;
      throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 529, column 1 - line 529, column 54): " + [basis2.constructor.name, p2.constructor.name]);
    };
  };
  var encloseBasis1 = function(a3) {
    return {
      x: a3.x,
      y: a3.y,
      r: a3.r
    };
  };
  var encloseBasis = function(basis2) {
    var v2 = length3(basis2);
    if (v2 === 1) {
      return fromMaybe({
        x: 0,
        y: 0,
        r: 0
      })(map115(encloseBasis1)(index(basis2)(0)));
    }
    ;
    if (v2 === 2) {
      return fromMaybe({
        x: 0,
        y: 0,
        r: 0
      })(apply4(map115(encloseBasis2)(index(basis2)(0)))(index(basis2)(1)));
    }
    ;
    if (v2 === 3) {
      return fromMaybe({
        x: 0,
        y: 0,
        r: 0
      })(apply4(apply4(map115(encloseBasis3)(index(basis2)(0)))(index(basis2)(1)))(index(basis2)(2)));
    }
    ;
    return {
      x: 0,
      y: 0,
      r: 0
    };
  };
  var packEnclose = function(circles) {
    var n = length3(circles);
    var go2 = function($copy_i) {
      return function($copy_basis) {
        return function($copy_maybeE) {
          var $tco_var_i = $copy_i;
          var $tco_var_basis = $copy_basis;
          var $tco_done = false;
          var $tco_result;
          function $tco_loop(i2, basis2, maybeE) {
            if (i2 >= n) {
              if (maybeE instanceof Just) {
                $tco_done = true;
                return maybeE.value0;
              }
              ;
              if (maybeE instanceof Nothing) {
                $tco_done = true;
                return {
                  x: 0,
                  y: 0,
                  r: 0
                };
              }
              ;
              throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 587, column 9 - line 589, column 48): " + [maybeE.constructor.name]);
            }
            ;
            if (otherwise) {
              var v2 = index(circles)(i2);
              if (v2 instanceof Nothing) {
                $tco_var_i = i2 + 1 | 0;
                $tco_var_basis = basis2;
                $copy_maybeE = maybeE;
                return;
              }
              ;
              if (v2 instanceof Just) {
                if (maybeE instanceof Just && enclosesWeak(maybeE.value0)(v2.value0)) {
                  $tco_var_i = i2 + 1 | 0;
                  $tco_var_basis = basis2;
                  $copy_maybeE = maybeE;
                  return;
                }
                ;
                var newBasis = extendBasis(basis2)(v2.value0);
                var newE = encloseBasis(newBasis);
                $tco_var_i = 0;
                $tco_var_basis = newBasis;
                $copy_maybeE = new Just(newE);
                return;
              }
              ;
              throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 591, column 9 - line 602, column 44): " + [v2.constructor.name]);
            }
            ;
            throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 584, column 3 - line 584, column 54): " + [i2.constructor.name, basis2.constructor.name, maybeE.constructor.name]);
          }
          ;
          while (!$tco_done) {
            $tco_result = $tco_loop($tco_var_i, $tco_var_basis, $copy_maybeE);
          }
          ;
          return $tco_result;
        };
      };
    };
    return go2(0)([])(Nothing.value);
  };
  var defaultPackConfig = /* @__PURE__ */ (function() {
    return {
      size: {
        width: 1,
        height: 1
      },
      padding: 0,
      radius: Nothing.value
    };
  })();
  var calculateScore = function(a3) {
    return function(b10) {
      var ab = a3.r + b10.r;
      var dx = (a3.x * b10.r + b10.x * a3.r) / ab;
      var dy = (a3.y * b10.r + b10.y * a3.r) / ab;
      return dx * dx + dy * dy;
    };
  };
  var scoreNode = function(nodeId) {
    return function(state3) {
      return bind30(lookup14(nodeId)(state3.circles))(function(node) {
        return bind30(getNextId(nodeId)(state3.frontChain))(function(nextId) {
          return bind30(lookup14(nextId)(state3.circles))(function(next2) {
            return pure20({
              nodeId,
              score: calculateScore(node)(next2)
            });
          });
        });
      });
    };
  };
  var findBestPair = function(state3) {
    var scored = mapMaybe(function(nodeId) {
      return scoreNode(nodeId)(state3);
    })(state3.frontChain);
    var bestNode = minimumBy2(comparing2(function(v2) {
      return v2.score;
    }))(scored);
    if (bestNode instanceof Nothing) {
      return Nothing.value;
    }
    ;
    if (bestNode instanceof Just) {
      return bind30(getNextId(bestNode.value0.nodeId)(state3.frontChain))(function(nextId) {
        return pure20(new Tuple(bestNode.value0.nodeId, nextId));
      });
    }
    ;
    throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 165, column 5 - line 169, column 40): " + [bestNode.constructor.name]);
  };
  var bidirectionalCollisionSearch = function(aId) {
    return function(bId) {
      return function(newCircle) {
        return function(state3) {
          var doWhileStep = function($copy_j) {
            return function($copy_k) {
              return function($copy_sj) {
                return function($copy_sk) {
                  var $tco_var_j = $copy_j;
                  var $tco_var_k = $copy_k;
                  var $tco_var_sj = $copy_sj;
                  var $tco_done = false;
                  var $tco_result;
                  function $tco_loop(j, k, sj, sk) {
                    var $215 = sj <= sk;
                    if ($215) {
                      var v4 = lookup14(j)(state3.circles);
                      if (v4 instanceof Just) {
                        var $217 = intersects(v4.value0)(newCircle);
                        if ($217) {
                          $tco_done = true;
                          return new CollisionFromJ(j);
                        }
                        ;
                        var v12 = getNextInChain(j)(state3.frontChain);
                        if (v12 instanceof Just) {
                          var v23 = getNextInChain(k)(state3.frontChain);
                          if (v23 instanceof Just && v12.value0 === v23.value0) {
                            $tco_done = true;
                            return NoCollision.value;
                          }
                          ;
                          $tco_var_j = v12.value0;
                          $tco_var_k = k;
                          $tco_var_sj = sj + v4.value0.r;
                          $copy_sk = sk;
                          return;
                        }
                        ;
                        if (v12 instanceof Nothing) {
                          $tco_done = true;
                          return NoCollision.value;
                        }
                        ;
                        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 280, column 13 - line 286, column 37): " + [v12.constructor.name]);
                      }
                      ;
                      if (v4 instanceof Nothing) {
                        $tco_done = true;
                        return NoCollision.value;
                      }
                      ;
                      throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 274, column 7 - line 287, column 31): " + [v4.constructor.name]);
                    }
                    ;
                    var v4 = lookup14(k)(state3.circles);
                    if (v4 instanceof Just) {
                      var $224 = intersects(v4.value0)(newCircle);
                      if ($224) {
                        $tco_done = true;
                        return new CollisionFromK(k);
                      }
                      ;
                      var v12 = getPrevInChain(k)(state3.frontChain);
                      if (v12 instanceof Just) {
                        var v23 = getNextInChain(v12.value0)(state3.frontChain);
                        if (v23 instanceof Just && j === v23.value0) {
                          $tco_done = true;
                          return NoCollision.value;
                        }
                        ;
                        $tco_var_j = j;
                        $tco_var_k = v12.value0;
                        $tco_var_sj = sj;
                        $copy_sk = sk + v4.value0.r;
                        return;
                      }
                      ;
                      if (v12 instanceof Nothing) {
                        $tco_done = true;
                        return NoCollision.value;
                      }
                      ;
                      throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 296, column 13 - line 302, column 37): " + [v12.constructor.name]);
                    }
                    ;
                    if (v4 instanceof Nothing) {
                      $tco_done = true;
                      return NoCollision.value;
                    }
                    ;
                    throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 290, column 7 - line 303, column 31): " + [v4.constructor.name]);
                  }
                  ;
                  while (!$tco_done) {
                    $tco_result = $tco_loop($tco_var_j, $tco_var_k, $tco_var_sj, $copy_sk);
                  }
                  ;
                  return $tco_result;
                };
              };
            };
          };
          var v2 = lookup14(bId)(state3.circles);
          var v1 = lookup14(aId)(state3.circles);
          if (v1 instanceof Just && v2 instanceof Just) {
            var v22 = getPrevInChain(aId)(state3.frontChain);
            var v3 = getNextInChain(bId)(state3.frontChain);
            if (v3 instanceof Just && v22 instanceof Just) {
              return doWhileStep(v3.value0)(v22.value0)(v2.value0.r)(v1.value0.r);
            }
            ;
            return NoCollision.value;
          }
          ;
          return NoCollision.value;
        };
      };
    };
  };
  var tryPlaceCircleWithLimit = function($copy_maxRetries) {
    return function($copy_newCircle) {
      return function($copy_aId) {
        return function($copy_bId) {
          return function($copy_state) {
            var $tco_var_maxRetries = $copy_maxRetries;
            var $tco_var_newCircle = $copy_newCircle;
            var $tco_var_aId = $copy_aId;
            var $tco_var_bId = $copy_bId;
            var $tco_done = false;
            var $tco_result;
            function $tco_loop(maxRetries, newCircle, aId, bId, state3) {
              if (maxRetries <= 0) {
                $tco_done = true;
                return insertBetween(aId)(bId)(newCircle)(state3);
              }
              ;
              if (otherwise) {
                var v2 = lookup14(bId)(state3.circles);
                var v1 = lookup14(aId)(state3.circles);
                if (v1 instanceof Just && v2 instanceof Just) {
                  var positioned = place(v2.value0)(v1.value0)(newCircle);
                  var collisionResult = bidirectionalCollisionSearch(aId)(bId)(positioned)(state3);
                  if (collisionResult instanceof NoCollision) {
                    $tco_done = true;
                    return insertBetween(aId)(bId)(positioned)(state3);
                  }
                  ;
                  if (collisionResult instanceof CollisionFromJ) {
                    var shortenedChain = shortenChainOnly(aId)(collisionResult.value0)(state3.frontChain);
                    var stateWithShortenedChain = {
                      circles: state3.circles,
                      nextId: state3.nextId,
                      frontChain: shortenedChain
                    };
                    $tco_var_maxRetries = maxRetries - 1 | 0;
                    $tco_var_newCircle = newCircle;
                    $tco_var_aId = aId;
                    $tco_var_bId = collisionResult.value0;
                    $copy_state = stateWithShortenedChain;
                    return;
                  }
                  ;
                  if (collisionResult instanceof CollisionFromK) {
                    var shortenedChain = shortenChainOnly(collisionResult.value0)(bId)(state3.frontChain);
                    var stateWithShortenedChain = {
                      circles: state3.circles,
                      nextId: state3.nextId,
                      frontChain: shortenedChain
                    };
                    $tco_var_maxRetries = maxRetries - 1 | 0;
                    $tco_var_newCircle = newCircle;
                    $tco_var_aId = collisionResult.value0;
                    $tco_var_bId = bId;
                    $copy_state = stateWithShortenedChain;
                    return;
                  }
                  ;
                  throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 366, column 13 - line 382, column 101): " + [collisionResult.constructor.name]);
                }
                ;
                $tco_done = true;
                return state3;
              }
              ;
              throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 354, column 1 - line 354, column 91): " + [maxRetries.constructor.name, newCircle.constructor.name, aId.constructor.name, bId.constructor.name, state3.constructor.name]);
            }
            ;
            while (!$tco_done) {
              $tco_result = $tco_loop($tco_var_maxRetries, $tco_var_newCircle, $tco_var_aId, $tco_var_bId, $copy_state);
            }
            ;
            return $tco_result;
          };
        };
      };
    };
  };
  var tryPlaceCircle = /* @__PURE__ */ tryPlaceCircleWithLimit(100);
  var assignRadii = function(config) {
    return function(v2) {
      if (v2.value0.children.length === 0) {
        var r29 = (function() {
          if (config.radius instanceof Just) {
            return config.radius.value0(v2.value0.data_);
          }
          ;
          if (config.radius instanceof Nothing) {
            return sqrt(v2.value0.value);
          }
          ;
          throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 739, column 13 - line 741, column 37): " + [config.radius.constructor.name]);
        })();
        return new PackNode({
          data_: v2.value0.data_,
          depth: v2.value0.depth,
          height: v2.value0.height,
          value: v2.value0.value,
          children: v2.value0.children,
          x: v2.value0.x,
          y: v2.value0.y,
          r: max11(0)(r29)
        });
      }
      ;
      return new PackNode({
        data_: v2.value0.data_,
        depth: v2.value0.depth,
        height: v2.value0.height,
        value: v2.value0.value,
        x: v2.value0.x,
        y: v2.value0.y,
        r: v2.value0.r,
        children: map49(assignRadii(config))(v2.value0.children)
      });
    };
  };
  var addCircle = function(newCircle) {
    return function(state3) {
      var v2 = findBestPair(state3);
      if (v2 instanceof Nothing) {
        return state3;
      }
      ;
      if (v2 instanceof Just) {
        return tryPlaceCircle(newCircle)(v2.value0.value0)(v2.value0.value1)(state3);
      }
      ;
      throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 390, column 3 - line 392, column 67): " + [v2.constructor.name]);
    };
  };
  var packSiblingsMap = function(inputCircles) {
    var n = length3(inputCircles);
    var $260 = n === 0;
    if ($260) {
      return {
        circles: [],
        radius: 0
      };
    }
    ;
    var $261 = n === 1;
    if ($261) {
      var v2 = index(inputCircles)(0);
      if (v2 instanceof Just) {
        return {
          circles: [{
            r: v2.value0.r,
            x: 0,
            y: 0
          }],
          radius: v2.value0.r
        };
      }
      ;
      if (v2 instanceof Nothing) {
        return {
          circles: [],
          radius: 0
        };
      }
      ;
      throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Pack (line 402, column 7 - line 404, column 48): " + [v2.constructor.name]);
    }
    ;
    var $264 = n === 2;
    if ($264) {
      var v2 = index(inputCircles)(1);
      var v1 = index(inputCircles)(0);
      if (v1 instanceof Just && v2 instanceof Just) {
        var c1$prime = {
          r: v2.value0.r,
          x: v1.value0.r,
          y: 0
        };
        var c0$prime = {
          r: v1.value0.r,
          x: -v2.value0.r,
          y: 0
        };
        return {
          circles: [c0$prime, c1$prime],
          radius: v1.value0.r + v2.value0.r
        };
      }
      ;
      return {
        circles: [],
        radius: 0
      };
    }
    ;
    var v2 = index(inputCircles)(2);
    var v1 = index(inputCircles)(1);
    var v22 = index(inputCircles)(0);
    if (v22 instanceof Just && (v1 instanceof Just && v2 instanceof Just)) {
      var remaining = drop(3)(inputCircles);
      var initialState8 = initState(v22.value0)(v1.value0)(v2.value0);
      var finalState = foldl12(flip(addCircle))(initialState8)(remaining);
      var positioned = mapMaybe(function(i2) {
        return lookup14(i2)(finalState.circles);
      })(range2(0)(n - 1 | 0));
      var enclosing = packEnclose(positioned);
      var translated = map49(function(c2) {
        return {
          r: c2.r,
          x: c2.x - enclosing.x,
          y: c2.y - enclosing.y
        };
      })(positioned);
      return {
        circles: translated,
        radius: enclosing.r
      };
    }
    ;
    return {
      circles: [],
      radius: 0
    };
  };
  var packChildren = function(k) {
    return function(config) {
      return function(v2) {
        var updateNodePosition = function(v1) {
          return function(c2) {
            return new PackNode({
              data_: v1.value0.data_,
              depth: v1.value0.depth,
              height: v1.value0.height,
              value: v1.value0.value,
              children: v1.value0.children,
              r: v1.value0.r,
              x: c2.x,
              y: c2.y
            });
          };
        };
        var removePadding = function(p2) {
          return function(c2) {
            return {
              x: c2.x,
              y: c2.y,
              r: c2.r - p2
            };
          };
        };
        var nodeToCircle = function(v1) {
          return {
            x: v1.value0.x,
            y: v1.value0.y,
            r: v1.value0.r
          };
        };
        var addPadding = function(p2) {
          return function(c2) {
            return {
              x: c2.x,
              y: c2.y,
              r: c2.r + p2
            };
          };
        };
        if (v2.value0.children.length === 0) {
          return new PackNode(v2.value0);
        }
        ;
        var paddingScaled = config.padding * k;
        var packedKids = map49(packChildren(k)(config))(v2.value0.children);
        var inputCircles = map49((function() {
          var $287 = addPadding(paddingScaled);
          return function($288) {
            return $287(nodeToCircle($288));
          };
        })())(packedKids);
        var packed = packSiblingsMap(inputCircles);
        var circlesWithoutPadding = map49(removePadding(paddingScaled))(packed.circles);
        var updatedKids = zipWith2(updateNodePosition)(packedKids)(circlesWithoutPadding);
        var nodeWithR = {
          data_: v2.value0.data_,
          depth: v2.value0.depth,
          height: v2.value0.height,
          value: v2.value0.value,
          x: v2.value0.x,
          y: v2.value0.y,
          r: packed.radius + paddingScaled,
          children: updatedKids
        };
        return new PackNode(nodeWithR);
      };
    };
  };
  var pack = function(config) {
    return function(root3) {
      var withRadii = assignRadii(config)(root3);
      var firstPack = packChildren(1)({
        size: config.size,
        radius: config.radius,
        padding: 0
      })(withRadii);
      var k = firstPack.value0.r / min8(config.size.width)(config.size.height);
      var packed = packChildren(k)(config)(withRadii);
      var scaled = scaleToSize(config)(packed);
      return scaled;
    };
  };

  // output/D3.Viz.TreeAPI.PackViz/index.js
  var map50 = /* @__PURE__ */ map(functorMaybe);
  var map116 = /* @__PURE__ */ map(functorArray);
  var append20 = /* @__PURE__ */ append(semigroupArray);
  var bind31 = /* @__PURE__ */ bind(bindArray);
  var mod6 = /* @__PURE__ */ mod(euclideanRingInt);
  var bind115 = /* @__PURE__ */ bind(bindD3v2M);
  var select17 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var discard16 = /* @__PURE__ */ discard(discardUnit);
  var discard17 = /* @__PURE__ */ discard16(bindD3v2M);
  var liftEffect20 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var show30 = /* @__PURE__ */ show(showInt);
  var width17 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var num10 = /* @__PURE__ */ num(numExprEvalD);
  var height17 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr12 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text15 = /* @__PURE__ */ text6(stringExprEvalD);
  var transform7 = /* @__PURE__ */ transform2(toAttributeValueString);
  var show117 = /* @__PURE__ */ show(showNumber);
  var r6 = /* @__PURE__ */ r(toAttributeValueNumber);
  var fill10 = /* @__PURE__ */ fill(toAttributeValueString);
  var attr13 = /* @__PURE__ */ attr3(toAttributeValueNumber);
  var stroke10 = /* @__PURE__ */ stroke(toAttributeValueString);
  var strokeWidth9 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var textAnchor5 = /* @__PURE__ */ textAnchor(toAttributeValueString);
  var y11 = /* @__PURE__ */ y(toAttributeValueNumber);
  var fontSize7 = /* @__PURE__ */ fontSize(toAttributeValueNumber);
  var renderTree20 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(/* @__PURE__ */ ordPackNode(ordString));
  var bind210 = /* @__PURE__ */ bind(bindAff);
  var liftEffect110 = /* @__PURE__ */ liftEffect(monadEffectAff);
  var toHierarchyData = function(node) {
    return {
      data_: getName2(node),
      value: new Just(getValue2(node)),
      children: map50(map116(toHierarchyData))(getChildren2(node))
    };
  };
  var getAllNodes = function(v2) {
    var $41 = length3(v2.value0.children) === 0;
    if ($41) {
      return [v2];
    }
    ;
    return append20([v2])(bind31(v2.value0.children)(getAllNodes));
  };
  var colors = ["#e7ba52", "#c7c7c7", "#aec7e8", "#1f77b4", "#9467bd", "#8c564b", "#e377c2", "#7f7f7f", "#bcbd22", "#17becf"];
  var getColor = function(depth) {
    var idx = mod6(depth)(length3(colors));
    var v2 = index(colors)(idx);
    if (v2 instanceof Just) {
      return v2.value0;
    }
    ;
    if (v2 instanceof Nothing) {
      return "#cccccc";
    }
    ;
    throw new Error("Failed pattern match at D3.Viz.TreeAPI.PackViz (line 50, column 5 - line 52, column 27): " + [v2.constructor.name]);
  };
  var drawPack = function(selector) {
    return function(flareData) {
      return runD3v2M(bind115(select17(selector))(function(container) {
        var centerX = 700 / 2;
        var centerY = 700 / 2;
        var hierData = toHierarchyData(flareData);
        var packRoot = hierarchy(hierData);
        var config = {
          radius: defaultPackConfig.radius,
          size: {
            width: 700,
            height: 700
          },
          padding: 2
        };
        var packed = pack(config)(packRoot);
        var nodes3 = getAllNodes(packed);
        return discard17(liftEffect20(log2("Rendering circle pack: " + (show30(length3(nodes3)) + " circles"))))(function() {
          var tree2 = withChild(named(SVG.value)("svg")([width17(num10(700)), height17(num10(700)), viewBox(0)(0)(700)(700), attr12("class")(text15("pack-viz"))]))(withChild(named(Group.value)("chartGroup")([attr12("class")(text15("pack-content"))]))(joinData("circles")("g")(nodes3)(function(v2) {
            return withChildren(named(Group.value)("circle-" + v2.value0.data_)([attr12("class")(text15("node")), transform7(text15("translate(" + (show117(v2.value0.x) + ("," + (show117(v2.value0.y) + ")")))))]))([elem3(Circle.value)([r6(num10(v2.value0.r)), fill10(text15(getColor(v2.value0.depth))), attr13("fill-opacity")(num10(0.7)), stroke10(text15("#fff")), strokeWidth9(num10(1))]), elem3(Text.value)([attr12("text-content")(text15(v2.value0.data_)), textAnchor5(text15("middle")), y11(num10(4)), fontSize7(num10((function() {
              var $46 = v2.value0.r > 20;
              if ($46) {
                return 10;
              }
              ;
              return 8;
            })())), attr13("fill-opacity")(num10((function() {
              var $47 = v2.value0.r > 15;
              if ($47) {
                return 1;
              }
              ;
              return 0;
            })()))])]);
          })));
          return bind115(renderTree20(container)(tree2))(function() {
            return liftEffect20(function __do7() {
              log2("=== Circle Packing Layout (Tree API) ===")();
              log2("")();
              log2("Flare visualization toolkit hierarchy (circle packing)")();
              return log2("")();
            });
          });
        });
      }));
    };
  };
  var packViz = function(selector) {
    return launchAff_(bind210(loadDataFile(FlareJSON.value))(function(result) {
      if (result instanceof Left) {
        return liftEffect110(log2("Failed to load Flare data: " + result.value0));
      }
      ;
      if (result instanceof Right) {
        var hierData = parseFlareJson(result.value0);
        return liftEffect110(drawPack(selector)(hierData));
      }
      ;
      throw new Error("Failed pattern match at D3.Viz.TreeAPI.PackViz (line 140, column 3 - line 144, column 46): " + [result.constructor.name]);
    }));
  };

  // output/DataViz.Layout.Hierarchy.Partition/index.js
  var map51 = /* @__PURE__ */ map(functorArray);
  var compare10 = /* @__PURE__ */ compare(ordInt);
  var compare14 = /* @__PURE__ */ compare(ordNumber);
  var add6 = /* @__PURE__ */ add(semiringNumber);
  var map117 = /* @__PURE__ */ map(functorMaybe);
  var max12 = /* @__PURE__ */ max(ordInt);
  var PartNode = /* @__PURE__ */ (function() {
    function PartNode2(value0) {
      this.value0 = value0;
    }
    ;
    PartNode2.create = function(value0) {
      return new PartNode2(value0);
    };
    return PartNode2;
  })();
  var eqPartitionNode = function(dictEq) {
    var eq27 = eq(dictEq);
    return {
      eq: function(x32) {
        return function(y32) {
          return eq(eqArray(eqPartitionNode(dictEq)))(x32.value0.children)(y32.value0.children) && eq27(x32.value0.data_)(y32.value0.data_) && x32.value0.depth === y32.value0.depth && x32.value0.height === y32.value0.height && x32.value0.value === y32.value0.value && x32.value0.x0 === y32.value0.x0 && x32.value0.x1 === y32.value0.x1 && x32.value0.y0 === y32.value0.y0 && x32.value0.y1 === y32.value0.y1;
        };
      }
    };
  };
  var ordPartitionNode = function(dictOrd) {
    var compare24 = compare(dictOrd);
    var eqPartitionNode1 = eqPartitionNode(dictOrd.Eq0());
    return {
      compare: function(x32) {
        return function(y32) {
          var v2 = compare(ordArray(ordPartitionNode(dictOrd)))(x32.value0.children)(y32.value0.children);
          if (v2 instanceof LT) {
            return LT.value;
          }
          ;
          if (v2 instanceof GT) {
            return GT.value;
          }
          ;
          var v1 = compare24(x32.value0.data_)(y32.value0.data_);
          if (v1 instanceof LT) {
            return LT.value;
          }
          ;
          if (v1 instanceof GT) {
            return GT.value;
          }
          ;
          var v22 = compare10(x32.value0.depth)(y32.value0.depth);
          if (v22 instanceof LT) {
            return LT.value;
          }
          ;
          if (v22 instanceof GT) {
            return GT.value;
          }
          ;
          var v3 = compare10(x32.value0.height)(y32.value0.height);
          if (v3 instanceof LT) {
            return LT.value;
          }
          ;
          if (v3 instanceof GT) {
            return GT.value;
          }
          ;
          var v4 = compare14(x32.value0.value)(y32.value0.value);
          if (v4 instanceof LT) {
            return LT.value;
          }
          ;
          if (v4 instanceof GT) {
            return GT.value;
          }
          ;
          var v5 = compare14(x32.value0.x0)(y32.value0.x0);
          if (v5 instanceof LT) {
            return LT.value;
          }
          ;
          if (v5 instanceof GT) {
            return GT.value;
          }
          ;
          var v6 = compare14(x32.value0.x1)(y32.value0.x1);
          if (v6 instanceof LT) {
            return LT.value;
          }
          ;
          if (v6 instanceof GT) {
            return GT.value;
          }
          ;
          var v7 = compare14(x32.value0.y0)(y32.value0.y0);
          if (v7 instanceof LT) {
            return LT.value;
          }
          ;
          if (v7 instanceof GT) {
            return GT.value;
          }
          ;
          return compare14(x32.value0.y1)(y32.value0.y1);
        };
      },
      Eq0: function() {
        return eqPartitionNode1;
      }
    };
  };
  var roundNode = function(v2) {
    return new PartNode({
      data_: v2.value0.data_,
      depth: v2.value0.depth,
      height: v2.value0.height,
      value: v2.value0.value,
      x0: floor(v2.value0.x0),
      y0: floor(v2.value0.y0),
      x1: ceil(v2.value0.x1),
      y1: ceil(v2.value0.y1),
      children: map51(roundNode)(v2.value0.children)
    });
  };
  var positionChild = function(k) {
    return function(y0) {
      return function(y114) {
        return function(acc) {
          return function(v2) {
            var x1$prime = acc.currentX + v2.value0.value * k;
            var positioned = new PartNode({
              data_: v2.value0.data_,
              depth: v2.value0.depth,
              height: v2.value0.height,
              value: v2.value0.value,
              children: v2.value0.children,
              x0: acc.currentX,
              y0,
              x1: x1$prime,
              y1: y114
            });
            return {
              positioned: snoc3(acc.positioned)(positioned),
              currentX: x1$prime
            };
          };
        };
      };
    };
  };
  var hierarchy2 = /* @__PURE__ */ (function() {
    var go2 = function(depth) {
      return function(v2) {
        var kids = fromMaybe([])(map117(map51(go2(depth + 1 | 0)))(v2.children));
        var childValues = map51(function(v1) {
          return v1.value0.value;
        })(kids);
        var sumChildValues = foldl4(add6)(0)(childValues);
        var nodeValue = (function() {
          if (v2.value instanceof Just) {
            return v2.value.value0;
          }
          ;
          if (v2.value instanceof Nothing) {
            var $97 = $$null3(kids);
            if ($97) {
              return 0;
            }
            ;
            return sumChildValues;
          }
          ;
          throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Partition (line 105, column 19 - line 107, column 67): " + [v2.value.constructor.name]);
        })();
        var childHeights = map51(function(v1) {
          return v1.value0.height;
        })(kids);
        var maxChildHeight = foldl4(max12)(0)(childHeights);
        var nodeHeight = (function() {
          var $100 = $$null3(kids);
          if ($100) {
            return 0;
          }
          ;
          return maxChildHeight + 1 | 0;
        })();
        return new PartNode({
          data_: v2.data_,
          depth,
          height: nodeHeight,
          value: nodeValue,
          children: kids,
          x0: 0,
          y0: 0,
          x1: 0,
          y1: 0
        });
      };
    };
    return go2(0);
  })();
  var dice = function(children3) {
    return function(x0) {
      return function(y0) {
        return function(x113) {
          return function(y114) {
            var totalValue = foldl4(function(acc) {
              return function(v2) {
                return acc + v2.value0.value;
              };
            })(0)(children3);
            var k = (function() {
              var $103 = totalValue > 0;
              if ($103) {
                return (x113 - x0) / totalValue;
              }
              ;
              return 0;
            })();
            var result = foldl4(positionChild(k)(y0)(y114))({
              positioned: [],
              currentX: x0
            })(children3);
            return result.positioned;
          };
        };
      };
    };
  };
  var positionNode = function(config) {
    return function(dy) {
      return function(n) {
        return function(v2) {
          var y1$prime = v2.value0.y1 - config.padding;
          var x1$prime = v2.value0.x1 - config.padding;
          var positionedChildren = (function() {
            var $108 = $$null3(v2.value0.children);
            if ($108) {
              return v2.value0.children;
            }
            ;
            var childY1 = dy * toNumber(v2.value0.depth + 2 | 0) / toNumber(n);
            var childY0 = dy * toNumber(v2.value0.depth + 1 | 0) / toNumber(n);
            var dicedChildren = dice(v2.value0.children)(v2.value0.x0)(childY0)(v2.value0.x1)(childY1);
            var recursed = map51(positionNode(config)(dy)(n))(dicedChildren);
            return recursed;
          })();
          var v1 = (function() {
            var $109 = x1$prime < v2.value0.x0;
            if ($109) {
              return {
                x0: (v2.value0.x0 + x1$prime) / 2,
                x1: (v2.value0.x0 + x1$prime) / 2
              };
            }
            ;
            return {
              x0: v2.value0.x0,
              x1: x1$prime
            };
          })();
          var v22 = (function() {
            var $111 = y1$prime < v2.value0.y0;
            if ($111) {
              return {
                y0: (v2.value0.y0 + y1$prime) / 2,
                y1: (v2.value0.y0 + y1$prime) / 2
              };
            }
            ;
            return {
              y0: v2.value0.y0,
              y1: y1$prime
            };
          })();
          return new PartNode({
            data_: v2.value0.data_,
            depth: v2.value0.depth,
            height: v2.value0.height,
            value: v2.value0.value,
            children: positionedChildren,
            x0: v1.x0,
            y0: v22.y0,
            x1: v1.x1,
            y1: v22.y1
          });
        };
      };
    };
  };
  var partition3 = function(config) {
    return function(root3) {
      var n = root3.value0.height + 1 | 0;
      var initialRoot = new PartNode({
        data_: root3.value0.data_,
        depth: root3.value0.depth,
        height: root3.value0.height,
        value: root3.value0.value,
        children: root3.value0.children,
        x0: config.padding,
        y0: config.padding,
        x1: config.size.width,
        y1: config.size.height / toNumber(n)
      });
      var positioned = positionNode(config)(config.size.height)(n)(initialRoot);
      var rounded = (function() {
        if (config.round) {
          return roundNode(positioned);
        }
        ;
        return positioned;
      })();
      return rounded;
    };
  };
  var defaultPartitionConfig = {
    size: {
      width: 1,
      height: 1
    },
    padding: 0,
    round: false
  };

  // output/D3.Viz.TreeAPI.PartitionViz/index.js
  var map52 = /* @__PURE__ */ map(functorMaybe);
  var map118 = /* @__PURE__ */ map(functorArray);
  var append21 = /* @__PURE__ */ append(semigroupArray);
  var bind32 = /* @__PURE__ */ bind(bindArray);
  var mod7 = /* @__PURE__ */ mod(euclideanRingInt);
  var bind116 = /* @__PURE__ */ bind(bindD3v2M);
  var select18 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var discard18 = /* @__PURE__ */ discard(discardUnit)(bindD3v2M);
  var liftEffect21 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var show31 = /* @__PURE__ */ show(showInt);
  var width18 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var num11 = /* @__PURE__ */ num(numExprEvalD);
  var height18 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr14 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text16 = /* @__PURE__ */ text6(stringExprEvalD);
  var x11 = /* @__PURE__ */ x(toAttributeValueNumber);
  var y12 = /* @__PURE__ */ y(toAttributeValueNumber);
  var fill11 = /* @__PURE__ */ fill(toAttributeValueString);
  var attr15 = /* @__PURE__ */ attr3(toAttributeValueNumber);
  var stroke11 = /* @__PURE__ */ stroke(toAttributeValueString);
  var strokeWidth10 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var textContent6 = /* @__PURE__ */ textContent2(toAttributeValueString);
  var textAnchor6 = /* @__PURE__ */ textAnchor(toAttributeValueString);
  var fontSize8 = /* @__PURE__ */ fontSize(toAttributeValueNumber);
  var renderTree21 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(/* @__PURE__ */ ordPartitionNode(ordString));
  var bind211 = /* @__PURE__ */ bind(bindAff);
  var liftEffect111 = /* @__PURE__ */ liftEffect(monadEffectAff);
  var toHierarchyData2 = function(node) {
    var children3 = getChildren2(node);
    var nodeValue = (function() {
      if (children3 instanceof Nothing) {
        return new Just(getValue2(node));
      }
      ;
      if (children3 instanceof Just) {
        return Nothing.value;
      }
      ;
      throw new Error("Failed pattern match at D3.Viz.TreeAPI.PartitionViz (line 28, column 17 - line 30, column 24): " + [children3.constructor.name]);
    })();
    return {
      data_: getName2(node),
      value: nodeValue,
      children: map52(map118(toHierarchyData2))(children3)
    };
  };
  var getAllNodes2 = function(v2) {
    var $44 = length3(v2.value0.children) === 0;
    if ($44) {
      return [v2];
    }
    ;
    return append21([v2])(bind32(v2.value0.children)(getAllNodes2));
  };
  var colors2 = ["#e7ba52", "#c7c7c7", "#aec7e8", "#1f77b4", "#9467bd"];
  var getColor2 = function(depth) {
    var v2 = index(colors2)(mod7(depth)(length3(colors2)));
    if (v2 instanceof Just) {
      return v2.value0;
    }
    ;
    if (v2 instanceof Nothing) {
      return "#cccccc";
    }
    ;
    throw new Error("Failed pattern match at D3.Viz.TreeAPI.PartitionViz (line 43, column 18 - line 45, column 23): " + [v2.constructor.name]);
  };
  var drawPartition = function(selector) {
    return function(flareData) {
      return runD3v2M(bind116(select18(selector))(function(container) {
        var hierData = toHierarchyData2(flareData);
        var partRoot = hierarchy2(hierData);
        var config = {
          round: defaultPartitionConfig.round,
          size: {
            width: 750,
            height: 500
          },
          padding: 1
        };
        var partitioned = partition3(config)(partRoot);
        var nodes3 = getAllNodes2(partitioned);
        return discard18(liftEffect21(log2("Rendering partition: " + (show31(length3(nodes3)) + " rectangles"))))(function() {
          var tree2 = withChild(named(SVG.value)("svg")([width18(num11(750)), height18(num11(500)), viewBox(0)(0)(750)(500), attr14("class")(text16("partition-viz"))]))(joinData("rects")("g")(nodes3)(function(v2) {
            return withChildren(named(Group.value)("rect-" + v2.value0.data_)([attr14("class")(text16("node"))]))([elem3(Rect.value)([x11(num11(v2.value0.x0)), y12(num11(v2.value0.y0)), width18(num11(v2.value0.x1 - v2.value0.x0)), height18(num11(v2.value0.y1 - v2.value0.y0)), fill11(text16(getColor2(v2.value0.depth))), attr15("fill-opacity")(num11(0.7)), stroke11(text16("#fff")), strokeWidth10(num11(1))]), elem3(Text.value)([x11(num11((v2.value0.x0 + v2.value0.x1) / 2)), y12(num11((v2.value0.y0 + v2.value0.y1) / 2)), textContent6(text16(v2.value0.data_)), textAnchor6(text16("middle")), fontSize8(num11(9)), attr15("fill-opacity")(num11((function() {
              var $49 = v2.value0.x1 - v2.value0.x0 > 30 && v2.value0.y1 - v2.value0.y0 > 15;
              if ($49) {
                return 1;
              }
              ;
              return 0;
            })()))])]);
          }));
          return bind116(renderTree21(container)(tree2))(function() {
            return liftEffect21(log2("=== Partition Layout (Icicle) ===="));
          });
        });
      }));
    };
  };
  var partitionViz = function(selector) {
    return launchAff_(bind211(loadDataFile(FlareJSON.value))(function(result) {
      if (result instanceof Left) {
        return liftEffect111(log2("Failed to load Flare data: " + result.value0));
      }
      ;
      if (result instanceof Right) {
        return liftEffect111(drawPartition(selector)(parseFlareJson(result.value0)));
      }
      ;
      throw new Error("Failed pattern match at D3.Viz.TreeAPI.PartitionViz (line 125, column 3 - line 127, column 88): " + [result.constructor.name]);
    }));
  };

  // output/D3.Viz.TreeAPI.RadialStackedBarExample/index.js
  var sum3 = /* @__PURE__ */ sum(foldableArray)(semiringNumber);
  var map53 = /* @__PURE__ */ map(functorArray);
  var compare11 = /* @__PURE__ */ compare(ordString);
  var maximum8 = /* @__PURE__ */ maximum(ordNumber)(foldableArray);
  var bind33 = /* @__PURE__ */ bind(bindAff);
  var discard19 = /* @__PURE__ */ discard(discardUnit);
  var discard110 = /* @__PURE__ */ discard19(bindAff);
  var liftEffect22 = /* @__PURE__ */ liftEffect(monadEffectAff);
  var pure21 = /* @__PURE__ */ pure(applicativeAff);
  var show32 = /* @__PURE__ */ show(showInt);
  var show118 = /* @__PURE__ */ show(showNumber);
  var bind117 = /* @__PURE__ */ bind(bindD3v2M);
  var select19 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var v3Attr6 = /* @__PURE__ */ v3Attr(showNumber);
  var lit6 = /* @__PURE__ */ lit(numExprEvalD);
  var str6 = /* @__PURE__ */ str(stringExprEvalD);
  var append110 = /* @__PURE__ */ append(semigroupArray);
  var renderTree29 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(ordUnit);
  var liftEffect112 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var prepareRadialData = function(dataPoints) {
    var toStateData = function(maxTotal2) {
      return function(innerR) {
        return function(radiusRange2) {
          return function(stateIndex) {
            return function(group4) {
              var points = toArray4(group4);
              var segments = foldl4(function(acc) {
                return function(item) {
                  var thickness = item.population / maxTotal2 * radiusRange2;
                  var prevRadius = (function() {
                    var v2 = last(acc.result);
                    if (v2 instanceof Just) {
                      return v2.value0.outerRadius;
                    }
                    ;
                    if (v2 instanceof Nothing) {
                      return innerR;
                    }
                    ;
                    throw new Error("Failed pattern match at D3.Viz.TreeAPI.RadialStackedBarExample (line 163, column 28 - line 165, column 34): " + [v2.constructor.name]);
                  })();
                  return {
                    result: snoc3(acc.result)({
                      age: item.age,
                      population: item.population,
                      innerRadius: prevRadius,
                      outerRadius: prevRadius + thickness
                    })
                  };
                };
              })({
                result: []
              })(points);
              var total = sum3(map53(function(v2) {
                return v2.population;
              })(points));
              var first = head4(group4);
              return {
                state: first.state,
                stateIndex,
                ageSegments: segments.result,
                totalPopulation: total
              };
            };
          };
        };
      };
    };
    var radiusRange = 300 - 80;
    var grouped = groupBy(function(a3) {
      return function(b10) {
        return a3.state === b10.state;
      };
    })(sortBy(on(compare11)(function(v2) {
      return v2.state;
    }))(dataPoints));
    var allTotals = map53(function(g2) {
      return sum3(map53(function(v2) {
        return v2.population;
      })(toArray4(g2)));
    })(grouped);
    var maxTotal = fromMaybe(1)(maximum8(allTotals));
    return mapWithIndex3(toStateData(maxTotal)(80)(radiusRange))(grouped);
  };
  var parsePopulationRow2 = function(line) {
    var v2 = parseCSVRow(line);
    if (v2.length === 8) {
      var under5 = fromMaybe(0)(fromString(trim(v2[1])));
      var age65plus = fromMaybe(0)(fromString(trim(v2[7])));
      var age5to13 = fromMaybe(0)(fromString(trim(v2[2])));
      var age45to64 = fromMaybe(0)(fromString(trim(v2[6])));
      var age25to44 = fromMaybe(0)(fromString(trim(v2[5])));
      var age18to24 = fromMaybe(0)(fromString(trim(v2[4])));
      var age14to17 = fromMaybe(0)(fromString(trim(v2[3])));
      return [{
        state: trim(v2[0]),
        age: "<10",
        population: under5 + age5to13 * 0.5
      }, {
        state: trim(v2[0]),
        age: "10-19",
        population: age5to13 * 0.5 + age14to17
      }, {
        state: trim(v2[0]),
        age: "20-29",
        population: age18to24 + age25to44 * 0.25
      }, {
        state: trim(v2[0]),
        age: "30-39",
        population: age25to44 * 0.5
      }, {
        state: trim(v2[0]),
        age: "40-49",
        population: age25to44 * 0.25
      }, {
        state: trim(v2[0]),
        age: "50-59",
        population: age45to64 * 0.6
      }, {
        state: trim(v2[0]),
        age: "60-69",
        population: age45to64 * 0.4
      }, {
        state: trim(v2[0]),
        age: "70-79",
        population: age65plus * 0.6
      }, {
        state: trim(v2[0]),
        age: "\u226580",
        population: age65plus * 0.4
      }];
    }
    ;
    return [];
  };
  var loadPopulationData2 = /* @__PURE__ */ (function() {
    return bind33(loadDataFile(USPopulationStateAgeCSV.value))(function(result) {
      if (result instanceof Left) {
        return discard110(liftEffect22(log2("Failed to load population data: " + result.value0)))(function() {
          return pure21([]);
        });
      }
      ;
      if (result instanceof Right) {
        var lines = split("\n")(result.value0);
        var dataLines = drop(1)(lines);
        var parsed = concatMap(parsePopulationRow2)(dataLines);
        return discard110(liftEffect22(log2("Loaded " + (show32(length3(parsed)) + " population data points"))))(function() {
          return pure21(parsed);
        });
      }
      ;
      throw new Error("Failed pattern match at D3.Viz.TreeAPI.RadialStackedBarExample (line 86, column 3 - line 95, column 18): " + [result.constructor.name]);
    });
  })();
  var getAgeColorByName = function(age) {
    if (age === "<10") {
      return "#d53e4f";
    }
    ;
    if (age === "10-19") {
      return "#f46d43";
    }
    ;
    if (age === "20-29") {
      return "#fdae61";
    }
    ;
    if (age === "30-39") {
      return "#fee08b";
    }
    ;
    if (age === "40-49") {
      return "#e6f598";
    }
    ;
    if (age === "50-59") {
      return "#abdda4";
    }
    ;
    if (age === "60-69") {
      return "#66c2a5";
    }
    ;
    if (age === "70-79") {
      return "#3288bd";
    }
    ;
    if (age === "\u226580") {
      return "#5e4fa2";
    }
    ;
    return "#999";
  };
  var formatSI = function(n) {
    var $53 = n >= 1e6;
    if ($53) {
      return show118(n / 1e6) + "M";
    }
    ;
    return show118(n);
  };
  var arcPath = function(startAngle) {
    return function(endAngle) {
      return function(innerRadius) {
        return function(outerRadius) {
          var outerStartY = outerRadius * sin(startAngle);
          var outerStartX = outerRadius * cos(startAngle);
          var outerEndY = outerRadius * sin(endAngle);
          var outerEndX = outerRadius * cos(endAngle);
          var largeArc = (function() {
            var $54 = endAngle - startAngle > pi;
            if ($54) {
              return 1;
            }
            ;
            return 0;
          })();
          var innerStartY = innerRadius * sin(startAngle);
          var innerStartX = innerRadius * cos(startAngle);
          var innerEndY = innerRadius * sin(endAngle);
          var innerEndX = innerRadius * cos(endAngle);
          return "M" + (show118(outerStartX) + ("," + (show118(outerStartY) + (" A" + (show118(outerRadius) + ("," + (show118(outerRadius) + (" 0 " + (show32(largeArc) + (",1 " + (show118(outerEndX) + ("," + (show118(outerEndY) + (" L" + (show118(innerEndX) + ("," + (show118(innerEndY) + (" A" + (show118(innerRadius) + ("," + (show118(innerRadius) + (" 0 " + (show32(largeArc) + (",0 " + (show118(innerStartX) + ("," + (show118(innerStartY) + " Z")))))))))))))))))))))))))));
        };
      };
    };
  };
  var ageColors = ["#d53e4f", "#f46d43", "#fdae61", "#fee08b", "#e6f598", "#abdda4", "#66c2a5", "#3288bd", "#5e4fa2"];
  var getAgeColor = function(idx) {
    return fromMaybe("#999")(index(ageColors)(idx));
  };
  var drawRadialStackedBar = function(selector) {
    return function(populationData) {
      return runD3v2M(bind117(select19(selector))(function(container) {
        var states = prepareRadialData(populationData);
        var stateCount = toNumber(length3(states));
        var radiusRange = 300 - 80;
        var centerY = 700 / 2;
        var centerX = 700 / 2;
        var anglePerState = 2 * pi / stateCount;
        var allTotals = map53(function(v2) {
          return v2.totalPopulation;
        })(states);
        var maxTotal = fromMaybe(1)(maximum8(allTotals));
        var gridValues = [0.25 * maxTotal, 0.5 * maxTotal, 0.75 * maxTotal, maxTotal];
        var radiusScale = function(v2) {
          return 80 + v2 / maxTotal * radiusRange;
        };
        var makeGridLine = function(value20) {
          var gridRadius = radiusScale(value20);
          return [elem3(Circle.value)([v3Attr6("r")(lit6(gridRadius)), v3AttrStr("stroke")(str6("#000000")), v3Attr6("stroke-opacity")(lit6(0.5)), v3AttrStr("fill")(str6("none")), v3AttrStr("class")(str6("grid-circle"))]), elem3(Text.value)([v3Attr6("y")(lit6(-gridRadius)), v3Attr6("dy")(lit6(5.6)), v3AttrStr("text-content")(str6(formatSI(value20))), v3AttrStr("stroke")(str6("#ffffff")), v3Attr6("stroke-width")(lit6(5)), v3AttrStr("fill")(str6("none")), v3AttrStr("class")(str6("grid-label-bg"))]), elem3(Text.value)([v3Attr6("y")(lit6(-gridRadius)), v3Attr6("dy")(lit6(5.6)), v3AttrStr("text-content")(str6(formatSI(value20))), v3AttrStr("fill")(str6("#000000")), v3AttrStr("class")(str6("grid-label"))])];
        };
        var ageGroups = ["<10", "10-19", "20-29", "30-39", "40-49", "50-59", "60-69", "70-79", "\u226580"];
        var makeLegendItem = function(idx) {
          return function(age) {
            var ageCount = length3(ageGroups);
            var yOffset = (toNumber(ageCount) / 2 - toNumber(idx) - 1) * 20;
            return withChildren(named(Group.value)("legend-" + age)([v3AttrStr("transform")(str6("translate(-40," + (show118(yOffset) + ")"))), v3AttrStr("class")(str6("legend-item"))]))([elem3(Rect.value)([v3Attr6("width")(lit6(18)), v3Attr6("height")(lit6(18)), v3AttrStr("fill")(str6(getAgeColorByName(age)))]), elem3(Text.value)([v3Attr6("x")(lit6(24)), v3Attr6("y")(lit6(9)), v3Attr6("dy")(lit6(5.6)), v3AttrStr("text-content")(str6(age)), v3AttrStr("class")(str6("legend-label"))])]);
          };
        };
        var makeStateLabel = function(stateData) {
          var startAngle = toNumber(stateData.stateIndex) * anglePerState - pi / 2;
          var labelAngle = startAngle + anglePerState / 2;
          var labelX = 320 * cos(labelAngle);
          var labelY = 320 * sin(labelAngle);
          var rotation = labelAngle * 180 / pi + 90;
          return elem3(Text.value)([v3Attr6("x")(lit6(labelX)), v3Attr6("y")(lit6(labelY)), v3AttrStr("text-anchor")(str6("middle")), v3Attr6("font-size")(lit6(10)), v3AttrStr("transform")(str6("rotate(" + (show118(rotation) + (" " + (show118(labelX) + (" " + (show118(labelY) + ")"))))))), v3AttrStr("text-content")(str6(stateData.state)), v3AttrStr("class")(str6("state-label"))]);
        };
        var makeStateArcs = function(stateData) {
          return mapWithIndex3(function(ageIdx) {
            return function(segment) {
              var startAngle = toNumber(stateData.stateIndex) * anglePerState - pi / 2;
              var endAngle = startAngle + anglePerState;
              return elem3(Path.value)([v3AttrStr("d")(str6(arcPath(startAngle)(endAngle)(segment.innerRadius)(segment.outerRadius))), v3AttrStr("fill")(str6(getAgeColor(ageIdx))), v3AttrStr("class")(str6("age-arc"))]);
            };
          })(stateData.ageSegments);
        };
        var tree2 = withChild(named(SVG.value)("svg")([v3Attr6("width")(lit6(700)), v3Attr6("height")(lit6(700)), v3AttrStr("viewBox")(str6("0 0 " + (show118(700) + (" " + show118(700))))), v3AttrStr("class")(str6("radial-stacked-bar"))]))(withChildren(named(Group.value)("plot-area")([v3AttrStr("transform")(str6("translate(" + (show118(centerX) + ("," + (show118(centerY) + ")")))))]))([withChildren(named(Group.value)("y-axis")([v3AttrStr("text-anchor")(str6("middle"))]))(append110([elem3(Text.value)([v3Attr6("y")(lit6(-(300 + 10))), v3Attr6("font-size")(lit6(12)), v3AttrStr("text-content")(str6("Population")), v3AttrStr("class")(str6("axis-label"))])])(concatMap(makeGridLine)(gridValues))), withChildren(named(Group.value)("legend")([]))(mapWithIndex3(makeLegendItem)(ageGroups)), withChildren(named(Group.value)("data-arcs")([]))(concatMap(makeStateArcs)(states)), withChildren(named(Group.value)("state-labels")([]))(map53(makeStateLabel)(states))]));
        return bind117(renderTree29(container)(tree2))(function() {
          return liftEffect112(function __do7() {
            log2("=== Radial Stacked Bar Chart ===")();
            log2("")();
            log2("States: " + show32(length3(states)))();
            log2("All 50 US states + DC in polar coordinates")();
            return log2("")();
          });
        });
      }));
    };
  };
  var radialStackedBar = function(selector) {
    return launchAff_(bind33(loadPopulationData2)(function(populationData) {
      return liftEffect22(drawRadialStackedBar(selector)(populationData));
    }));
  };

  // output/DataViz.Layout.Hierarchy.Link/index.js
  var show33 = /* @__PURE__ */ show(showNumber);
  var StepHorizontal = /* @__PURE__ */ (function() {
    function StepHorizontal2() {
    }
    ;
    StepHorizontal2.value = new StepHorizontal2();
    return StepHorizontal2;
  })();
  var StepVertical = /* @__PURE__ */ (function() {
    function StepVertical2() {
    }
    ;
    StepVertical2.value = new StepVertical2();
    return StepVertical2;
  })();
  var BezierVertical = /* @__PURE__ */ (function() {
    function BezierVertical2() {
    }
    ;
    BezierVertical2.value = new BezierVertical2();
    return BezierVertical2;
  })();
  var BezierHorizontal = /* @__PURE__ */ (function() {
    function BezierHorizontal2() {
    }
    ;
    BezierHorizontal2.value = new BezierHorizontal2();
    return BezierHorizontal2;
  })();
  var BezierRadial = /* @__PURE__ */ (function() {
    function BezierRadial2() {
    }
    ;
    BezierRadial2.value = new BezierRadial2();
    return BezierRadial2;
  })();
  var Diagonal = /* @__PURE__ */ (function() {
    function Diagonal2() {
    }
    ;
    Diagonal2.value = new Diagonal2();
    return Diagonal2;
  })();
  var linkStepVertical = function(x113) {
    return function(y114) {
      return function(x211) {
        return function(y211) {
          var midY = (y114 + y211) / 2;
          return "M" + (show33(x113) + ("," + (show33(y114) + ("V" + (show33(midY) + ("H" + (show33(x211) + ("V" + show33(y211)))))))));
        };
      };
    };
  };
  var linkStepHorizontal = function(x113) {
    return function(y114) {
      return function(x211) {
        return function(y211) {
          var midX = (x113 + x211) / 2;
          return "M" + (show33(x113) + ("," + (show33(y114) + ("H" + (show33(midX) + ("V" + (show33(y211) + ("H" + show33(x211)))))))));
        };
      };
    };
  };
  var linkDiagonal = function(x113) {
    return function(y114) {
      return function(x211) {
        return function(y211) {
          return "M" + (show33(x113) + ("," + (show33(y114) + ("L" + (show33(x211) + ("," + show33(y211)))))));
        };
      };
    };
  };
  var linkBezierVertical = function(x113) {
    return function(y114) {
      return function(x211) {
        return function(y211) {
          var midY = (y114 + y211) / 2;
          return "M" + (show33(x113) + ("," + (show33(y114) + ("C" + (show33(x113) + ("," + (show33(midY) + (" " + (show33(x211) + ("," + (show33(midY) + (" " + (show33(x211) + ("," + show33(y211)))))))))))))));
        };
      };
    };
  };
  var linkBezierRadialCartesian = function(x113) {
    return function(y114) {
      return function(x211) {
        return function(y211) {
          var radius2 = sqrt(x211 * x211 + y211 * y211);
          var radius1 = sqrt(x113 * x113 + y114 * y114);
          var midRadius = (radius1 + radius2) / 2;
          var angle2 = atan2(y211)(x211);
          var cp2x = midRadius * cos(angle2);
          var cp2y = midRadius * sin(angle2);
          var angle1 = atan2(y114)(x113);
          var cp1x = midRadius * cos(angle1);
          var cp1y = midRadius * sin(angle1);
          return "M" + (show33(x113) + ("," + (show33(y114) + ("C" + (show33(cp1x) + ("," + (show33(cp1y) + (" " + (show33(cp2x) + ("," + (show33(cp2y) + (" " + (show33(x211) + ("," + show33(y211)))))))))))))));
        };
      };
    };
  };
  var linkBezierRadial = function(x113) {
    return function(y114) {
      return function(x211) {
        return function(y211) {
          var cr1 = (y114 + y211) / 2;
          var angle2 = (x211 - 90) * pi / 180;
          var cx25 = cr1 * cos(angle2);
          var cy25 = cr1 * sin(angle2);
          var tx = y211 * cos(angle2);
          var ty = y211 * sin(angle2);
          var angle1 = (x113 - 90) * pi / 180;
          var cx1 = cr1 * cos(angle1);
          var cy1 = cr1 * sin(angle1);
          var sx = y114 * cos(angle1);
          var sy = y114 * sin(angle1);
          return "M" + (show33(sx) + ("," + (show33(sy) + ("C" + (show33(cx1) + ("," + (show33(cy1) + (" " + (show33(cx25) + ("," + (show33(cy25) + (" " + (show33(tx) + ("," + show33(ty)))))))))))))));
        };
      };
    };
  };
  var linkBezierHorizontal = function(x113) {
    return function(y114) {
      return function(x211) {
        return function(y211) {
          var midX = (x113 + x211) / 2;
          return "M" + (show33(x113) + ("," + (show33(y114) + ("C" + (show33(midX) + ("," + (show33(y114) + (" " + (show33(midX) + ("," + (show33(y211) + (" " + (show33(x211) + ("," + show33(y211)))))))))))))));
        };
      };
    };
  };
  var linkGenerator = function(v2) {
    if (v2 instanceof StepHorizontal) {
      return linkStepHorizontal;
    }
    ;
    if (v2 instanceof StepVertical) {
      return linkStepVertical;
    }
    ;
    if (v2 instanceof BezierVertical) {
      return linkBezierVertical;
    }
    ;
    if (v2 instanceof BezierHorizontal) {
      return linkBezierHorizontal;
    }
    ;
    if (v2 instanceof BezierRadial) {
      return linkBezierRadial;
    }
    ;
    if (v2 instanceof Diagonal) {
      return linkDiagonal;
    }
    ;
    throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Link (line 196, column 1 - line 196, column 79): " + [v2.constructor.name]);
  };
  var eqLinkStyle = {
    eq: function(x32) {
      return function(y32) {
        if (x32 instanceof StepHorizontal && y32 instanceof StepHorizontal) {
          return true;
        }
        ;
        if (x32 instanceof StepVertical && y32 instanceof StepVertical) {
          return true;
        }
        ;
        if (x32 instanceof BezierVertical && y32 instanceof BezierVertical) {
          return true;
        }
        ;
        if (x32 instanceof BezierHorizontal && y32 instanceof BezierHorizontal) {
          return true;
        }
        ;
        if (x32 instanceof BezierRadial && y32 instanceof BezierRadial) {
          return true;
        }
        ;
        if (x32 instanceof Diagonal && y32 instanceof Diagonal) {
          return true;
        }
        ;
        return false;
      };
    }
  };

  // output/D3.Viz.TreeAPI.RadialTreeViz/index.js
  var map54 = /* @__PURE__ */ map(functorList);
  var bind34 = /* @__PURE__ */ bind(bindList);
  var append23 = /* @__PURE__ */ append(semigroupList);
  var fromFoldable19 = /* @__PURE__ */ fromFoldable3(foldableList);
  var bind118 = /* @__PURE__ */ bind(bindD3v2M);
  var select20 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var fromFoldable110 = /* @__PURE__ */ fromFoldable3(/* @__PURE__ */ foldableCofree(foldableList));
  var discard20 = /* @__PURE__ */ discard(discardUnit);
  var discard111 = /* @__PURE__ */ discard20(bindD3v2M);
  var liftEffect23 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var show34 = /* @__PURE__ */ show(showInt);
  var width19 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var num12 = /* @__PURE__ */ num(numExprEvalD);
  var height19 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr16 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text17 = /* @__PURE__ */ text6(stringExprEvalD);
  var transform8 = /* @__PURE__ */ transform2(toAttributeValueString);
  var show119 = /* @__PURE__ */ show(showNumber);
  var path8 = /* @__PURE__ */ path(toAttributeValueString);
  var fill12 = /* @__PURE__ */ fill(toAttributeValueString);
  var stroke12 = /* @__PURE__ */ stroke(toAttributeValueString);
  var strokeWidth11 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var renderTree30 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D);
  var ordRecord8 = /* @__PURE__ */ ordRecord();
  var ordRecordCons8 = /* @__PURE__ */ ordRecordCons(ordRecordNil)();
  var ordRecordCons13 = /* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons8({
    reflectSymbol: function() {
      return "y";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "x";
    }
  })(ordNumber);
  var ordRecord14 = /* @__PURE__ */ ordRecord8(ordRecordCons13);
  var renderTree110 = /* @__PURE__ */ renderTree30(/* @__PURE__ */ ordRecord8(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons8({
    reflectSymbol: function() {
      return "target";
    }
  })(ordRecord14))()({
    reflectSymbol: function() {
      return "source";
    }
  })(ordRecord14)));
  var cx5 = /* @__PURE__ */ cx(toAttributeValueNumber);
  var cy5 = /* @__PURE__ */ cy(toAttributeValueNumber);
  var r7 = /* @__PURE__ */ r(toAttributeValueNumber);
  var x12 = /* @__PURE__ */ x(toAttributeValueNumber);
  var y13 = /* @__PURE__ */ y(toAttributeValueNumber);
  var textContent7 = /* @__PURE__ */ textContent2(toAttributeValueString);
  var fontSize9 = /* @__PURE__ */ fontSize(toAttributeValueNumber);
  var textAnchor7 = /* @__PURE__ */ textAnchor(toAttributeValueString);
  var renderTree210 = /* @__PURE__ */ renderTree30(/* @__PURE__ */ ordRecord8(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(ordRecordCons13)()({
    reflectSymbol: function() {
      return "value";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "name";
    }
  })(ordString))()({
    reflectSymbol: function() {
      return "height";
    }
  })(ordInt))()({
    reflectSymbol: function() {
      return "depth";
    }
  })(ordInt)));
  var bind212 = /* @__PURE__ */ bind(bindAff);
  var liftEffect113 = /* @__PURE__ */ liftEffect(monadEffectAff);
  var radialPoint = function(node) {
    return function(w) {
      return function(h7) {
        var minDim = (function() {
          var $86 = w < h7;
          if ($86) {
            return w;
          }
          ;
          return h7;
        })();
        var rad = node.y / h7 * (minDim / 2) * 0.85;
        var angle = node.x / w * 2 * pi - pi / 2;
        return {
          x: rad * cos(angle),
          y: rad * sin(angle)
        };
      };
    };
  };
  var radialLinkPath = linkBezierRadialCartesian;
  var projectRadial = function(w) {
    return function(h7) {
      return function(t2) {
        var val = head(t2);
        var projected = radialPoint(val)(w)(h7);
        var children3 = tail(t2);
        var projectedChildren = map54(projectRadial(w)(h7))(children3);
        return mkTree((function() {
          var $87 = {};
          for (var $88 in val) {
            if ({}.hasOwnProperty.call(val, $88)) {
              $87[$88] = val[$88];
            }
            ;
          }
          ;
          $87.x = projected.x;
          $87.y = projected.y;
          return $87;
        })())(projectedChildren);
      };
    };
  };
  var makeLinks4 = function(tree$prime) {
    var makeLinksList = function(t2) {
      var val = head(t2);
      var children3 = tail(t2);
      var grandchildLinks = bind34(children3)(makeLinksList);
      var childLinks = bind34(children3)(function(child) {
        var childVal = head(child);
        return new Cons({
          source: {
            x: val.x,
            y: val.y
          },
          target: {
            x: childVal.x,
            y: childVal.y
          }
        }, Nil.value);
      });
      return append23(childLinks)(grandchildLinks);
    };
    return fromFoldable19(makeLinksList(tree$prime));
  };
  var drawRadialTree = function(selector) {
    return function(flareTree) {
      return runD3v2M(bind118(select20(selector))(function(container) {
        var centerX = 700 / 2;
        var centerY = 700 / 2;
        var config = {
          layerScale: defaultTreeConfig.layerScale,
          minSeparation: defaultTreeConfig.minSeparation,
          separation: defaultTreeConfig.separation,
          size: {
            width: 700,
            height: 700
          }
        };
        var positioned = tree(config)(flareTree);
        var radialTree2 = projectRadial(700)(700)(positioned);
        var nodes3 = fromFoldable110(radialTree2);
        var links3 = makeLinks4(radialTree2);
        return discard111(liftEffect23(log2("Rendering radial tree: " + (show34(length3(nodes3)) + (" nodes, " + (show34(length3(links3)) + " links"))))))(function() {
          var linksTree = withChild(named(SVG.value)("svg")([width19(num12(700)), height19(num12(700)), viewBox(0)(0)(700)(700), attr16("class")(text17("radial-tree-viz"))]))(withChild(named(Group.value)("chartGroup")([attr16("class")(text17("tree-content")), transform8(text17("translate(" + (show119(centerX) + ("," + (show119(centerY) + ")")))))]))(withChild(named(Group.value)("linksGroup")([attr16("class")(text17("links"))]))(joinData("links")("path")(links3)(function(link5) {
            return elem3(Path.value)([path8(text17(radialLinkPath(link5.source.x)(link5.source.y)(link5.target.x)(link5.target.y))), fill12(text17("none")), stroke12(text17("#999")), strokeWidth11(num12(1.5)), attr16("class")(text17("link"))]);
          }))));
          return bind118(renderTree110(container)(linksTree))(function(linksSelections) {
            return bind118(liftEffect23(reselectD3v2("chartGroup")(linksSelections)))(function(chartGroupSel) {
              var nodesTree = withChild(named(Group.value)("nodesGroup")([attr16("class")(text17("nodes"))]))(joinData("nodeGroups")("g")(nodes3)(function(node) {
                return withChildren(named(Group.value)("node-" + node.name)([attr16("class")(text17("node"))]))([elem3(Circle.value)([cx5(num12(node.x)), cy5(num12(node.y)), r7(num12(3)), fill12(text17("#69b3a2")), stroke12(text17("#fff")), strokeWidth11(num12(1.5))]), elem3(Text.value)([x12(num12(node.x)), y13(num12(node.y)), textContent7(text17(node.name)), fontSize9(num12(9)), textAnchor7(text17("start")), transform8(text17("translate(6, 3)"))])]);
              }));
              return bind118(renderTree210(chartGroupSel)(nodesTree))(function() {
                return liftEffect23(function __do7() {
                  log2("=== Radial Tree Layout (Tree API) ===")();
                  log2("")();
                  log2("Flare visualization toolkit hierarchy (radial)")();
                  return log2("")();
                });
              });
            });
          });
        });
      }));
    };
  };
  var radialTreeViz = function(selector) {
    return launchAff_(bind212(loadFlareData)(function(result) {
      if (result instanceof Left) {
        return liftEffect113(log2("Failed to load Flare data: " + result.value0));
      }
      ;
      if (result instanceof Right) {
        return liftEffect113(drawRadialTree(selector)(result.value0));
      }
      ;
      throw new Error("Failed pattern match at D3.Viz.TreeAPI.RadialTreeViz (line 192, column 3 - line 194, column 70): " + [result.constructor.name]);
    }));
  };

  // output/DataViz.Layout.Sankey.CSV/index.js
  var map55 = /* @__PURE__ */ map(functorArray);
  var parseLine = function(line) {
    var parts = map55(trim)(split(",")(line));
    if (parts.length === 3) {
      var v2 = fromString(parts[2]);
      if (v2 instanceof Just) {
        return new Just({
          s: parts[0],
          t: parts[1],
          v: v2.value0
        });
      }
      ;
      if (v2 instanceof Nothing) {
        return Nothing.value;
      }
      ;
      throw new Error("Failed pattern match at DataViz.Layout.Sankey.CSV (line 44, column 9 - line 47, column 29): " + [v2.constructor.name]);
    }
    ;
    return Nothing.value;
  };
  var parseSankeyCSV = function(csvString) {
    var isEmpty3 = function(s3) {
      return $$null4(trim(s3));
    };
    var lines = split("\n")(csvString);
    var dataLines = filter(function($10) {
      return !isEmpty3($10);
    })(drop(1)(lines));
    return mapMaybe(parseLine)(dataLines);
  };

  // output/Data.Set/index.js
  var coerce4 = /* @__PURE__ */ coerce();
  var foldMap2 = /* @__PURE__ */ foldMap(foldableList);
  var foldl13 = /* @__PURE__ */ foldl(foldableList);
  var foldr5 = /* @__PURE__ */ foldr(foldableList);
  var $$Set = function(x32) {
    return x32;
  };
  var union4 = function(dictOrd) {
    return coerce4(union(dictOrd));
  };
  var toList2 = function(v2) {
    return keys(v2);
  };
  var toUnfoldable5 = function(dictUnfoldable) {
    var $96 = toUnfoldable(dictUnfoldable);
    return function($97) {
      return $96(toList2($97));
    };
  };
  var size5 = /* @__PURE__ */ coerce4(size);
  var singleton11 = function(a3) {
    return singleton6(a3)(unit);
  };
  var semigroupSet = function(dictOrd) {
    return {
      append: union4(dictOrd)
    };
  };
  var member2 = function(dictOrd) {
    return coerce4(member(dictOrd));
  };
  var isEmpty2 = /* @__PURE__ */ coerce4(isEmpty);
  var intersection2 = function(dictOrd) {
    return coerce4(intersection(dictOrd));
  };
  var insert9 = function(dictOrd) {
    var insert19 = insert(dictOrd);
    return function(a3) {
      return function(v2) {
        return insert19(a3)(unit)(v2);
      };
    };
  };
  var fromMap = $$Set;
  var foldableSet = {
    foldMap: function(dictMonoid) {
      var foldMap12 = foldMap2(dictMonoid);
      return function(f) {
        var $98 = foldMap12(f);
        return function($99) {
          return $98(toList2($99));
        };
      };
    },
    foldl: function(f) {
      return function(x32) {
        var $100 = foldl13(f)(x32);
        return function($101) {
          return $100(toList2($101));
        };
      };
    },
    foldr: function(f) {
      return function(x32) {
        var $102 = foldr5(f)(x32);
        return function($103) {
          return $102(toList2($103));
        };
      };
    }
  };
  var filter5 = function(dictOrd) {
    return coerce4(filterKeys(dictOrd));
  };
  var eqSet = function(dictEq) {
    var eq20 = eq(eqMap(dictEq)(eqUnit));
    return {
      eq: function(v2) {
        return function(v1) {
          return eq20(v2)(v1);
        };
      }
    };
  };
  var empty8 = empty4;
  var fromFoldable20 = function(dictFoldable) {
    var foldl22 = foldl(dictFoldable);
    return function(dictOrd) {
      var insert19 = insert9(dictOrd);
      return foldl22(function(m2) {
        return function(a3) {
          return insert19(a3)(m2);
        };
      })(empty8);
    };
  };
  var unions = function(dictFoldable) {
    var foldl22 = foldl(dictFoldable);
    return function(dictOrd) {
      return foldl22(union4(dictOrd))(empty8);
    };
  };
  var difference3 = function(dictOrd) {
    return coerce4(difference2(dictOrd));
  };
  var $$delete5 = function(dictOrd) {
    return coerce4($$delete2(dictOrd));
  };

  // output/DataViz.Layout.Sankey.Types/index.js
  var compare15 = /* @__PURE__ */ compare(ordInt);
  var bind35 = /* @__PURE__ */ bind(bindMaybe);
  var pure24 = /* @__PURE__ */ pure(applicativeMaybe);
  var SourceColor = /* @__PURE__ */ (function() {
    function SourceColor2() {
    }
    ;
    SourceColor2.value = new SourceColor2();
    return SourceColor2;
  })();
  var TargetColor = /* @__PURE__ */ (function() {
    function TargetColor2() {
    }
    ;
    TargetColor2.value = new TargetColor2();
    return TargetColor2;
  })();
  var SourceTargetGradient = /* @__PURE__ */ (function() {
    function SourceTargetGradient2() {
    }
    ;
    SourceTargetGradient2.value = new SourceTargetGradient2();
    return SourceTargetGradient2;
  })();
  var StaticColor = /* @__PURE__ */ (function() {
    function StaticColor2(value0) {
      this.value0 = value0;
    }
    ;
    StaticColor2.create = function(value0) {
      return new StaticColor2(value0);
    };
    return StaticColor2;
  })();
  var Justify = /* @__PURE__ */ (function() {
    function Justify2() {
    }
    ;
    Justify2.value = new Justify2();
    return Justify2;
  })();
  var Left3 = /* @__PURE__ */ (function() {
    function Left4() {
    }
    ;
    Left4.value = new Left4();
    return Left4;
  })();
  var Right3 = /* @__PURE__ */ (function() {
    function Right4() {
    }
    ;
    Right4.value = new Right4();
    return Right4;
  })();
  var Center2 = /* @__PURE__ */ (function() {
    function Center3() {
    }
    ;
    Center3.value = new Center3();
    return Center3;
  })();
  var initialiseSankeyLink = function(l2) {
    return {
      sourceIndex: l2.source,
      targetIndex: l2.target,
      value: l2.value,
      width: 0,
      y0: 0,
      y1: 0,
      color: "",
      index: l2.id
    };
  };
  var initialSankeyGraphModel = function(config) {
    return {
      linkCount: 0,
      nodeCount: 0,
      nodeNameToID: empty4,
      nodeIDToName: empty4,
      nodeOrder: [],
      deps: empty4,
      sped: empty4,
      sankeyNodes: [],
      sankeyLinks: [],
      config,
      capturedSteps: []
    };
  };
  var eqNodeID = {
    eq: function(x32) {
      return function(y32) {
        return x32 === y32;
      };
    }
  };
  var ordNodeID = {
    compare: function(x32) {
      return function(y32) {
        return compare15(x32)(y32);
      };
    },
    Eq0: function() {
      return eqNodeID;
    }
  };
  var lookup15 = /* @__PURE__ */ lookup(ordNodeID);
  var initialiseSankeyNode = function(m2) {
    return function(id5) {
      return bind35(lookup15(id5)(m2.nodeIDToName))(function(name16) {
        var sourceLinks = fromMaybe(empty8)(lookup15(id5)(m2.deps));
        var targetLinks = fromMaybe(empty8)(lookup15(id5)(m2.sped));
        return pure24({
          name: name16,
          x0: 0,
          x1: 0,
          y0: 0,
          y1: 0,
          value: 0,
          depth: 0,
          nodeHeight: 0,
          layer: 0,
          index: id5,
          color: "",
          sourceLinks,
          targetLinks
        });
      });
    };
  };
  var eqLinkID = {
    eq: function(x32) {
      return function(y32) {
        return x32 === y32;
      };
    }
  };
  var ordLinkID = {
    compare: function(x32) {
      return function(y32) {
        return compare15(x32)(y32);
      };
    },
    Eq0: function() {
      return eqLinkID;
    }
  };
  var defaultSankeyConfig = function(width47) {
    return function(height47) {
      return {
        alignment: Justify.value,
        linkColorMode: SourceTargetGradient.value,
        nodeWidth: 15,
        nodePadding: 10,
        iterations: 6,
        extent: {
          x0: 1,
          y0: 1,
          x1: width47 - 1,
          y1: height47 - 5
        }
      };
    };
  };

  // output/DataViz.Layout.Sankey.Compute/index.js
  var lookup16 = /* @__PURE__ */ lookup(ordNodeID);
  var insert10 = /* @__PURE__ */ insert9(ordNodeID);
  var insert12 = /* @__PURE__ */ insert(ordNodeID);
  var bindStateT2 = /* @__PURE__ */ bindStateT(monadIdentity);
  var bind36 = /* @__PURE__ */ bind(bindStateT2);
  var monadStateStateT2 = /* @__PURE__ */ monadStateStateT(monadIdentity);
  var get7 = /* @__PURE__ */ get(monadStateStateT2);
  var lookup17 = /* @__PURE__ */ lookup(ordString);
  var modify_4 = /* @__PURE__ */ modify_(monadStateStateT2);
  var insert22 = /* @__PURE__ */ insert(ordString);
  var append24 = /* @__PURE__ */ append(semigroupArray);
  var map56 = /* @__PURE__ */ map(functorArray);
  var min9 = /* @__PURE__ */ min(ordNumber);
  var max13 = /* @__PURE__ */ max(ordInt);
  var eq13 = /* @__PURE__ */ eq(eqNodeID);
  var append111 = /* @__PURE__ */ append(semigroupOrdering);
  var compare16 = /* @__PURE__ */ compare(ordNumber);
  var compare17 = /* @__PURE__ */ compare(ordLinkID);
  var div1 = /* @__PURE__ */ div(euclideanRingInt);
  var max14 = /* @__PURE__ */ max(ordNumber);
  var member3 = /* @__PURE__ */ member2(ordNodeID);
  var union5 = /* @__PURE__ */ union4(ordNodeID);
  var fromFoldable21 = /* @__PURE__ */ fromFoldable20(foldableArray)(ordNodeID);
  var eq22 = /* @__PURE__ */ eq(eqLinkID);
  var discard21 = /* @__PURE__ */ discard(discardUnit);
  var for_4 = /* @__PURE__ */ for_(applicativeEffect)(foldableArray);
  var show35 = /* @__PURE__ */ show(showNumber);
  var pure25 = /* @__PURE__ */ pure(applicativeEffect);
  var mod8 = /* @__PURE__ */ mod(euclideanRingInt);
  var show120 = /* @__PURE__ */ show(showInt);
  var compare22 = /* @__PURE__ */ compare(ordString);
  var applicativeStateT2 = /* @__PURE__ */ applicativeStateT(monadIdentity);
  var pure111 = /* @__PURE__ */ pure(applicativeStateT2);
  var discard23 = /* @__PURE__ */ discard21(bindStateT2);
  var for_12 = /* @__PURE__ */ for_(applicativeStateT2)(foldableArray);
  var unionInsert = function(sid) {
    return function(tid) {
      return function(deps) {
        var targetSet = (function() {
          var v2 = lookup16(sid)(deps);
          if (v2 instanceof Nothing) {
            return singleton11(tid);
          }
          ;
          if (v2 instanceof Just) {
            return insert10(tid)(v2.value0);
          }
          ;
          throw new Error("Failed pattern match at DataViz.Layout.Sankey.Compute (line 128, column 5 - line 130, column 47): " + [v2.constructor.name]);
        })();
        return insert12(sid)(targetSet)(deps);
      };
    };
  };
  var processCSVLink = function(link5) {
    return bind36(get7)(function(model) {
      var t2 = lookup17(link5.t)(model.nodeNameToID);
      var s3 = lookup17(link5.s)(model.nodeNameToID);
      var v2 = (function() {
        if (s3 instanceof Just && t2 instanceof Just) {
          return {
            nodeCount: model.nodeCount,
            sid: s3.value0,
            tid: t2.value0,
            newNodes: []
          };
        }
        ;
        if (s3 instanceof Just && t2 instanceof Nothing) {
          return {
            nodeCount: model.nodeCount + 1 | 0,
            sid: s3.value0,
            tid: model.nodeCount,
            newNodes: [model.nodeCount]
          };
        }
        ;
        if (s3 instanceof Nothing && t2 instanceof Just) {
          return {
            nodeCount: model.nodeCount + 1 | 0,
            sid: model.nodeCount,
            tid: t2.value0,
            newNodes: [model.nodeCount]
          };
        }
        ;
        if (s3 instanceof Nothing && t2 instanceof Nothing) {
          return {
            nodeCount: model.nodeCount + 2 | 0,
            sid: model.nodeCount,
            tid: model.nodeCount + 1 | 0,
            newNodes: [model.nodeCount, model.nodeCount + 1 | 0]
          };
        }
        ;
        throw new Error("Failed pattern match at DataViz.Layout.Sankey.Compute (line 144, column 7 - line 154, column 177): " + [s3.constructor.name, t2.constructor.name]);
      })();
      return modify_4(function(v1) {
        var $137 = {};
        for (var $138 in v1) {
          if ({}.hasOwnProperty.call(v1, $138)) {
            $137[$138] = v1[$138];
          }
          ;
        }
        ;
        $137.linkCount = model.linkCount + 1 | 0;
        $137.nodeCount = v2.nodeCount;
        $137.nodeNameToID = insert22(link5.s)(v2.sid)(insert22(link5.t)(v2.tid)(model.nodeNameToID));
        $137.nodeIDToName = insert12(v2.sid)(link5.s)(insert12(v2.tid)(link5.t)(model.nodeIDToName));
        $137.nodeOrder = append24(model.nodeOrder)(v2.newNodes);
        $137.deps = unionInsert(v2.sid)(v2.tid)(model.deps);
        $137.sped = unionInsert(v2.tid)(v2.sid)(model.sped);
        $137.sankeyLinks = snoc3(model.sankeyLinks)(initialiseSankeyLink({
          source: v2.sid,
          target: v2.tid,
          value: link5.v,
          id: model.linkCount
        }));
        return $137;
      });
    });
  };
  var initializeNodeBreadths = function(nodes3) {
    return function(_links) {
      return function(_config) {
        return function(padding2) {
          return function(y0) {
            return function(y114) {
              var positionLayer = function(ky2) {
                return function(padding1) {
                  return function(yStart) {
                    return function(layerNodes) {
                      var stacked = foldl4(function(acc) {
                        return function(node) {
                          var nodeHeight = node.value * ky2;
                          var positioned2 = {
                            value: node.value,
                            color: node.color,
                            depth: node.depth,
                            index: node.index,
                            layer: node.layer,
                            name: node.name,
                            nodeHeight: node.nodeHeight,
                            sourceLinks: node.sourceLinks,
                            targetLinks: node.targetLinks,
                            x0: node.x0,
                            x1: node.x1,
                            y0: acc.y,
                            y1: acc.y + nodeHeight
                          };
                          return {
                            nodes: snoc3(acc.nodes)(positioned2),
                            y: acc.y + nodeHeight + padding1
                          };
                        };
                      })({
                        nodes: [],
                        y: yStart
                      })(layerNodes);
                      var extraSpacing = (y114 - stacked.y + padding1) / (toNumber(length3(layerNodes)) + 1);
                      var adjusted = mapWithIndex3(function(i2) {
                        return function(node) {
                          var shift = extraSpacing * toNumber(i2 + 1 | 0);
                          return {
                            color: node.color,
                            depth: node.depth,
                            index: node.index,
                            layer: node.layer,
                            name: node.name,
                            nodeHeight: node.nodeHeight,
                            sourceLinks: node.sourceLinks,
                            targetLinks: node.targetLinks,
                            value: node.value,
                            x0: node.x0,
                            x1: node.x1,
                            y0: node.y0 + shift,
                            y1: node.y1 + shift
                          };
                        };
                      })(stacked.nodes);
                      return adjusted;
                    };
                  };
                };
              };
              var calculateKy = function(layers2) {
                return function(height47) {
                  return function(padding1) {
                    var scaleForLayer = function(layerNodes) {
                      var totalValue = foldl4(function(sum6) {
                        return function(node) {
                          return sum6 + node.value;
                        };
                      })(0)(layerNodes);
                      var numNodes = toNumber(length3(layerNodes));
                      var availableHeight = height47 - (numNodes - 1) * padding1;
                      var $144 = totalValue > 0;
                      if ($144) {
                        return availableHeight / totalValue;
                      }
                      ;
                      return 1;
                    };
                    var scales = map56(scaleForLayer)(layers2);
                    var nonEmptyScales = filter(function(s3) {
                      return s3 > 0;
                    })(scales);
                    var v2 = head2(nonEmptyScales);
                    if (v2 instanceof Just) {
                      return foldl4(min9)(v2.value0)(nonEmptyScales);
                    }
                    ;
                    if (v2 instanceof Nothing) {
                      return 1;
                    }
                    ;
                    throw new Error("Failed pattern match at DataViz.Layout.Sankey.Compute (line 467, column 7 - line 469, column 23): " + [v2.constructor.name]);
                  };
                };
              };
              var totalHeight = y114 - y0;
              var maxLayer = foldl4(function(acc) {
                return function(node) {
                  return max13(acc)(node.layer);
                };
              })(0)(nodes3);
              var layers = map56(function(layerIdx) {
                return filter(function(node) {
                  return node.layer === layerIdx;
                })(nodes3);
              })(range2(0)(maxLayer));
              var ky = calculateKy(layers)(totalHeight)(padding2);
              var positionedLayers = map56(positionLayer(ky)(padding2)(y0))(layers);
              var positioned = concat(positionedLayers);
              return positioned;
            };
          };
        };
      };
    };
  };
  var initialiseSankeyNodes = /* @__PURE__ */ bind36(get7)(function(model) {
    var sankeyNodes = catMaybes(map56(initialiseSankeyNode(model))(model.nodeOrder));
    return modify_4(function(v2) {
      var $147 = {};
      for (var $148 in v2) {
        if ({}.hasOwnProperty.call(v2, $148)) {
          $147[$148] = v2[$148];
        }
        ;
      }
      ;
      $147.sankeyNodes = sankeyNodes;
      return $147;
    });
  });
  var epsilon7 = 1e-6;
  var relaxation = function(nodes3) {
    return function(links3) {
      return function(config) {
        return function(padding2) {
          return function(y0) {
            return function(y114) {
              var updateNodes = function(allNodes) {
                return function(updated) {
                  return map56(function(node) {
                    var v2 = find2(function(u2) {
                      return eq13(u2.node.index)(node.index);
                    })(updated);
                    if (v2 instanceof Just) {
                      return v2.value0.node;
                    }
                    ;
                    if (v2 instanceof Nothing) {
                      return node;
                    }
                    ;
                    throw new Error("Failed pattern match at DataViz.Layout.Sankey.Compute (line 890, column 11 - line 892, column 28): " + [v2.constructor.name]);
                  })(allNodes);
                };
              };
              var targetTop = function(source3) {
                return function(target7) {
                  return function(_sortedSourceLinks) {
                    return function(allNodes) {
                      return function(allLinks) {
                        return function(py) {
                          var targetIncoming = sortBy(function(a3) {
                            return function(b10) {
                              var v2 = find2(function(n) {
                                return eq13(n.index)(b10.sourceIndex);
                              })(allNodes);
                              var v1 = find2(function(n) {
                                return eq13(n.index)(a3.sourceIndex);
                              })(allNodes);
                              if (v1 instanceof Just && v2 instanceof Just) {
                                return append111(compare16(v1.value0.y0)(v2.value0.y0))(compare17(a3.index)(b10.index));
                              }
                              ;
                              return compare17(a3.index)(b10.index);
                            };
                          })(filter(function(l2) {
                            return eq13(l2.targetIndex)(target7.index);
                          })(allLinks));
                          var sourceOutgoing = sortBy(function(a3) {
                            return function(b10) {
                              var v2 = find2(function(n) {
                                return eq13(n.index)(b10.targetIndex);
                              })(allNodes);
                              var v1 = find2(function(n) {
                                return eq13(n.index)(a3.targetIndex);
                              })(allNodes);
                              if (v1 instanceof Just && v2 instanceof Just) {
                                return append111(compare16(v1.value0.y0)(v2.value0.y0))(compare17(a3.index)(b10.index));
                              }
                              ;
                              return compare17(a3.index)(b10.index);
                            };
                          })(filter(function(l2) {
                            return eq13(l2.sourceIndex)(source3.index);
                          })(allLinks));
                          var numTargetLinks = toNumber(length3(targetIncoming));
                          var startY = target7.y0 - (numTargetLinks - 1) * py / 2;
                          var yAtTarget = foldl4(function(acc) {
                            return function(link5) {
                              if (acc.found) {
                                return acc;
                              }
                              ;
                              var $161 = eq13(link5.sourceIndex)(source3.index);
                              if ($161) {
                                return {
                                  y: acc.y,
                                  found: true
                                };
                              }
                              ;
                              return {
                                y: acc.y + link5.width + py,
                                found: false
                              };
                            };
                          })({
                            y: startY,
                            found: false
                          })(targetIncoming);
                          var yFinal = foldl4(function(acc) {
                            return function(link5) {
                              if (acc.found) {
                                return acc;
                              }
                              ;
                              var $163 = eq13(link5.targetIndex)(target7.index);
                              if ($163) {
                                return {
                                  y: acc.y,
                                  found: true
                                };
                              }
                              ;
                              return {
                                y: acc.y - link5.width,
                                found: false
                              };
                            };
                          })({
                            y: yAtTarget.y,
                            found: false
                          })(sourceOutgoing);
                          return yFinal.y;
                        };
                      };
                    };
                  };
                };
              };
              var sourceTop = function(source3) {
                return function(target7) {
                  return function(_sortedTargetLinks) {
                    return function(allNodes) {
                      return function(allLinks) {
                        return function(py) {
                          var targetIncoming = sortBy(function(a3) {
                            return function(b10) {
                              var v2 = find2(function(n) {
                                return eq13(n.index)(b10.sourceIndex);
                              })(allNodes);
                              var v1 = find2(function(n) {
                                return eq13(n.index)(a3.sourceIndex);
                              })(allNodes);
                              if (v1 instanceof Just && v2 instanceof Just) {
                                return append111(compare16(v1.value0.y0)(v2.value0.y0))(compare17(a3.index)(b10.index));
                              }
                              ;
                              return compare17(a3.index)(b10.index);
                            };
                          })(filter(function(l2) {
                            return eq13(l2.targetIndex)(target7.index);
                          })(allLinks));
                          var sourceOutgoing = sortBy(function(a3) {
                            return function(b10) {
                              var v2 = find2(function(n) {
                                return eq13(n.index)(b10.targetIndex);
                              })(allNodes);
                              var v1 = find2(function(n) {
                                return eq13(n.index)(a3.targetIndex);
                              })(allNodes);
                              if (v1 instanceof Just && v2 instanceof Just) {
                                return append111(compare16(v1.value0.y0)(v2.value0.y0))(compare17(a3.index)(b10.index));
                              }
                              ;
                              return compare17(a3.index)(b10.index);
                            };
                          })(filter(function(l2) {
                            return eq13(l2.sourceIndex)(source3.index);
                          })(allLinks));
                          var numSourceLinks = toNumber(length3(sourceOutgoing));
                          var startY = source3.y0 - (numSourceLinks - 1) * py / 2;
                          var yAtSource = foldl4(function(acc) {
                            return function(link5) {
                              if (acc.found) {
                                return acc;
                              }
                              ;
                              var $173 = eq13(link5.targetIndex)(target7.index);
                              if ($173) {
                                return {
                                  y: acc.y,
                                  found: true
                                };
                              }
                              ;
                              return {
                                y: acc.y + link5.width + py,
                                found: false
                              };
                            };
                          })({
                            y: startY,
                            found: false
                          })(sourceOutgoing);
                          var yFinal = foldl4(function(acc) {
                            return function(link5) {
                              if (acc.found) {
                                return acc;
                              }
                              ;
                              var $175 = eq13(link5.sourceIndex)(source3.index);
                              if ($175) {
                                return {
                                  y: acc.y,
                                  found: true
                                };
                              }
                              ;
                              return {
                                y: acc.y - link5.width,
                                found: false
                              };
                            };
                          })({
                            y: yAtSource.y,
                            found: false
                          })(targetIncoming);
                          return yFinal.y;
                        };
                      };
                    };
                  };
                };
              };
              var resolveCollisionsTopToBottom = function(nodes1) {
                return function(startIdx) {
                  return function(targetY) {
                    return function(padding1) {
                      return function(beta2) {
                        var n = length3(nodes1);
                        var go2 = function($copy_idx) {
                          return function($copy_y) {
                            return function($copy_currentNodes) {
                              var $tco_var_idx = $copy_idx;
                              var $tco_var_y = $copy_y;
                              var $tco_done = false;
                              var $tco_result;
                              function $tco_loop(idx, y32, currentNodes) {
                                var $176 = idx >= n;
                                if ($176) {
                                  $tco_done = true;
                                  return currentNodes;
                                }
                                ;
                                var v2 = index(currentNodes)(idx);
                                if (v2 instanceof Nothing) {
                                  $tco_done = true;
                                  return currentNodes;
                                }
                                ;
                                if (v2 instanceof Just) {
                                  var dy = (y32 - v2.value0.node.y0) * beta2;
                                  var updated = (function() {
                                    var $178 = dy > epsilon7;
                                    if ($178) {
                                      var newNode = {
                                        color: v2.value0.node.color,
                                        depth: v2.value0.node.depth,
                                        index: v2.value0.node.index,
                                        layer: v2.value0.node.layer,
                                        name: v2.value0.node.name,
                                        nodeHeight: v2.value0.node.nodeHeight,
                                        sourceLinks: v2.value0.node.sourceLinks,
                                        targetLinks: v2.value0.node.targetLinks,
                                        value: v2.value0.node.value,
                                        x0: v2.value0.node.x0,
                                        x1: v2.value0.node.x1,
                                        y0: v2.value0.node.y0 + dy,
                                        y1: v2.value0.node.y1 + dy
                                      };
                                      return fromMaybe(currentNodes)(updateAt(idx)({
                                        node: newNode,
                                        targetY: v2.value0.targetY
                                      })(currentNodes));
                                    }
                                    ;
                                    return currentNodes;
                                  })();
                                  var newY = (function() {
                                    var v1 = index(updated)(idx);
                                    if (v1 instanceof Just) {
                                      return v1.value0.node.y1 + padding1;
                                    }
                                    ;
                                    if (v1 instanceof Nothing) {
                                      return y32;
                                    }
                                    ;
                                    throw new Error("Failed pattern match at DataViz.Layout.Sankey.Compute (line 877, column 22 - line 879, column 29): " + [v1.constructor.name]);
                                  })();
                                  $tco_var_idx = idx + 1 | 0;
                                  $tco_var_y = newY;
                                  $copy_currentNodes = updated;
                                  return;
                                }
                                ;
                                throw new Error("Failed pattern match at DataViz.Layout.Sankey.Compute (line 864, column 14 - line 881, column 40): " + [v2.constructor.name]);
                              }
                              ;
                              while (!$tco_done) {
                                $tco_result = $tco_loop($tco_var_idx, $tco_var_y, $copy_currentNodes);
                              }
                              ;
                              return $tco_result;
                            };
                          };
                        };
                        return go2(startIdx)(targetY)(nodes1);
                      };
                    };
                  };
                };
              };
              var resolveCollisionsBottomToTop = function(nodes1) {
                return function(startIdx) {
                  return function(targetY) {
                    return function(padding1) {
                      return function(beta2) {
                        var $182 = startIdx < 0;
                        if ($182) {
                          return nodes1;
                        }
                        ;
                        var go2 = function($copy_idx) {
                          return function($copy_y) {
                            return function($copy_currentNodes) {
                              var $tco_var_idx = $copy_idx;
                              var $tco_var_y = $copy_y;
                              var $tco_done1 = false;
                              var $tco_result;
                              function $tco_loop(idx, y32, currentNodes) {
                                var $183 = idx < 0;
                                if ($183) {
                                  $tco_done1 = true;
                                  return currentNodes;
                                }
                                ;
                                var v2 = index(currentNodes)(idx);
                                if (v2 instanceof Nothing) {
                                  $tco_done1 = true;
                                  return currentNodes;
                                }
                                ;
                                if (v2 instanceof Just) {
                                  var dy = (v2.value0.node.y1 - y32) * beta2;
                                  var updated = (function() {
                                    var $185 = dy > epsilon7;
                                    if ($185) {
                                      var newNode = {
                                        color: v2.value0.node.color,
                                        depth: v2.value0.node.depth,
                                        index: v2.value0.node.index,
                                        layer: v2.value0.node.layer,
                                        name: v2.value0.node.name,
                                        nodeHeight: v2.value0.node.nodeHeight,
                                        sourceLinks: v2.value0.node.sourceLinks,
                                        targetLinks: v2.value0.node.targetLinks,
                                        value: v2.value0.node.value,
                                        x0: v2.value0.node.x0,
                                        x1: v2.value0.node.x1,
                                        y0: v2.value0.node.y0 - dy,
                                        y1: v2.value0.node.y1 - dy
                                      };
                                      return fromMaybe(currentNodes)(updateAt(idx)({
                                        node: newNode,
                                        targetY: v2.value0.targetY
                                      })(currentNodes));
                                    }
                                    ;
                                    return currentNodes;
                                  })();
                                  var newY = (function() {
                                    var v1 = index(updated)(idx);
                                    if (v1 instanceof Just) {
                                      return v1.value0.node.y0 - padding1;
                                    }
                                    ;
                                    if (v1 instanceof Nothing) {
                                      return y32;
                                    }
                                    ;
                                    throw new Error("Failed pattern match at DataViz.Layout.Sankey.Compute (line 846, column 24 - line 848, column 31): " + [v1.constructor.name]);
                                  })();
                                  $tco_var_idx = idx - 1 | 0;
                                  $tco_var_y = newY;
                                  $copy_currentNodes = updated;
                                  return;
                                }
                                ;
                                throw new Error("Failed pattern match at DataViz.Layout.Sankey.Compute (line 833, column 16 - line 850, column 42): " + [v2.constructor.name]);
                              }
                              ;
                              while (!$tco_done1) {
                                $tco_result = $tco_loop($tco_var_idx, $tco_var_y, $copy_currentNodes);
                              }
                              ;
                              return $tco_result;
                            };
                          };
                        };
                        return go2(startIdx)(targetY)(nodes1);
                      };
                    };
                  };
                };
              };
              var resolveCollisions = function(sorted) {
                return function(padding1) {
                  return function(yMin) {
                    return function(yMax) {
                      return function(beta2) {
                        var $189 = $$null3(sorted);
                        if ($189) {
                          return sorted;
                        }
                        ;
                        var n = length3(sorted);
                        var middleIdx = div1(n)(2);
                        var middleNode = index(sorted)(middleIdx);
                        var startYDown = (function() {
                          if (middleNode instanceof Just) {
                            return middleNode.value0.node.y1 + padding1;
                          }
                          ;
                          if (middleNode instanceof Nothing) {
                            return yMin;
                          }
                          ;
                          throw new Error("Failed pattern match at DataViz.Layout.Sankey.Compute (line 809, column 22 - line 811, column 26): " + [middleNode.constructor.name]);
                        })();
                        var startYUp = (function() {
                          if (middleNode instanceof Just) {
                            return middleNode.value0.node.y0 - padding1;
                          }
                          ;
                          if (middleNode instanceof Nothing) {
                            return yMax;
                          }
                          ;
                          throw new Error("Failed pattern match at DataViz.Layout.Sankey.Compute (line 801, column 20 - line 803, column 26): " + [middleNode.constructor.name]);
                        })();
                        var pushedUp = resolveCollisionsBottomToTop(sorted)(middleIdx - 1 | 0)(startYUp)(padding1)(beta2);
                        var pushedUpAndDown = resolveCollisionsTopToBottom(pushedUp)(middleIdx + 1 | 0)(startYDown)(padding1)(beta2);
                        var clampedBottom = resolveCollisionsBottomToTop(pushedUpAndDown)(n - 1 | 0)(yMax)(padding1)(beta2);
                        var clampedTop = resolveCollisionsTopToBottom(clampedBottom)(0)(yMin)(padding1)(beta2);
                        return clampedTop;
                      };
                    };
                  };
                };
              };
              var calculateWeightedFromTargets = function(node) {
                return function(allNodes) {
                  return function(allLinks) {
                    return function(padding1) {
                      var outgoingLinks = filter(function(l2) {
                        return eq13(l2.sourceIndex)(node.index);
                      })(allLinks);
                      var sortedLinks = sortBy(function(a3) {
                        return function(b10) {
                          var v2 = find2(function(n) {
                            return eq13(n.index)(b10.targetIndex);
                          })(allNodes);
                          var v1 = find2(function(n) {
                            return eq13(n.index)(a3.targetIndex);
                          })(allNodes);
                          if (v1 instanceof Just && v2 instanceof Just) {
                            return append111(compare16(v1.value0.y0)(v2.value0.y0))(compare17(a3.index)(b10.index));
                          }
                          ;
                          return compare17(a3.index)(b10.index);
                        };
                      })(outgoingLinks);
                      var result = foldl4(function(acc) {
                        return function(link5) {
                          var v2 = find2(function(n) {
                            return eq13(n.index)(link5.targetIndex);
                          })(allNodes);
                          if (v2 instanceof Just) {
                            var layerDist = toNumber(v2.value0.layer - node.layer | 0);
                            var v1 = link5.value * max14(1)(layerDist);
                            var idealY = targetTop(node)(v2.value0)(sortedLinks)(allNodes)(allLinks)(padding1);
                            return {
                              sum: acc.sum + idealY * v1,
                              totalWeight: acc.totalWeight + v1
                            };
                          }
                          ;
                          if (v2 instanceof Nothing) {
                            return acc;
                          }
                          ;
                          throw new Error("Failed pattern match at DataViz.Layout.Sankey.Compute (line 627, column 13 - line 637, column 29): " + [v2.constructor.name]);
                        };
                      })({
                        sum: 0,
                        totalWeight: 0
                      })(sortedLinks);
                      var $200 = result.totalWeight > 0;
                      if ($200) {
                        return result.sum / result.totalWeight;
                      }
                      ;
                      return node.y0;
                    };
                  };
                };
              };
              var calculateWeightedFromSources = function(node) {
                return function(allNodes) {
                  return function(allLinks) {
                    return function(padding1) {
                      var incomingLinks = filter(function(l2) {
                        return eq13(l2.targetIndex)(node.index);
                      })(allLinks);
                      var sortedLinks = sortBy(function(a3) {
                        return function(b10) {
                          var v2 = find2(function(n) {
                            return eq13(n.index)(b10.sourceIndex);
                          })(allNodes);
                          var v1 = find2(function(n) {
                            return eq13(n.index)(a3.sourceIndex);
                          })(allNodes);
                          if (v1 instanceof Just && v2 instanceof Just) {
                            return append111(compare16(v1.value0.y0)(v2.value0.y0))(compare17(a3.index)(b10.index));
                          }
                          ;
                          return compare17(a3.index)(b10.index);
                        };
                      })(incomingLinks);
                      var result = foldl4(function(acc) {
                        return function(link5) {
                          var v2 = find2(function(n) {
                            return eq13(n.index)(link5.sourceIndex);
                          })(allNodes);
                          if (v2 instanceof Just) {
                            var layerDist = toNumber(node.layer - v2.value0.layer | 0);
                            var v1 = link5.value * max14(1)(layerDist);
                            var idealY = sourceTop(v2.value0)(node)(sortedLinks)(allNodes)(allLinks)(padding1);
                            return {
                              sum: acc.sum + idealY * v1,
                              totalWeight: acc.totalWeight + v1
                            };
                          }
                          ;
                          if (v2 instanceof Nothing) {
                            return acc;
                          }
                          ;
                          throw new Error("Failed pattern match at DataViz.Layout.Sankey.Compute (line 665, column 13 - line 674, column 29): " + [v2.constructor.name]);
                        };
                      })({
                        sum: 0,
                        totalWeight: 0
                      })(sortedLinks);
                      var $207 = result.totalWeight > 0;
                      if ($207) {
                        return result.sum / result.totalWeight;
                      }
                      ;
                      return node.y0;
                    };
                  };
                };
              };
              var relaxLayer = function(currentNodes) {
                return function(allLinks) {
                  return function(layerIdx) {
                    return function(padding1) {
                      return function(ascending3) {
                        return function(alpha) {
                          return function(beta2) {
                            var layerNodes = filter(function(n) {
                              return n.layer === layerIdx;
                            })(currentNodes);
                            var sortedLayerNodes = sortBy(function(a3) {
                              return function(b10) {
                                return compare16(a3.y0)(b10.y0);
                              };
                            })(layerNodes);
                            var layerNodeIndices = map56(function(v2) {
                              return v2.index;
                            })(sortedLayerNodes);
                            var nodesAfterRelax = foldl4(function(nodes1) {
                              return function(nodeIdx) {
                                var v2 = find2(function(n) {
                                  return eq13(n.index)(nodeIdx);
                                })(nodes1);
                                if (v2 instanceof Nothing) {
                                  return nodes1;
                                }
                                ;
                                if (v2 instanceof Just) {
                                  var weightedY = (function() {
                                    if (ascending3) {
                                      return calculateWeightedFromSources(v2.value0)(nodes1)(allLinks)(padding1);
                                    }
                                    ;
                                    return calculateWeightedFromTargets(v2.value0)(nodes1)(allLinks)(padding1);
                                  })();
                                  var dy = (weightedY - v2.value0.y0) * alpha;
                                  var newY0 = v2.value0.y0 + dy;
                                  var newY1 = v2.value0.y1 + dy;
                                  var updatedNode = {
                                    color: v2.value0.color,
                                    depth: v2.value0.depth,
                                    index: v2.value0.index,
                                    layer: v2.value0.layer,
                                    name: v2.value0.name,
                                    nodeHeight: v2.value0.nodeHeight,
                                    sourceLinks: v2.value0.sourceLinks,
                                    targetLinks: v2.value0.targetLinks,
                                    value: v2.value0.value,
                                    x0: v2.value0.x0,
                                    x1: v2.value0.x1,
                                    y0: newY0,
                                    y1: newY1
                                  };
                                  return map56(function(n) {
                                    var $210 = eq13(n.index)(nodeIdx);
                                    if ($210) {
                                      return updatedNode;
                                    }
                                    ;
                                    return n;
                                  })(nodes1);
                                }
                                ;
                                throw new Error("Failed pattern match at DataViz.Layout.Sankey.Compute (line 570, column 13 - line 587, column 82): " + [v2.constructor.name]);
                              };
                            })(currentNodes)(layerNodeIndices);
                            var layerNodesUpdated = filter(function(n) {
                              return n.layer === layerIdx;
                            })(nodesAfterRelax);
                            var sorted = sortBy(function(a3) {
                              return function(b10) {
                                return compare16(a3.y0)(b10.y0);
                              };
                            })(layerNodesUpdated);
                            var sortedWithTarget = map56(function(node) {
                              return {
                                node,
                                targetY: node.y0
                              };
                            })(sorted);
                            var resolved = resolveCollisions(sortedWithTarget)(padding1)(y0)(y114)(beta2);
                            return updateNodes(nodesAfterRelax)(resolved);
                          };
                        };
                      };
                    };
                  };
                };
              };
              var relaxByLayer = function(currentNodes) {
                return function(allLinks) {
                  return function(padding1) {
                    return function(ascending3) {
                      return function(alpha) {
                        return function(beta2) {
                          var maxLayer = foldl4(function(acc) {
                            return function(node) {
                              return max13(acc)(node.layer);
                            };
                          })(0)(currentNodes);
                          var layerIndices = (function() {
                            if (ascending3) {
                              return range2(1)(maxLayer);
                            }
                            ;
                            return reverse2(range2(0)(maxLayer - 1 | 0));
                          })();
                          var relaxed = foldl4(function(nodes1) {
                            return function(layerIdx) {
                              return relaxLayer(nodes1)(allLinks)(layerIdx)(padding1)(ascending3)(alpha)(beta2);
                            };
                          })(currentNodes)(layerIndices);
                          return relaxed;
                        };
                      };
                    };
                  };
                };
              };
              var $213 = config.iterations <= 0;
              if ($213) {
                return nodes3;
              }
              ;
              return foldl4(function(currentNodes) {
                return function(i2) {
                  var alpha = pow(0.99)(toNumber(i2));
                  var beta2 = max14(1 - alpha)(toNumber(i2 + 1 | 0) / toNumber(config.iterations));
                  var rtl = relaxByLayer(currentNodes)(links3)(padding2)(false)(alpha)(beta2);
                  var ltr = relaxByLayer(rtl)(links3)(padding2)(true)(alpha)(beta2);
                  return ltr;
                };
              })(nodes3)(range2(0)(config.iterations - 1 | 0));
            };
          };
        };
      };
    };
  };
  var computeNodeValues = /* @__PURE__ */ (function() {
    var setNodeValue2 = function(links3) {
      return function(n) {
        var totalOut = foldl4(function(sum6) {
          return function(link5) {
            return sum6 + link5.value;
          };
        })(0)(filter(function(l2) {
          return eq13(l2.sourceIndex)(n.index);
        })(links3));
        var totalIn = foldl4(function(sum6) {
          return function(link5) {
            return sum6 + link5.value;
          };
        })(0)(filter(function(l2) {
          return eq13(l2.targetIndex)(n.index);
        })(links3));
        return {
          name: n.name,
          x0: n.x0,
          y0: n.y0,
          x1: n.x1,
          y1: n.y1,
          depth: n.depth,
          nodeHeight: n.nodeHeight,
          layer: n.layer,
          index: n.index,
          color: n.color,
          sourceLinks: n.sourceLinks,
          targetLinks: n.targetLinks,
          value: max14(totalIn)(totalOut)
        };
      };
    };
    return bind36(get7)(function(model) {
      var updatedNodes = map56(setNodeValue2(model.sankeyLinks))(model.sankeyNodes);
      return modify_4(function(v2) {
        var $214 = {};
        for (var $215 in v2) {
          if ({}.hasOwnProperty.call(v2, $215)) {
            $214[$215] = v2[$215];
          }
          ;
        }
        ;
        $214.sankeyNodes = updatedNodes;
        return $214;
      });
    });
  })();
  var computeNodeHeights = /* @__PURE__ */ (function() {
    var bfsHeight = function($copy_nodes) {
      return function($copy_height) {
        return function($copy_current) {
          return function($copy_maxHeight) {
            var $tco_var_nodes = $copy_nodes;
            var $tco_var_height = $copy_height;
            var $tco_var_current = $copy_current;
            var $tco_done = false;
            var $tco_result;
            function $tco_loop(nodes3, height47, current, maxHeight) {
              if (isEmpty2(current)) {
                $tco_done = true;
                return nodes3;
              }
              ;
              if (height47 > maxHeight) {
                $tco_done = true;
                return nodes3;
              }
              ;
              if (otherwise) {
                var nodesWithHeight = map56(function(node) {
                  var $221 = member3(node.index)(current);
                  if ($221) {
                    return {
                      index: node.index,
                      color: node.color,
                      depth: node.depth,
                      layer: node.layer,
                      name: node.name,
                      sourceLinks: node.sourceLinks,
                      targetLinks: node.targetLinks,
                      value: node.value,
                      x0: node.x0,
                      x1: node.x1,
                      y0: node.y0,
                      y1: node.y1,
                      nodeHeight: height47
                    };
                  }
                  ;
                  return node;
                })(nodes3);
                var next2 = foldl4(function(acc) {
                  return function(node) {
                    var $222 = member3(node.index)(current);
                    if ($222) {
                      return union5(acc)(node.targetLinks);
                    }
                    ;
                    return acc;
                  };
                })(empty8)(nodes3);
                $tco_var_nodes = nodesWithHeight;
                $tco_var_height = height47 + 1 | 0;
                $tco_var_current = next2;
                $copy_maxHeight = maxHeight;
                return;
              }
              ;
              throw new Error("Failed pattern match at DataViz.Layout.Sankey.Compute (line 262, column 3 - line 262, column 84): " + [nodes3.constructor.name, height47.constructor.name, current.constructor.name, maxHeight.constructor.name]);
            }
            ;
            while (!$tco_done) {
              $tco_result = $tco_loop($tco_var_nodes, $tco_var_height, $tco_var_current, $copy_maxHeight);
            }
            ;
            return $tco_result;
          };
        };
      };
    };
    return bind36(get7)(function(model) {
      var n = length3(model.sankeyNodes);
      var sinkNodes = filter(function(node) {
        return isEmpty2(node.sourceLinks);
      })(model.sankeyNodes);
      var initialCurrent = fromFoldable21(map56(function(v2) {
        return v2.index;
      })(sinkNodes));
      var result = bfsHeight(model.sankeyNodes)(0)(initialCurrent)(n);
      return modify_4(function(v2) {
        var $223 = {};
        for (var $224 in v2) {
          if ({}.hasOwnProperty.call(v2, $224)) {
            $223[$224] = v2[$224];
          }
          ;
        }
        ;
        $223.sankeyNodes = result;
        return $223;
      });
    });
  })();
  var computeNodeDepths = /* @__PURE__ */ (function() {
    var bfsDepth = function($copy_nodes) {
      return function($copy_depth) {
        return function($copy_current) {
          return function($copy_maxDepth) {
            var $tco_var_nodes = $copy_nodes;
            var $tco_var_depth = $copy_depth;
            var $tco_var_current = $copy_current;
            var $tco_done = false;
            var $tco_result;
            function $tco_loop(nodes3, depth, current, maxDepth2) {
              if (isEmpty2(current)) {
                $tco_done = true;
                return nodes3;
              }
              ;
              if (depth > maxDepth2) {
                $tco_done = true;
                return nodes3;
              }
              ;
              if (otherwise) {
                var nodesWithDepth = map56(function(node) {
                  var $230 = member3(node.index)(current);
                  if ($230) {
                    return {
                      index: node.index,
                      color: node.color,
                      layer: node.layer,
                      name: node.name,
                      nodeHeight: node.nodeHeight,
                      sourceLinks: node.sourceLinks,
                      targetLinks: node.targetLinks,
                      value: node.value,
                      x0: node.x0,
                      x1: node.x1,
                      y0: node.y0,
                      y1: node.y1,
                      depth
                    };
                  }
                  ;
                  return node;
                })(nodes3);
                var next2 = foldl4(function(acc) {
                  return function(node) {
                    var $231 = member3(node.index)(current);
                    if ($231) {
                      return union5(acc)(node.sourceLinks);
                    }
                    ;
                    return acc;
                  };
                })(empty8)(nodes3);
                $tco_var_nodes = nodesWithDepth;
                $tco_var_depth = depth + 1 | 0;
                $tco_var_current = next2;
                $copy_maxDepth = maxDepth2;
                return;
              }
              ;
              throw new Error("Failed pattern match at DataViz.Layout.Sankey.Compute (line 220, column 3 - line 220, column 83): " + [nodes3.constructor.name, depth.constructor.name, current.constructor.name, maxDepth2.constructor.name]);
            }
            ;
            while (!$tco_done) {
              $tco_result = $tco_loop($tco_var_nodes, $tco_var_depth, $tco_var_current, $copy_maxDepth);
            }
            ;
            return $tco_result;
          };
        };
      };
    };
    return bind36(get7)(function(model) {
      var n = length3(model.sankeyNodes);
      var sourceNodes = filter(function(node) {
        return isEmpty2(node.targetLinks);
      })(model.sankeyNodes);
      var initialCurrent = fromFoldable21(map56(function(v2) {
        return v2.index;
      })(sourceNodes));
      var result = bfsDepth(model.sankeyNodes)(0)(initialCurrent)(n);
      return modify_4(function(v2) {
        var $232 = {};
        for (var $233 in v2) {
          if ({}.hasOwnProperty.call(v2, $233)) {
            $232[$233] = v2[$233];
          }
          ;
        }
        ;
        $232.sankeyNodes = result;
        return $232;
      });
    });
  })();
  var computeLinkBreadths = /* @__PURE__ */ (function() {
    var calculateLinkYPositions = function(nodes3) {
      return function(links3) {
        var linksWithY0 = foldl4(function(currentLinks) {
          return function(node) {
            var outgoingLinks = filter(function(link5) {
              return eq13(link5.sourceIndex)(node.index);
            })(currentLinks);
            var sorted = sortBy(function(a3) {
              return function(b10) {
                var v2 = find2(function(n) {
                  return eq13(n.index)(b10.targetIndex);
                })(nodes3);
                var v1 = find2(function(n) {
                  return eq13(n.index)(a3.targetIndex);
                })(nodes3);
                if (v1 instanceof Just && v2 instanceof Just) {
                  return append111(compare16(v1.value0.y0)(v2.value0.y0))(compare17(a3.index)(b10.index));
                }
                ;
                return compare17(a3.index)(b10.index);
              };
            })(outgoingLinks);
            var withY0 = foldl4(function(acc) {
              return function(link5) {
                var y32 = acc.y + link5.width / 2;
                var updated = {
                  width: link5.width,
                  index: link5.index,
                  sourceIndex: link5.sourceIndex,
                  targetIndex: link5.targetIndex,
                  color: link5.color,
                  value: link5.value,
                  y1: link5.y1,
                  y0: y32
                };
                return {
                  y: acc.y + link5.width,
                  links: snoc3(acc.links)(updated)
                };
              };
            })({
              y: node.y0,
              links: []
            })(sorted);
            return map56(function(link5) {
              var v2 = find2(function(l2) {
                return eq22(l2.index)(link5.index);
              })(withY0.links);
              if (v2 instanceof Just) {
                return v2.value0;
              }
              ;
              if (v2 instanceof Nothing) {
                return link5;
              }
              ;
              throw new Error("Failed pattern match at DataViz.Layout.Sankey.Compute (line 988, column 21 - line 990, column 38): " + [v2.constructor.name]);
            })(currentLinks);
          };
        })(links3)(nodes3);
        var linksWithY1 = foldl4(function(currentLinks) {
          return function(node) {
            var incomingLinks = filter(function(link5) {
              return eq13(link5.targetIndex)(node.index);
            })(currentLinks);
            var sorted = sortBy(function(a3) {
              return function(b10) {
                var v2 = find2(function(n) {
                  return eq13(n.index)(b10.sourceIndex);
                })(nodes3);
                var v1 = find2(function(n) {
                  return eq13(n.index)(a3.sourceIndex);
                })(nodes3);
                if (v1 instanceof Just && v2 instanceof Just) {
                  return append111(compare16(v1.value0.y0)(v2.value0.y0))(compare17(a3.index)(b10.index));
                }
                ;
                return compare17(a3.index)(b10.index);
              };
            })(incomingLinks);
            var withY1 = foldl4(function(acc) {
              return function(link5) {
                var y32 = acc.y + link5.width / 2;
                var updated = {
                  width: link5.width,
                  index: link5.index,
                  sourceIndex: link5.sourceIndex,
                  targetIndex: link5.targetIndex,
                  color: link5.color,
                  value: link5.value,
                  y0: link5.y0,
                  y1: y32
                };
                return {
                  y: acc.y + link5.width,
                  links: snoc3(acc.links)(updated)
                };
              };
            })({
              y: node.y0,
              links: []
            })(sorted);
            return map56(function(link5) {
              var v2 = find2(function(l2) {
                return eq22(l2.index)(link5.index);
              })(withY1.links);
              if (v2 instanceof Just) {
                return v2.value0;
              }
              ;
              if (v2 instanceof Nothing) {
                return link5;
              }
              ;
              throw new Error("Failed pattern match at DataViz.Layout.Sankey.Compute (line 1029, column 21 - line 1031, column 38): " + [v2.constructor.name]);
            })(currentLinks);
          };
        })(linksWithY0)(nodes3);
        return linksWithY1;
      };
    };
    var calculateGlobalKy1 = function(nodes3) {
      return function(y0) {
        return function(y114) {
          return function(padding2) {
            var scaleForLayer = function(layerNodes) {
              var totalValue = foldl4(function(sum6) {
                return function(node) {
                  return sum6 + node.value;
                };
              })(0)(layerNodes);
              var numNodes = toNumber(length3(layerNodes));
              var availableHeight = y114 - y0 - (numNodes - 1) * padding2;
              var $247 = totalValue > 0;
              if ($247) {
                return availableHeight / totalValue;
              }
              ;
              return 1;
            };
            var maxLayer = foldl4(function(acc) {
              return function(node) {
                return max13(acc)(node.layer);
              };
            })(0)(nodes3);
            var layers = map56(function(layerIdx) {
              return filter(function(node) {
                return node.layer === layerIdx;
              })(nodes3);
            })(range2(0)(maxLayer));
            var scales = map56(scaleForLayer)(layers);
            var nonEmptyScales = filter(function(s3) {
              return s3 > 0;
            })(scales);
            var v2 = head2(nonEmptyScales);
            if (v2 instanceof Just) {
              return foldl4(min9)(v2.value0)(nonEmptyScales);
            }
            ;
            if (v2 instanceof Nothing) {
              return 1;
            }
            ;
            throw new Error("Failed pattern match at DataViz.Layout.Sankey.Compute (line 948, column 7 - line 950, column 23): " + [v2.constructor.name]);
          };
        };
      };
    };
    return bind36(get7)(function(model) {
      var ky = calculateGlobalKy1(model.sankeyNodes)(model.config.extent.y0)(model.config.extent.y1)(model.config.nodePadding);
      var linksWithWidth = map56(function(link5) {
        return {
          value: link5.value,
          color: link5.color,
          index: link5.index,
          sourceIndex: link5.sourceIndex,
          targetIndex: link5.targetIndex,
          y0: link5.y0,
          y1: link5.y1,
          width: link5.value * ky
        };
      })(model.sankeyLinks);
      var linksWithY = calculateLinkYPositions(model.sankeyNodes)(linksWithWidth);
      var v2 = unsafePerformEffect(function __do7() {
        log2("\n=== After computeLinkBreadths ===")();
        return for_4(linksWithY)(function(link5) {
          var v1 = find2(function(n) {
            return eq13(n.index)(link5.targetIndex);
          })(model.sankeyNodes);
          var v22 = find2(function(n) {
            return eq13(n.index)(link5.sourceIndex);
          })(model.sankeyNodes);
          if (v22 instanceof Just && v1 instanceof Just) {
            return log2("  " + (v22.value0.name + (" -> " + (v1.value0.name + (" | y0=" + (show35(link5.y0) + (" | y1=" + (show35(link5.y1) + (" | width=" + show35(link5.width))))))))));
          }
          ;
          return pure25(unit);
        })();
      });
      return modify_4(function(v1) {
        var $254 = {};
        for (var $255 in v1) {
          if ({}.hasOwnProperty.call(v1, $255)) {
            $254[$255] = v1[$255];
          }
          ;
        }
        ;
        $254.sankeyLinks = linksWithY;
        return $254;
      });
    });
  })();
  var calculateGlobalKy = function(nodes3) {
    return function(y0) {
      return function(y114) {
        return function(padding2) {
          var scaleForLayer = function(layerNodes) {
            var totalValue = foldl4(function(sum6) {
              return function(node) {
                return sum6 + node.value;
              };
            })(0)(layerNodes);
            var numNodes = toNumber(length3(layerNodes));
            var availableHeight = y114 - y0 - (numNodes - 1) * padding2;
            var $257 = totalValue > 0;
            if ($257) {
              return availableHeight / totalValue;
            }
            ;
            return 1;
          };
          var maxLayer = foldl4(function(acc) {
            return function(node) {
              return max13(acc)(node.layer);
            };
          })(0)(nodes3);
          var layers = map56(function(layerIdx) {
            return filter(function(node) {
              return node.layer === layerIdx;
            })(nodes3);
          })(range2(0)(maxLayer));
          var scales = map56(scaleForLayer)(layers);
          var nonEmptyScales = filter(function(s3) {
            return s3 > 0;
          })(scales);
          var v2 = head2(nonEmptyScales);
          if (v2 instanceof Just) {
            return foldl4(min9)(v2.value0)(nonEmptyScales);
          }
          ;
          if (v2 instanceof Nothing) {
            return 1;
          }
          ;
          throw new Error("Failed pattern match at DataViz.Layout.Sankey.Compute (line 311, column 5 - line 313, column 21): " + [v2.constructor.name]);
        };
      };
    };
  };
  var assignColors = /* @__PURE__ */ bind36(get7)(function(model) {
    var colors5 = ["#1f77b4", "#ff7f0e", "#2ca02c", "#d62728", "#9467bd", "#8c564b", "#e377c2", "#7f7f7f", "#bcbd22", "#17becf"];
    var nodesWithColor = mapWithIndex3(function(i2) {
      return function(node) {
        return {
          depth: node.depth,
          index: node.index,
          layer: node.layer,
          name: node.name,
          nodeHeight: node.nodeHeight,
          sourceLinks: node.sourceLinks,
          targetLinks: node.targetLinks,
          value: node.value,
          x0: node.x0,
          x1: node.x1,
          y0: node.y0,
          y1: node.y1,
          color: fromMaybe("#999")(index(colors5)(mod8(i2)(length3(colors5))))
        };
      };
    })(model.sankeyNodes);
    var assignLinkColor = function(nodes3) {
      return function(mode) {
        return function(link5) {
          if (mode instanceof SourceColor) {
            var sourceNode = find2(function(n) {
              return eq13(n.index)(link5.sourceIndex);
            })(nodes3);
            return {
              sourceIndex: link5.sourceIndex,
              targetIndex: link5.targetIndex,
              value: link5.value,
              width: link5.width,
              y0: link5.y0,
              y1: link5.y1,
              index: link5.index,
              color: maybe("#999")(function(n) {
                return n.color;
              })(sourceNode)
            };
          }
          ;
          if (mode instanceof TargetColor) {
            var targetNode = find2(function(n) {
              return eq13(n.index)(link5.targetIndex);
            })(nodes3);
            return {
              sourceIndex: link5.sourceIndex,
              targetIndex: link5.targetIndex,
              value: link5.value,
              width: link5.width,
              y0: link5.y0,
              y1: link5.y1,
              index: link5.index,
              color: maybe("#999")(function(n) {
                return n.color;
              })(targetNode)
            };
          }
          ;
          if (mode instanceof SourceTargetGradient) {
            return {
              sourceIndex: link5.sourceIndex,
              targetIndex: link5.targetIndex,
              value: link5.value,
              width: link5.width,
              y0: link5.y0,
              y1: link5.y1,
              index: link5.index,
              color: "url(#sankey-gradient-" + (show120(link5.index) + ")")
            };
          }
          ;
          if (mode instanceof StaticColor) {
            return {
              sourceIndex: link5.sourceIndex,
              targetIndex: link5.targetIndex,
              value: link5.value,
              width: link5.width,
              y0: link5.y0,
              y1: link5.y1,
              index: link5.index,
              color: mode.value0
            };
          }
          ;
          throw new Error("Failed pattern match at DataViz.Layout.Sankey.Compute (line 1074, column 7 - line 1089, column 29): " + [mode.constructor.name]);
        };
      };
    };
    var linksWithColor = map56(assignLinkColor(nodesWithColor)(model.config.linkColorMode))(model.sankeyLinks);
    return modify_4(function(v2) {
      var $263 = {};
      for (var $264 in v2) {
        if ({}.hasOwnProperty.call(v2, $264)) {
          $263[$264] = v2[$264];
        }
        ;
      }
      ;
      $263.sankeyNodes = nodesWithColor;
      $263.sankeyLinks = linksWithColor;
      return $263;
    });
  });
  var alignNodeToLayer = function(alignment) {
    return function(node) {
      return function(numLayers) {
        if (alignment instanceof Left3) {
          return node.depth;
        }
        ;
        if (alignment instanceof Right3) {
          return max13(0)((numLayers - 1 | 0) - node.nodeHeight | 0);
        }
        ;
        if (alignment instanceof Justify) {
          var $267 = isEmpty2(node.sourceLinks);
          if ($267) {
            return numLayers - 1 | 0;
          }
          ;
          return node.depth;
        }
        ;
        if (alignment instanceof Center2) {
          var $268 = !isEmpty2(node.targetLinks);
          if ($268) {
            return node.depth;
          }
          ;
          return 0;
        }
        ;
        throw new Error("Failed pattern match at DataViz.Layout.Sankey.Compute (line 412, column 3 - line 422, column 13): " + [alignment.constructor.name]);
      };
    };
  };
  var computeNodeLayers = function(nodes3) {
    return function(config) {
      return function(x0) {
        return function(x113) {
          var maxDepth2 = foldl4(function(acc) {
            return function(node) {
              return max13(acc)(node.depth);
            };
          })(0)(nodes3);
          var numLayers = maxDepth2 + 1 | 0;
          var nodesWithLayer = map56(function(node) {
            var layer = alignNodeToLayer(config.alignment)(node)(numLayers);
            return {
              color: node.color,
              depth: node.depth,
              index: node.index,
              name: node.name,
              nodeHeight: node.nodeHeight,
              sourceLinks: node.sourceLinks,
              targetLinks: node.targetLinks,
              value: node.value,
              x0: node.x0,
              x1: node.x1,
              y0: node.y0,
              y1: node.y1,
              layer
            };
          })(nodes3);
          var kx = (x113 - x0 - config.nodeWidth) / max14(1)(toNumber(numLayers - 1 | 0));
          var nodesWithX = map56(function(node) {
            var x0Pos = x0 + toNumber(node.layer) * kx;
            return {
              layer: node.layer,
              color: node.color,
              depth: node.depth,
              index: node.index,
              name: node.name,
              nodeHeight: node.nodeHeight,
              sourceLinks: node.sourceLinks,
              targetLinks: node.targetLinks,
              value: node.value,
              y0: node.y0,
              y1: node.y1,
              x0: x0Pos,
              x1: x0Pos + config.nodeWidth
            };
          })(nodesWithLayer);
          return nodesWithX;
        };
      };
    };
  };
  var computeNodeBreadths = /* @__PURE__ */ bind36(get7)(function(model) {
    var nodesWithLayers = computeNodeLayers(model.sankeyNodes)(model.config)(model.config.extent.x0)(model.config.extent.x1);
    var totalHeight = model.config.extent.y1 - model.config.extent.y0;
    var maxLayer = foldl4(function(acc) {
      return function(node) {
        return max13(acc)(node.layer);
      };
    })(0)(nodesWithLayers);
    var layers = map56(function(layerIdx) {
      return filter(function(node) {
        return node.layer === layerIdx;
      })(nodesWithLayers);
    })(range2(0)(maxLayer));
    var maxNodesInLayer = foldl4(function(acc) {
      return function(layer) {
        return max13(acc)(length3(layer));
      };
    })(0)(layers);
    var adjustedPadding = (function() {
      var $269 = maxNodesInLayer > 1;
      if ($269) {
        return min9(model.config.nodePadding)(totalHeight / (toNumber(maxNodesInLayer) - 1));
      }
      ;
      return model.config.nodePadding;
    })();
    var nodesWithY = initializeNodeBreadths(nodesWithLayers)(model.sankeyLinks)(model.config)(adjustedPadding)(model.config.extent.y0)(model.config.extent.y1);
    var ky = calculateGlobalKy(nodesWithY)(model.config.extent.y0)(model.config.extent.y1)(adjustedPadding);
    var linksWithWidth = map56(function(link5) {
      return {
        value: link5.value,
        color: link5.color,
        index: link5.index,
        sourceIndex: link5.sourceIndex,
        targetIndex: link5.targetIndex,
        y0: link5.y0,
        y1: link5.y1,
        width: link5.value * ky
      };
    })(model.sankeyLinks);
    var v2 = unsafePerformEffect(function __do7() {
      log2("\n=== After initializeNodeBreadths (ky=" + (show35(ky) + (", adjustedPadding=" + (show35(adjustedPadding) + ") ==="))))();
      var maxLayer$prime = foldl4(function(acc) {
        return function(node) {
          return max13(acc)(node.layer);
        };
      })(0)(nodesWithY);
      return for_4(range2(0)(maxLayer$prime))(function(layerIdx) {
        var layerNodes = sortBy(function(a3) {
          return function(b10) {
            return compare16(a3.y0)(b10.y0);
          };
        })(filter(function(n) {
          return n.layer === layerIdx;
        })(nodesWithY));
        return function __do8() {
          log2("  Layer " + (show120(layerIdx) + ":"))();
          return for_4(layerNodes)(function(n) {
            return log2("    " + (n.name + (" | y0=" + (show35(n.y0) + (" | y1=" + (show35(n.y1) + (" | value=" + show35(n.value))))))));
          })();
        };
      })();
    });
    var relaxedNodes = relaxation(nodesWithY)(linksWithWidth)(model.config)(adjustedPadding)(model.config.extent.y0)(model.config.extent.y1);
    var v1 = unsafePerformEffect(function __do7() {
      (function() {
        var v23 = find2(function(n) {
          return n.name === "Nuclear";
        })(relaxedNodes);
        if (v23 instanceof Just) {
          return log2("AFTER relaxation - Nuclear: y0=" + (show35(v23.value0.y0) + (", y1=" + show35(v23.value0.y1))))();
        }
        ;
        if (v23 instanceof Nothing) {
          return unit;
        }
        ;
        throw new Error("Failed pattern match at DataViz.Layout.Sankey.Compute (line 366, column 7 - line 368, column 29): " + [v23.constructor.name]);
      })();
      (function() {
        var v23 = find2(function(n) {
          return n.name === "Thermal generation";
        })(relaxedNodes);
        if (v23 instanceof Just) {
          return log2("AFTER relaxation - Thermal generation: y0=" + (show35(v23.value0.y0) + (", y1=" + show35(v23.value0.y1))))();
        }
        ;
        if (v23 instanceof Nothing) {
          return unit;
        }
        ;
        throw new Error("Failed pattern match at DataViz.Layout.Sankey.Compute (line 369, column 7 - line 371, column 29): " + [v23.constructor.name]);
      })();
      var v22 = find2(function(n) {
        return n.name === "Losses";
      })(relaxedNodes);
      if (v22 instanceof Just) {
        return log2("AFTER relaxation - Losses: y0=" + (show35(v22.value0.y0) + (", y1=" + show35(v22.value0.y1))))();
      }
      ;
      if (v22 instanceof Nothing) {
        return unit;
      }
      ;
      throw new Error("Failed pattern match at DataViz.Layout.Sankey.Compute (line 372, column 7 - line 374, column 29): " + [v22.constructor.name]);
    });
    return modify_4(function(v22) {
      var $276 = {};
      for (var $277 in v22) {
        if ({}.hasOwnProperty.call(v22, $277)) {
          $276[$277] = v22[$277];
        }
        ;
      }
      ;
      $276.sankeyNodes = relaxedNodes;
      $276.sankeyLinks = linksWithWidth;
      return $276;
    });
  });
  var computeLayoutWithConfig = function(linkInputs) {
    return function(config) {
      var logStep = function(stepName) {
        return bind36(get7)(function(model) {
          var v2 = unsafePerformEffect(function __do7() {
            log2("\n=== " + (stepName + " ==="))();
            return for_4(sortBy(function(a3) {
              return function(b10) {
                return compare22(a3.name)(b10.name);
              };
            })(model.sankeyNodes))(function(n) {
              return log2("  " + (n.name + (" | layer=" + (show120(n.layer) + (" | depth=" + (show120(n.depth) + (" | height=" + (show120(n.nodeHeight) + (" | value=" + (show35(n.value) + (" | y0=" + (show35(n.y0) + (" | y1=" + show35(n.y1))))))))))))));
            })();
          });
          return pure111(unit);
        });
      };
      var computeSankeyLayout = discard23(for_12(linkInputs)(processCSVLink))(function() {
        return discard23(initialiseSankeyNodes)(function() {
          return discard23(logStep("After initialiseSankeyNodes (nodeLinks)"))(function() {
            return discard23(computeNodeValues)(function() {
              return discard23(logStep("After computeNodeValues"))(function() {
                return discard23(computeNodeDepths)(function() {
                  return discard23(logStep("After computeNodeDepths"))(function() {
                    return discard23(computeNodeHeights)(function() {
                      return discard23(logStep("After computeNodeHeights"))(function() {
                        return discard23(computeNodeBreadths)(function() {
                          return discard23(logStep("After computeNodeBreadths (FINAL)"))(function() {
                            return discard23(computeLinkBreadths)(function() {
                              return assignColors;
                            });
                          });
                        });
                      });
                    });
                  });
                });
              });
            });
          });
        });
      });
      var finalModel = execState(computeSankeyLayout)(initialSankeyGraphModel(config));
      return {
        nodes: finalModel.sankeyNodes,
        links: finalModel.sankeyLinks
      };
    };
  };
  var computeLayout = function(linkInputs) {
    return function(width47) {
      return function(height47) {
        return computeLayoutWithConfig(linkInputs)(defaultSankeyConfig(width47)(height47));
      };
    };
  };

  // output/DataViz.Layout.Sankey.Path/index.js
  var eq5 = /* @__PURE__ */ eq(eqNodeID);
  var findNode2 = function(nodes3) {
    return function(nodeId) {
      return find2(function(n) {
        return eq5(n.index)(nodeId);
      })(nodes3);
    };
  };
  var generateLinkPath = function(nodes3) {
    return function(link5) {
      var targetNode = findNode2(nodes3)(link5.targetIndex);
      var sourceNode = findNode2(nodes3)(link5.sourceIndex);
      if (sourceNode instanceof Just && targetNode instanceof Just) {
        var xi = (sourceNode.value0.x1 + targetNode.value0.x0) / 2;
        var y0Bottom = link5.y0 + link5.width / 2;
        var y0Top = link5.y0 - link5.width / 2;
        var y1Bottom = link5.y1 + link5.width / 2;
        var y1Top = link5.y1 - link5.width / 2;
        return "M" + (toString(sourceNode.value0.x1) + ("," + (toString(y0Top) + (" C" + (toString(xi) + ("," + (toString(y0Top) + (" " + (toString(xi) + ("," + (toString(y1Top) + (" " + (toString(targetNode.value0.x0) + ("," + (toString(y1Top) + (" L" + (toString(targetNode.value0.x0) + ("," + (toString(y1Bottom) + (" C" + (toString(xi) + ("," + (toString(y1Bottom) + (" " + (toString(xi) + ("," + (toString(y0Bottom) + (" " + (toString(sourceNode.value0.x1) + ("," + (toString(y0Bottom) + " Z")))))))))))))))))))))))))))))));
      }
      ;
      return "";
    };
  };

  // output/D3.Viz.TreeAPI.SankeyDiagram/index.js
  var compare18 = /* @__PURE__ */ compare(ordInt);
  var y1IsSymbol = {
    reflectSymbol: function() {
      return "y1";
    }
  };
  var y0IsSymbol = {
    reflectSymbol: function() {
      return "y0";
    }
  };
  var x1IsSymbol = {
    reflectSymbol: function() {
      return "x1";
    }
  };
  var x0IsSymbol = {
    reflectSymbol: function() {
      return "x0";
    }
  };
  var chartWidthIsSymbol = {
    reflectSymbol: function() {
      return "chartWidth";
    }
  };
  var eq14 = /* @__PURE__ */ eq(eqNodeID);
  var bind37 = /* @__PURE__ */ bind(bindMaybe);
  var pure26 = /* @__PURE__ */ pure(applicativeMaybe);
  var show36 = /* @__PURE__ */ show(showInt);
  var discard24 = /* @__PURE__ */ discard(discardUnit)(bindD3v2M);
  var liftEffect24 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var bind119 = /* @__PURE__ */ bind(bindD3v2M);
  var select21 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var attr17 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text18 = /* @__PURE__ */ text6(stringExprEvalD);
  var attr18 = /* @__PURE__ */ attr3(toAttributeValueNumber);
  var num13 = /* @__PURE__ */ num(numExprEvalD);
  var map57 = /* @__PURE__ */ map(functorArray);
  var width20 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var height20 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var renderTree31 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D);
  var renderTree111 = /* @__PURE__ */ renderTree31(ordUnit);
  var path9 = /* @__PURE__ */ path(toAttributeValueString);
  var fill13 = /* @__PURE__ */ fill(toAttributeValueString);
  var opacity4 = /* @__PURE__ */ opacity(toAttributeValueNumber);
  var x13 = /* @__PURE__ */ x(toAttributeValueNumber);
  var y14 = /* @__PURE__ */ y(toAttributeValueNumber);
  var stroke13 = /* @__PURE__ */ stroke(toAttributeValueString);
  var strokeWidth12 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var renderTree211 = /* @__PURE__ */ renderTree31(/* @__PURE__ */ ordRecord()(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(ordRecordNil)()(y1IsSymbol)(ordNumber))()(y0IsSymbol)(ordNumber))()(x1IsSymbol)(ordNumber))()(x0IsSymbol)(ordNumber))()({
    reflectSymbol: function() {
      return "name";
    }
  })(ordString))()({
    reflectSymbol: function() {
      return "color";
    }
  })(ordString))()(chartWidthIsSymbol)(ordNumber)));
  var pure112 = /* @__PURE__ */ pure(applicativeD3v2M);
  var eqIndexedNode = {
    eq: function(v2) {
      return function(v1) {
        return v2.index === v1.index;
      };
    }
  };
  var ordIndexedNode = {
    compare: function(v2) {
      return function(v1) {
        return compare18(v2.index)(v1.index);
      };
    },
    Eq0: function() {
      return eqIndexedNode;
    }
  };
  var renderTree34 = /* @__PURE__ */ renderTree31(ordIndexedNode);
  var eqIndexedLink = {
    eq: function(v2) {
      return function(v1) {
        return v2.index === v1.index;
      };
    }
  };
  var ordIndexedLink = {
    compare: function(v2) {
      return function(v1) {
        return compare18(v2.index)(v1.index);
      };
    },
    Eq0: function() {
      return eqIndexedLink;
    }
  };
  var renderTree43 = /* @__PURE__ */ renderTree31(ordIndexedLink);
  var toLabelDatum = function(chartWidth) {
    return function(node) {
      return {
        name: node.name,
        x0: node.x0,
        x1: node.x1,
        y0: node.y0,
        y1: node.y1,
        color: node.color,
        chartWidth
      };
    };
  };
  var labelY1 = function(dictDatumExpr) {
    return field(dictDatumExpr)(y1IsSymbol)()($$Proxy.value);
  };
  var labelY0 = function(dictDatumExpr) {
    return field(dictDatumExpr)(y0IsSymbol)()($$Proxy.value);
  };
  var labelYExpr = function(dictNumExpr) {
    var divLit2 = divLit(dictNumExpr);
    var add8 = add4(dictNumExpr);
    return function(dictDatumExpr) {
      return divLit2(add8(labelY0(dictDatumExpr))(labelY1(dictDatumExpr)))(2);
    };
  };
  var labelYExpr1 = /* @__PURE__ */ labelYExpr(numExprEvalD)(datumExprEvalD);
  var labelX1 = function(dictDatumExpr) {
    return field(dictDatumExpr)(x1IsSymbol)()($$Proxy.value);
  };
  var labelX0 = function(dictDatumExpr) {
    return field(dictDatumExpr)(x0IsSymbol)()($$Proxy.value);
  };
  var labelChartWidth = function(dictDatumExpr) {
    return field(dictDatumExpr)(chartWidthIsSymbol)()($$Proxy.value);
  };
  var labelXExpr = function(dictNumExpr) {
    var divLit2 = divLit(dictNumExpr);
    var addLit2 = addLit(dictNumExpr);
    var subLit2 = subLit(dictNumExpr);
    return function(dictBoolExpr) {
      var ifThenElse2 = ifThenElse(dictBoolExpr);
      return function(dictCompareExpr) {
        var ltOp2 = ltOp(dictCompareExpr);
        return function(dictDatumExpr) {
          var labelX01 = labelX0(dictDatumExpr);
          return ifThenElse2(ltOp2(labelX01)(divLit2(labelChartWidth(dictDatumExpr))(2)))(addLit2(labelX1(dictDatumExpr))(6))(subLit2(labelX01)(6));
        };
      };
    };
  };
  var labelXExpr1 = /* @__PURE__ */ labelXExpr(numExprEvalD)(boolExprEvalD)(compareExprEvalD)(datumExprEvalD);
  var labelAnchorExpr = function(dictNumExpr) {
    var divLit2 = divLit(dictNumExpr);
    return function(dictBoolExpr) {
      var ifThenElse2 = ifThenElse(dictBoolExpr);
      return function(dictCompareExpr) {
        var ltOp2 = ltOp(dictCompareExpr);
        return function(dictStringExpr) {
          var s3 = s(dictStringExpr);
          return function(dictDatumExpr) {
            return ifThenElse2(ltOp2(labelX0(dictDatumExpr))(divLit2(labelChartWidth(dictDatumExpr))(2)))(s3("start"))(s3("end"));
          };
        };
      };
    };
  };
  var labelAnchorExpr1 = /* @__PURE__ */ labelAnchorExpr(numExprEvalD)(boolExprEvalD)(compareExprEvalD)(stringExprEvalD)(datumExprEvalD);
  var isGradientColor = function(color2) {
    var v2 = indexOf("url(#sankey-gradient-")(color2);
    if (v2 instanceof Just) {
      return true;
    }
    ;
    if (v2 instanceof Nothing) {
      return false;
    }
    ;
    throw new Error("Failed pattern match at D3.Viz.TreeAPI.SankeyDiagram (line 127, column 25 - line 129, column 19): " + [v2.constructor.name]);
  };
  var findNodeById = function(nodes3) {
    return function(nodeId) {
      return find2(function(n) {
        return eq14(n.index)(nodeId);
      })(nodes3);
    };
  };
  var evalLabelStr = function(expr) {
    return function(datum2) {
      return runEvalD(expr)(datum2)(0);
    };
  };
  var evalLabelNum = function(expr) {
    return function(datum2) {
      return runEvalD(expr)(datum2)(0);
    };
  };
  var createGradientSpecs = function(nodes3) {
    return function(links3) {
      var mkGradientSpec = function(link5) {
        var $157 = isGradientColor(link5.color);
        if ($157) {
          return bind37(findNodeById(nodes3)(link5.sourceIndex))(function(sourceNode) {
            return bind37(findNodeById(nodes3)(link5.targetIndex))(function(targetNode) {
              return pure26({
                id: "sankey-gradient-" + show36(link5.index),
                sourceColor: sourceNode.color,
                targetColor: targetNode.color,
                sourceX: sourceNode.x1,
                targetX: targetNode.x0
              });
            });
          });
        }
        ;
        return Nothing.value;
      };
      return mapMaybe(mkGradientSpec)(links3);
    };
  };
  var drawSankey = function(csvData) {
    return function(containerSelector) {
      return function(w) {
        return function(h7) {
          return runD3v2M(discard24(liftEffect24(log2("=== Drawing Sankey with TreeAPI ===")))(function() {
            return bind119(select21(containerSelector))(function(container) {
              var linkInputs = parseSankeyCSV(csvData);
              return discard24(liftEffect24(log2("Parsed " + (show36(length3(linkInputs)) + " links from CSV"))))(function() {
                var layoutResult = computeLayout(linkInputs)(w)(h7);
                return discard24(liftEffect24(log2("Layout computed: " + (show36(length3(layoutResult.nodes)) + (" nodes, " + (show36(length3(layoutResult.links)) + " links"))))))(function() {
                  var indexedNodes = mapWithIndex3(function(i2) {
                    return function(node) {
                      return {
                        index: i2,
                        node
                      };
                    };
                  })(layoutResult.nodes);
                  var indexedLinks = mapWithIndex3(function(i2) {
                    return function(link5) {
                      return {
                        index: i2,
                        link: link5
                      };
                    };
                  })(layoutResult.links);
                  var gradientSpecs = createGradientSpecs(layoutResult.nodes)(layoutResult.links);
                  return discard24(liftEffect24(log2("Created " + (show36(length3(gradientSpecs)) + " gradient definitions"))))(function() {
                    var mkGradientTree = function(v2) {
                      return withChildren(named(LinearGradient.value)(v2.id)([attr17("id")(text18(v2.id)), attr17("gradientUnits")(text18("userSpaceOnUse")), attr18("x1")(num13(v2.sourceX)), attr18("x2")(num13(v2.targetX)), attr18("y1")(num13(0)), attr18("y2")(num13(0))]))([elem3(Stop.value)([attr17("offset")(text18("0%")), attr17("stop-color")(text18(v2.sourceColor))]), elem3(Stop.value)([attr17("offset")(text18("100%")), attr17("stop-color")(text18(v2.targetColor))])]);
                    };
                    var defsChildren = map57(mkGradientTree)(gradientSpecs);
                    var sankeyTree = withChildren(named(SVG.value)("svg")([width20(num13(w)), height20(num13(h7)), viewBox(0)(0)(w)(h7), attr17("id")(text18("sankey-svg")), attr17("class")(text18("sankey"))]))([withChildren(named(Defs.value)("defs")([]))(defsChildren), named(Group.value)("linksGroup")([attr17("class")(text18("links"))]), named(Group.value)("nodesGroup")([attr17("class")(text18("nodes"))]), named(Group.value)("labelsGroup")([attr17("class")(text18("labels"))])]);
                    return bind119(renderTree111(container)(sankeyTree))(function(selections) {
                      return bind119(liftEffect24(reselectD3v2("linksGroup")(selections)))(function(linksGroupSel) {
                        return bind119(liftEffect24(reselectD3v2("nodesGroup")(selections)))(function(nodesGroupSel) {
                          return bind119(liftEffect24(reselectD3v2("labelsGroup")(selections)))(function(labelsGroupSel) {
                            var linksTree = joinData("linkElements")("path")(indexedLinks)(function(v2) {
                              return elem3(Path.value)([attr17("class")(text18("sankey-link")), path9(text18(generateLinkPath(layoutResult.nodes)(v2.link))), fill13(text18(v2.link.color)), opacity4(num13(0.5))]);
                            });
                            return bind119(renderTree43(linksGroupSel)(linksTree))(function() {
                              var nodesTree = joinData("nodeElements")("rect")(indexedNodes)(function(v2) {
                                return elem3(Rect.value)([attr17("class")(text18("sankey-node")), x13(num13(v2.node.x0)), y14(num13(v2.node.y0)), width20(num13(v2.node.x1 - v2.node.x0)), height20(num13(v2.node.y1 - v2.node.y0)), fill13(text18(v2.node.color)), stroke13(text18("#000")), strokeWidth12(num13(1)), opacity4(num13(0.3))]);
                              });
                              return bind119(renderTree34(nodesGroupSel)(nodesTree))(function() {
                                var labelData = map57(function(v2) {
                                  return toLabelDatum(w)(v2.node);
                                })(indexedNodes);
                                var labelsTree = joinData("labelElements")("text")(labelData)(function(datum2) {
                                  return elem3(Text.value)([attr17("class")(text18("sankey-label")), x13(num13(evalLabelNum(labelXExpr1)(datum2))), y14(num13(evalLabelNum(labelYExpr1)(datum2))), attr17("text-anchor")(text18(evalLabelStr(labelAnchorExpr1)(datum2))), fill13(text18("#000")), attr17("text-content")(text18(datum2.name))]);
                                });
                                return bind119(renderTree211(labelsGroupSel)(labelsTree))(function() {
                                  return discard24(liftEffect24(log2("Sankey diagram rendered with TreeAPI")))(function() {
                                    return pure112(unit);
                                  });
                                });
                              });
                            });
                          });
                        });
                      });
                    });
                  });
                });
              });
            });
          }));
        };
      };
    };
  };
  var startSankey = function(csvData) {
    return function(containerSelector) {
      return drawSankey(csvData)(containerSelector)(750)(500);
    };
  };

  // output/D3.Viz.TreeAPI.ScatterPlotExample/index.js
  var bind38 = /* @__PURE__ */ bind(bindD3v2M);
  var map58 = /* @__PURE__ */ map(functorArray);
  var minimum5 = /* @__PURE__ */ minimum(ordNumber)(foldableArray);
  var maximum9 = /* @__PURE__ */ maximum(ordNumber)(foldableArray);
  var width21 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var num14 = /* @__PURE__ */ num(numExprEvalD);
  var height21 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr19 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text19 = /* @__PURE__ */ text6(stringExprEvalD);
  var transform9 = /* @__PURE__ */ transform2(toAttributeValueString);
  var show37 = /* @__PURE__ */ show(showNumber);
  var cx6 = /* @__PURE__ */ cx(toAttributeValueNumber);
  var cy6 = /* @__PURE__ */ cy(toAttributeValueNumber);
  var r8 = /* @__PURE__ */ r(toAttributeValueNumber);
  var fill14 = /* @__PURE__ */ fill(toAttributeValueString);
  var opacity5 = /* @__PURE__ */ opacity(toAttributeValueNumber);
  var renderTree35 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(/* @__PURE__ */ ordRecord()(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(ordRecordNil)()({
    reflectSymbol: function() {
      return "y";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "x";
    }
  })(ordNumber)));
  var liftEffect25 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var show121 = /* @__PURE__ */ show(showInt);
  var lookup18 = /* @__PURE__ */ lookup(ordString);
  var scatterData = [{
    x: 10,
    y: 20
  }, {
    x: 25,
    y: 45
  }, {
    x: 40,
    y: 30
  }, {
    x: 55,
    y: 70
  }, {
    x: 70,
    y: 50
  }, {
    x: 85,
    y: 85
  }, {
    x: 100,
    y: 65
  }, {
    x: 115,
    y: 90
  }, {
    x: 130,
    y: 75
  }, {
    x: 145,
    y: 95
  }];
  var innerWidth5 = function(dims) {
    return dims.width - dims.marginLeft - dims.marginRight;
  };
  var innerHeight5 = function(dims) {
    return dims.height - dims.marginTop - dims.marginBottom;
  };
  var defaultDims4 = {
    width: 600,
    height: 400,
    marginTop: 20,
    marginRight: 20,
    marginBottom: 40,
    marginLeft: 50
  };
  var scatterPlot = /* @__PURE__ */ runD3v2M(/* @__PURE__ */ bind38(/* @__PURE__ */ select(selectionMD3v2Selection_D)("#viz"))(function(container) {
    var iWidth = innerWidth5(defaultDims4);
    var iHeight = innerHeight5(defaultDims4);
    var xValues = map58(function(v2) {
      return v2.x;
    })(scatterData);
    var yValues = map58(function(v2) {
      return v2.y;
    })(scatterData);
    var minX = fromMaybe(0)(minimum5(xValues));
    var maxX = fromMaybe(100)(maximum9(xValues));
    var minY = fromMaybe(0)(minimum5(yValues));
    var maxY = fromMaybe(100)(maximum9(yValues));
    var xScale = function(val) {
      return (val - minX) / (maxX - minX) * iWidth;
    };
    var yScale = function(val) {
      return iHeight - (val - minY) / (maxY - minY) * iHeight;
    };
    var tree2 = withChild(named(SVG.value)("svg")([width21(num14(defaultDims4.width)), height21(num14(defaultDims4.height)), viewBox(0)(0)(defaultDims4.width)(defaultDims4.height), attr19("class")(text19("scatter-plot-tree"))]))(withChild(named(Group.value)("chartGroup")([attr19("class")(text19("chart-content")), transform9(text19("translate(" + (show37(defaultDims4.marginLeft) + ("," + (show37(defaultDims4.marginTop) + ")")))))]))(joinData("points")("circle")(scatterData)(function(point3) {
      return elem3(Circle.value)([cx6(num14(xScale(point3.x))), cy6(num14(yScale(point3.y))), r8(num14(6)), fill14(text19("#e74c3c")), opacity5(num14(0.7)), attr19("class")(text19("point"))]);
    })));
    return bind38(renderTree35(container)(tree2))(function(selections) {
      return liftEffect25(function __do7() {
        log2("=== Scatter Plot (Tree API) ===")();
        log2("")();
        log2("Rendered " + (show121(length3(scatterData)) + " points"))();
        (function() {
          var v2 = lookup18("svg")(selections);
          if (v2 instanceof Just) {
            return log2("\u2713 SVG created")();
          }
          ;
          if (v2 instanceof Nothing) {
            return log2("\u2717 Missing SVG")();
          }
          ;
          throw new Error("Failed pattern match at D3.Viz.TreeAPI.ScatterPlotExample (line 120, column 5 - line 122, column 45): " + [v2.constructor.name]);
        })();
        (function() {
          var v2 = lookup18("chartGroup")(selections);
          if (v2 instanceof Just) {
            return log2("\u2713 Chart group created")();
          }
          ;
          if (v2 instanceof Nothing) {
            return log2("\u2717 Missing chart group")();
          }
          ;
          throw new Error("Failed pattern match at D3.Viz.TreeAPI.ScatterPlotExample (line 124, column 5 - line 126, column 53): " + [v2.constructor.name]);
        })();
        (function() {
          var v2 = lookup18("points")(selections);
          if (v2 instanceof Just) {
            return log2("\u2713 Points collection created")();
          }
          ;
          if (v2 instanceof Nothing) {
            return log2("\u2717 Missing points collection")();
          }
          ;
          throw new Error("Failed pattern match at D3.Viz.TreeAPI.ScatterPlotExample (line 128, column 5 - line 130, column 59): " + [v2.constructor.name]);
        })();
        log2("")();
        return log2("Expected: 10 red circles showing scatter pattern")();
      });
    });
  }));

  // output/D3.Viz.TreeAPI.SimpleTreeExample/index.js
  var bind39 = /* @__PURE__ */ bind(bindD3v2M);
  var width22 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var num15 = /* @__PURE__ */ num(numExprEvalD);
  var height22 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr20 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text20 = /* @__PURE__ */ text6(stringExprEvalD);
  var cx7 = /* @__PURE__ */ cx(toAttributeValueNumber);
  var cy7 = /* @__PURE__ */ cy(toAttributeValueNumber);
  var r9 = /* @__PURE__ */ r(toAttributeValueNumber);
  var fill15 = /* @__PURE__ */ fill(toAttributeValueString);
  var x14 = /* @__PURE__ */ x(toAttributeValueNumber);
  var y15 = /* @__PURE__ */ y(toAttributeValueNumber);
  var textContent8 = /* @__PURE__ */ textContent2(toAttributeValueString);
  var textAnchor8 = /* @__PURE__ */ textAnchor(toAttributeValueString);
  var renderTree36 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(ordUnit);
  var liftEffect26 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var lookup19 = /* @__PURE__ */ lookup(ordString);
  var testSimpleTree = /* @__PURE__ */ runD3v2M(/* @__PURE__ */ bind39(/* @__PURE__ */ select(selectionMD3v2Selection_D)("#viz"))(function(container) {
    var tree2 = withChild(named(SVG.value)("svg")([width22(num15(800)), height22(num15(600)), viewBox(0)(0)(800)(600), attr20("id")(text20("simple-tree-svg"))]))(withChildren(named(Group.value)("container")([attr20("class")(text20("container"))]))([named(Circle.value)("circle")([cx7(num15(100)), cy7(num15(100)), r9(num15(20)), fill15(text20("steelblue"))]), named(Text.value)("text")([x14(num15(100)), y15(num15(130)), textContent8(text20("Hello Tree API!")), textAnchor8(text20("middle"))])]));
    return bind39(renderTree36(container)(tree2))(function(selections) {
      return liftEffect26(function __do7() {
        (function() {
          var v2 = lookup19("svg")(selections);
          if (v2 instanceof Just) {
            return log2("\u2713 Found svg selection")();
          }
          ;
          if (v2 instanceof Nothing) {
            return log2("\u2717 Missing svg selection")();
          }
          ;
          throw new Error("Failed pattern match at D3.Viz.TreeAPI.SimpleTreeExample (line 49, column 5 - line 51, column 55): " + [v2.constructor.name]);
        })();
        (function() {
          var v2 = lookup19("container")(selections);
          if (v2 instanceof Just) {
            return log2("\u2713 Found container selection")();
          }
          ;
          if (v2 instanceof Nothing) {
            return log2("\u2717 Missing container selection")();
          }
          ;
          throw new Error("Failed pattern match at D3.Viz.TreeAPI.SimpleTreeExample (line 53, column 5 - line 55, column 61): " + [v2.constructor.name]);
        })();
        (function() {
          var v2 = lookup19("circle")(selections);
          if (v2 instanceof Just) {
            return log2("\u2713 Found circle selection")();
          }
          ;
          if (v2 instanceof Nothing) {
            return log2("\u2717 Missing circle selection")();
          }
          ;
          throw new Error("Failed pattern match at D3.Viz.TreeAPI.SimpleTreeExample (line 57, column 5 - line 59, column 58): " + [v2.constructor.name]);
        })();
        (function() {
          var v2 = lookup19("text")(selections);
          if (v2 instanceof Just) {
            return log2("\u2713 Found text selection")();
          }
          ;
          if (v2 instanceof Nothing) {
            return log2("\u2717 Missing text selection")();
          }
          ;
          throw new Error("Failed pattern match at D3.Viz.TreeAPI.SimpleTreeExample (line 61, column 5 - line 63, column 56): " + [v2.constructor.name]);
        })();
        return log2("Simple tree rendering complete!")();
      });
    });
  }));

  // output/D3.Viz.TreeAPI.SunburstViz/index.js
  var map59 = /* @__PURE__ */ map(functorMaybe);
  var map119 = /* @__PURE__ */ map(functorArray);
  var append25 = /* @__PURE__ */ append(semigroupArray);
  var bind40 = /* @__PURE__ */ bind(bindArray);
  var mod9 = /* @__PURE__ */ mod(euclideanRingInt);
  var show38 = /* @__PURE__ */ show(showNumber);
  var show122 = /* @__PURE__ */ show(showInt);
  var bind120 = /* @__PURE__ */ bind(bindD3v2M);
  var select22 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var discard25 = /* @__PURE__ */ discard(discardUnit)(bindD3v2M);
  var liftEffect27 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var width23 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var num16 = /* @__PURE__ */ num(numExprEvalD);
  var height23 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr21 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text21 = /* @__PURE__ */ text6(stringExprEvalD);
  var path10 = /* @__PURE__ */ path(toAttributeValueString);
  var fill16 = /* @__PURE__ */ fill(toAttributeValueString);
  var attr110 = /* @__PURE__ */ attr3(toAttributeValueNumber);
  var stroke14 = /* @__PURE__ */ stroke(toAttributeValueString);
  var strokeWidth13 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var renderTree37 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(/* @__PURE__ */ ordPartitionNode(ordString));
  var bind213 = /* @__PURE__ */ bind(bindAff);
  var liftEffect114 = /* @__PURE__ */ liftEffect(monadEffectAff);
  var toHierarchyData3 = function(node) {
    var children3 = getChildren2(node);
    var nodeValue = (function() {
      if (children3 instanceof Nothing) {
        return new Just(getValue2(node));
      }
      ;
      if (children3 instanceof Just) {
        return Nothing.value;
      }
      ;
      throw new Error("Failed pattern match at D3.Viz.TreeAPI.SunburstViz (line 29, column 17 - line 31, column 24): " + [children3.constructor.name]);
    })();
    return {
      data_: getName2(node),
      value: nodeValue,
      children: map59(map119(toHierarchyData3))(children3)
    };
  };
  var getAllNodes3 = function(v2) {
    var $43 = length3(v2.value0.children) === 0;
    if ($43) {
      return [v2];
    }
    ;
    return append25([v2])(bind40(v2.value0.children)(getAllNodes3));
  };
  var colors3 = ["#e7ba52", "#c7c7c7", "#aec7e8", "#1f77b4", "#9467bd"];
  var getColor3 = function(depth) {
    var v2 = index(colors3)(mod9(depth)(length3(colors3)));
    if (v2 instanceof Just) {
      return v2.value0;
    }
    ;
    if (v2 instanceof Nothing) {
      return "#cccccc";
    }
    ;
    throw new Error("Failed pattern match at D3.Viz.TreeAPI.SunburstViz (line 44, column 18 - line 46, column 23): " + [v2.constructor.name]);
  };
  var arcPath2 = function(x0_) {
    return function(y0_) {
      return function(x1_) {
        return function(y1_) {
          return function(radius) {
            var startAngle = x0_ * 2 * pi;
            var outerRadius = y1_ * radius;
            var x102 = cos(startAngle) * outerRadius;
            var y102 = sin(startAngle) * outerRadius;
            var innerRadius = y0_ * radius;
            var x00 = cos(startAngle) * innerRadius;
            var y00 = sin(startAngle) * innerRadius;
            var endAngle = x1_ * 2 * pi;
            var largeArc = (function() {
              var $47 = endAngle - startAngle > pi;
              if ($47) {
                return 1;
              }
              ;
              return 0;
            })();
            var x01 = cos(endAngle) * innerRadius;
            var x113 = cos(endAngle) * outerRadius;
            var y01 = sin(endAngle) * innerRadius;
            var y114 = sin(endAngle) * outerRadius;
            return "M" + (show38(x102) + ("," + (show38(y102) + ("A" + (show38(outerRadius) + ("," + (show38(outerRadius) + (" 0 " + (show122(largeArc) + (" 1 " + (show38(x113) + ("," + (show38(y114) + ("L" + (show38(x01) + ("," + (show38(y01) + ("A" + (show38(innerRadius) + ("," + (show38(innerRadius) + (" 0 " + (show122(largeArc) + (" 0 " + (show38(x00) + ("," + (show38(y00) + "Z")))))))))))))))))))))))))));
          };
        };
      };
    };
  };
  var drawSunburst = function(selector) {
    return function(flareData) {
      return runD3v2M(bind120(select22(selector))(function(container) {
        var radius = 700 / 2;
        var hierData = toHierarchyData3(flareData);
        var partRoot = hierarchy2(hierData);
        var config = {
          round: defaultPartitionConfig.round,
          size: {
            width: 1,
            height: 1
          },
          padding: 1e-3
        };
        var partitioned = partition3(config)(partRoot);
        var allNodes = getAllNodes3(partitioned);
        var nodes3 = filter(function(v2) {
          return v2.value0.depth > 0;
        })(allNodes);
        return discard25(liftEffect27(log2("Rendering sunburst: " + (show122(length3(nodes3)) + " arcs"))))(function() {
          var tree2 = withChild(named(SVG.value)("svg")([width23(num16(700)), height23(num16(700)), viewBox(-radius)(-radius)(700)(700), attr21("class")(text21("sunburst-viz"))]))(joinData("arcs")("g")(nodes3)(function(v2) {
            return withChild(named(Group.value)("arc-" + v2.value0.data_)([attr21("class")(text21("node"))]))(elem3(Path.value)([path10(text21(arcPath2(v2.value0.x0)(v2.value0.y0)(v2.value0.x1)(v2.value0.y1)(radius))), fill16(text21(getColor3(v2.value0.depth))), attr110("fill-opacity")(num16(0.7)), stroke14(text21("#fff")), strokeWidth13(num16(1))]));
          }));
          return bind120(renderTree37(container)(tree2))(function() {
            return liftEffect27(log2("=== Sunburst Diagram ===="));
          });
        });
      }));
    };
  };
  var sunburstViz = function(selector) {
    return launchAff_(bind213(loadDataFile(FlareJSON.value))(function(result) {
      if (result instanceof Left) {
        return liftEffect114(log2("Failed to load Flare data: " + result.value0));
      }
      ;
      if (result instanceof Right) {
        return liftEffect114(drawSunburst(selector)(parseFlareJson(result.value0)));
      }
      ;
      throw new Error("Failed pattern match at D3.Viz.TreeAPI.SunburstViz (line 172, column 3 - line 174, column 87): " + [result.constructor.name]);
    }));
  };

  // output/D3.Viz.TreeAPI.ThreeLittleCircles/index.js
  var bind41 = /* @__PURE__ */ bind(bindD3v2M);
  var width24 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var num17 = /* @__PURE__ */ num(numExprEvalD);
  var height24 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr22 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text22 = /* @__PURE__ */ text6(stringExprEvalD);
  var cx8 = /* @__PURE__ */ cx(toAttributeValueNumber);
  var cy8 = /* @__PURE__ */ cy(toAttributeValueNumber);
  var r10 = /* @__PURE__ */ r(toAttributeValueNumber);
  var fill17 = /* @__PURE__ */ fill(toAttributeValueString);
  var renderTree38 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(/* @__PURE__ */ ordRecord()(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(ordRecordNil)()({
    reflectSymbol: function() {
      return "y";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "x";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "r";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "color";
    }
  })(ordString)));
  var liftEffect28 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var lookup20 = /* @__PURE__ */ lookup(ordString);
  var circleData = [{
    x: 100,
    y: 100,
    r: 40,
    color: "red"
  }, {
    x: 200,
    y: 100,
    r: 30,
    color: "green"
  }, {
    x: 300,
    y: 100,
    r: 50,
    color: "blue"
  }];
  var threeLittleCircles = /* @__PURE__ */ runD3v2M(/* @__PURE__ */ bind41(/* @__PURE__ */ select(selectionMD3v2Selection_D)("#viz"))(function(container) {
    var tree2 = withChild(named(SVG.value)("svg")([width24(num17(400)), height24(num17(200)), viewBox(0)(0)(400)(200), attr22("id")(text22("three-circles-svg")), attr22("class")(text22("tree-api-example"))]))(joinData("circles")("circle")(circleData)(function(d) {
      return elem3(Circle.value)([cx8(num17(d.x)), cy8(num17(d.y)), r10(num17(d.r)), fill17(text22(d.color))]);
    }));
    return bind41(renderTree38(container)(tree2))(function(selections) {
      return liftEffect28(function __do7() {
        log2("=== Three Little Circles (Declarative API) ===")();
        log2("")();
        log2("Structure: SVG \u2192 [Circle \xD7 3] (via joinData)")();
        log2("")();
        (function() {
          var v2 = lookup20("svg")(selections);
          if (v2 instanceof Just) {
            return log2("\u2713 SVG created")();
          }
          ;
          if (v2 instanceof Nothing) {
            return log2("\u2717 Missing SVG")();
          }
          ;
          throw new Error("Failed pattern match at D3.Viz.TreeAPI.ThreeLittleCircles (line 73, column 5 - line 75, column 45): " + [v2.constructor.name]);
        })();
        (function() {
          var v2 = lookup20("circles")(selections);
          if (v2 instanceof Just) {
            return log2("\u2713 Circles collection created (3 circles via data join)")();
          }
          ;
          if (v2 instanceof Nothing) {
            return log2("\u2717 Missing circles collection")();
          }
          ;
          throw new Error("Failed pattern match at D3.Viz.TreeAPI.ThreeLittleCircles (line 77, column 5 - line 79, column 60): " + [v2.constructor.name]);
        })();
        log2("")();
        log2("Expected result:")();
        log2("  - Red circle (r=40) at (100, 100)")();
        log2("  - Green circle (r=30) at (200, 100)")();
        log2("  - Blue circle (r=50) at (300, 100)")();
        log2("")();
        return log2("Check the browser to verify!")();
      });
    });
  }));

  // output/D3.Viz.TreeAPI.ThreeLittleCirclesTransition/index.js
  var discard26 = /* @__PURE__ */ discard(discardUnit);
  var discard112 = /* @__PURE__ */ discard26(bindD3v2M);
  var withTransition3 = /* @__PURE__ */ withTransition(transitionMD3v2Selection_);
  var from5 = /* @__PURE__ */ from3(showNumber);
  var r11 = /* @__PURE__ */ r(toAttributeValueNumber);
  var num18 = /* @__PURE__ */ num(numExprEvalD);
  var attr23 = /* @__PURE__ */ attr3(toAttributeValueNumber);
  var pure27 = /* @__PURE__ */ pure(applicativeD3v2M);
  var bind121 = /* @__PURE__ */ bind(bindD3v2M);
  var select23 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var width25 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var height25 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr111 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text23 = /* @__PURE__ */ text6(stringExprEvalD);
  var fill18 = /* @__PURE__ */ fill(toAttributeValueString);
  var cx9 = /* @__PURE__ */ cx(toAttributeValueNumber);
  var cy9 = /* @__PURE__ */ cy(toAttributeValueNumber);
  var renderTree39 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(ordInt);
  var lookup21 = /* @__PURE__ */ lookup(ordString);
  var StateGreen = /* @__PURE__ */ (function() {
    function StateGreen2() {
    }
    ;
    StateGreen2.value = new StateGreen2();
    return StateGreen2;
  })();
  var StateRGB = /* @__PURE__ */ (function() {
    function StateRGB2() {
    }
    ;
    StateRGB2.value = new StateRGB2();
    return StateRGB2;
  })();
  var showCircleState = {
    show: function(v2) {
      if (v2 instanceof StateGreen) {
        return "StateGreen";
      }
      ;
      if (v2 instanceof StateRGB) {
        return "StateRGB";
      }
      ;
      throw new Error("Failed pattern match at D3.Viz.TreeAPI.ThreeLittleCirclesTransition (line 40, column 1 - line 42, column 29): " + [v2.constructor.name]);
    }
  };
  var show39 = /* @__PURE__ */ show(showCircleState);
  var transitionToState = function(circlesSel) {
    return function(state3) {
      var cyFnRGB = function(d) {
        if (d === 0) {
          return 130;
        }
        ;
        if (d === 1) {
          return 130;
        }
        ;
        return 70;
      };
      var cyFnGreen = function(v2) {
        return 125;
      };
      var cxFnRGB = function(d) {
        if (d === 0) {
          return 150;
        }
        ;
        if (d === 1) {
          return 250;
        }
        ;
        return 200;
      };
      var cxFnGreen = function(d) {
        return 100 + toNumber(d) * 100;
      };
      var colorFnRGB = function(d) {
        if (d === 0) {
          return "#ff0000";
        }
        ;
        if (d === 1) {
          return "#00ff00";
        }
        ;
        return "#0000ff";
      };
      var colorFnGreen = function(v2) {
        return "#00ff00";
      };
      return runD3v2M((function() {
        var transitionConfig2 = transitionWith({
          duration: 1e3,
          delay: Nothing.value,
          staggerDelay: Nothing.value,
          easing: Nothing.value
        });
        return discard112((function() {
          if (state3 instanceof StateGreen) {
            return withTransition3(transitionConfig2)(circlesSel)([fromStr("fill")(colorFnGreen), from5("cx")(cxFnGreen), from5("cy")(cyFnGreen), r11(num18(40)), attr23("fill-opacity")(num18(1))]);
          }
          ;
          if (state3 instanceof StateRGB) {
            return withTransition3(transitionConfig2)(circlesSel)([fromStr("fill")(colorFnRGB), from5("cx")(cxFnRGB), from5("cy")(cyFnRGB), r11(num18(60)), attr23("fill-opacity")(num18(0.5))]);
          }
          ;
          throw new Error("Failed pattern match at D3.Viz.TreeAPI.ThreeLittleCirclesTransition (line 60, column 3 - line 77, column 10): " + [state3.constructor.name]);
        })())(function() {
          return pure27(unit);
        });
      })());
    };
  };
  var toggleState = function(v2) {
    if (v2 instanceof StateGreen) {
      return StateRGB.value;
    }
    ;
    if (v2 instanceof StateRGB) {
      return StateRGB.value;
    }
    ;
    throw new Error("Failed pattern match at D3.Viz.TreeAPI.ThreeLittleCirclesTransition (line 45, column 1 - line 45, column 42): " + [v2.constructor.name]);
  };
  var threeLittleCirclesTransition = function(selector) {
    return function __do7() {
      var stateRef = $$new(StateGreen.value)();
      return runD3v2M(bind121(select23(selector))(function(container) {
        var initialTree2 = withChild(named(SVG.value)("svg")([width25(num18(400)), height25(num18(250)), viewBox(0)(0)(400)(250), attr111("id")(text23("three-circles-transition-tree"))]))(joinData("circles")("circle")([0, 1, 2])(function(d) {
          return elem3(Circle.value)([fill18(text23("#00ff00")), cx9(num18(100 + toNumber(d) * 100)), cy9(num18(125)), r11(num18(40)), attr23("fill-opacity")(num18(1))]);
        }));
        return bind121(renderTree39(container)(initialTree2))(function(selections) {
          var circlesSel = (function() {
            var v2 = lookup21("circles")(selections);
            if (v2 instanceof Just) {
              return v2.value0;
            }
            ;
            if (v2 instanceof Nothing) {
              return unsafeCrashWith("circles selection not found");
            }
            ;
            throw new Error("Failed pattern match at D3.Viz.TreeAPI.ThreeLittleCirclesTransition (line 147, column 20 - line 149, column 81): " + [v2.constructor.name]);
          })();
          return pure27({
            stateRef,
            circlesSel
          });
        });
      }))();
    };
  };
  var createTransitionTrigger = function(v2) {
    return function __do7() {
      var currentState = read(v2.stateRef)();
      var newState = toggleState(currentState);
      write(newState)(v2.stateRef)();
      log2("Transitioning to: " + show39(newState))();
      return transitionToState(v2.circlesSel)(newState)();
    };
  };

  // output/D3.Viz.TreeAPI.ThreeLittleDimensionsExample/index.js
  var bind42 = /* @__PURE__ */ bind(bindD3v2M);
  var str7 = /* @__PURE__ */ str(stringExprEvalD);
  var identity15 = /* @__PURE__ */ identity(categoryFn);
  var show40 = /* @__PURE__ */ show(showInt);
  var renderTree40 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(/* @__PURE__ */ ordArray(ordInt));
  var liftEffect29 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var lookup22 = /* @__PURE__ */ lookup(ordString);
  var matrixData = [[1, 2, 3], [4, 5, 6], [7, 8, 9]];
  var threeLittleDimensions = /* @__PURE__ */ runD3v2M(/* @__PURE__ */ bind42(/* @__PURE__ */ select(selectionMD3v2Selection_D)("#viz"))(function(container) {
    var tree2 = withChild(named(Table.value)("table")([v3AttrStr("class")(str7("nested-data-table"))]))(nestedJoin("rows")("tr")(matrixData)(identity15)(function(cellValue) {
      return elem3(Td.value)([v3AttrStr("class")(str7("table-cell")), v3AttrStr("textContent")(str7(show40(cellValue)))]);
    }));
    return bind42(renderTree40(container)(tree2))(function(selections) {
      return liftEffect29(function __do7() {
        log2("=== Three Little Dimensions (Tree API) ===")();
        log2("")();
        (function() {
          var v2 = lookup22("table")(selections);
          if (v2 instanceof Just) {
            return log2("\u2713 Table created")();
          }
          ;
          if (v2 instanceof Nothing) {
            return log2("\u2717 Missing table")();
          }
          ;
          throw new Error("Failed pattern match at D3.Viz.TreeAPI.ThreeLittleDimensionsExample (line 62, column 5 - line 64, column 47): " + [v2.constructor.name]);
        })();
        (function() {
          var v2 = lookup22("rows")(selections);
          if (v2 instanceof Just) {
            return log2("\u2713 Rows created (" + (show40(length3(matrixData)) + ")"))();
          }
          ;
          if (v2 instanceof Nothing) {
            return log2("\u2717 Missing rows")();
          }
          ;
          throw new Error("Failed pattern match at D3.Viz.TreeAPI.ThreeLittleDimensionsExample (line 66, column 5 - line 68, column 46): " + [v2.constructor.name]);
        })();
        (function() {
          var v2 = lookup22("cells")(selections);
          if (v2 instanceof Just) {
            var totalCells = foldl4(function(acc) {
              return function(row) {
                return acc + length3(row) | 0;
              };
            })(0)(matrixData);
            return log2("\u2713 Cells created (" + (show40(totalCells) + " total)"))();
          }
          ;
          if (v2 instanceof Nothing) {
            return log2("\u2717 Missing cells")();
          }
          ;
          throw new Error("Failed pattern match at D3.Viz.TreeAPI.ThreeLittleDimensionsExample (line 70, column 5 - line 76, column 47): " + [v2.constructor.name]);
        })();
        log2("")();
        return log2("Expected: 3x3 table with numbers 1-9")();
      });
    });
  }));

  // output/D3.Viz.TreeAPI.TreeViz/index.js
  var bind43 = /* @__PURE__ */ bind(bindList);
  var append26 = /* @__PURE__ */ append(semigroupList);
  var fromFoldable24 = /* @__PURE__ */ fromFoldable3(foldableList);
  var show41 = /* @__PURE__ */ show(showNumber);
  var bind122 = /* @__PURE__ */ bind(bindD3v2M);
  var select24 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var fromFoldable111 = /* @__PURE__ */ fromFoldable3(/* @__PURE__ */ foldableCofree(foldableList));
  var discard27 = /* @__PURE__ */ discard(discardUnit);
  var discard113 = /* @__PURE__ */ discard27(bindD3v2M);
  var liftEffect30 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var show123 = /* @__PURE__ */ show(showInt);
  var width26 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var num19 = /* @__PURE__ */ num(numExprEvalD);
  var height26 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr24 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text24 = /* @__PURE__ */ text6(stringExprEvalD);
  var path11 = /* @__PURE__ */ path(toAttributeValueString);
  var fill19 = /* @__PURE__ */ fill(toAttributeValueString);
  var stroke15 = /* @__PURE__ */ stroke(toAttributeValueString);
  var strokeWidth14 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var renderTree41 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D);
  var ordRecord9 = /* @__PURE__ */ ordRecord();
  var ordRecordCons9 = /* @__PURE__ */ ordRecordCons(ordRecordNil)();
  var ordRecordCons14 = /* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons9({
    reflectSymbol: function() {
      return "y";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "x";
    }
  })(ordNumber);
  var ordRecord15 = /* @__PURE__ */ ordRecord9(ordRecordCons14);
  var renderTree112 = /* @__PURE__ */ renderTree41(/* @__PURE__ */ ordRecord9(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons9({
    reflectSymbol: function() {
      return "target";
    }
  })(ordRecord15))()({
    reflectSymbol: function() {
      return "source";
    }
  })(ordRecord15)));
  var cx10 = /* @__PURE__ */ cx(toAttributeValueNumber);
  var cy10 = /* @__PURE__ */ cy(toAttributeValueNumber);
  var r12 = /* @__PURE__ */ r(toAttributeValueNumber);
  var x15 = /* @__PURE__ */ x(toAttributeValueNumber);
  var y16 = /* @__PURE__ */ y(toAttributeValueNumber);
  var textContent9 = /* @__PURE__ */ textContent2(toAttributeValueString);
  var fontSize10 = /* @__PURE__ */ fontSize(toAttributeValueNumber);
  var textAnchor9 = /* @__PURE__ */ textAnchor(toAttributeValueString);
  var renderTree212 = /* @__PURE__ */ renderTree41(/* @__PURE__ */ ordRecord9(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(ordRecordCons14)()({
    reflectSymbol: function() {
      return "value";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "name";
    }
  })(ordString))()({
    reflectSymbol: function() {
      return "height";
    }
  })(ordInt))()({
    reflectSymbol: function() {
      return "depth";
    }
  })(ordInt)));
  var bind214 = /* @__PURE__ */ bind(bindAff);
  var liftEffect115 = /* @__PURE__ */ liftEffect(monadEffectAff);
  var makeLinks5 = function(tree$prime) {
    var makeLinksList = function(t2) {
      var val = head(t2);
      var children3 = tail(t2);
      var grandchildLinks = bind43(children3)(makeLinksList);
      var childLinks = bind43(children3)(function(child) {
        var childVal = head(child);
        return new Cons({
          source: {
            x: val.x,
            y: val.y
          },
          target: {
            x: childVal.x,
            y: childVal.y
          }
        }, Nil.value);
      });
      return append26(childLinks)(grandchildLinks);
    };
    return fromFoldable24(makeLinksList(tree$prime));
  };
  var linkPath3 = function(x1$prime) {
    return function(y1$prime) {
      return function(x2$prime) {
        return function(y2$prime) {
          return "M" + (show41(x1$prime) + ("," + (show41(y1$prime) + ("C" + (show41(x1$prime) + ("," + (show41((y1$prime + y2$prime) / 2) + (" " + (show41(x2$prime) + ("," + (show41((y1$prime + y2$prime) / 2) + (" " + (show41(x2$prime) + ("," + show41(y2$prime)))))))))))))));
        };
      };
    };
  };
  var drawTree = function(selector) {
    return function(flareTree) {
      return runD3v2M(bind122(select24(selector))(function(container) {
        var config = {
          layerScale: defaultTreeConfig.layerScale,
          minSeparation: defaultTreeConfig.minSeparation,
          separation: defaultTreeConfig.separation,
          size: {
            width: 800 - 2 * 40,
            height: 600 - 2 * 40
          }
        };
        var positioned = tree(config)(flareTree);
        var nodes3 = fromFoldable111(positioned);
        var links3 = makeLinks5(positioned);
        return discard113(liftEffect30(log2("Rendering " + (show123(length3(nodes3)) + (" nodes, " + (show123(length3(links3)) + " links"))))))(function() {
          var linksTree = withChild(named(SVG.value)("svg")([width26(num19(800)), height26(num19(600)), viewBox(0)(0)(800)(600), attr24("class")(text24("simple-hierarchy-tree"))]))(withChild(named(Group.value)("chartGroup")([attr24("class")(text24("tree-content"))]))(withChild(named(Group.value)("linksGroup")([attr24("class")(text24("links"))]))(joinData("links")("path")(links3)(function(link5) {
            return elem3(Path.value)([path11(text24(linkPath3(link5.source.x + 40)(link5.source.y + 40)(link5.target.x + 40)(link5.target.y + 40))), fill19(text24("none")), stroke15(text24("#999")), strokeWidth14(num19(1.5)), attr24("class")(text24("link"))]);
          }))));
          return bind122(renderTree112(container)(linksTree))(function(linksSelections) {
            return bind122(liftEffect30(reselectD3v2("chartGroup")(linksSelections)))(function(chartGroupSel) {
              var nodesTree = withChild(named(Group.value)("nodesGroup")([attr24("class")(text24("nodes"))]))(joinData("nodeGroups")("g")(nodes3)(function(node) {
                return withChildren(named(Group.value)("node-" + node.name)([attr24("class")(text24("node"))]))([elem3(Circle.value)([cx10(num19(node.x + 40)), cy10(num19(node.y + 40)), r12(num19(6)), fill19(text24("#69b3a2")), stroke15(text24("#fff")), strokeWidth14(num19(2))]), elem3(Text.value)([x15(num19(node.x + 40 + 10)), y16(num19(node.y + 40 + 4)), textContent9(text24(node.name)), fontSize10(num19(12)), textAnchor9(text24("start"))])]);
              }));
              return bind122(renderTree212(chartGroupSel)(nodesTree))(function(nodesSelections) {
                return liftEffect30(function __do7() {
                  log2("=== Tree Layout (Tree API) ===")();
                  log2("")();
                  log2("Rendered " + (show123(length3(nodes3)) + (" nodes, " + (show123(length3(links3)) + " links"))))();
                  log2("Flare visualization toolkit hierarchy")();
                  return log2("")();
                });
              });
            });
          });
        });
      }));
    };
  };
  var treeViz = function(selector) {
    return launchAff_(bind214(loadFlareData)(function(result) {
      if (result instanceof Left) {
        return liftEffect115(log2("Failed to load Flare data: " + result.value0));
      }
      ;
      if (result instanceof Right) {
        return liftEffect115(drawTree(selector)(result.value0));
      }
      ;
      throw new Error("Failed pattern match at D3.Viz.TreeAPI.TreeViz (line 175, column 3 - line 177, column 64): " + [result.constructor.name]);
    }));
  };

  // output/DataViz.Layout.Hierarchy.Types/index.js
  var VNode = /* @__PURE__ */ (function() {
    function VNode2(value0) {
      this.value0 = value0;
    }
    ;
    VNode2.create = function(value0) {
      return new VNode2(value0);
    };
    return VNode2;
  })();
  var HNode = /* @__PURE__ */ (function() {
    function HNode2(value0) {
      this.value0 = value0;
    }
    ;
    HNode2.create = function(value0) {
      return new HNode2(value0);
    };
    return HNode2;
  })();
  var getValue3 = function(v2) {
    return v2.value0.value;
  };

  // output/DataViz.Layout.Hierarchy.Core/index.js
  var map60 = /* @__PURE__ */ map(functorArray);
  var foldl14 = /* @__PURE__ */ foldl(foldableArray);
  var maximum10 = /* @__PURE__ */ maximum(ordInt)(foldableArray);
  var sum4 = function(v2) {
    return function(valueAccessor) {
      var $22 = $$null3(v2.value0.children);
      if ($22) {
        return new VNode({
          data_: v2.value0.data_,
          depth: v2.value0.depth,
          height: v2.value0.height,
          parent: Nothing.value,
          children: [],
          value: valueAccessor(v2.value0.data_)
        });
      }
      ;
      var ownValue = valueAccessor(v2.value0.data_);
      var childrenValued = map60(function(child) {
        return sum4(child)(valueAccessor);
      })(v2.value0.children);
      var childrenSum = foldl14(function(acc) {
        return function(child) {
          return acc + getValue3(child);
        };
      })(0)(childrenValued);
      var totalValue = ownValue + childrenSum;
      return new VNode({
        data_: v2.value0.data_,
        depth: v2.value0.depth,
        height: v2.value0.height,
        parent: Nothing.value,
        children: childrenValued,
        value: totalValue
      });
    };
  };
  var getHeight = function(v2) {
    return v2.value0.height;
  };
  var hierarchy3 = function(rootData) {
    return function(childrenAccessor) {
      var computeHeights2 = function(v2) {
        var $31 = $$null3(v2.value0.children);
        if ($31) {
          return new HNode({
            data_: v2.value0.data_,
            depth: v2.value0.depth,
            parent: v2.value0.parent,
            children: v2.value0.children,
            height: 0
          });
        }
        ;
        var childrenWithHeights = map60(computeHeights2)(v2.value0.children);
        var childHeights = map60(getHeight)(childrenWithHeights);
        var maxChildHeight = fromMaybe(0)(maximum10(childHeights));
        return new HNode({
          data_: v2.value0.data_,
          depth: v2.value0.depth,
          parent: v2.value0.parent,
          children: childrenWithHeights,
          height: maxChildHeight + 1 | 0
        });
      };
      var buildNode = function(parentRef) {
        return function(currentDepth) {
          return function(nodeData) {
            var v2 = childrenAccessor(nodeData);
            if (v2 instanceof Nothing) {
              return new HNode({
                data_: nodeData,
                depth: currentDepth,
                height: 0,
                parent: parentRef,
                children: []
              });
            }
            ;
            if (v2 instanceof Just) {
              var thisNode = new HNode({
                data_: nodeData,
                depth: currentDepth,
                height: 0,
                parent: parentRef,
                children: []
              });
              var builtChildren = map60(buildNode(new Just(thisNode))(currentDepth + 1 | 0))(v2.value0);
              var nodeWithChildren = new HNode({
                data_: nodeData,
                depth: currentDepth,
                height: 0,
                parent: parentRef,
                children: builtChildren
              });
              return nodeWithChildren;
            }
            ;
            throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Core (line 35, column 5 - line 70, column 27): " + [v2.constructor.name]);
          };
        };
      };
      return computeHeights2(buildNode(Nothing.value)(0)(rootData));
    };
  };

  // output/DataViz.Layout.Hierarchy.Treemap/index.js
  var map61 = /* @__PURE__ */ map(functorArray);
  var foldl15 = /* @__PURE__ */ foldl(foldableArray);
  var append112 = /* @__PURE__ */ append(semigroupArray);
  var compare19 = /* @__PURE__ */ compare(ordInt);
  var compare110 = /* @__PURE__ */ compare(ordNumber);
  var max15 = /* @__PURE__ */ max(ordNumber);
  var min10 = /* @__PURE__ */ min(ordNumber);
  var TNode = /* @__PURE__ */ (function() {
    function TNode2(value0) {
      this.value0 = value0;
    }
    ;
    TNode2.create = function(value0) {
      return new TNode2(value0);
    };
    return TNode2;
  })();
  var toTreemapNode = function(v2) {
    return new TNode({
      data_: v2.value0.data_,
      depth: v2.value0.depth,
      height: v2.value0.height,
      value: v2.value0.value,
      children: map61(toTreemapNode)(v2.value0.children),
      x0: 0,
      y0: 0,
      x1: 0,
      y1: 0
    });
  };
  var slice4 = function(v2) {
    return function(x0) {
      return function(y0) {
        return function(x113) {
          return function(y114) {
            var k = (function() {
              var $91 = v2.value0.value !== 0;
              if ($91) {
                return (y114 - y0) / v2.value0.value;
              }
              ;
              return 0;
            })();
            var positioned = foldl15(function(acc) {
              return function(child) {
                var height47 = child.value0.value * k;
                var positionedChild = new TNode({
                  data_: child.value0.data_,
                  depth: child.value0.depth,
                  height: child.value0.height,
                  value: child.value0.value,
                  children: child.value0.children,
                  x0,
                  x1: x113,
                  y0: acc.y,
                  y1: acc.y + height47
                });
                return {
                  children: snoc3(acc.children)(positionedChild),
                  y: acc.y + height47
                };
              };
            })({
              children: [],
              y: y0
            })(v2.value0.children);
            return new TNode({
              data_: v2.value0.data_,
              depth: v2.value0.depth,
              height: v2.value0.height,
              value: v2.value0.value,
              x0: v2.value0.x0,
              y0: v2.value0.y0,
              x1: v2.value0.x1,
              y1: v2.value0.y1,
              children: positioned.children
            });
          };
        };
      };
    };
  };
  var positionTree = function(config) {
    return function(v2) {
      return function(paddingStack) {
        var p2 = (function() {
          var v1 = index(paddingStack)(v2.value0.depth);
          if (v1 instanceof Just) {
            return v1.value0;
          }
          ;
          if (v1 instanceof Nothing) {
            return 0;
          }
          ;
          throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Treemap (line 125, column 9 - line 127, column 21): " + [v1.constructor.name]);
        })();
        var x0 = v2.value0.x0 + p2;
        var x113 = v2.value0.x1 - p2;
        var x0$prime = (function() {
          var $102 = x113 < x0;
          if ($102) {
            return (x0 + x113) / 2;
          }
          ;
          return x0;
        })();
        var x1$prime = (function() {
          var $103 = x113 < x0;
          if ($103) {
            return (x0 + x113) / 2;
          }
          ;
          return x113;
        })();
        var y0 = v2.value0.y0 + p2;
        var y114 = v2.value0.y1 - p2;
        var y0$prime = (function() {
          var $104 = y114 < y0;
          if ($104) {
            return (y0 + y114) / 2;
          }
          ;
          return y0;
        })();
        var y1$prime = (function() {
          var $105 = y114 < y0;
          if ($105) {
            return (y0 + y114) / 2;
          }
          ;
          return y114;
        })();
        var nodeWithPadding = new TNode({
          data_: v2.value0.data_,
          depth: v2.value0.depth,
          height: v2.value0.height,
          value: v2.value0.value,
          children: v2.value0.children,
          x0: x0$prime,
          y0: y0$prime,
          x1: x1$prime,
          y1: y1$prime
        });
        var $106 = $$null3(v2.value0.children);
        if ($106) {
          return nodeWithPadding;
        }
        ;
        var innerPad = config.paddingInner / 2;
        var newPaddingStack = append112(paddingStack)([innerPad]);
        var childY1 = y1$prime - config.paddingBottom + innerPad;
        var childY0 = y0$prime + config.paddingTop - innerPad;
        var childY0$prime = (function() {
          var $107 = childY1 < childY0;
          if ($107) {
            return (childY0 + childY1) / 2;
          }
          ;
          return childY0;
        })();
        var childY1$prime = (function() {
          var $108 = childY1 < childY0;
          if ($108) {
            return (childY0 + childY1) / 2;
          }
          ;
          return childY1;
        })();
        var childX1 = x1$prime - config.paddingRight + innerPad;
        var childX0 = x0$prime + config.paddingLeft - innerPad;
        var childX0$prime = (function() {
          var $109 = childX1 < childX0;
          if ($109) {
            return (childX0 + childX1) / 2;
          }
          ;
          return childX0;
        })();
        var childX1$prime = (function() {
          var $110 = childX1 < childX0;
          if ($110) {
            return (childX0 + childX1) / 2;
          }
          ;
          return childX1;
        })();
        var nodeWithTiledChildren = config.tile(nodeWithPadding)(childX0$prime)(childY0$prime)(childX1$prime)(childY1$prime);
        var finalChildren = map61(function(child) {
          return positionTree(config)(child)(newPaddingStack);
        })(nodeWithTiledChildren.value0.children);
        return new TNode({
          data_: nodeWithTiledChildren.value0.data_,
          depth: nodeWithTiledChildren.value0.depth,
          height: nodeWithTiledChildren.value0.height,
          value: nodeWithTiledChildren.value0.value,
          x0: nodeWithTiledChildren.value0.x0,
          y0: nodeWithTiledChildren.value0.y0,
          x1: nodeWithTiledChildren.value0.x1,
          y1: nodeWithTiledChildren.value0.y1,
          children: finalChildren
        });
      };
    };
  };
  var treemap = function(config) {
    return function(valuedRoot) {
      var root3 = toTreemapNode(valuedRoot);
      var rootWithBounds = new TNode({
        data_: root3.value0.data_,
        depth: root3.value0.depth,
        height: root3.value0.height,
        value: root3.value0.value,
        children: root3.value0.children,
        x0: 0,
        y0: 0,
        x1: config.size.width,
        y1: config.size.height
      });
      var positioned = positionTree(config)(rootWithBounds)([]);
      return positioned;
    };
  };
  var phi = /* @__PURE__ */ (function() {
    return (1 + sqrt(5)) / 2;
  })();
  var eqTreemapNode = function(dictEq) {
    var eq27 = eq(dictEq);
    return {
      eq: function(x32) {
        return function(y32) {
          return eq(eqArray(eqTreemapNode(dictEq)))(x32.value0.children)(y32.value0.children) && eq27(x32.value0.data_)(y32.value0.data_) && x32.value0.depth === y32.value0.depth && x32.value0.height === y32.value0.height && x32.value0.value === y32.value0.value && x32.value0.x0 === y32.value0.x0 && x32.value0.x1 === y32.value0.x1 && x32.value0.y0 === y32.value0.y0 && x32.value0.y1 === y32.value0.y1;
        };
      }
    };
  };
  var ordTreemapNode = function(dictOrd) {
    var compare24 = compare(dictOrd);
    var eqTreemapNode1 = eqTreemapNode(dictOrd.Eq0());
    return {
      compare: function(x32) {
        return function(y32) {
          var v2 = compare(ordArray(ordTreemapNode(dictOrd)))(x32.value0.children)(y32.value0.children);
          if (v2 instanceof LT) {
            return LT.value;
          }
          ;
          if (v2 instanceof GT) {
            return GT.value;
          }
          ;
          var v1 = compare24(x32.value0.data_)(y32.value0.data_);
          if (v1 instanceof LT) {
            return LT.value;
          }
          ;
          if (v1 instanceof GT) {
            return GT.value;
          }
          ;
          var v22 = compare19(x32.value0.depth)(y32.value0.depth);
          if (v22 instanceof LT) {
            return LT.value;
          }
          ;
          if (v22 instanceof GT) {
            return GT.value;
          }
          ;
          var v3 = compare19(x32.value0.height)(y32.value0.height);
          if (v3 instanceof LT) {
            return LT.value;
          }
          ;
          if (v3 instanceof GT) {
            return GT.value;
          }
          ;
          var v4 = compare110(x32.value0.value)(y32.value0.value);
          if (v4 instanceof LT) {
            return LT.value;
          }
          ;
          if (v4 instanceof GT) {
            return GT.value;
          }
          ;
          var v5 = compare110(x32.value0.x0)(y32.value0.x0);
          if (v5 instanceof LT) {
            return LT.value;
          }
          ;
          if (v5 instanceof GT) {
            return GT.value;
          }
          ;
          var v6 = compare110(x32.value0.x1)(y32.value0.x1);
          if (v6 instanceof LT) {
            return LT.value;
          }
          ;
          if (v6 instanceof GT) {
            return GT.value;
          }
          ;
          var v7 = compare110(x32.value0.y0)(y32.value0.y0);
          if (v7 instanceof LT) {
            return LT.value;
          }
          ;
          if (v7 instanceof GT) {
            return GT.value;
          }
          ;
          return compare110(x32.value0.y1)(y32.value0.y1);
        };
      },
      Eq0: function() {
        return eqTreemapNode1;
      }
    };
  };
  var dice2 = function(v2) {
    return function(x0) {
      return function(y0) {
        return function(x113) {
          return function(y114) {
            var k = (function() {
              var $137 = v2.value0.value !== 0;
              if ($137) {
                return (x113 - x0) / v2.value0.value;
              }
              ;
              return 0;
            })();
            var positioned = foldl15(function(acc) {
              return function(child) {
                var width47 = child.value0.value * k;
                var positionedChild = new TNode({
                  data_: child.value0.data_,
                  depth: child.value0.depth,
                  height: child.value0.height,
                  value: child.value0.value,
                  children: child.value0.children,
                  x0: acc.x,
                  x1: acc.x + width47,
                  y0,
                  y1: y114
                });
                return {
                  children: snoc3(acc.children)(positionedChild),
                  x: acc.x + width47
                };
              };
            })({
              children: [],
              x: x0
            })(v2.value0.children);
            return new TNode({
              data_: v2.value0.data_,
              depth: v2.value0.depth,
              height: v2.value0.height,
              value: v2.value0.value,
              x0: v2.value0.x0,
              y0: v2.value0.y0,
              x1: v2.value0.x1,
              y1: v2.value0.y1,
              children: positioned.children
            });
          };
        };
      };
    };
  };
  var squarifyRatio = function(ratio) {
    return function(v2) {
      return function(initX0) {
        return function(initY0) {
          return function(initX1) {
            return function(initY1) {
              var n = length3(v2.value0.children);
              var go2 = function($copy_i0) {
                return function($copy_i1) {
                  return function($copy_x0) {
                    return function($copy_y0) {
                      return function($copy_x1) {
                        return function($copy_y1) {
                          return function($copy_remainingValue) {
                            return function($copy_acc) {
                              var $tco_var_i0 = $copy_i0;
                              var $tco_var_i1 = $copy_i1;
                              var $tco_var_x0 = $copy_x0;
                              var $tco_var_y0 = $copy_y0;
                              var $tco_var_x1 = $copy_x1;
                              var $tco_var_y1 = $copy_y1;
                              var $tco_var_remainingValue = $copy_remainingValue;
                              var $tco_done = false;
                              var $tco_result;
                              function $tco_loop(i0, i1, x0, y0, x113, y114, remainingValue, acc) {
                                var $150 = i0 >= n;
                                if ($150) {
                                  $tco_done = true;
                                  return acc;
                                }
                                ;
                                var findNonEmpty = function($copy_idx) {
                                  return function($copy_sv) {
                                    var $tco_var_idx = $copy_idx;
                                    var $tco_done1 = false;
                                    var $tco_result2;
                                    function $tco_loop2(idx, sv) {
                                      var $151 = idx >= n;
                                      if ($151) {
                                        $tco_done1 = true;
                                        return {
                                          i1: idx,
                                          sumValue: sv
                                        };
                                      }
                                      ;
                                      var v12 = (function() {
                                        var v22 = index(v2.value0.children)(idx);
                                        if (v22 instanceof Just) {
                                          return v22.value0;
                                        }
                                        ;
                                        if (v22 instanceof Nothing) {
                                          return new TNode(v2.value0);
                                        }
                                        ;
                                        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Treemap (line 360, column 31 - line 362, column 42): " + [v22.constructor.name]);
                                      })();
                                      var $155 = v12.value0.value !== 0;
                                      if ($155) {
                                        $tco_done1 = true;
                                        return {
                                          i1: idx + 1 | 0,
                                          sumValue: v12.value0.value
                                        };
                                      }
                                      ;
                                      $tco_var_idx = idx + 1 | 0;
                                      $copy_sv = sv;
                                      return;
                                    }
                                    ;
                                    while (!$tco_done1) {
                                      $tco_result2 = $tco_loop2($tco_var_idx, $copy_sv);
                                    }
                                    ;
                                    return $tco_result2;
                                  };
                                };
                                var firstNode = findNonEmpty(i1)(0);
                                var dy = y114 - y0;
                                var dx = x113 - x0;
                                var alpha = max15(dy / dx)(dx / dy) / (remainingValue * ratio);
                                var beta0 = firstNode.sumValue * firstNode.sumValue * alpha;
                                var tryAdd = function($copy_idx) {
                                  return function($copy_sumVal) {
                                    return function($copy_minVal) {
                                      return function($copy_maxVal) {
                                        return function($copy_minRat) {
                                          var $tco_var_idx = $copy_idx;
                                          var $tco_var_sumVal = $copy_sumVal;
                                          var $tco_var_minVal = $copy_minVal;
                                          var $tco_var_maxVal = $copy_maxVal;
                                          var $tco_done2 = false;
                                          var $tco_result2;
                                          function $tco_loop2(idx, sumVal, minVal, maxVal, minRat) {
                                            var $157 = idx >= n;
                                            if ($157) {
                                              $tco_done2 = true;
                                              return {
                                                i1: idx,
                                                sumValue: sumVal,
                                                minRatio: minRat
                                              };
                                            }
                                            ;
                                            var v12 = (function() {
                                              var v22 = index(v2.value0.children)(idx);
                                              if (v22 instanceof Just) {
                                                return v22.value0;
                                              }
                                              ;
                                              if (v22 instanceof Nothing) {
                                                return new TNode(v2.value0);
                                              }
                                              ;
                                              throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Treemap (line 386, column 31 - line 388, column 42): " + [v22.constructor.name]);
                                            })();
                                            var newSum = sumVal + v12.value0.value;
                                            var newMin = min10(minVal)(v12.value0.value);
                                            var newMax = max15(maxVal)(v12.value0.value);
                                            var newBeta = newSum * newSum * alpha;
                                            var newRatio = max15(newMax / newBeta)(newBeta / newMin);
                                            var $161 = newRatio > minRat;
                                            if ($161) {
                                              $tco_done2 = true;
                                              return {
                                                i1: idx,
                                                sumValue: sumVal,
                                                minRatio: minRat
                                              };
                                            }
                                            ;
                                            $tco_var_idx = idx + 1 | 0;
                                            $tco_var_sumVal = newSum;
                                            $tco_var_minVal = newMin;
                                            $tco_var_maxVal = newMax;
                                            $copy_minRat = newRatio;
                                            return;
                                          }
                                          ;
                                          while (!$tco_done2) {
                                            $tco_result2 = $tco_loop2($tco_var_idx, $tco_var_sumVal, $tco_var_minVal, $tco_var_maxVal, $copy_minRat);
                                          }
                                          ;
                                          return $tco_result2;
                                        };
                                      };
                                    };
                                  };
                                };
                                var v1 = (function() {
                                  var v22 = index(v2.value0.children)(firstNode.i1 - 1 | 0);
                                  if (v22 instanceof Just) {
                                    return v22.value0;
                                  }
                                  ;
                                  if (v22 instanceof Nothing) {
                                    return new TNode(v2.value0);
                                  }
                                  ;
                                  throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Treemap (line 399, column 30 - line 401, column 36): " + [v22.constructor.name]);
                                })();
                                var isDice = dx < dy;
                                var initial = tryAdd(firstNode.i1)(firstNode.sumValue)(v1.value0.value)(v1.value0.value)(max15(v1.value0.value / beta0)(beta0 / v1.value0.value));
                                var rowChildren = slice(i0)(initial.i1)(v2.value0.children);
                                var rowNode = new TNode({
                                  data_: v2.value0.data_,
                                  depth: v2.value0.depth,
                                  height: v2.value0.height,
                                  x0: v2.value0.x0,
                                  y0: v2.value0.y0,
                                  x1: v2.value0.x1,
                                  y1: v2.value0.y1,
                                  children: rowChildren,
                                  value: initial.sumValue
                                });
                                var positioned = (function() {
                                  if (isDice) {
                                    var newY0 = (function() {
                                      var $167 = remainingValue !== 0;
                                      if ($167) {
                                        return y0 + dy * initial.sumValue / remainingValue;
                                      }
                                      ;
                                      return y114;
                                    })();
                                    var v22 = dice2(rowNode)(x0)(y0)(x113)(newY0);
                                    return {
                                      children: v22.value0.children,
                                      nextX0: x0,
                                      nextY0: newY0,
                                      nextX1: x113,
                                      nextY1: y114
                                    };
                                  }
                                  ;
                                  var newX0 = (function() {
                                    var $170 = remainingValue !== 0;
                                    if ($170) {
                                      return x0 + dx * initial.sumValue / remainingValue;
                                    }
                                    ;
                                    return x113;
                                  })();
                                  var v22 = slice4(rowNode)(x0)(y0)(newX0)(y114);
                                  return {
                                    children: v22.value0.children,
                                    nextX0: newX0,
                                    nextY0: y0,
                                    nextX1: x113,
                                    nextY1: y114
                                  };
                                })();
                                $tco_var_i0 = initial.i1;
                                $tco_var_i1 = initial.i1;
                                $tco_var_x0 = positioned.nextX0;
                                $tco_var_y0 = positioned.nextY0;
                                $tco_var_x1 = positioned.nextX1;
                                $tco_var_y1 = positioned.nextY1;
                                $tco_var_remainingValue = remainingValue - initial.sumValue;
                                $copy_acc = append112(acc)(positioned.children);
                                return;
                              }
                              ;
                              while (!$tco_done) {
                                $tco_result = $tco_loop($tco_var_i0, $tco_var_i1, $tco_var_x0, $tco_var_y0, $tco_var_x1, $tco_var_y1, $tco_var_remainingValue, $copy_acc);
                              }
                              ;
                              return $tco_result;
                            };
                          };
                        };
                      };
                    };
                  };
                };
              };
              return {
                children: go2(0)(0)(initX0)(initY0)(initX1)(initY1)(v2.value0.value)([]),
                x0: initX0,
                y0: initY0
              };
            };
          };
        };
      };
    };
  };
  var squarify = function(ratio) {
    return function(v2) {
      return function(x0) {
        return function(y0) {
          return function(x113) {
            return function(y114) {
              var result = squarifyRatio(ratio)(new TNode(v2.value0))(x0)(y0)(x113)(y114);
              return new TNode({
                data_: v2.value0.data_,
                depth: v2.value0.depth,
                height: v2.value0.height,
                value: v2.value0.value,
                x0: v2.value0.x0,
                y0: v2.value0.y0,
                x1: v2.value0.x1,
                y1: v2.value0.y1,
                children: result.children
              });
            };
          };
        };
      };
    };
  };
  var defaultTreemapConfig = {
    size: {
      width: 1,
      height: 1
    },
    tile: /* @__PURE__ */ squarify(phi),
    round: false,
    paddingInner: 0,
    paddingOuter: 0,
    paddingTop: 0,
    paddingRight: 0,
    paddingBottom: 0,
    paddingLeft: 0
  };

  // output/D3.Viz.TreeAPI.TreemapViz/index.js
  var map62 = /* @__PURE__ */ map(functorArray);
  var bind44 = /* @__PURE__ */ bind(bindArray);
  var mod10 = /* @__PURE__ */ mod(euclideanRingInt);
  var bind123 = /* @__PURE__ */ bind(bindD3v2M);
  var select25 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var discard28 = /* @__PURE__ */ discard(discardUnit)(bindD3v2M);
  var liftEffect31 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var show42 = /* @__PURE__ */ show(showInt);
  var width27 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var num20 = /* @__PURE__ */ num(numExprEvalD);
  var height27 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr25 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text25 = /* @__PURE__ */ text6(stringExprEvalD);
  var x16 = /* @__PURE__ */ x(toAttributeValueNumber);
  var y17 = /* @__PURE__ */ y(toAttributeValueNumber);
  var fill20 = /* @__PURE__ */ fill(toAttributeValueString);
  var attr112 = /* @__PURE__ */ attr3(toAttributeValueNumber);
  var stroke16 = /* @__PURE__ */ stroke(toAttributeValueString);
  var strokeWidth15 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var textContent10 = /* @__PURE__ */ textContent2(toAttributeValueString);
  var textAnchor10 = /* @__PURE__ */ textAnchor(toAttributeValueString);
  var fontSize11 = /* @__PURE__ */ fontSize(toAttributeValueNumber);
  var renderTree44 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(/* @__PURE__ */ ordTreemapNode(ordString));
  var bind215 = /* @__PURE__ */ bind(bindAff);
  var liftEffect116 = /* @__PURE__ */ liftEffect(monadEffectAff);
  var mapValuedNode = function(f) {
    return function(v2) {
      return new VNode({
        data_: f(v2.value0.data_),
        depth: v2.value0.depth,
        height: v2.value0.height,
        parent: Nothing.value,
        children: map62(mapValuedNode(f))(v2.value0.children),
        value: v2.value0.value
      });
    };
  };
  var getLeaves = function(v2) {
    var $44 = length3(v2.value0.children) === 0;
    if ($44) {
      return [v2];
    }
    ;
    return bind44(v2.value0.children)(getLeaves);
  };
  var colors4 = ["#e7ba52", "#c7c7c7", "#aec7e8", "#1f77b4", "#9467bd"];
  var getColor4 = function(depth) {
    var v2 = index(colors4)(mod10(depth)(length3(colors4)));
    if (v2 instanceof Just) {
      return v2.value0;
    }
    ;
    if (v2 instanceof Nothing) {
      return "#cccccc";
    }
    ;
    throw new Error("Failed pattern match at D3.Viz.TreeAPI.TreemapViz (line 28, column 18 - line 30, column 23): " + [v2.constructor.name]);
  };
  var drawTreemap = function(selector) {
    return function(flareData) {
      return runD3v2M(bind123(select25(selector))(function(container) {
        var h7 = hierarchy3(flareData)(getChildren2);
        var valued = sum4(h7)(getValue2);
        var stringValued = mapValuedNode(getName2)(valued);
        var config = {
          paddingBottom: defaultTreemapConfig.paddingBottom,
          paddingInner: defaultTreemapConfig.paddingInner,
          paddingLeft: defaultTreemapConfig.paddingLeft,
          paddingOuter: defaultTreemapConfig.paddingOuter,
          paddingRight: defaultTreemapConfig.paddingRight,
          paddingTop: defaultTreemapConfig.paddingTop,
          round: defaultTreemapConfig.round,
          size: {
            width: 750,
            height: 500
          },
          tile: squarify(phi)
        };
        var layout2 = treemap(config)(stringValued);
        var leaves2 = getLeaves(layout2);
        return discard28(liftEffect31(log2("Rendering treemap: " + (show42(length3(leaves2)) + " rectangles"))))(function() {
          var tree2 = withChild(named(SVG.value)("svg")([width27(num20(750)), height27(num20(500)), viewBox(0)(0)(750)(500), attr25("class")(text25("treemap-viz"))]))(joinData("rects")("g")(leaves2)(function(v2) {
            return withChildren(named(Group.value)("rect-" + v2.value0.data_)([attr25("class")(text25("node"))]))([elem3(Rect.value)([x16(num20(v2.value0.x0)), y17(num20(v2.value0.y0)), width27(num20(v2.value0.x1 - v2.value0.x0)), height27(num20(v2.value0.y1 - v2.value0.y0)), fill20(text25(getColor4(v2.value0.depth))), attr112("fill-opacity")(num20(0.6)), stroke16(text25("#fff")), strokeWidth15(num20(1))]), elem3(Text.value)([x16(num20((v2.value0.x0 + v2.value0.x1) / 2)), y17(num20((v2.value0.y0 + v2.value0.y1) / 2)), textContent10(text25(v2.value0.data_)), textAnchor10(text25("middle")), fontSize11(num20(9)), attr112("fill-opacity")(num20((function() {
              var $49 = v2.value0.x1 - v2.value0.x0 > 30 && v2.value0.y1 - v2.value0.y0 > 15;
              if ($49) {
                return 1;
              }
              ;
              return 0;
            })()))])]);
          }));
          return bind123(renderTree44(container)(tree2))(function() {
            return liftEffect31(log2("=== Treemap Layout (Tree API) ==="));
          });
        });
      }));
    };
  };
  var treemapViz = function(selector) {
    return launchAff_(bind215(loadDataFile(FlareJSON.value))(function(result) {
      if (result instanceof Left) {
        return liftEffect116(log2("Failed to load Flare data: " + result.value0));
      }
      ;
      if (result instanceof Right) {
        return liftEffect116(drawTreemap(selector)(parseFlareJson(result.value0)));
      }
      ;
      throw new Error("Failed pattern match at D3.Viz.TreeAPI.TreemapViz (line 121, column 3 - line 123, column 86): " + [result.constructor.name]);
    }));
  };

  // output/PSD3.Expr.Interpreter.CodeGen/index.js
  var show43 = /* @__PURE__ */ show(showNumber);
  var runCodeGen = function(v2) {
    return v2;
  };
  var numExprCodeGen = {
    lit: function(n) {
      return show43(n);
    },
    add: function(v2) {
      return function(v1) {
        return "(" + (v2 + (" + " + (v1 + ")")));
      };
    },
    sub: function(v2) {
      return function(v1) {
        return "(" + (v2 + (" - " + (v1 + ")")));
      };
    },
    mul: function(v2) {
      return function(v1) {
        return "(" + (v2 + (" * " + (v1 + ")")));
      };
    },
    div: function(v2) {
      return function(v1) {
        return "(" + (v2 + (" / " + (v1 + ")")));
      };
    },
    negate: function(v2) {
      return "(-" + (v2 + ")");
    }
  };
  var datumExprCodeGen = {
    field: function(dictIsSymbol) {
      var reflectSymbol2 = reflectSymbol(dictIsSymbol);
      return function() {
        return function(proxy) {
          return "d." + reflectSymbol2(proxy);
        };
      };
    },
    index: "i"
  };

  // output/D3.Viz.TreeAPI.V3GUPDemo/index.js
  var indexIsSymbol = {
    reflectSymbol: function() {
      return "index";
    }
  };
  var x17 = /* @__PURE__ */ x(toAttributeValueNumber);
  var num21 = /* @__PURE__ */ num(numExprEvalD);
  var y18 = /* @__PURE__ */ y(toAttributeValueNumber);
  var fontSize12 = /* @__PURE__ */ fontSize(toAttributeValueNumber);
  var textAnchor11 = /* @__PURE__ */ textAnchor(toAttributeValueString);
  var text26 = /* @__PURE__ */ text6(stringExprEvalD);
  var dominantBaseline2 = /* @__PURE__ */ dominantBaseline(toAttributeValueString);
  var fill21 = /* @__PURE__ */ fill(toAttributeValueString);
  var opacity6 = /* @__PURE__ */ opacity(toAttributeValueNumber);
  var textContent11 = /* @__PURE__ */ textContent2(toAttributeValueString);
  var from6 = /* @__PURE__ */ from3(showNumber);
  var discard29 = /* @__PURE__ */ discard(discardUnit);
  var bind45 = /* @__PURE__ */ bind(bindD3v2M);
  var select26 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var width28 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var height28 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr26 = /* @__PURE__ */ attr3(toAttributeValueString);
  var renderTree45 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D);
  var renderTree113 = /* @__PURE__ */ renderTree45(ordUnit);
  var pure28 = /* @__PURE__ */ pure(applicativeD3v2M);
  var renderTree213 = /* @__PURE__ */ renderTree45(/* @__PURE__ */ ordRecord()(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(ordRecordNil)()({
    reflectSymbol: function() {
      return "letter";
    }
  })(ordString))()(indexIsSymbol)(ordNumber)));
  var discard210 = /* @__PURE__ */ discard29(bindD3v2M);
  var liftEffect32 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var show44 = /* @__PURE__ */ show(showInt);
  var letterY = 100;
  var letterX = function(dictNumExpr) {
    var addLit2 = addLit(dictNumExpr);
    var mulLit2 = mulLit(dictNumExpr);
    return function(dictDatumExpr) {
      var indexField = field(dictDatumExpr)(indexIsSymbol)()($$Proxy.value);
      return addLit2(mulLit2(indexField)(40))(50);
    };
  };
  var letterX1 = /* @__PURE__ */ letterX(numExprEvalD)(datumExprEvalD);
  var letterX2 = /* @__PURE__ */ letterX(numExprCodeGen)(datumExprCodeGen);
  var filterAlphaNum = function(s3) {
    var isAlphaNum = function(c2) {
      return c2 >= "a" && c2 <= "z" || (c2 >= "A" && c2 <= "Z" || c2 >= "0" && c2 <= "9");
    };
    return fromCharArray(filter(isAlphaNum)(toCharArray(s3)));
  };
  var evalExpr = function(expr) {
    return function(datum2) {
      return runEvalD(expr)(datum2)(0);
    };
  };
  var createLettersTree = function(letters) {
    return sceneJoin("letters")("text")(letters)(function(d) {
      return elem3(Text.value)([x17(num21(evalExpr(letterX1)(d))), y18(num21(letterY)), fontSize12(num21(32)), textAnchor11(text26("middle")), dominantBaseline2(text26("middle")), fill21(text26("#2c3e50")), opacity6(num21(1)), textContent11(text26(d.letter))]);
    })({
      keyFn: new Just(function(v2) {
        return v2.letter;
      }),
      enterBehavior: new Just({
        initialAttrs: [y18(num21(20)), opacity6(num21(0)), fill21(text26("#27ae60"))],
        transition: new Just(transitionWith({
          duration: 750,
          delay: Nothing.value,
          staggerDelay: new Just(50),
          easing: new Just(BounceOut.value)
        }))
      }),
      updateBehavior: new Just({
        attrs: [from6("x")(function(d$prime) {
          return evalExpr(letterX1)(d$prime);
        }), y18(num21(letterY)), fill21(text26("#2c3e50")), opacity6(num21(1))],
        transition: new Just(transitionWith({
          duration: 500,
          delay: Nothing.value,
          staggerDelay: new Just(30),
          easing: new Just(CubicInOut.value)
        }))
      }),
      exitBehavior: new Just({
        attrs: [y18(num21(180)), opacity6(num21(0)), fill21(text26("#e74c3c"))],
        transition: new Just(transitionWith({
          duration: 500,
          delay: Nothing.value,
          staggerDelay: new Just(40),
          easing: new Just(CubicIn.value)
        }))
      })
    });
  };
  var initV3GUP = function(containerSelector) {
    var svgId = "v3-gup-svg-" + filterAlphaNum(containerSelector);
    var svgSelector = "#" + svgId;
    return function __do7() {
      runD3v2M(bind45(select26(containerSelector))(function(container) {
        var svgTree = withChild(named(SVG.value)("svg")([width28(num21(800)), height28(num21(500)), viewBox(0)(-50)(800)(500), attr26("id")(text26(svgId)), attr26("class")(text26("v3-gup-demo d3svg gup"))]))(elem3(Group.value)([]));
        return bind45(renderTree113(container)(svgTree))(function() {
          return pure28(unit);
        });
      }))();
      return function(letters) {
        return runD3v2M(bind45(select26(svgSelector))(function(svg2) {
          var letterData = mapWithIndex3(function(i2) {
            return function(c2) {
              return {
                letter: singleton8(c2),
                index: toNumber(i2)
              };
            };
          })(letters);
          var tree2 = createLettersTree(letterData);
          return bind45(renderTree213(svg2)(tree2))(function() {
            return pure28(unit);
          });
        }));
      };
    };
  };
  var updateWithLetters = function(letterString) {
    return runD3v2M(bind45(select26("#v3-gup-svg"))(function(svg2) {
      var letters = mapWithIndex3(function(i2) {
        return function(c2) {
          return {
            letter: singleton8(c2),
            index: toNumber(i2)
          };
        };
      })(toCharArray(letterString));
      return discard210(liftEffect32(log2("Updating to: " + (letterString + (" (" + (show44(length3(letters)) + " letters)"))))))(function() {
        var tree2 = createLettersTree(letters);
        return bind45(renderTree213(svg2)(tree2))(function() {
          return liftEffect32(function __do7() {
            log2("GUP cycle complete!")();
            log2("  - New letters entered (green, bounced in from above)")();
            log2("  - Existing letters updated (slid to new positions)")();
            return log2("  - Removed letters exited (red, faded and dropped)")();
          });
        });
      });
    }));
  };
  var v3GUPDemo = function __do2() {
    log2("=== Expression DSL General Update Pattern Demo ===")();
    log2("")();
    log2("v3 Expression for X position:")();
    log2("  letterX = " + runCodeGen(letterX2))();
    log2("")();
    log2("Starting with: A B C D E F G")();
    log2("")();
    runD3v2M(bind45(select26("#viz"))(function(container) {
      var svgTree = withChild(named(SVG.value)("svg")([width28(num21(600)), height28(num21(200)), viewBox(0)(0)(600)(200), attr26("id")(text26("v3-gup-svg")), attr26("class")(text26("v3-gup-demo"))]))(elem3(Group.value)([]));
      return bind45(renderTree113(container)(svgTree))(function() {
        return pure28(unit);
      });
    }))();
    return updateWithLetters("ABCDEFG")();
  };

  // output/D3.Viz.TreeAPI.V3ParabolaDemo/index.js
  var yIsSymbol = {
    reflectSymbol: function() {
      return "y";
    }
  };
  var xIsSymbol = {
    reflectSymbol: function() {
      return "x";
    }
  };
  var bind46 = /* @__PURE__ */ bind(bindD3v2M);
  var v3Attr7 = /* @__PURE__ */ v3Attr(showNumber);
  var lit7 = /* @__PURE__ */ lit(numExprEvalD);
  var str8 = /* @__PURE__ */ str(stringExprEvalD);
  var renderTree46 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(/* @__PURE__ */ ordRecord()(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(ordRecordNil)()(yIsSymbol)(ordNumber))()(xIsSymbol)(ordNumber)));
  var liftEffect33 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var show45 = /* @__PURE__ */ show(showNumber);
  var lookup23 = /* @__PURE__ */ lookup(ordString);
  var scaleY = function(dictNumExpr) {
    var add8 = add4(dictNumExpr);
    var lit1 = lit(dictNumExpr);
    var mulLit2 = mulLit(dictNumExpr);
    return function(dictDatumExpr) {
      var yField = field(dictDatumExpr)(yIsSymbol)()($$Proxy.value);
      return add8(lit1(200))(mulLit2(yField)(-1.8));
    };
  };
  var scaleY1 = /* @__PURE__ */ scaleY(numExprEvalD)(datumExprEvalD);
  var scaleY2 = /* @__PURE__ */ scaleY(numExprCodeGen)(datumExprCodeGen);
  var scaleX = function(dictNumExpr) {
    var addLit2 = addLit(dictNumExpr);
    var mulLit2 = mulLit(dictNumExpr);
    return function(dictDatumExpr) {
      var xField = field(dictDatumExpr)(xIsSymbol)()($$Proxy.value);
      return addLit2(mulLit2(addLit2(xField)(5))(30))(50);
    };
  };
  var scaleX1 = /* @__PURE__ */ scaleX(numExprEvalD)(datumExprEvalD);
  var scaleX2 = /* @__PURE__ */ scaleX(numExprCodeGen)(datumExprCodeGen);
  var pointRadius = function(dictNumExpr) {
    var add8 = add4(dictNumExpr);
    var lit1 = lit(dictNumExpr);
    var mulLit2 = mulLit(dictNumExpr);
    return function(dictDatumExpr) {
      var yField = field(dictDatumExpr)(yIsSymbol)()($$Proxy.value);
      return add8(lit1(6))(mulLit2(yField)(-0.05));
    };
  };
  var pointRadius1 = /* @__PURE__ */ pointRadius(numExprEvalD)(datumExprEvalD);
  var parabolaData = /* @__PURE__ */ (function() {
    return [{
      x: -10,
      y: 100
    }, {
      x: -7.5,
      y: 56.25
    }, {
      x: -5,
      y: 25
    }, {
      x: -2.5,
      y: 6.25
    }, {
      x: 0,
      y: 0
    }, {
      x: 2.5,
      y: 6.25
    }, {
      x: 5,
      y: 25
    }, {
      x: 7.5,
      y: 56.25
    }, {
      x: 10,
      y: 100
    }];
  })();
  var evalExpr2 = function(expr) {
    return function(datum2) {
      return runEvalD(expr)(datum2)(0);
    };
  };
  var v3ParabolaDemo = /* @__PURE__ */ runD3v2M(/* @__PURE__ */ bind46(/* @__PURE__ */ select(selectionMD3v2Selection_D)("#viz"))(function(container) {
    var tree2 = withChild(named(SVG.value)("svg")([v3Attr7("width")(lit7(400)), v3Attr7("height")(lit7(250)), v3AttrStr("viewBox")(str8("0 0 400 250")), v3AttrStr("id")(str8("v3-parabola-svg")), v3AttrStr("class")(str8("v3-demo"))]))(joinData("points")("circle")(parabolaData)(function(d) {
      return elem3(Circle.value)([v3Attr7("cx")(lit7(evalExpr2(scaleX1)(d))), v3Attr7("cy")(lit7(evalExpr2(scaleY1)(d))), v3Attr7("r")(lit7(evalExpr2(pointRadius1)(d))), v3AttrStr("fill")(str8("#3498db")), v3AttrStr("stroke")(str8("white")), v3Attr7("stroke-width")(lit7(2))]);
    }));
    return bind46(renderTree46(container)(tree2))(function(selections) {
      return liftEffect33(function __do7() {
        log2("=== Expression DSL Parabola Demo: Live D3 Rendering ===")();
        log2("")();
        log2("v3 Expressions (polymorphic definitions):")();
        log2("  scaleX = (x + 5) * 30 + 50")();
        log2("  scaleY = 200 + (y * -1.8)")();
        log2("")();
        log2("CodeGen output (PureScript source):")();
        log2("  scaleX \u2192 " + runCodeGen(scaleX2))();
        log2("  scaleY \u2192 " + runCodeGen(scaleY2))();
        log2("")();
        log2("EvalD output (D3 runtime values for sample point):")();
        var pt3 = {
          x: -10,
          y: 100
        };
        var cxVal = runEvalD(scaleX1)(pt3)(0);
        var cyVal = runEvalD(scaleY1)(pt3)(0);
        log2("  { x: " + (show45(pt3.x) + (", y: " + (show45(pt3.y) + (" } \u2192 cx=" + (show45(cxVal) + (", cy=" + show45(cyVal))))))))();
        log2("")();
        log2("Same expression, three outputs:")();
        log2("  \u2022 CodeGen: produces PureScript source code")();
        log2("  \u2022 EvalD: produces runtime Number values for D3")();
        log2("  \u2022 SVGD: produces SVG attribute strings (server-side)")();
        log2("")();
        var v2 = lookup23("points")(selections);
        if (v2 instanceof Just) {
          return log2("\u2713 Points rendered to DOM via D3 (check browser!)")();
        }
        ;
        if (v2 instanceof Nothing) {
          return log2("\u2717 No points selection found")();
        }
        ;
        throw new Error("Failed pattern match at D3.Viz.TreeAPI.V3ParabolaDemo (line 153, column 5 - line 155, column 59): " + [v2.constructor.name]);
      });
    });
  }));

  // output/D3.Viz.TreeAPI.V3TransitionDemo/index.js
  var yIsSymbol2 = {
    reflectSymbol: function() {
      return "y";
    }
  };
  var xIsSymbol2 = {
    reflectSymbol: function() {
      return "x";
    }
  };
  var valueIsSymbol = {
    reflectSymbol: function() {
      return "value";
    }
  };
  var bind47 = /* @__PURE__ */ bind(bindD3v2M);
  var v3Attr8 = /* @__PURE__ */ v3Attr(showNumber);
  var lit8 = /* @__PURE__ */ lit(numExprEvalD);
  var str9 = /* @__PURE__ */ str(stringExprEvalD);
  var discard30 = /* @__PURE__ */ discard(discardUnit);
  var discard114 = /* @__PURE__ */ discard30(bindD3v2M);
  var liftEffect34 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var renderTree47 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(/* @__PURE__ */ ordRecord()(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(ordRecordNil)()(yIsSymbol2)(ordNumber))()(xIsSymbol2)(ordNumber))()(valueIsSymbol)(ordNumber))()({
    reflectSymbol: function() {
      return "id";
    }
  })(ordInt)));
  var posY = function(dictNumExpr) {
    return function(dictDatumExpr) {
      return field(dictDatumExpr)(yIsSymbol2)()($$Proxy.value);
    };
  };
  var posY1 = /* @__PURE__ */ posY(numExprEvalD)(datumExprEvalD);
  var posY2 = /* @__PURE__ */ posY(numExprCodeGen)(datumExprCodeGen);
  var posX = function(dictNumExpr) {
    return function(dictDatumExpr) {
      return field(dictDatumExpr)(xIsSymbol2)()($$Proxy.value);
    };
  };
  var posX1 = /* @__PURE__ */ posX(numExprEvalD)(datumExprEvalD);
  var posX2 = /* @__PURE__ */ posX(numExprCodeGen)(datumExprCodeGen);
  var evalExpr3 = function(expr) {
    return function(datum2) {
      return runEvalD(expr)(datum2)(0);
    };
  };
  var circleRadius = function(dictNumExpr) {
    var addLit2 = addLit(dictNumExpr);
    var mulLit2 = mulLit(dictNumExpr);
    return function(dictDatumExpr) {
      var valueField = field(dictDatumExpr)(valueIsSymbol)()($$Proxy.value);
      return addLit2(mulLit2(valueField)(0.2))(8);
    };
  };
  var circleRadius1 = /* @__PURE__ */ circleRadius(numExprEvalD)(datumExprEvalD);
  var circleRadius2 = /* @__PURE__ */ circleRadius(numExprCodeGen)(datumExprCodeGen);
  var circleData2 = [{
    id: 1,
    x: 80,
    y: 80,
    value: 30
  }, {
    id: 2,
    x: 160,
    y: 220,
    value: 60
  }, {
    id: 3,
    x: 250,
    y: 60,
    value: 90
  }, {
    id: 4,
    x: 340,
    y: 200,
    value: 45
  }, {
    id: 5,
    x: 420,
    y: 100,
    value: 75
  }];
  var v3TransitionDemo = /* @__PURE__ */ runD3v2M(/* @__PURE__ */ bind47(/* @__PURE__ */ select(selectionMD3v2Selection_D)("#viz"))(function(container) {
    var tree2 = withChild(named(SVG.value)("svg")([v3Attr8("width")(lit8(500)), v3Attr8("height")(lit8(300)), v3AttrStr("viewBox")(str9("0 0 500 300")), v3AttrStr("id")(str9("v3-transition-svg")), v3AttrStr("class")(str9("v3-demo"))]))(sceneJoin("circles")("circle")(circleData2)(function(d) {
      return elem3(Circle.value)([v3Attr8("cx")(lit8(evalExpr3(posX1)(d))), v3Attr8("cy")(lit8(evalExpr3(posY1)(d))), v3Attr8("r")(lit8(evalExpr3(circleRadius1)(d))), v3AttrStr("fill")(str9("#e67e22")), v3AttrStr("stroke")(str9("white")), v3Attr8("stroke-width")(lit8(2))]);
    })({
      keyFn: Nothing.value,
      enterBehavior: new Just({
        initialAttrs: [v3Attr8("cx")(lit8(250)), v3Attr8("cy")(lit8(150)), v3AttrStr("fill")(str9("#3498db"))],
        transition: new Just(staggeredTransition(600)(100))
      }),
      updateBehavior: Nothing.value,
      exitBehavior: Nothing.value
    }));
    return discard114(liftEffect34(function __do7() {
      log2("=== Expression Declarative Staggered Transition Demo ===")();
      log2("")();
      log2("v3 Expressions (final positions):")();
      log2("  posX         \u2192 " + runCodeGen(posX2))();
      log2("  posY         \u2192 " + runCodeGen(posY2))();
      log2("  circleRadius \u2192 " + runCodeGen(circleRadius2))();
      log2("")();
      log2("Approach: Fully declarative with sceneJoin + staggeredTransition")();
      log2("  \u2022 Template defines final state (v3 expressions)")();
      log2("  \u2022 enterBehavior defines initial state + staggered transition")();
      log2("  \u2022 staggeredTransition: 600ms duration, 100ms stagger per element")();
      log2("  \u2022 No Map lookup, no unsafeCoerce - type flows through tree")();
      return log2("")();
    }))(function() {
      return bind47(renderTree47(container)(tree2))(function() {
        return liftEffect34(function __do7() {
          log2("Staggered transition triggered by renderTree!")();
          log2("")();
          log2("Key insights:")();
          log2("  1. Transitions belong IN the tree structure")();
          log2("  2. staggerDelay in TransitionConfig handles per-element delays")();
          return log2("  3. The datum type chain stays intact from definition to render")();
        });
      });
    });
  }));

  // output/Effect.Random/foreign.js
  var random = Math.random;

  // output/Effect.Random/index.js
  var randomInt = function(low2) {
    return function(high2) {
      return function __do7() {
        var n = random();
        var asNumber = (toNumber(high2) - toNumber(low2) + 1) * n + toNumber(low2);
        return floor2(asNumber);
      };
    };
  };

  // output/PSD3.PrismJS/foreign.js
  function highlightAll() {
    if (window.Prism) {
      window.Prism.highlightAll();
    }
  }

  // output/PSD3.Website.Types/index.js
  var Home = /* @__PURE__ */ (function() {
    function Home2() {
    }
    ;
    Home2.value = new Home2();
    return Home2;
  })();
  var GettingStarted = /* @__PURE__ */ (function() {
    function GettingStarted2() {
    }
    ;
    GettingStarted2.value = new GettingStarted2();
    return GettingStarted2;
  })();
  var Wizard = /* @__PURE__ */ (function() {
    function Wizard2() {
    }
    ;
    Wizard2.value = new Wizard2();
    return Wizard2;
  })();
  var HowtoIndex = /* @__PURE__ */ (function() {
    function HowtoIndex2() {
    }
    ;
    HowtoIndex2.value = new HowtoIndex2();
    return HowtoIndex2;
  })();
  var HowtoTransitions = /* @__PURE__ */ (function() {
    function HowtoTransitions2() {
    }
    ;
    HowtoTransitions2.value = new HowtoTransitions2();
    return HowtoTransitions2;
  })();
  var HowtoForceGraphs = /* @__PURE__ */ (function() {
    function HowtoForceGraphs2() {
    }
    ;
    HowtoForceGraphs2.value = new HowtoForceGraphs2();
    return HowtoForceGraphs2;
  })();
  var HowtoHierarchical = /* @__PURE__ */ (function() {
    function HowtoHierarchical2() {
    }
    ;
    HowtoHierarchical2.value = new HowtoHierarchical2();
    return HowtoHierarchical2;
  })();
  var HowtoEvents = /* @__PURE__ */ (function() {
    function HowtoEvents2() {
    }
    ;
    HowtoEvents2.value = new HowtoEvents2();
    return HowtoEvents2;
  })();
  var HowtoTreeAPI = /* @__PURE__ */ (function() {
    function HowtoTreeAPI2() {
    }
    ;
    HowtoTreeAPI2.value = new HowtoTreeAPI2();
    return HowtoTreeAPI2;
  })();
  var HowtoLoadingData = /* @__PURE__ */ (function() {
    function HowtoLoadingData2() {
    }
    ;
    HowtoLoadingData2.value = new HowtoLoadingData2();
    return HowtoLoadingData2;
  })();
  var HowtoAxesScales = /* @__PURE__ */ (function() {
    function HowtoAxesScales2() {
    }
    ;
    HowtoAxesScales2.value = new HowtoAxesScales2();
    return HowtoAxesScales2;
  })();
  var HowtoTooltips = /* @__PURE__ */ (function() {
    function HowtoTooltips2() {
    }
    ;
    HowtoTooltips2.value = new HowtoTooltips2();
    return HowtoTooltips2;
  })();
  var HowtoDebugging = /* @__PURE__ */ (function() {
    function HowtoDebugging2() {
    }
    ;
    HowtoDebugging2.value = new HowtoDebugging2();
    return HowtoDebugging2;
  })();
  var HowtoPerformance = /* @__PURE__ */ (function() {
    function HowtoPerformance2() {
    }
    ;
    HowtoPerformance2.value = new HowtoPerformance2();
    return HowtoPerformance2;
  })();
  var HowtoTreeExplorer = /* @__PURE__ */ (function() {
    function HowtoTreeExplorer2() {
    }
    ;
    HowtoTreeExplorer2.value = new HowtoTreeExplorer2();
    return HowtoTreeExplorer2;
  })();
  var Understanding = /* @__PURE__ */ (function() {
    function Understanding2() {
    }
    ;
    Understanding2.value = new Understanding2();
    return Understanding2;
  })();
  var UnderstandingGrammar = /* @__PURE__ */ (function() {
    function UnderstandingGrammar2() {
    }
    ;
    UnderstandingGrammar2.value = new UnderstandingGrammar2();
    return UnderstandingGrammar2;
  })();
  var UnderstandingAttributes = /* @__PURE__ */ (function() {
    function UnderstandingAttributes2() {
    }
    ;
    UnderstandingAttributes2.value = new UnderstandingAttributes2();
    return UnderstandingAttributes2;
  })();
  var UnderstandingSelections = /* @__PURE__ */ (function() {
    function UnderstandingSelections2() {
    }
    ;
    UnderstandingSelections2.value = new UnderstandingSelections2();
    return UnderstandingSelections2;
  })();
  var UnderstandingTreeAPI = /* @__PURE__ */ (function() {
    function UnderstandingTreeAPI2() {
    }
    ;
    UnderstandingTreeAPI2.value = new UnderstandingTreeAPI2();
    return UnderstandingTreeAPI2;
  })();
  var UnderstandingScenes = /* @__PURE__ */ (function() {
    function UnderstandingScenes2() {
    }
    ;
    UnderstandingScenes2.value = new UnderstandingScenes2();
    return UnderstandingScenes2;
  })();
  var Reference = /* @__PURE__ */ (function() {
    function Reference2() {
    }
    ;
    Reference2.value = new Reference2();
    return Reference2;
  })();
  var ReferenceModule = /* @__PURE__ */ (function() {
    function ReferenceModule2(value0) {
      this.value0 = value0;
    }
    ;
    ReferenceModule2.create = function(value0) {
      return new ReferenceModule2(value0);
    };
    return ReferenceModule2;
  })();
  var TourIndex = /* @__PURE__ */ (function() {
    function TourIndex2() {
    }
    ;
    TourIndex2.value = new TourIndex2();
    return TourIndex2;
  })();
  var TourFoundations = /* @__PURE__ */ (function() {
    function TourFoundations2() {
    }
    ;
    TourFoundations2.value = new TourFoundations2();
    return TourFoundations2;
  })();
  var TourProfessional = /* @__PURE__ */ (function() {
    function TourProfessional2() {
    }
    ;
    TourProfessional2.value = new TourProfessional2();
    return TourProfessional2;
  })();
  var TourFlow = /* @__PURE__ */ (function() {
    function TourFlow2() {
    }
    ;
    TourFlow2.value = new TourFlow2();
    return TourFlow2;
  })();
  var TourHierarchies = /* @__PURE__ */ (function() {
    function TourHierarchies2() {
    }
    ;
    TourHierarchies2.value = new TourHierarchies2();
    return TourHierarchies2;
  })();
  var TourMotion = /* @__PURE__ */ (function() {
    function TourMotion2() {
    }
    ;
    TourMotion2.value = new TourMotion2();
    return TourMotion2;
  })();
  var TourWealthHealth = /* @__PURE__ */ (function() {
    function TourWealthHealth2() {
    }
    ;
    TourWealthHealth2.value = new TourWealthHealth2();
    return TourWealthHealth2;
  })();
  var TourInterpreters = /* @__PURE__ */ (function() {
    function TourInterpreters2() {
    }
    ;
    TourInterpreters2.value = new TourInterpreters2();
    return TourInterpreters2;
  })();
  var TourFPFTW = /* @__PURE__ */ (function() {
    function TourFPFTW2() {
    }
    ;
    TourFPFTW2.value = new TourFPFTW2();
    return TourFPFTW2;
  })();
  var TourGraphAlgorithms = /* @__PURE__ */ (function() {
    function TourGraphAlgorithms2() {
    }
    ;
    TourGraphAlgorithms2.value = new TourGraphAlgorithms2();
    return TourGraphAlgorithms2;
  })();
  var TourLesMisGUP = /* @__PURE__ */ (function() {
    function TourLesMisGUP2() {
    }
    ;
    TourLesMisGUP2.value = new TourLesMisGUP2();
    return TourLesMisGUP2;
  })();
  var TourSimpsons = /* @__PURE__ */ (function() {
    function TourSimpsons2() {
    }
    ;
    TourSimpsons2.value = new TourSimpsons2();
    return TourSimpsons2;
  })();
  var Showcase = /* @__PURE__ */ (function() {
    function Showcase2() {
    }
    ;
    Showcase2.value = new Showcase2();
    return Showcase2;
  })();
  var Examples = /* @__PURE__ */ (function() {
    function Examples2() {
    }
    ;
    Examples2.value = new Examples2();
    return Examples2;
  })();
  var Example = /* @__PURE__ */ (function() {
    function Example2(value0) {
      this.value0 = value0;
    }
    ;
    Example2.create = function(value0) {
      return new Example2(value0);
    };
    return Example2;
  })();
  var TreeAPI = /* @__PURE__ */ (function() {
    function TreeAPI2() {
    }
    ;
    TreeAPI2.value = new TreeAPI2();
    return TreeAPI2;
  })();
  var AnimatedTreeCluster = /* @__PURE__ */ (function() {
    function AnimatedTreeCluster2() {
    }
    ;
    AnimatedTreeCluster2.value = new AnimatedTreeCluster2();
    return AnimatedTreeCluster2;
  })();
  var GeneralUpdatePattern = /* @__PURE__ */ (function() {
    function GeneralUpdatePattern2() {
    }
    ;
    GeneralUpdatePattern2.value = new GeneralUpdatePattern2();
    return GeneralUpdatePattern2;
  })();
  var LesMisGUPTree = /* @__PURE__ */ (function() {
    function LesMisGUPTree2() {
    }
    ;
    LesMisGUPTree2.value = new LesMisGUPTree2();
    return LesMisGUPTree2;
  })();
  var LesMisGUP = /* @__PURE__ */ (function() {
    function LesMisGUP2() {
    }
    ;
    LesMisGUP2.value = new LesMisGUP2();
    return LesMisGUP2;
  })();
  var LesMisGUPSimple = /* @__PURE__ */ (function() {
    function LesMisGUPSimple2() {
    }
    ;
    LesMisGUPSimple2.value = new LesMisGUPSimple2();
    return LesMisGUPSimple2;
  })();
  var LesMisGUPTreeAPI = /* @__PURE__ */ (function() {
    function LesMisGUPTreeAPI2() {
    }
    ;
    LesMisGUPTreeAPI2.value = new LesMisGUPTreeAPI2();
    return LesMisGUPTreeAPI2;
  })();
  var LesMisGUPClean = /* @__PURE__ */ (function() {
    function LesMisGUPClean2() {
    }
    ;
    LesMisGUPClean2.value = new LesMisGUPClean2();
    return LesMisGUPClean2;
  })();
  var LesMisQueryDemo = /* @__PURE__ */ (function() {
    function LesMisQueryDemo2() {
    }
    ;
    LesMisQueryDemo2.value = new LesMisQueryDemo2();
    return LesMisQueryDemo2;
  })();
  var ModuleGraph = /* @__PURE__ */ (function() {
    function ModuleGraph2() {
    }
    ;
    ModuleGraph2.value = new ModuleGraph2();
    return ModuleGraph2;
  })();
  var MermaidTreeDemo = /* @__PURE__ */ (function() {
    function MermaidTreeDemo2() {
    }
    ;
    MermaidTreeDemo2.value = new MermaidTreeDemo2();
    return MermaidTreeDemo2;
  })();
  var SceneJoinDemo = /* @__PURE__ */ (function() {
    function SceneJoinDemo2() {
    }
    ;
    SceneJoinDemo2.value = new SceneJoinDemo2();
    return SceneJoinDemo2;
  })();
  var ForceConfigPOC = /* @__PURE__ */ (function() {
    function ForceConfigPOC2() {
    }
    ;
    ForceConfigPOC2.value = new ForceConfigPOC2();
    return ForceConfigPOC2;
  })();
  var ForceConfigV2Test = /* @__PURE__ */ (function() {
    function ForceConfigV2Test2() {
    }
    ;
    ForceConfigV2Test2.value = new ForceConfigV2Test2();
    return ForceConfigV2Test2;
  })();
  var SimpleForceGraph = /* @__PURE__ */ (function() {
    function SimpleForceGraph2() {
    }
    ;
    SimpleForceGraph2.value = new SimpleForceGraph2();
    return SimpleForceGraph2;
  })();
  var SankeyDebug = /* @__PURE__ */ (function() {
    function SankeyDebug2() {
    }
    ;
    SankeyDebug2.value = new SankeyDebug2();
    return SankeyDebug2;
  })();
  var ForcePlayground = /* @__PURE__ */ (function() {
    function ForcePlayground2() {
    }
    ;
    ForcePlayground2.value = new ForcePlayground2();
    return ForcePlayground2;
  })();
  var TreeBuilder = /* @__PURE__ */ (function() {
    function TreeBuilder3() {
    }
    ;
    TreeBuilder3.value = new TreeBuilder3();
    return TreeBuilder3;
  })();
  var TreeBuilder2 = /* @__PURE__ */ (function() {
    function TreeBuilder22() {
    }
    ;
    TreeBuilder22.value = new TreeBuilder22();
    return TreeBuilder22;
  })();
  var SPLOM = /* @__PURE__ */ (function() {
    function SPLOM2() {
    }
    ;
    SPLOM2.value = new SPLOM2();
    return SPLOM2;
  })();
  var GUPDebug = /* @__PURE__ */ (function() {
    function GUPDebug2() {
    }
    ;
    GUPDebug2.value = new GUPDebug2();
    return GUPDebug2;
  })();
  var Acknowledgements = /* @__PURE__ */ (function() {
    function Acknowledgements2() {
    }
    ;
    Acknowledgements2.value = new Acknowledgements2();
    return Acknowledgements2;
  })();
  var NotFound = /* @__PURE__ */ (function() {
    function NotFound2() {
    }
    ;
    NotFound2.value = new NotFound2();
    return NotFound2;
  })();
  var showRoute = {
    show: function(v2) {
      if (v2 instanceof Home) {
        return "Home";
      }
      ;
      if (v2 instanceof GettingStarted) {
        return "Getting Started";
      }
      ;
      if (v2 instanceof Wizard) {
        return "Wizard";
      }
      ;
      if (v2 instanceof HowtoIndex) {
        return "How-to Guides";
      }
      ;
      if (v2 instanceof HowtoTransitions) {
        return "How-to: Transitions";
      }
      ;
      if (v2 instanceof HowtoForceGraphs) {
        return "How-to: Force Graphs";
      }
      ;
      if (v2 instanceof HowtoHierarchical) {
        return "How-to: Hierarchical Data";
      }
      ;
      if (v2 instanceof HowtoEvents) {
        return "How-to: Events";
      }
      ;
      if (v2 instanceof HowtoTreeAPI) {
        return "How-to: TreeAPI";
      }
      ;
      if (v2 instanceof HowtoLoadingData) {
        return "How-to: Loading Data";
      }
      ;
      if (v2 instanceof HowtoAxesScales) {
        return "How-to: Axes & Scales";
      }
      ;
      if (v2 instanceof HowtoTooltips) {
        return "How-to: Tooltips";
      }
      ;
      if (v2 instanceof HowtoDebugging) {
        return "How-to: Debugging";
      }
      ;
      if (v2 instanceof HowtoPerformance) {
        return "How-to: Performance";
      }
      ;
      if (v2 instanceof HowtoTreeExplorer) {
        return "How-to: Tree Explorer";
      }
      ;
      if (v2 instanceof Understanding) {
        return "Understanding";
      }
      ;
      if (v2 instanceof UnderstandingGrammar) {
        return "Understanding: Grammar";
      }
      ;
      if (v2 instanceof UnderstandingAttributes) {
        return "Understanding: Attributes";
      }
      ;
      if (v2 instanceof UnderstandingSelections) {
        return "Understanding: Selections";
      }
      ;
      if (v2 instanceof UnderstandingTreeAPI) {
        return "Understanding: TreeAPI";
      }
      ;
      if (v2 instanceof UnderstandingScenes) {
        return "Understanding: Scenes";
      }
      ;
      if (v2 instanceof Reference) {
        return "API Reference";
      }
      ;
      if (v2 instanceof ReferenceModule) {
        return "Module: " + v2.value0;
      }
      ;
      if (v2 instanceof TourIndex) {
        return "Tour";
      }
      ;
      if (v2 instanceof TourFoundations) {
        return "Tour: Foundations";
      }
      ;
      if (v2 instanceof TourProfessional) {
        return "Tour: Typical Charts";
      }
      ;
      if (v2 instanceof TourFlow) {
        return "Tour: Data Flow";
      }
      ;
      if (v2 instanceof TourHierarchies) {
        return "Tour: Hierarchies";
      }
      ;
      if (v2 instanceof TourMotion) {
        return "Tour: Motion & Transitions";
      }
      ;
      if (v2 instanceof TourWealthHealth) {
        return "Tour: Wealth & Health";
      }
      ;
      if (v2 instanceof TourInterpreters) {
        return "Tour: Alternative Interpreters";
      }
      ;
      if (v2 instanceof TourFPFTW) {
        return "Tour: FP For The Win";
      }
      ;
      if (v2 instanceof TourGraphAlgorithms) {
        return "Tour: Graph Algorithms";
      }
      ;
      if (v2 instanceof TourLesMisGUP) {
        return "Tour: General Update Pattern";
      }
      ;
      if (v2 instanceof TourSimpsons) {
        return "Tour: Simpson's Paradox";
      }
      ;
      if (v2 instanceof Showcase) {
        return "Showcase";
      }
      ;
      if (v2 instanceof Examples) {
        return "Examples";
      }
      ;
      if (v2 instanceof Example) {
        return "Example: " + v2.value0;
      }
      ;
      if (v2 instanceof TreeAPI) {
        return "Tree API Examples";
      }
      ;
      if (v2 instanceof AnimatedTreeCluster) {
        return "Animated Tree \u2194 Cluster";
      }
      ;
      if (v2 instanceof GeneralUpdatePattern) {
        return "General Update Pattern (Letters)";
      }
      ;
      if (v2 instanceof LesMisGUPTree) {
        return "Les Mis\xE9rables GUP (Tree API)";
      }
      ;
      if (v2 instanceof LesMisGUP) {
        return "Les Mis\xE9rables GUP (PSD3)";
      }
      ;
      if (v2 instanceof LesMisGUPSimple) {
        return "Les Mis\xE9rables GUP (Simple)";
      }
      ;
      if (v2 instanceof LesMisGUPTreeAPI) {
        return "Les Mis\xE9rables GUP (TreeAPI)";
      }
      ;
      if (v2 instanceof LesMisGUPClean) {
        return "Les Mis\xE9rables GUP (Clean)";
      }
      ;
      if (v2 instanceof LesMisQueryDemo) {
        return "Query Language Demo";
      }
      ;
      if (v2 instanceof ModuleGraph) {
        return "Module Graph";
      }
      ;
      if (v2 instanceof MermaidTreeDemo) {
        return "Mermaid Tree Visualizer";
      }
      ;
      if (v2 instanceof SceneJoinDemo) {
        return "SceneNestedJoin Demo";
      }
      ;
      if (v2 instanceof ForceConfigPOC) {
        return "Force Config POC";
      }
      ;
      if (v2 instanceof ForceConfigV2Test) {
        return "Force Config V2 Test";
      }
      ;
      if (v2 instanceof SimpleForceGraph) {
        return "Simple Force Graph";
      }
      ;
      if (v2 instanceof SankeyDebug) {
        return "Sankey Debug";
      }
      ;
      if (v2 instanceof ForcePlayground) {
        return "Force Playground";
      }
      ;
      if (v2 instanceof TreeBuilder) {
        return "Tree Builder";
      }
      ;
      if (v2 instanceof TreeBuilder2) {
        return "Tree Builder 2";
      }
      ;
      if (v2 instanceof SPLOM) {
        return "Brushable SPLOM";
      }
      ;
      if (v2 instanceof GUPDebug) {
        return "GUP Debug";
      }
      ;
      if (v2 instanceof Acknowledgements) {
        return "Acknowledgements";
      }
      ;
      if (v2 instanceof NotFound) {
        return "Not Found";
      }
      ;
      throw new Error("Failed pattern match at PSD3.Website.Types (line 153, column 1 - line 214, column 30): " + [v2.constructor.name]);
    }
  };
  var eqRoute = {
    eq: function(x32) {
      return function(y32) {
        if (x32 instanceof Home && y32 instanceof Home) {
          return true;
        }
        ;
        if (x32 instanceof GettingStarted && y32 instanceof GettingStarted) {
          return true;
        }
        ;
        if (x32 instanceof Wizard && y32 instanceof Wizard) {
          return true;
        }
        ;
        if (x32 instanceof HowtoIndex && y32 instanceof HowtoIndex) {
          return true;
        }
        ;
        if (x32 instanceof HowtoTransitions && y32 instanceof HowtoTransitions) {
          return true;
        }
        ;
        if (x32 instanceof HowtoForceGraphs && y32 instanceof HowtoForceGraphs) {
          return true;
        }
        ;
        if (x32 instanceof HowtoHierarchical && y32 instanceof HowtoHierarchical) {
          return true;
        }
        ;
        if (x32 instanceof HowtoEvents && y32 instanceof HowtoEvents) {
          return true;
        }
        ;
        if (x32 instanceof HowtoTreeAPI && y32 instanceof HowtoTreeAPI) {
          return true;
        }
        ;
        if (x32 instanceof HowtoLoadingData && y32 instanceof HowtoLoadingData) {
          return true;
        }
        ;
        if (x32 instanceof HowtoAxesScales && y32 instanceof HowtoAxesScales) {
          return true;
        }
        ;
        if (x32 instanceof HowtoTooltips && y32 instanceof HowtoTooltips) {
          return true;
        }
        ;
        if (x32 instanceof HowtoDebugging && y32 instanceof HowtoDebugging) {
          return true;
        }
        ;
        if (x32 instanceof HowtoPerformance && y32 instanceof HowtoPerformance) {
          return true;
        }
        ;
        if (x32 instanceof HowtoTreeExplorer && y32 instanceof HowtoTreeExplorer) {
          return true;
        }
        ;
        if (x32 instanceof Understanding && y32 instanceof Understanding) {
          return true;
        }
        ;
        if (x32 instanceof UnderstandingGrammar && y32 instanceof UnderstandingGrammar) {
          return true;
        }
        ;
        if (x32 instanceof UnderstandingAttributes && y32 instanceof UnderstandingAttributes) {
          return true;
        }
        ;
        if (x32 instanceof UnderstandingSelections && y32 instanceof UnderstandingSelections) {
          return true;
        }
        ;
        if (x32 instanceof UnderstandingTreeAPI && y32 instanceof UnderstandingTreeAPI) {
          return true;
        }
        ;
        if (x32 instanceof UnderstandingScenes && y32 instanceof UnderstandingScenes) {
          return true;
        }
        ;
        if (x32 instanceof Reference && y32 instanceof Reference) {
          return true;
        }
        ;
        if (x32 instanceof ReferenceModule && y32 instanceof ReferenceModule) {
          return x32.value0 === y32.value0;
        }
        ;
        if (x32 instanceof TourIndex && y32 instanceof TourIndex) {
          return true;
        }
        ;
        if (x32 instanceof TourFoundations && y32 instanceof TourFoundations) {
          return true;
        }
        ;
        if (x32 instanceof TourProfessional && y32 instanceof TourProfessional) {
          return true;
        }
        ;
        if (x32 instanceof TourFlow && y32 instanceof TourFlow) {
          return true;
        }
        ;
        if (x32 instanceof TourHierarchies && y32 instanceof TourHierarchies) {
          return true;
        }
        ;
        if (x32 instanceof TourMotion && y32 instanceof TourMotion) {
          return true;
        }
        ;
        if (x32 instanceof TourWealthHealth && y32 instanceof TourWealthHealth) {
          return true;
        }
        ;
        if (x32 instanceof TourInterpreters && y32 instanceof TourInterpreters) {
          return true;
        }
        ;
        if (x32 instanceof TourFPFTW && y32 instanceof TourFPFTW) {
          return true;
        }
        ;
        if (x32 instanceof TourGraphAlgorithms && y32 instanceof TourGraphAlgorithms) {
          return true;
        }
        ;
        if (x32 instanceof TourLesMisGUP && y32 instanceof TourLesMisGUP) {
          return true;
        }
        ;
        if (x32 instanceof TourSimpsons && y32 instanceof TourSimpsons) {
          return true;
        }
        ;
        if (x32 instanceof Showcase && y32 instanceof Showcase) {
          return true;
        }
        ;
        if (x32 instanceof Examples && y32 instanceof Examples) {
          return true;
        }
        ;
        if (x32 instanceof Example && y32 instanceof Example) {
          return x32.value0 === y32.value0;
        }
        ;
        if (x32 instanceof TreeAPI && y32 instanceof TreeAPI) {
          return true;
        }
        ;
        if (x32 instanceof AnimatedTreeCluster && y32 instanceof AnimatedTreeCluster) {
          return true;
        }
        ;
        if (x32 instanceof GeneralUpdatePattern && y32 instanceof GeneralUpdatePattern) {
          return true;
        }
        ;
        if (x32 instanceof LesMisGUPTree && y32 instanceof LesMisGUPTree) {
          return true;
        }
        ;
        if (x32 instanceof LesMisGUP && y32 instanceof LesMisGUP) {
          return true;
        }
        ;
        if (x32 instanceof LesMisGUPSimple && y32 instanceof LesMisGUPSimple) {
          return true;
        }
        ;
        if (x32 instanceof LesMisGUPTreeAPI && y32 instanceof LesMisGUPTreeAPI) {
          return true;
        }
        ;
        if (x32 instanceof LesMisGUPClean && y32 instanceof LesMisGUPClean) {
          return true;
        }
        ;
        if (x32 instanceof LesMisQueryDemo && y32 instanceof LesMisQueryDemo) {
          return true;
        }
        ;
        if (x32 instanceof ModuleGraph && y32 instanceof ModuleGraph) {
          return true;
        }
        ;
        if (x32 instanceof MermaidTreeDemo && y32 instanceof MermaidTreeDemo) {
          return true;
        }
        ;
        if (x32 instanceof SceneJoinDemo && y32 instanceof SceneJoinDemo) {
          return true;
        }
        ;
        if (x32 instanceof ForceConfigPOC && y32 instanceof ForceConfigPOC) {
          return true;
        }
        ;
        if (x32 instanceof ForceConfigV2Test && y32 instanceof ForceConfigV2Test) {
          return true;
        }
        ;
        if (x32 instanceof SimpleForceGraph && y32 instanceof SimpleForceGraph) {
          return true;
        }
        ;
        if (x32 instanceof SankeyDebug && y32 instanceof SankeyDebug) {
          return true;
        }
        ;
        if (x32 instanceof ForcePlayground && y32 instanceof ForcePlayground) {
          return true;
        }
        ;
        if (x32 instanceof TreeBuilder && y32 instanceof TreeBuilder) {
          return true;
        }
        ;
        if (x32 instanceof TreeBuilder2 && y32 instanceof TreeBuilder2) {
          return true;
        }
        ;
        if (x32 instanceof SPLOM && y32 instanceof SPLOM) {
          return true;
        }
        ;
        if (x32 instanceof GUPDebug && y32 instanceof GUPDebug) {
          return true;
        }
        ;
        if (x32 instanceof Acknowledgements && y32 instanceof Acknowledgements) {
          return true;
        }
        ;
        if (x32 instanceof NotFound && y32 instanceof NotFound) {
          return true;
        }
        ;
        return false;
      };
    }
  };

  // output/Data.Semiring.Free/index.js
  var append113 = /* @__PURE__ */ append(semigroupList);
  var bind48 = /* @__PURE__ */ bind(bindList);
  var pure29 = /* @__PURE__ */ pure(applicativeList);
  var semiringFree = /* @__PURE__ */ (function() {
    return {
      add: function(v2) {
        return function(v1) {
          return append113(v2)(v1);
        };
      },
      zero: Nil.value,
      mul: function(v2) {
        return function(v1) {
          return bind48(v2)(function(xs) {
            return bind48(v1)(function(ys) {
              return pure29(append113(xs)(ys));
            });
          });
        };
      },
      one: singleton3(Nil.value)
    };
  })();
  var free = function(a3) {
    return singleton3(singleton3(a3));
  };

  // output/Data.Validation.Semiring/index.js
  var V = function(x32) {
    return x32;
  };
  var validation = function(v2) {
    return function(v1) {
      return function(v22) {
        if (v22 instanceof Left) {
          return v2(v22.value0);
        }
        ;
        if (v22 instanceof Right) {
          return v1(v22.value0);
        }
        ;
        throw new Error("Failed pattern match at Data.Validation.Semiring (line 49, column 1 - line 49, column 84): " + [v2.constructor.name, v1.constructor.name, v22.constructor.name]);
      };
    };
  };
  var invalid2 = function($113) {
    return V(Left.create($113));
  };
  var functorV = functorEither;
  var applyV = function(dictSemiring) {
    var mul4 = mul(dictSemiring);
    return {
      apply: function(v2) {
        return function(v1) {
          if (v2 instanceof Left && v1 instanceof Left) {
            return new Left(mul4(v2.value0)(v1.value0));
          }
          ;
          if (v2 instanceof Left) {
            return new Left(v2.value0);
          }
          ;
          if (v1 instanceof Left) {
            return new Left(v1.value0);
          }
          ;
          if (v2 instanceof Right && v1 instanceof Right) {
            return new Right(v2.value0(v1.value0));
          }
          ;
          throw new Error("Failed pattern match at Data.Validation.Semiring (line 90, column 1 - line 94, column 54): " + [v2.constructor.name, v1.constructor.name]);
        };
      },
      Functor0: function() {
        return functorV;
      }
    };
  };
  var applicativeV = function(dictSemiring) {
    var applyV1 = applyV(dictSemiring);
    return {
      pure: function($121) {
        return V(Right.create($121));
      },
      Apply0: function() {
        return applyV1;
      }
    };
  };
  var altV = function(dictSemiring) {
    var add8 = add(dictSemiring);
    return {
      alt: function(v2) {
        return function(v1) {
          if (v2 instanceof Left && v1 instanceof Left) {
            return new Left(add8(v2.value0)(v1.value0));
          }
          ;
          if (v2 instanceof Left) {
            return v1;
          }
          ;
          if (v2 instanceof Right) {
            return new Right(v2.value0);
          }
          ;
          throw new Error("Failed pattern match at Data.Validation.Semiring (line 105, column 1 - line 108, column 36): " + [v2.constructor.name, v1.constructor.name]);
        };
      },
      Functor0: function() {
        return functorV;
      }
    };
  };

  // output/Routing.Match.Error/index.js
  var UnexpectedPath = /* @__PURE__ */ (function() {
    function UnexpectedPath2(value0) {
      this.value0 = value0;
    }
    ;
    UnexpectedPath2.create = function(value0) {
      return new UnexpectedPath2(value0);
    };
    return UnexpectedPath2;
  })();
  var ExpectedBoolean = /* @__PURE__ */ (function() {
    function ExpectedBoolean2() {
    }
    ;
    ExpectedBoolean2.value = new ExpectedBoolean2();
    return ExpectedBoolean2;
  })();
  var ExpectedEnd = /* @__PURE__ */ (function() {
    function ExpectedEnd2() {
    }
    ;
    ExpectedEnd2.value = new ExpectedEnd2();
    return ExpectedEnd2;
  })();
  var ExpectedNumber = /* @__PURE__ */ (function() {
    function ExpectedNumber2() {
    }
    ;
    ExpectedNumber2.value = new ExpectedNumber2();
    return ExpectedNumber2;
  })();
  var ExpectedInt = /* @__PURE__ */ (function() {
    function ExpectedInt2() {
    }
    ;
    ExpectedInt2.value = new ExpectedInt2();
    return ExpectedInt2;
  })();
  var ExpectedString = /* @__PURE__ */ (function() {
    function ExpectedString2() {
    }
    ;
    ExpectedString2.value = new ExpectedString2();
    return ExpectedString2;
  })();
  var ExpectedQuery = /* @__PURE__ */ (function() {
    function ExpectedQuery2() {
    }
    ;
    ExpectedQuery2.value = new ExpectedQuery2();
    return ExpectedQuery2;
  })();
  var ExpectedPathPart = /* @__PURE__ */ (function() {
    function ExpectedPathPart2() {
    }
    ;
    ExpectedPathPart2.value = new ExpectedPathPart2();
    return ExpectedPathPart2;
  })();
  var KeyNotFound = /* @__PURE__ */ (function() {
    function KeyNotFound2(value0) {
      this.value0 = value0;
    }
    ;
    KeyNotFound2.create = function(value0) {
      return new KeyNotFound2(value0);
    };
    return KeyNotFound2;
  })();
  var Fail = /* @__PURE__ */ (function() {
    function Fail2(value0) {
      this.value0 = value0;
    }
    ;
    Fail2.create = function(value0) {
      return new Fail2(value0);
    };
    return Fail2;
  })();
  var showMatchError = function(err) {
    if (err instanceof UnexpectedPath) {
      return "expected path part: " + err.value0;
    }
    ;
    if (err instanceof KeyNotFound) {
      return "key: " + (err.value0 + " has not found in query part");
    }
    ;
    if (err instanceof ExpectedQuery) {
      return "expected query - found path";
    }
    ;
    if (err instanceof ExpectedNumber) {
      return "expected number";
    }
    ;
    if (err instanceof ExpectedInt) {
      return "expected int";
    }
    ;
    if (err instanceof ExpectedBoolean) {
      return "expected boolean";
    }
    ;
    if (err instanceof ExpectedEnd) {
      return "expected end";
    }
    ;
    if (err instanceof ExpectedString) {
      return "expected string var";
    }
    ;
    if (err instanceof ExpectedPathPart) {
      return "expected path part, found query";
    }
    ;
    if (err instanceof Fail) {
      return "match error: " + err.value0;
    }
    ;
    throw new Error("Failed pattern match at Routing.Match.Error (line 19, column 3 - line 29, column 39): " + [err.constructor.name]);
  };

  // output/Routing.Types/index.js
  var Path3 = /* @__PURE__ */ (function() {
    function Path5(value0) {
      this.value0 = value0;
    }
    ;
    Path5.create = function(value0) {
      return new Path5(value0);
    };
    return Path5;
  })();
  var Query2 = /* @__PURE__ */ (function() {
    function Query3(value0) {
      this.value0 = value0;
    }
    ;
    Query3.create = function(value0) {
      return new Query3(value0);
    };
    return Query3;
  })();

  // output/Routing.Match/index.js
  var pure30 = /* @__PURE__ */ pure(/* @__PURE__ */ applicativeV(semiringFree));
  var foldl16 = /* @__PURE__ */ foldl(foldableList);
  var bind49 = /* @__PURE__ */ bind(bindList);
  var map63 = /* @__PURE__ */ map(functorList);
  var unwrap6 = /* @__PURE__ */ unwrap();
  var pure113 = /* @__PURE__ */ pure(applicativeList);
  var mul3 = /* @__PURE__ */ mul(semiringFree);
  var identity16 = /* @__PURE__ */ identity(categoryFn);
  var one3 = /* @__PURE__ */ one(semiringFree);
  var alt8 = /* @__PURE__ */ alt(/* @__PURE__ */ altV(semiringFree));
  var str10 = function(route) {
    if (route instanceof Cons && route.value0 instanceof Path3) {
      return pure30(new Tuple(route.value1, route.value0.value0));
    }
    ;
    return invalid2(free(ExpectedString.value));
  };
  var runMatch = function(v2) {
    return function(route) {
      var foldErrors = function(errs) {
        return new Left(foldl16(function(b10) {
          return function(a3) {
            return a3 + ("\n" + b10);
          };
        })("")(bind49(map63(reverse)(unwrap6(errs)))(function(es) {
          return pure113(foldl16(function(b10) {
            return function(a3) {
              return a3 + (";" + b10);
            };
          })("")(map63(showMatchError)(es)));
        })));
      };
      return validation(foldErrors)(function($109) {
        return Right.create(snd($109));
      })(v2(route));
    };
  };
  var matchFunctor = {
    map: function(fn) {
      return function(v2) {
        return function(r29) {
          return validation(invalid2)(function(v1) {
            return pure30(new Tuple(v1.value0, fn(v1.value1)));
          })(v2(r29));
        };
      };
    }
  };
  var matchApply = {
    apply: function(v2) {
      return function(v1) {
        var processFnRes = function(v22) {
          return validation(invalid2)(function(v3) {
            return pure30(new Tuple(v3.value0, v22.value1(v3.value1)));
          })(v1(v22.value0));
        };
        var processFnErr = function(r29) {
          return function(err) {
            return invalid2(mul3(err)(validation(identity16)($$const(one3))(v1(r29))));
          };
        };
        return function(r29) {
          return validation(processFnErr(r29))(processFnRes)(v2(r29));
        };
      };
    },
    Functor0: function() {
      return matchFunctor;
    }
  };
  var matchApplicative = {
    pure: function(a3) {
      return function(r29) {
        return pure30(new Tuple(r29, a3));
      };
    },
    Apply0: function() {
      return matchApply;
    }
  };
  var matchAlt = {
    alt: function(v2) {
      return function(v1) {
        return function(r29) {
          return alt8(v2(r29))(v1(r29));
        };
      };
    },
    Functor0: function() {
      return matchFunctor;
    }
  };
  var lit9 = function(input3) {
    return function(route) {
      if (route instanceof Cons && (route.value0 instanceof Path3 && route.value0.value0 === input3)) {
        return pure30(new Tuple(route.value1, unit));
      }
      ;
      if (route instanceof Cons && route.value0 instanceof Path3) {
        return invalid2(free(new UnexpectedPath(input3)));
      }
      ;
      return invalid2(free(ExpectedPathPart.value));
    };
  };
  var root2 = /* @__PURE__ */ lit9("");
  var end = function(route) {
    if (route instanceof Nil) {
      return pure30(new Tuple(Nil.value, unit));
    }
    ;
    return invalid2(free(ExpectedEnd.value));
  };

  // output/PSD3.RoutingDSL/index.js
  var applyFirst2 = /* @__PURE__ */ applyFirst(matchApply);
  var voidRight2 = /* @__PURE__ */ voidRight(matchFunctor);
  var map64 = /* @__PURE__ */ map(matchFunctor);
  var applySecond2 = /* @__PURE__ */ applySecond(matchApply);
  var alt9 = /* @__PURE__ */ alt(matchAlt);
  var wizard = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(Wizard.value)(lit9("wizard")))(end);
  })();
  var understandingTreeAPI = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(UnderstandingTreeAPI.value)(lit9("understanding")))(lit9("tree-api")))(end);
  })();
  var understandingSelections = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(UnderstandingSelections.value)(lit9("understanding")))(lit9("selections")))(end);
  })();
  var understandingScenes = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(UnderstandingScenes.value)(lit9("understanding")))(lit9("scenes")))(end);
  })();
  var understandingGrammar = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(UnderstandingGrammar.value)(lit9("understanding")))(lit9("grammar")))(end);
  })();
  var understandingAttributes = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(UnderstandingAttributes.value)(lit9("understanding")))(lit9("attributes")))(end);
  })();
  var understanding = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(Understanding.value)(lit9("understanding")))(end);
  })();
  var treeBuilder2 = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(TreeBuilder2.value)(lit9("tree-builder2")))(end);
  })();
  var treeBuilder = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(TreeBuilder.value)(lit9("tree-builder")))(end);
  })();
  var treeAPI = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(TreeAPI.value)(lit9("tree-api")))(end);
  })();
  var tourWealthHealth = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(TourWealthHealth.value)(lit9("tour")))(lit9("wealth-health")))(end);
  })();
  var tourSimpsons = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(TourSimpsons.value)(lit9("tour")))(lit9("simpsons")))(end);
  })();
  var tourProfessional = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(TourProfessional.value)(lit9("tour")))(lit9("professional")))(end);
  })();
  var tourMotion = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(TourMotion.value)(lit9("tour")))(lit9("motion")))(end);
  })();
  var tourLesMisGUP = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(TourLesMisGUP.value)(lit9("tour")))(lit9("lesmis-gup")))(end);
  })();
  var tourInterpreters = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(TourInterpreters.value)(lit9("tour")))(lit9("interpreters")))(end);
  })();
  var tourIndex = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(TourIndex.value)(lit9("tour")))(end);
  })();
  var tourHierarchies = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(TourHierarchies.value)(lit9("tour")))(lit9("hierarchies")))(end);
  })();
  var tourGraphAlgorithms = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(TourGraphAlgorithms.value)(lit9("tour")))(lit9("graph-algorithms")))(end);
  })();
  var tourFoundations = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(TourFoundations.value)(lit9("tour")))(lit9("foundations")))(end);
  })();
  var tourFlow = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(TourFlow.value)(lit9("tour")))(lit9("flow")))(end);
  })();
  var tourFPFTW = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(TourFPFTW.value)(lit9("tour")))(lit9("fpftw")))(end);
  })();
  var splom = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(SPLOM.value)(lit9("splom")))(end);
  })();
  var simpleForceGraphRoute = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(SimpleForceGraph.value)(lit9("simple-force-graph")))(end);
  })();
  var showcase = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(Showcase.value)(lit9("showcase")))(end);
  })();
  var sceneJoinDemo = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(SceneJoinDemo.value)(lit9("scene-join-demo")))(end);
  })();
  var sankeyDebug = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(SankeyDebug.value)(lit9("sankey-debug")))(end);
  })();
  var routeToPath = function(v2) {
    if (v2 instanceof Home) {
      return "/home";
    }
    ;
    if (v2 instanceof GettingStarted) {
      return "/getting-started";
    }
    ;
    if (v2 instanceof Wizard) {
      return "/wizard";
    }
    ;
    if (v2 instanceof HowtoIndex) {
      return "/howto";
    }
    ;
    if (v2 instanceof HowtoTransitions) {
      return "/howto/transitions";
    }
    ;
    if (v2 instanceof HowtoForceGraphs) {
      return "/howto/force-graphs";
    }
    ;
    if (v2 instanceof HowtoHierarchical) {
      return "/howto/hierarchical";
    }
    ;
    if (v2 instanceof HowtoEvents) {
      return "/howto/events";
    }
    ;
    if (v2 instanceof HowtoTreeAPI) {
      return "/howto/tree-api";
    }
    ;
    if (v2 instanceof HowtoLoadingData) {
      return "/howto/loading-data";
    }
    ;
    if (v2 instanceof HowtoAxesScales) {
      return "/howto/axes-scales";
    }
    ;
    if (v2 instanceof HowtoTooltips) {
      return "/howto/tooltips";
    }
    ;
    if (v2 instanceof HowtoDebugging) {
      return "/howto/debugging";
    }
    ;
    if (v2 instanceof HowtoPerformance) {
      return "/howto/performance";
    }
    ;
    if (v2 instanceof HowtoTreeExplorer) {
      return "/howto/tree-explorer";
    }
    ;
    if (v2 instanceof Understanding) {
      return "/understanding";
    }
    ;
    if (v2 instanceof UnderstandingGrammar) {
      return "/understanding/grammar";
    }
    ;
    if (v2 instanceof UnderstandingAttributes) {
      return "/understanding/attributes";
    }
    ;
    if (v2 instanceof UnderstandingSelections) {
      return "/understanding/selections";
    }
    ;
    if (v2 instanceof UnderstandingTreeAPI) {
      return "/understanding/tree-api";
    }
    ;
    if (v2 instanceof UnderstandingScenes) {
      return "/understanding/scenes";
    }
    ;
    if (v2 instanceof Reference) {
      return "/reference";
    }
    ;
    if (v2 instanceof ReferenceModule) {
      return "/reference/" + v2.value0;
    }
    ;
    if (v2 instanceof TourIndex) {
      return "/tour";
    }
    ;
    if (v2 instanceof TourFoundations) {
      return "/tour/foundations";
    }
    ;
    if (v2 instanceof TourProfessional) {
      return "/tour/professional";
    }
    ;
    if (v2 instanceof TourFlow) {
      return "/tour/flow";
    }
    ;
    if (v2 instanceof TourHierarchies) {
      return "/tour/hierarchies";
    }
    ;
    if (v2 instanceof TourMotion) {
      return "/tour/motion";
    }
    ;
    if (v2 instanceof TourWealthHealth) {
      return "/tour/wealth-health";
    }
    ;
    if (v2 instanceof TourInterpreters) {
      return "/tour/interpreters";
    }
    ;
    if (v2 instanceof TourFPFTW) {
      return "/tour/fpftw";
    }
    ;
    if (v2 instanceof TourGraphAlgorithms) {
      return "/tour/graph-algorithms";
    }
    ;
    if (v2 instanceof TourLesMisGUP) {
      return "/tour/lesmis-gup";
    }
    ;
    if (v2 instanceof TourSimpsons) {
      return "/tour/simpsons";
    }
    ;
    if (v2 instanceof Showcase) {
      return "/showcase";
    }
    ;
    if (v2 instanceof Examples) {
      return "/examples";
    }
    ;
    if (v2 instanceof Example) {
      return "/example/" + v2.value0;
    }
    ;
    if (v2 instanceof TreeAPI) {
      return "/tree-api";
    }
    ;
    if (v2 instanceof AnimatedTreeCluster) {
      return "/animated-tree-cluster";
    }
    ;
    if (v2 instanceof GeneralUpdatePattern) {
      return "/general-update-pattern";
    }
    ;
    if (v2 instanceof LesMisGUPTree) {
      return "/lesmis-gup-tree";
    }
    ;
    if (v2 instanceof LesMisGUP) {
      return "/lesmis-gup";
    }
    ;
    if (v2 instanceof LesMisGUPSimple) {
      return "/lesmis-gup-simple";
    }
    ;
    if (v2 instanceof LesMisGUPTreeAPI) {
      return "/lesmis-gup-treeapi";
    }
    ;
    if (v2 instanceof LesMisGUPClean) {
      return "/lesmis-gup-clean";
    }
    ;
    if (v2 instanceof LesMisQueryDemo) {
      return "/lesmis-query-demo";
    }
    ;
    if (v2 instanceof ModuleGraph) {
      return "/module-graph";
    }
    ;
    if (v2 instanceof MermaidTreeDemo) {
      return "/mermaid-tree-demo";
    }
    ;
    if (v2 instanceof SceneJoinDemo) {
      return "/scene-join-demo";
    }
    ;
    if (v2 instanceof ForceConfigPOC) {
      return "/force-config-poc";
    }
    ;
    if (v2 instanceof ForceConfigV2Test) {
      return "/force-config-v2-test";
    }
    ;
    if (v2 instanceof SimpleForceGraph) {
      return "/simple-force-graph";
    }
    ;
    if (v2 instanceof SankeyDebug) {
      return "/sankey-debug";
    }
    ;
    if (v2 instanceof ForcePlayground) {
      return "/force-playground";
    }
    ;
    if (v2 instanceof TreeBuilder) {
      return "/tree-builder";
    }
    ;
    if (v2 instanceof TreeBuilder2) {
      return "/tree-builder2";
    }
    ;
    if (v2 instanceof SPLOM) {
      return "/splom";
    }
    ;
    if (v2 instanceof GUPDebug) {
      return "/gup-debug";
    }
    ;
    if (v2 instanceof Acknowledgements) {
      return "/acknowledgements";
    }
    ;
    if (v2 instanceof NotFound) {
      return "/not-found";
    }
    ;
    throw new Error("Failed pattern match at PSD3.RoutingDSL (line 334, column 1 - line 334, column 31): " + [v2.constructor.name]);
  };
  var rootRedirect = /* @__PURE__ */ (function() {
    return voidRight2(Home.value)(end);
  })();
  var referenceModule = /* @__PURE__ */ (function() {
    return applyFirst2(map64(ReferenceModule.create)(applySecond2(lit9("reference"))(str10)))(end);
  })();
  var reference = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(Reference.value)(lit9("reference")))(end);
  })();
  var notFound = /* @__PURE__ */ (function() {
    return pure(matchApplicative)(NotFound.value);
  })();
  var moduleGraph = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(ModuleGraph.value)(lit9("module-graph")))(end);
  })();
  var mermaidTreeDemo = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(MermaidTreeDemo.value)(lit9("mermaid-tree-demo")))(end);
  })();
  var lesMisQueryDemo = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(LesMisQueryDemo.value)(lit9("lesmis-query-demo")))(end);
  })();
  var lesMisGUPTreeAPI = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(LesMisGUPTreeAPI.value)(lit9("lesmis-gup-treeapi")))(end);
  })();
  var lesMisGUPTree = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(LesMisGUPTree.value)(lit9("lesmis-gup-tree")))(end);
  })();
  var lesMisGUPSimple = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(LesMisGUPSimple.value)(lit9("lesmis-gup-simple")))(end);
  })();
  var lesMisGUPClean = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(LesMisGUPClean.value)(lit9("lesmis-gup-clean")))(end);
  })();
  var lesMisGUP = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(LesMisGUP.value)(lit9("lesmis-gup")))(end);
  })();
  var howtoTreeExplorer = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(HowtoTreeExplorer.value)(lit9("howto")))(lit9("tree-explorer")))(end);
  })();
  var howtoTreeAPI = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(HowtoTreeAPI.value)(lit9("howto")))(lit9("tree-api")))(end);
  })();
  var howtoTransitions = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(HowtoTransitions.value)(lit9("howto")))(lit9("transitions")))(end);
  })();
  var howtoTooltips = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(HowtoTooltips.value)(lit9("howto")))(lit9("tooltips")))(end);
  })();
  var howtoPerformance = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(HowtoPerformance.value)(lit9("howto")))(lit9("performance")))(end);
  })();
  var howtoLoadingData = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(HowtoLoadingData.value)(lit9("howto")))(lit9("loading-data")))(end);
  })();
  var howtoIndex = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(HowtoIndex.value)(lit9("howto")))(end);
  })();
  var howtoHierarchical = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(HowtoHierarchical.value)(lit9("howto")))(lit9("hierarchical")))(end);
  })();
  var howtoForceGraphs = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(HowtoForceGraphs.value)(lit9("howto")))(lit9("force-graphs")))(end);
  })();
  var howtoEvents = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(HowtoEvents.value)(lit9("howto")))(lit9("events")))(end);
  })();
  var howtoDebugging = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(HowtoDebugging.value)(lit9("howto")))(lit9("debugging")))(end);
  })();
  var howtoAxesScales = /* @__PURE__ */ (function() {
    return applyFirst2(applyFirst2(voidRight2(HowtoAxesScales.value)(lit9("howto")))(lit9("axes-scales")))(end);
  })();
  var home = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(Home.value)(lit9("home")))(end);
  })();
  var gupDebug = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(GUPDebug.value)(lit9("gup-debug")))(end);
  })();
  var gettingStarted = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(GettingStarted.value)(lit9("getting-started")))(end);
  })();
  var generalUpdatePattern = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(GeneralUpdatePattern.value)(lit9("general-update-pattern")))(end);
  })();
  var forcePlayground = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(ForcePlayground.value)(lit9("force-playground")))(end);
  })();
  var forceConfigV2Test = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(ForceConfigV2Test.value)(lit9("force-config-v2-test")))(end);
  })();
  var forceConfigPOC = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(ForceConfigPOC.value)(lit9("force-config-poc")))(end);
  })();
  var examples = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(Examples.value)(lit9("examples")))(end);
  })();
  var examplePage = /* @__PURE__ */ (function() {
    return applyFirst2(map64(Example.create)(applySecond2(lit9("example"))(str10)))(end);
  })();
  var animatedTreeCluster = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(AnimatedTreeCluster.value)(lit9("animated-tree-cluster")))(end);
  })();
  var acknowledgements = /* @__PURE__ */ (function() {
    return applyFirst2(voidRight2(Acknowledgements.value)(lit9("acknowledgements")))(end);
  })();
  var routes = /* @__PURE__ */ alt9(home)(/* @__PURE__ */ alt9(gettingStarted)(/* @__PURE__ */ alt9(wizard)(/* @__PURE__ */ alt9(howtoIndex)(/* @__PURE__ */ alt9(howtoTransitions)(/* @__PURE__ */ alt9(howtoForceGraphs)(/* @__PURE__ */ alt9(howtoHierarchical)(/* @__PURE__ */ alt9(howtoEvents)(/* @__PURE__ */ alt9(howtoTreeAPI)(/* @__PURE__ */ alt9(howtoLoadingData)(/* @__PURE__ */ alt9(howtoAxesScales)(/* @__PURE__ */ alt9(howtoTooltips)(/* @__PURE__ */ alt9(howtoDebugging)(/* @__PURE__ */ alt9(howtoPerformance)(/* @__PURE__ */ alt9(howtoTreeExplorer)(/* @__PURE__ */ alt9(understandingGrammar)(/* @__PURE__ */ alt9(understandingAttributes)(/* @__PURE__ */ alt9(understandingSelections)(/* @__PURE__ */ alt9(understandingTreeAPI)(/* @__PURE__ */ alt9(understandingScenes)(/* @__PURE__ */ alt9(understanding)(/* @__PURE__ */ alt9(referenceModule)(/* @__PURE__ */ alt9(reference)(/* @__PURE__ */ alt9(tourFoundations)(/* @__PURE__ */ alt9(tourProfessional)(/* @__PURE__ */ alt9(tourFlow)(/* @__PURE__ */ alt9(tourHierarchies)(/* @__PURE__ */ alt9(tourMotion)(/* @__PURE__ */ alt9(tourWealthHealth)(/* @__PURE__ */ alt9(tourInterpreters)(/* @__PURE__ */ alt9(tourFPFTW)(/* @__PURE__ */ alt9(tourGraphAlgorithms)(/* @__PURE__ */ alt9(tourLesMisGUP)(/* @__PURE__ */ alt9(tourSimpsons)(/* @__PURE__ */ alt9(tourIndex)(/* @__PURE__ */ alt9(showcase)(/* @__PURE__ */ alt9(examples)(/* @__PURE__ */ alt9(examplePage)(/* @__PURE__ */ alt9(treeAPI)(/* @__PURE__ */ alt9(animatedTreeCluster)(/* @__PURE__ */ alt9(generalUpdatePattern)(/* @__PURE__ */ alt9(lesMisGUPTree)(/* @__PURE__ */ alt9(lesMisGUP)(/* @__PURE__ */ alt9(lesMisGUPSimple)(/* @__PURE__ */ alt9(lesMisGUPTreeAPI)(/* @__PURE__ */ alt9(lesMisGUPClean)(/* @__PURE__ */ alt9(lesMisQueryDemo)(/* @__PURE__ */ alt9(moduleGraph)(/* @__PURE__ */ alt9(mermaidTreeDemo)(/* @__PURE__ */ alt9(sceneJoinDemo)(/* @__PURE__ */ alt9(forceConfigPOC)(/* @__PURE__ */ alt9(forceConfigV2Test)(/* @__PURE__ */ alt9(simpleForceGraphRoute)(/* @__PURE__ */ alt9(sankeyDebug)(/* @__PURE__ */ alt9(forcePlayground)(/* @__PURE__ */ alt9(treeBuilder)(/* @__PURE__ */ alt9(treeBuilder2)(/* @__PURE__ */ alt9(splom)(/* @__PURE__ */ alt9(gupDebug)(/* @__PURE__ */ alt9(acknowledgements)(/* @__PURE__ */ alt9(rootRedirect)(notFound)))))))))))))))))))))))))))))))))))))))))))))))))))))))))))));
  var routing = /* @__PURE__ */ applySecond2(root2)(routes);

  // output/PSD3.Shared.SiteNav/index.js
  var show46 = /* @__PURE__ */ show(showRoute);
  var NoQuadrant = /* @__PURE__ */ (function() {
    function NoQuadrant2() {
    }
    ;
    NoQuadrant2.value = new NoQuadrant2();
    return NoQuadrant2;
  })();
  var QuadGettingStarted = /* @__PURE__ */ (function() {
    function QuadGettingStarted2() {
    }
    ;
    QuadGettingStarted2.value = new QuadGettingStarted2();
    return QuadGettingStarted2;
  })();
  var QuadHowTo = /* @__PURE__ */ (function() {
    function QuadHowTo2() {
    }
    ;
    QuadHowTo2.value = new QuadHowTo2();
    return QuadHowTo2;
  })();
  var QuadReference = /* @__PURE__ */ (function() {
    function QuadReference2() {
    }
    ;
    QuadReference2.value = new QuadReference2();
    return QuadReference2;
  })();
  var QuadUnderstanding = /* @__PURE__ */ (function() {
    function QuadUnderstanding2() {
    }
    ;
    QuadUnderstanding2.value = new QuadUnderstanding2();
    return QuadUnderstanding2;
  })();
  var Large = /* @__PURE__ */ (function() {
    function Large3() {
    }
    ;
    Large3.value = new Large3();
    return Large3;
  })();
  var Normal = /* @__PURE__ */ (function() {
    function Normal2() {
    }
    ;
    Normal2.value = new Normal2();
    return Normal2;
  })();
  var quadrantTitle = function(v2) {
    if (v2 instanceof NoQuadrant) {
      return "";
    }
    ;
    if (v2 instanceof QuadGettingStarted) {
      return "Docs: Getting Started";
    }
    ;
    if (v2 instanceof QuadHowTo) {
      return "Docs: How-To";
    }
    ;
    if (v2 instanceof QuadReference) {
      return "Docs: Reference";
    }
    ;
    if (v2 instanceof QuadUnderstanding) {
      return "Docs: Understanding";
    }
    ;
    throw new Error("Failed pattern match at PSD3.Shared.SiteNav (line 185, column 17 - line 190, column 45): " + [v2.constructor.name]);
  };
  var quadrantRoute = function(v2) {
    if (v2 instanceof NoQuadrant) {
      return "#";
    }
    ;
    if (v2 instanceof QuadGettingStarted) {
      return "#" + routeToPath(GettingStarted.value);
    }
    ;
    if (v2 instanceof QuadHowTo) {
      return "#" + routeToPath(HowtoIndex.value);
    }
    ;
    if (v2 instanceof QuadReference) {
      return "#" + routeToPath(Reference.value);
    }
    ;
    if (v2 instanceof QuadUnderstanding) {
      return "#" + routeToPath(Understanding.value);
    }
    ;
    throw new Error("Failed pattern match at PSD3.Shared.SiteNav (line 176, column 17 - line 181, column 56): " + [v2.constructor.name]);
  };
  var eqQuadrant = {
    eq: function(x32) {
      return function(y32) {
        if (x32 instanceof NoQuadrant && y32 instanceof NoQuadrant) {
          return true;
        }
        ;
        if (x32 instanceof QuadGettingStarted && y32 instanceof QuadGettingStarted) {
          return true;
        }
        ;
        if (x32 instanceof QuadHowTo && y32 instanceof QuadHowTo) {
          return true;
        }
        ;
        if (x32 instanceof QuadReference && y32 instanceof QuadReference) {
          return true;
        }
        ;
        if (x32 instanceof QuadUnderstanding && y32 instanceof QuadUnderstanding) {
          return true;
        }
        ;
        return false;
      };
    }
  };
  var eq6 = /* @__PURE__ */ eq(eqQuadrant);
  var renderQuadrantBox = function(target7) {
    return function(current) {
      return a([href4(quadrantRoute(target7)), classes(["site-nav-quadrant-box", (function() {
        var $14 = eq6(target7)(current);
        if ($14) {
          return "site-nav-quadrant-box--active";
        }
        ;
        return "site-nav-quadrant-box--inactive";
      })()]), attr2("data-tooltip")(quadrantTitle(target7))])([]);
    };
  };
  var render4 = function(config) {
    return header([classes(["site-nav"])])([div2([classes(["site-nav-content"])])([div2([classes(["site-nav-left"])])([a([href4("#" + routeToPath(Home.value)), classes(["site-nav-logo-link"])])([img([src9("assets/psd3-logo-color.svg"), alt5("PSD3 Logo"), classes(["site-nav-logo", (function() {
      if (config.logoSize instanceof Large) {
        return "site-nav-logo--large";
      }
      ;
      if (config.logoSize instanceof Normal) {
        return "site-nav-logo--normal";
      }
      ;
      throw new Error("Failed pattern match at PSD3.Shared.SiteNav (line 68, column 42 - line 70, column 62): " + [config.logoSize.constructor.name]);
    })()])])]), (function() {
      if (config.pageTitle instanceof Nothing) {
        return text5("");
      }
      ;
      if (config.pageTitle instanceof Just) {
        return div2([classes(["site-nav-title-container"])])([h1([classes(["site-nav-title"])])([text5(config.pageTitle.value0)])]);
      }
      ;
      throw new Error("Failed pattern match at PSD3.Shared.SiteNav (line 74, column 15 - line 82, column 22): " + [config.pageTitle.constructor.name]);
    })()]), div2([classes(["site-nav-center"])])([div2([classes(["site-nav-quadrant"])])([renderQuadrantBox(QuadGettingStarted.value)(config.quadrant), renderQuadrantBox(QuadHowTo.value)(config.quadrant), renderQuadrantBox(QuadReference.value)(config.quadrant), renderQuadrantBox(QuadUnderstanding.value)(config.quadrant)])]), div2([classes(["site-nav-right"])])([nav([classes(["site-nav-links"])])([a([href4("#" + routeToPath(TourIndex.value)), classes(["site-nav-link"])])([text5("Tour")]), a([href4("#" + routeToPath(Examples.value)), classes(["site-nav-link"])])([text5("Examples")]), a([href4("#" + routeToPath(Showcase.value)), classes(["site-nav-link"])])([text5("Showcase")]), a([href4("#" + routeToPath(Acknowledgements.value)), classes(["site-nav-link"])])([text5("ACK")])]), (function() {
      if (config.prevNext instanceof Nothing) {
        return text5("");
      }
      ;
      if (config.prevNext instanceof Just) {
        return div2([classes(["site-nav-prevnext"])])([(function() {
          if (config.prevNext.value0.prev instanceof Nothing) {
            return span4([classes(["site-nav-button", "site-nav-button--disabled"])])([text5("\u261C")]);
          }
          ;
          if (config.prevNext.value0.prev instanceof Just) {
            return a([href4("#" + routeToPath(config.prevNext.value0.prev.value0)), classes(["site-nav-button"]), title2(show46(config.prevNext.value0.prev.value0))])([text5("\u261C")]);
          }
          ;
          throw new Error("Failed pattern match at PSD3.Shared.SiteNav (line 130, column 23 - line 141, column 44): " + [config.prevNext.value0.prev.constructor.name]);
        })(), (function() {
          if (config.prevNext.value0.next instanceof Nothing) {
            return span4([classes(["site-nav-button", "site-nav-button--disabled"])])([text5("\u261E")]);
          }
          ;
          if (config.prevNext.value0.next instanceof Just) {
            return a([href4("#" + routeToPath(config.prevNext.value0.next.value0)), classes(["site-nav-button"]), title2(show46(config.prevNext.value0.next.value0))])([text5("\u261E")]);
          }
          ;
          throw new Error("Failed pattern match at PSD3.Shared.SiteNav (line 142, column 23 - line 153, column 44): " + [config.prevNext.value0.next.constructor.name]);
        })()]);
      }
      ;
      throw new Error("Failed pattern match at PSD3.Shared.SiteNav (line 125, column 15 - line 154, column 22): " + [config.prevNext.constructor.name]);
    })()])])]);
  };

  // output/PSD3.Shared.Utilities/foreign.js
  function highlightString_(codetext) {
    const highlightedCode = Prism.highlight(codetext, Prism.languages.haskell, "haskell");
    return highlightedCode;
  }

  // output/Html.Parser/foreign.js
  function getAttributes(node) {
    var entries = [];
    for (var i2 = 0; i2 < node.attributes.length; i2++) {
      let { name: name16, value: value20 } = node.attributes.item(i2);
      entries.push([name16, value20]);
    }
    return entries;
  }
  function walk(treeWalker) {
    var nodes3 = [];
    function handleNode(node) {
      if (["#comment", "#text"].includes(node.nodeName)) {
        var text47 = node.textContent;
        if (text47) {
          nodes3.push({
            type: node.nodeName.slice(1),
            text: text47
          });
        }
      } else {
        var children3 = walk(treeWalker);
        treeWalker.currentNode = node;
        nodes3.push({
          type: "element",
          name: node.localName,
          attributes: getAttributes(node),
          children: children3
        });
      }
    }
    var currentNode = treeWalker.currentNode;
    var firstChild = treeWalker.firstChild();
    if (firstChild) {
      handleNode(firstChild);
    } else {
      return nodes3;
    }
    var nextSibling2 = treeWalker.nextSibling();
    while (nextSibling2) {
      handleNode(nextSibling2);
      treeWalker.currentNode = nextSibling2;
      nextSibling2 = treeWalker.nextSibling();
    }
    return nodes3;
  }
  function parseFromString(elementCtor) {
    return (attributeCtor) => (textCtor) => (commentCtor) => (input3) => {
      function mapNode(node) {
        if (node.type == "element") {
          return elementCtor({
            name: node.name,
            attributes: node.attributes.map(([k, v2]) => attributeCtor(k)(v2)),
            children: node.children.map(mapNode)
          });
        } else {
          var ctor = node.type == "text" ? textCtor : commentCtor;
          return ctor(node.text);
        }
      }
      var doc = new DOMParser().parseFromString(input3, "text/html");
      var headNodes = walk(
        doc.createTreeWalker(doc.documentElement.querySelector("head"))
      );
      var bodyNodes = walk(
        doc.createTreeWalker(doc.documentElement.querySelector("body"))
      );
      return [...headNodes, ...bodyNodes].map((node) => {
        if (node.type == "element") {
          return mapNode(node);
        } else {
          var ctor = node.type == "text" ? textCtor : commentCtor;
          return ctor(node.text);
        }
      });
    };
  }

  // output/Html.Parser/index.js
  var HtmlAttribute = /* @__PURE__ */ (function() {
    function HtmlAttribute2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    HtmlAttribute2.create = function(value0) {
      return function(value1) {
        return new HtmlAttribute2(value0, value1);
      };
    };
    return HtmlAttribute2;
  })();
  var HtmlElement = /* @__PURE__ */ (function() {
    function HtmlElement2(value0) {
      this.value0 = value0;
    }
    ;
    HtmlElement2.create = function(value0) {
      return new HtmlElement2(value0);
    };
    return HtmlElement2;
  })();
  var HtmlText = /* @__PURE__ */ (function() {
    function HtmlText2(value0) {
      this.value0 = value0;
    }
    ;
    HtmlText2.create = function(value0) {
      return new HtmlText2(value0);
    };
    return HtmlText2;
  })();
  var HtmlComment = /* @__PURE__ */ (function() {
    function HtmlComment2(value0) {
      this.value0 = value0;
    }
    ;
    HtmlComment2.create = function(value0) {
      return new HtmlComment2(value0);
    };
    return HtmlComment2;
  })();
  var parse7 = function(input3) {
    return parseFromString(HtmlElement.create)(HtmlAttribute.create)(HtmlText.create)(HtmlComment.create)(input3);
  };

  // output/Html.Renderer.Halogen/index.js
  var mapFlipped4 = /* @__PURE__ */ mapFlipped(functorMaybe);
  var alt10 = /* @__PURE__ */ alt(altMaybe);
  var mapFlipped12 = /* @__PURE__ */ mapFlipped(functorArray);
  var fromFoldable25 = /* @__PURE__ */ fromFoldable3(foldableArray);
  var map65 = /* @__PURE__ */ map(functorArray);
  var htmlAttributeToProp = function(v2) {
    return attr2(v2.value0)(v2.value1);
  };
  var nodeToHtml = function(v2) {
    return function(v1) {
      if (v1 instanceof HtmlElement) {
        return elementToHtml(v2)(v1.value0);
      }
      ;
      if (v1 instanceof HtmlText) {
        return text5(v1.value0);
      }
      ;
      if (v1 instanceof HtmlComment) {
        return text5("");
      }
      ;
      throw new Error("Failed pattern match at Html.Renderer.Halogen (line 38, column 1 - line 38, column 72): " + [v2.constructor.name, v1.constructor.name]);
    };
  };
  var elementToHtml = function(mParentNs) {
    return function(ele) {
      var mCurNs = mapFlipped4(find2(function(v2) {
        return v2.value0 === "xmlns";
      })(ele.attributes))(function(v2) {
        return v2.value1;
      });
      var mNs = alt10(mCurNs)(mParentNs);
      var ctor = (function() {
        if (mNs instanceof Just) {
          return elementNS(mNs.value0);
        }
        ;
        if (mNs instanceof Nothing) {
          return element2;
        }
        ;
        throw new Error("Failed pattern match at Html.Renderer.Halogen (line 34, column 12 - line 36, column 28): " + [mNs.constructor.name]);
      })();
      var children3 = mapFlipped12(ele.children)(nodeToHtml(mNs));
      return ctor(ele.name)(fromFoldable25(map65(htmlAttributeToProp)(ele.attributes)))(children3);
    };
  };
  var renderToArray = function(raw) {
    return map65(nodeToHtml(Nothing.value))(parse7(raw));
  };
  var render5 = function(props) {
    var $28 = div2(props);
    return function($29) {
      return $28(renderToArray($29));
    };
  };
  var render_ = /* @__PURE__ */ render5([]);

  // output/PSD3.Shared.Utilities/index.js
  var syntaxHighlightedCode = function(codetext) {
    return [pre([class_("language-haskell")])([code_([render_(highlightString_(codetext))])])];
  };

  // output/Component.Example/index.js
  var bind50 = /* @__PURE__ */ bind(bindHalogenM);
  var get8 = /* @__PURE__ */ get(monadStateHalogenM);
  var discard31 = /* @__PURE__ */ discard(discardUnit)(bindHalogenM);
  var pure31 = /* @__PURE__ */ pure(applicativeHalogenM);
  var modify_5 = /* @__PURE__ */ modify_(monadStateHalogenM);
  var map66 = /* @__PURE__ */ map(functorMaybe);
  var $$void9 = /* @__PURE__ */ $$void(functorEffect);
  var forever2 = /* @__PURE__ */ forever(monadRecHalogenM);
  var when5 = /* @__PURE__ */ when(applicativeHalogenM);
  var Initialize3 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var Receive2 = /* @__PURE__ */ (function() {
    function Receive3(value0) {
      this.value0 = value0;
    }
    ;
    Receive3.create = function(value0) {
      return new Receive3(value0);
    };
    return Receive3;
  })();
  var killGupFiber = function(dictMonadAff) {
    return bind50(get8)(function(state3) {
      return discard31((function() {
        if (state3.gupFiber instanceof Just) {
          return kill(state3.gupFiber.value0);
        }
        ;
        if (state3.gupFiber instanceof Nothing) {
          return pure31(unit);
        }
        ;
        throw new Error("Failed pattern match at Component.Example (line 90, column 3 - line 92, column 25): " + [state3.gupFiber.constructor.name]);
      })())(function() {
        return modify_5(function(v2) {
          var $44 = {};
          for (var $45 in v2) {
            if ({}.hasOwnProperty.call(v2, $45)) {
              $44[$45] = v2[$45];
            }
            ;
          }
          ;
          $44.gupFiber = Nothing.value;
          return $44;
        });
      });
    });
  };
  var getRandomLetters = /* @__PURE__ */ (function() {
    var coinToss = function(c2) {
      return function __do7() {
        var n = random();
        var $47 = n > 0.6;
        if ($47) {
          return new Just(c2);
        }
        ;
        return Nothing.value;
      };
    };
    var alphabet = toCharArray("ABCDEFGHIJKLMNOPQRSTUVWXYZ");
    return function __do7() {
      var choices = sequence(traversableArray)(applicativeEffect)(map(functorArray)(coinToss)(alphabet))();
      return fromCharArray(catMaybes(choices));
    };
  })();
  var getPrevExampleId = function(currentId) {
    if (currentId === "three-little-circles") {
      return Nothing.value;
    }
    ;
    if (currentId === "three-circles-transition") {
      return new Just("three-little-circles");
    }
    ;
    if (currentId === "simple-tree") {
      return new Just("three-circles-transition");
    }
    ;
    if (currentId === "nested-elements") {
      return new Just("simple-tree");
    }
    ;
    if (currentId === "three-little-dimensions") {
      return new Just("nested-elements");
    }
    ;
    if (currentId === "bar-chart") {
      return new Just("three-little-dimensions");
    }
    ;
    if (currentId === "scatter-plot") {
      return new Just("bar-chart");
    }
    ;
    if (currentId === "line-chart") {
      return new Just("scatter-plot");
    }
    ;
    if (currentId === "grouped-bar-chart") {
      return new Just("line-chart");
    }
    ;
    if (currentId === "simple-hierarchy") {
      return new Just("grouped-bar-chart");
    }
    ;
    if (currentId === "v3-parabola") {
      return new Just("simple-hierarchy");
    }
    ;
    if (currentId === "v3-transition") {
      return new Just("v3-parabola");
    }
    ;
    if (currentId === "v3-gup") {
      return new Just("v3-transition");
    }
    ;
    return Nothing.value;
  };
  var getNextExampleId = function(currentId) {
    if (currentId === "three-little-circles") {
      return new Just("three-circles-transition");
    }
    ;
    if (currentId === "three-circles-transition") {
      return new Just("simple-tree");
    }
    ;
    if (currentId === "simple-tree") {
      return new Just("nested-elements");
    }
    ;
    if (currentId === "nested-elements") {
      return new Just("three-little-dimensions");
    }
    ;
    if (currentId === "three-little-dimensions") {
      return new Just("bar-chart");
    }
    ;
    if (currentId === "bar-chart") {
      return new Just("scatter-plot");
    }
    ;
    if (currentId === "scatter-plot") {
      return new Just("line-chart");
    }
    ;
    if (currentId === "line-chart") {
      return new Just("grouped-bar-chart");
    }
    ;
    if (currentId === "grouped-bar-chart") {
      return new Just("simple-hierarchy");
    }
    ;
    if (currentId === "simple-hierarchy") {
      return new Just("v3-parabola");
    }
    ;
    if (currentId === "v3-parabola") {
      return new Just("v3-transition");
    }
    ;
    if (currentId === "v3-transition") {
      return new Just("v3-gup");
    }
    ;
    if (currentId === "v3-gup") {
      return Nothing.value;
    }
    ;
    return Nothing.value;
  };
  var renderHeader = function(currentId) {
    return function(maybeMeta) {
      return render4({
        logoSize: Large.value,
        quadrant: NoQuadrant.value,
        prevNext: new Just({
          prev: map66(Example.create)(getPrevExampleId(currentId)),
          next: map66(Example.create)(getNextExampleId(currentId))
        }),
        pageTitle: map66(function(m2) {
          return m2.name;
        })(maybeMeta)
      });
    };
  };
  var getModuleName = function(v2) {
    if (v2 === "three-little-circles") {
      return "ThreeLittleCircles";
    }
    ;
    if (v2 === "three-circles-transition") {
      return "ThreeLittleCirclesTransition";
    }
    ;
    if (v2 === "simple-tree") {
      return "SimpleTreeExample";
    }
    ;
    if (v2 === "nested-elements") {
      return "NestedElementsExample";
    }
    ;
    if (v2 === "bar-chart") {
      return "BarChartExample";
    }
    ;
    if (v2 === "scatter-plot") {
      return "ScatterPlotExample";
    }
    ;
    if (v2 === "line-chart") {
      return "LineChartExample";
    }
    ;
    if (v2 === "grouped-bar-chart") {
      return "GroupedBarChartExample";
    }
    ;
    if (v2 === "simple-hierarchy") {
      return "SimpleHierarchyExample";
    }
    ;
    if (v2 === "three-little-dimensions") {
      return "ThreeLittleDimensionsExample";
    }
    ;
    return "Unknown";
  };
  var getGithubLink = function(exampleId) {
    return "https://github.com/afcondon/purescript-d3-tagless/tree/main/src/website/Viz/TreeAPI/" + (getModuleName(exampleId) + ".purs");
  };
  var getExampleMeta = function(id5) {
    if (id5 === "three-little-circles") {
      return new Just({
        id: id5,
        name: "Three Little Circles",
        description: "Data join basics - bind data to DOM elements",
        category: "Basic Examples"
      });
    }
    ;
    if (id5 === "three-circles-transition") {
      return new Just({
        id: id5,
        name: "Circles Transition",
        description: "Animated transitions with easing and delays",
        category: "Basic Examples"
      });
    }
    ;
    if (id5 === "simple-tree") {
      return new Just({
        id: id5,
        name: "Simple Tree",
        description: "Basic nesting with named selections",
        category: "Basic Examples"
      });
    }
    ;
    if (id5 === "nested-elements") {
      return new Just({
        id: id5,
        name: "Nested Elements",
        description: "Multi-level nesting (Group \u2192 Circle + Text)",
        category: "Basic Examples"
      });
    }
    ;
    if (id5 === "three-little-dimensions") {
      return new Just({
        id: id5,
        name: "Three Little Dimensions",
        description: "Nested data joins (2D array \u2192 table)",
        category: "Basic Examples"
      });
    }
    ;
    if (id5 === "bar-chart") {
      return new Just({
        id: id5,
        name: "Bar Chart",
        description: "Data-driven bars with scaling",
        category: "Chart Examples"
      });
    }
    ;
    if (id5 === "scatter-plot") {
      return new Just({
        id: id5,
        name: "Scatter Plot",
        description: "Points positioned by data coordinates",
        category: "Chart Examples"
      });
    }
    ;
    if (id5 === "line-chart") {
      return new Just({
        id: id5,
        name: "Line Chart",
        description: "Path element generated from data",
        category: "Chart Examples"
      });
    }
    ;
    if (id5 === "grouped-bar-chart") {
      return new Just({
        id: id5,
        name: "Grouped Bar Chart",
        description: "Nested joins with multiple series",
        category: "Chart Examples"
      });
    }
    ;
    if (id5 === "multi-line-chart") {
      return new Just({
        id: id5,
        name: "Multi-Line Chart",
        description: "Multiple data series with path generator",
        category: "Chart Examples"
      });
    }
    ;
    if (id5 === "radial-stacked-bar") {
      return new Just({
        id: id5,
        name: "Radial Stacked Bar",
        description: "Stacked bars in polar coordinates",
        category: "Chart Examples"
      });
    }
    ;
    if (id5 === "anscombes-quartet") {
      return new Just({
        id: id5,
        name: "Anscombe's Quartet",
        description: "Four datasets with same statistics, different shapes",
        category: "Chart Examples"
      });
    }
    ;
    if (id5 === "wealth-health") {
      return new Just({
        id: id5,
        name: "Wealth & Health",
        description: "Gapminder-style bubble chart",
        category: "Chart Examples"
      });
    }
    ;
    if (id5 === "simple-hierarchy") {
      return new Just({
        id: id5,
        name: "Tree Layout",
        description: "Vertical tree with node-link diagram",
        category: "Hierarchies"
      });
    }
    ;
    if (id5 === "radial-tree") {
      return new Just({
        id: id5,
        name: "Radial Tree",
        description: "Tree layout in polar coordinates",
        category: "Hierarchies"
      });
    }
    ;
    if (id5 === "horizontal-tree") {
      return new Just({
        id: id5,
        name: "Horizontal Tree",
        description: "Tree layout oriented left-to-right",
        category: "Hierarchies"
      });
    }
    ;
    if (id5 === "cluster") {
      return new Just({
        id: id5,
        name: "Cluster Dendrogram",
        description: "Leaf nodes aligned at same depth",
        category: "Hierarchies"
      });
    }
    ;
    if (id5 === "treemap") {
      return new Just({
        id: id5,
        name: "Treemap",
        description: "Nested rectangles sized by value",
        category: "Hierarchies"
      });
    }
    ;
    if (id5 === "sunburst") {
      return new Just({
        id: id5,
        name: "Sunburst",
        description: "Radial partition diagram",
        category: "Hierarchies"
      });
    }
    ;
    if (id5 === "pack") {
      return new Just({
        id: id5,
        name: "Circle Packing",
        description: "Nested circles sized by value",
        category: "Hierarchies"
      });
    }
    ;
    if (id5 === "partition") {
      return new Just({
        id: id5,
        name: "Icicle / Partition",
        description: "Rectangular partition diagram",
        category: "Hierarchies"
      });
    }
    ;
    if (id5 === "sankey") {
      return new Just({
        id: id5,
        name: "Sankey Diagram",
        description: "Flow diagram with weighted links",
        category: "Relational"
      });
    }
    ;
    if (id5 === "chord") {
      return new Just({
        id: id5,
        name: "Chord Diagram",
        description: "Circular flow between groups",
        category: "Relational"
      });
    }
    ;
    if (id5 === "edge-bundle") {
      return new Just({
        id: id5,
        name: "Edge Bundling",
        description: "Hierarchical edge bundling",
        category: "Relational"
      });
    }
    ;
    if (id5 === "simple-force") {
      return new Just({
        id: id5,
        name: "Simple Force Graph",
        description: "Basic force-directed layout",
        category: "Force-Directed"
      });
    }
    ;
    if (id5 === "les-mis") {
      return new Just({
        id: id5,
        name: "Les Mis\xE9rables Network",
        description: "Character co-occurrence network",
        category: "Force-Directed"
      });
    }
    ;
    if (id5 === "v3-parabola") {
      return new Just({
        id: id5,
        name: "v3 Parabola",
        description: "Finally Tagless DSL - polymorphic expressions",
        category: "v3 DSL Examples"
      });
    }
    ;
    if (id5 === "v3-transition") {
      return new Just({
        id: id5,
        name: "v3 Transition",
        description: "v3 expressions as animated transition targets",
        category: "v3 DSL Examples"
      });
    }
    ;
    if (id5 === "v3-gup") {
      return new Just({
        id: id5,
        name: "v3 GUP",
        description: "General Update Pattern with staggered transitions",
        category: "v3 DSL Examples"
      });
    }
    ;
    return Nothing.value;
  };
  var getExampleCodeSummary = function(v2) {
    if (v2 === "three-little-circles") {
      return getSnippet("threeLittleCircles");
    }
    ;
    if (v2 === "three-circles-transition") {
      return getSnippet("threeLittleCirclesTransition");
    }
    ;
    if (v2 === "simple-tree") {
      return getSnippet("simpleTree");
    }
    ;
    if (v2 === "nested-elements") {
      return getSnippet("nestedElements");
    }
    ;
    if (v2 === "three-little-dimensions") {
      return getSnippet("threeLittleDimensions");
    }
    ;
    if (v2 === "bar-chart") {
      return getSnippet("barChart");
    }
    ;
    if (v2 === "scatter-plot") {
      return getSnippet("scatterPlot");
    }
    ;
    if (v2 === "line-chart") {
      return getSnippet("lineChart");
    }
    ;
    if (v2 === "grouped-bar-chart") {
      return getSnippet("groupedBarChart");
    }
    ;
    if (v2 === "multi-line-chart") {
      return getSnippet("multiLineChart");
    }
    ;
    if (v2 === "radial-stacked-bar") {
      return getSnippet("radialStackedBar");
    }
    ;
    if (v2 === "anscombes-quartet") {
      return getSnippet("anscombesQuartet");
    }
    ;
    if (v2 === "wealth-health") {
      return getSnippet("wealthHealth");
    }
    ;
    if (v2 === "simple-hierarchy") {
      return getSnippet("treeViz");
    }
    ;
    if (v2 === "radial-tree") {
      return getSnippet("radialTree");
    }
    ;
    if (v2 === "horizontal-tree") {
      return getSnippet("horizontalTree");
    }
    ;
    if (v2 === "cluster") {
      return getSnippet("cluster");
    }
    ;
    if (v2 === "treemap") {
      return getSnippet("treemap");
    }
    ;
    if (v2 === "sunburst") {
      return getSnippet("sunburst");
    }
    ;
    if (v2 === "pack") {
      return getSnippet("pack");
    }
    ;
    if (v2 === "partition") {
      return getSnippet("partition");
    }
    ;
    if (v2 === "sankey") {
      return getSnippet("sankey");
    }
    ;
    if (v2 === "chord") {
      return getSnippet("chord");
    }
    ;
    if (v2 === "edge-bundle") {
      return getSnippet("edgeBundle");
    }
    ;
    if (v2 === "simple-force") {
      return getSnippet("simpleForce");
    }
    ;
    if (v2 === "les-mis") {
      return getSnippet("lesMis");
    }
    ;
    if (v2 === "v3-parabola") {
      return getSnippet("v3Parabola");
    }
    ;
    if (v2 === "v3-transition") {
      return getSnippet("v3Transition");
    }
    ;
    if (v2 === "v3-gup") {
      return getSnippet("v3GUP");
    }
    ;
    return "-- See GitHub for full source code";
  };
  var render6 = function(state3) {
    var v2 = getExampleMeta(state3.exampleId);
    if (v2 instanceof Nothing) {
      return div2([classes(["example-page"])])([renderHeader(state3.exampleId)(Nothing.value), main([classes(["example-content"])])([h1_([text5("Example Not Found")]), p_([text5("No example found with ID: " + state3.exampleId)]), p_([a([href4("#" + routeToPath(Examples.value))])([text5("Return to Examples")])])])]);
    }
    ;
    if (v2 instanceof Just) {
      return div2([classes(["example-page"])])([renderHeader(state3.exampleId)(new Just(v2.value0)), main([classes(["example-content"])])([div2([classes(["example-description"])])([h1([classes(["example-title"])])([text5(v2.value0.name)]), p([classes(["example-subtitle"])])([text5(v2.value0.description)]), p([classes(["example-category-badge"])])([text5(v2.value0.category)])]), div2([classes(["example-viz-panel"])])([div2([id3("viz"), classes(["example-viz"])])([])]), div2([classes(["example-code-panel"])])([h2([classes(["code-panel-title"])])([text5("Source Code")]), p([classes(["code-note"])])([text5("View the source for this example in the "), a([href4(getGithubLink(v2.value0.id)), target6("_blank"), rel4("noopener noreferrer")])([text5("GitHub repository")])]), div2([classes(["code-block"])])(syntaxHighlightedCode(getExampleCodeSummary(v2.value0.id)))])])]);
    }
    ;
    throw new Error("Failed pattern match at Component.Example (line 313, column 3 - line 376, column 10): " + [v2.constructor.name]);
  };
  var clearVizContainer = function(dictMonadAff) {
    return clear3(monadEffectHalogenM(dictMonadAff.MonadEffect0()))("#viz");
  };
  var handleAction2 = function(dictMonadAff) {
    var killGupFiber1 = killGupFiber(dictMonadAff);
    var clearVizContainer1 = clearVizContainer(dictMonadAff);
    var liftEffect54 = liftEffect(monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    var liftAff2 = liftAff(monadAffHalogenM(dictMonadAff));
    return function(v2) {
      if (v2 instanceof Initialize3) {
        return discard31(killGupFiber1)(function() {
          return discard31(clearVizContainer1)(function() {
            return bind50(get8)(function(state3) {
              return discard31((function() {
                if (state3.exampleId === "three-little-circles") {
                  return liftEffect54(threeLittleCircles);
                }
                ;
                if (state3.exampleId === "three-circles-transition") {
                  return liftEffect54($$void9(threeLittleCirclesTransition("#viz")));
                }
                ;
                if (state3.exampleId === "simple-tree") {
                  return liftEffect54(testSimpleTree);
                }
                ;
                if (state3.exampleId === "nested-elements") {
                  return liftEffect54(testNestedElements);
                }
                ;
                if (state3.exampleId === "bar-chart") {
                  return liftEffect54(barChart);
                }
                ;
                if (state3.exampleId === "scatter-plot") {
                  return liftEffect54(scatterPlot);
                }
                ;
                if (state3.exampleId === "line-chart") {
                  return liftEffect54(lineChart);
                }
                ;
                if (state3.exampleId === "grouped-bar-chart") {
                  return liftEffect54(groupedBarChart("#viz"));
                }
                ;
                if (state3.exampleId === "simple-hierarchy") {
                  return liftEffect54(treeViz("#viz"));
                }
                ;
                if (state3.exampleId === "three-little-dimensions") {
                  return liftEffect54(threeLittleDimensions);
                }
                ;
                if (state3.exampleId === "v3-parabola") {
                  return liftEffect54(v3ParabolaDemo);
                }
                ;
                if (state3.exampleId === "v3-transition") {
                  return liftEffect54(v3TransitionDemo);
                }
                ;
                if (state3.exampleId === "v3-gup") {
                  return discard31(liftEffect54(v3GUPDemo))(function() {
                    return bind50(fork(forever2(discard31(liftAff2(delay(2500)))(function() {
                      return bind50(liftEffect54(getRandomLetters))(function(letters) {
                        return liftEffect54(updateWithLetters(letters));
                      });
                    }))))(function(forkId) {
                      return modify_5(function(v1) {
                        var $57 = {};
                        for (var $58 in v1) {
                          if ({}.hasOwnProperty.call(v1, $58)) {
                            $57[$58] = v1[$58];
                          }
                          ;
                        }
                        ;
                        $57.gupFiber = new Just(forkId);
                        return $57;
                      });
                    });
                  });
                }
                ;
                if (state3.exampleId === "multi-line-chart") {
                  return liftEffect54(multiLineChart("#viz"));
                }
                ;
                if (state3.exampleId === "radial-stacked-bar") {
                  return liftEffect54(radialStackedBar("#viz"));
                }
                ;
                if (state3.exampleId === "anscombes-quartet") {
                  return liftEffect54(anscombesQuartet("#viz"));
                }
                ;
                if (state3.exampleId === "radial-tree") {
                  return liftEffect54(radialTreeViz("#viz"));
                }
                ;
                if (state3.exampleId === "horizontal-tree") {
                  return liftEffect54(horizontalTreeViz("#viz"));
                }
                ;
                if (state3.exampleId === "cluster") {
                  return liftEffect54(clusterViz("#viz"));
                }
                ;
                if (state3.exampleId === "treemap") {
                  return liftEffect54(treemapViz("#viz"));
                }
                ;
                if (state3.exampleId === "sunburst") {
                  return liftEffect54(sunburstViz("#viz"));
                }
                ;
                if (state3.exampleId === "pack") {
                  return liftEffect54(packViz("#viz"));
                }
                ;
                if (state3.exampleId === "partition") {
                  return liftEffect54(partitionViz("#viz"));
                }
                ;
                if (state3.exampleId === "sankey") {
                  return bind50(liftAff2(simpleLoadText("./data/energy.csv")))(function(csvText) {
                    return liftEffect54(startSankey(csvText)("#viz"));
                  });
                }
                ;
                if (state3.exampleId === "chord") {
                  return liftEffect54(startChord("#viz"));
                }
                ;
                if (state3.exampleId === "edge-bundle") {
                  return liftEffect54(edgeBundleViz("#viz"));
                }
                ;
                if (state3.exampleId === "simple-force") {
                  return liftEffect54($$void9(simpleForceGraph("#viz")));
                }
                ;
                return pure31(unit);
              })())(function() {
                return liftEffect54(highlightAll);
              });
            });
          });
        });
      }
      ;
      if (v2 instanceof Receive2) {
        return bind50(get8)(function(state3) {
          return when5(state3.exampleId !== v2.value0)(discard31(killGupFiber1)(function() {
            return discard31(modify_5(function(v1) {
              var $60 = {};
              for (var $61 in v1) {
                if ({}.hasOwnProperty.call(v1, $61)) {
                  $60[$61] = v1[$61];
                }
                ;
              }
              ;
              $60.exampleId = v2.value0;
              return $60;
            }))(function() {
              return handleAction2(dictMonadAff)(Initialize3.value);
            });
          }));
        });
      }
      ;
      throw new Error("Failed pattern match at Component.Example (line 111, column 16 - line 196, column 30): " + [v2.constructor.name]);
    };
  };
  var component2 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(exampleId) {
        return {
          exampleId,
          gupFiber: Nothing.value
        };
      },
      render: render6,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        finalize: defaultEval.finalize,
        handleAction: handleAction2(dictMonadAff),
        initialize: new Just(Initialize3.value),
        receive: function($64) {
          return Just.create(Receive2.create($64));
        }
      })
    });
  };

  // output/Component.ExamplesGallery/foreign.js
  function filterImpl2(predicate) {
    return function(array2) {
      return array2.filter(predicate);
    };
  }

  // output/Component.ExamplesGallery/index.js
  var mapFlipped5 = /* @__PURE__ */ mapFlipped(functorArray);
  var renderExampleCard = function(ex) {
    return a([href4("#" + routeToPath(ex.route)), classes(["example-card"])])([div2([classes(["example-thumbnail"])])([img([src9(ex.thumbnail), alt5(ex.name), classes(["example-thumbnail-img"])])]), div2([classes(["example-card-content"])])([h3([classes(["example-card-title"])])([text5(ex.name)]), p([classes(["example-card-description"])])([text5(ex.description)])])]);
  };
  var renderCategory = function(categoryName) {
    return function(examples2) {
      return section([classes(["gallery-category"])])([h2([classes(["gallery-category-title"])])([text5(categoryName)]), div2([classes(["gallery-grid"])])(mapFlipped5(examples2)(renderExampleCard))]);
    };
  };
  var filter6 = filterImpl2;
  var renderCategories = function(examples2) {
    var categories = ["Basic Examples", "Chart Examples", "Hierarchies", "Relational", "Force-Directed", "v3 DSL Examples", "Advanced Examples", "Alternative Interpreters"];
    return mapFlipped5(categories)(function(category) {
      var examplesInCategory = filter6(function(ex) {
        return ex.category === category;
      })(examples2);
      return renderCategory(category)(examplesInCategory);
    });
  };
  var allExamples = /* @__PURE__ */ (function() {
    return [{
      id: "three-little-circles",
      name: "Three Little Circles",
      description: "Data join basics - bind data to DOM elements",
      category: "Basic Examples",
      route: new Example("three-little-circles"),
      thumbnail: "assets/example-thumbnails/three-little-circles.png"
    }, {
      id: "three-circles-transition",
      name: "Circles Transition",
      description: "Animated transitions with easing and delays",
      category: "Basic Examples",
      route: new Example("three-circles-transition"),
      thumbnail: "assets/example-thumbnails/three-little-circles.png"
    }, {
      id: "simple-tree",
      name: "Simple Tree",
      description: "Basic nesting with named selections",
      category: "Basic Examples",
      route: new Example("simple-tree"),
      thumbnail: "assets/example-thumbnails/simple-tree.png"
    }, {
      id: "nested-elements",
      name: "Nested Elements",
      description: "Multi-level nesting (Group \u2192 Circle + Text)",
      category: "Basic Examples",
      route: new Example("nested-elements"),
      thumbnail: "assets/example-thumbnails/nested-elements.png"
    }, {
      id: "three-little-dimensions",
      name: "Three Little Dimensions",
      description: "Nested data joins (2D array \u2192 table)",
      category: "Basic Examples",
      route: new Example("three-little-dimensions"),
      thumbnail: "assets/example-thumbnails/nested-data.png"
    }, {
      id: "bar-chart",
      name: "Bar Chart",
      description: "Data-driven bars with scaling",
      category: "Chart Examples",
      route: new Example("bar-chart"),
      thumbnail: "assets/example-thumbnails/simple-bar-chart.png"
    }, {
      id: "scatter-plot",
      name: "Scatter Plot",
      description: "Points positioned by data coordinates",
      category: "Chart Examples",
      route: new Example("scatter-plot"),
      thumbnail: "assets/example-thumbnails/anscombes-quartet.png"
    }, {
      id: "line-chart",
      name: "Line Chart",
      description: "Path element generated from data",
      category: "Chart Examples",
      route: new Example("line-chart"),
      thumbnail: "assets/example-thumbnails/simple-line-chart.png"
    }, {
      id: "grouped-bar-chart",
      name: "Grouped Bar Chart",
      description: "Nested joins with multiple series",
      category: "Chart Examples",
      route: new Example("grouped-bar-chart"),
      thumbnail: "assets/example-thumbnails/grouped-bar-chart.png"
    }, {
      id: "multi-line-chart",
      name: "Multi-Line Chart",
      description: "Multiple data series with path generator",
      category: "Chart Examples",
      route: new Example("multi-line-chart"),
      thumbnail: "assets/example-thumbnails/simple-line-chart.png"
    }, {
      id: "radial-stacked-bar",
      name: "Radial Stacked Bar",
      description: "Stacked bars in polar coordinates",
      category: "Chart Examples",
      route: new Example("radial-stacked-bar"),
      thumbnail: "assets/example-thumbnails/radial-stacked-bar.png"
    }, {
      id: "anscombes-quartet",
      name: "Anscombe's Quartet",
      description: "Four datasets with same statistics, different shapes",
      category: "Chart Examples",
      route: new Example("anscombes-quartet"),
      thumbnail: "assets/example-thumbnails/anscombes-quartet.png"
    }, {
      id: "wealth-health",
      name: "Wealth & Health",
      description: "Gapminder-style bubble chart",
      category: "Chart Examples",
      route: new Example("wealth-health"),
      thumbnail: "assets/example-thumbnails/wealth-health.png"
    }, {
      id: "simple-hierarchy",
      name: "Tree Layout",
      description: "Vertical tree with node-link diagram",
      category: "Hierarchies",
      route: new Example("simple-hierarchy"),
      thumbnail: "assets/example-thumbnails/tree-purescript.png"
    }, {
      id: "radial-tree",
      name: "Radial Tree",
      description: "Tree layout in polar coordinates",
      category: "Hierarchies",
      route: new Example("radial-tree"),
      thumbnail: "assets/example-thumbnails/radial-tree.png"
    }, {
      id: "horizontal-tree",
      name: "Horizontal Tree",
      description: "Tree layout oriented left-to-right",
      category: "Hierarchies",
      route: new Example("horizontal-tree"),
      thumbnail: "assets/example-thumbnails/horizontal-tree.png"
    }, {
      id: "cluster",
      name: "Cluster Dendrogram",
      description: "Leaf nodes aligned at same depth",
      category: "Hierarchies",
      route: new Example("cluster"),
      thumbnail: "assets/example-thumbnails/cluster.png"
    }, {
      id: "treemap",
      name: "Treemap",
      description: "Nested rectangles sized by value",
      category: "Hierarchies",
      route: new Example("treemap"),
      thumbnail: "assets/example-thumbnails/treemap.png"
    }, {
      id: "sunburst",
      name: "Sunburst",
      description: "Radial partition diagram",
      category: "Hierarchies",
      route: new Example("sunburst"),
      thumbnail: "assets/example-thumbnails/sunburst.png"
    }, {
      id: "pack",
      name: "Circle Packing",
      description: "Nested circles sized by value",
      category: "Hierarchies",
      route: new Example("pack"),
      thumbnail: "assets/example-thumbnails/pack.png"
    }, {
      id: "partition",
      name: "Icicle / Partition",
      description: "Rectangular partition diagram",
      category: "Hierarchies",
      route: new Example("partition"),
      thumbnail: "assets/example-thumbnails/partition.png"
    }, {
      id: "animated-tree-cluster",
      name: "Animated Tree \u2194 Cluster",
      description: "Smooth transitions between layouts",
      category: "Hierarchies",
      route: AnimatedTreeCluster.value,
      thumbnail: "assets/example-thumbnails/tree-purescript.png"
    }, {
      id: "sankey",
      name: "Sankey Diagram",
      description: "Flow diagram with weighted links",
      category: "Relational",
      route: new Example("sankey"),
      thumbnail: "assets/example-thumbnails/sankey.png"
    }, {
      id: "chord",
      name: "Chord Diagram",
      description: "Circular flow between groups",
      category: "Relational",
      route: new Example("chord"),
      thumbnail: "assets/example-thumbnails/chord.png"
    }, {
      id: "edge-bundle",
      name: "Edge Bundling",
      description: "Hierarchical edge bundling",
      category: "Relational",
      route: new Example("edge-bundle"),
      thumbnail: "assets/example-thumbnails/edge-bundle.png"
    }, {
      id: "simple-force",
      name: "Simple Force Graph",
      description: "Basic force-directed layout",
      category: "Force-Directed",
      route: new Example("simple-force"),
      thumbnail: "assets/example-thumbnails/simple-force.png"
    }, {
      id: "les-mis",
      name: "Les Mis\xE9rables Network",
      description: "Character co-occurrence network",
      category: "Force-Directed",
      route: new Example("les-mis"),
      thumbnail: "assets/example-thumbnails/les-miserables.png"
    }, {
      id: "lesmis-gup-tree",
      name: "Les Mis with GUP",
      description: "Dynamic layouts with General Update Pattern",
      category: "Force-Directed",
      route: LesMisGUPTree.value,
      thumbnail: "assets/example-thumbnails/les-miserables-gup.png"
    }, {
      id: "v3-parabola",
      name: "v3 Parabola",
      description: "Finally Tagless DSL with polymorphic expressions",
      category: "v3 DSL Examples",
      route: new Example("v3-parabola"),
      thumbnail: "assets/example-thumbnails/parabola.png"
    }, {
      id: "v3-transition",
      name: "v3 Transition",
      description: "v3 expressions as animated transition targets",
      category: "v3 DSL Examples",
      route: new Example("v3-transition"),
      thumbnail: "assets/example-thumbnails/v3-transition.png"
    }, {
      id: "v3-gup",
      name: "v3 GUP",
      description: "General Update Pattern with staggered transitions",
      category: "v3 DSL Examples",
      route: new Example("v3-gup"),
      thumbnail: "assets/example-thumbnails/v3-gup.png"
    }, {
      id: "splom",
      name: "SPLOM",
      description: "Brushable Scatterplot Matrix",
      category: "Advanced Examples",
      route: SPLOM.value,
      thumbnail: "assets/example-thumbnails/splom.png"
    }, {
      id: "module-graph",
      name: "Module Graph",
      description: "Visualize this codebase's module dependencies",
      category: "Advanced Examples",
      route: ModuleGraph.value,
      thumbnail: "assets/example-thumbnails/module-graph.png"
    }, {
      id: "mermaid-tree-demo",
      name: "Mermaid Tree Visualizer",
      description: "Visualize Tree API as Mermaid diagrams",
      category: "Alternative Interpreters",
      route: MermaidTreeDemo.value,
      thumbnail: "assets/example-thumbnails/mermaid-diagram.png"
    }];
  })();
  var render7 = function(v2) {
    return div2([classes(["examples-gallery-page"])])([render4({
      logoSize: Large.value,
      quadrant: NoQuadrant.value,
      prevNext: Nothing.value,
      pageTitle: new Just("Tree API Examples")
    }), main([classes(["gallery-content"])])(renderCategories(allExamples))]);
  };
  var component3 = /* @__PURE__ */ mkComponent({
    initialState: function(v2) {
      return unit;
    },
    render: render7,
    "eval": /* @__PURE__ */ mkEval(defaultEval)
  });

  // output/Component.ForcePlayground/foreign.js
  var clearContainer = (selector) => () => {
    const container = document.querySelector(selector);
    if (container) {
      container.innerHTML = "";
    }
  };

  // output/D3.Viz.ForcePlayground.Generator/index.js
  var foldM3 = /* @__PURE__ */ foldM(monadEffect);
  var pure33 = /* @__PURE__ */ pure(applicativeEffect);
  var append27 = /* @__PURE__ */ append(semigroupArray);
  var min11 = /* @__PURE__ */ min(ordInt);
  var max16 = /* @__PURE__ */ max(ordInt);
  var show47 = /* @__PURE__ */ show(showInt);
  var bind124 = /* @__PURE__ */ bind(bindArray);
  var pure114 = /* @__PURE__ */ pure(applicativeArray);
  var foldl17 = /* @__PURE__ */ foldl(foldableArray);
  var map67 = /* @__PURE__ */ map(functorArray);
  var pickBridgePairs = function(numSubgraphs) {
    return function(count) {
      return foldM3(function(acc) {
        return function(v2) {
          return function __do7() {
            var sg1 = randomInt(0)(numSubgraphs - 1 | 0)();
            var sg2 = randomInt(0)(numSubgraphs - 1 | 0)();
            var $44 = sg1 !== sg2;
            if ($44) {
              return append27(acc)([new Tuple(min11(sg1)(sg2), max16(sg1)(sg2))]);
            }
            ;
            return acc;
          };
        };
      })([])(replicate(count * 2 | 0)(unit));
    };
  };
  var generateNode = function(localId) {
    return function(subgraphId) {
      return function(dominantCategory) {
        return function __do7() {
          var useDominant = random();
          var category = (function() {
            var $46 = useDominant < 0.7;
            if ($46) {
              return dominantCategory;
            }
            ;
            return randomInt(0)(3)();
          })();
          var sizeClass = randomInt(0)(2)();
          var importance = random();
          var name16 = "Node " + (show47(subgraphId) + ("-" + show47(localId)));
          return {
            id: localId,
            name: name16,
            category,
            sizeClass,
            importance,
            subgraph: subgraphId
          };
        };
      };
    };
  };
  var generateNodes = function(count) {
    return function(subgraphId) {
      return function(dominantCategory) {
        return foldM3(function(acc) {
          return function(i2) {
            return function __do7() {
              var node = generateNode(i2)(subgraphId)(dominantCategory)();
              return append27(acc)([node]);
            };
          };
        })([])(range2(0)(count - 1 | 0));
      };
    };
  };
  var generateBimodalWeight = function __do3() {
    var r29 = random();
    var $47 = r29 < 0.5;
    if ($47) {
      var w = random();
      return 0.15 + w * 0.2;
    }
    ;
    var w = random();
    return 0.7 + w * 0.3;
  };
  var generateLink = function(source3) {
    return function(target7) {
      return function __do7() {
        var weight = generateBimodalWeight();
        var linkType = randomInt(0)(3)();
        var distance = 30 + (1 - weight) * 70;
        return {
          source: source3,
          target: target7,
          weight,
          linkType,
          distance
        };
      };
    };
  };
  var generateBridgeLinks = function(v2) {
    return function(nodes3) {
      return function(sg1) {
        return function(sg2) {
          return function(count) {
            var nodesInSg2 = filter(function(n) {
              return n.subgraph === sg2;
            })(nodes3);
            var nodesInSg1 = filter(function(n) {
              return n.subgraph === sg1;
            })(nodes3);
            var $48 = length3(nodesInSg1) === 0 || length3(nodesInSg2) === 0;
            if ($48) {
              return pure33([]);
            }
            ;
            return foldM3(function(acc) {
              return function(v1) {
                return function __do7() {
                  var idx1 = randomInt(0)(length3(nodesInSg1) - 1 | 0)();
                  var idx2 = randomInt(0)(length3(nodesInSg2) - 1 | 0)();
                  var v22 = new Tuple(index(nodesInSg1)(idx1), index(nodesInSg2)(idx2));
                  if (v22.value0 instanceof Just && v22.value1 instanceof Just) {
                    var link5 = generateLink(v22.value0.value0.id)(v22.value1.value0.id)();
                    var bridgeLink = {
                      linkType: link5.linkType,
                      source: link5.source,
                      target: link5.target,
                      weight: link5.weight * 0.5,
                      distance: link5.distance * 1.5
                    };
                    return append27(acc)([bridgeLink]);
                  }
                  ;
                  return acc;
                };
              };
            })([])(replicate(count)(unit));
          };
        };
      };
    };
  };
  var generateBridges = function(config) {
    return function(offsets) {
      return function(nodes3) {
        var numSubgraphs = length3(offsets);
        var $54 = numSubgraphs < 2;
        if ($54) {
          return pure33([]);
        }
        ;
        return function __do7() {
          var bridgePairs = pickBridgePairs(numSubgraphs)(config.bridgeCount)();
          return foldM3(function(acc) {
            return function(v2) {
              return function __do8() {
                var links3 = generateBridgeLinks(offsets)(nodes3)(v2.value0)(v2.value1)(config.bridgeLinks)();
                return append27(acc)(links3);
              };
            };
          })([])(bridgePairs)();
        };
      };
    };
  };
  var generateInternalLinks = function(nodes3) {
    return function(connectivity) {
      var n = length3(nodes3);
      var $58 = n < 2;
      if ($58) {
        return pure33([]);
      }
      ;
      var pairs = bind124(range2(0)(n - 2 | 0))(function(i2) {
        return bind124(range2(i2 + 1 | 0)(n - 1 | 0))(function(j) {
          return pure114(new Tuple(i2, j));
        });
      });
      return foldM3(function(acc) {
        return function(v2) {
          return function __do7() {
            var include = random();
            var $60 = include < connectivity;
            if ($60) {
              var link5 = generateLink(v2.value0)(v2.value1)();
              return append27(acc)([link5]);
            }
            ;
            return acc;
          };
        };
      })([])(pairs);
    };
  };
  var generateSubgraph = function(config) {
    return function(subgraphId) {
      return function __do7() {
        var nodeCount = randomInt(config.minNodesPerSubgraph)(config.maxNodesPerSubgraph)();
        var dominantCategory = randomInt(0)(3)();
        var nodes3 = generateNodes(nodeCount)(subgraphId)(dominantCategory)();
        var links3 = generateInternalLinks(nodes3)(config.internalConnectivity)();
        return {
          nodes: nodes3,
          links: links3
        };
      };
    };
  };
  var generateSubgraphs = function(config) {
    return function(count) {
      return foldM3(function(acc) {
        return function(i2) {
          return function __do7() {
            var sg = generateSubgraph(config)(i2)();
            return append27(acc)([sg]);
          };
        };
      })([])(range2(0)(count - 1 | 0));
    };
  };
  var flattenSubgraphs = function(subgraphs) {
    var offsets = foldl17(function(acc) {
      return function(v2) {
        var prevCount = (function() {
          var v1 = index(subgraphs)(length3(acc) - 1 | 0);
          if (v1 instanceof Nothing) {
            return 0;
          }
          ;
          if (v1 instanceof Just) {
            return length3(v1.value0.nodes);
          }
          ;
          throw new Error("Failed pattern match at D3.Viz.ForcePlayground.Generator (line 251, column 25 - line 253, column 45): " + [v1.constructor.name]);
        })();
        var lastOffset = (function() {
          var v1 = last(acc);
          if (v1 instanceof Nothing) {
            return 0;
          }
          ;
          if (v1 instanceof Just) {
            return v1.value0;
          }
          ;
          throw new Error("Failed pattern match at D3.Viz.ForcePlayground.Generator (line 248, column 26 - line 250, column 26): " + [v1.constructor.name]);
        })();
        return append27(acc)([lastOffset + prevCount | 0]);
      };
    })([0])(take(length3(subgraphs) - 1 | 0)(subgraphs));
    var adjustedNodes = concat(mapWithIndex3(function(i2) {
      return function(sg) {
        var offset = (function() {
          var v2 = index(offsets)(i2);
          if (v2 instanceof Nothing) {
            return 0;
          }
          ;
          if (v2 instanceof Just) {
            return v2.value0;
          }
          ;
          throw new Error("Failed pattern match at D3.Viz.ForcePlayground.Generator (line 262, column 22 - line 264, column 26): " + [v2.constructor.name]);
        })();
        return map67(function(n) {
          return {
            category: n.category,
            importance: n.importance,
            name: n.name,
            sizeClass: n.sizeClass,
            subgraph: n.subgraph,
            id: n.id + offset | 0
          };
        })(sg.nodes);
      };
    })(subgraphs));
    var adjustedLinks = concat(mapWithIndex3(function(i2) {
      return function(sg) {
        var offset = (function() {
          var v2 = index(offsets)(i2);
          if (v2 instanceof Nothing) {
            return 0;
          }
          ;
          if (v2 instanceof Just) {
            return v2.value0;
          }
          ;
          throw new Error("Failed pattern match at D3.Viz.ForcePlayground.Generator (line 272, column 22 - line 274, column 26): " + [v2.constructor.name]);
        })();
        return map67(function(l2) {
          return {
            distance: l2.distance,
            linkType: l2.linkType,
            weight: l2.weight,
            source: l2.source + offset | 0,
            target: l2.target + offset | 0
          };
        })(sg.links);
      };
    })(subgraphs));
    return {
      nodes: adjustedNodes,
      links: adjustedLinks,
      offsets
    };
  };
  var generateGraph = function(config) {
    return function __do7() {
      var numSubgraphs = randomInt(config.minSubgraphs)(config.maxSubgraphs)();
      var subgraphs = generateSubgraphs(config)(numSubgraphs)();
      var v2 = flattenSubgraphs(subgraphs);
      var bridgeLinks = generateBridges(config)(v2.offsets)(v2.nodes)();
      return {
        nodes: v2.nodes,
        links: append27(v2.links)(bridgeLinks)
      };
    };
  };
  var defaultConfig3 = {
    minSubgraphs: 20,
    maxSubgraphs: 30,
    minNodesPerSubgraph: 3,
    maxNodesPerSubgraph: 10,
    internalConnectivity: 0.3,
    bridgeCount: 8,
    bridgeLinks: 2
  };

  // output/D3.Viz.ForcePlayground.Model/index.js
  var map68 = /* @__PURE__ */ map(functorArray);
  var mkNodeFromGenerated = function(gen) {
    return {
      id: gen.id,
      name: gen.name,
      group: gen.category,
      sizeClass: gen.sizeClass,
      importance: gen.importance,
      subgraph: gen.subgraph,
      x: 0,
      y: 0,
      vx: 0,
      vy: 0,
      fx: nullImpl,
      fy: nullImpl
    };
  };
  var mkLinkFromGenerated = function(gen) {
    return {
      source: gen.source,
      target: gen.target,
      weight: gen.weight,
      linkType: gen.linkType,
      distance: gen.distance
    };
  };
  var fromGeneratedGraph = function(gen) {
    return {
      nodes: map68(mkNodeFromGenerated)(gen.nodes),
      links: map68(mkLinkFromGenerated)(gen.links)
    };
  };

  // output/Data.Map/index.js
  var keys3 = /* @__PURE__ */ (function() {
    var $38 = $$void(functorMap);
    return function($39) {
      return fromMap($38($39));
    };
  })();

  // output/PSD3.Transition.Tick/index.js
  var map69 = /* @__PURE__ */ map(functorArray);
  var min12 = /* @__PURE__ */ min(ordNumber);
  var map120 = /* @__PURE__ */ map(functorMap);
  var toUnfoldable6 = /* @__PURE__ */ toUnfoldable5(unfoldableArray);
  var tickTransitions = function(delta) {
    return function(transitions) {
      var advanced = map69(function(t2) {
        return {
          item: t2.item,
          progress: min12(1)(t2.progress + delta)
        };
      })(transitions);
      var completed = map69(function(v2) {
        return v2.item;
      })(filter(function(t2) {
        return t2.progress >= 1;
      })(advanced));
      var active = filter(function(t2) {
        return t2.progress < 1;
      })(advanced);
      return {
        active,
        completed
      };
    };
  };
  var tickProgressMap = function(dictOrd) {
    var filter7 = filter2(dictOrd);
    return function(delta) {
      return function(progressMap) {
        var advanced = map120(function(p2) {
          return min12(1)(p2 + delta);
        })(progressMap);
        var completed = toUnfoldable6(keys3(filter7(function(p2) {
          return p2 >= 1;
        })(advanced)));
        var active = filter7(function(p2) {
          return p2 < 1;
        })(advanced);
        return {
          active,
          completed
        };
      };
    };
  };
  var startTransitions = /* @__PURE__ */ map69(function(item) {
    return {
      item,
      progress: 0
    };
  });
  var startProgress = function(dictOrd) {
    var insert19 = insert(dictOrd);
    return function(keys4) {
      return function(existing) {
        return foldl4(function(m2) {
          return function(k) {
            return insert19(k)(0)(m2);
          };
        })(existing)(keys4);
      };
    };
  };
  var lerp2 = function(start4) {
    return function(end2) {
      return function(t2) {
        return start4 + (end2 - start4) * t2;
      };
    };
  };

  // output/D3.Viz.ForcePlayground.Simple/index.js
  var bind51 = /* @__PURE__ */ bind(bindD3v2M);
  var select27 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var width29 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var num22 = /* @__PURE__ */ num(numExprEvalD);
  var height29 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr27 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text27 = /* @__PURE__ */ text6(stringExprEvalD);
  var renderTree48 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D);
  var renderTree114 = /* @__PURE__ */ renderTree48(ordUnit);
  var pure34 = /* @__PURE__ */ pure(applicativeD3v2M);
  var mod11 = /* @__PURE__ */ mod(euclideanRingInt);
  var x18 = /* @__PURE__ */ x1(toAttributeValueNumber);
  var y19 = /* @__PURE__ */ y1(toAttributeValueNumber);
  var x22 = /* @__PURE__ */ x2(toAttributeValueNumber);
  var y22 = /* @__PURE__ */ y2(toAttributeValueNumber);
  var strokeWidth16 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var stroke17 = /* @__PURE__ */ stroke(toAttributeValueString);
  var opacity7 = /* @__PURE__ */ opacity(toAttributeValueNumber);
  var cx11 = /* @__PURE__ */ cx(toAttributeValueNumber);
  var cy11 = /* @__PURE__ */ cy(toAttributeValueNumber);
  var r13 = /* @__PURE__ */ r(toAttributeValueNumber);
  var fill22 = /* @__PURE__ */ fill(toAttributeValueString);
  var ordRecord10 = /* @__PURE__ */ ordRecord();
  var ordRecordCons10 = /* @__PURE__ */ ordRecordCons(ordRecordNil)();
  var ordNullable3 = /* @__PURE__ */ ordNullable(ordNumber);
  var ordRecord16 = /* @__PURE__ */ ordRecord10(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons10({
    reflectSymbol: function() {
      return "y";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "x";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "vy";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "vx";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "subgraph";
    }
  })(ordInt))()({
    reflectSymbol: function() {
      return "sizeClass";
    }
  })(ordInt))()({
    reflectSymbol: function() {
      return "name";
    }
  })(ordString))()({
    reflectSymbol: function() {
      return "importance";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "id";
    }
  })(ordInt))()({
    reflectSymbol: function() {
      return "group";
    }
  })(ordInt))()({
    reflectSymbol: function() {
      return "fy";
    }
  })(ordNullable3))()({
    reflectSymbol: function() {
      return "fx";
    }
  })(ordNullable3));
  var ordMaybe2 = /* @__PURE__ */ ordMaybe(ordNumber);
  var renderTree214 = /* @__PURE__ */ renderTree48(/* @__PURE__ */ ordRecord10(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons10({
    reflectSymbol: function() {
      return "nodes";
    }
  })(/* @__PURE__ */ ordArray(/* @__PURE__ */ ordRecord10(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons10({
    reflectSymbol: function() {
      return "node";
    }
  })(ordRecord16))()({
    reflectSymbol: function() {
      return "exitProgress";
    }
  })(ordMaybe2))()({
    reflectSymbol: function() {
      return "enterProgress";
    }
  })(ordMaybe2)))))()({
    reflectSymbol: function() {
      return "links";
    }
  })(/* @__PURE__ */ ordArray(/* @__PURE__ */ ordRecord10(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons10({
    reflectSymbol: function() {
      return "weight";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "target";
    }
  })(ordRecord16))()({
    reflectSymbol: function() {
      return "source";
    }
  })(ordRecord16))()({
    reflectSymbol: function() {
      return "linkType";
    }
  })(ordInt))()({
    reflectSymbol: function() {
      return "index";
    }
  })(ordInt))))));
  var elem5 = /* @__PURE__ */ elem2(eqInt);
  var map70 = /* @__PURE__ */ map(functorArray);
  var lookup24 = /* @__PURE__ */ lookup(ordInt);
  var append28 = /* @__PURE__ */ append(semigroupArray);
  var ForceCharge = /* @__PURE__ */ (function() {
    function ForceCharge2() {
    }
    ;
    ForceCharge2.value = new ForceCharge2();
    return ForceCharge2;
  })();
  var ForceCollide = /* @__PURE__ */ (function() {
    function ForceCollide3() {
    }
    ;
    ForceCollide3.value = new ForceCollide3();
    return ForceCollide3;
  })();
  var ForceLink = /* @__PURE__ */ (function() {
    function ForceLink3() {
    }
    ;
    ForceLink3.value = new ForceLink3();
    return ForceLink3;
  })();
  var ForceX = /* @__PURE__ */ (function() {
    function ForceX2() {
    }
    ;
    ForceX2.value = new ForceX2();
    return ForceX2;
  })();
  var ForceY = /* @__PURE__ */ (function() {
    function ForceY2() {
    }
    ;
    ForceY2.value = new ForceY2();
    return ForceY2;
  })();
  var transitionDelta = 0.03;
  var svgWidth = 800;
  var svgHeight = 600;
  var strokeWidthForRenderNode = function(rn) {
    if (rn.enterProgress instanceof Just) {
      return lerp2(4)(1.5)(rn.enterProgress.value0);
    }
    ;
    if (rn.exitProgress instanceof Just) {
      return lerp2(1.5)(4)(rn.exitProgress.value0);
    }
    ;
    return 1.5;
  };
  var strokeForRenderNode = function(rn) {
    if (rn.enterProgress instanceof Just) {
      return "#98df8a";
    }
    ;
    if (rn.exitProgress instanceof Just) {
      return "#ff9896";
    }
    ;
    return "#fff";
  };
  var renderSVGContainer = function(containerSelector) {
    return runD3v2M(bind51(select27(containerSelector))(function(container) {
      var containerTree = withChildren(withChild(withBehaviors(named(SVG.value)("svg")([width29(num22(svgWidth)), height29(num22(svgHeight)), viewBox(-svgWidth / 2)(-svgHeight / 2)(svgWidth)(svgHeight), attr27("id")(text27("network-force-svg")), attr27("class")(text27("network-force"))]))([new Zoom(defaultZoom(new ScaleExtent(0.1, 10))("#network-zoom-group"))]))(named(Group.value)("zoom-group")([attr27("id")(text27("network-zoom-group")), attr27("class")(text27("zoom-group"))])))([named(Group.value)("links")([attr27("id")(text27("network-links")), attr27("class")(text27("links"))]), named(Group.value)("nodes")([attr27("id")(text27("network-nodes")), attr27("class")(text27("nodes"))])]);
      return bind51(renderTree114(container)(containerTree))(function() {
        return pure34(unit);
      });
    }));
  };
  var opacityForRenderNode = function(rn) {
    var baseOpacity = 0.7 + rn.node.importance * 0.3;
    if (rn.exitProgress instanceof Just) {
      return lerp2(baseOpacity)(0)(rn.exitProgress.value0);
    }
    ;
    return baseOpacity;
  };
  var nodeRadius = function(node) {
    var importanceBonus = node.importance * 3;
    var baseSize = (function() {
      if (node.sizeClass === 0) {
        return 3;
      }
      ;
      if (node.sizeClass === 1) {
        return 5;
      }
      ;
      return 7;
    })();
    return baseSize + importanceBonus;
  };
  var radiusForRenderNode = function(rn) {
    var baseRadius = nodeRadius(rn.node);
    if (rn.enterProgress instanceof Just) {
      return lerp2(baseRadius * 3)(baseRadius)(rn.enterProgress.value0);
    }
    ;
    if (rn.exitProgress instanceof Just) {
      return lerp2(baseRadius)(baseRadius * 3)(rn.exitProgress.value0);
    }
    ;
    return baseRadius;
  };
  var linkTypeColors = ["#6baed6", "#fd8d3c", "#74c476", "#e377c2"];
  var linkTypeColor = function(t2) {
    return fromMaybe("#999")(index(linkTypeColors)(mod11(t2)(4)));
  };
  var forceIdName = function(v2) {
    if (v2 instanceof ForceCharge) {
      return "charge";
    }
    ;
    if (v2 instanceof ForceCollide) {
      return "collision";
    }
    ;
    if (v2 instanceof ForceLink) {
      return "links";
    }
    ;
    if (v2 instanceof ForceX) {
      return "forceX";
    }
    ;
    if (v2 instanceof ForceY) {
      return "forceY";
    }
    ;
    throw new Error("Failed pattern match at D3.Viz.ForcePlayground.Simple (line 123, column 15 - line 128, column 21): " + [v2.constructor.name]);
  };
  var eqForceId = {
    eq: function(x32) {
      return function(y32) {
        if (x32 instanceof ForceCharge && y32 instanceof ForceCharge) {
          return true;
        }
        ;
        if (x32 instanceof ForceCollide && y32 instanceof ForceCollide) {
          return true;
        }
        ;
        if (x32 instanceof ForceLink && y32 instanceof ForceLink) {
          return true;
        }
        ;
        if (x32 instanceof ForceX && y32 instanceof ForceX) {
          return true;
        }
        ;
        if (x32 instanceof ForceY && y32 instanceof ForceY) {
          return true;
        }
        ;
        return false;
      };
    }
  };
  var ordForceId = {
    compare: function(x32) {
      return function(y32) {
        if (x32 instanceof ForceCharge && y32 instanceof ForceCharge) {
          return EQ.value;
        }
        ;
        if (x32 instanceof ForceCharge) {
          return LT.value;
        }
        ;
        if (y32 instanceof ForceCharge) {
          return GT.value;
        }
        ;
        if (x32 instanceof ForceCollide && y32 instanceof ForceCollide) {
          return EQ.value;
        }
        ;
        if (x32 instanceof ForceCollide) {
          return LT.value;
        }
        ;
        if (y32 instanceof ForceCollide) {
          return GT.value;
        }
        ;
        if (x32 instanceof ForceLink && y32 instanceof ForceLink) {
          return EQ.value;
        }
        ;
        if (x32 instanceof ForceLink) {
          return LT.value;
        }
        ;
        if (y32 instanceof ForceLink) {
          return GT.value;
        }
        ;
        if (x32 instanceof ForceX && y32 instanceof ForceX) {
          return EQ.value;
        }
        ;
        if (x32 instanceof ForceX) {
          return LT.value;
        }
        ;
        if (y32 instanceof ForceX) {
          return GT.value;
        }
        ;
        if (x32 instanceof ForceY && y32 instanceof ForceY) {
          return EQ.value;
        }
        ;
        throw new Error("Failed pattern match at D3.Viz.ForcePlayground.Simple (line 0, column 0 - line 0, column 0): " + [x32.constructor.name, y32.constructor.name]);
      };
    },
    Eq0: function() {
      return eqForceId;
    }
  };
  var defaultForceY = {
    y: 0,
    strength: 0.1
  };
  var defaultForceX = {
    x: 0,
    strength: 0.1
  };
  var forceIdSpec = function(v2) {
    if (v2 instanceof ForceCharge) {
      return new ManyBody("charge", {
        theta: defaultManyBody.theta,
        distanceMin: defaultManyBody.distanceMin,
        strength: -30,
        distanceMax: 200
      });
    }
    ;
    if (v2 instanceof ForceCollide) {
      return new Collide("collision", {
        radius: 10,
        strength: 0.7,
        iterations: 1
      });
    }
    ;
    if (v2 instanceof ForceLink) {
      return new Link("links", {
        distance: 40,
        strength: 0.4,
        iterations: 1
      });
    }
    ;
    if (v2 instanceof ForceX) {
      return new PositionX("forceX", defaultForceX);
    }
    ;
    if (v2 instanceof ForceY) {
      return new PositionY("forceY", defaultForceY);
    }
    ;
    throw new Error("Failed pattern match at D3.Viz.ForcePlayground.Simple (line 140, column 15 - line 145, column 45): " + [v2.constructor.name]);
  };
  var createSimulationWithCallbacks = function(callbacks) {
    return function(model) {
      return function __do7() {
        var sim = createWithCallbacks(defaultConfig2)(callbacks)();
        setNodes(model.nodes)(sim)();
        setLinks(model.links)(sim)();
        addForce(forceIdSpec(ForceX.value))(sim)();
        addForce(forceIdSpec(ForceY.value))(sim)();
        addForce(forceIdSpec(ForceCharge.value))(sim)();
        addForce(forceIdSpec(ForceCollide.value))(sim)();
        addForce(forceIdSpec(ForceLink.value))(sim)();
        start3(sim)();
        return sim;
      };
    };
  };
  var createLinksTree = function(scene) {
    return sceneNestedJoin("links")("line")([scene])(function(v2) {
      return v2.links;
    })(function(link5) {
      return elem3(Line.value)([x18(num22(link5.source.x)), y19(num22(link5.source.y)), x22(num22(link5.target.x)), y22(num22(link5.target.y)), strokeWidth16(num22(0.5 + link5.weight * 2)), stroke17(text27(linkTypeColor(link5.linkType))), opacity7(num22(0.3 + link5.weight * 0.4))]);
    })({
      enterBehavior: Nothing.value,
      updateBehavior: Nothing.value,
      exitBehavior: Nothing.value
    });
  };
  var categoryColors = ["#1f77b4", "#ff7f0e", "#2ca02c", "#d62728", "#9467bd", "#8c564b", "#e377c2", "#7f7f7f", "#bcbd22", "#17becf"];
  var categoryColor = function(g2) {
    return fromMaybe("#69b3a2")(index(categoryColors)(mod11(g2)(10)));
  };
  var fillForRenderNode = function(rn) {
    if (rn.enterProgress instanceof Just) {
      return "#2ca02c";
    }
    ;
    if (rn.exitProgress instanceof Just) {
      return "#d62728";
    }
    ;
    return categoryColor(rn.node.group);
  };
  var createNodesTree = function(scene) {
    return sceneNestedJoin("nodes")("circle")([scene])(function(v2) {
      return v2.nodes;
    })(function(rn) {
      return elem3(Circle.value)([cx11(num22(rn.node.x)), cy11(num22(rn.node.y)), r13(num22(radiusForRenderNode(rn))), fill22(text27(fillForRenderNode(rn))), stroke17(text27(strokeForRenderNode(rn))), strokeWidth16(num22(strokeWidthForRenderNode(rn))), opacity7(num22(opacityForRenderNode(rn)))]);
    })({
      enterBehavior: Nothing.value,
      updateBehavior: Nothing.value,
      exitBehavior: Nothing.value
    });
  };
  var renderScene = function(scene) {
    return runD3v2M(bind51(select27("#network-links"))(function(linksGroup) {
      var linksTree = createLinksTree(scene);
      return bind51(renderTree214(linksGroup)(linksTree))(function() {
        return bind51(select27("#network-nodes"))(function(nodesGroup) {
          var nodesTree = createNodesTree(scene);
          return bind51(renderTree214(nodesGroup)(nodesTree))(function() {
            return pure34(unit);
          });
        });
      });
    }));
  };
  var buildSceneData = function(currentNodes) {
    return function(visibleIds) {
      return function(enteringProgress) {
        return function(exitingNodes) {
          return function(modelLinks) {
            var visibleNodes = filter(function(n) {
              return elem5(n.id)(visibleIds);
            })(currentNodes);
            var visibleLinks = filterLinksToSubset(function(v2) {
              return v2.id;
            })(visibleNodes)(modelLinks);
            var swizzledLinks = swizzleLinksByIndex(function(v2) {
              return v2.id;
            })(visibleNodes)(visibleLinks)(function(src10) {
              return function(tgt) {
                return function(i2) {
                  return function(link5) {
                    return {
                      source: src10,
                      target: tgt,
                      weight: link5.weight,
                      linkType: link5.linkType,
                      index: i2
                    };
                  };
                };
              };
            });
            var renderNodes = map70(function(n) {
              return {
                node: n,
                enterProgress: lookup24(n.id)(enteringProgress),
                exitProgress: Nothing.value
              };
            })(visibleNodes);
            var exitingRenderNodes = map70(function(e) {
              return {
                node: e.item,
                enterProgress: Nothing.value,
                exitProgress: new Just(e.progress)
              };
            })(exitingNodes);
            var allRenderNodes = append28(renderNodes)(exitingRenderNodes);
            return {
              nodes: allRenderNodes,
              links: swizzledLinks
            };
          };
        };
      };
    };
  };
  var allForces = /* @__PURE__ */ (function() {
    return fromFoldable20(foldableArray)(ordForceId)([ForceX.value, ForceY.value, ForceCharge.value, ForceCollide.value, ForceLink.value]);
  })();

  // output/PSD3.ForceEngine.Events/index.js
  var pure35 = /* @__PURE__ */ pure(applicativeEffect);
  var Tick = /* @__PURE__ */ (function() {
    function Tick3() {
    }
    ;
    Tick3.value = new Tick3();
    return Tick3;
  })();
  var Started = /* @__PURE__ */ (function() {
    function Started2() {
    }
    ;
    Started2.value = new Started2();
    return Started2;
  })();
  var Stopped = /* @__PURE__ */ (function() {
    function Stopped2() {
    }
    ;
    Stopped2.value = new Stopped2();
    return Stopped2;
  })();
  var AlphaDecayed = /* @__PURE__ */ (function() {
    function AlphaDecayed2(value0) {
      this.value0 = value0;
    }
    ;
    AlphaDecayed2.create = function(value0) {
      return new AlphaDecayed2(value0);
    };
    return AlphaDecayed2;
  })();
  var defaultCallbacks = function __do4() {
    var tickRef = $$new(pure35(unit))();
    var startRef = $$new(pure35(unit))();
    var stopRef = $$new(pure35(unit))();
    var alphaRef = $$new(function(v2) {
      return pure35(unit);
    })();
    return {
      onTick: tickRef,
      onStart: startRef,
      onStop: stopRef,
      onAlphaThreshold: alphaRef
    };
  };

  // output/PSD3.ForceEngine.Halogen/index.js
  var wireUpCallbacks = function(listener) {
    return function(cbs) {
      return function __do7() {
        write(notify(listener)(Tick.value))(cbs.onTick)();
        write(notify(listener)(Started.value))(cbs.onStart)();
        write(notify(listener)(Stopped.value))(cbs.onStop)();
        return write(function(alpha) {
          return notify(listener)(new AlphaDecayed(alpha));
        })(cbs.onAlphaThreshold)();
      };
    };
  };
  var subscribeToSimulation = function(sim) {
    return function __do7() {
      var v2 = create4();
      (function() {
        var v1 = getCallbacks(sim);
        if (v1 instanceof Nothing) {
          return unit;
        }
        ;
        if (v1 instanceof Just) {
          return wireUpCallbacks(v2.listener)(v1.value0)();
        }
        ;
        throw new Error("Failed pattern match at PSD3.ForceEngine.Halogen (line 60, column 3 - line 62, column 45): " + [v1.constructor.name]);
      })();
      return v2.emitter;
    };
  };

  // output/Component.ForcePlayground/index.js
  var fromFoldable26 = /* @__PURE__ */ fromFoldable20(foldableArray);
  var fromFoldable112 = /* @__PURE__ */ fromFoldable26(ordForceId);
  var member4 = /* @__PURE__ */ member2(ordForceId);
  var append29 = /* @__PURE__ */ append(semigroupArray);
  var bind52 = /* @__PURE__ */ bind(bindHalogenM);
  var get9 = /* @__PURE__ */ get(monadStateHalogenM);
  var fromFoldable27 = /* @__PURE__ */ fromFoldable3(foldableSet);
  var pure36 = /* @__PURE__ */ pure(applicativeHalogenM);
  var member1 = /* @__PURE__ */ member2(ordInt);
  var fromFoldable32 = /* @__PURE__ */ fromFoldable26(ordInt);
  var tickProgressMap2 = /* @__PURE__ */ tickProgressMap(ordInt);
  var discard32 = /* @__PURE__ */ discard(discardUnit)(bindHalogenM);
  var modify_6 = /* @__PURE__ */ modify_(monadStateHalogenM);
  var show48 = /* @__PURE__ */ show(showInt);
  var $$void10 = /* @__PURE__ */ $$void(functorHalogenM);
  var mapFlipped6 = /* @__PURE__ */ mapFlipped(functorEmitter);
  var map71 = /* @__PURE__ */ map(functorArray);
  var $$delete6 = /* @__PURE__ */ $$delete5(ordForceId);
  var insert11 = /* @__PURE__ */ insert9(ordForceId);
  var void1 = /* @__PURE__ */ $$void(functorEffect);
  var foldM4 = /* @__PURE__ */ foldM(monadEffect);
  var voidLeft3 = /* @__PURE__ */ voidLeft(functorEffect);
  var difference4 = /* @__PURE__ */ difference3(ordForceId);
  var toUnfoldable7 = /* @__PURE__ */ toUnfoldable5(unfoldableArray);
  var delete1 = /* @__PURE__ */ $$delete5(ordInt);
  var insert13 = /* @__PURE__ */ insert9(ordInt);
  var difference1 = /* @__PURE__ */ difference3(ordInt);
  var startProgress2 = /* @__PURE__ */ startProgress(ordInt);
  var notEq4 = /* @__PURE__ */ notEq(/* @__PURE__ */ eqSet(eqInt));
  var PresetStandard = /* @__PURE__ */ (function() {
    function PresetStandard2() {
    }
    ;
    PresetStandard2.value = new PresetStandard2();
    return PresetStandard2;
  })();
  var PresetClustered = /* @__PURE__ */ (function() {
    function PresetClustered2() {
    }
    ;
    PresetClustered2.value = new PresetClustered2();
    return PresetClustered2;
  })();
  var PresetMinimal = /* @__PURE__ */ (function() {
    function PresetMinimal2() {
    }
    ;
    PresetMinimal2.value = new PresetMinimal2();
    return PresetMinimal2;
  })();
  var Initialize4 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var Finalize2 = /* @__PURE__ */ (function() {
    function Finalize6() {
    }
    ;
    Finalize6.value = new Finalize6();
    return Finalize6;
  })();
  var SimTick = /* @__PURE__ */ (function() {
    function SimTick3() {
    }
    ;
    SimTick3.value = new SimTick3();
    return SimTick3;
  })();
  var RegenerateGraph = /* @__PURE__ */ (function() {
    function RegenerateGraph2() {
    }
    ;
    RegenerateGraph2.value = new RegenerateGraph2();
    return RegenerateGraph2;
  })();
  var ToggleForce = /* @__PURE__ */ (function() {
    function ToggleForce2(value0) {
      this.value0 = value0;
    }
    ;
    ToggleForce2.create = function(value0) {
      return new ToggleForce2(value0);
    };
    return ToggleForce2;
  })();
  var ApplyPreset = /* @__PURE__ */ (function() {
    function ApplyPreset2(value0) {
      this.value0 = value0;
    }
    ;
    ApplyPreset2.create = function(value0) {
      return new ApplyPreset2(value0);
    };
    return ApplyPreset2;
  })();
  var ToggleCategory = /* @__PURE__ */ (function() {
    function ToggleCategory2(value0) {
      this.value0 = value0;
    }
    ;
    ToggleCategory2.create = function(value0) {
      return new ToggleCategory2(value0);
    };
    return ToggleCategory2;
  })();
  var ShowAllCategories = /* @__PURE__ */ (function() {
    function ShowAllCategories2() {
    }
    ;
    ShowAllCategories2.value = new ShowAllCategories2();
    return ShowAllCategories2;
  })();
  var presetTooltip = function(v2) {
    if (v2 instanceof PresetStandard) {
      return "All forces enabled - balanced layout";
    }
    ;
    if (v2 instanceof PresetClustered) {
      return "No centering - clusters float freely";
    }
    ;
    if (v2 instanceof PresetMinimal) {
      return "Links and collision only - organic shapes";
    }
    ;
    throw new Error("Failed pattern match at Component.ForcePlayground (line 64, column 17 - line 67, column 63): " + [v2.constructor.name]);
  };
  var presetLabel = function(v2) {
    if (v2 instanceof PresetStandard) {
      return "Standard";
    }
    ;
    if (v2 instanceof PresetClustered) {
      return "Clustered";
    }
    ;
    if (v2 instanceof PresetMinimal) {
      return "Minimal";
    }
    ;
    throw new Error("Failed pattern match at Component.ForcePlayground (line 58, column 15 - line 61, column 29): " + [v2.constructor.name]);
  };
  var presetForces = function(v2) {
    if (v2 instanceof PresetStandard) {
      return allForces;
    }
    ;
    if (v2 instanceof PresetClustered) {
      return fromFoldable112([ForceCharge.value, ForceCollide.value, ForceLink.value]);
    }
    ;
    if (v2 instanceof PresetMinimal) {
      return fromFoldable112([ForceCollide.value, ForceLink.value]);
    }
    ;
    throw new Error("Failed pattern match at Component.ForcePlayground (line 70, column 16 - line 73, column 62): " + [v2.constructor.name]);
  };
  var forceToggle = function(state3) {
    return function(forceId) {
      return function(label5) {
        var isEnabled = member4(forceId)(state3.enabledForces);
        return button2([classes(append29(["toggle-button"])((function() {
          if (isEnabled) {
            return ["toggle-button--on"];
          }
          ;
          return ["toggle-button--off"];
        })())), onClick(function(v2) {
          return new ToggleForce(forceId);
        })])([text5(label5)]);
      };
    };
  };
  var eqForcePreset = {
    eq: function(x32) {
      return function(y32) {
        if (x32 instanceof PresetStandard && y32 instanceof PresetStandard) {
          return true;
        }
        ;
        if (x32 instanceof PresetClustered && y32 instanceof PresetClustered) {
          return true;
        }
        ;
        if (x32 instanceof PresetMinimal && y32 instanceof PresetMinimal) {
          return true;
        }
        ;
        return false;
      };
    }
  };
  var eq7 = /* @__PURE__ */ eq(/* @__PURE__ */ eqMaybe(eqForcePreset));
  var presetButton = function(state3) {
    return function(preset) {
      var isActive = eq7(state3.activePreset)(new Just(preset));
      return button2([classes(append29(["control-button"])((function() {
        if (isActive) {
          return ["control-button--active"];
        }
        ;
        return [];
      })())), title2(presetTooltip(preset)), onClick(function(v2) {
        return new ApplyPreset(preset);
      })])([text5(presetLabel(preset))]);
    };
  };
  var doRender = function(dictMonadAff) {
    var liftEffect54 = liftEffect(monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    return bind52(get9)(function(state3) {
      if (state3.simulation instanceof Just && state3.model instanceof Just) {
        return liftEffect54(function __do7() {
          var currentNodes = getNodes(state3.simulation.value0)();
          var visibleIds = fromFoldable27(state3.visibleNodeIds);
          var scene = buildSceneData(currentNodes)(visibleIds)(state3.enteringProgress)(state3.exitingNodes)(state3.model.value0.links);
          return renderScene(scene)();
        });
      }
      ;
      return pure36(unit);
    });
  };
  var categoryToggle = function(state3) {
    return function(catId) {
      return function(label5) {
        return function(color2) {
          var isVisible = member1(catId)(state3.shownCategories);
          return button2([classes(append29(["category-button"])((function() {
            if (isVisible) {
              return ["category-button--active"];
            }
            ;
            return ["category-button--inactive"];
          })())), style("border-color: " + (color2 + ("; " + (function() {
            if (isVisible) {
              return "background-color: " + (color2 + ";");
            }
            ;
            return "";
          })()))), title2("Toggle " + (label5 + " nodes")), onClick(function(v2) {
            return new ToggleCategory(catId);
          })])([text5(label5)]);
        };
      };
    };
  };
  var allCategories = /* @__PURE__ */ fromFoldable32([0, 1, 2, 3]);
  var handleAction3 = function(dictMonadAff) {
    var liftEffect54 = liftEffect(monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    var doRender1 = doRender(dictMonadAff);
    return function(v2) {
      if (v2 instanceof Initialize4) {
        return handleAction3(dictMonadAff)(RegenerateGraph.value);
      }
      ;
      if (v2 instanceof Finalize2) {
        return pure36(unit);
      }
      ;
      if (v2 instanceof SimTick) {
        return bind52(get9)(function(state3) {
          if (state3.simulation instanceof Just && state3.model instanceof Just) {
            var v1 = tickProgressMap2(transitionDelta)(state3.enteringProgress);
            var v22 = tickTransitions(transitionDelta)(state3.exitingNodes);
            return discard32(modify_6(function(v3) {
              var $91 = {};
              for (var $92 in v3) {
                if ({}.hasOwnProperty.call(v3, $92)) {
                  $91[$92] = v3[$92];
                }
                ;
              }
              ;
              $91.enteringProgress = v1.active;
              $91.exitingNodes = v22.active;
              return $91;
            }))(function() {
              return liftEffect54(function __do7() {
                var currentNodes = getNodes(state3.simulation.value0)();
                var visibleIds = fromFoldable27(state3.visibleNodeIds);
                var scene = buildSceneData(currentNodes)(visibleIds)(v1.active)(v22.active)(state3.model.value0.links);
                return renderScene(scene)();
              });
            });
          }
          ;
          return pure36(unit);
        });
      }
      ;
      if (v2 instanceof RegenerateGraph) {
        return discard32(liftEffect54(clearContainer("#force-playground-container")))(function() {
          return discard32(liftEffect54(log2("Generating random network...")))(function() {
            return bind52(liftEffect54(generateGraph(defaultConfig3)))(function(generated) {
              var model = fromGeneratedGraph(generated);
              return discard32(liftEffect54(log2("Generated: " + (show48(length3(model.nodes)) + (" nodes, " + (show48(length3(model.links)) + " links"))))))(function() {
                return bind52(liftEffect54(defaultCallbacks))(function(callbacks) {
                  return bind52(liftEffect54(createSimulationWithCallbacks(callbacks)(model)))(function(simulation) {
                    return discard32(liftEffect54(renderSVGContainer("#force-playground-container")))(function() {
                      return bind52(liftEffect54(subscribeToSimulation(simulation)))(function(emitter) {
                        return discard32($$void10(subscribe2(mapFlipped6(emitter)(function(event) {
                          if (event instanceof Tick) {
                            return SimTick.value;
                          }
                          ;
                          return SimTick.value;
                        }))))(function() {
                          var allNodeIds = fromFoldable32(map71(function(v1) {
                            return v1.id;
                          })(model.nodes));
                          return discard32(modify_6(function(v1) {
                            var $99 = {};
                            for (var $100 in v1) {
                              if ({}.hasOwnProperty.call(v1, $100)) {
                                $99[$100] = v1[$100];
                              }
                              ;
                            }
                            ;
                            $99.model = new Just(model);
                            $99.simulation = new Just(simulation);
                            $99.enabledForces = allForces;
                            $99.activePreset = new Just(PresetStandard.value);
                            $99.shownCategories = allCategories;
                            $99.visibleNodeIds = allNodeIds;
                            $99.enteringProgress = empty4;
                            $99.exitingNodes = [];
                            return $99;
                          }))(function() {
                            return doRender1;
                          });
                        });
                      });
                    });
                  });
                });
              });
            });
          });
        });
      }
      ;
      if (v2 instanceof ToggleForce) {
        return bind52(get9)(function(state3) {
          if (state3.simulation instanceof Nothing) {
            return pure36(unit);
          }
          ;
          if (state3.simulation instanceof Just) {
            var isEnabled = member4(v2.value0)(state3.enabledForces);
            return discard32((function() {
              if (isEnabled) {
                return discard32(liftEffect54(removeForce(forceIdName(v2.value0))(state3.simulation.value0)))(function() {
                  return modify_6(function(v1) {
                    var $104 = {};
                    for (var $105 in v1) {
                      if ({}.hasOwnProperty.call(v1, $105)) {
                        $104[$105] = v1[$105];
                      }
                      ;
                    }
                    ;
                    $104.enabledForces = $$delete6(v2.value0)(state3.enabledForces);
                    $104.activePreset = Nothing.value;
                    return $104;
                  });
                });
              }
              ;
              return discard32(liftEffect54(addForce(forceIdSpec(v2.value0))(state3.simulation.value0)))(function() {
                return modify_6(function(v1) {
                  var $107 = {};
                  for (var $108 in v1) {
                    if ({}.hasOwnProperty.call(v1, $108)) {
                      $107[$108] = v1[$108];
                    }
                    ;
                  }
                  ;
                  $107.enabledForces = insert11(v2.value0)(state3.enabledForces);
                  $107.activePreset = Nothing.value;
                  return $107;
                });
              });
            })())(function() {
              return liftEffect54(reheat(state3.simulation.value0));
            });
          }
          ;
          throw new Error("Failed pattern match at Component.ForcePlayground (line 358, column 5 - line 369, column 36): " + [state3.simulation.constructor.name]);
        });
      }
      ;
      if (v2 instanceof ApplyPreset) {
        var traverse_10 = function(f) {
          var $135 = foldM4(function(v1) {
            return function(a3) {
              return voidLeft3(f(a3))(unit);
            };
          })(unit);
          return function($136) {
            return void1($135($136));
          };
        };
        return bind52(get9)(function(state3) {
          if (state3.simulation instanceof Nothing) {
            return pure36(unit);
          }
          ;
          if (state3.simulation instanceof Just) {
            var targetForces = presetForces(v2.value0);
            var toRemove = difference4(state3.enabledForces)(targetForces);
            return discard32(liftEffect54(traverse_10(function(f) {
              return removeForce(forceIdName(f))(state3.simulation.value0);
            })(toUnfoldable7(toRemove))))(function() {
              var toAdd = difference4(targetForces)(state3.enabledForces);
              return discard32(liftEffect54(traverse_10(function(f) {
                return addForce(forceIdSpec(f))(state3.simulation.value0);
              })(toUnfoldable7(toAdd))))(function() {
                return discard32(liftEffect54(reheat(state3.simulation.value0)))(function() {
                  return modify_6(function(v1) {
                    var $113 = {};
                    for (var $114 in v1) {
                      if ({}.hasOwnProperty.call(v1, $114)) {
                        $113[$114] = v1[$114];
                      }
                      ;
                    }
                    ;
                    $113.enabledForces = targetForces;
                    $113.activePreset = new Just(v2.value0);
                    return $113;
                  });
                });
              });
            });
          }
          ;
          throw new Error("Failed pattern match at Component.ForcePlayground (line 373, column 5 - line 388, column 81): " + [state3.simulation.constructor.name]);
        });
      }
      ;
      if (v2 instanceof ToggleCategory) {
        return bind52(get9)(function(state3) {
          if (state3.simulation instanceof Just && state3.model instanceof Just) {
            var isCurrentlyShown = member1(v2.value0)(state3.shownCategories);
            var newShownCategories = (function() {
              if (isCurrentlyShown) {
                return delete1(v2.value0)(state3.shownCategories);
              }
              ;
              return insert13(v2.value0)(state3.shownCategories);
            })();
            var newVisibleIds = fromFoldable32(map71(function(v1) {
              return v1.id;
            })(filter(function(n) {
              return member1(n.group)(newShownCategories);
            })(state3.model.value0.nodes)));
            var removedIds = difference1(state3.visibleNodeIds)(newVisibleIds);
            return bind52(liftEffect54(getNodes(state3.simulation.value0)))(function(currentNodes) {
              var removedNodes = filter(function(n) {
                return member1(n.id)(removedIds);
              })(currentNodes);
              var newExiting = startTransitions(removedNodes);
              var addedIds = difference1(newVisibleIds)(state3.visibleNodeIds);
              var newEntering = startProgress2(fromFoldable27(addedIds))(state3.enteringProgress);
              return discard32(liftEffect54(reheat(state3.simulation.value0)))(function() {
                return modify_6(function(v1) {
                  var $121 = {};
                  for (var $122 in v1) {
                    if ({}.hasOwnProperty.call(v1, $122)) {
                      $121[$122] = v1[$122];
                    }
                    ;
                  }
                  ;
                  $121.shownCategories = newShownCategories;
                  $121.visibleNodeIds = newVisibleIds;
                  $121.enteringProgress = newEntering;
                  $121.exitingNodes = append29(state3.exitingNodes)(newExiting);
                  return $121;
                });
              });
            });
          }
          ;
          return pure36(unit);
        });
      }
      ;
      if (v2 instanceof ShowAllCategories) {
        return bind52(get9)(function(state3) {
          if (state3.simulation instanceof Just && state3.model instanceof Just) {
            var allNodeIds = fromFoldable32(map71(function(v1) {
              return v1.id;
            })(state3.model.value0.nodes));
            var addedIds = difference1(allNodeIds)(state3.visibleNodeIds);
            var newEntering = startProgress2(fromFoldable27(addedIds))(state3.enteringProgress);
            return discard32(liftEffect54(reheat(state3.simulation.value0)))(function() {
              return modify_6(function(v1) {
                var $129 = {};
                for (var $130 in v1) {
                  if ({}.hasOwnProperty.call(v1, $130)) {
                    $129[$130] = v1[$130];
                  }
                  ;
                }
                ;
                $129.shownCategories = allCategories;
                $129.visibleNodeIds = allNodeIds;
                $129.enteringProgress = newEntering;
                return $129;
              });
            });
          }
          ;
          return pure36(unit);
        });
      }
      ;
      throw new Error("Failed pattern match at Component.ForcePlayground (line 277, column 16 - line 445, column 24): " + [v2.constructor.name]);
    };
  };
  var renderControlPanel = function(state3) {
    return div2([classes(["floating-panel", "floating-panel--top-right", "floating-panel--medium", "force-playground-panel"])])([h2([classes(["floating-panel__title"])])([text5("Controls")]), div2([classes(["control-group"])])([h4_([text5("Network")]), button2([classes(["control-button", "control-button--secondary"]), onClick(function(v2) {
      return RegenerateGraph.value;
    })])([text5("Regenerate")]), p([classes(["control-description"])])([text5("Generate a new random network with clusters")])]), div2([classes(["control-group"])])([h4_([text5("Presets")]), div2([classes(["button-row"])])([presetButton(state3)(PresetStandard.value), presetButton(state3)(PresetClustered.value), presetButton(state3)(PresetMinimal.value)])]), div2([classes(["control-group"])])([h4_([text5("Forces")]), div2([classes(["toggle-grid"])])([forceToggle(state3)(ForceCharge.value)("Charge"), forceToggle(state3)(ForceCollide.value)("Collide"), forceToggle(state3)(ForceLink.value)("Links"), forceToggle(state3)(ForceX.value)("X Center"), forceToggle(state3)(ForceY.value)("Y Center")])]), div2([classes(["control-group"])])([h4_([text5("Filter Categories")]), div2([classes(["category-filters"])])([categoryToggle(state3)(0)("Research")("#1f77b4"), categoryToggle(state3)(1)("Industry")("#ff7f0e"), categoryToggle(state3)(2)("Government")("#2ca02c"), categoryToggle(state3)(3)("Community")("#d62728")]), (function() {
      var $134 = notEq4(state3.shownCategories)(allCategories);
      if ($134) {
        return button2([classes(["control-button", "control-button--link"]), onClick(function(v2) {
          return ShowAllCategories.value;
        })])([text5("Show All")]);
      }
      ;
      return text5("");
    })()]), div2([classes(["panel-info-box"])])([p_([text5("Scroll to zoom, drag to pan.")]), p_([text5("Click-drag nodes to pin them.")]), p_([text5("Tiny drag to unpin.")])])]);
  };
  var render8 = function(state3) {
    return div2([classes(["force-playground-page"])])([render4({
      logoSize: Normal.value,
      quadrant: NoQuadrant.value,
      prevNext: Nothing.value,
      pageTitle: new Just("Force Playground")
    }), div2([classes(["fullscreen-container", "force-playground-viz"])])([div2([id3("force-playground-container"), classes(["fullscreen-viz", "svg-container"])])([]), renderControlPanel(state3)])]);
  };
  var component4 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return {
          model: Nothing.value,
          simulation: Nothing.value,
          enabledForces: allForces,
          activePreset: new Just(PresetStandard.value),
          shownCategories: allCategories,
          visibleNodeIds: empty8,
          enteringProgress: empty4,
          exitingNodes: []
        };
      },
      render: render8,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        handleAction: handleAction3(dictMonadAff),
        initialize: new Just(Initialize4.value),
        finalize: new Just(Finalize2.value)
      })
    });
  };

  // output/PSD3.ForceEngine.Setup/index.js
  var map72 = /* @__PURE__ */ map(functorArray);
  var $$delete7 = /* @__PURE__ */ $$delete2(ordString);
  var pure37 = /* @__PURE__ */ pure(applicativeEffect);
  var fromFoldable28 = /* @__PURE__ */ fromFoldable20(foldableArray);
  var fromFoldable113 = /* @__PURE__ */ fromFoldable28(ordInt);
  var member5 = /* @__PURE__ */ member2(ordInt);
  var fromFoldable29 = /* @__PURE__ */ fromFoldable6(ordInt)(foldableArray);
  var lookup25 = /* @__PURE__ */ lookup(ordInt);
  var ordTuple3 = /* @__PURE__ */ ordTuple(ordInt)(ordInt);
  var fromFoldable33 = /* @__PURE__ */ fromFoldable28(ordTuple3);
  var difference5 = /* @__PURE__ */ difference3(ordTuple3);
  var member12 = /* @__PURE__ */ member2(ordTuple3);
  var intersection3 = /* @__PURE__ */ intersection2(ordTuple3);
  var fromFoldable42 = /* @__PURE__ */ fromFoldable28(ordString);
  var fromFoldable52 = /* @__PURE__ */ fromFoldable20(foldableSet)(ordString);
  var difference12 = /* @__PURE__ */ difference3(ordString);
  var for_5 = /* @__PURE__ */ for_(applicativeEffect)(foldableArray);
  var toUnfoldable8 = /* @__PURE__ */ toUnfoldable5(unfoldableArray);
  var insert14 = /* @__PURE__ */ insert(ordString);
  var Static = /* @__PURE__ */ (function() {
    function Static2(value0) {
      this.value0 = value0;
    }
    ;
    Static2.create = function(value0) {
      return new Static2(value0);
    };
    return Static2;
  })();
  var Dynamic = /* @__PURE__ */ (function() {
    function Dynamic2(value0) {
      this.value0 = value0;
    }
    ;
    Dynamic2.create = function(value0) {
      return new Dynamic2(value0);
    };
    return Dynamic2;
  })();
  var ForceManyBody = /* @__PURE__ */ (function() {
    function ForceManyBody2() {
    }
    ;
    ForceManyBody2.value = new ForceManyBody2();
    return ForceManyBody2;
  })();
  var ForceCollide2 = /* @__PURE__ */ (function() {
    function ForceCollide3() {
    }
    ;
    ForceCollide3.value = new ForceCollide3();
    return ForceCollide3;
  })();
  var ForceLink2 = /* @__PURE__ */ (function() {
    function ForceLink3() {
    }
    ;
    ForceLink3.value = new ForceLink3();
    return ForceLink3;
  })();
  var ForceCenter = /* @__PURE__ */ (function() {
    function ForceCenter2() {
    }
    ;
    ForceCenter2.value = new ForceCenter2();
    return ForceCenter2;
  })();
  var ForcePositionX = /* @__PURE__ */ (function() {
    function ForcePositionX2() {
    }
    ;
    ForcePositionX2.value = new ForcePositionX2();
    return ForcePositionX2;
  })();
  var ForcePositionY = /* @__PURE__ */ (function() {
    function ForcePositionY2() {
    }
    ;
    ForcePositionY2.value = new ForcePositionY2();
    return ForcePositionY2;
  })();
  var ForceRadial = /* @__PURE__ */ (function() {
    function ForceRadial2() {
    }
    ;
    ForceRadial2.value = new ForceRadial2();
    return ForceRadial2;
  })();
  var withY = function(v2) {
    return function(fc) {
      return {
        name: fc.name,
        forceType: fc.forceType,
        strength: fc.strength,
        radius: fc.radius,
        x: fc.x,
        distance: fc.distance,
        theta: fc.theta,
        distanceMin: fc.distanceMin,
        distanceMax: fc.distanceMax,
        iterations: fc.iterations,
        filter: fc.filter,
        y: v2
      };
    };
  };
  var withX = function(v2) {
    return function(fc) {
      return {
        name: fc.name,
        forceType: fc.forceType,
        strength: fc.strength,
        radius: fc.radius,
        y: fc.y,
        distance: fc.distance,
        theta: fc.theta,
        distanceMin: fc.distanceMin,
        distanceMax: fc.distanceMax,
        iterations: fc.iterations,
        filter: fc.filter,
        x: v2
      };
    };
  };
  var withStrength = function(v2) {
    return function(fc) {
      return {
        name: fc.name,
        forceType: fc.forceType,
        radius: fc.radius,
        x: fc.x,
        y: fc.y,
        distance: fc.distance,
        theta: fc.theta,
        distanceMin: fc.distanceMin,
        distanceMax: fc.distanceMax,
        iterations: fc.iterations,
        filter: fc.filter,
        strength: v2
      };
    };
  };
  var withRadius = function(v2) {
    return function(fc) {
      return {
        name: fc.name,
        forceType: fc.forceType,
        strength: fc.strength,
        x: fc.x,
        y: fc.y,
        distance: fc.distance,
        theta: fc.theta,
        distanceMin: fc.distanceMin,
        distanceMax: fc.distanceMax,
        iterations: fc.iterations,
        filter: fc.filter,
        radius: v2
      };
    };
  };
  var withDistanceMax = function(v2) {
    return function(fc) {
      return {
        name: fc.name,
        forceType: fc.forceType,
        strength: fc.strength,
        radius: fc.radius,
        x: fc.x,
        y: fc.y,
        distance: fc.distance,
        theta: fc.theta,
        distanceMin: fc.distanceMin,
        iterations: fc.iterations,
        filter: fc.filter,
        distanceMax: v2
      };
    };
  };
  var withDistance = function(v2) {
    return function(fc) {
      return {
        name: fc.name,
        forceType: fc.forceType,
        strength: fc.strength,
        radius: fc.radius,
        x: fc.x,
        y: fc.y,
        theta: fc.theta,
        distanceMin: fc.distanceMin,
        distanceMax: fc.distanceMax,
        iterations: fc.iterations,
        filter: fc.filter,
        distance: v2
      };
    };
  };
  var valueToNumber = function(v2) {
    if (v2 instanceof Static) {
      return v2.value0;
    }
    ;
    if (v2 instanceof Dynamic) {
      return 0;
    }
    ;
    throw new Error("Failed pattern match at PSD3.ForceEngine.Setup (line 121, column 1 - line 121, column 58): " + [v2.constructor.name]);
  };
  var $$static = /* @__PURE__ */ (function() {
    return Static.create;
  })();
  var mergeSimulationState = function(current) {
    return function(desired) {
      var $74 = {};
      for (var $75 in desired) {
        if ({}.hasOwnProperty.call(desired, $75)) {
          $74[$75] = desired[$75];
        }
        ;
      }
      ;
      $74.x = current.x;
      $74.y = current.y;
      $74.vx = current.vx;
      $74.vy = current.vy;
      $74.fx = current.fx;
      $74.fy = current.fy;
      return $74;
    };
  };
  var defaultParams = {
    alpha: 1,
    alphaMin: 1e-3,
    alphaDecay: 0.01,
    alphaTarget: 0,
    velocityDecay: 0.4
  };
  var setup = function(name16) {
    return function(forces) {
      return {
        name: name16,
        forces,
        params: defaultParams
      };
    };
  };
  var defaultForceConfig = function(name16) {
    return function(forceType) {
      return {
        name: name16,
        forceType,
        strength: new Static(1),
        radius: new Static(1),
        x: new Static(0),
        y: new Static(0),
        distance: new Static(30),
        theta: 0.9,
        distanceMin: 1,
        distanceMax: 1e10,
        iterations: 1,
        filter: Nothing.value
      };
    };
  };
  var link2 = function(name16) {
    return defaultForceConfig(name16)(ForceLink2.value);
  };
  var manyBody = function(name16) {
    var v2 = defaultForceConfig(name16)(ForceManyBody.value);
    return {
      name: v2.name,
      forceType: v2.forceType,
      radius: v2.radius,
      x: v2.x,
      y: v2.y,
      distance: v2.distance,
      theta: v2.theta,
      distanceMin: v2.distanceMin,
      distanceMax: v2.distanceMax,
      iterations: v2.iterations,
      filter: v2.filter,
      strength: new Static(-30)
    };
  };
  var createForceHandle = function(fc) {
    return pure37((function() {
      if (fc.forceType instanceof ForceManyBody) {
        if (fc.filter instanceof Just) {
          return createManyBodyFiltered({
            strength: valueToNumber(fc.strength),
            theta: fc.theta,
            distanceMin: fc.distanceMin,
            distanceMax: fc.distanceMax,
            filter: fc.filter.value0
          });
        }
        ;
        if (fc.filter instanceof Nothing) {
          return createManyBody({
            strength: valueToNumber(fc.strength),
            theta: fc.theta,
            distanceMin: fc.distanceMin,
            distanceMax: fc.distanceMax
          });
        }
        ;
        throw new Error("Failed pattern match at PSD3.ForceEngine.Setup (line 433, column 20 - line 448, column 8): " + [fc.filter.constructor.name]);
      }
      ;
      if (fc.forceType instanceof ForceCollide2) {
        if (fc.radius instanceof Static) {
          return createCollide({
            radius: fc.radius.value0,
            strength: valueToNumber(fc.strength),
            iterations: fc.iterations
          });
        }
        ;
        if (fc.radius instanceof Dynamic) {
          return createCollideDynamic({
            radiusAccessor: fc.radius.value0,
            strength: valueToNumber(fc.strength),
            iterations: fc.iterations
          });
        }
        ;
        throw new Error("Failed pattern match at PSD3.ForceEngine.Setup (line 450, column 19 - line 460, column 8): " + [fc.radius.constructor.name]);
      }
      ;
      if (fc.forceType instanceof ForceLink2) {
        return createLink({
          distance: valueToNumber(fc.distance),
          strength: valueToNumber(fc.strength),
          iterations: fc.iterations
        });
      }
      ;
      if (fc.forceType instanceof ForceCenter) {
        return createCenter({
          x: valueToNumber(fc.x),
          y: valueToNumber(fc.y),
          strength: valueToNumber(fc.strength)
        });
      }
      ;
      if (fc.forceType instanceof ForcePositionX) {
        if (fc.x instanceof Static) {
          return createForceX({
            x: fc.x.value0,
            strength: valueToNumber(fc.strength)
          });
        }
        ;
        if (fc.x instanceof Dynamic) {
          return createForceXDynamic({
            xAccessor: fc.x.value0,
            strength: valueToNumber(fc.strength)
          });
        }
        ;
        throw new Error("Failed pattern match at PSD3.ForceEngine.Setup (line 476, column 21 - line 484, column 8): " + [fc.x.constructor.name]);
      }
      ;
      if (fc.forceType instanceof ForcePositionY) {
        if (fc.y instanceof Static) {
          return createForceY({
            y: fc.y.value0,
            strength: valueToNumber(fc.strength)
          });
        }
        ;
        if (fc.y instanceof Dynamic) {
          return createForceYDynamic({
            yAccessor: fc.y.value0,
            strength: valueToNumber(fc.strength)
          });
        }
        ;
        throw new Error("Failed pattern match at PSD3.ForceEngine.Setup (line 486, column 21 - line 494, column 8): " + [fc.y.constructor.name]);
      }
      ;
      if (fc.forceType instanceof ForceRadial) {
        if (fc.filter instanceof Just) {
          return createRadialFiltered({
            radius: valueToNumber(fc.radius),
            x: valueToNumber(fc.x),
            y: valueToNumber(fc.y),
            strength: valueToNumber(fc.strength),
            filter: fc.filter.value0
          });
        }
        ;
        if (fc.filter instanceof Nothing) {
          return createRadial({
            radius: valueToNumber(fc.radius),
            x: valueToNumber(fc.x),
            y: valueToNumber(fc.y),
            strength: valueToNumber(fc.strength)
          });
        }
        ;
        throw new Error("Failed pattern match at PSD3.ForceEngine.Setup (line 496, column 18 - line 511, column 8): " + [fc.filter.constructor.name]);
      }
      ;
      throw new Error("Failed pattern match at PSD3.ForceEngine.Setup (line 432, column 31 - line 511, column 8): " + [fc.forceType.constructor.name]);
    })());
  };
  var computeNodeGUP = function(currentNodes) {
    return function(desiredNodes) {
      var desiredIds = fromFoldable113(map72(function(v2) {
        return v2.id;
      })(desiredNodes));
      var exited = filter(function(n) {
        return !member5(n.id)(desiredIds);
      })(currentNodes);
      var currentById = fromFoldable29(map72(function(n) {
        return new Tuple(n.id, n);
      })(currentNodes));
      var processDesired = function(desired) {
        var v2 = lookup25(desired.id)(currentById);
        if (v2 instanceof Nothing) {
          return {
            node: desired,
            isEnter: true
          };
        }
        ;
        if (v2 instanceof Just) {
          return {
            node: mergeSimulationState(v2.value0)(desired),
            isEnter: false
          };
        }
        ;
        throw new Error("Failed pattern match at PSD3.ForceEngine.Setup (line 668, column 7 - line 674, column 73): " + [v2.constructor.name]);
      };
      var processed = map72(processDesired)(desiredNodes);
      var entered = map72(function(v2) {
        return v2.node;
      })(filter(function(v2) {
        return v2.isEnter;
      })(processed));
      var merged = map72(function(v2) {
        return v2.node;
      })(processed);
      var updated = map72(function(v2) {
        return v2.node;
      })(filter(function($97) {
        return !(function(v2) {
          return v2.isEnter;
        })($97);
      })(processed));
      return {
        entered,
        updated,
        exited,
        merged
      };
    };
  };
  var computeLinkGUP = function(currentLinks) {
    return function(desiredLinks) {
      var linkKey2 = function(l2) {
        return new Tuple(l2.source, l2.target);
      };
      var desiredKeys = fromFoldable33(map72(linkKey2)(desiredLinks));
      var currentKeys = fromFoldable33(map72(linkKey2)(currentLinks));
      var enterKeys = difference5(desiredKeys)(currentKeys);
      var entered = filter(function(l2) {
        return member12(linkKey2(l2))(enterKeys);
      })(desiredLinks);
      var exitKeys = difference5(currentKeys)(desiredKeys);
      var exited = filter(function(l2) {
        return member12(linkKey2(l2))(exitKeys);
      })(currentLinks);
      var updateKeys = intersection3(desiredKeys)(currentKeys);
      var updated = filter(function(l2) {
        return member12(linkKey2(l2))(updateKeys);
      })(desiredLinks);
      return {
        entered,
        updated,
        exited
      };
    };
  };
  var collide = function(name16) {
    return defaultForceConfig(name16)(ForceCollide2.value);
  };
  var center = function(name16) {
    return defaultForceConfig(name16)(ForceCenter.value);
  };
  var applySetup = function(setupConfig) {
    return function(sim) {
      return function __do7() {
        var nodes3 = read(sim.nodes)();
        var links3 = read(sim.links)();
        var currentForces = read(sim.forces)();
        var desiredNames = fromFoldable42(map72(function(v2) {
          return v2.name;
        })(setupConfig.forces));
        var currentNames = fromFoldable52(keys3(currentForces));
        var toRemove = difference12(currentNames)(desiredNames);
        for_5(toUnfoldable8(toRemove))(function(name16) {
          return modify_2($$delete7(name16))(sim.forces);
        })();
        for_5(setupConfig.forces)(function(fc) {
          return function __do8() {
            var handle = createForceHandle(fc)();
            (function() {
              if (fc.forceType instanceof ForceLink2) {
                return initializeLinkForce(handle)(nodes3)(links3)();
              }
              ;
              return initializeForce(handle)(nodes3)();
            })();
            return modify_2(insert14(fc.name)(handle))(sim.forces)();
          };
        })();
        return write(setupConfig.params.alpha)(sim.alpha)();
      };
    };
  };
  var applySetupWithData = function(setupConfig) {
    return function(desiredNodes) {
      return function(desiredLinks) {
        return function(sim) {
          return function __do7() {
            var currentNodes = read(sim.nodes)();
            var currentLinks = read(sim.links)();
            var nodeResult = computeNodeGUP(currentNodes)(desiredNodes);
            write(nodeResult.merged)(sim.nodes)();
            var linkResult = computeLinkGUP(currentLinks)(desiredLinks);
            write(desiredLinks)(sim.links)();
            applySetup(setupConfig)(sim)();
            return {
              nodes: {
                entered: nodeResult.entered,
                updated: nodeResult.updated,
                exited: nodeResult.exited
              },
              links: {
                entered: linkResult.entered,
                updated: linkResult.updated,
                exited: linkResult.exited
              }
            };
          };
        };
      };
    };
  };

  // output/D3.Viz.LesMisV3.GUPDemo/index.js
  var bind53 = /* @__PURE__ */ bind(bindD3v2M);
  var select28 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var width30 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var num23 = /* @__PURE__ */ num(numExprEvalD);
  var height30 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr28 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text28 = /* @__PURE__ */ text6(stringExprEvalD);
  var renderTree49 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D);
  var renderTree115 = /* @__PURE__ */ renderTree49(ordUnit);
  var pure38 = /* @__PURE__ */ pure(applicativeD3v2M);
  var pure115 = /* @__PURE__ */ pure(applicativeEffect);
  var elem6 = /* @__PURE__ */ elem2(eqInt);
  var append30 = /* @__PURE__ */ append(semigroupArray);
  var yIsSymbol3 = {
    reflectSymbol: function() {
      return "y";
    }
  };
  var xIsSymbol3 = {
    reflectSymbol: function() {
      return "x";
    }
  };
  var exitProgressIsSymbol = {
    reflectSymbol: function() {
      return "exitProgress";
    }
  };
  var enterProgressIsSymbol = {
    reflectSymbol: function() {
      return "enterProgress";
    }
  };
  var valueIsSymbol2 = {
    reflectSymbol: function() {
      return "value";
    }
  };
  var targetYIsSymbol = {
    reflectSymbol: function() {
      return "targetY";
    }
  };
  var targetXIsSymbol = {
    reflectSymbol: function() {
      return "targetX";
    }
  };
  var sourceYIsSymbol = {
    reflectSymbol: function() {
      return "sourceY";
    }
  };
  var sourceXIsSymbol = {
    reflectSymbol: function() {
      return "sourceX";
    }
  };
  var cx12 = /* @__PURE__ */ cx(toAttributeValueNumber);
  var cy12 = /* @__PURE__ */ cy(toAttributeValueNumber);
  var r14 = /* @__PURE__ */ r(toAttributeValueNumber);
  var fill23 = /* @__PURE__ */ fill(toAttributeValueString);
  var opacity8 = /* @__PURE__ */ opacity(toAttributeValueNumber);
  var stroke18 = /* @__PURE__ */ stroke(toAttributeValueString);
  var strokeWidth17 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var map73 = /* @__PURE__ */ map(functorArray);
  var x19 = /* @__PURE__ */ x1(toAttributeValueNumber);
  var y110 = /* @__PURE__ */ y1(toAttributeValueNumber);
  var x23 = /* @__PURE__ */ x2(toAttributeValueNumber);
  var y23 = /* @__PURE__ */ y2(toAttributeValueNumber);
  var ordRecord11 = /* @__PURE__ */ ordRecord();
  var ordRecordCons11 = /* @__PURE__ */ ordRecordCons(ordRecordNil)();
  var ordNullable4 = /* @__PURE__ */ ordNullable(ordNumber);
  var ordMaybe3 = /* @__PURE__ */ ordMaybe(ordNumber);
  var renderTree215 = /* @__PURE__ */ renderTree49(/* @__PURE__ */ ordRecord11(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons11({
    reflectSymbol: function() {
      return "node";
    }
  })(/* @__PURE__ */ ordRecord11(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons11(yIsSymbol3)(ordNumber))()(xIsSymbol3)(ordNumber))()({
    reflectSymbol: function() {
      return "vy";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "vx";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "name";
    }
  })(ordString))()({
    reflectSymbol: function() {
      return "id";
    }
  })(ordInt))()({
    reflectSymbol: function() {
      return "group";
    }
  })(ordInt))()({
    reflectSymbol: function() {
      return "fy";
    }
  })(ordNullable4))()({
    reflectSymbol: function() {
      return "fx";
    }
  })(ordNullable4))))()(exitProgressIsSymbol)(ordMaybe3))()(enterProgressIsSymbol)(ordMaybe3)));
  var renderTree310 = /* @__PURE__ */ renderTree49(/* @__PURE__ */ ordRecord11(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons11(valueIsSymbol2)(ordNumber))()(targetYIsSymbol)(ordNumber))()(targetXIsSymbol)(ordNumber))()(sourceYIsSymbol)(ordNumber))()(sourceXIsSymbol)(ordNumber)));
  var lookup26 = /* @__PURE__ */ lookup(ordString);
  var transitionDelta2 = 0.025;
  var toNodeDatum = function(rn) {
    return {
      x: rn.node.x,
      y: rn.node.y,
      enterProgress: (function() {
        if (rn.enterProgress instanceof Just) {
          return rn.enterProgress.value0;
        }
        ;
        if (rn.enterProgress instanceof Nothing) {
          return -1;
        }
        ;
        throw new Error("Failed pattern match at D3.Viz.LesMisV3.GUPDemo (line 111, column 20 - line 113, column 22): " + [rn.enterProgress.constructor.name]);
      })(),
      exitProgress: (function() {
        if (rn.exitProgress instanceof Just) {
          return rn.exitProgress.value0;
        }
        ;
        if (rn.exitProgress instanceof Nothing) {
          return -1;
        }
        ;
        throw new Error("Failed pattern match at D3.Viz.LesMisV3.GUPDemo (line 114, column 19 - line 116, column 22): " + [rn.exitProgress.constructor.name]);
      })()
    };
  };
  var toLinkDatum = function(link5) {
    return {
      sourceX: link5.source.x,
      sourceY: link5.source.y,
      targetX: link5.target.x,
      targetY: link5.target.y,
      value: link5.value
    };
  };
  var svgWidth2 = 900;
  var svgHeight2 = 600;
  var simulationId2 = "lesmis-gup";
  var renderSVGContainer2 = function(containerSelector) {
    return runD3v2M(bind53(select28(containerSelector))(function(container) {
      var containerTree = withChildren(withBehaviors(named(SVG.value)("svg")([width30(num23(svgWidth2)), height30(num23(svgHeight2)), viewBox(-svgWidth2 / 2)(-svgHeight2 / 2)(svgWidth2)(svgHeight2), attr28("id")(text28("lesmis-gup-svg")), attr28("class")(text28("lesmis-gup"))]))([new Zoom(defaultZoom(new ScaleExtent(0.1, 10))("#lesmis-gup-zoom-group"))]))([withChildren(named(Group.value)("zoomGroup")([attr28("id")(text28("lesmis-gup-zoom-group")), attr28("class")(text28("zoom-group"))]))([named(Group.value)("linksGroup")([attr28("id")(text28("lesmis-gup-links")), attr28("class")(text28("links"))]), named(Group.value)("nodesGroup")([attr28("id")(text28("lesmis-gup-nodes")), attr28("class")(text28("nodes"))])])]);
      return bind53(renderTree115(container)(containerTree))(function() {
        return pure38(unit);
      });
    }));
  };
  var pickRandomIndices = function(v2) {
    return function(v1) {
      return function(v22) {
        if (v2 === 0) {
          return pure115(v22);
        }
        ;
        if (v1 === 0) {
          return pure115(v22);
        }
        ;
        return function __do7() {
          var idx = randomInt(0)(v1 - 1 | 0)();
          var $232 = elem6(idx)(v22);
          if ($232) {
            return pickRandomIndices(v2)(v1)(v22)();
          }
          ;
          return pickRandomIndices(v2 - 1 | 0)(v1)(append30(v22)([idx]))();
        };
      };
    };
  };
  var pickRandom = function(n) {
    return function(arr) {
      var $233 = n <= 0 || length3(arr) === 0;
      if ($233) {
        return pure115([]);
      }
      ;
      return function __do7() {
        var indices = pickRandomIndices(n)(length3(arr))([])();
        return mapMaybe(function(i2) {
          return index(arr)(i2);
        })(indices);
      };
    };
  };
  var nodeY = function(dictDatumExpr) {
    return field(dictDatumExpr)(yIsSymbol3)()($$Proxy.value);
  };
  var nodeY1 = /* @__PURE__ */ nodeY(datumExprEvalD);
  var nodeX = function(dictDatumExpr) {
    return field(dictDatumExpr)(xIsSymbol3)()($$Proxy.value);
  };
  var nodeX1 = /* @__PURE__ */ nodeX(datumExprEvalD);
  var nodeExitProgress = function(dictDatumExpr) {
    return field(dictDatumExpr)(exitProgressIsSymbol)()($$Proxy.value);
  };
  var nodeOpacityExpr = function(dictNumExpr) {
    var lit22 = lit(dictNumExpr);
    var subOp2 = subOp(dictNumExpr);
    return function(dictBoolExpr) {
      var ifThenElse2 = ifThenElse(dictBoolExpr);
      return function(dictCompareExpr) {
        var gtOp2 = gtOp(dictCompareExpr);
        return function(dictDatumExpr) {
          var nodeExitProgress1 = nodeExitProgress(dictDatumExpr);
          return ifThenElse2(gtOp2(nodeExitProgress1)(lit22(-0.5)))(subOp2(lit22(1))(nodeExitProgress1))(lit22(1));
        };
      };
    };
  };
  var nodeOpacityExpr1 = /* @__PURE__ */ nodeOpacityExpr(numExprEvalD)(boolExprEvalD)(compareExprEvalD)(datumExprEvalD);
  var nodeEnterProgress = function(dictDatumExpr) {
    return field(dictDatumExpr)(enterProgressIsSymbol)()($$Proxy.value);
  };
  var nodeFillExpr = function(dictNumExpr) {
    var lit22 = lit(dictNumExpr);
    return function(dictBoolExpr) {
      var ifThenElse2 = ifThenElse(dictBoolExpr);
      return function(dictCompareExpr) {
        var gtOp2 = gtOp(dictCompareExpr);
        return function(dictStringExpr) {
          var s3 = s(dictStringExpr);
          return function(dictDatumExpr) {
            return ifThenElse2(gtOp2(nodeEnterProgress(dictDatumExpr))(lit22(-0.5)))(s3("#2ca02c"))(ifThenElse2(gtOp2(nodeExitProgress(dictDatumExpr))(lit22(-0.5)))(s3("#8c564b"))(s3("#7f7f7f")));
          };
        };
      };
    };
  };
  var nodeFillExpr1 = /* @__PURE__ */ nodeFillExpr(numExprEvalD)(boolExprEvalD)(compareExprEvalD)(stringExprEvalD)(datumExprEvalD);
  var nodeRadiusExpr = function(dictNumExpr) {
    var lit22 = lit(dictNumExpr);
    var subOp2 = subOp(dictNumExpr);
    var mulLit2 = mulLit(dictNumExpr);
    var addOp2 = addOp(dictNumExpr);
    return function(dictBoolExpr) {
      var ifThenElse2 = ifThenElse(dictBoolExpr);
      return function(dictCompareExpr) {
        var gtOp2 = gtOp(dictCompareExpr);
        return function(dictDatumExpr) {
          var nodeEnterProgress1 = nodeEnterProgress(dictDatumExpr);
          var nodeExitProgress1 = nodeExitProgress(dictDatumExpr);
          return ifThenElse2(gtOp2(nodeEnterProgress1)(lit22(-0.5)))(subOp2(lit22(20))(mulLit2(nodeEnterProgress1)(15)))(ifThenElse2(gtOp2(nodeExitProgress1)(lit22(-0.5)))(addOp2(lit22(5))(mulLit2(nodeExitProgress1)(15)))(lit22(5)));
        };
      };
    };
  };
  var nodeRadiusExpr1 = /* @__PURE__ */ nodeRadiusExpr(numExprEvalD)(boolExprEvalD)(compareExprEvalD)(datumExprEvalD);
  var linkValue = function(dictDatumExpr) {
    return field(dictDatumExpr)(valueIsSymbol2)()($$Proxy.value);
  };
  var linkValue1 = /* @__PURE__ */ linkValue(datumExprEvalD);
  var linkTargetY = function(dictDatumExpr) {
    return field(dictDatumExpr)(targetYIsSymbol)()($$Proxy.value);
  };
  var linkTargetY1 = /* @__PURE__ */ linkTargetY(datumExprEvalD);
  var linkTargetX = function(dictDatumExpr) {
    return field(dictDatumExpr)(targetXIsSymbol)()($$Proxy.value);
  };
  var linkTargetX1 = /* @__PURE__ */ linkTargetX(datumExprEvalD);
  var linkSourceY = function(dictDatumExpr) {
    return field(dictDatumExpr)(sourceYIsSymbol)()($$Proxy.value);
  };
  var linkSourceY1 = /* @__PURE__ */ linkSourceY(datumExprEvalD);
  var linkSourceX = function(dictDatumExpr) {
    return field(dictDatumExpr)(sourceXIsSymbol)()($$Proxy.value);
  };
  var linkSourceX1 = /* @__PURE__ */ linkSourceX(datumExprEvalD);
  var lesMisSetup = /* @__PURE__ */ (function() {
    return setup("lesmis")([withDistanceMax(500)(withStrength($$static(-100))(manyBody("charge"))), withStrength($$static(1))(withRadius($$static(5))(collide("collision"))), withStrength($$static(0.1))(withY($$static(0))(withX($$static(0))(center("center")))), withStrength($$static(0.5))(withDistance($$static(30))(link2("links")))]);
  })();
  var evalNodeStr = function(expr) {
    return function(datum2) {
      return runEvalD(expr)(datum2)(0);
    };
  };
  var evalNodeNum = function(expr) {
    return function(datum2) {
      return runEvalD(expr)(datum2)(0);
    };
  };
  var evalLinkNum = function(expr) {
    return function(datum2) {
      return runEvalD(expr)(datum2)(0);
    };
  };
  var createNodesTree2 = function(scene) {
    return joinData("nodes")("circle")(scene.nodes)(function(renderNode) {
      var datum2 = toNodeDatum(renderNode);
      return withBehaviors(elem3(Circle.value)([cx12(num23(evalNodeNum(nodeX1)(datum2))), cy12(num23(evalNodeNum(nodeY1)(datum2))), r14(num23(evalNodeNum(nodeRadiusExpr1)(datum2))), fill23(text28(evalNodeStr(nodeFillExpr1)(datum2))), opacity8(num23(evalNodeNum(nodeOpacityExpr1)(datum2))), stroke18(text28("#fff")), strokeWidth17(num23(1.5))]))([new Drag(new SimulationDragNested(simulationId2))]);
    });
  };
  var createLinksTree2 = function(scene) {
    var linkDatums = map73(toLinkDatum)(scene.links);
    return joinData("links")("line")(linkDatums)(function(datum2) {
      return elem3(Line.value)([x19(num23(evalLinkNum(linkSourceX1)(datum2))), y110(num23(evalLinkNum(linkSourceY1)(datum2))), x23(num23(evalLinkNum(linkTargetX1)(datum2))), y23(num23(evalLinkNum(linkTargetY1)(datum2))), strokeWidth17(num23(sqrt(evalLinkNum(linkValue1)(datum2)))), stroke18(text28("#999")), opacity8(num23(0.6))]);
    });
  };
  var renderScene2 = function(scene) {
    return runD3v2M(bind53(select28("#lesmis-gup-nodes"))(function(nodesGroup) {
      var nodesTree = createNodesTree2(scene);
      return bind53(renderTree215(nodesGroup)(nodesTree))(function() {
        return bind53(select28("#lesmis-gup-links"))(function(linksGroup) {
          var linksTree = createLinksTree2(scene);
          return bind53(renderTree310(linksGroup)(linksTree))(function() {
            return pure38(unit);
          });
        });
      });
    }));
  };
  var cloneNode = function(n) {
    return {
      id: n.id,
      name: n.name,
      group: n.group,
      x: n.x,
      y: n.y,
      vx: n.vx,
      vy: n.vy,
      fx: n.fx,
      fy: n.fy
    };
  };
  var createSimulationWithCallbacks2 = function(callbacks) {
    return function(model) {
      var clonedNodes = map73(cloneNode)(model.nodes);
      return function __do7() {
        var sim = createWithCallbacks(defaultConfig2)(callbacks)();
        setNodes(clonedNodes)(sim)();
        setLinks(model.links)(sim)();
        registerSimulation_(simulationId2)(reheat(sim))();
        addForce(new ManyBody("charge", {
          theta: defaultManyBody.theta,
          distanceMin: defaultManyBody.distanceMin,
          strength: -100,
          distanceMax: 500
        }))(sim)();
        addForce(new Collide("collision", {
          radius: 5,
          strength: 1,
          iterations: 1
        }))(sim)();
        addForce(new Center("center", {
          x: 0,
          y: 0,
          strength: 0.1
        }))(sim)();
        addForce(new Link("links", {
          distance: 30,
          strength: 0.5,
          iterations: 1
        }))(sim)();
        start3(sim)();
        return sim;
      };
    };
  };
  var buildSceneData2 = function(currentNodes) {
    return function(enteringProgress) {
      return function(exitingNodes) {
        return function(allLinks) {
          var visibleLinks = filterLinksToSubset(function(v2) {
            return v2.id;
          })(currentNodes)(allLinks);
          var swizzledLinks = swizzleLinksByIndex(function(v2) {
            return v2.id;
          })(currentNodes)(visibleLinks)(function(src10) {
            return function(tgt) {
              return function(i2) {
                return function(link5) {
                  return {
                    source: src10,
                    target: tgt,
                    value: link5.value,
                    index: i2,
                    isExiting: false
                  };
                };
              };
            };
          });
          var renderNodes = map73(function(n) {
            return {
              node: n,
              enterProgress: lookup26(n.name)(enteringProgress),
              exitProgress: Nothing.value
            };
          })(currentNodes);
          var exitingRenderNodes = map73(function(e) {
            return {
              node: e.item,
              enterProgress: Nothing.value,
              exitProgress: new Just(e.progress)
            };
          })(exitingNodes);
          var allRenderNodes = append30(renderNodes)(exitingRenderNodes);
          return {
            nodes: allRenderNodes,
            links: swizzledLinks
          };
        };
      };
    };
  };

  // output/D3.Viz.LesMisV3.Model/index.js
  var bind54 = /* @__PURE__ */ bind(bindMaybe);
  var lookup27 = /* @__PURE__ */ lookup(ordString);
  var pure39 = /* @__PURE__ */ pure(applicativeMaybe);
  var fromFoldable30 = /* @__PURE__ */ fromFoldable6(ordString)(foldableArray);
  var mkNode = function(idx) {
    return function(v2) {
      return {
        id: idx,
        name: v2.id,
        group: v2.group,
        x: 0,
        y: 0,
        vx: 0,
        vy: 0,
        fx: nullImpl,
        fy: nullImpl
      };
    };
  };
  var processRawModel = function(raw) {
    var convertLink = function(idMap) {
      return function(v2) {
        return bind54(lookup27(v2.source)(idMap))(function(srcIdx) {
          return bind54(lookup27(v2.target)(idMap))(function(tgtIdx) {
            return pure39({
              source: srcIdx,
              target: tgtIdx,
              value: v2.value
            });
          });
        });
      };
    };
    var nodes3 = mapWithIndex3(mkNode)(raw.nodes);
    var idToIndex = fromFoldable30(mapWithIndex3(function(i2) {
      return function(n) {
        return new Tuple(n.id, i2);
      };
    })(raw.nodes));
    var links3 = mapMaybe(convertLink(idToIndex))(raw.links);
    return {
      nodes: nodes3,
      links: links3
    };
  };

  // output/Component.GUPDebug/index.js
  var bind55 = /* @__PURE__ */ bind(bindHalogenM);
  var get10 = /* @__PURE__ */ get(monadStateHalogenM);
  var pure40 = /* @__PURE__ */ pure(applicativeHalogenM);
  var discard33 = /* @__PURE__ */ discard(discardUnit)(bindHalogenM);
  var fromFoldable31 = /* @__PURE__ */ fromFoldable20(foldableArray)(ordString);
  var map74 = /* @__PURE__ */ map(functorArray);
  var $$void11 = /* @__PURE__ */ $$void(functorHalogenM);
  var mapFlipped7 = /* @__PURE__ */ mapFlipped(functorEmitter);
  var modify_7 = /* @__PURE__ */ modify_(monadStateHalogenM);
  var tickProgressMap3 = /* @__PURE__ */ tickProgressMap(ordString);
  var member6 = /* @__PURE__ */ member2(ordString);
  var append31 = /* @__PURE__ */ append(/* @__PURE__ */ semigroupSet(ordString));
  var startProgress3 = /* @__PURE__ */ startProgress(ordString);
  var show49 = /* @__PURE__ */ show(showInt);
  var difference6 = /* @__PURE__ */ difference3(ordString);
  var append210 = /* @__PURE__ */ append(semigroupArray);
  var Initialize5 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var Finalize3 = /* @__PURE__ */ (function() {
    function Finalize6() {
    }
    ;
    Finalize6.value = new Finalize6();
    return Finalize6;
  })();
  var SimTick2 = /* @__PURE__ */ (function() {
    function SimTick3() {
    }
    ;
    SimTick3.value = new SimTick3();
    return SimTick3;
  })();
  var AddNodes = /* @__PURE__ */ (function() {
    function AddNodes2() {
    }
    ;
    AddNodes2.value = new AddNodes2();
    return AddNodes2;
  })();
  var RemoveNodes = /* @__PURE__ */ (function() {
    function RemoveNodes2() {
    }
    ;
    RemoveNodes2.value = new RemoveNodes2();
    return RemoveNodes2;
  })();
  var ResetFull = /* @__PURE__ */ (function() {
    function ResetFull2() {
    }
    ;
    ResetFull2.value = new ResetFull2();
    return ResetFull2;
  })();
  var render9 = function(v2) {
    return div2([classes(["gup-debug-page"])])([h1_([text5("GUP Debug - Les Miserables")]), p_([text5("Halogen-first architecture: All state lives in Halogen.")]), p_([text5("GUPDemo provides stateless visualization functions.")]), div2([id3("gup-viz-container"), classes(["viz-container"]), style("width: 100%; height: 600px; border: 1px solid #ccc; background: #fafafa;")])([]), div2([classes(["button-row"]), style("margin-top: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap;")])([button2([classes(["debug-button"]), style("padding: 0.5rem 1rem; cursor: pointer;"), onClick(function(v1) {
      return AddNodes.value;
    })])([text5("Add 5 Nodes")]), button2([classes(["debug-button"]), style("padding: 0.5rem 1rem; cursor: pointer;"), onClick(function(v1) {
      return RemoveNodes.value;
    })])([text5("Remove 5 Nodes")]), button2([classes(["debug-button", "secondary"]), style("padding: 0.5rem 1rem; cursor: pointer;"), onClick(function(v1) {
      return ResetFull.value;
    })])([text5("Reset All")])]), div2([style("margin-top: 2rem; padding: 1rem; background: #f0f0f0; border-radius: 4px;")])([h3_([text5("Architecture")]), ul_([li_([text5("State: fullModel, visibleIds, enteringProgress, exitingNodes, simulation")]), li_([text5("Simulation tick callback drives position updates")]), li_([text5("applySetupWithData handles GUP semantics")]), li_([text5("Transitions are tick-driven via Tick module")])]), h3_([text5("How to Use")]), ul_([li_([text5("Add/Remove Nodes: Triggers GUP transitions (green=enter, gray=update, brown=exit)")]), li_([text5("Reset All: Restores the full dataset")]), li_([text5("Drag nodes to reposition them; the simulation will respond")])])])]);
  };
  var doRender2 = function(dictMonadAff) {
    var liftEffect54 = liftEffect(monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    return bind55(get10)(function(state3) {
      if (state3.simulation instanceof Just) {
        return liftEffect54(function __do7() {
          var currentNodes = getNodes(state3.simulation.value0)();
          var currentLinks = getLinks(state3.simulation.value0)();
          var scene = buildSceneData2(currentNodes)(state3.enteringProgress)(state3.exitingNodes)(currentLinks);
          return renderScene2(scene)();
        });
      }
      ;
      return pure40(unit);
    });
  };
  var handleAction4 = function(dictMonadAff) {
    var liftAff2 = liftAff(monadAffHalogenM(dictMonadAff));
    var monadEffectHalogenM2 = monadEffectHalogenM(dictMonadAff.MonadEffect0());
    var liftEffect54 = liftEffect(monadEffectHalogenM2);
    var doRender1 = doRender2(dictMonadAff);
    var log8 = log3(monadEffectHalogenM2);
    return function(v2) {
      if (v2 instanceof Initialize5) {
        return discard33(liftAff2(delay(100)))(function() {
          return bind55(liftAff2(simpleLoadJSON("./data/miserables.json")))(function(lesMisJson) {
            var model = processRawModel(lesMisJson);
            var allNodeIds = fromFoldable31(map74(function(v1) {
              return v1.name;
            })(model.nodes));
            return bind55(liftEffect54(defaultCallbacks))(function(callbacks) {
              return bind55(liftEffect54(createSimulationWithCallbacks2(callbacks)(model)))(function(simulation) {
                return discard33(liftEffect54(renderSVGContainer2("#gup-viz-container")))(function() {
                  return bind55(liftEffect54(subscribeToSimulation(simulation)))(function(emitter) {
                    return discard33($$void11(subscribe2(mapFlipped7(emitter)(function(event) {
                      if (event instanceof Tick) {
                        return SimTick2.value;
                      }
                      ;
                      return SimTick2.value;
                    }))))(function() {
                      return discard33(modify_7(function(v1) {
                        var $62 = {};
                        for (var $63 in v1) {
                          if ({}.hasOwnProperty.call(v1, $63)) {
                            $62[$63] = v1[$63];
                          }
                          ;
                        }
                        ;
                        $62.fullModel = new Just(model);
                        $62.visibleIds = allNodeIds;
                        $62.enteringProgress = empty4;
                        $62.exitingNodes = [];
                        $62.simulation = new Just(simulation);
                        return $62;
                      }))(function() {
                        return doRender1;
                      });
                    });
                  });
                });
              });
            });
          });
        });
      }
      ;
      if (v2 instanceof Finalize3) {
        return pure40(unit);
      }
      ;
      if (v2 instanceof SimTick2) {
        return bind55(get10)(function(state3) {
          if (state3.simulation instanceof Nothing) {
            return pure40(unit);
          }
          ;
          if (state3.simulation instanceof Just) {
            var v1 = tickProgressMap3(transitionDelta2)(state3.enteringProgress);
            var v22 = tickTransitions(transitionDelta2)(state3.exitingNodes);
            return discard33(modify_7(function(v3) {
              var $68 = {};
              for (var $69 in v3) {
                if ({}.hasOwnProperty.call(v3, $69)) {
                  $68[$69] = v3[$69];
                }
                ;
              }
              ;
              $68.enteringProgress = v1.active;
              $68.exitingNodes = v22.active;
              return $68;
            }))(function() {
              return liftEffect54(function __do7() {
                var currentNodes = getNodes(state3.simulation.value0)();
                var currentLinks = getLinks(state3.simulation.value0)();
                var scene = buildSceneData2(currentNodes)(v1.active)(v22.active)(currentLinks);
                return renderScene2(scene)();
              });
            });
          }
          ;
          throw new Error("Failed pattern match at Component.GUPDebug (line 156, column 5 - line 181, column 36): " + [state3.simulation.constructor.name]);
        });
      }
      ;
      if (v2 instanceof AddNodes) {
        return bind55(get10)(function(state3) {
          if (state3.fullModel instanceof Just && state3.simulation instanceof Just) {
            var hiddenNodes = filter(function(n) {
              return !member6(n.name)(state3.visibleIds);
            })(state3.fullModel.value0.nodes);
            return bind55(liftEffect54(pickRandom(5)(hiddenNodes)))(function(nodesToAdd) {
              var newVisibleIds = append31(state3.visibleIds)(fromFoldable31(map74(function(v1) {
                return v1.name;
              })(nodesToAdd)));
              var desiredNodes = filter(function(n) {
                return member6(n.name)(newVisibleIds);
              })(state3.fullModel.value0.nodes);
              var desiredLinks = filterLinksToSubset(function(v1) {
                return v1.id;
              })(desiredNodes)(state3.fullModel.value0.links);
              return bind55(liftEffect54(applySetupWithData(lesMisSetup)(desiredNodes)(desiredLinks)(state3.simulation.value0)))(function(result) {
                var enteringNames = map74(function(v1) {
                  return v1.name;
                })(result.nodes.entered);
                var newEntering = startProgress3(enteringNames)(state3.enteringProgress);
                return discard33(liftEffect54(reheat(state3.simulation.value0)))(function() {
                  return discard33(modify_7(function(v1) {
                    var $76 = {};
                    for (var $77 in v1) {
                      if ({}.hasOwnProperty.call(v1, $77)) {
                        $76[$77] = v1[$77];
                      }
                      ;
                    }
                    ;
                    $76.visibleIds = newVisibleIds;
                    $76.enteringProgress = newEntering;
                    return $76;
                  }))(function() {
                    return log8("Added " + (show49(length3(nodesToAdd)) + " nodes"));
                  });
                });
              });
            });
          }
          ;
          return pure40(unit);
        });
      }
      ;
      if (v2 instanceof RemoveNodes) {
        return bind55(get10)(function(state3) {
          if (state3.fullModel instanceof Just && state3.simulation instanceof Just) {
            var visibleNodes = filter(function(n) {
              return member6(n.name)(state3.visibleIds);
            })(state3.fullModel.value0.nodes);
            return bind55(liftEffect54(pickRandom(5)(visibleNodes)))(function(nodesToRemove) {
              var nodesToRemoveIds = fromFoldable31(map74(function(v1) {
                return v1.name;
              })(nodesToRemove));
              var newVisibleIds = difference6(state3.visibleIds)(nodesToRemoveIds);
              var desiredNodes = filter(function(n) {
                return member6(n.name)(newVisibleIds);
              })(state3.fullModel.value0.nodes);
              var desiredLinks = filterLinksToSubset(function(v1) {
                return v1.id;
              })(desiredNodes)(state3.fullModel.value0.links);
              return bind55(liftEffect54(applySetupWithData(lesMisSetup)(desiredNodes)(desiredLinks)(state3.simulation.value0)))(function(result) {
                var newExiting = startTransitions(result.nodes.exited);
                return discard33(liftEffect54(reheat(state3.simulation.value0)))(function() {
                  return discard33(modify_7(function(v1) {
                    var $83 = {};
                    for (var $84 in v1) {
                      if ({}.hasOwnProperty.call(v1, $84)) {
                        $83[$84] = v1[$84];
                      }
                      ;
                    }
                    ;
                    $83.visibleIds = newVisibleIds;
                    $83.exitingNodes = append210(state3.exitingNodes)(newExiting);
                    return $83;
                  }))(function() {
                    return log8("Removed " + (show49(length3(nodesToRemove)) + " nodes"));
                  });
                });
              });
            });
          }
          ;
          return pure40(unit);
        });
      }
      ;
      if (v2 instanceof ResetFull) {
        return bind55(get10)(function(state3) {
          if (state3.fullModel instanceof Just && state3.simulation instanceof Just) {
            var allNodeIds = fromFoldable31(map74(function(v1) {
              return v1.name;
            })(state3.fullModel.value0.nodes));
            return bind55(liftEffect54(applySetupWithData(lesMisSetup)(state3.fullModel.value0.nodes)(state3.fullModel.value0.links)(state3.simulation.value0)))(function(result) {
              var enteringNames = map74(function(v1) {
                return v1.name;
              })(result.nodes.entered);
              var newEntering = startProgress3(enteringNames)(empty4);
              return discard33(liftEffect54(reheat(state3.simulation.value0)))(function() {
                return discard33(modify_7(function(v1) {
                  var $90 = {};
                  for (var $91 in v1) {
                    if ({}.hasOwnProperty.call(v1, $91)) {
                      $90[$91] = v1[$91];
                    }
                    ;
                  }
                  ;
                  $90.visibleIds = allNodeIds;
                  $90.enteringProgress = newEntering;
                  $90.exitingNodes = [];
                  return $90;
                }))(function() {
                  return log8("Reset to full dataset");
                });
              });
            });
          }
          ;
          return pure40(unit);
        });
      }
      ;
      throw new Error("Failed pattern match at Component.GUPDebug (line 106, column 16 - line 274, column 24): " + [v2.constructor.name]);
    };
  };
  var component5 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return {
          fullModel: Nothing.value,
          visibleIds: empty8,
          enteringProgress: empty4,
          exitingNodes: [],
          simulation: Nothing.value
        };
      },
      render: render9,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        handleAction: handleAction4(dictMonadAff),
        initialize: new Just(Initialize5.value),
        finalize: new Just(Finalize3.value)
      })
    });
  };

  // output/D3.Viz.TreeAPI.V3GUPDemoFriendly/index.js
  var indexIsSymbol2 = {
    reflectSymbol: function() {
      return "index";
    }
  };
  var field3 = /* @__PURE__ */ field2(indexIsSymbol2)();
  var x20 = /* @__PURE__ */ x(toAttributeValueNumber);
  var y20 = /* @__PURE__ */ y(toAttributeValueNumber);
  var fontSize13 = /* @__PURE__ */ fontSize(toAttributeValueString);
  var pt2 = /* @__PURE__ */ pt(stringExprEvalD);
  var textAnchor12 = /* @__PURE__ */ textAnchor(toAttributeValueString);
  var text29 = /* @__PURE__ */ text6(stringExprEvalD);
  var dominantBaseline3 = /* @__PURE__ */ dominantBaseline(toAttributeValueString);
  var fill24 = /* @__PURE__ */ fill(toAttributeValueString);
  var hex3 = /* @__PURE__ */ hex2(stringExprEvalD);
  var opacity9 = /* @__PURE__ */ opacity(toAttributeValueNumber);
  var num24 = /* @__PURE__ */ num(numExprEvalD);
  var textContent12 = /* @__PURE__ */ textContent2(toAttributeValueString);
  var bind56 = /* @__PURE__ */ bind(bindD3v2M);
  var select29 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var width31 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var height31 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr29 = /* @__PURE__ */ attr3(toAttributeValueString);
  var renderTree50 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D);
  var renderTree116 = /* @__PURE__ */ renderTree50(ordUnit);
  var pure41 = /* @__PURE__ */ pure(applicativeD3v2M);
  var renderTree216 = /* @__PURE__ */ renderTree50(/* @__PURE__ */ ordRecord()(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(ordRecordNil)()({
    reflectSymbol: function() {
      return "letter";
    }
  })(ordString))()(indexIsSymbol2)(ordNumber)));
  var letterY2 = function(dictNumExpr) {
    return num(dictNumExpr)(100);
  };
  var letterY1 = /* @__PURE__ */ letterY2(numExprEvalD);
  var filterAlphaNum2 = function(s3) {
    var isAlphaNum = function(c2) {
      return c2 >= "a" && c2 <= "z" || (c2 >= "A" && c2 <= "Z" || c2 >= "0" && c2 <= "9");
    };
    return fromCharArray(filter(isAlphaNum)(toCharArray(s3)));
  };
  var _index = function(dictDatumExpr) {
    return field3(dictDatumExpr);
  };
  var letterX3 = function(dictNumExpr) {
    var plusN2 = plusN(dictNumExpr);
    var timesN2 = timesN(dictNumExpr);
    return function(dictDatumExpr) {
      return plusN2(timesN2(_index(dictDatumExpr))(40))(50);
    };
  };
  var letterX12 = /* @__PURE__ */ letterX3(numExprEvalD)(datumExprEvalD);
  var createLettersTree2 = function(letters) {
    return sceneJoin("letters")("text")(letters)(function(d) {
      return elem3(Text.value)([x20(letterX12), y20(letterY1), fontSize13(pt2(32)), textAnchor12(text29("middle")), dominantBaseline3(text29("middle")), fill24(hex3("#2c3e50")), opacity9(num24(1)), textContent12(text29(d.letter))]);
    })({
      keyFn: new Just(function(v2) {
        return v2.letter;
      }),
      enterBehavior: new Just({
        initialAttrs: [y20(num24(20)), opacity9(num24(0)), fill24(hex3("#27ae60"))],
        transition: new Just(transitionWith({
          duration: 750,
          delay: Nothing.value,
          staggerDelay: new Just(50),
          easing: new Just(BounceOut.value)
        }))
      }),
      updateBehavior: new Just({
        attrs: [x20(letterX12), y20(letterY1), fill24(hex3("#2c3e50")), opacity9(num24(1))],
        transition: new Just(transitionWith({
          duration: 500,
          delay: Nothing.value,
          staggerDelay: new Just(30),
          easing: new Just(CubicInOut.value)
        }))
      }),
      exitBehavior: new Just({
        attrs: [y20(num24(180)), opacity9(num24(0)), fill24(hex3("#e74c3c"))],
        transition: new Just(transitionWith({
          duration: 500,
          delay: Nothing.value,
          staggerDelay: new Just(40),
          easing: new Just(CubicIn.value)
        }))
      })
    });
  };
  var initFriendlyGUP = function(containerSelector) {
    var svgId = "friendly-gup-svg-" + filterAlphaNum2(containerSelector);
    var svgSelector = "#" + svgId;
    return function __do7() {
      runD3v2M(bind56(select29(containerSelector))(function(container) {
        var svgTree = withChild(named(SVG.value)("svg")([width31(num24(800)), height31(num24(500)), viewBox(0)(-50)(800)(500), attr29("id")(text29(svgId)), attr29("class")(text29("friendly-gup-demo d3svg gup"))]))(elem3(Group.value)([]));
        return bind56(renderTree116(container)(svgTree))(function() {
          return pure41(unit);
        });
      }))();
      return function(letters) {
        return runD3v2M(bind56(select29(svgSelector))(function(svg2) {
          var letterData = mapWithIndex3(function(i2) {
            return function(c2) {
              return {
                letter: singleton8(c2),
                index: toNumber(i2)
              };
            };
          })(letters);
          var tree2 = createLettersTree2(letterData);
          return bind56(renderTree216(svg2)(tree2))(function() {
            return pure41(unit);
          });
        }));
      };
    };
  };

  // output/Component.GeneralUpdatePattern/index.js
  var discard34 = /* @__PURE__ */ discard(discardUnit);
  var liftEffect35 = /* @__PURE__ */ liftEffect(monadEffectAff);
  var bind125 = /* @__PURE__ */ bind(bindAff);
  var discard115 = /* @__PURE__ */ discard34(bindAff);
  var discard211 = /* @__PURE__ */ discard34(bindHalogenM);
  var bind216 = /* @__PURE__ */ bind(bindHalogenM);
  var forever3 = /* @__PURE__ */ forever(monadRecAff);
  var modify_8 = /* @__PURE__ */ modify_(monadStateHalogenM);
  var get11 = /* @__PURE__ */ get(monadStateHalogenM);
  var pure116 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Running = /* @__PURE__ */ (function() {
    function Running2() {
    }
    ;
    Running2.value = new Running2();
    return Running2;
  })();
  var Paused = /* @__PURE__ */ (function() {
    function Paused2() {
    }
    ;
    Paused2.value = new Paused2();
    return Paused2;
  })();
  var Initialize6 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var ToggleStatus = /* @__PURE__ */ (function() {
    function ToggleStatus2() {
    }
    ;
    ToggleStatus2.value = new ToggleStatus2();
    return ToggleStatus2;
  })();
  var Finalize4 = /* @__PURE__ */ (function() {
    function Finalize6() {
    }
    ;
    Finalize6.value = new Finalize6();
    return Finalize6;
  })();
  var showStatus = {
    show: function(v2) {
      if (v2 instanceof Running) {
        return "Running";
      }
      ;
      if (v2 instanceof Paused) {
        return "Paused";
      }
      ;
      throw new Error("Failed pattern match at Component.GeneralUpdatePattern (line 32, column 1 - line 34, column 25): " + [v2.constructor.name]);
    }
  };
  var show50 = /* @__PURE__ */ show(showStatus);
  var runGeneralUpdatePattern = function(dictBind) {
    var discard311 = discard34(dictBind);
    var bind312 = bind(dictBind);
    return function(dictMonadAff) {
      var MonadEffect0 = dictMonadAff.MonadEffect0();
      var liftEffect118 = liftEffect(MonadEffect0);
      var pure214 = pure(MonadEffect0.Monad0().Applicative0());
      return discard311(log3(MonadEffect0)("General Update Pattern example (Friendly DSL)"))(function() {
        return bind312(liftEffect118(initFriendlyGUP("div.svg-container")))(function(update2) {
          return pure214(function(letters) {
            return liftEffect35(update2(letters));
          });
        });
      });
    };
  };
  var runGeneralUpdatePattern1 = /* @__PURE__ */ runGeneralUpdatePattern(bindHalogenM);
  var render10 = function(state3) {
    return div2([class_("gup-page")])([div2([class_("page-header")])([h1_([text5("General Update Pattern")]), p([class_("page-description")])([text5("A simple example of D3's enter/update/exit pattern with animated letters.")])]), div2([class_("controls-panel")])([button2([class_("control-button"), onClick(function(v2) {
      return ToggleStatus.value;
    })])([text5(show50(state3.status))])]), div2([class_("svg-container")])([]), div2([class_("info-panel")])([h3_([text5("What This Demonstrates")]), ul_([li_([text5("Enter/Update/Exit pattern - letters appear, move, and disappear")]), li_([text5("Green letters are entering (new data)")]), li_([text5("Gray letters are updating (existing data, new position)")]), li_([text5("Brown letters are exiting (removed from data)")]), li_([text5("All transitions are smoothly animated")])]), h3_([text5("Code Pattern")]), pre([class_("code-snippet")])([text5('openSelection <- openSelection letterGroup "text"\nupdateSelections <- updateJoin openSelection Text letters charToKey\n\n-- Handle each phase with transitions\nsetAttributes updateSelections.exit [classed "exit", ...]\nsetAttributes updateSelections.update [classed "update", ...]\n\nnewlyEntered <- appendTo updateSelections.enter Text []\nsetAttributes newlyEntered [classed "enter", ...]')])])]);
  };
  var getLetters = /* @__PURE__ */ liftEffect35(/* @__PURE__ */ (function() {
    var letters = toCharArray("abcdefghijklmnopqrstuvwxyz");
    var coinToss = function(c2) {
      return function __do7() {
        var n = random();
        var $49 = n > 0.6;
        if ($49) {
          return new Just(c2);
        }
        ;
        return Nothing.value;
      };
    };
    return function __do7() {
      var choices = sequence(traversableArray)(applicativeEffect)(map(functorArray)(coinToss)(letters))();
      return catMaybes(choices);
    };
  })());
  var runUpdate = function(update2) {
    return bind125(getLetters)(function(letters) {
      return discard115(update2(letters))(function() {
        return delay(2300);
      });
    });
  };
  var handleAction5 = function(dictMonadAff) {
    var log8 = log3(monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    var monadAffHalogenM2 = monadAffHalogenM(dictMonadAff);
    var runGeneralUpdatePattern2 = runGeneralUpdatePattern1(monadAffHalogenM2);
    var liftAff2 = liftAff(monadAffHalogenM2);
    return function(v2) {
      if (v2 instanceof Initialize6) {
        return discard211(log8("GeneralUpdatePattern: Initializing"))(function() {
          return bind216(runGeneralUpdatePattern2)(function(updateFn) {
            return bind216(liftAff2(forkAff(forever3(runUpdate(updateFn)))))(function(fiber) {
              return discard211(modify_8(function(s3) {
                var $51 = {};
                for (var $52 in s3) {
                  if ({}.hasOwnProperty.call(s3, $52)) {
                    $51[$52] = s3[$52];
                  }
                  ;
                }
                ;
                $51.status = Running.value;
                $51.fiber = new Just(fiber);
                $51.update = new Just(updateFn);
                return $51;
              }))(function() {
                return log8("GeneralUpdatePattern: Initialized successfully");
              });
            });
          });
        });
      }
      ;
      if (v2 instanceof ToggleStatus) {
        return bind216(get11)(function(state3) {
          if (state3.status instanceof Running) {
            return discard211(log8("Pausing updates"))(function() {
              return discard211((function() {
                if (state3.fiber instanceof Nothing) {
                  return pure116(unit);
                }
                ;
                if (state3.fiber instanceof Just) {
                  return liftAff2(killFiber(error("Cancel fiber to suspend computation"))(state3.fiber.value0));
                }
                ;
                throw new Error("Failed pattern match at Component.GeneralUpdatePattern (line 141, column 9 - line 144, column 86): " + [state3.fiber.constructor.name]);
              })())(function() {
                return modify_8(function(s3) {
                  var $57 = {};
                  for (var $58 in s3) {
                    if ({}.hasOwnProperty.call(s3, $58)) {
                      $57[$58] = s3[$58];
                    }
                    ;
                  }
                  ;
                  $57.status = Paused.value;
                  $57.fiber = Nothing.value;
                  return $57;
                });
              });
            });
          }
          ;
          if (state3.status instanceof Paused) {
            return discard211(log8("Starting updates"))(function() {
              if (state3.update instanceof Nothing) {
                return pure116(unit);
              }
              ;
              if (state3.update instanceof Just) {
                return bind216(liftAff2(forkAff(forever3(runUpdate(state3.update.value0)))))(function(fiber) {
                  return modify_8(function(s3) {
                    var $61 = {};
                    for (var $62 in s3) {
                      if ({}.hasOwnProperty.call(s3, $62)) {
                        $61[$62] = s3[$62];
                      }
                      ;
                    }
                    ;
                    $61.status = Running.value;
                    $61.fiber = new Just(fiber);
                    return $61;
                  });
                });
              }
              ;
              throw new Error("Failed pattern match at Component.GeneralUpdatePattern (line 148, column 9 - line 152, column 71): " + [state3.update.constructor.name]);
            });
          }
          ;
          throw new Error("Failed pattern match at Component.GeneralUpdatePattern (line 138, column 5 - line 152, column 71): " + [state3.status.constructor.name]);
        });
      }
      ;
      if (v2 instanceof Finalize4) {
        return discard211(log8("GeneralUpdatePattern: Finalizing"))(function() {
          return bind216(get11)(function(state3) {
            return discard211((function() {
              if (state3.fiber instanceof Nothing) {
                return pure116(unit);
              }
              ;
              if (state3.fiber instanceof Just) {
                return liftAff2(killFiber(error("Cancelling fiber and terminating computation"))(state3.fiber.value0));
              }
              ;
              throw new Error("Failed pattern match at Component.GeneralUpdatePattern (line 157, column 5 - line 159, column 103): " + [state3.fiber.constructor.name]);
            })())(function() {
              return modify_8(function(s3) {
                var $67 = {};
                for (var $68 in s3) {
                  if ({}.hasOwnProperty.call(s3, $68)) {
                    $67[$68] = s3[$68];
                  }
                  ;
                }
                ;
                $67.status = Paused.value;
                $67.fiber = Nothing.value;
                $67.update = Nothing.value;
                return $67;
              });
            });
          });
        });
      }
      ;
      throw new Error("Failed pattern match at Component.GeneralUpdatePattern (line 128, column 16 - line 160, column 77): " + [v2.constructor.name]);
    };
  };
  var component6 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return {
          status: Paused.value,
          fiber: Nothing.value,
          update: Nothing.value
        };
      },
      render: render10,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        handleAction: handleAction5(dictMonadAff),
        initialize: new Just(Initialize6.value),
        finalize: new Just(Finalize4.value)
      })
    });
  };

  // output/D3.Viz.FPFTW.ScalesDemo/foreign.js
  var extent = (data, accessor) => {
    const values2 = data.map(accessor);
    return [Math.min(...values2), Math.max(...values2)];
  };
  function drawGradientStrip_(selector) {
    return function(label5) {
      return function(colors5) {
        return function() {
          const container = select_default2(selector);
          if (container.empty()) {
            console.warn("ScalesDemo: selector not found:", selector);
            return;
          }
          const width47 = 400;
          const height47 = 30;
          const labelWidth = 120;
          const svg2 = container.append("svg").attr("width", width47 + labelWidth).attr("height", height47 + 10).style("display", "block").style("margin", "5px auto");
          svg2.append("text").attr("x", 0).attr("y", height47 / 2 + 5).attr("font-size", "12px").attr("font-family", "monospace").attr("fill", "#666").text(label5);
          const rectWidth = width47 / colors5.length;
          svg2.selectAll("rect").data(colors5).enter().append("rect").attr("x", (d, i2) => labelWidth + i2 * rectWidth).attr("y", 0).attr("width", rectWidth + 1).attr("height", height47).attr("fill", (d) => d);
        };
      };
    };
  }
  function drawPipelineDiagram_(selector) {
    return function(data) {
      return function() {
        const container = select_default2(selector);
        if (container.empty()) {
          console.warn("ScalesDemo: selector not found:", selector);
          return;
        }
        const width47 = 500;
        const height47 = 120;
        const margin = { top: 20, right: 20, bottom: 40, left: 20 };
        const innerWidth8 = width47 - margin.left - margin.right;
        const svg2 = container.append("svg").attr("width", width47).attr("height", height47).style("display", "block").style("margin", "20px auto");
        const g2 = svg2.append("g").attr("transform", `translate(${margin.left},${margin.top})`);
        const xScale = linear3().domain(extent(data, (d) => d.x)).range([0, innerWidth8]);
        g2.append("line").attr("x1", 0).attr("x2", innerWidth8).attr("y1", 25).attr("y2", 25).attr("stroke", "#ccc").attr("stroke-width", 2).attr("marker-end", "url(#arrow)");
        svg2.append("defs").append("marker").attr("id", "arrow").attr("viewBox", "0 -5 10 10").attr("refX", 8).attr("refY", 0).attr("markerWidth", 6).attr("markerHeight", 6).attr("orient", "auto").append("path").attr("d", "M0,-5L10,0L0,5").attr("fill", "#ccc");
        const nodes3 = g2.selectAll(".node").data(data).enter().append("g").attr("class", "node").attr("transform", (d) => `translate(${xScale(d.x)},25)`);
        nodes3.append("circle").attr("r", 15).attr("fill", (d) => d.color).attr("stroke", "#fff").attr("stroke-width", 2);
        nodes3.append("text").attr("y", 35).attr("text-anchor", "middle").attr("font-size", "11px").attr("font-family", "monospace").attr("fill", "#666").text((d) => d.label);
        g2.append("text").attr("x", innerWidth8 / 2).attr("y", -5).attr("text-anchor", "middle").attr("font-size", "12px").attr("font-weight", "bold").attr("fill", "#333").text("Temperature \u2192 Normalize \u2192 Color");
      };
    };
  }

  // output/PSD3.Scale/foreign.js
  var linear4 = linear3();
  var log7 = log5();
  var pow4 = pow3();
  var sqrt4 = sqrt3();
  var symlog2 = symlog();
  var scaleTime_ = time2();
  var scaleUtc_ = utcTime();
  var scaleQuantize = quantize();
  var scaleQuantile = quantile2();
  var ordinal2 = ordinal();
  var band2 = band();
  var point2 = point();
  function domain(d) {
    return function(scale) {
      return scale.copy().domain(d);
    };
  }
  function range5(r29) {
    return function(scale) {
      return scale.copy().range(r29);
    };
  }
  function nice2(scale) {
    return scale.copy().nice();
  }
  function applyScale2(scale) {
    return function(value20) {
      return scale(value20);
    };
  }
  function invertImpl(scale) {
    return function(value20) {
      if (typeof scale.invert === "function") {
        const result = scale.invert(value20);
        if (result !== void 0 && !isNaN(result)) {
          return result;
        }
      }
      return null;
    };
  }
  function ticks2(count) {
    return function(scale) {
      if (typeof scale.ticks === "function") {
        return scale.ticks(count);
      }
      return scale.domain();
    };
  }
  function schemeCategory10At(index7) {
    return category10_default[Math.abs(index7) % 10];
  }

  // output/PSD3.Scale/index.js
  var invert = function(scale) {
    return function(value20) {
      return toMaybe(invertImpl(scale)(value20));
    };
  };

  // output/PSD3.Scale.FP/foreign.js
  var createLinear = linear3();

  // output/PSD3.Scale.FP/index.js
  var normalize3 = function(minVal) {
    return function(maxVal) {
      return domain([minVal, maxVal])(range5([0, 1])(createLinear));
    };
  };

  // output/D3.Viz.FPFTW.ScalesDemo/index.js
  var mapFlipped8 = /* @__PURE__ */ mapFlipped(functorArray);
  var show51 = /* @__PURE__ */ show(showNumber);
  var drawScalePipeline = function(selector) {
    var temps = [-10, 0, 15, 25, 40];
    var normalizer = normalize3(-10)(40);
    var normalized = mapFlipped8(temps)(applyScale2(normalizer));
    var colors5 = mapFlipped8(normalized)(RdYlGn_default);
    var pipelineData = zipWith2(function(temp) {
      return function(color2) {
        return {
          x: temp,
          label: show51(temp) + "\xB0C",
          color: color2
        };
      };
    })(temps)(colors5);
    return drawPipelineDiagram_(selector)(pipelineData);
  };
  var drawGradientComparison = function(selector) {
    var viridisColors = mapFlipped8(range2(0)(99))(function(i2) {
      return viridis_default(toNumber(i2) / 99);
    });
    var plasmaColors = mapFlipped8(range2(0)(99))(function(i2) {
      return plasma(toNumber(i2) / 99);
    });
    var infernoColors = mapFlipped8(range2(0)(99))(function(i2) {
      return inferno(toNumber(i2) / 99);
    });
    var turboColors = mapFlipped8(range2(0)(99))(function(i2) {
      return turbo_default(toNumber(i2) / 99);
    });
    var rdYlGnColors = mapFlipped8(range2(0)(99))(function(i2) {
      return RdYlGn_default(toNumber(i2) / 99);
    });
    return function __do7() {
      drawGradientStrip_(selector + "-viridis")("Viridis")(viridisColors)();
      drawGradientStrip_(selector + "-plasma")("Plasma")(plasmaColors)();
      drawGradientStrip_(selector + "-inferno")("Inferno")(infernoColors)();
      drawGradientStrip_(selector + "-turbo")("Turbo")(turboColors)();
      return drawGradientStrip_(selector + "-rdylgn")("RdYlGn (Diverging)")(rdYlGnColors)();
    };
  };

  // output/Component.HowTo.HowtoAxesScales/index.js
  var discard35 = /* @__PURE__ */ discard(discardUnit)(bindHalogenM);
  var pure42 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize7 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var render11 = function(v2) {
    return div2([classes(["tutorial-page"])])([render4({
      logoSize: Large.value,
      quadrant: QuadHowTo.value,
      prevNext: Nothing.value,
      pageTitle: Nothing.value
    }), main_([section([classes(["tutorial-section", "tutorial-intro"])])([h1([classes(["tutorial-title"])])([text5("Scales: The PSD3 Way")]), p_([text5("PSD3 provides a comprehensive, type-safe Scale module with full D3 parity plus functional programming idioms. Scales transform data from a domain (input) to a range (output).")])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Quick Start")]), pre([classes(["code-block"])])([code_([text5("import PSD3.Scale (linear, domain, range, applyScale, ticks)\n\n-- Create a linear scale\nxScale = linear\n  # domain [0.0, 100.0]\n  # range [0.0, 800.0]\n\n-- Apply it\npixelX = applyScale xScale 50.0  -- Returns 400.0\n\n-- Get tick marks for an axis\ntickValues = ticks 10 xScale     -- [0, 10, 20, ..., 100]")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Scale Types")]), h3_([text5("Continuous Scales")]), p_([text5("Map continuous domain to continuous range:")]), pre([classes(["code-block"])])([code_([text5("-- Linear (most common)\nlinear # domain [0.0, 100.0] # range [0.0, 500.0]\n\n-- Logarithmic (for exponential data)\nlog # domain [1.0, 1000.0] # range [0.0, 300.0]\n\n-- Power/Square root (for area scaling)\nsqrt # domain [0.0, maxValue] # range [0.0, 50.0]\n\n-- Symlog (handles negative values and zero)\nsymlog # constant 1.0 # domain [-100.0, 100.0] # range [0.0, 500.0]")])]), h3_([text5("Band Scales (for bar charts)")]), pre([classes(["code-block"])])([code_([text5('-- Band scale with padding\nxScale = band\n  # domain ["Mon", "Tue", "Wed", "Thu", "Fri"]\n  # range [0.0, 500.0]\n  # padding 0.1\n\n-- Get bar position and width\nbarX = applyScale xScale "Wed"\nbarWidth = bandwidth xScale')])]), h3_([text5("Ordinal Scales (categorical \u2192 categorical)")]), pre([classes(["code-block"])])([code_([text5('-- Map categories to colors\ncolorScale = ordinal\n  # domain ["A", "B", "C"]\n  # range ["red", "green", "blue"]\n\ncolor = applyScale colorScale "B"  -- "green" ')])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Color Interpolators")]), p_([text5("Built-in color interpolators take a value in [0, 1] and return a color:")]), div2([id3("gradient-demo"), style("margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;")])([div2([id3("gradient-demo-viridis")])([]), div2([id3("gradient-demo-plasma")])([]), div2([id3("gradient-demo-inferno")])([]), div2([id3("gradient-demo-turbo")])([]), div2([id3("gradient-demo-rdylgn")])([])]), pre([classes(["code-block"])])([code_([text5("import PSD3.Scale (interpolateViridis, interpolatePlasma, interpolateRdYlGn)\n\n-- Sequential (for continuous data)\nfill (\\\\d -> interpolateViridis (d.value / maxValue))\n\n-- Diverging (for data with meaningful midpoint)\nfill (\\\\d -> interpolateRdYlGn ((d.change + 1.0) / 2.0))\n\n-- Use with sample for gradients\ncolors = Array.range 0 99 <#> \\\\i -> interpolateViridis (toNumber i / 99.0)")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Scale Composition (FP Power!)")]), p_([text5("Scales compose beautifully. Here's a pipeline: raw data \u2192 normalize \u2192 color:")]), div2([id3("pipeline-demo"), style("margin: 20px 0;")])([]), pre([classes(["code-block"])])([code_([text5("import PSD3.Scale (andThen, contramap, map)\nimport PSD3.Scale.FP (normalize)\n\n-- Compose scales with andThen\ntempToColor = normalize (-10.0) 40.0 `andThen` interpolateRdYlGn\n\n-- Or use contramap/map for transformations\ncelsiusScale = fahrenheitScale # contramap celsiusToFahrenheit\noffsetScale = pixelScale # map (_ + margin)\n\n-- Full dimap (profunctor-like)\ntransformed = scale # dimap preprocess postprocess")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Scale Configuration")]), p_([text5("All configuration returns a new scale (immutable API):")]), pre([classes(["code-block"])])([code_([text5("-- Chain configurations with #\nmyScale = linear\n  # domain [0.0, 100.0]\n  # range [0.0, 500.0]\n  # nice           -- Round domain to nice values\n  # clamp true     -- Constrain output to range\n\n-- Use modifiers from PSD3.Scale.FP\nimport PSD3.Scale.FP (niceModifier, clampModifier, combineModifiers)\n\ncombined = combineModifiers [niceModifier, clampModifier]\nmyScale = linear # combined # domain [...] # range [...]")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Scale Operations")]), pre([classes(["code-block"])])([code_([text5('-- Apply scale\ny = applyScale scale x\n\n-- Invert (range \u2192 domain)\ncase invert scale pixelY of\n  Just dataY -> -- use dataY\n  Nothing -> -- out of range\n\n-- Generate tick values\ntickVals = ticks 10 scale\n\n-- Format ticks\nformatter = tickFormat 10 ".1f" scale\nlabels = tickVals <#> formatter\n\n-- Band scale specifics\nbarWidth = bandwidth bandScale\nstepSize = step bandScale')])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Key Points")]), ul_([li_([strong_([text5("Type-safe: ")]), text5("Phantom types track scale kind (Continuous, Band, etc.)")]), li_([strong_([text5("Immutable: ")]), text5("Configuration returns new scales, safe to share")]), li_([strong_([text5("Composable: ")]), text5("Use andThen, contramap, map, dimap")]), li_([strong_([text5("Full D3 parity: ")]), text5("All D3 scale types and methods available")]), li_([strong_([text5("FP extras: ")]), text5("PSD3.Scale.FP adds sampling, modifiers, utilities")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("See Also")]), ul_([li_([code_([text5("PSD3.Scale")]), text5(" - Core scale module")]), li_([code_([text5("PSD3.Scale.FP")]), text5(" - Functional programming abstractions")]), li_([a([href4("#" + routeToPath(TourFPFTW.value))])([text5("FP For The Win Tour")]), text5(" - See scales as profunctors in action")])])])])]);
  };
  var handleAction6 = function(dictMonadAff) {
    var liftAff2 = liftAff(monadAffHalogenM(dictMonadAff));
    var liftEffect54 = liftEffect(monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    return function(v2) {
      return discard35(liftAff2(delay(100)))(function() {
        return discard35(liftEffect54(drawGradientComparison("#gradient-demo")))(function() {
          return discard35(liftEffect54(drawScalePipeline("#pipeline-demo")))(function() {
            return pure42(unit);
          });
        });
      });
    };
  };
  var component7 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render11,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction6(dictMonadAff),
        initialize: new Just(Initialize7.value)
      })
    });
  };

  // output/Component.HowTo.HowtoDebugging/index.js
  var pure43 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize8 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var render12 = function(v2) {
    return div2([classes(["tutorial-page"])])([render4({
      logoSize: Large.value,
      quadrant: QuadHowTo.value,
      prevNext: Nothing.value,
      pageTitle: Nothing.value
    }), main_([section([classes(["tutorial-section", "tutorial-intro"])])([h1([classes(["tutorial-title"])])([text5("Debugging Visualizations")]), p_([text5("Techniques for finding and fixing visualization issues.")])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Console Logging")]), p_([text5("Log data in attribute functions:")]), pre([classes(["code-block"])])([code_([text5('import Effect.Console (log)\nimport Effect.Unsafe (unsafePerformEffect)\n\n-- Debug attribute values\nfill (\\\\d -> unsafePerformEffect do\n  log $ "Node: " <> show d.id <> ", value: " <> show d.value\n  pure $ colorScale d.value\n)')])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Browser DevTools")]), ul_([li_([strong_([text5("Elements panel")]), text5(" - Inspect SVG structure and attributes")]), li_([strong_([text5("$0.__data__")]), text5(" - View bound data on selected element")]), li_([strong_([text5("Network tab")]), text5(" - Verify data loading")]), li_([strong_([text5("Performance tab")]), text5(" - Profile slow renders")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Mermaid Diagrams")]), p_([text5("Visualize tree structure with Mermaid interpreter:")]), pre([classes(["code-block"])])([code_([text5("-- Generate Mermaid code from TreeAPI tree\nlet mermaidCode = runMermaidInterpreter myTree\n\n-- Copy to https://mermaid.live to visualize structure")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Common Issues")]), ul_([li_([strong_([text5("Nothing renders")]), text5(" - Check container exists, SVG has size")]), li_([strong_([text5("Elements at origin")]), text5(" - Verify coordinate attributes (cx, cy, x, y)")]), li_([strong_([text5("Wrong colors")]), text5(" - Check scale domain/range, normalize values to 0-1")]), li_([strong_([text5("No data binding")]), text5(" - Use joinData, check key function")]), li_([strong_([text5("Type errors")]), text5(" - Ensure datum type matches selection")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Key Points")]), ul_([li_([strong_([text5("unsafePerformEffect")]), text5(" - Escape hatch for logging")]), li_([strong_([text5("$0.__data__")]), text5(" - Console access to bound data")]), li_([strong_([text5("Mermaid interpreter")]), text5(" - Visualize tree structure")]), li_([strong_([text5("Check dimensions")]), text5(" - SVG needs viewBox or width/height")])])])])]);
  };
  var handleAction7 = function(dictMonadAff) {
    return function(v2) {
      return pure43(unit);
    };
  };
  var component8 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render12,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction7(dictMonadAff),
        initialize: new Just(Initialize8.value)
      })
    });
  };

  // output/Component.HowTo.HowtoEvents/index.js
  var pure44 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize9 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var render13 = function(v2) {
    return div2([classes(["tutorial-page"])])([render4({
      logoSize: Large.value,
      quadrant: QuadHowTo.value,
      prevNext: Nothing.value,
      pageTitle: Nothing.value
    }), main_([section([classes(["tutorial-section", "tutorial-intro"])])([h1([classes(["tutorial-title"])])([text5("Responding to User Events")]), p_([text5("PSD3 provides type-safe event handlers. Use the 'on' function to attach behaviors to selections.")])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Click Handlers")]), p_([text5("Access the bound datum when an element is clicked:")]), pre([classes(["code-block"])])([code_([text5('import PSD3.Internal.Behavior.Types (onClickWithDatum)\n\ncircles <- append Circle [fill "blue", radius 20.0] container\n_ <- on (onClickWithDatum \\\\d -> log ("Clicked: " <> d.name)) circles')])]), p_([text5("Without datum access:")]), pre([classes(["code-block"])])([code_([text5('import PSD3.Internal.Behavior.Types (onClick)\n\n_ <- on (onClick (log "Button clicked!")) button')])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Hover Effects")]), p_([text5("Simple enter/leave handlers:")]), pre([classes(["code-block"])])([code_([text5("import PSD3.Internal.Behavior.Types (onMouseEnter, onMouseLeave)\n\n_ <- on (onMouseEnter \\\\d -> highlightNode d) circles\n_ <- on (onMouseLeave \\\\_ -> clearHighlight) circles")])]), p_([text5("Built-in style changes with onHover:")]), pre([classes(["code-block"])])([code_([text5('import PSD3.Internal.Behavior.Types (onHover)\n\n_ <- on (onHover\n  { enter: [{ attr: "stroke", value: "#333" }, { attr: "stroke-width", value: "3" }]\n  , leave: [{ attr: "stroke", value: "#ddd" }, { attr: "stroke-width", value: "1.5" }]\n  }) lines')])]), p_([text5("With mouse coordinates (for tooltips):")]), pre([classes(["code-block"])])([code_([text5("import PSD3.Internal.Behavior.Types (onMouseEnterWithInfo)\n\n_ <- on (onMouseEnterWithInfo \\\\info -> do\n  -- info.datum: bound data\n  -- info.pageX/pageY: document coordinates\n  -- info.offsetX/offsetY: element coordinates\n  showTooltip info.datum info.pageX info.pageY\n) circles")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Drag & Zoom")]), p_([text5("Simple drag behavior:")]), pre([classes(["code-block"])])([code_([text5("import PSD3.Internal.Behavior.Types (Drag(..), defaultDrag)\n\n_ <- on (Drag defaultDrag) draggableElement")])]), p_([text5("Force simulation drag (reheats on drag):")]), pre([classes(["code-block"])])([code_([text5('import PSD3.Internal.Behavior.Types (Drag(..), simulationDrag)\n\n_ <- on (Drag (simulationDrag "my-simulation-id")) nodes')])]), p_([text5("Pan and zoom:")]), pre([classes(["code-block"])])([code_([text5('import PSD3.Internal.Behavior.Types (Zoom(..), defaultZoom, ScaleExtent(..))\n\n-- Attach to outer SVG, transforms inner group\n_ <- on (Zoom (defaultZoom (ScaleExtent 0.5 4.0) ".zoom-group")) svg')])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Key Points")]), ul_([li_([strong_([text5("Type-safe")]), text5(" - Datum type flows through handlers")]), li_([strong_([text5("MouseEventInfo")]), text5(" - Contains datum + all coordinates")]), li_([strong_([text5("Combine behaviors")]), text5(" - Attach multiple with separate 'on' calls")]), li_([strong_([text5("simulationDrag")]), text5(" - Auto-reheats force simulation")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Real Example")]), p_([text5("See the Code Explorer implementation:")]), ul_([li_([code_([text5("src/website/Viz/Spago/Render.purs:81-96")]), text5(" - Drag, click, hover behaviors")]), li_([code_([text5("src/lib/PSD3/Behavior/Types.purs")]), text5(" - All behavior types with docs")])])])])]);
  };
  var handleAction8 = function(dictMonadAff) {
    return function(v2) {
      return pure44(unit);
    };
  };
  var component9 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render13,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction8(dictMonadAff),
        initialize: new Just(Initialize9.value)
      })
    });
  };

  // output/Component.HowTo.HowtoForceGraphs/index.js
  var pure45 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize10 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var render14 = function(v2) {
    return div2([classes(["tutorial-page"])])([render4({
      logoSize: Large.value,
      quadrant: QuadHowTo.value,
      prevNext: Nothing.value,
      pageTitle: Nothing.value
    }), main_([section([classes(["tutorial-section", "tutorial-intro"])])([h1([classes(["tutorial-title"])])([text5("Building Force-Directed Graphs")]), p_([strong_([text5("Recommended: ")]), text5("Use the SimulationManager pattern. See "), a([href4("#/force-playground")])([text5("Force Playground")]), text5(" for an interactive example.")]), p_([text5("The documentation below covers the type-class based API (SimulationM/SimulationM2) which is still available.")])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Initialize Simulation")]), p_([text5("Create a force simulation with nodes and links:")]), pre([classes(["code-block"])])([code_([text5('import PSD3.Internal.Capabilities.Simulation (class SimulationM, init, addTickFunction, start, Step(..))\n\n{ nodes, links } <- init\n  { nodes: myNodeData\n  , links: myLinkData\n  , forces: [centerForce w h, chargeForce (const (-100.0)), linkForce]\n  , activeForces: Set.fromFoldable ["center", "charge", "link"]\n  , config: defaultSimConfig\n  , keyFn: _.id\n  , ticks: Map.empty\n  }')])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Tick Functions")]), p_([text5("Register callbacks to update DOM on each simulation tick:")]), pre([classes(["code-block"])])([code_([text5('-- Update node positions\naddTickFunction "nodes" $ Step nodeCircles\n  [ cx (_.x)\n  , cy (_.y)\n  ]\n\n-- Update link positions\naddTickFunction "links" $ Step linkLines\n  [ x1 (\\\\l -> l.source.x)\n  , y1 (\\\\l -> l.source.y)\n  , x2 (\\\\l -> l.target.x)\n  , y2 (\\\\l -> l.target.y)\n  ]\n\nstart -- Begin animation')])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Available Forces")]), ul_([li_([strong_([text5("centerForce")]), text5(" - Keep nodes centered")]), li_([strong_([text5("chargeForce")]), text5(" - Repulsion/attraction between nodes")]), li_([strong_([text5("linkForce")]), text5(" - Springs between connected nodes")]), li_([strong_([text5("collideForce")]), text5(" - Prevent node overlap")]), li_([strong_([text5("forceX/Y")]), text5(" - Push toward position")]), li_([strong_([text5("radialForce")]), text5(" - Push toward circle")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Dynamic Updates")]), p_([text5("Use SimulationM2 for dynamic data changes:")]), pre([classes(["code-block"])])([code_([text5("import PSD3.Internal.Capabilities.Simulation (class SimulationM2, update, reheat)\n\n{ nodes, links } <- update\n  { nodes: Just newNodeArray\n  , links: Just newLinkArray\n  , nodeFilter: Nothing\n  , linkFilter: Nothing\n  , activeForces: Nothing\n  , config: Nothing\n  , keyFn: _.id\n  }\n\nreheat 0.7  -- Re-energize simulation\nstart       -- Begin animation")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Node Dragging")]), p_([text5("Enable simulation-aware drag:")]), pre([classes(["code-block"])])([code_([text5('import PSD3.Internal.Behavior.Types (Drag(..), simulationDrag)\n\n-- Drag reheats simulation automatically\n_ <- on (Drag (simulationDrag "my-simulation-id")) nodeCircles')])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Key Points")]), ul_([li_([strong_([text5("SimulationM")]), text5(" - Static simulations")]), li_([strong_([text5("SimulationM2")]), text5(" - Adds update/reheat for dynamic data")]), li_([strong_([text5("Step")]), text5(" - Maps selection to tick attributes")]), li_([strong_([text5("activeForces")]), text5(" - Control which forces are enabled")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Real Examples")]), p_([text5("See force simulation in action:")]), ul_([li_([a([href4("#/force-playground")])([text5("Force Playground")]), text5(" - Interactive force simulation with multiple datasets")]), li_([a([href4("#/simple-force-graph")])([text5("Simple Force Graph")]), text5(" - Minimal force-directed graph example")])])])])]);
  };
  var handleAction9 = function(dictMonadAff) {
    return function(v2) {
      return pure45(unit);
    };
  };
  var component10 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render14,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction9(dictMonadAff),
        initialize: new Just(Initialize10.value)
      })
    });
  };

  // output/Component.HowTo.HowtoHierarchical/index.js
  var pure46 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize11 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var render15 = function(v2) {
    return div2([classes(["tutorial-page"])])([render4({
      logoSize: Large.value,
      quadrant: QuadHowTo.value,
      prevNext: Nothing.value,
      pageTitle: Nothing.value
    }), main_([section([classes(["tutorial-section", "tutorial-intro"])])([h1([classes(["tutorial-title"])])([text5("Working with Hierarchical Data")]), p_([text5("PSD3 supports D3's hierarchy layouts for trees, clusters, and treemaps.")])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Creating Hierarchy")]), p_([text5("Convert JSON to d3.hierarchy via FFI:")]), pre([classes(["code-block"])])([code_([text5("-- JavaScript FFI\nexport const hierarchy_ = data => () => d3.hierarchy(data);\nexport const descendants_ = root => root.descendants();\nexport const links_ = root => root.links();\n\n-- PureScript\nforeign import hierarchy_ :: Json -> Effect HierarchyNode\nforeign import descendants_ :: HierarchyNode -> Array HierarchyNode\nforeign import links_ :: HierarchyNode -> Array HierarchyLink\n\nroot <- liftEffect $ hierarchy_ jsonData\nlet nodes = descendants_ root\nlet links = links_ root")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Layout Functions")]), p_([text5("Apply layouts to compute positions:")]), pre([classes(["code-block"])])([code_([text5("-- Tree layout (neat spacing)\nexport const tree_ = width => height => () =>\n  d3.tree().size([height, width]);\n\n-- Cluster layout (leaves aligned)\nexport const cluster_ = width => height => () =>\n  d3.cluster().size([height, width]);\n\n-- Treemap layout (space-filling)\nexport const treemap_ = width => height => () =>\n  d3.treemap().size([width, height]).padding(1);\n\n-- Apply layout to hierarchy\nexport const applyLayout_ = layout => root => () => layout(root);")])]), p_([text5("After layout, nodes have x/y coordinates:")]), pre([classes(["code-block"])])([code_([text5("treeLayout <- liftEffect $ tree_ width height\nliftEffect $ applyLayout_ treeLayout root\n\n-- Now render nodes at computed positions\ncircles <- append Circle\n  [ cx (_.y)  -- Note: tree layout swaps x/y\n  , cy (_.x)\n  , radius 5.0\n  ] nodeEnter")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Drawing Links")]), p_([text5("Generate curved paths for tree connections:")]), pre([classes(["code-block"])])([code_([text5('-- Horizontal curved links (for tree layout)\nexport const linkHorizontal_ = d3.linkHorizontal()\n  .x(d => d.y)\n  .y(d => d.x);\n\n-- PureScript\npaths <- append Path\n  [ d (\\\\link -> linkHorizontal_ link)\n  , stroke "#999"\n  , fill "none"\n  ] linkEnter')])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Key Points")]), ul_([li_([strong_([text5("hierarchy()")]), text5(" - Converts JSON to hierarchy nodes")]), li_([strong_([text5("descendants()/links()")]), text5(" - Get flat arrays for data binding")]), li_([strong_([text5("tree/cluster layouts")]), text5(" - Swap x/y in coordinates")]), li_([strong_([text5("linkHorizontal/Vertical")]), text5(" - Curved path generators")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Real Example")]), p_([text5("See hierarchical layouts:")]), ul_([li_([code_([text5("src/website/Viz/TreeAPI/LesMisTreeExample.purs")]), text5(" - Tree visualization")]), li_([code_([text5("src/website/Component/AnimatedTreeCluster.purs")]), text5(" - Animated transitions")])])])])]);
  };
  var handleAction10 = function(dictMonadAff) {
    return function(v2) {
      return pure46(unit);
    };
  };
  var component11 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render15,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction10(dictMonadAff),
        initialize: new Just(Initialize11.value)
      })
    });
  };

  // output/Component.HowTo.HowtoLoadingData/index.js
  var pure47 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize12 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var render16 = function(v2) {
    return div2([classes(["tutorial-page"])])([render4({
      logoSize: Large.value,
      quadrant: QuadHowTo.value,
      prevNext: Nothing.value,
      pageTitle: Nothing.value
    }), main_([section([classes(["tutorial-section", "tutorial-intro"])])([h1([classes(["tutorial-title"])])([text5("Loading External Data")]), p_([text5("PSD3 uses Affjax for async data loading with configurable strategies.")])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Simple JSON Loading")]), p_([text5("Load JSON with automatic error fallback:")]), pre([classes(["code-block"])])([code_([text5('import PSD3.Shared.DataLoader (simpleLoadJSON)\n\njson <- H.liftAff $ simpleLoadJSON "data/les-miserables.json"\n-- Returns fallback on error, never throws')])]), p_([text5("With explicit error handling:")]), pre([classes(["code-block"])])([code_([text5('import PSD3.Shared.DataLoader (loadJSON, defaultConfig, LoadError(..))\n\nresult <- H.liftAff $ loadJSON defaultConfig "data/graph.json"\ncase result of\n  Left (NetworkError msg) -> log ("Network error: " <> msg)\n  Left (ParseError msg) -> log ("Parse error: " <> msg)\n  Right json -> processData json')])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Load Strategies")]), p_([text5("Configure where to load data from:")]), pre([classes(["code-block"])])([code_([text5('import PSD3.Shared.DataLoader (loadJSON, LoadStrategy(..), LoadConfig)\n\n-- Local only (bundled files)\nlet localConfig = { strategy: LocalOnly, baseUrl: Nothing }\n\n-- Remote only (requires server)\nlet remoteConfig = { strategy: RemoteOnly, baseUrl: Just "http://localhost:8080" }\n\n-- Try local first, fallback to remote\nlet hybridConfig = { strategy: LocalFirst, baseUrl: Just "http://localhost:8080" }\n\njson <- H.liftAff $ loadJSON hybridConfig "data/graph.json\\"')])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("CSV Loading")]), p_([text5("Load CSV data as Foreign array:")]), pre([classes(["code-block"])])([code_([text5('import PSD3.Shared.DataLoader (simpleLoadCSV, loadCSV)\nimport Foreign (Foreign)\n\n-- Simple loading with empty array fallback\nrows <- H.liftAff $ simpleLoadCSV "data/population.csv"\n\n-- With error handling\nresult <- H.liftAff $ loadCSV defaultConfig "data/timeseries.csv"\ncase result of\n  Left err -> log (show err)\n  Right rows -> processRows rows')])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Halogen Pattern")]), p_([text5("Common pattern for loading in component initialization:")]), pre([classes(["code-block"])])([code_([text5('data State = { loading :: Boolean, graphData :: Maybe GraphData }\n\nhandleAction = case _ of\n  Initialize -> do\n    H.modify_ _ { loading = true }\n    json <- H.liftAff $ simpleLoadJSON "data/graph.json"\n    let graphData = decodeGraphData json\n    H.modify_ _ { loading = false, graphData = Just graphData }\n\nrender state\n  | state.loading = HH.div_ [ HH.text "Loading..." ]\n  | otherwise = renderVisualization state.graphData')])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Key Points")]), ul_([li_([strong_([text5("Aff-based")]), text5(" - Use H.liftAff to run in Halogen")]), li_([strong_([text5("Strategies")]), text5(" - LocalOnly, RemoteOnly, LocalFirst, RemoteFirst")]), li_([strong_([text5("Error types")]), text5(" - NetworkError, ParseError, FileNotFound, ConfigError")]), li_([strong_([text5("simple* helpers")]), text5(" - Return fallbacks instead of Either")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Real Example")]), p_([text5("See data loading in action:")]), ul_([li_([code_([text5("src/website/Shared/DataLoader.purs")]), text5(" - Full DataLoader module")]), li_([code_([text5("src/website/Component/Showcase/ForcePlayground.purs")]), text5(" - Loading network dataset JSON files")])])])])]);
  };
  var handleAction11 = function(dictMonadAff) {
    return function(v2) {
      return pure47(unit);
    };
  };
  var component12 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render16,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction11(dictMonadAff),
        initialize: new Just(Initialize12.value)
      })
    });
  };

  // output/Component.HowTo.HowtoPerformance/index.js
  var pure48 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize13 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var render17 = function(v2) {
    return div2([classes(["tutorial-page"])])([render4({
      logoSize: Large.value,
      quadrant: QuadHowTo.value,
      prevNext: Nothing.value,
      pageTitle: Nothing.value
    }), main_([section([classes(["tutorial-section", "tutorial-intro"])])([h1([classes(["tutorial-title"])])([text5("Performance Optimization")]), p_([text5("Tips for fast, smooth visualizations with large datasets.")])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Reduce DOM Elements")]), ul_([li_([strong_([text5("Sample data")]), text5(" - Random sample for preview, full for export")]), li_([strong_([text5("Aggregate")]), text5(" - Bin/group data points")]), li_([strong_([text5("Filter visually")]), text5(" - Hide offscreen elements")]), li_([strong_([text5("Canvas")]), text5(" - Consider d3-canvas for 10k+ elements")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Minimize Updates")]), p_([text5("Batch DOM mutations:")]), pre([classes(["code-block"])])([code_([text5("-- Good: Set multiple attributes at once\nsetAttrs [cx newX, cy newY, fill newColor] circles\n\n-- Avoid: Multiple separate setAttrs calls\n-- Each call triggers layout recalculation")])]), p_([text5("Debounce rapid updates:")]), pre([classes(["code-block"])])([code_([text5("-- Only update after user stops resizing\nwindow.addEventListener('resize', debounce(updateChart, 150))")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Force Simulation Tips")]), ul_([li_([strong_([text5("Minimal tick attrs")]), text5(" - Only update position, not style")]), li_([strong_([text5("Alpha decay")]), text5(" - Higher decay = faster cooldown")]), li_([strong_([text5("Stop when idle")]), text5(" - Call stop() when alpha reaches min")])]), pre([classes(["code-block"])])([code_([text5(`-- Minimal tick: just positions
addTickFunction "nodes" $ Step circles [cx (_.x), cy (_.y)]

-- Don't recalculate colors on every frame!`)])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("CSS vs D3 Transitions")]), p_([text5("CSS transitions are often faster for simple changes:")]), pre([classes(["code-block"])])([code_([text5(".node circle {\n  transition: fill 0.2s ease, opacity 0.2s ease;\n}\n\n/* PSD3 just toggles class, CSS handles animation */\n.node.highlighted circle { fill: #fbbf24; }")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Key Points")]), ul_([li_([strong_([text5("< 1000 elements")]), text5(" - SVG fine, no optimization needed")]), li_([strong_([text5("1000-5000 elements")]), text5(" - Optimize tick functions, batch updates")]), li_([strong_([text5("> 5000 elements")]), text5(" - Consider Canvas, sampling, or aggregation")]), li_([strong_([text5("Profile first")]), text5(" - Use DevTools Performance tab")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Real Example")]), p_([text5("See performance optimization in action:")]), ul_([li_([a([href4("#/force-playground")])([text5("Force Playground")]), text5(" - Force graph with efficient DOM updates")]), li_([code_([text5("src/website/Component/Showcase/ForcePlayground.purs")]), text5(" - Example component with efficient render callbacks")])])])])]);
  };
  var handleAction12 = function(dictMonadAff) {
    return function(v2) {
      return pure48(unit);
    };
  };
  var component13 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render17,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction12(dictMonadAff),
        initialize: new Just(Initialize13.value)
      })
    });
  };

  // output/Component.HowTo.HowtoTooltips/index.js
  var pure49 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize14 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var render18 = function(v2) {
    return div2([classes(["tutorial-page"])])([render4({
      logoSize: Large.value,
      quadrant: QuadHowTo.value,
      prevNext: Nothing.value,
      pageTitle: Nothing.value
    }), main_([section([classes(["tutorial-section", "tutorial-intro"])])([h1([classes(["tutorial-title"])])([text5("Adding Tooltips & Hover Behaviors")]), p_([text5("PSD3 provides built-in tooltip support. Just provide a function that formats your data as HTML.")])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Basic Tooltip")]), p_([text5("Import the tooltip module and attach behaviors:")]), pre([classes(["code-block"])])([code_([text5('import PSD3.Tooltip (onTooltip, onTooltipHide)\n\n-- In your render callback, attach to elements:\n_ <- on (onTooltip \\\\d -> d.name <> ": " <> show d.value) circles\n_ <- on onTooltipHide circles')])]), p_([text5("That's it! The tooltip automatically:")]), ul_([li_([text5("Shows on mouse enter at cursor position")]), li_([text5("Hides on mouse leave")]), li_([text5("Stays within viewport bounds")]), li_([text5("Has sensible default styling")])]), h3_([text5("Custom Styling")]), p_([text5("Override the default styles with CSS:")]), pre([classes(["code-block"])])([code_([text5(".psd3-tooltip {\n  background: #1a1a2e;\n  font-family: monospace;\n}")])]), p_([text5("Or set a custom class:")]), pre([classes(["code-block"])])([code_([text5('import PSD3.Tooltip (setTooltipClass)\n\n-- In initialization:\nliftEffect $ setTooltipClass "my-custom-tooltip\\"')])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Advanced: Highlight Connected Elements")]), p_([text5("Combine tooltips with highlighting related elements. This requires a small FFI for D3 class manipulation:")]), h3_([text5("PureScript")]), pre([classes(["code-block"])])([code_([text5("import PSD3.Tooltip (onTooltip, hideTooltip)\n\nforeign import highlightConnected_ :: MyNode -> Effect Unit\nforeign import clearHighlights_ :: Effect Unit\n\n-- Combine in hover handlers:\n_ <- on (onMouseEnterWithInfo \\\\info -> do\n  showTooltip (formatContent info.datum) info.pageX info.pageY\n  highlightConnected_ info.datum\n) element\n\n_ <- on (onMouseLeave \\\\_ -> do\n  hideTooltip\n  clearHighlights_\n) element")])]), h3_([text5("JavaScript FFI")]), pre([classes(["code-block"])])([code_([text5("export const highlightConnected_ = node => () => {\n  const connectedIds = new Set([\n    ...node.links.targets,\n    ...node.links.sources\n  ]);\n\n  d3.selectAll('svg g').filter(d => d && d.id)\n    .classed('highlighted', d => connectedIds.has(d.id))\n    .classed('dimmed', d => d.id !== node.id && !connectedIds.has(d.id));\n};\n\nexport const clearHighlights_ = () => {\n  d3.selectAll('.highlighted').classed('highlighted', false);\n  d3.selectAll('.dimmed').classed('dimmed', false);\n};")])]), h3_([text5("CSS")]), pre([classes(["code-block"])])([code_([text5(".highlighted circle {\n  stroke: #fbbf24;\n  filter: drop-shadow(0 0 6px rgba(251, 191, 36, 0.6));\n}\n\n.dimmed { opacity: 0.15; }\n\ng circle { transition: opacity 0.15s ease, stroke 0.15s ease; }")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Key Points")]), ul_([li_([strong_([text5("Use library tooltips")]), text5(" - onTooltip + onTooltipHide")]), li_([strong_([text5("Format function")]), text5(" - Returns HTML string from datum")]), li_([strong_([text5("Combine behaviors")]), text5(" - Tooltip + highlight in same handler")]), li_([strong_([text5("CSS transitions")]), text5(" - Smooth fade/glow effects")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Real Example")]), p_([text5("See the Code Explorer implementation:")]), ul_([li_([code_([text5("src/website/Viz/Spago/Tooltip.js/.purs")]), text5(" - Tooltips with git metrics")]), li_([code_([text5("src/website/Viz/Spago/Highlight.js/.purs")]), text5(" - Connected node highlighting")]), li_([code_([text5("src/website/Viz/Spago/Render.purs:88-96")]), text5(" - Behavior attachment")])])])])]);
  };
  var handleAction13 = function(dictMonadAff) {
    return function(v2) {
      return pure49(unit);
    };
  };
  var component14 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render18,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction13(dictMonadAff),
        initialize: new Just(Initialize14.value)
      })
    });
  };

  // output/Component.HowTo.HowtoTransitions/index.js
  var pure50 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize15 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var render19 = function(v2) {
    return div2([classes(["tutorial-page"])])([render4({
      logoSize: Large.value,
      quadrant: QuadHowTo.value,
      prevNext: Nothing.value,
      pageTitle: Nothing.value
    }), main_([section([classes(["tutorial-section", "tutorial-intro"])])([h1([classes(["tutorial-title"])])([text5("Creating Animated Transitions")]), p_([text5("PSD3 provides a TransitionM capability for smooth, animated attribute changes.")])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Basic Transition")]), p_([text5("Animate attributes over a duration:")]), pre([classes(["code-block"])])([code_([text5('import Data.Time.Duration (Milliseconds(..))\nimport PSD3.Internal.Transition.Types (transition)\nimport PSD3.Internal.Capabilities.Transition (withTransition)\n\n-- Animate circles to new state over 1 second\nwithTransition (transition (Milliseconds 1000.0)) circles\n  [ fill "orange"\n  , radius 25.0\n  , cx 100.0\n  ]')])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Easing & Delay")]), p_([text5("Add easing functions and delays:")]), pre([classes(["code-block"])])([code_([text5("import PSD3.Internal.Transition.Types (transitionWith, Easing(..))\n\nlet config = transitionWith\n      { duration: Milliseconds 1500.0\n      , delay: Just (Milliseconds 500.0)\n      , easing: Just ElasticOut\n      }\n\nwithTransition config circles [radius 30.0]")])]), p_([text5("Available easings include: Linear, Cubic, Quad, Sin, Exp, Circle, Elastic, Back, Bounce (each with In/Out/InOut variants).")])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Staggered Animations")]), p_([text5("Animate elements sequentially with per-element delays:")]), pre([classes(["code-block"])])([code_([text5('import PSD3.Internal.Capabilities.Transition (withTransitionStaggered, staggerByIndex)\n\n-- Each element delays 50ms more than the previous\nwithTransitionStaggered config (staggerByIndex 50.0) bars\n  [ height \\\\d -> d.value * 10.0\n  , fill "steelblue"\n  ]')])]), p_([text5("Custom delay based on data:")]), pre([classes(["code-block"])])([code_([text5("-- Delay based on datum value\nwithTransitionStaggered config (\\\\d _ -> Milliseconds (d.priority * 100.0)) items\n  [ opacity 1.0 ]")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Exit Transitions")]), p_([text5("Animate elements before removal:")]), pre([classes(["code-block"])])([code_([text5("import PSD3.Internal.Capabilities.Transition (withTransitionExit)\n\n-- Fade out and shrink before removing\nwithTransitionExit (transition (Milliseconds 500.0)) exitSelection\n  [ opacity 0.0\n  , radius 0.0\n  ]")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Key Points")]), ul_([li_([strong_([text5("Type-safe")]), text5(" - Only bound selections can be transitioned")]), li_([strong_([text5("Milliseconds")]), text5(" - All durations use Data.Time.Duration")]), li_([strong_([text5("staggerByIndex")]), text5(" - Helper for simple sequential delays")]), li_([strong_([text5("D3 easings")]), text5(" - Full set of D3's easing functions")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Real Example")]), p_([text5("See these files for transition usage:")]), ul_([li_([code_([text5("src/lib/PSD3/Transition/Types.purs")]), text5(" - All easing options")]), li_([code_([text5("src/lib/PSD3/Capabilities/Transition.purs")]), text5(" - TransitionM type class")])])])])]);
  };
  var handleAction14 = function(dictMonadAff) {
    return function(v2) {
      return pure50(unit);
    };
  };
  var component15 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render19,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction14(dictMonadAff),
        initialize: new Just(Initialize15.value)
      })
    });
  };

  // output/Component.HowTo.HowtoTreeAPI/index.js
  var pure51 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize16 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var render20 = function(v2) {
    return div2([classes(["tutorial-page"])])([render4({
      logoSize: Large.value,
      quadrant: QuadHowTo.value,
      prevNext: Nothing.value,
      pageTitle: Nothing.value
    }), main_([section([classes(["tutorial-section", "tutorial-intro"])])([h1([classes(["tutorial-title"])])([text5("Using the TreeAPI")]), p_([text5("TreeAPI provides a declarative way to build visualization structures with multiple interpreters.")])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("When to Use TreeAPI")]), ul_([li_([text5("Need multiple outputs (D3, String, Mermaid diagram)")]), li_([text5("Want to visualize the tree structure for debugging")]), li_([text5("Building reusable visualization components")]), li_([text5("Working with General Update Pattern")])]), p_([text5("For simple one-off visualizations, SelectionM is simpler.")])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Static Elements")]), p_([text5("Build static DOM structure:")]), pre([classes(["code-block"])])([code_([text5('import PSD3.Tree.Types (Tree(..), Element(..), Child(..))\n\nmyTree :: Tree Unit\nmyTree =\n  Tree\n    (Element SVG [viewBox "0 0 800 600"])\n    [ Child $ Tree (Element Group [class_ "chart-area"])\n        [ Child $ Tree (Element Rect [width 100.0, height 50.0]) [] ]\n    ]')])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Data-Driven Elements")]), p_([text5("Use Join for data binding:")]), pre([classes(["code-block"])])([code_([text5('import PSD3.Tree.Types (Join(..))\n\nmyTree :: Array BarData -> Tree Unit\nmyTree barData =\n  Tree (Element SVG [viewBox "0 0 800 600"])\n    [ Join barData "bar" Group\n        [ width 20.0\n        , height (\\\\d -> d.value * 10.0)\n        , x (\\\\d i -> toNumber i * 25.0)\n        , fill "steelblue"\n        ]\n    ]')])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Interpreters")]), p_([text5("Same tree, multiple outputs:")]), pre([classes(["code-block"])])([code_([text5("-- Render to D3/DOM\nrunD3Interpreter container myTree\n\n-- Generate Mermaid diagram\nlet mermaidCode = runMermaidInterpreter myTree\n\n-- Generate HTML string\nlet htmlString = runStringInterpreter myTree")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Key Points")]), ul_([li_([strong_([text5("Tree")]), text5(" - Root element with children")]), li_([strong_([text5("Child/Join")]), text5(" - Static vs data-bound children")]), li_([strong_([text5("Interpreters")]), text5(" - Same DSL, multiple backends")]), li_([strong_([text5("Mermaid")]), text5(" - Debug tree structure visually")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Real Example")]), p_([text5("See TreeAPI in action:")]), ul_([li_([code_([text5("src/website/Viz/TreeAPI/LesMisTreeExample.purs")]), text5(" - TreeAPI visualization")]), li_([code_([text5("src/lib/PSD3/Tree/Types.purs")]), text5(" - Tree type definitions")])])])])]);
  };
  var handleAction15 = function(dictMonadAff) {
    return function(v2) {
      return pure51(unit);
    };
  };
  var component16 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render20,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction15(dictMonadAff),
        initialize: new Just(Initialize16.value)
      })
    });
  };

  // output/Component.HowTo.HowtoTreeExplorer/foreign.js
  var parseFloat2 = (str23) => {
    const n = Number.parseFloat(str23);
    return isNaN(n) ? null : n;
  };
  var setInnerHTML = (element4) => (html2) => () => {
    element4.innerHTML = html2;
  };
  var floor3 = Math.floor;

  // output/Component.HowTo.HowtoTreeExplorer/index.js
  var add7 = /* @__PURE__ */ add(semiringNumber);
  var bind57 = /* @__PURE__ */ bind(bindList);
  var append33 = /* @__PURE__ */ append(semigroupList);
  var fromFoldable34 = /* @__PURE__ */ fromFoldable3(foldableList);
  var append114 = /* @__PURE__ */ append(semigroupArray);
  var eq8 = /* @__PURE__ */ eq(eqLinkStyle);
  var show52 = /* @__PURE__ */ show(showNumber);
  var type_19 = /* @__PURE__ */ type_18(isPropInputType);
  var value14 = /* @__PURE__ */ value12(isPropString);
  var sortWith3 = /* @__PURE__ */ sortWith(ordNumber);
  var foldl18 = /* @__PURE__ */ foldl(foldableArray);
  var insertWith2 = /* @__PURE__ */ insertWith(ordInt);
  var fromEnum3 = /* @__PURE__ */ fromEnum(boundedEnumCodePoint);
  var discard36 = /* @__PURE__ */ discard(discardUnit);
  var bind217 = /* @__PURE__ */ bind(bindD3v2M);
  var select30 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var map75 = /* @__PURE__ */ map(/* @__PURE__ */ functorCofree(functorList));
  var fromFoldable114 = /* @__PURE__ */ fromFoldable3(/* @__PURE__ */ foldableCofree(foldableList));
  var discard212 = /* @__PURE__ */ discard36(bindD3v2M);
  var liftEffect36 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var show124 = /* @__PURE__ */ show(showInt);
  var v3Attr9 = /* @__PURE__ */ v3Attr(showNumber);
  var lit10 = /* @__PURE__ */ lit(numExprEvalD);
  var str11 = /* @__PURE__ */ str(stringExprEvalD);
  var renderTree51 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D);
  var ordRecord17 = /* @__PURE__ */ ordRecord();
  var ordRecordCons15 = /* @__PURE__ */ ordRecordCons(ordRecordNil)();
  var ordRecordCons16 = /* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons15({
    reflectSymbol: function() {
      return "y";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "x";
    }
  })(ordNumber);
  var ordRecord18 = /* @__PURE__ */ ordRecord17(ordRecordCons16);
  var renderTree117 = /* @__PURE__ */ renderTree51(/* @__PURE__ */ ordRecord17(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons15({
    reflectSymbol: function() {
      return "target";
    }
  })(ordRecord18))()({
    reflectSymbol: function() {
      return "source";
    }
  })(ordRecord18)));
  var renderTree217 = /* @__PURE__ */ renderTree51(/* @__PURE__ */ ordRecord17(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(ordRecordCons16)()({
    reflectSymbol: function() {
      return "value";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "radius";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "name";
    }
  })(ordString))()({
    reflectSymbol: function() {
      return "height";
    }
  })(ordInt))()({
    reflectSymbol: function() {
      return "depth";
    }
  })(ordInt)));
  var pure117 = /* @__PURE__ */ pure(applicativeD3v2M);
  var discard37 = /* @__PURE__ */ discard36(bindHalogenM);
  var bind310 = /* @__PURE__ */ bind(bindHalogenM);
  var modify_9 = /* @__PURE__ */ modify_(monadStateHalogenM);
  var get12 = /* @__PURE__ */ get(monadStateHalogenM);
  var pure210 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Linear2 = /* @__PURE__ */ (function() {
    function Linear3() {
    }
    ;
    Linear3.value = new Linear3();
    return Linear3;
  })();
  var SquareRoot = /* @__PURE__ */ (function() {
    function SquareRoot2() {
    }
    ;
    SquareRoot2.value = new SquareRoot2();
    return SquareRoot2;
  })();
  var Logarithmic = /* @__PURE__ */ (function() {
    function Logarithmic2() {
    }
    ;
    Logarithmic2.value = new Logarithmic2();
    return Logarithmic2;
  })();
  var Exponential2 = /* @__PURE__ */ (function() {
    function Exponential3() {
    }
    ;
    Exponential3.value = new Exponential3();
    return Exponential3;
  })();
  var Custom = /* @__PURE__ */ (function() {
    function Custom2() {
    }
    ;
    Custom2.value = new Custom2();
    return Custom2;
  })();
  var Initialize17 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var SetMinSeparation = /* @__PURE__ */ (function() {
    function SetMinSeparation2(value0) {
      this.value0 = value0;
    }
    ;
    SetMinSeparation2.create = function(value0) {
      return new SetMinSeparation2(value0);
    };
    return SetMinSeparation2;
  })();
  var SetLayerScalePreset = /* @__PURE__ */ (function() {
    function SetLayerScalePreset2(value0) {
      this.value0 = value0;
    }
    ;
    SetLayerScalePreset2.create = function(value0) {
      return new SetLayerScalePreset2(value0);
    };
    return SetLayerScalePreset2;
  })();
  var SetExponent = /* @__PURE__ */ (function() {
    function SetExponent2(value0) {
      this.value0 = value0;
    }
    ;
    SetExponent2.create = function(value0) {
      return new SetExponent2(value0);
    };
    return SetExponent2;
  })();
  var SetLinkStyle = /* @__PURE__ */ (function() {
    function SetLinkStyle2(value0) {
      this.value0 = value0;
    }
    ;
    SetLinkStyle2.create = function(value0) {
      return new SetLinkStyle2(value0);
    };
    return SetLinkStyle2;
  })();
  var Redraw = /* @__PURE__ */ (function() {
    function Redraw2() {
    }
    ;
    Redraw2.value = new Redraw2();
    return Redraw2;
  })();
  var radiusSeparation = function(a3) {
    return function(b10) {
      return a3.radius + b10.radius + 0.5;
    };
  };
  var parseNumber = function($$default) {
    return function(str1) {
      return fromMaybe($$default)(parseFloat2(str1));
    };
  };
  var makeLinks6 = function(tree$prime) {
    var makeLinksList = function(t2) {
      var val = head(t2);
      var children3 = tail(t2);
      var grandchildLinks = bind57(children3)(makeLinksList);
      var childLinks = bind57(children3)(function(child) {
        var childVal = head(child);
        return new Cons({
          source: {
            x: val.x,
            y: val.y
          },
          target: {
            x: childVal.x,
            y: childVal.y
          }
        }, Nil.value);
      });
      return append33(childLinks)(grandchildLinks);
    };
    return fromFoldable34(makeLinksList(tree$prime));
  };
  var linkStyleButton = function(style3) {
    return function(label5) {
      return function(current) {
        return button2([classes(append114(["preset-btn"])((function() {
          var $119 = eq8(style3)(current);
          if ($119) {
            return ["active"];
          }
          ;
          return [];
        })())), onClick(function(v2) {
          return new SetLinkStyle(style3);
        })])([text5(label5)]);
      };
    };
  };
  var initialState = function(v2) {
    return {
      flareData: Nothing.value,
      minSeparation: 1,
      layerScalePreset: Linear2.value,
      exponent: 1.5,
      linkStyle: BezierVertical.value,
      error: Nothing.value
    };
  };
  var getLayerScaleFn = function(preset) {
    return function(exponent2) {
      return function(depth) {
        var d = toNumber(depth);
        if (preset instanceof Linear2) {
          return d;
        }
        ;
        if (preset instanceof SquareRoot) {
          return sqrt(d);
        }
        ;
        if (preset instanceof Logarithmic) {
          return log(d + 1);
        }
        ;
        if (preset instanceof Exponential2) {
          return pow(d)(exponent2);
        }
        ;
        if (preset instanceof Custom) {
          return d;
        }
        ;
        throw new Error("Failed pattern match at Component.HowTo.HowtoTreeExplorer (line 382, column 5 - line 387, column 18): " + [preset.constructor.name]);
      };
    };
  };
  var eqLayerScalePreset = {
    eq: function(x32) {
      return function(y32) {
        if (x32 instanceof Linear2 && y32 instanceof Linear2) {
          return true;
        }
        ;
        if (x32 instanceof SquareRoot && y32 instanceof SquareRoot) {
          return true;
        }
        ;
        if (x32 instanceof Logarithmic && y32 instanceof Logarithmic) {
          return true;
        }
        ;
        if (x32 instanceof Exponential2 && y32 instanceof Exponential2) {
          return true;
        }
        ;
        if (x32 instanceof Custom && y32 instanceof Custom) {
          return true;
        }
        ;
        return false;
      };
    }
  };
  var eq23 = /* @__PURE__ */ eq(eqLayerScalePreset);
  var presetButton2 = function(preset) {
    return function(label5) {
      return function(current) {
        return button2([classes(append114(["preset-btn"])((function() {
          var $123 = eq23(preset)(current);
          if ($123) {
            return ["active"];
          }
          ;
          return [];
        })())), onClick(function(v2) {
          return new SetLayerScalePreset(preset);
        })])([text5(label5)]);
      };
    };
  };
  var render21 = function(state3) {
    return div2([classes(["tutorial-page", "tree-explorer"])])([render4({
      logoSize: Large.value,
      quadrant: QuadHowTo.value,
      prevNext: Nothing.value,
      pageTitle: Nothing.value
    }), h1_([text5("Tree Layout Explorer")]), p_([text5("Experiment with tree layout configuration options. Adjust the controls below to see how they affect the Reingold-Tilford tree layout algorithm.")]), (function() {
      if (state3.error instanceof Just) {
        return div2([classes(["error"])])([text5(state3.error.value0)]);
      }
      ;
      if (state3.error instanceof Nothing) {
        return text5("");
      }
      ;
      throw new Error("Failed pattern match at Component.HowTo.HowtoTreeExplorer (line 406, column 7 - line 408, column 30): " + [state3.error.constructor.name]);
    })(), div2([classes(["tree-explorer-controls"])])([div2([classes(["control-group"])])([label_([text5("Min Separation: " + show52(state3.minSeparation))]), input([type_19(InputRange.value), min5(0.1), max6(5), step3(new Step(0.1)), value14(show52(state3.minSeparation)), onValueInput((function() {
      var $162 = parseNumber(1);
      return function($163) {
        return SetMinSeparation.create($162($163));
      };
    })())])]), div2([classes(["control-group"])])([label_([text5("Layer Scale:")]), div2([classes(["button-group"])])([presetButton2(Linear2.value)("Linear")(state3.layerScalePreset), presetButton2(SquareRoot.value)("\u221A Sqrt")(state3.layerScalePreset), presetButton2(Logarithmic.value)("Log")(state3.layerScalePreset), presetButton2(Exponential2.value)("d^n")(state3.layerScalePreset)])]), (function() {
      var $126 = eq23(state3.layerScalePreset)(Exponential2.value);
      if ($126) {
        return div2([classes(["control-group"])])([label_([text5("Exponent: " + show52(state3.exponent))]), input([type_19(InputRange.value), min5(0.5), max6(3), step3(new Step(0.1)), value14(show52(state3.exponent)), onValueInput((function() {
          var $164 = parseNumber(1.5);
          return function($165) {
            return SetExponent.create($164($165));
          };
        })())])]);
      }
      ;
      return text5("");
    })(), div2([classes(["control-group"])])([label_([text5("Link Style:")]), div2([classes(["button-group"])])([linkStyleButton(StepVertical.value)("Step V")(state3.linkStyle), linkStyleButton(StepHorizontal.value)("Step H")(state3.linkStyle), linkStyleButton(BezierVertical.value)("Bezier V")(state3.linkStyle), linkStyleButton(BezierHorizontal.value)("Bezier H")(state3.linkStyle), linkStyleButton(Diagonal.value)("Diagonal")(state3.linkStyle)])])]), div2([id3("tree-explorer-viz"), classes(["viz-container"])])([])]);
  };
  var computeScaleFactor = function(minSep) {
    return function(nodes3) {
      var computePairScale = function(v2) {
        var pixelDist = v2.value1.x - v2.value0.x;
        var expectedSep = radiusSeparation(v2.value0)(v2.value1) + minSep;
        var $128 = pixelDist > 1 && expectedSep > 0.01;
        if ($128) {
          return new Just(pixelDist / expectedSep);
        }
        ;
        return Nothing.value;
      };
      var getScaleSamples = function(depthNodes) {
        var sorted = sortWith3(function(v2) {
          return v2.x;
        })(depthNodes);
        var pairs = zip(sorted)(drop(1)(sorted));
        return mapMaybe(computePairScale)(pairs);
      };
      var grouped = foldl18(function(m2) {
        return function(n) {
          return insertWith2(append114)(n.depth)([n])(m2);
        };
      })(empty4)(nodes3);
      var samples = concatMap(getScaleSamples)(fromFoldable34(values(grouped)));
      var avgScale = (function() {
        var $131 = length3(samples) === 0;
        if ($131) {
          return 5;
        }
        ;
        return foldl18(add7)(0)(samples) / toNumber(length3(samples));
      })();
      return avgScale;
    };
  };
  var computeRadius = function(node) {
    var charCode = maybe(0)(fromEnum3)(codePointAt(0)(node.name));
    var hash2 = toNumber(length9(node.name)) + toNumber(charCode);
    var base3 = hash2 - floor3(hash2 / 4) * 4 + 1;
    return base3 * 0.5 + 0.5;
  };
  var computeColor = function(node) {
    var charCode = maybe(65)(fromEnum3)(codePointAt(1)(node.name));
    var hue = toNumber(charCode * 7 | 0) - floor3(toNumber(charCode * 7 | 0) / 360) * 360;
    return "hsl(" + (show52(hue) + ", 70%, 50%)");
  };
  var clearContainer2 = function(selector) {
    return function __do7() {
      var win = windowImpl();
      var doc = document2(win)();
      var maybeEl = querySelector(selector)(toParentNode3(doc))();
      if (maybeEl instanceof Nothing) {
        return unit;
      }
      ;
      if (maybeEl instanceof Just) {
        return setInnerHTML(maybeEl.value0)("")();
      }
      ;
      throw new Error("Failed pattern match at Component.HowTo.HowtoTreeExplorer (line 261, column 3 - line 263, column 34): " + [maybeEl.constructor.name]);
    };
  };
  var addRadius = function(node) {
    return {
      name: node.name,
      value: node.value,
      x: node.x,
      y: node.y,
      depth: node.depth,
      height: node.height,
      radius: computeRadius(node)
    };
  };
  var drawTreeExplorer = function(selector) {
    return function(state3) {
      return function(flareTree) {
        return function __do7() {
          clearContainer2(selector)();
          return runD3v2M(bind217(select30(selector))(function(container) {
            var treeWithRadius = map75(addRadius)(flareTree);
            var layerScaleFn = getLayerScaleFn(state3.layerScalePreset)(state3.exponent);
            var config = {
              size: {
                width: 800 - 2 * 40,
                height: 600 - 2 * 40
              },
              minSeparation: state3.minSeparation,
              layerScale: new Just(layerScaleFn),
              separation: new Just(radiusSeparation)
            };
            var linkPathFn = linkGenerator(state3.linkStyle);
            var positioned = tree(config)(treeWithRadius);
            var nodes3 = fromFoldable114(positioned);
            var links3 = makeLinks6(positioned);
            var radiusScale = computeScaleFactor(state3.minSeparation)(nodes3);
            return discard212(liftEffect36(log2("TreeExplorer: " + (show124(length3(nodes3)) + (" nodes, minSep=" + (show52(state3.minSeparation) + (", radiusScale=" + show52(radiusScale))))))))(function() {
              var linksTree = withChild(named(SVG.value)("svg")([v3Attr9("width")(lit10(800)), v3Attr9("height")(lit10(600)), v3AttrStr("viewBox")(str11("0 0 " + (show52(800) + (" " + show52(600))))), v3AttrStr("class")(str11("tree-explorer-svg"))]))(withChild(named(Group.value)("chartGroup")([v3AttrStr("class")(str11("tree-content"))]))(withChild(named(Group.value)("linksGroup")([v3AttrStr("class")(str11("links"))]))(joinData("links")("path")(links3)(function(link5) {
                return elem3(Path.value)([v3AttrStr("d")(str11(linkPathFn(link5.source.x + 40)(link5.source.y + 40)(link5.target.x + 40)(link5.target.y + 40))), v3AttrStr("fill")(str11("none")), v3AttrStr("stroke")(str11("#555")), v3Attr9("stroke-width")(lit10(1.5)), v3AttrStr("class")(str11("link"))]);
              }))));
              return bind217(renderTree117(container)(linksTree))(function(linksSelections) {
                return bind217(liftEffect36(reselectD3v2("chartGroup")(linksSelections)))(function(chartGroupSel) {
                  var nodesTree = withChild(named(Group.value)("nodesGroup")([v3AttrStr("class")(str11("nodes"))]))(joinData("nodeGroups")("g")(nodes3)(function(node) {
                    return elem3(Circle.value)([v3Attr9("cx")(lit10(node.x + 40)), v3Attr9("cy")(lit10(node.y + 40)), v3Attr9("r")(lit10(node.radius * radiusScale)), v3AttrStr("fill")(str11(computeColor(node))), v3AttrStr("stroke")(str11("none")), v3Attr9("stroke-opacity")(lit10(0)), v3AttrStr("class")(str11("node"))]);
                  }));
                  return bind217(renderTree217(chartGroupSel)(nodesTree))(function() {
                    return pure117(unit);
                  });
                });
              });
            });
          }))();
        };
      };
    };
  };
  var handleAction16 = function(dictMonadAff) {
    var liftAff2 = liftAff(monadAffHalogenM(dictMonadAff));
    var liftEffect118 = liftEffect(monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    return function(v2) {
      if (v2 instanceof Initialize17) {
        return discard37(liftAff2(delay(100)))(function() {
          return bind310(liftAff2(loadFlareData))(function(result) {
            if (result instanceof Left) {
              return modify_9(function(v1) {
                var $136 = {};
                for (var $137 in v1) {
                  if ({}.hasOwnProperty.call(v1, $137)) {
                    $136[$137] = v1[$137];
                  }
                  ;
                }
                ;
                $136.error = new Just(result.value0);
                return $136;
              });
            }
            ;
            if (result instanceof Right) {
              return discard37(modify_9(function(v1) {
                var $140 = {};
                for (var $141 in v1) {
                  if ({}.hasOwnProperty.call(v1, $141)) {
                    $140[$141] = v1[$141];
                  }
                  ;
                }
                ;
                $140.flareData = new Just(result.value0);
                $140.error = Nothing.value;
                return $140;
              }))(function() {
                return bind310(get12)(function(state3) {
                  return liftEffect118(drawTreeExplorer("#tree-explorer-viz")(state3)(result.value0));
                });
              });
            }
            ;
            throw new Error("Failed pattern match at Component.HowTo.HowtoTreeExplorer (line 193, column 5 - line 199, column 70): " + [result.constructor.name]);
          });
        });
      }
      ;
      if (v2 instanceof SetMinSeparation) {
        return discard37(modify_9(function(v1) {
          var $144 = {};
          for (var $145 in v1) {
            if ({}.hasOwnProperty.call(v1, $145)) {
              $144[$145] = v1[$145];
            }
            ;
          }
          ;
          $144.minSeparation = v2.value0;
          return $144;
        }))(function() {
          return handleAction16(dictMonadAff)(Redraw.value);
        });
      }
      ;
      if (v2 instanceof SetLayerScalePreset) {
        return discard37(modify_9(function(v1) {
          var $148 = {};
          for (var $149 in v1) {
            if ({}.hasOwnProperty.call(v1, $149)) {
              $148[$149] = v1[$149];
            }
            ;
          }
          ;
          $148.layerScalePreset = v2.value0;
          return $148;
        }))(function() {
          return handleAction16(dictMonadAff)(Redraw.value);
        });
      }
      ;
      if (v2 instanceof SetExponent) {
        return discard37(modify_9(function(v1) {
          var $152 = {};
          for (var $153 in v1) {
            if ({}.hasOwnProperty.call(v1, $153)) {
              $152[$153] = v1[$153];
            }
            ;
          }
          ;
          $152.exponent = v2.value0;
          return $152;
        }))(function() {
          return handleAction16(dictMonadAff)(Redraw.value);
        });
      }
      ;
      if (v2 instanceof SetLinkStyle) {
        return discard37(modify_9(function(v1) {
          var $156 = {};
          for (var $157 in v1) {
            if ({}.hasOwnProperty.call(v1, $157)) {
              $156[$157] = v1[$157];
            }
            ;
          }
          ;
          $156.linkStyle = v2.value0;
          return $156;
        }))(function() {
          return handleAction16(dictMonadAff)(Redraw.value);
        });
      }
      ;
      if (v2 instanceof Redraw) {
        return bind310(get12)(function(state3) {
          if (state3.flareData instanceof Nothing) {
            return pure210(unit);
          }
          ;
          if (state3.flareData instanceof Just) {
            return liftEffect118(drawTreeExplorer("#tree-explorer-viz")(state3)(state3.flareData.value0));
          }
          ;
          throw new Error("Failed pattern match at Component.HowTo.HowtoTreeExplorer (line 219, column 5 - line 221, column 81): " + [state3.flareData.constructor.name]);
        });
      }
      ;
      throw new Error("Failed pattern match at Component.HowTo.HowtoTreeExplorer (line 186, column 16 - line 221, column 81): " + [v2.constructor.name]);
    };
  };
  var component17 = function(dictMonadAff) {
    return mkComponent({
      initialState,
      render: render21,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction16(dictMonadAff),
        initialize: new Just(Initialize17.value)
      })
    });
  };

  // output/Component.MermaidTreeDemo/foreign.js
  function runMermaid() {
    setTimeout(function() {
      if (window.mermaid) {
        window.mermaid.run({
          querySelector: ".mermaid"
        });
      }
    }, 0);
  }

  // output/PSD3.Interpreter.Mermaid/index.js
  var bindStateT3 = /* @__PURE__ */ bindStateT(monadEffect);
  var applicativeStateT3 = /* @__PURE__ */ applicativeStateT(monadEffect);
  var bind58 = /* @__PURE__ */ bind(bindStateT3);
  var monadStateStateT3 = /* @__PURE__ */ monadStateStateT(monadEffect);
  var get13 = /* @__PURE__ */ get(monadStateStateT3);
  var show53 = /* @__PURE__ */ show(showInt);
  var discard38 = /* @__PURE__ */ discard(discardUnit);
  var discard116 = /* @__PURE__ */ discard38(bindStateT3);
  var modify_10 = /* @__PURE__ */ modify_(monadStateStateT3);
  var pure52 = /* @__PURE__ */ pure(applicativeStateT3);
  var showElement = function(v2) {
    if (v2 instanceof SVG) {
      return "svg";
    }
    ;
    if (v2 instanceof Group) {
      return "g";
    }
    ;
    if (v2 instanceof Circle) {
      return "circle";
    }
    ;
    if (v2 instanceof Rect) {
      return "rect";
    }
    ;
    if (v2 instanceof Line) {
      return "line";
    }
    ;
    if (v2 instanceof Path) {
      return "path";
    }
    ;
    if (v2 instanceof Text) {
      return "text";
    }
    ;
    if (v2 instanceof Div) {
      return "div";
    }
    ;
    if (v2 instanceof Span) {
      return "span";
    }
    ;
    if (v2 instanceof Table) {
      return "table";
    }
    ;
    if (v2 instanceof Tr) {
      return "tr";
    }
    ;
    if (v2 instanceof Td) {
      return "td";
    }
    ;
    if (v2 instanceof Th) {
      return "th";
    }
    ;
    if (v2 instanceof Thead) {
      return "thead";
    }
    ;
    if (v2 instanceof Tbody) {
      return "tbody";
    }
    ;
    if (v2 instanceof Defs) {
      return "defs";
    }
    ;
    if (v2 instanceof LinearGradient) {
      return "linearGradient";
    }
    ;
    if (v2 instanceof Stop) {
      return "stop";
    }
    ;
    throw new Error("Failed pattern match at PSD3.Interpreter.Mermaid (line 71, column 1 - line 71, column 37): " + [v2.constructor.name]);
  };
  var generateStyleDefinitions = /* @__PURE__ */ (function() {
    return "\n    %% Style definitions\n    classDef elementNode fill:#e6f598,stroke:#abdda4,stroke-width:2px\n    classDef joinNode fill:#f46d43,stroke:#d53e4f,stroke-width:2px\n    classDef nestedJoinNode fill:#fdae61,stroke:#f46d43,stroke-width:2px\n    classDef templateNode fill:#abdda4,stroke:#66c2a5,stroke-width:2px\n    classDef decomposeNode fill:#fee08b,stroke:#fdae61,stroke-width:2px\n";
  })();
  var formatAttrSource = function(name16) {
    return function(v2) {
      if (v2 instanceof UnknownSource) {
        return name16 + "(d)";
      }
      ;
      if (v2 instanceof StaticSource) {
        return name16;
      }
      ;
      if (v2 instanceof FieldSource) {
        return name16 + ("=d." + v2.value0);
      }
      ;
      if (v2 instanceof ExprSource) {
        return name16 + ("=(" + (v2.value0 + ")"));
      }
      ;
      if (v2 instanceof IndexSource) {
        return name16 + "=i";
      }
      ;
      throw new Error("Failed pattern match at PSD3.Interpreter.Mermaid (line 100, column 25 - line 105, column 30): " + [v2.constructor.name]);
    };
  };
  var formatAttribute = function(v2) {
    if (v2 instanceof StaticAttr) {
      return v2.value0;
    }
    ;
    if (v2 instanceof DataAttr) {
      return formatAttrSource(v2.value0)(v2.value1);
    }
    ;
    if (v2 instanceof IndexedAttr) {
      return formatAttrSource(v2.value0)(v2.value1);
    }
    ;
    throw new Error("Failed pattern match at PSD3.Interpreter.Mermaid (line 93, column 19 - line 96, column 70): " + [v2.constructor.name]);
  };
  var formatAttributeList = function(attrs) {
    if (attrs.length === 0) {
      return "";
    }
    ;
    return foldl4(function(acc) {
      return function(attr46) {
        var $52 = acc === "";
        if ($52) {
          return formatAttribute(attr46);
        }
        ;
        return acc + (", " + formatAttribute(attr46));
      };
    })("")(attrs);
  };
  var escapeLabel = /* @__PURE__ */ replaceAll('"')("'");
  var bindMermaidTreeM = bindStateT3;
  var bind218 = /* @__PURE__ */ bind(bindMermaidTreeM);
  var discard213 = /* @__PURE__ */ discard38(bindMermaidTreeM);
  var applicativeMermaidTreeM = applicativeStateT3;
  var traverse4 = /* @__PURE__ */ traverse(traversableArray)(applicativeMermaidTreeM);
  var pure211 = /* @__PURE__ */ pure(applicativeMermaidTreeM);
  var addNode = function(label5) {
    return function(styleClass) {
      return bind58(get13)(function(state3) {
        var nodeName2 = "n" + show53(state3.nodeCounter);
        var escapedLabel = escapeLabel(label5);
        var line = "    " + (nodeName2 + ('["' + (escapedLabel + ('"]:::' + (styleClass + "\n")))));
        return discard116(modify_10(function(s3) {
          var $53 = {};
          for (var $54 in s3) {
            if ({}.hasOwnProperty.call(s3, $54)) {
              $53[$54] = s3[$54];
            }
            ;
          }
          ;
          $53.nodeCounter = s3.nodeCounter + 1 | 0;
          $53.mermaidCode = s3.mermaidCode + line;
          return $53;
        }))(function() {
          return pure52(state3.nodeCounter);
        });
      });
    };
  };
  var addEdge = function(fromId) {
    return function(toId) {
      var toName = "n" + show53(toId);
      var fromName = "n" + show53(fromId);
      var line = "    " + (fromName + (" --> " + (toName + "\n")));
      return modify_10(function(s3) {
        var $56 = {};
        for (var $57 in s3) {
          if ({}.hasOwnProperty.call(s3, $57)) {
            $56[$57] = s3[$57];
          }
          ;
        }
        ;
        $56.mermaidCode = s3.mermaidCode + line;
        return $56;
      });
    };
  };
  var renderTree52 = function(tree2) {
    return function(parentId) {
      var traverseWithParent = function(pid) {
        return function(children3) {
          return bind218(traverse4(function(child) {
            return renderTree52(child)(new Just(pid));
          })(children3))(function() {
            return pure211(unit);
          });
        };
      };
      if (tree2 instanceof Node2) {
        var nodeLabel = (function() {
          if (tree2.value0.name instanceof Just) {
            return "<" + (showElement(tree2.value0.elemType) + (' "' + (tree2.value0.name.value0 + '">')));
          }
          ;
          if (tree2.value0.name instanceof Nothing) {
            return showElement(tree2.value0.elemType);
          }
          ;
          throw new Error("Failed pattern match at PSD3.Interpreter.Mermaid (line 119, column 21 - line 121, column 47): " + [tree2.value0.name.constructor.name]);
        })();
        var attrSuffix = (function() {
          var $62 = length3(tree2.value0.attrs) > 0;
          if ($62) {
            return " + [" + (formatAttributeList(tree2.value0.attrs) + "]");
          }
          ;
          return "";
        })();
        var fullLabel = nodeLabel + attrSuffix;
        return bind218(addNode(fullLabel)("elementNode"))(function(nodeId) {
          return discard213((function() {
            if (parentId instanceof Just) {
              return addEdge(parentId.value0)(nodeId);
            }
            ;
            if (parentId instanceof Nothing) {
              return pure211(unit);
            }
            ;
            throw new Error("Failed pattern match at PSD3.Interpreter.Mermaid (line 130, column 5 - line 132, column 27): " + [parentId.constructor.name]);
          })())(function() {
            return bind218(traverseWithParent(nodeId)(tree2.value0.children))(function() {
              return pure211(nodeId);
            });
          });
        });
      }
      ;
      if (tree2 instanceof Join) {
        var joinLabel = 'JOIN "' + (tree2.value0.name + ('" (' + (tree2.value0.key + (") [" + (show53(length3(tree2.value0.joinData)) + " items]")))));
        return bind218(addNode(joinLabel)("joinNode"))(function(joinId) {
          return discard213((function() {
            if (parentId instanceof Just) {
              return addEdge(parentId.value0)(joinId);
            }
            ;
            if (parentId instanceof Nothing) {
              return pure211(unit);
            }
            ;
            throw new Error("Failed pattern match at PSD3.Interpreter.Mermaid (line 144, column 5 - line 146, column 27): " + [parentId.constructor.name]);
          })())(function() {
            return bind218(addNode("template(datum) \u2192")("templateNode"))(function(templateLabel) {
              return discard213(addEdge(joinId)(templateLabel))(function() {
                return discard213((function() {
                  var v2 = uncons4(tree2.value0.joinData);
                  if (v2 instanceof Nothing) {
                    return pure211(unit);
                  }
                  ;
                  if (v2 instanceof Just) {
                    var templateTree = tree2.value0.template(v2.value0.head);
                    return bind218(renderTree52(templateTree)(new Just(templateLabel)))(function() {
                      return pure211(unit);
                    });
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Interpreter.Mermaid (line 153, column 5 - line 158, column 18): " + [v2.constructor.name]);
                })())(function() {
                  return pure211(joinId);
                });
              });
            });
          });
        });
      }
      ;
      if (tree2 instanceof NestedJoin) {
        var joinLabel = 'NESTED JOIN "' + (tree2.value0.name + ('" (' + (tree2.value0.key + (") [" + (show53(length3(tree2.value0.joinData)) + " items]")))));
        return bind218(addNode(joinLabel)("nestedJoinNode"))(function(joinId) {
          return discard213((function() {
            if (parentId instanceof Just) {
              return addEdge(parentId.value0)(joinId);
            }
            ;
            if (parentId instanceof Nothing) {
              return pure211(unit);
            }
            ;
            throw new Error("Failed pattern match at PSD3.Interpreter.Mermaid (line 168, column 5 - line 170, column 27): " + [parentId.constructor.name]);
          })())(function() {
            return bind218(addNode("decompose(datum) \u2192")("decomposeNode"))(function(decomposeId) {
              return discard213(addEdge(joinId)(decomposeId))(function() {
                return bind218(addNode("template(innerDatum) \u2192")("templateNode"))(function(templateId) {
                  return discard213(addEdge(decomposeId)(templateId))(function() {
                    return discard213((function() {
                      var v2 = uncons4(tree2.value0.joinData);
                      if (v2 instanceof Nothing) {
                        return pure211(unit);
                      }
                      ;
                      if (v2 instanceof Just) {
                        var innerData = tree2.value0.decompose(v2.value0.head);
                        var v1 = uncons4(innerData);
                        if (v1 instanceof Nothing) {
                          return pure211(unit);
                        }
                        ;
                        if (v1 instanceof Just) {
                          var templateTree = tree2.value0.template(v1.value0.head);
                          return bind218(renderTree52(templateTree)(new Just(templateId)))(function() {
                            return pure211(unit);
                          });
                        }
                        ;
                        throw new Error("Failed pattern match at PSD3.Interpreter.Mermaid (line 185, column 9 - line 190, column 22): " + [v1.constructor.name]);
                      }
                      ;
                      throw new Error("Failed pattern match at PSD3.Interpreter.Mermaid (line 181, column 5 - line 190, column 22): " + [v2.constructor.name]);
                    })())(function() {
                      return pure211(joinId);
                    });
                  });
                });
              });
            });
          });
        });
      }
      ;
      if (tree2 instanceof SceneJoin) {
        var behaviorInfo = (function() {
          var $81 = isJust(tree2.value0.enterBehavior);
          if ($81) {
            return "E";
          }
          ;
          return "";
        })() + ((function() {
          var $82 = isJust(tree2.value0.updateBehavior);
          if ($82) {
            return "U";
          }
          ;
          return "";
        })() + (function() {
          var $83 = isJust(tree2.value0.exitBehavior);
          if ($83) {
            return "X";
          }
          ;
          return "";
        })());
        var joinLabel = 'SCENE JOIN "' + (tree2.value0.name + ('" (' + (tree2.value0.key + (") [" + (show53(length3(tree2.value0.joinData)) + (" items] {" + (behaviorInfo + "}")))))));
        return bind218(addNode(joinLabel)("sceneJoinNode"))(function(joinId) {
          return discard213((function() {
            if (parentId instanceof Just) {
              return addEdge(parentId.value0)(joinId);
            }
            ;
            if (parentId instanceof Nothing) {
              return pure211(unit);
            }
            ;
            throw new Error("Failed pattern match at PSD3.Interpreter.Mermaid (line 205, column 5 - line 207, column 27): " + [parentId.constructor.name]);
          })())(function() {
            return bind218(addNode("template(datum) \u2192")("templateNode"))(function(templateLabel) {
              return discard213(addEdge(joinId)(templateLabel))(function() {
                return discard213((function() {
                  var v2 = uncons4(tree2.value0.joinData);
                  if (v2 instanceof Nothing) {
                    return pure211(unit);
                  }
                  ;
                  if (v2 instanceof Just) {
                    var templateTree = tree2.value0.template(v2.value0.head);
                    return bind218(renderTree52(templateTree)(new Just(templateLabel)))(function() {
                      return pure211(unit);
                    });
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Interpreter.Mermaid (line 214, column 5 - line 219, column 18): " + [v2.constructor.name]);
                })())(function() {
                  return pure211(joinId);
                });
              });
            });
          });
        });
      }
      ;
      if (tree2 instanceof SceneNestedJoin) {
        var behaviorInfo = (function() {
          var $90 = isJust(tree2.value0.enterBehavior);
          if ($90) {
            return "E";
          }
          ;
          return "";
        })() + ((function() {
          var $91 = isJust(tree2.value0.updateBehavior);
          if ($91) {
            return "U";
          }
          ;
          return "";
        })() + (function() {
          var $92 = isJust(tree2.value0.exitBehavior);
          if ($92) {
            return "X";
          }
          ;
          return "";
        })());
        var joinLabel = 'SCENE NESTED JOIN "' + (tree2.value0.name + ('" (' + (tree2.value0.key + (") [" + (show53(length3(tree2.value0.joinData)) + (" items] {" + (behaviorInfo + "}")))))));
        return bind218(addNode(joinLabel)("sceneNestedJoinNode"))(function(joinId) {
          return discard213((function() {
            if (parentId instanceof Just) {
              return addEdge(parentId.value0)(joinId);
            }
            ;
            if (parentId instanceof Nothing) {
              return pure211(unit);
            }
            ;
            throw new Error("Failed pattern match at PSD3.Interpreter.Mermaid (line 234, column 5 - line 236, column 27): " + [parentId.constructor.name]);
          })())(function() {
            return bind218(addNode("decompose(datum) \u2192")("decomposeNode"))(function(decomposeId) {
              return discard213(addEdge(joinId)(decomposeId))(function() {
                return bind218(addNode("template(innerDatum) \u2192")("templateNode"))(function(templateLabel) {
                  return discard213(addEdge(decomposeId)(templateLabel))(function() {
                    return discard213((function() {
                      var v2 = uncons4(tree2.value0.joinData);
                      if (v2 instanceof Nothing) {
                        return pure211(unit);
                      }
                      ;
                      if (v2 instanceof Just) {
                        var innerData = tree2.value0.decompose(v2.value0.head);
                        var v1 = uncons4(innerData);
                        if (v1 instanceof Nothing) {
                          return pure211(unit);
                        }
                        ;
                        if (v1 instanceof Just) {
                          var templateTree = tree2.value0.template(v1.value0.head);
                          return bind218(renderTree52(templateTree)(new Just(templateLabel)))(function() {
                            return pure211(unit);
                          });
                        }
                        ;
                        throw new Error("Failed pattern match at PSD3.Interpreter.Mermaid (line 251, column 9 - line 256, column 22): " + [v1.constructor.name]);
                      }
                      ;
                      throw new Error("Failed pattern match at PSD3.Interpreter.Mermaid (line 247, column 5 - line 256, column 22): " + [v2.constructor.name]);
                    })())(function() {
                      return pure211(joinId);
                    });
                  });
                });
              });
            });
          });
        });
      }
      ;
      throw new Error("Failed pattern match at PSD3.Interpreter.Mermaid (line 116, column 28 - line 258, column 16): " + [tree2.constructor.name]);
    };
  };
  var runMermaidTree = function(tree2) {
    var initialState8 = {
      nodeCounter: 0,
      mermaidCode: ""
    };
    var v2 = renderTree52(tree2)(Nothing.value);
    return function __do7() {
      var v1 = runStateT(v2)(initialState8)();
      return "%%{init: {'theme':'base', 'themeVariables': {'fontFamily':'monospace'}, 'look':'handDrawn', 'flowchart':{'curve':'basis'}}}%%\n" + ("graph TD\n" + (v1.value1.mermaidCode + generateStyleDefinitions));
    };
  };

  // output/Component.MermaidTreeDemo/index.js
  var pure53 = /* @__PURE__ */ pure(applicativeHalogenM);
  var str12 = /* @__PURE__ */ str(stringExprEvalD);
  var bind59 = /* @__PURE__ */ bind(bindHalogenM);
  var discard39 = /* @__PURE__ */ discard(discardUnit)(bindHalogenM);
  var modify_11 = /* @__PURE__ */ modify_(monadStateHalogenM);
  var v3AttrFn3 = /* @__PURE__ */ v3AttrFn(showNumber);
  var v3Attr10 = /* @__PURE__ */ v3Attr(showNumber);
  var lit11 = /* @__PURE__ */ lit(numExprEvalD);
  var Initialize18 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var GenerateSimpleTree = /* @__PURE__ */ (function() {
    function GenerateSimpleTree2() {
    }
    ;
    GenerateSimpleTree2.value = new GenerateSimpleTree2();
    return GenerateSimpleTree2;
  })();
  var GenerateJoinTree = /* @__PURE__ */ (function() {
    function GenerateJoinTree2() {
    }
    ;
    GenerateJoinTree2.value = new GenerateJoinTree2();
    return GenerateJoinTree2;
  })();
  var render22 = function(state3) {
    return div2([class_("mermaid-tree-demo")])([h1_([text5("Mermaid Tree API Visualizer")]), p_([text5("This demonstrates the new Mermaid interpreter for the Tree API.")]), div2([class_("controls")])([button2([class_("btn"), onClick(function(v2) {
      return GenerateSimpleTree.value;
    })])([text5("Generate Simple Tree")]), button2([class_("btn"), onClick(function(v2) {
      return GenerateJoinTree.value;
    })])([text5("Generate Data Join Tree")])]), (function() {
      if (state3.mermaidCode instanceof Nothing) {
        return div_([text5("Click a button to generate a Mermaid diagram")]);
      }
      ;
      if (state3.mermaidCode instanceof Just) {
        return div_([h2_([text5("Generated Mermaid Code:")]), pre([class_("mermaid-code")])([text5(state3.mermaidCode.value0)]), div2([class_("mermaid")])([text5(state3.mermaidCode.value0)])]);
      }
      ;
      throw new Error("Failed pattern match at Component.MermaidTreeDemo (line 64, column 7 - line 74, column 12): " + [state3.mermaidCode.constructor.name]);
    })()]);
  };
  var handleAction17 = function(dictMonadAff) {
    var liftEffect54 = liftEffect(monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    return function(v2) {
      if (v2 instanceof Initialize18) {
        return pure53(unit);
      }
      ;
      if (v2 instanceof GenerateSimpleTree) {
        var tree2 = withChildren(named(SVG.value)("svg")([v3AttrStr("width")(str12("800")), v3AttrStr("height")(str12("600"))]))([withChild(elem3(Group.value)([v3AttrStr("class")(str12("container"))]))(elem3(Circle.value)([v3AttrStr("r")(str12("50")), v3AttrStr("fill")(str12("blue"))])), elem3(Text.value)([v3AttrStr("x")(str12("100")), v3AttrStr("y")(str12("100"))])]);
        return bind59(liftEffect54(runMermaidTree(tree2)))(function(code3) {
          return discard39(modify_11(function(v1) {
            var $26 = {};
            for (var $27 in v1) {
              if ({}.hasOwnProperty.call(v1, $27)) {
                $26[$27] = v1[$27];
              }
              ;
            }
            ;
            $26.mermaidCode = new Just(code3);
            return $26;
          }))(function() {
            return liftEffect54(runMermaid);
          });
        });
      }
      ;
      if (v2 instanceof GenerateJoinTree) {
        var sampleData2 = [1, 2, 3, 4, 5];
        var tree2 = withChild(named(SVG.value)("svg")([v3AttrStr("width")(str12("800"))]))(joinData("circles")("circle")(sampleData2)(function(d) {
          return elem3(Circle.value)([v3AttrFn3("cx")(function(datum2) {
            return toNumber(datum2) * 50;
          }), v3Attr10("cy")(lit11(100)), v3AttrStr("r")(str12("20")), v3AttrStr("fill")(str12("steelblue"))]);
        }));
        return bind59(liftEffect54(runMermaidTree(tree2)))(function(code3) {
          return discard39(modify_11(function(v1) {
            var $29 = {};
            for (var $30 in v1) {
              if ({}.hasOwnProperty.call(v1, $30)) {
                $29[$30] = v1[$30];
              }
              ;
            }
            ;
            $29.mermaidCode = new Just(code3);
            return $29;
          }))(function() {
            return liftEffect54(runMermaid);
          });
        });
      }
      ;
      throw new Error("Failed pattern match at Component.MermaidTreeDemo (line 78, column 16 - line 109, column 26): " + [v2.constructor.name]);
    };
  };
  var component18 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return {
          mermaidCode: Nothing.value
        };
      },
      render: render22,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction17(dictMonadAff),
        initialize: new Just(Initialize18.value)
      })
    });
  };

  // output/D3.Viz.SPLOM.Data/index.js
  var pure54 = /* @__PURE__ */ pure(applicativeAff);
  var show54 = /* @__PURE__ */ show(showLoadError);
  var parseYear2 = function(s3) {
    var v2 = fromString2(trim(s3));
    if (v2 instanceof Just) {
      return v2.value0;
    }
    ;
    if (v2 instanceof Nothing) {
      return 2007;
    }
    ;
    throw new Error("Failed pattern match at D3.Viz.SPLOM.Data (line 75, column 15 - line 77, column 18): " + [v2.constructor.name]);
  };
  var parseSex = function(s3) {
    var trimmed = trim(s3);
    var $10 = trimmed === "NA" || trimmed === "";
    if ($10) {
      return Nothing.value;
    }
    ;
    return new Just(trimmed);
  };
  var parseNumber2 = function(s3) {
    var trimmed = trim(s3);
    var $11 = trimmed === "NA" || trimmed === "";
    if ($11) {
      return Nothing.value;
    }
    ;
    return fromString(trimmed);
  };
  var parseLine2 = function(line) {
    var fields = split(",")(line);
    if (fields.length === 8) {
      return new Just({
        species: trim(fields[0]),
        island: trim(fields[1]),
        billLength: parseNumber2(fields[2]),
        billDepth: parseNumber2(fields[3]),
        flipperLength: parseNumber2(fields[4]),
        bodyMass: parseNumber2(fields[5]),
        sex: parseSex(fields[6]),
        year: parseYear2(fields[7])
      });
    }
    ;
    return Nothing.value;
  };
  var parseCSV = function(text47) {
    var lines = split("\n")(text47);
    var dataLines = filter(function(l2) {
      return trim(l2) !== "";
    })(drop(1)(lines));
    var parsed = mapMaybe(parseLine2)(dataLines);
    var $21 = length3(parsed) > 0;
    if ($21) {
      return new Right(parsed);
    }
    ;
    return new Left("No valid penguin records found");
  };
  var loadPenguins = /* @__PURE__ */ bind(bindAff)(/* @__PURE__ */ loadLocalText("./data/penguins.csv"))(function(result) {
    return pure54((function() {
      if (result instanceof Left) {
        return new Left(show54(result.value0));
      }
      ;
      if (result instanceof Right) {
        return parseCSV(result.value0);
      }
      ;
      throw new Error("Failed pattern match at D3.Viz.SPLOM.Data (line 24, column 10 - line 26, column 32): " + [result.constructor.name]);
    })());
  });

  // output/D3.Viz.SPLOM.SPLOM/foreign.js
  var dimensionAttrMap = {
    "billLength": "data-bill-length",
    "billDepth": "data-bill-depth",
    "flipperLength": "data-flipper-length",
    "bodyMass": "data-body-mass"
  };
  function updatePointVisibility_(containerSelector) {
    return function(maybeSelection) {
      return function(selectedRadius) {
        return function() {
          const container = select_default2(containerSelector);
          const points = container.selectAll(".point");
          if (maybeSelection === null || maybeSelection.value0 === void 0) {
            points.attr("fill-opacity", 0.7).attr("r", selectedRadius);
          } else {
            const sel = maybeSelection.value0;
            const xAttr = dimensionAttrMap[sel.dimX];
            const yAttr = dimensionAttrMap[sel.dimY];
            const xMin = Math.min(sel.xMin, sel.xMax);
            const xMax = Math.max(sel.xMin, sel.xMax);
            const yMin = Math.min(sel.yMin, sel.yMax);
            const yMax = Math.max(sel.yMin, sel.yMax);
            if (!xAttr || !yAttr) {
              console.error("Unknown dimension key:", sel.dimX, sel.dimY);
              return;
            }
            points.each(function() {
              const point3 = select_default2(this);
              const xVal = parseFloat(this.getAttribute(xAttr));
              const yVal = parseFloat(this.getAttribute(yAttr));
              if (isNaN(xVal) || isNaN(yVal)) {
                point3.attr("fill-opacity", 0.1).attr("r", 1.5);
                return;
              }
              const isSelected = xVal >= xMin && xVal <= xMax && yVal >= yMin && yVal <= yMax;
              point3.attr("fill-opacity", isSelected ? 0.7 : 0.1).attr("r", isSelected ? selectedRadius : 1.5);
            });
          }
        };
      };
    };
  }

  // output/D3.Viz.SPLOM.Types/index.js
  var BillLength = /* @__PURE__ */ (function() {
    function BillLength2() {
    }
    ;
    BillLength2.value = new BillLength2();
    return BillLength2;
  })();
  var BillDepth = /* @__PURE__ */ (function() {
    function BillDepth2() {
    }
    ;
    BillDepth2.value = new BillDepth2();
    return BillDepth2;
  })();
  var FlipperLength = /* @__PURE__ */ (function() {
    function FlipperLength2() {
    }
    ;
    FlipperLength2.value = new FlipperLength2();
    return FlipperLength2;
  })();
  var BodyMass = /* @__PURE__ */ (function() {
    function BodyMass2() {
    }
    ;
    BodyMass2.value = new BodyMass2();
    return BodyMass2;
  })();
  var eqNumericDimension = {
    eq: function(x32) {
      return function(y32) {
        if (x32 instanceof BillLength && y32 instanceof BillLength) {
          return true;
        }
        ;
        if (x32 instanceof BillDepth && y32 instanceof BillDepth) {
          return true;
        }
        ;
        if (x32 instanceof FlipperLength && y32 instanceof FlipperLength) {
          return true;
        }
        ;
        if (x32 instanceof BodyMass && y32 instanceof BodyMass) {
          return true;
        }
        ;
        return false;
      };
    }
  };
  var speciesColor = function(v2) {
    if (v2 === "Adelie") {
      return "#1f77b4";
    }
    ;
    if (v2 === "Gentoo") {
      return "#ff7f0e";
    }
    ;
    if (v2 === "Chinstrap") {
      return "#2ca02c";
    }
    ;
    return "#999";
  };
  var getDimensionValue = function(dim) {
    return function(p2) {
      if (dim instanceof BillLength) {
        return p2.billLength;
      }
      ;
      if (dim instanceof BillDepth) {
        return p2.billDepth;
      }
      ;
      if (dim instanceof FlipperLength) {
        return p2.flipperLength;
      }
      ;
      if (dim instanceof BodyMass) {
        return p2.bodyMass;
      }
      ;
      throw new Error("Failed pattern match at D3.Viz.SPLOM.Types (line 65, column 27 - line 69, column 25): " + [dim.constructor.name]);
    };
  };
  var dimensionLabel = function(v2) {
    if (v2 instanceof BillLength) {
      return "Bill Length (mm)";
    }
    ;
    if (v2 instanceof BillDepth) {
      return "Bill Depth (mm)";
    }
    ;
    if (v2 instanceof FlipperLength) {
      return "Flipper Length (mm)";
    }
    ;
    if (v2 instanceof BodyMass) {
      return "Body Mass (g)";
    }
    ;
    throw new Error("Failed pattern match at D3.Viz.SPLOM.Types (line 45, column 18 - line 49, column 30): " + [v2.constructor.name]);
  };
  var dimensionKey = function(v2) {
    if (v2 instanceof BillLength) {
      return "billLength";
    }
    ;
    if (v2 instanceof BillDepth) {
      return "billDepth";
    }
    ;
    if (v2 instanceof FlipperLength) {
      return "flipperLength";
    }
    ;
    if (v2 instanceof BodyMass) {
      return "bodyMass";
    }
    ;
    throw new Error("Failed pattern match at D3.Viz.SPLOM.Types (line 53, column 16 - line 57, column 25): " + [v2.constructor.name]);
  };
  var allDimensions = /* @__PURE__ */ (function() {
    return [BillLength.value, BillDepth.value, FlipperLength.value, BodyMass.value];
  })();

  // node_modules/d3-brush/src/constant.js
  var constant_default8 = (x32) => () => x32;

  // node_modules/d3-brush/src/event.js
  function BrushEvent(type2, {
    sourceEvent,
    target: target7,
    selection: selection2,
    mode,
    dispatch: dispatch2
  }) {
    Object.defineProperties(this, {
      type: { value: type2, enumerable: true, configurable: true },
      sourceEvent: { value: sourceEvent, enumerable: true, configurable: true },
      target: { value: target7, enumerable: true, configurable: true },
      selection: { value: selection2, enumerable: true, configurable: true },
      mode: { value: mode, enumerable: true, configurable: true },
      _: { value: dispatch2 }
    });
  }

  // node_modules/d3-brush/src/noevent.js
  function nopropagation3(event) {
    event.stopImmediatePropagation();
  }
  function noevent_default3(event) {
    event.preventDefault();
    event.stopImmediatePropagation();
  }

  // node_modules/d3-brush/src/brush.js
  var MODE_DRAG = { name: "drag" };
  var MODE_SPACE = { name: "space" };
  var MODE_HANDLE = { name: "handle" };
  var MODE_CENTER = { name: "center" };
  var { abs: abs5, max: max17, min: min13 } = Math;
  function number1(e) {
    return [+e[0], +e[1]];
  }
  function number22(e) {
    return [number1(e[0]), number1(e[1])];
  }
  var X = {
    name: "x",
    handles: ["w", "e"].map(type),
    input: function(x32, e) {
      return x32 == null ? null : [[+x32[0], e[0][1]], [+x32[1], e[1][1]]];
    },
    output: function(xy) {
      return xy && [xy[0][0], xy[1][0]];
    }
  };
  var Y = {
    name: "y",
    handles: ["n", "s"].map(type),
    input: function(y32, e) {
      return y32 == null ? null : [[e[0][0], +y32[0]], [e[1][0], +y32[1]]];
    },
    output: function(xy) {
      return xy && [xy[0][1], xy[1][1]];
    }
  };
  var XY = {
    name: "xy",
    handles: ["n", "w", "e", "s", "nw", "ne", "sw", "se"].map(type),
    input: function(xy) {
      return xy == null ? null : number22(xy);
    },
    output: function(xy) {
      return xy;
    }
  };
  var cursors = {
    overlay: "crosshair",
    selection: "move",
    n: "ns-resize",
    e: "ew-resize",
    s: "ns-resize",
    w: "ew-resize",
    nw: "nwse-resize",
    ne: "nesw-resize",
    se: "nwse-resize",
    sw: "nesw-resize"
  };
  var flipX = {
    e: "w",
    w: "e",
    nw: "ne",
    ne: "nw",
    se: "sw",
    sw: "se"
  };
  var flipY = {
    n: "s",
    s: "n",
    nw: "sw",
    ne: "se",
    se: "ne",
    sw: "nw"
  };
  var signsX = {
    overlay: 1,
    selection: 1,
    n: null,
    e: 1,
    s: null,
    w: -1,
    nw: -1,
    ne: 1,
    se: 1,
    sw: -1
  };
  var signsY = {
    overlay: 1,
    selection: 1,
    n: -1,
    e: null,
    s: 1,
    w: null,
    nw: -1,
    ne: -1,
    se: 1,
    sw: 1
  };
  function type(t2) {
    return { type: t2 };
  }
  function defaultFilter3(event) {
    return !event.ctrlKey && !event.button;
  }
  function defaultExtent2() {
    var svg2 = this.ownerSVGElement || this;
    if (svg2.hasAttribute("viewBox")) {
      svg2 = svg2.viewBox.baseVal;
      return [[svg2.x, svg2.y], [svg2.x + svg2.width, svg2.y + svg2.height]];
    }
    return [[0, 0], [svg2.width.baseVal.value, svg2.height.baseVal.value]];
  }
  function defaultTouchable3() {
    return navigator.maxTouchPoints || "ontouchstart" in this;
  }
  function local2(node) {
    while (!node.__brush) if (!(node = node.parentNode)) return;
    return node.__brush;
  }
  function empty9(extent2) {
    return extent2[0][0] === extent2[1][0] || extent2[0][1] === extent2[1][1];
  }
  function brushSelection(node) {
    var state3 = node.__brush;
    return state3 ? state3.dim.output(state3.selection) : null;
  }
  function brush_default() {
    return brush(XY);
  }
  function brush(dim) {
    var extent2 = defaultExtent2, filter7 = defaultFilter3, touchable = defaultTouchable3, keys4 = true, listeners = dispatch_default2("start", "brush", "end"), handleSize = 6, touchending;
    function brush2(group4) {
      var overlay = group4.property("__brush", initialize).selectAll(".overlay").data([type("overlay")]);
      overlay.enter().append("rect").attr("class", "overlay").attr("pointer-events", "all").attr("cursor", cursors.overlay).merge(overlay).each(function() {
        var extent3 = local2(this).extent;
        select_default2(this).attr("x", extent3[0][0]).attr("y", extent3[0][1]).attr("width", extent3[1][0] - extent3[0][0]).attr("height", extent3[1][1] - extent3[0][1]);
      });
      group4.selectAll(".selection").data([type("selection")]).enter().append("rect").attr("class", "selection").attr("cursor", cursors.selection).attr("fill", "#777").attr("fill-opacity", 0.3).attr("stroke", "#fff").attr("shape-rendering", "crispEdges");
      var handle = group4.selectAll(".handle").data(dim.handles, function(d) {
        return d.type;
      });
      handle.exit().remove();
      handle.enter().append("rect").attr("class", function(d) {
        return "handle handle--" + d.type;
      }).attr("cursor", function(d) {
        return cursors[d.type];
      });
      group4.each(redraw).attr("fill", "none").attr("pointer-events", "all").on("mousedown.brush", started).filter(touchable).on("touchstart.brush", started).on("touchmove.brush", touchmoved).on("touchend.brush touchcancel.brush", touchended).style("touch-action", "none").style("-webkit-tap-highlight-color", "rgba(0,0,0,0)");
    }
    brush2.move = function(group4, selection2, event) {
      if (group4.tween) {
        group4.on("start.brush", function(event2) {
          emitter(this, arguments).beforestart().start(event2);
        }).on("interrupt.brush end.brush", function(event2) {
          emitter(this, arguments).end(event2);
        }).tween("brush", function() {
          var that = this, state3 = that.__brush, emit = emitter(that, arguments), selection0 = state3.selection, selection1 = dim.input(typeof selection2 === "function" ? selection2.apply(this, arguments) : selection2, state3.extent), i2 = value_default(selection0, selection1);
          function tween(t2) {
            state3.selection = t2 === 1 && selection1 === null ? null : i2(t2);
            redraw.call(that);
            emit.brush();
          }
          return selection0 !== null && selection1 !== null ? tween : tween(1);
        });
      } else {
        group4.each(function() {
          var that = this, args = arguments, state3 = that.__brush, selection1 = dim.input(typeof selection2 === "function" ? selection2.apply(that, args) : selection2, state3.extent), emit = emitter(that, args).beforestart();
          interrupt_default(that);
          state3.selection = selection1 === null ? null : selection1;
          redraw.call(that);
          emit.start(event).brush(event).end(event);
        });
      }
    };
    brush2.clear = function(group4, event) {
      brush2.move(group4, null, event);
    };
    function redraw() {
      var group4 = select_default2(this), selection2 = local2(this).selection;
      if (selection2) {
        group4.selectAll(".selection").style("display", null).attr("x", selection2[0][0]).attr("y", selection2[0][1]).attr("width", selection2[1][0] - selection2[0][0]).attr("height", selection2[1][1] - selection2[0][1]);
        group4.selectAll(".handle").style("display", null).attr("x", function(d) {
          return d.type[d.type.length - 1] === "e" ? selection2[1][0] - handleSize / 2 : selection2[0][0] - handleSize / 2;
        }).attr("y", function(d) {
          return d.type[0] === "s" ? selection2[1][1] - handleSize / 2 : selection2[0][1] - handleSize / 2;
        }).attr("width", function(d) {
          return d.type === "n" || d.type === "s" ? selection2[1][0] - selection2[0][0] + handleSize : handleSize;
        }).attr("height", function(d) {
          return d.type === "e" || d.type === "w" ? selection2[1][1] - selection2[0][1] + handleSize : handleSize;
        });
      } else {
        group4.selectAll(".selection,.handle").style("display", "none").attr("x", null).attr("y", null).attr("width", null).attr("height", null);
      }
    }
    function emitter(that, args, clean) {
      var emit = that.__brush.emitter;
      return emit && (!clean || !emit.clean) ? emit : new Emitter(that, args, clean);
    }
    function Emitter(that, args, clean) {
      this.that = that;
      this.args = args;
      this.state = that.__brush;
      this.active = 0;
      this.clean = clean;
    }
    Emitter.prototype = {
      beforestart: function() {
        if (++this.active === 1) this.state.emitter = this, this.starting = true;
        return this;
      },
      start: function(event, mode) {
        if (this.starting) this.starting = false, this.emit("start", event, mode);
        else this.emit("brush", event);
        return this;
      },
      brush: function(event, mode) {
        this.emit("brush", event, mode);
        return this;
      },
      end: function(event, mode) {
        if (--this.active === 0) delete this.state.emitter, this.emit("end", event, mode);
        return this;
      },
      emit: function(type2, event, mode) {
        var d = select_default2(this.that).datum();
        listeners.call(
          type2,
          this.that,
          new BrushEvent(type2, {
            sourceEvent: event,
            target: brush2,
            selection: dim.output(this.state.selection),
            mode,
            dispatch: listeners
          }),
          d
        );
      }
    };
    function started(event) {
      if (touchending && !event.touches) return;
      if (!filter7.apply(this, arguments)) return;
      var that = this, type2 = event.target.__data__.type, mode = (keys4 && event.metaKey ? type2 = "overlay" : type2) === "selection" ? MODE_DRAG : keys4 && event.altKey ? MODE_CENTER : MODE_HANDLE, signX = dim === Y ? null : signsX[type2], signY = dim === X ? null : signsY[type2], state3 = local2(that), extent3 = state3.extent, selection2 = state3.selection, W = extent3[0][0], w0, w1, N = extent3[0][1], n0, n1, E = extent3[1][0], e0, e1, S = extent3[1][1], s0, s1, dx = 0, dy = 0, moving, shifting = signX && signY && keys4 && event.shiftKey, lockX, lockY, points = Array.from(event.touches || [event], (t2) => {
        const i2 = t2.identifier;
        t2 = pointer_default(t2, that);
        t2.point0 = t2.slice();
        t2.identifier = i2;
        return t2;
      });
      interrupt_default(that);
      var emit = emitter(that, arguments, true).beforestart();
      if (type2 === "overlay") {
        if (selection2) moving = true;
        const pts = [points[0], points[1] || points[0]];
        state3.selection = selection2 = [[
          w0 = dim === Y ? W : min13(pts[0][0], pts[1][0]),
          n0 = dim === X ? N : min13(pts[0][1], pts[1][1])
        ], [
          e0 = dim === Y ? E : max17(pts[0][0], pts[1][0]),
          s0 = dim === X ? S : max17(pts[0][1], pts[1][1])
        ]];
        if (points.length > 1) move(event);
      } else {
        w0 = selection2[0][0];
        n0 = selection2[0][1];
        e0 = selection2[1][0];
        s0 = selection2[1][1];
      }
      w1 = w0;
      n1 = n0;
      e1 = e0;
      s1 = s0;
      var group4 = select_default2(that).attr("pointer-events", "none");
      var overlay = group4.selectAll(".overlay").attr("cursor", cursors[type2]);
      if (event.touches) {
        emit.moved = moved;
        emit.ended = ended2;
      } else {
        var view = select_default2(event.view).on("mousemove.brush", moved, true).on("mouseup.brush", ended2, true);
        if (keys4) view.on("keydown.brush", keydowned, true).on("keyup.brush", keyupped, true);
        nodrag_default(event.view);
      }
      redraw.call(that);
      emit.start(event, mode.name);
      function moved(event2) {
        for (const p2 of event2.changedTouches || [event2]) {
          for (const d of points)
            if (d.identifier === p2.identifier) d.cur = pointer_default(p2, that);
        }
        if (shifting && !lockX && !lockY && points.length === 1) {
          const point3 = points[0];
          if (abs5(point3.cur[0] - point3[0]) > abs5(point3.cur[1] - point3[1]))
            lockY = true;
          else
            lockX = true;
        }
        for (const point3 of points)
          if (point3.cur) point3[0] = point3.cur[0], point3[1] = point3.cur[1];
        moving = true;
        noevent_default3(event2);
        move(event2);
      }
      function move(event2) {
        const point3 = points[0], point0 = point3.point0;
        var t2;
        dx = point3[0] - point0[0];
        dy = point3[1] - point0[1];
        switch (mode) {
          case MODE_SPACE:
          case MODE_DRAG: {
            if (signX) dx = max17(W - w0, min13(E - e0, dx)), w1 = w0 + dx, e1 = e0 + dx;
            if (signY) dy = max17(N - n0, min13(S - s0, dy)), n1 = n0 + dy, s1 = s0 + dy;
            break;
          }
          case MODE_HANDLE: {
            if (points[1]) {
              if (signX) w1 = max17(W, min13(E, points[0][0])), e1 = max17(W, min13(E, points[1][0])), signX = 1;
              if (signY) n1 = max17(N, min13(S, points[0][1])), s1 = max17(N, min13(S, points[1][1])), signY = 1;
            } else {
              if (signX < 0) dx = max17(W - w0, min13(E - w0, dx)), w1 = w0 + dx, e1 = e0;
              else if (signX > 0) dx = max17(W - e0, min13(E - e0, dx)), w1 = w0, e1 = e0 + dx;
              if (signY < 0) dy = max17(N - n0, min13(S - n0, dy)), n1 = n0 + dy, s1 = s0;
              else if (signY > 0) dy = max17(N - s0, min13(S - s0, dy)), n1 = n0, s1 = s0 + dy;
            }
            break;
          }
          case MODE_CENTER: {
            if (signX) w1 = max17(W, min13(E, w0 - dx * signX)), e1 = max17(W, min13(E, e0 + dx * signX));
            if (signY) n1 = max17(N, min13(S, n0 - dy * signY)), s1 = max17(N, min13(S, s0 + dy * signY));
            break;
          }
        }
        if (e1 < w1) {
          signX *= -1;
          t2 = w0, w0 = e0, e0 = t2;
          t2 = w1, w1 = e1, e1 = t2;
          if (type2 in flipX) overlay.attr("cursor", cursors[type2 = flipX[type2]]);
        }
        if (s1 < n1) {
          signY *= -1;
          t2 = n0, n0 = s0, s0 = t2;
          t2 = n1, n1 = s1, s1 = t2;
          if (type2 in flipY) overlay.attr("cursor", cursors[type2 = flipY[type2]]);
        }
        if (state3.selection) selection2 = state3.selection;
        if (lockX) w1 = selection2[0][0], e1 = selection2[1][0];
        if (lockY) n1 = selection2[0][1], s1 = selection2[1][1];
        if (selection2[0][0] !== w1 || selection2[0][1] !== n1 || selection2[1][0] !== e1 || selection2[1][1] !== s1) {
          state3.selection = [[w1, n1], [e1, s1]];
          redraw.call(that);
          emit.brush(event2, mode.name);
        }
      }
      function ended2(event2) {
        nopropagation3(event2);
        if (event2.touches) {
          if (event2.touches.length) return;
          if (touchending) clearTimeout(touchending);
          touchending = setTimeout(function() {
            touchending = null;
          }, 500);
        } else {
          yesdrag(event2.view, moving);
          view.on("keydown.brush keyup.brush mousemove.brush mouseup.brush", null);
        }
        group4.attr("pointer-events", "all");
        overlay.attr("cursor", cursors.overlay);
        if (state3.selection) selection2 = state3.selection;
        if (empty9(selection2)) state3.selection = null, redraw.call(that);
        emit.end(event2, mode.name);
      }
      function keydowned(event2) {
        switch (event2.keyCode) {
          case 16: {
            shifting = signX && signY;
            break;
          }
          case 18: {
            if (mode === MODE_HANDLE) {
              if (signX) e0 = e1 - dx * signX, w0 = w1 + dx * signX;
              if (signY) s0 = s1 - dy * signY, n0 = n1 + dy * signY;
              mode = MODE_CENTER;
              move(event2);
            }
            break;
          }
          case 32: {
            if (mode === MODE_HANDLE || mode === MODE_CENTER) {
              if (signX < 0) e0 = e1 - dx;
              else if (signX > 0) w0 = w1 - dx;
              if (signY < 0) s0 = s1 - dy;
              else if (signY > 0) n0 = n1 - dy;
              mode = MODE_SPACE;
              overlay.attr("cursor", cursors.selection);
              move(event2);
            }
            break;
          }
          default:
            return;
        }
        noevent_default3(event2);
      }
      function keyupped(event2) {
        switch (event2.keyCode) {
          case 16: {
            if (shifting) {
              lockX = lockY = shifting = false;
              move(event2);
            }
            break;
          }
          case 18: {
            if (mode === MODE_CENTER) {
              if (signX < 0) e0 = e1;
              else if (signX > 0) w0 = w1;
              if (signY < 0) s0 = s1;
              else if (signY > 0) n0 = n1;
              mode = MODE_HANDLE;
              move(event2);
            }
            break;
          }
          case 32: {
            if (mode === MODE_SPACE) {
              if (event2.altKey) {
                if (signX) e0 = e1 - dx * signX, w0 = w1 + dx * signX;
                if (signY) s0 = s1 - dy * signY, n0 = n1 + dy * signY;
                mode = MODE_CENTER;
              } else {
                if (signX < 0) e0 = e1;
                else if (signX > 0) w0 = w1;
                if (signY < 0) s0 = s1;
                else if (signY > 0) n0 = n1;
                mode = MODE_HANDLE;
              }
              overlay.attr("cursor", cursors[type2]);
              move(event2);
            }
            break;
          }
          default:
            return;
        }
        noevent_default3(event2);
      }
    }
    function touchmoved(event) {
      emitter(this, arguments).moved(event);
    }
    function touchended(event) {
      emitter(this, arguments).ended(event);
    }
    function initialize() {
      var state3 = this.__brush || { selection: null };
      state3.extent = number22(extent2.apply(this, arguments));
      state3.dim = dim;
      return state3;
    }
    brush2.extent = function(_) {
      return arguments.length ? (extent2 = typeof _ === "function" ? _ : constant_default8(number22(_)), brush2) : extent2;
    };
    brush2.filter = function(_) {
      return arguments.length ? (filter7 = typeof _ === "function" ? _ : constant_default8(!!_), brush2) : filter7;
    };
    brush2.touchable = function(_) {
      return arguments.length ? (touchable = typeof _ === "function" ? _ : constant_default8(!!_), brush2) : touchable;
    };
    brush2.handleSize = function(_) {
      return arguments.length ? (handleSize = +_, brush2) : handleSize;
    };
    brush2.keyModifiers = function(_) {
      return arguments.length ? (keys4 = !!_, brush2) : keys4;
    };
    brush2.on = function() {
      var value20 = listeners.on.apply(listeners, arguments);
      return value20 === listeners ? brush2 : value20;
    };
    return brush2;
  }

  // output/PSD3.Brush.FFI/foreign.js
  function attachBrush_(element4) {
    return (extent2) => (onStart) => (onBrush) => (onEnd) => () => {
      const selection2 = select_default2(element4);
      function toRecord(sel) {
        if (!sel) return null;
        return { x0: sel[0][0], y0: sel[0][1], x1: sel[1][0], y1: sel[1][1] };
      }
      const brushBehavior = brush_default().extent([[extent2.x0, extent2.y0], [extent2.x1, extent2.y1]]).on("start", function(event) {
        onStart(toRecord(event.selection))();
      }).on("brush", function(event) {
        onBrush(toRecord(event.selection))();
      }).on("end", function(event) {
        onEnd(toRecord(event.selection))();
      });
      selection2.call(brushBehavior);
      return {
        clear: () => {
          selection2.call(brushBehavior.move, null);
        },
        move: (newSelection) => () => {
          if (newSelection) {
            selection2.call(
              brushBehavior.move,
              [[newSelection.x0, newSelection.y0], [newSelection.x1, newSelection.y1]]
            );
          } else {
            selection2.call(brushBehavior.move, null);
          }
        },
        getSelection: () => {
          const sel = brushSelection(element4);
          return toRecord(sel);
        }
      };
    };
  }
  function clearBrush_(brushHandle) {
    return () => {
      brushHandle.clear();
    };
  }

  // output/PSD3.Brush.Types/index.js
  var Selection2D = /* @__PURE__ */ (function() {
    function Selection2D2(value0) {
      this.value0 = value0;
    }
    ;
    Selection2D2.create = function(value0) {
      return new Selection2D2(value0);
    };
    return Selection2D2;
  })();
  var NoSelection = /* @__PURE__ */ (function() {
    function NoSelection2() {
    }
    ;
    NoSelection2.value = new NoSelection2();
    return NoSelection2;
  })();

  // output/PSD3.Brush/index.js
  var pure55 = /* @__PURE__ */ pure(applicativeEffect);
  var fromNullable2D = function(nullable2) {
    var v2 = toMaybe(nullable2);
    if (v2 instanceof Nothing) {
      return NoSelection.value;
    }
    ;
    if (v2 instanceof Just) {
      return new Selection2D(v2.value0);
    }
    ;
    throw new Error("Failed pattern match at PSD3.Brush (line 166, column 27 - line 168, column 26): " + [v2.constructor.name]);
  };
  var makeHandler2D = function(maybeHandler) {
    if (maybeHandler instanceof Nothing) {
      return function(v2) {
        return pure55(unit);
      };
    }
    ;
    if (maybeHandler instanceof Just) {
      return function(nullable2) {
        return maybeHandler.value0({
          selection: fromNullable2D(nullable2)
        });
      };
    }
    ;
    throw new Error("Failed pattern match at PSD3.Brush (line 141, column 30 - line 144, column 51): " + [maybeHandler.constructor.name]);
  };
  var clearBrush = clearBrush_;
  var attachBrush = function(element4) {
    return function(config) {
      return attachBrush_(element4)(config.extent)(makeHandler2D(config.onStart))(makeHandler2D(config.onBrush))(makeHandler2D(config.onEnd));
    };
  };

  // output/D3.Viz.SPLOM.SPLOM/index.js
  var show55 = /* @__PURE__ */ show(showNumber);
  var show125 = /* @__PURE__ */ show(showInt);
  var mapFlipped9 = /* @__PURE__ */ mapFlipped(functorMaybe);
  var eq24 = /* @__PURE__ */ eq(eqNumericDimension);
  var v3Attr11 = /* @__PURE__ */ v3Attr(showNumber);
  var lit12 = /* @__PURE__ */ lit(numExprEvalD);
  var mapFlipped13 = /* @__PURE__ */ mapFlipped(functorArray);
  var minimum6 = /* @__PURE__ */ minimum(ordNumber)(foldableArray);
  var maximum11 = /* @__PURE__ */ maximum(ordNumber)(foldableArray);
  var for_6 = /* @__PURE__ */ for_(applicativeEffect)(foldableArray);
  var str13 = /* @__PURE__ */ str(stringExprEvalD);
  var append115 = /* @__PURE__ */ append(semigroupArray);
  var discard40 = /* @__PURE__ */ discard(discardUnit);
  var discard117 = /* @__PURE__ */ discard40(bindD3v2M);
  var clear5 = /* @__PURE__ */ clear(selectionMD3v2Selection_D);
  var bind60 = /* @__PURE__ */ bind(bindD3v2M);
  var select31 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var ordMaybe4 = /* @__PURE__ */ ordMaybe(ordNumber);
  var renderTree53 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(/* @__PURE__ */ ordRecord()(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(ordRecordNil)()({
    reflectSymbol: function() {
      return "year";
    }
  })(ordInt))()({
    reflectSymbol: function() {
      return "species";
    }
  })(ordString))()({
    reflectSymbol: function() {
      return "sex";
    }
  })(/* @__PURE__ */ ordMaybe(ordString)))()({
    reflectSymbol: function() {
      return "island";
    }
  })(ordString))()({
    reflectSymbol: function() {
      return "flipperLength";
    }
  })(ordMaybe4))()({
    reflectSymbol: function() {
      return "bodyMass";
    }
  })(ordMaybe4))()({
    reflectSymbol: function() {
      return "billLength";
    }
  })(ordMaybe4))()({
    reflectSymbol: function() {
      return "billDepth";
    }
  })(ordMaybe4)));
  var pure56 = /* @__PURE__ */ pure(applicativeD3v2M);
  var bind126 = /* @__PURE__ */ bind(bindEffect);
  var map76 = /* @__PURE__ */ map(functorEffect);
  var traverse5 = /* @__PURE__ */ traverse(traversableArray)(applicativeEffect);
  var updatePointVisibility = function(state3) {
    if (state3.selection instanceof Nothing) {
      return updatePointVisibility_(state3.containerSelector)(Nothing.value)(state3.config.pointRadius);
    }
    ;
    if (state3.selection instanceof Just) {
      var ffiSelection = {
        dimX: dimensionKey(state3.selection.value0.dimX),
        dimY: dimensionKey(state3.selection.value0.dimY),
        xMin: state3.selection.value0.xMin,
        xMax: state3.selection.value0.xMax,
        yMin: state3.selection.value0.yMin,
        yMax: state3.selection.value0.yMax
      };
      return updatePointVisibility_(state3.containerSelector)(new Just(ffiSelection))(state3.config.pointRadius);
    }
    ;
    throw new Error("Failed pattern match at D3.Viz.SPLOM.SPLOM (line 212, column 3 - line 226, column 101): " + [state3.selection.constructor.name]);
  };
  var replaceSubstring = function(search2) {
    return function(replacement) {
      return function(str1) {
        var searchLen = length7(search2);
        var go2 = function($copy_idx) {
          return function($copy_s) {
            var $tco_var_idx = $copy_idx;
            var $tco_done = false;
            var $tco_result;
            function $tco_loop(idx, s3) {
              if (idx > (length7(s3) - searchLen | 0)) {
                $tco_done = true;
                return s3;
              }
              ;
              if (take3(searchLen)(drop3(idx)(s3)) === search2) {
                $tco_done = true;
                return take3(idx)(s3) + (replacement + drop3(idx + searchLen | 0)(s3));
              }
              ;
              if (otherwise) {
                $tco_var_idx = idx + 1 | 0;
                $copy_s = s3;
                return;
              }
              ;
              throw new Error("Failed pattern match at D3.Viz.SPLOM.SPLOM (line 635, column 5 - line 639, column 35): " + [idx.constructor.name, s3.constructor.name]);
            }
            ;
            while (!$tco_done) {
              $tco_result = $tco_loop($tco_var_idx, $copy_s);
            }
            ;
            return $tco_result;
          };
        };
        return go2(0)(str1);
      };
    };
  };
  var shortenLabel = function(label5) {
    return replaceSubstring(" (mm)")("")(replaceSubstring(" (g)")("")(label5));
  };
  var offDiagonalCells = /* @__PURE__ */ filter(function(c2) {
    return c2.row !== c2.col;
  });
  var isPointSelected = function(v2) {
    return function(v1) {
      if (v2 instanceof Nothing) {
        return true;
      }
      ;
      if (v2 instanceof Just) {
        var v22 = getDimensionValue(v2.value0.dimY)(v1);
        var v3 = getDimensionValue(v2.value0.dimX)(v1);
        if (v3 instanceof Just && v22 instanceof Just) {
          return v3.value0 >= v2.value0.xMin && (v3.value0 <= v2.value0.xMax && (v22.value0 >= v2.value0.yMin && v22.value0 <= v2.value0.yMax));
        }
        ;
        return false;
      }
      ;
      throw new Error("Failed pattern match at D3.Viz.SPLOM.SPLOM (line 169, column 1 - line 169, column 59): " + [v2.constructor.name, v1.constructor.name]);
    };
  };
  var getTotalCount = function(state3) {
    return length3(state3.validPenguins);
  };
  var getSelectedCount = function(state3) {
    return length3(filter(isPointSelected(state3.selection))(state3.validPenguins));
  };
  var generateCells = function(dimensions) {
    return concat(mapWithIndex3(function(row) {
      return function(dimY) {
        return mapWithIndex3(function(col2) {
          return function(dimX) {
            return {
              row,
              col: col2,
              dimX,
              dimY
            };
          };
        })(dimensions);
      };
    })(dimensions));
  };
  var formatTick = function(value20) {
    if (value20 >= 1e3) {
      return show55(floor(value20 / 100) / 10) + "k";
    }
    ;
    if (value20 === floor(value20)) {
      return show125(fromMaybe(0)(fromNumber(value20)));
    }
    ;
    if (otherwise) {
      return show55(floor(value20 * 10) / 10);
    }
    ;
    throw new Error("Failed pattern match at D3.Viz.SPLOM.SPLOM (line 618, column 1 - line 618, column 31): " + [value20.constructor.name]);
  };
  var findScale = function(dim) {
    return function(scales) {
      return mapFlipped9(find2(function(s3) {
        return eq24(s3.dimension)(dim);
      })(scales))(function(v2) {
        return v2.scale;
      });
    };
  };
  var filterValidPenguins = function(dimensions) {
    return function(penguins) {
      return filter(function(p2) {
        return all2(function(dim) {
          var v2 = getDimensionValue(dim)(p2);
          if (v2 instanceof Just) {
            return true;
          }
          ;
          if (v2 instanceof Nothing) {
            return false;
          }
          ;
          throw new Error("Failed pattern match at D3.Viz.SPLOM.SPLOM (line 142, column 24 - line 144, column 23): " + [v2.constructor.name]);
        })(dimensions);
      })(penguins);
    };
  };
  var defaultConfig4 = {
    cellSize: 120,
    cellPadding: 12,
    matrixPadding: 50,
    pointRadius: 2.5,
    tickCount: 5,
    dimensions: allDimensions
  };
  var dataAttr = function(name16) {
    return function(value20) {
      return v3Attr11("data-" + name16)(lit12(value20));
    };
  };
  var createScales = function(penguins) {
    return function(dimensions) {
      return function(cellPadding) {
        return function(cellSize) {
          return mapFlipped13(dimensions)(function(dim) {
            var values2 = mapMaybe(getDimensionValue(dim))(penguins);
            var minVal = fromMaybe(0)(minimum6(values2));
            var maxVal = fromMaybe(100)(maximum11(values2));
            var scale = nice2(range5([cellPadding, cellSize - cellPadding])(domain([minVal, maxVal])(linear4)));
            return {
              dimension: dim,
              scale
            };
          });
        };
      };
    };
  };
  var initialState2 = function(containerSelector) {
    return function(penguins) {
      var validPenguins = filterValidPenguins(defaultConfig4.dimensions)(penguins);
      var scales = createScales(validPenguins)(defaultConfig4.dimensions)(defaultConfig4.cellPadding)(defaultConfig4.cellSize);
      return {
        penguins,
        validPenguins,
        config: defaultConfig4,
        scales,
        selection: Nothing.value,
        brushHandles: [],
        activeBrushCell: Nothing.value,
        containerSelector
      };
    };
  };
  var clearBrushSelection = function(handles) {
    return for_6(handles)(function(bh) {
      return clearBrush(bh.handle);
    });
  };
  var buildOffDiagonalContent = function(state3) {
    return function(penguins) {
      return function(cell) {
        return function(mXScale) {
          return function(mYScale) {
            if (mXScale instanceof Just && mYScale instanceof Just) {
              var yTicks2 = ticks2(state3.config.tickCount)(mYScale.value0);
              var xTicks2 = ticks2(state3.config.tickCount)(mXScale.value0);
              return [withChildren(named(Group.value)("grid-v")([]))(mapFlipped13(xTicks2)(function(tick5) {
                return elem3(Line.value)([v3Attr11("x1")(lit12(applyScale2(mXScale.value0)(tick5))), v3Attr11("x2")(lit12(applyScale2(mXScale.value0)(tick5))), v3Attr11("y1")(lit12(state3.config.cellPadding)), v3Attr11("y2")(lit12(state3.config.cellSize - state3.config.cellPadding)), v3AttrStr("stroke")(str13("#eee")), v3Attr11("stroke-width")(lit12(0.5))]);
              })), withChildren(named(Group.value)("grid-h")([]))(mapFlipped13(yTicks2)(function(tick5) {
                return elem3(Line.value)([v3Attr11("x1")(lit12(state3.config.cellPadding)), v3Attr11("x2")(lit12(state3.config.cellSize - state3.config.cellPadding)), v3Attr11("y1")(lit12(applyScale2(mYScale.value0)(tick5))), v3Attr11("y2")(lit12(applyScale2(mYScale.value0)(tick5))), v3AttrStr("stroke")(str13("#eee")), v3Attr11("stroke-width")(lit12(0.5))]);
              })), withChildren(named(Group.value)("points")([]))(mapMaybe(function(p2) {
                var v2 = getDimensionValue(cell.dimY)(p2);
                var v1 = getDimensionValue(cell.dimX)(p2);
                if (v1 instanceof Just && v2 instanceof Just) {
                  var selected2 = isPointSelected(state3.selection)(p2);
                  var pointRadius2 = (function() {
                    if (selected2) {
                      return state3.config.pointRadius;
                    }
                    ;
                    return 1.5;
                  })();
                  var pointOpacity = (function() {
                    if (selected2) {
                      return 0.7;
                    }
                    ;
                    return 0.1;
                  })();
                  var flipLen = fromMaybe(0)(p2.flipperLength);
                  var bodyMas = fromMaybe(0)(p2.bodyMass);
                  var billLen = fromMaybe(0)(p2.billLength);
                  var billDep = fromMaybe(0)(p2.billDepth);
                  return new Just(elem3(Circle.value)([v3AttrStr("class")(str13("point")), v3Attr11("cx")(lit12(applyScale2(mXScale.value0)(v1.value0))), v3Attr11("cy")(lit12(applyScale2(mYScale.value0)(v2.value0))), v3Attr11("r")(lit12(pointRadius2)), v3AttrStr("fill")(str13(speciesColor(p2.species))), v3Attr11("fill-opacity")(lit12(pointOpacity)), v3AttrStr("stroke")(str13("none")), dataAttr("bill-length")(billLen), dataAttr("bill-depth")(billDep), dataAttr("flipper-length")(flipLen), dataAttr("body-mass")(bodyMas)]));
                }
                ;
                return Nothing.value;
              })(penguins)), named(Group.value)("brush")([v3AttrStr("class")(str13("brush"))])];
            }
            ;
            return [];
          };
        };
      };
    };
  };
  var buildDiagonalContent = function(state3) {
    return function(penguins) {
      return function(cell) {
        return function(mScale) {
          if (mScale instanceof Nothing) {
            return [];
          }
          ;
          if (mScale instanceof Just) {
            var tickValues = ticks2(state3.config.tickCount)(mScale.value0);
            var label5 = dimensionLabel(cell.dimX);
            var shortLabel = shortenLabel(label5);
            var allTicks = ticks2(10)(mScale.value0);
            var maxVal = fromMaybe(100)(maximum11(allTicks));
            var minVal = fromMaybe(0)(minimum6(allTicks));
            var yScaleInverted = range5([state3.config.cellSize - state3.config.cellPadding, state3.config.cellPadding])(domain([minVal, maxVal])(linear4));
            return [withChildren(named(Group.value)("grid-v")([]))(mapFlipped13(tickValues)(function(tick5) {
              return elem3(Line.value)([v3Attr11("x1")(lit12(applyScale2(mScale.value0)(tick5))), v3Attr11("x2")(lit12(applyScale2(mScale.value0)(tick5))), v3Attr11("y1")(lit12(state3.config.cellPadding)), v3Attr11("y2")(lit12(state3.config.cellSize - state3.config.cellPadding)), v3AttrStr("stroke")(str13("#eee")), v3Attr11("stroke-width")(lit12(0.5))]);
            })), withChildren(named(Group.value)("grid-h")([]))(mapFlipped13(tickValues)(function(tick5) {
              return elem3(Line.value)([v3Attr11("x1")(lit12(state3.config.cellPadding)), v3Attr11("x2")(lit12(state3.config.cellSize - state3.config.cellPadding)), v3Attr11("y1")(lit12(applyScale2(mScale.value0)(tick5))), v3Attr11("y2")(lit12(applyScale2(mScale.value0)(tick5))), v3AttrStr("stroke")(str13("#eee")), v3Attr11("stroke-width")(lit12(0.5))]);
            })), elem3(Text.value)([v3AttrStr("class")(str13("cell-label")), v3Attr11("x")(lit12(state3.config.cellPadding + 4)), v3Attr11("y")(lit12(state3.config.cellPadding + 12)), v3Attr11("font-size")(lit12(11)), v3AttrStr("font-weight")(str13("bold")), v3AttrStr("fill")(str13("#333")), v3AttrStr("textContent")(str13(shortLabel))]), elem3(Line.value)([v3AttrStr("class")(str13("identity-line")), v3Attr11("x1")(lit12(applyScale2(mScale.value0)(minVal))), v3Attr11("y1")(lit12(applyScale2(yScaleInverted)(minVal))), v3Attr11("x2")(lit12(applyScale2(mScale.value0)(maxVal))), v3Attr11("y2")(lit12(applyScale2(yScaleInverted)(maxVal))), v3AttrStr("stroke")(str13("#333")), v3Attr11("stroke-width")(lit12(1)), v3AttrStr("stroke-dasharray")(str13("2,2"))]), withChildren(named(Group.value)("diag-points")([]))(mapMaybe(function(p2) {
              var v2 = getDimensionValue(cell.dimX)(p2);
              if (v2 instanceof Just) {
                return new Just(elem3(Circle.value)([v3AttrStr("class")(str13("diag-point")), v3Attr11("cx")(lit12(applyScale2(mScale.value0)(v2.value0))), v3Attr11("cy")(lit12(applyScale2(yScaleInverted)(v2.value0))), v3Attr11("r")(lit12(1.5)), v3AttrStr("fill")(str13(speciesColor(p2.species))), v3Attr11("fill-opacity")(lit12(0.7))]));
              }
              ;
              if (v2 instanceof Nothing) {
                return Nothing.value;
              }
              ;
              throw new Error("Failed pattern match at D3.Viz.SPLOM.SPLOM (line 404, column 15 - line 414, column 35): " + [v2.constructor.name]);
            })(penguins))];
          }
          ;
          throw new Error("Failed pattern match at D3.Viz.SPLOM.SPLOM (line 331, column 3 - line 416, column 10): " + [mScale.constructor.name]);
        };
      };
    };
  };
  var buildCell = function(state3) {
    return function(cell) {
      var mYScale = findScale(cell.dimY)(state3.scales);
      var mXScale = findScale(cell.dimX)(state3.scales);
      var isDiagonal = cell.row === cell.col;
      var cellPenguins = filter(function(p2) {
        var v2 = getDimensionValue(cell.dimY)(p2);
        var v1 = getDimensionValue(cell.dimX)(p2);
        if (v1 instanceof Just && v2 instanceof Just) {
          return true;
        }
        ;
        return false;
      })(state3.validPenguins);
      var cellId = "cell-" + (show125(cell.row) + ("-" + show125(cell.col)));
      return withChildren(named(Group.value)(cellId)([v3AttrStr("id")(str13(cellId)), v3AttrStr("class")(str13((function() {
        if (isDiagonal) {
          return "cell diagonal";
        }
        ;
        return "cell off-diagonal";
      })())), v3AttrStr("transform")(str13("translate(" + (show55(state3.config.matrixPadding + toNumber(cell.col) * state3.config.cellSize) + ("," + (show55(state3.config.matrixPadding + toNumber(cell.row) * state3.config.cellSize) + ")")))))]))(append115([elem3(Rect.value)([v3AttrStr("class")(str13("cell-frame")), v3Attr11("width")(lit12(state3.config.cellSize)), v3Attr11("height")(lit12(state3.config.cellSize)), v3AttrStr("fill")(str13("none")), v3AttrStr("stroke")(str13("#aaa")), v3Attr11("stroke-width")(lit12(0.5))])])((function() {
        if (isDiagonal) {
          return buildDiagonalContent(state3)(cellPenguins)(cell)(mXScale);
        }
        ;
        return buildOffDiagonalContent(state3)(cellPenguins)(cell)(mXScale)(mYScale);
      })()));
    };
  };
  var buildAxisLabels = function(state3) {
    var n = length3(state3.scales);
    return withChildren(named(Group.value)("axis-labels")([]))(concat([mapWithIndex3(function(i2) {
      return function(dimScale) {
        var xOffset = state3.config.matrixPadding + toNumber(i2) * state3.config.cellSize;
        var tickValues = ticks2(state3.config.tickCount)(dimScale.scale);
        return withChildren(named(Group.value)("axis-bottom-" + show125(i2))([v3AttrStr("transform")(str13("translate(" + (show55(xOffset) + ("," + (show55(state3.config.matrixPadding + toNumber(n) * state3.config.cellSize) + ")")))))]))(mapFlipped13(tickValues)(function(tick5) {
          return elem3(Text.value)([v3Attr11("x")(lit12(applyScale2(dimScale.scale)(tick5))), v3Attr11("y")(lit12(12)), v3AttrStr("text-anchor")(str13("middle")), v3Attr11("font-size")(lit12(8)), v3AttrStr("fill")(str13("#666")), v3AttrStr("textContent")(str13(formatTick(tick5)))]);
        }));
      };
    })(state3.scales), mapWithIndex3(function(i2) {
      return function(dimScale) {
        var yOffset = state3.config.matrixPadding + toNumber(i2) * state3.config.cellSize;
        var tickValues = ticks2(state3.config.tickCount)(dimScale.scale);
        return withChildren(named(Group.value)("axis-left-" + show125(i2))([v3AttrStr("transform")(str13("translate(" + (show55(state3.config.matrixPadding) + ("," + (show55(yOffset) + ")")))))]))(mapFlipped13(tickValues)(function(tick5) {
          return elem3(Text.value)([v3Attr11("x")(lit12(-4)), v3Attr11("y")(lit12(applyScale2(dimScale.scale)(tick5))), v3AttrStr("text-anchor")(str13("end")), v3AttrStr("dominant-baseline")(str13("middle")), v3Attr11("font-size")(lit12(8)), v3AttrStr("fill")(str13("#666")), v3AttrStr("textContent")(str13(formatTick(tick5)))]);
        }));
      };
    })(state3.scales)]));
  };
  var buildSPLOMTree = function(state3) {
    return function(cells2) {
      return function(totalSize) {
        return withChildren(named(SVG.value)("svg")([v3Attr11("width")(lit12(totalSize)), v3Attr11("height")(lit12(totalSize)), v3AttrStr("viewBox")(str13("0 0 " + (show55(totalSize) + (" " + show55(totalSize))))), v3AttrStr("class")(str13("splom-svg")), v3AttrStr("id")(str13("splom-matrix"))]))([elem3(Rect.value)([v3Attr11("width")(lit12(totalSize)), v3Attr11("height")(lit12(totalSize)), v3AttrStr("fill")(str13("white"))]), withChildren(named(Group.value)("cells")([]))(mapFlipped13(cells2)(buildCell(state3))), buildAxisLabels(state3)]);
      };
    };
  };
  var renderSPLOMWithState = function(state3) {
    return discard117(clear5(state3.containerSelector))(function() {
      return bind60(select31(state3.containerSelector))(function(container) {
        var n = length3(state3.config.dimensions);
        var totalSize = toNumber(n) * state3.config.cellSize + state3.config.matrixPadding * 2;
        var cells2 = generateCells(state3.config.dimensions);
        var tree2 = buildSPLOMTree(state3)(cells2)(totalSize);
        return bind60(renderTree53(container)(tree2))(function() {
          return pure56(unit);
        });
      });
    });
  };
  var renderSPLOM = function(state3) {
    return runD3v2M(renderSPLOMWithState(state3));
  };
  var attachBrushToCell = function(padding2) {
    return function(cellSize) {
      return function(onBrush) {
        return function(onEnd) {
          return function(cell) {
            var cellSelector = "#splom-matrix #cell-" + (show125(cell.row) + ("-" + (show125(cell.col) + " .brush")));
            return function __do7() {
              var doc = bind126(windowImpl)(document2)();
              var mElement = querySelector(cellSelector)(toParentNode3(doc))();
              if (mElement instanceof Nothing) {
                log2("Brush element not found for cell " + (show125(cell.row) + ("-" + show125(cell.col))))();
                return Nothing.value;
              }
              ;
              if (mElement instanceof Just) {
                var brushConfig = {
                  extent: {
                    x0: padding2,
                    y0: padding2,
                    x1: cellSize - padding2,
                    y1: cellSize - padding2
                  },
                  onStart: Nothing.value,
                  onBrush: new Just(function(event) {
                    return onBrush(event.selection)(cell);
                  }),
                  onEnd: new Just(function(event) {
                    return onEnd(event.selection)(cell);
                  })
                };
                var handle = attachBrush(mElement.value0)(brushConfig)();
                return new Just({
                  cell,
                  handle
                });
              }
              ;
              throw new Error("Failed pattern match at D3.Viz.SPLOM.SPLOM (line 581, column 3 - line 602, column 35): " + [mElement.constructor.name]);
            };
          };
        };
      };
    };
  };
  var attachBrushes = function(state3) {
    return function(onBrush) {
      return function(onEnd) {
        var cells2 = offDiagonalCells(generateCells(state3.config.dimensions));
        return function __do7() {
          var handles = map76(catMaybes)(traverse5(attachBrushToCell(state3.config.cellPadding)(state3.config.cellSize)(onBrush)(onEnd))(cells2))();
          return handles;
        };
      };
    };
  };

  // output/Component.SPLOM/index.js
  var bind61 = /* @__PURE__ */ bind(bindHalogenM);
  var discard41 = /* @__PURE__ */ discard(discardUnit)(bindHalogenM);
  var modify_12 = /* @__PURE__ */ modify_(monadStateHalogenM);
  var pure57 = /* @__PURE__ */ pure(applicativeHalogenM);
  var show56 = /* @__PURE__ */ show(showInt);
  var map77 = /* @__PURE__ */ map(functorMaybe);
  var eq9 = /* @__PURE__ */ eq(eqNumericDimension);
  var $$void12 = /* @__PURE__ */ $$void(functorHalogenM);
  var get14 = /* @__PURE__ */ get(monadStateHalogenM);
  var bind127 = /* @__PURE__ */ bind(bindMaybe);
  var Initialize19 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var ClearBrush = /* @__PURE__ */ (function() {
    function ClearBrush2() {
    }
    ;
    ClearBrush2.value = new ClearBrush2();
    return ClearBrush2;
  })();
  var BrushMove = /* @__PURE__ */ (function() {
    function BrushMove2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    BrushMove2.create = function(value0) {
      return function(value1) {
        return new BrushMove2(value0, value1);
      };
    };
    return BrushMove2;
  })();
  var BrushEnd = /* @__PURE__ */ (function() {
    function BrushEnd2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    BrushEnd2.create = function(value0) {
      return function(value1) {
        return new BrushEnd2(value0, value1);
      };
    };
    return BrushEnd2;
  })();
  var setupBrushCallbacks = function(dictMonadAff) {
    var liftEffect54 = liftEffect(monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    return function(splomState) {
      return bind61(liftEffect54(create4))(function(v2) {
        return bind61(liftEffect54(attachBrushes(splomState)(function(selection2) {
          return function(cell) {
            return notify(v2.listener)(new BrushMove(selection2, cell));
          };
        })(function(selection2) {
          return function(cell) {
            return notify(v2.listener)(new BrushEnd(selection2, cell));
          };
        })))(function(handles) {
          return discard41(modify_12(function(s3) {
            if (s3.splomState instanceof Nothing) {
              return s3;
            }
            ;
            if (s3.splomState instanceof Just) {
              var $47 = {};
              for (var $48 in s3) {
                if ({}.hasOwnProperty.call(s3, $48)) {
                  $47[$48] = s3[$48];
                }
                ;
              }
              ;
              $47.splomState = new Just((function() {
                var $44 = {};
                for (var $45 in s3.splomState.value0) {
                  if ({}.hasOwnProperty.call(s3.splomState.value0, $45)) {
                    $44[$45] = s3["splomState"]["value0"][$45];
                  }
                  ;
                }
                ;
                $44.brushHandles = handles;
                return $44;
              })());
              return $47;
            }
            ;
            throw new Error("Failed pattern match at Component.SPLOM (line 286, column 19 - line 288, column 71): " + [s3.splomState.constructor.name]);
          }))(function() {
            return pure57(v2.emitter);
          });
        });
      });
    };
  };
  var render23 = function(state3) {
    return div2([classes(["splom-page"])])([render4({
      logoSize: Normal.value,
      quadrant: NoQuadrant.value,
      prevNext: Nothing.value,
      pageTitle: new Just("Brushable SPLOM")
    }), div2([classes(["splom-layout"])])([div2([classes(["splom-panel"])])([h2_([text5("Palmer Penguins")]), p([classes(["splom-description"])])([text5("Explore relationships between penguin measurements using a scatterplot matrix. "), text5("Click and drag to brush-select points in any cell. Selected points highlight across all views.")]), (function() {
      if (state3.splomState instanceof Just) {
        var totalCount = getTotalCount(state3.splomState.value0);
        var selectedCount = getSelectedCount(state3.splomState.value0);
        return div2([classes(["splom-stats"])])([span_([text5(show56(selectedCount) + (" / " + (show56(totalCount) + " penguins")))]), (function() {
          var $54 = selectedCount < totalCount;
          if ($54) {
            return button2([classes(["splom-clear-btn"]), onClick(function(v2) {
              return ClearBrush.value;
            })])([text5("Clear Selection")]);
          }
          ;
          return text5("");
        })()]);
      }
      ;
      if (state3.splomState instanceof Nothing) {
        return text5("");
      }
      ;
      throw new Error("Failed pattern match at Component.SPLOM (line 95, column 15 - line 112, column 38): " + [state3.splomState.constructor.name]);
    })(), div2([classes(["splom-legend-info"])])([h4_([text5("Species")]), ul_([li_([span4([style("color: #1f77b4")])([text5("\u25CF")]), text5(" Ad\xE9lie")]), li_([span4([style("color: #ff7f0e")])([text5("\u25CF")]), text5(" Gentoo")]), li_([span4([style("color: #2ca02c")])([text5("\u25CF")]), text5(" Chinstrap")])])]), div2([classes(["splom-instructions"])])([h4_([text5("How to Use")]), ul_([li_([text5("Drag to create a brush selection")]), li_([text5("Points outside selection fade")]), li_([text5("Diagonal shows dimension labels")]), li_([text5("Click elsewhere to clear")])])]), div2([classes(["splom-credits"])])([p_([text5("The scatterplot matrix (SPLOM) shows pairwise correlations for multi-dimensional data; "), text5("each cell is a scatterplot where x encodes the column's dimension and y encodes the row's dimension. "), text5("This matrix shows "), a([href4("https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0090081"), target6("_blank")])([text5("Kristen Gorman's data")]), text5(" on penguins near Palmer Station in Antarctica.")]), p([classes(["splom-source"])])([text5("Based on "), a([href4("https://observablehq.com/@d3/brushable-scatterplot-matrix"), target6("_blank")])([text5("Observable's Brushable Scatterplot Matrix")]), text5(" by Mike Bostock.")])])]), div2([classes(["splom-viz"])])([(function() {
      if (state3.loading) {
        return div2([classes(["splom-loading"])])([text5("Loading penguins...")]);
      }
      ;
      return text5("");
    })(), (function() {
      if (state3.error instanceof Just) {
        return div2([classes(["splom-error"])])([text5("Error: " + state3.error.value0)]);
      }
      ;
      if (state3.error instanceof Nothing) {
        return text5("");
      }
      ;
      throw new Error("Failed pattern match at Component.SPLOM (line 175, column 15 - line 179, column 38): " + [state3.error.constructor.name]);
    })(), div2([id3("splom-container"), classes(["splom-svg-container"])])([])])])]);
  };
  var findScaleForDim = function(dim) {
    return function(scales) {
      return map77(function(v2) {
        return v2.scale;
      })(find2(function(s3) {
        return eq9(s3.dimension)(dim);
      })(scales));
    };
  };
  var handleAction18 = function(dictMonadAff) {
    var liftEffect54 = liftEffect(monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    var liftAff2 = liftAff(monadAffHalogenM(dictMonadAff));
    var setupBrushCallbacks1 = setupBrushCallbacks(dictMonadAff);
    return function(v2) {
      if (v2 instanceof Initialize19) {
        return discard41(liftEffect54(log2("Loading penguins...")))(function() {
          return bind61(liftAff2(loadPenguins))(function(result) {
            if (result instanceof Left) {
              return discard41(liftEffect54(log2("Failed to load penguins: " + result.value0)))(function() {
                return modify_12(function(v1) {
                  var $61 = {};
                  for (var $62 in v1) {
                    if ({}.hasOwnProperty.call(v1, $62)) {
                      $61[$62] = v1[$62];
                    }
                    ;
                  }
                  ;
                  $61.loading = false;
                  $61.error = new Just(result.value0);
                  return $61;
                });
              });
            }
            ;
            if (result instanceof Right) {
              return discard41(liftEffect54(log2("Loaded " + (show56(length3(result.value0)) + " penguins"))))(function() {
                var splomState = initialState2("#splom-container")(result.value0);
                return discard41(modify_12(function(v1) {
                  var $65 = {};
                  for (var $66 in v1) {
                    if ({}.hasOwnProperty.call(v1, $66)) {
                      $65[$66] = v1[$66];
                    }
                    ;
                  }
                  ;
                  $65.penguins = result.value0;
                  $65.loading = false;
                  $65.splomState = new Just(splomState);
                  return $65;
                }))(function() {
                  return discard41(liftEffect54(renderSPLOM(splomState)))(function() {
                    return bind61(setupBrushCallbacks1(splomState))(function(emitter) {
                      return $$void12(subscribe2(emitter));
                    });
                  });
                });
              });
            }
            ;
            throw new Error("Failed pattern match at Component.SPLOM (line 201, column 5 - line 219, column 35): " + [result.constructor.name]);
          });
        });
      }
      ;
      if (v2 instanceof ClearBrush) {
        return bind61(get14)(function(state3) {
          if (state3.splomState instanceof Nothing) {
            return pure57(unit);
          }
          ;
          if (state3.splomState instanceof Just) {
            return discard41(liftEffect54(clearBrushSelection(state3.splomState.value0.brushHandles)))(function() {
              var newSplomState = {
                brushHandles: state3.splomState.value0.brushHandles,
                config: state3.splomState.value0.config,
                containerSelector: state3.splomState.value0.containerSelector,
                penguins: state3.splomState.value0.penguins,
                scales: state3.splomState.value0.scales,
                validPenguins: state3.splomState.value0.validPenguins,
                selection: Nothing.value,
                activeBrushCell: Nothing.value
              };
              return discard41(modify_12(function(v1) {
                var $70 = {};
                for (var $71 in v1) {
                  if ({}.hasOwnProperty.call(v1, $71)) {
                    $70[$71] = v1[$71];
                  }
                  ;
                }
                ;
                $70.splomState = new Just(newSplomState);
                return $70;
              }))(function() {
                return liftEffect54(updatePointVisibility(newSplomState));
              });
            });
          }
          ;
          throw new Error("Failed pattern match at Component.SPLOM (line 223, column 5 - line 234, column 63): " + [state3.splomState.constructor.name]);
        });
      }
      ;
      if (v2 instanceof BrushMove) {
        return bind61(get14)(function(state3) {
          if (state3.splomState instanceof Nothing) {
            return pure57(unit);
          }
          ;
          if (state3.splomState instanceof Just) {
            var newSelection = (function() {
              if (v2.value0 instanceof Selection2D) {
                return bind127(findScaleForDim(v2.value1.dimX)(state3.splomState.value0.scales))(function(xScale) {
                  return bind127(findScaleForDim(v2.value1.dimY)(state3.splomState.value0.scales))(function(yScale) {
                    return bind127(invert(xScale)(v2.value0.value0.x0))(function(xMin) {
                      return bind127(invert(xScale)(v2.value0.value0.x1))(function(xMax) {
                        return bind127(invert(yScale)(v2.value0.value0.y0))(function(yMin) {
                          return bind127(invert(yScale)(v2.value0.value0.y1))(function(yMax) {
                            return new Just({
                              dimX: v2.value1.dimX,
                              dimY: v2.value1.dimY,
                              xMin,
                              xMax,
                              yMin,
                              yMax
                            });
                          });
                        });
                      });
                    });
                  });
                });
              }
              ;
              if (v2.value0 instanceof NoSelection) {
                return Nothing.value;
              }
              ;
              return state3.splomState.value0.selection;
            })();
            var newSplomState = {
              scales: state3.splomState.value0.scales,
              brushHandles: state3.splomState.value0.brushHandles,
              config: state3.splomState.value0.config,
              containerSelector: state3.splomState.value0.containerSelector,
              penguins: state3.splomState.value0.penguins,
              validPenguins: state3.splomState.value0.validPenguins,
              selection: newSelection,
              activeBrushCell: new Just(v2.value1)
            };
            return discard41(modify_12(function(v1) {
              var $77 = {};
              for (var $78 in v1) {
                if ({}.hasOwnProperty.call(v1, $78)) {
                  $77[$78] = v1[$78];
                }
                ;
              }
              ;
              $77.splomState = new Just(newSplomState);
              return $77;
            }))(function() {
              return liftEffect54(updatePointVisibility(newSplomState));
            });
          }
          ;
          throw new Error("Failed pattern match at Component.SPLOM (line 238, column 5 - line 259, column 63): " + [state3.splomState.constructor.name]);
        });
      }
      ;
      if (v2 instanceof BrushEnd) {
        if (v2.value0 instanceof NoSelection) {
          return bind61(get14)(function(state3) {
            if (state3.splomState instanceof Nothing) {
              return pure57(unit);
            }
            ;
            if (state3.splomState instanceof Just) {
              var newSplomState = {
                brushHandles: state3.splomState.value0.brushHandles,
                config: state3.splomState.value0.config,
                containerSelector: state3.splomState.value0.containerSelector,
                penguins: state3.splomState.value0.penguins,
                scales: state3.splomState.value0.scales,
                validPenguins: state3.splomState.value0.validPenguins,
                selection: Nothing.value,
                activeBrushCell: Nothing.value
              };
              return discard41(modify_12(function(v1) {
                var $85 = {};
                for (var $86 in v1) {
                  if ({}.hasOwnProperty.call(v1, $86)) {
                    $85[$86] = v1[$86];
                  }
                  ;
                }
                ;
                $85.splomState = new Just(newSplomState);
                return $85;
              }))(function() {
                return liftEffect54(updatePointVisibility(newSplomState));
              });
            }
            ;
            throw new Error("Failed pattern match at Component.SPLOM (line 266, column 9 - line 271, column 67): " + [state3.splomState.constructor.name]);
          });
        }
        ;
        return pure57(unit);
      }
      ;
      throw new Error("Failed pattern match at Component.SPLOM (line 196, column 16 - line 272, column 21): " + [v2.constructor.name]);
    };
  };
  var component19 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return {
          penguins: [],
          loading: true,
          error: Nothing.value,
          splomState: Nothing.value
        };
      },
      render: render23,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction18(dictMonadAff),
        initialize: new Just(Initialize19.value)
      })
    });
  };

  // output/Component.SankeyDebug/foreign.js
  var unsafeParseInt = (s3) => parseInt(s3, 10) || 0;

  // node_modules/d3-sankey/node_modules/d3-array/src/max.js
  function max18(values2, valueof) {
    let max25;
    if (valueof === void 0) {
      for (const value20 of values2) {
        if (value20 != null && (max25 < value20 || max25 === void 0 && value20 >= value20)) {
          max25 = value20;
        }
      }
    } else {
      let index7 = -1;
      for (let value20 of values2) {
        if ((value20 = valueof(value20, ++index7, values2)) != null && (max25 < value20 || max25 === void 0 && value20 >= value20)) {
          max25 = value20;
        }
      }
    }
    return max25;
  }

  // node_modules/d3-sankey/node_modules/d3-array/src/min.js
  function min14(values2, valueof) {
    let min18;
    if (valueof === void 0) {
      for (const value20 of values2) {
        if (value20 != null && (min18 > value20 || min18 === void 0 && value20 >= value20)) {
          min18 = value20;
        }
      }
    } else {
      let index7 = -1;
      for (let value20 of values2) {
        if ((value20 = valueof(value20, ++index7, values2)) != null && (min18 > value20 || min18 === void 0 && value20 >= value20)) {
          min18 = value20;
        }
      }
    }
    return min18;
  }

  // node_modules/d3-sankey/node_modules/d3-array/src/sum.js
  function sum5(values2, valueof) {
    let sum6 = 0;
    if (valueof === void 0) {
      for (let value20 of values2) {
        if (value20 = +value20) {
          sum6 += value20;
        }
      }
    } else {
      let index7 = -1;
      for (let value20 of values2) {
        if (value20 = +valueof(value20, ++index7, values2)) {
          sum6 += value20;
        }
      }
    }
    return sum6;
  }

  // node_modules/d3-sankey/src/align.js
  function justify(node, n) {
    return node.sourceLinks.length ? node.depth : n - 1;
  }

  // node_modules/d3-sankey/src/constant.js
  function constant2(x32) {
    return function() {
      return x32;
    };
  }

  // node_modules/d3-sankey/src/sankey.js
  function ascendingSourceBreadth(a3, b10) {
    return ascendingBreadth(a3.source, b10.source) || a3.index - b10.index;
  }
  function ascendingTargetBreadth(a3, b10) {
    return ascendingBreadth(a3.target, b10.target) || a3.index - b10.index;
  }
  function ascendingBreadth(a3, b10) {
    return a3.y0 - b10.y0;
  }
  function value15(d) {
    return d.value;
  }
  function defaultId(d) {
    return d.index;
  }
  function defaultNodes(graph) {
    return graph.nodes;
  }
  function defaultLinks(graph) {
    return graph.links;
  }
  function find5(nodeById, id5) {
    const node = nodeById.get(id5);
    if (!node) throw new Error("missing: " + id5);
    return node;
  }
  function computeLinkBreadths2({ nodes: nodes3 }) {
    for (const node of nodes3) {
      let y0 = node.y0;
      let y114 = y0;
      for (const link5 of node.sourceLinks) {
        link5.y0 = y0 + link5.width / 2;
        y0 += link5.width;
      }
      for (const link5 of node.targetLinks) {
        link5.y1 = y114 + link5.width / 2;
        y114 += link5.width;
      }
    }
  }
  function Sankey() {
    let x0 = 0, y0 = 0, x113 = 1, y114 = 1;
    let dx = 24;
    let dy = 8, py;
    let id5 = defaultId;
    let align2 = justify;
    let sort3;
    let linkSort;
    let nodes3 = defaultNodes;
    let links3 = defaultLinks;
    let iterations = 6;
    function sankey() {
      const graph = { nodes: nodes3.apply(null, arguments), links: links3.apply(null, arguments) };
      computeNodeLinks(graph);
      computeNodeValues2(graph);
      computeNodeDepths2(graph);
      computeNodeHeights2(graph);
      computeNodeBreadths2(graph);
      computeLinkBreadths2(graph);
      return graph;
    }
    sankey.update = function(graph) {
      computeLinkBreadths2(graph);
      return graph;
    };
    sankey.nodeId = function(_) {
      return arguments.length ? (id5 = typeof _ === "function" ? _ : constant2(_), sankey) : id5;
    };
    sankey.nodeAlign = function(_) {
      return arguments.length ? (align2 = typeof _ === "function" ? _ : constant2(_), sankey) : align2;
    };
    sankey.nodeSort = function(_) {
      return arguments.length ? (sort3 = _, sankey) : sort3;
    };
    sankey.nodeWidth = function(_) {
      return arguments.length ? (dx = +_, sankey) : dx;
    };
    sankey.nodePadding = function(_) {
      return arguments.length ? (dy = py = +_, sankey) : dy;
    };
    sankey.nodes = function(_) {
      return arguments.length ? (nodes3 = typeof _ === "function" ? _ : constant2(_), sankey) : nodes3;
    };
    sankey.links = function(_) {
      return arguments.length ? (links3 = typeof _ === "function" ? _ : constant2(_), sankey) : links3;
    };
    sankey.linkSort = function(_) {
      return arguments.length ? (linkSort = _, sankey) : linkSort;
    };
    sankey.size = function(_) {
      return arguments.length ? (x0 = y0 = 0, x113 = +_[0], y114 = +_[1], sankey) : [x113 - x0, y114 - y0];
    };
    sankey.extent = function(_) {
      return arguments.length ? (x0 = +_[0][0], x113 = +_[1][0], y0 = +_[0][1], y114 = +_[1][1], sankey) : [[x0, y0], [x113, y114]];
    };
    sankey.iterations = function(_) {
      return arguments.length ? (iterations = +_, sankey) : iterations;
    };
    function computeNodeLinks({ nodes: nodes4, links: links4 }) {
      for (const [i2, node] of nodes4.entries()) {
        node.index = i2;
        node.sourceLinks = [];
        node.targetLinks = [];
      }
      const nodeById = new Map(nodes4.map((d, i2) => [id5(d, i2, nodes4), d]));
      for (const [i2, link5] of links4.entries()) {
        link5.index = i2;
        let { source: source3, target: target7 } = link5;
        if (typeof source3 !== "object") source3 = link5.source = find5(nodeById, source3);
        if (typeof target7 !== "object") target7 = link5.target = find5(nodeById, target7);
        source3.sourceLinks.push(link5);
        target7.targetLinks.push(link5);
      }
      if (linkSort != null) {
        for (const { sourceLinks, targetLinks } of nodes4) {
          sourceLinks.sort(linkSort);
          targetLinks.sort(linkSort);
        }
      }
    }
    function computeNodeValues2({ nodes: nodes4 }) {
      for (const node of nodes4) {
        node.value = node.fixedValue === void 0 ? Math.max(sum5(node.sourceLinks, value15), sum5(node.targetLinks, value15)) : node.fixedValue;
      }
    }
    function computeNodeDepths2({ nodes: nodes4 }) {
      const n = nodes4.length;
      let current = new Set(nodes4);
      let next2 = /* @__PURE__ */ new Set();
      let x32 = 0;
      while (current.size) {
        for (const node of current) {
          node.depth = x32;
          for (const { target: target7 } of node.sourceLinks) {
            next2.add(target7);
          }
        }
        if (++x32 > n) throw new Error("circular link");
        current = next2;
        next2 = /* @__PURE__ */ new Set();
      }
    }
    function computeNodeHeights2({ nodes: nodes4 }) {
      const n = nodes4.length;
      let current = new Set(nodes4);
      let next2 = /* @__PURE__ */ new Set();
      let x32 = 0;
      while (current.size) {
        for (const node of current) {
          node.height = x32;
          for (const { source: source3 } of node.targetLinks) {
            next2.add(source3);
          }
        }
        if (++x32 > n) throw new Error("circular link");
        current = next2;
        next2 = /* @__PURE__ */ new Set();
      }
    }
    function computeNodeLayers2({ nodes: nodes4 }) {
      const x32 = max18(nodes4, (d) => d.depth) + 1;
      const kx = (x113 - x0 - dx) / (x32 - 1);
      const columns = new Array(x32);
      for (const node of nodes4) {
        const i2 = Math.max(0, Math.min(x32 - 1, Math.floor(align2.call(null, node, x32))));
        node.layer = i2;
        node.x0 = x0 + i2 * kx;
        node.x1 = node.x0 + dx;
        if (columns[i2]) columns[i2].push(node);
        else columns[i2] = [node];
      }
      if (sort3) for (const column of columns) {
        column.sort(sort3);
      }
      return columns;
    }
    function initializeNodeBreadths2(columns) {
      const ky = min14(columns, (c2) => (y114 - y0 - (c2.length - 1) * py) / sum5(c2, value15));
      for (const nodes4 of columns) {
        let y32 = y0;
        for (const node of nodes4) {
          node.y0 = y32;
          node.y1 = y32 + node.value * ky;
          y32 = node.y1 + py;
          for (const link5 of node.sourceLinks) {
            link5.width = link5.value * ky;
          }
        }
        y32 = (y114 - y32 + py) / (nodes4.length + 1);
        for (let i2 = 0; i2 < nodes4.length; ++i2) {
          const node = nodes4[i2];
          node.y0 += y32 * (i2 + 1);
          node.y1 += y32 * (i2 + 1);
        }
        reorderLinks(nodes4);
      }
    }
    function computeNodeBreadths2(graph) {
      const columns = computeNodeLayers2(graph);
      py = Math.min(dy, (y114 - y0) / (max18(columns, (c2) => c2.length) - 1));
      initializeNodeBreadths2(columns);
      for (let i2 = 0; i2 < iterations; ++i2) {
        const alpha = Math.pow(0.99, i2);
        const beta2 = Math.max(1 - alpha, (i2 + 1) / iterations);
        relaxRightToLeft(columns, alpha, beta2);
        relaxLeftToRight(columns, alpha, beta2);
      }
    }
    function relaxLeftToRight(columns, alpha, beta2) {
      for (let i2 = 1, n = columns.length; i2 < n; ++i2) {
        const column = columns[i2];
        for (const target7 of column) {
          let y32 = 0;
          let w = 0;
          for (const { source: source3, value: value20 } of target7.targetLinks) {
            let v2 = value20 * (target7.layer - source3.layer);
            y32 += targetTop(source3, target7) * v2;
            w += v2;
          }
          if (!(w > 0)) continue;
          let dy2 = (y32 / w - target7.y0) * alpha;
          target7.y0 += dy2;
          target7.y1 += dy2;
          reorderNodeLinks(target7);
        }
        if (sort3 === void 0) column.sort(ascendingBreadth);
        resolveCollisions(column, beta2);
      }
    }
    function relaxRightToLeft(columns, alpha, beta2) {
      for (let n = columns.length, i2 = n - 2; i2 >= 0; --i2) {
        const column = columns[i2];
        for (const source3 of column) {
          let y32 = 0;
          let w = 0;
          for (const { target: target7, value: value20 } of source3.sourceLinks) {
            let v2 = value20 * (target7.layer - source3.layer);
            y32 += sourceTop(source3, target7) * v2;
            w += v2;
          }
          if (!(w > 0)) continue;
          let dy2 = (y32 / w - source3.y0) * alpha;
          source3.y0 += dy2;
          source3.y1 += dy2;
          reorderNodeLinks(source3);
        }
        if (sort3 === void 0) column.sort(ascendingBreadth);
        resolveCollisions(column, beta2);
      }
    }
    function resolveCollisions(nodes4, alpha) {
      const i2 = nodes4.length >> 1;
      const subject = nodes4[i2];
      resolveCollisionsBottomToTop(nodes4, subject.y0 - py, i2 - 1, alpha);
      resolveCollisionsTopToBottom(nodes4, subject.y1 + py, i2 + 1, alpha);
      resolveCollisionsBottomToTop(nodes4, y114, nodes4.length - 1, alpha);
      resolveCollisionsTopToBottom(nodes4, y0, 0, alpha);
    }
    function resolveCollisionsTopToBottom(nodes4, y32, i2, alpha) {
      for (; i2 < nodes4.length; ++i2) {
        const node = nodes4[i2];
        const dy2 = (y32 - node.y0) * alpha;
        if (dy2 > 1e-6) node.y0 += dy2, node.y1 += dy2;
        y32 = node.y1 + py;
      }
    }
    function resolveCollisionsBottomToTop(nodes4, y32, i2, alpha) {
      for (; i2 >= 0; --i2) {
        const node = nodes4[i2];
        const dy2 = (node.y1 - y32) * alpha;
        if (dy2 > 1e-6) node.y0 -= dy2, node.y1 -= dy2;
        y32 = node.y0 - py;
      }
    }
    function reorderNodeLinks({ sourceLinks, targetLinks }) {
      if (linkSort === void 0) {
        for (const { source: { sourceLinks: sourceLinks2 } } of targetLinks) {
          sourceLinks2.sort(ascendingTargetBreadth);
        }
        for (const { target: { targetLinks: targetLinks2 } } of sourceLinks) {
          targetLinks2.sort(ascendingSourceBreadth);
        }
      }
    }
    function reorderLinks(nodes4) {
      if (linkSort === void 0) {
        for (const { sourceLinks, targetLinks } of nodes4) {
          sourceLinks.sort(ascendingTargetBreadth);
          targetLinks.sort(ascendingSourceBreadth);
        }
      }
    }
    function targetTop(source3, target7) {
      let y32 = source3.y0 - (source3.sourceLinks.length - 1) * py / 2;
      for (const { target: node, width: width47 } of source3.sourceLinks) {
        if (node === target7) break;
        y32 += width47 + py;
      }
      for (const { source: node, width: width47 } of target7.targetLinks) {
        if (node === source3) break;
        y32 -= width47;
      }
      return y32;
    }
    function sourceTop(source3, target7) {
      let y32 = target7.y0 - (target7.targetLinks.length - 1) * py / 2;
      for (const { source: node, width: width47 } of target7.targetLinks) {
        if (node === source3) break;
        y32 += width47 + py;
      }
      for (const { target: node, width: width47 } of source3.sourceLinks) {
        if (node === target7) break;
        y32 -= width47;
      }
      return y32;
    }
    return sankey;
  }

  // node_modules/d3-sankey/node_modules/d3-path/src/path.js
  var pi8 = Math.PI;
  var tau5 = 2 * pi8;
  var epsilon8 = 1e-6;
  var tauEpsilon2 = tau5 - epsilon8;
  function Path4() {
    this._x0 = this._y0 = // start of current subpath
    this._x1 = this._y1 = null;
    this._ = "";
  }
  function path12() {
    return new Path4();
  }
  Path4.prototype = path12.prototype = {
    constructor: Path4,
    moveTo: function(x32, y32) {
      this._ += "M" + (this._x0 = this._x1 = +x32) + "," + (this._y0 = this._y1 = +y32);
    },
    closePath: function() {
      if (this._x1 !== null) {
        this._x1 = this._x0, this._y1 = this._y0;
        this._ += "Z";
      }
    },
    lineTo: function(x32, y32) {
      this._ += "L" + (this._x1 = +x32) + "," + (this._y1 = +y32);
    },
    quadraticCurveTo: function(x113, y114, x32, y32) {
      this._ += "Q" + +x113 + "," + +y114 + "," + (this._x1 = +x32) + "," + (this._y1 = +y32);
    },
    bezierCurveTo: function(x113, y114, x211, y211, x32, y32) {
      this._ += "C" + +x113 + "," + +y114 + "," + +x211 + "," + +y211 + "," + (this._x1 = +x32) + "," + (this._y1 = +y32);
    },
    arcTo: function(x113, y114, x211, y211, r29) {
      x113 = +x113, y114 = +y114, x211 = +x211, y211 = +y211, r29 = +r29;
      var x0 = this._x1, y0 = this._y1, x212 = x211 - x113, y212 = y211 - y114, x01 = x0 - x113, y01 = y0 - y114, l01_2 = x01 * x01 + y01 * y01;
      if (r29 < 0) throw new Error("negative radius: " + r29);
      if (this._x1 === null) {
        this._ += "M" + (this._x1 = x113) + "," + (this._y1 = y114);
      } else if (!(l01_2 > epsilon8)) ;
      else if (!(Math.abs(y01 * x212 - y212 * x01) > epsilon8) || !r29) {
        this._ += "L" + (this._x1 = x113) + "," + (this._y1 = y114);
      } else {
        var x202 = x211 - x0, y202 = y211 - y0, l21_2 = x212 * x212 + y212 * y212, l20_2 = x202 * x202 + y202 * y202, l21 = Math.sqrt(l21_2), l01 = Math.sqrt(l01_2), l2 = r29 * Math.tan((pi8 - Math.acos((l21_2 + l01_2 - l20_2) / (2 * l21 * l01))) / 2), t01 = l2 / l01, t21 = l2 / l21;
        if (Math.abs(t01 - 1) > epsilon8) {
          this._ += "L" + (x113 + t01 * x01) + "," + (y114 + t01 * y01);
        }
        this._ += "A" + r29 + "," + r29 + ",0,0," + +(y01 * x202 > x01 * y202) + "," + (this._x1 = x113 + t21 * x212) + "," + (this._y1 = y114 + t21 * y212);
      }
    },
    arc: function(x32, y32, r29, a0, a1, ccw) {
      x32 = +x32, y32 = +y32, r29 = +r29, ccw = !!ccw;
      var dx = r29 * Math.cos(a0), dy = r29 * Math.sin(a0), x0 = x32 + dx, y0 = y32 + dy, cw = 1 ^ ccw, da = ccw ? a0 - a1 : a1 - a0;
      if (r29 < 0) throw new Error("negative radius: " + r29);
      if (this._x1 === null) {
        this._ += "M" + x0 + "," + y0;
      } else if (Math.abs(this._x1 - x0) > epsilon8 || Math.abs(this._y1 - y0) > epsilon8) {
        this._ += "L" + x0 + "," + y0;
      }
      if (!r29) return;
      if (da < 0) da = da % tau5 + tau5;
      if (da > tauEpsilon2) {
        this._ += "A" + r29 + "," + r29 + ",0,1," + cw + "," + (x32 - dx) + "," + (y32 - dy) + "A" + r29 + "," + r29 + ",0,1," + cw + "," + (this._x1 = x0) + "," + (this._y1 = y0);
      } else if (da > epsilon8) {
        this._ += "A" + r29 + "," + r29 + ",0," + +(da >= pi8) + "," + cw + "," + (this._x1 = x32 + r29 * Math.cos(a1)) + "," + (this._y1 = y32 + r29 * Math.sin(a1));
      }
    },
    rect: function(x32, y32, w, h7) {
      this._ += "M" + (this._x0 = this._x1 = +x32) + "," + (this._y0 = this._y1 = +y32) + "h" + +w + "v" + +h7 + "h" + -w + "Z";
    },
    toString: function() {
      return this._;
    }
  };
  var path_default = path12;

  // node_modules/d3-sankey/node_modules/d3-shape/src/constant.js
  function constant_default9(x32) {
    return function constant3() {
      return x32;
    };
  }

  // node_modules/d3-sankey/node_modules/d3-shape/src/point.js
  function x21(p2) {
    return p2[0];
  }
  function y21(p2) {
    return p2[1];
  }

  // node_modules/d3-sankey/node_modules/d3-shape/src/array.js
  var slice5 = Array.prototype.slice;

  // node_modules/d3-sankey/node_modules/d3-shape/src/link/index.js
  function linkSource(d) {
    return d.source;
  }
  function linkTarget(d) {
    return d.target;
  }
  function link3(curve) {
    var source3 = linkSource, target7 = linkTarget, x32 = x21, y32 = y21, context = null;
    function link5() {
      var buffer, argv = slice5.call(arguments), s3 = source3.apply(this, argv), t2 = target7.apply(this, argv);
      if (!context) context = buffer = path_default();
      curve(context, +x32.apply(this, (argv[0] = s3, argv)), +y32.apply(this, argv), +x32.apply(this, (argv[0] = t2, argv)), +y32.apply(this, argv));
      if (buffer) return context = null, buffer + "" || null;
    }
    link5.source = function(_) {
      return arguments.length ? (source3 = _, link5) : source3;
    };
    link5.target = function(_) {
      return arguments.length ? (target7 = _, link5) : target7;
    };
    link5.x = function(_) {
      return arguments.length ? (x32 = typeof _ === "function" ? _ : constant_default9(+_), link5) : x32;
    };
    link5.y = function(_) {
      return arguments.length ? (y32 = typeof _ === "function" ? _ : constant_default9(+_), link5) : y32;
    };
    link5.context = function(_) {
      return arguments.length ? (context = _ == null ? null : _, link5) : context;
    };
    return link5;
  }
  function curveHorizontal(context, x0, y0, x113, y114) {
    context.moveTo(x0, y0);
    context.bezierCurveTo(x0 = (x0 + x113) / 2, y0, x0, y114, x113, y114);
  }
  function linkHorizontal2() {
    return link3(curveHorizontal);
  }

  // node_modules/d3-sankey/src/sankeyLinkHorizontal.js
  function horizontalSource(d) {
    return [d.source.x1, d.y0];
  }
  function horizontalTarget(d) {
    return [d.target.x0, d.y1];
  }
  function sankeyLinkHorizontal_default() {
    return linkHorizontal2().source(horizontalSource).target(horizontalTarget);
  }

  // output/Component.SankeyDebug.FFI/foreign.js
  function computeD3SankeyWithSteps_(nodes3) {
    return (links3) => (width47) => (height47) => (nodeWidth) => (nodePadding) => (maxIterations) => {
      const steps = [];
      const graphData = {
        nodes: nodes3.map((n) => ({ ...n })),
        links: links3.map((l2) => ({ ...l2 }))
      };
      for (let iter = 0; iter <= maxIterations; iter++) {
        const iterData = {
          nodes: nodes3.map((n) => ({ ...n })),
          links: links3.map((l2) => ({ ...l2 }))
        };
        const generator = Sankey().nodeId((d) => d.name).nodeAlign(justify).nodeWidth(nodeWidth).nodePadding(nodePadding).extent([[1, 1], [width47 - 1, height47 - 5]]).iterations(iter);
        const result = generator(iterData);
        steps.push({
          iteration: iter,
          label: iter === 0 ? "Initial (no relaxation)" : `After ${iter} relaxation iteration${iter > 1 ? "s" : ""}`,
          nodes: result.nodes.map((n) => ({
            name: n.name,
            index: n.index,
            depth: n.depth,
            height: n.height,
            layer: n.layer,
            value: n.value,
            x0: n.x0,
            x1: n.x1,
            y0: n.y0,
            y1: n.y1
          })),
          links: result.links.map((l2) => ({
            sourceIndex: l2.source.index,
            targetIndex: l2.target.index,
            value: l2.value,
            width: l2.width,
            y0: l2.y0,
            y1: l2.y1,
            index: l2.index
          }))
        });
      }
      return steps;
    };
  }
  function sankeyLinkPath_(link5) {
    return (nodes3) => {
      const source3 = nodes3.find((n) => n.index === link5.sourceIndex);
      const target7 = nodes3.find((n) => n.index === link5.targetIndex);
      if (!source3 || !target7) return "";
      const linkObj = {
        source: source3,
        target: target7,
        width: link5.width,
        y0: link5.y0,
        y1: link5.y1
      };
      return sankeyLinkHorizontal_default()(linkObj) || "";
    };
  }

  // output/Component.SankeyDebug.FFI/index.js
  var computeD3SankeyWithSteps = function(nodes3) {
    return function(links3) {
      return function(config) {
        return computeD3SankeyWithSteps_(nodes3)(links3)(config.width)(config.height)(config.nodeWidth)(config.nodePadding)(config.maxIterations);
      };
    };
  };

  // output/DataViz.Layout.Sankey.ComputeWithSteps/index.js
  var map78 = /* @__PURE__ */ map(functorArray);
  var show57 = /* @__PURE__ */ show(showInt);
  var computeLayoutWithSteps = function(linkInputs) {
    return function(width47) {
      return function(height47) {
        return function(maxIterations) {
          var steps = map78(function(iter) {
            var label5 = (function() {
              var $6 = iter === 0;
              if ($6) {
                return "Initial (no relaxation)";
              }
              ;
              return "After " + (show57(iter) + (" relaxation iteration" + (function() {
                var $7 = iter > 1;
                if ($7) {
                  return "s";
                }
                ;
                return "";
              })()));
            })();
            var config = (function() {
              var v2 = defaultSankeyConfig(width47)(height47);
              return {
                alignment: v2.alignment,
                extent: v2.extent,
                linkColorMode: v2.linkColorMode,
                nodePadding: v2.nodePadding,
                nodeWidth: v2.nodeWidth,
                iterations: iter
              };
            })();
            var result = computeLayoutWithConfig(linkInputs)(config);
            return {
              iteration: iter,
              label: label5,
              nodes: result.nodes,
              links: result.links
            };
          })(range2(0)(maxIterations));
          return steps;
        };
      };
    };
  };

  // output/Halogen.Svg.Attributes.Color/index.js
  var show58 = /* @__PURE__ */ show(showInt);
  var show126 = /* @__PURE__ */ show(showNumber);
  var RGB = /* @__PURE__ */ (function() {
    function RGB2(value0, value1, value22) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
    }
    ;
    RGB2.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return new RGB2(value0, value1, value22);
        };
      };
    };
    return RGB2;
  })();
  var RGBA = /* @__PURE__ */ (function() {
    function RGBA2(value0, value1, value22, value32) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
      this.value3 = value32;
    }
    ;
    RGBA2.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return function(value32) {
            return new RGBA2(value0, value1, value22, value32);
          };
        };
      };
    };
    return RGBA2;
  })();
  var Named = /* @__PURE__ */ (function() {
    function Named2(value0) {
      this.value0 = value0;
    }
    ;
    Named2.create = function(value0) {
      return new Named2(value0);
    };
    return Named2;
  })();
  var NoColor = /* @__PURE__ */ (function() {
    function NoColor2() {
    }
    ;
    NoColor2.value = new NoColor2();
    return NoColor2;
  })();
  var printColor = function(v2) {
    if (v2 instanceof RGB) {
      return "rgb(" + (show58(v2.value0) + ("," + (show58(v2.value1) + ("," + (show58(v2.value2) + ")")))));
    }
    ;
    if (v2 instanceof RGBA) {
      return "rgba(" + (show58(v2.value0) + ("," + (show58(v2.value1) + ("," + (show58(v2.value2) + ("," + (show126(v2.value3) + ")")))))));
    }
    ;
    if (v2 instanceof Named) {
      return v2.value0;
    }
    ;
    if (v2 instanceof NoColor) {
      return "None";
    }
    ;
    throw new Error("Failed pattern match at Halogen.Svg.Attributes.Color (line 24, column 14 - line 28, column 20): " + [v2.constructor.name]);
  };

  // output/Halogen.Svg.Attributes/index.js
  var show59 = /* @__PURE__ */ show(showNumber);
  var map79 = /* @__PURE__ */ map(functorArray);
  var y24 = /* @__PURE__ */ (function() {
    var $26 = attr2("y");
    return function($27) {
      return $26(show59($27));
    };
  })();
  var x24 = /* @__PURE__ */ (function() {
    var $32 = attr2("x");
    return function($33) {
      return $32(show59($33));
    };
  })();
  var width32 = /* @__PURE__ */ (function() {
    var $34 = attr2("width");
    return function($35) {
      return $34(show59($35));
    };
  })();
  var viewBox2 = function(x_) {
    return function(y_) {
      return function(w) {
        return function(h_) {
          return attr2("viewBox")(joinWith(" ")(map79(show59)([x_, y_, w, h_])));
        };
      };
    };
  };
  var height32 = /* @__PURE__ */ (function() {
    var $92 = attr2("height");
    return function($93) {
      return $92(show59($93));
    };
  })();
  var fillOpacity = /* @__PURE__ */ (function() {
    var $104 = attr2("fill-opacity");
    return function($105) {
      return $104(show59($105));
    };
  })();
  var fill25 = /* @__PURE__ */ (function() {
    var $108 = attr2("fill");
    return function($109) {
      return $108(printColor($109));
    };
  })();

  // output/Halogen.Svg.Elements/index.js
  var element3 = /* @__PURE__ */ elementNS("http://www.w3.org/2000/svg");
  var g = /* @__PURE__ */ element3("g");
  var path13 = function(props) {
    return element3("path")(props)([]);
  };
  var rect = function(props) {
    return element3("rect")(props)([]);
  };
  var svg = /* @__PURE__ */ element3("svg");
  var text30 = /* @__PURE__ */ element3("text");

  // output/Component.SankeyDebug/index.js
  var show60 = /* @__PURE__ */ show(showInt);
  var max19 = /* @__PURE__ */ max(ordInt);
  var map80 = /* @__PURE__ */ map(functorArray);
  var show127 = /* @__PURE__ */ show(/* @__PURE__ */ showArray(showInt));
  var max110 = /* @__PURE__ */ max(ordNumber);
  var eq15 = /* @__PURE__ */ eq(eqNodeID);
  var show210 = /* @__PURE__ */ show(showNumber);
  var value16 = /* @__PURE__ */ value12(isPropString);
  var type_20 = /* @__PURE__ */ type_18(isPropInputType);
  var nub6 = /* @__PURE__ */ nub(ordString);
  var discard42 = /* @__PURE__ */ discard(discardUnit)(bindHalogenM);
  var modify_13 = /* @__PURE__ */ modify_(monadStateHalogenM);
  var bind62 = /* @__PURE__ */ bind(bindHalogenM);
  var get15 = /* @__PURE__ */ get(monadStateHalogenM);
  var pure58 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize20 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var LoadDataset = /* @__PURE__ */ (function() {
    function LoadDataset2(value0) {
      this.value0 = value0;
    }
    ;
    LoadDataset2.create = function(value0) {
      return new LoadDataset2(value0);
    };
    return LoadDataset2;
  })();
  var SelectIteration = /* @__PURE__ */ (function() {
    function SelectIteration2(value0) {
      this.value0 = value0;
    }
    ;
    SelectIteration2.create = function(value0) {
      return new SelectIteration2(value0);
    };
    return SelectIteration2;
  })();
  var RunComparison = /* @__PURE__ */ (function() {
    function RunComparison2() {
    }
    ;
    RunComparison2.value = new RunComparison2();
    return RunComparison2;
  })();
  var selectStyle = "padding: 8px 12px; font-size: 14px; background: #2a2a4e; color: #fff; border: 1px solid #444; border-radius: 4px;";
  var renderSummaryColumnPS = function(title4) {
    return function(color2) {
      return function(maybeStep) {
        return div_([strong([style("color: " + (color2 + ";"))])([text5(title4)]), (function() {
          if (maybeStep instanceof Just) {
            return ul([style("margin: 5px 0; padding-left: 15px; color: #aaa;")])([li_([text5("Nodes: " + show60(length3(maybeStep.value0.nodes)))]), li_([text5("Links: " + show60(length3(maybeStep.value0.links)))])]);
          }
          ;
          if (maybeStep instanceof Nothing) {
            return p([style("color: #666;")])([text5("No data")]);
          }
          ;
          throw new Error("Failed pattern match at Component.SankeyDebug (line 382, column 7 - line 389, column 65): " + [maybeStep.constructor.name]);
        })()]);
      };
    };
  };
  var renderSummaryColumn = function(title4) {
    return function(color2) {
      return function(maybeStep) {
        return div_([strong([style("color: " + (color2 + ";"))])([text5(title4)]), (function() {
          if (maybeStep instanceof Just) {
            return ul([style("margin: 5px 0; padding-left: 15px; color: #aaa;")])([li_([text5("Nodes: " + show60(length3(maybeStep.value0.nodes)))]), li_([text5("Links: " + show60(length3(maybeStep.value0.links)))])]);
          }
          ;
          if (maybeStep instanceof Nothing) {
            return p([style("color: #666;")])([text5("No data")]);
          }
          ;
          throw new Error("Failed pattern match at Component.SankeyDebug (line 368, column 7 - line 375, column 65): " + [maybeStep.constructor.name]);
        })()]);
      };
    };
  };
  var renderSummary = function(state3) {
    return div2([style("margin-top: 20px; background: #2a2a4e; border-radius: 8px; padding: 15px;")])([h3([style("color: #fff; margin: 0 0 10px 0; font-size: 16px;")])([text5("Comparison at iteration " + show60(state3.selectedIteration))]), div2([style("display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; font-size: 12px;")])([renderSummaryColumn("D3-sankey")("#4a9eff")(index(state3.d3Steps)(state3.selectedIteration)), renderSummaryColumnPS("PureScript")("#00ff88")(index(state3.psSteps)(state3.selectedIteration))])]);
  };
  var renderPSNodeStats = function(nodes3) {
    var maxLayer = foldl4(function(acc) {
      return function(n) {
        return max19(acc)(n.layer);
      };
    })(0)(nodes3);
    var layerCounts = map80(function(l2) {
      return length3(filter(function(n) {
        return n.layer === l2;
      })(nodes3));
    })(range2(0)(maxLayer));
    return div2([style("margin-top: 10px; font-size: 11px; color: #888;")])([text5(show60(length3(nodes3)) + (" nodes, layers: " + show127(layerCounts)))]);
  };
  var renderPSNode = function(color2) {
    return function(node) {
      return rect([x24(node.x0), y24(node.y0), width32(node.x1 - node.x0), height32(max110(1)(node.y1 - node.y0)), fill25(new Named(color2)), fillOpacity(0.8)]);
    };
  };
  var renderPSLink = function(nodes3) {
    return function(link5) {
      var maybeTarget = find2(function(n) {
        return eq15(n.index)(link5.targetIndex);
      })(nodes3);
      var maybeSource = find2(function(n) {
        return eq15(n.index)(link5.sourceIndex);
      })(nodes3);
      if (maybeSource instanceof Just && maybeTarget instanceof Just) {
        var pathD = "M" + (show210(maybeSource.value0.x1) + ("," + (show210(link5.y0) + ("C" + (show210((maybeSource.value0.x1 + maybeTarget.value0.x0) / 2) + ("," + (show210(link5.y0) + (" " + (show210((maybeSource.value0.x1 + maybeTarget.value0.x0) / 2) + ("," + (show210(link5.y1) + (" " + (show210(maybeTarget.value0.x0) + ("," + show210(link5.y1)))))))))))))));
        return path13([attr2("d")(pathD), attr2("fill")("none"), attr2("stroke")("#666"), attr2("stroke-width")(show210(link5.width)), attr2("stroke-opacity")("0.4")]);
      }
      ;
      return g([])([]);
    };
  };
  var renderPSLabel = function(svgWidth4) {
    return function(node) {
      var isLeftSide = node.x0 < svgWidth4 / 2;
      var labelX = (function() {
        if (isLeftSide) {
          return node.x1 + 4;
        }
        ;
        return node.x0 - 4;
      })();
      var anchor = (function() {
        if (isLeftSide) {
          return "start";
        }
        ;
        return "end";
      })();
      return text30([x24(labelX), y24((node.y0 + node.y1) / 2 + 3), attr2("fill")("#ccc"), style("font-size: 9px; text-anchor: " + (anchor + ";"))])([text5(node.name)]);
    };
  };
  var renderPSSankeySVG = function(nodes3) {
    return function(links3) {
      return function(w) {
        return function(h7) {
          return function(accentColor) {
            return svg([viewBox2(0)(0)(w)(h7), style("width: 100%; height: " + (show210(h7) + "px; background: #1e1e3a; border-radius: 4px;"))])([g([])(map80(renderPSLink(nodes3))(links3)), g([])(map80(renderPSNode(accentColor))(nodes3)), g([])(map80(renderPSLabel(w))(nodes3))]);
          };
        };
      };
    };
  };
  var renderNodeStats = function(nodes3) {
    var maxLayer = foldl4(function(acc) {
      return function(n) {
        return max19(acc)(n.layer);
      };
    })(0)(nodes3);
    var layerCounts = map80(function(l2) {
      return length3(filter(function(n) {
        return n.layer === l2;
      })(nodes3));
    })(range2(0)(maxLayer));
    return div2([style("margin-top: 10px; font-size: 11px; color: #888;")])([text5(show60(length3(nodes3)) + (" nodes, layers: " + show127(layerCounts)))]);
  };
  var renderD3Node = function(color2) {
    return function(node) {
      return rect([x24(node.x0), y24(node.y0), width32(node.x1 - node.x0), height32(max110(1)(node.y1 - node.y0)), fill25(new Named(color2)), fillOpacity(0.8)]);
    };
  };
  var renderD3Link = function(nodes3) {
    return function(link5) {
      var pathD = sankeyLinkPath_(link5)(nodes3);
      return path13([attr2("d")(pathD), attr2("fill")("none"), attr2("stroke")("#666"), attr2("stroke-width")(show210(link5.width)), attr2("stroke-opacity")("0.4")]);
    };
  };
  var renderD3Label = function(svgWidth4) {
    return function(node) {
      var isLeftSide = node.x0 < svgWidth4 / 2;
      var labelX = (function() {
        if (isLeftSide) {
          return node.x1 + 4;
        }
        ;
        return node.x0 - 4;
      })();
      var anchor = (function() {
        if (isLeftSide) {
          return "start";
        }
        ;
        return "end";
      })();
      return text30([x24(labelX), y24((node.y0 + node.y1) / 2 + 3), attr2("fill")("#ccc"), style("font-size: 9px; text-anchor: " + (anchor + ";"))])([text5(node.name)]);
    };
  };
  var renderD3SankeySVG = function(nodes3) {
    return function(links3) {
      return function(w) {
        return function(h7) {
          return function(accentColor) {
            return svg([viewBox2(0)(0)(w)(h7), style("width: 100%; height: " + (show210(h7) + "px; background: #1e1e3a; border-radius: 4px;"))])([g([])(map80(renderD3Link(nodes3))(links3)), g([])(map80(renderD3Node(accentColor))(nodes3)), g([])(map80(renderD3Label(w))(nodes3))]);
          };
        };
      };
    };
  };
  var renderColumnPS = function(title4) {
    return function(color2) {
      return function(steps) {
        return function(iteration) {
          return function(w) {
            return function(h7) {
              return div2([style("flex: 1; min-width: 360px; background: #2a2a4e; border-radius: 8px; padding: 15px;")])([h3([style("color: " + (color2 + "; margin: 0 0 10px 0; font-size: 16px;"))])([text5(title4)]), (function() {
                var v2 = index(steps)(iteration);
                if (v2 instanceof Just) {
                  return div_([p([style("color: #888; font-size: 12px; margin: 0 0 10px 0;")])([text5(v2.value0.label)]), renderPSSankeySVG(v2.value0.nodes)(v2.value0.links)(w)(h7)(color2), renderPSNodeStats(v2.value0.nodes)]);
                }
                ;
                if (v2 instanceof Nothing) {
                  return p([style("color: #666;")])([text5("No data")]);
                }
                ;
                throw new Error("Failed pattern match at Component.SankeyDebug (line 180, column 7 - line 190, column 65): " + [v2.constructor.name]);
              })()]);
            };
          };
        };
      };
    };
  };
  var renderColumn = function(title4) {
    return function(color2) {
      return function(steps) {
        return function(iteration) {
          return function(w) {
            return function(h7) {
              return div2([style("flex: 1; min-width: 360px; background: #2a2a4e; border-radius: 8px; padding: 15px;")])([h3([style("color: " + (color2 + "; margin: 0 0 10px 0; font-size: 16px;"))])([text5(title4)]), (function() {
                var v2 = index(steps)(iteration);
                if (v2 instanceof Just) {
                  return div_([p([style("color: #888; font-size: 12px; margin: 0 0 10px 0;")])([text5(v2.value0.label)]), renderD3SankeySVG(v2.value0.nodes)(v2.value0.links)(w)(h7)(color2), renderNodeStats(v2.value0.nodes)]);
                }
                ;
                if (v2 instanceof Nothing) {
                  return p([style("color: #666;")])([text5("No data")]);
                }
                ;
                throw new Error("Failed pattern match at Component.SankeyDebug (line 159, column 7 - line 169, column 65): " + [v2.constructor.name]);
              })()]);
            };
          };
        };
      };
    };
  };
  var $$parseInt = function(s3) {
    var v2 = head2(split(".")(s3));
    if (v2 instanceof Just) {
      return new Just(unsafeParseInt(v2.value0));
    }
    ;
    if (v2 instanceof Nothing) {
      return Nothing.value;
    }
    ;
    throw new Error("Failed pattern match at Component.SankeyDebug (line 449, column 14 - line 451, column 21): " + [v2.constructor.name]);
  };
  var pageStyle = "padding: 20px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #1a1a2e; color: #eee; min-height: 100vh;";
  var render24 = function(state3) {
    return div2([classes(["sankey-debug-page"]), style(pageStyle)])([div2([style("margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 15px;")])([h1([style("color: #00ff88; margin: 0 0 10px 0; font-size: 24px;")])([text5("Sankey Layout Algorithm Comparison")]), p([style("color: #aaa; margin: 0; font-size: 14px;")])([text5("Visual comparison of D3-sankey (JS) and our PureScript port")])]), div2([style("margin-bottom: 20px; display: flex; gap: 20px; align-items: center; flex-wrap: wrap;")])([div_([label4([style("color: #888; margin-right: 8px;")])([text5("Dataset:")]), select7([style(selectStyle), onValueChange(LoadDataset.create)])([option([value16("/data/d3-library-deps.csv")])([text5("D3 Library Dependencies")]), option([value16("/data/d3-website-deps.csv")])([text5("Website Dependencies")]), option([value16("/data/energy.csv")])([text5("Energy flow")])])]), div2([style("flex: 1; min-width: 200px;")])([label4([style("color: #888; margin-right: 8px;")])([text5("Iteration: " + (show60(state3.selectedIteration) + (" / " + show60(state3.maxIterations))))]), input([type_20(InputRange.value), min5(0), max6(toNumber(state3.maxIterations)), value16(show60(state3.selectedIteration)), style("width: 200px; vertical-align: middle;"), onValueInput(function(v2) {
      return new SelectIteration(fromMaybe(0)($$parseInt(v2)));
    })])])]), div2([style("display: flex; gap: 15px; flex-wrap: wrap;")])([renderColumn("D3-sankey (JS)")("#4a9eff")(state3.d3Steps)(state3.selectedIteration)(state3.svgWidth)(state3.svgHeight), renderColumnPS("PureScript")("#00ff88")(state3.psSteps)(state3.selectedIteration)(state3.svgWidth)(state3.svgHeight)]), renderSummary(state3)]);
  };
  var computeAllSteps = function(csvData) {
    return function(width47) {
      return function(height47) {
        return function(maxIterations) {
          var linkInputs = parseSankeyCSV(csvData);
          var nodeNames = nub6(concat(map80(function(l2) {
            return [l2.s, l2.t];
          })(linkInputs)));
          var psSteps = computeLayoutWithSteps(linkInputs)(width47)(height47)(maxIterations);
          var d3Nodes = map80(function(name16) {
            return {
              name: name16
            };
          })(nodeNames);
          var d3Links = map80(function(l2) {
            return {
              source: l2.s,
              target: l2.t,
              value: l2.v
            };
          })(linkInputs);
          var d3Steps = computeD3SankeyWithSteps(d3Nodes)(d3Links)({
            width: width47,
            height: height47,
            nodeWidth: 15,
            nodePadding: 10,
            maxIterations
          });
          return {
            d3Steps,
            psSteps
          };
        };
      };
    };
  };
  var handleAction19 = function(dictMonadAff) {
    var liftAff2 = liftAff(monadAffHalogenM(dictMonadAff));
    var liftEffect54 = liftEffect(monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    return function(v2) {
      if (v2 instanceof Initialize20) {
        return handleAction19(dictMonadAff)(new LoadDataset("/data/energy.csv"));
      }
      ;
      if (v2 instanceof LoadDataset) {
        return discard42(modify_13(function(v1) {
          var $61 = {};
          for (var $62 in v1) {
            if ({}.hasOwnProperty.call(v1, $62)) {
              $61[$62] = v1[$62];
            }
            ;
          }
          ;
          $61.selectedDataset = v2.value0;
          return $61;
        }))(function() {
          return bind62(liftAff2(get5(string)(v2.value0)))(function(result) {
            if (result instanceof Left) {
              return liftEffect54(log2("Failed to load: " + v2.value0));
            }
            ;
            if (result instanceof Right) {
              return discard42(modify_13(function(v1) {
                var $66 = {};
                for (var $67 in v1) {
                  if ({}.hasOwnProperty.call(v1, $67)) {
                    $66[$67] = v1[$67];
                  }
                  ;
                }
                ;
                $66.csvData = new Just(result.value0.body);
                return $66;
              }))(function() {
                return handleAction19(dictMonadAff)(RunComparison.value);
              });
            }
            ;
            throw new Error("Failed pattern match at Component.SankeyDebug (line 400, column 5 - line 404, column 35): " + [result.constructor.name]);
          });
        });
      }
      ;
      if (v2 instanceof SelectIteration) {
        return modify_13(function(v1) {
          var $71 = {};
          for (var $72 in v1) {
            if ({}.hasOwnProperty.call(v1, $72)) {
              $71[$72] = v1[$72];
            }
            ;
          }
          ;
          $71.selectedIteration = v2.value0;
          return $71;
        });
      }
      ;
      if (v2 instanceof RunComparison) {
        return bind62(get15)(function(state3) {
          if (state3.csvData instanceof Nothing) {
            return pure58(unit);
          }
          ;
          if (state3.csvData instanceof Just) {
            var v1 = computeAllSteps(state3.csvData.value0)(state3.svgWidth)(state3.svgHeight)(state3.maxIterations);
            return modify_13(function(v22) {
              var $77 = {};
              for (var $78 in v22) {
                if ({}.hasOwnProperty.call(v22, $78)) {
                  $77[$78] = v22[$78];
                }
                ;
              }
              ;
              $77.d3Steps = v1.d3Steps;
              $77.psSteps = v1.psSteps;
              return $77;
            });
          }
          ;
          throw new Error("Failed pattern match at Component.SankeyDebug (line 411, column 5 - line 415, column 61): " + [state3.csvData.constructor.name]);
        });
      }
      ;
      throw new Error("Failed pattern match at Component.SankeyDebug (line 393, column 16 - line 415, column 61): " + [v2.constructor.name]);
    };
  };
  var component20 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return {
          csvData: Nothing.value,
          selectedDataset: "/data/d3-library-deps.csv",
          selectedIteration: 0,
          maxIterations: 6,
          d3Steps: [],
          psSteps: [],
          svgWidth: 350,
          svgHeight: 400
        };
      },
      render: render24,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction19(dictMonadAff),
        initialize: new Just(Initialize20.value)
      })
    });
  };

  // output/D3.Viz.TreeAPI.SceneJoinDemo/foreign.js
  function clearInnerHTML(selector) {
    return function() {
      const element4 = document.querySelector(selector);
      if (element4) {
        element4.innerHTML = "";
      }
    };
  }

  // output/D3.Viz.TreeAPI.SceneJoinDemo/index.js
  var bind63 = /* @__PURE__ */ bind(bindD3v2M);
  var select32 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var discard43 = /* @__PURE__ */ discard(discardUnit)(bindD3v2M);
  var liftEffect37 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var v3Attr12 = /* @__PURE__ */ v3Attr(showNumber);
  var lit13 = /* @__PURE__ */ lit(numExprEvalD);
  var str14 = /* @__PURE__ */ str(stringExprEvalD);
  var renderTree54 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D);
  var renderTree118 = /* @__PURE__ */ renderTree54(ordUnit);
  var pure59 = /* @__PURE__ */ pure(applicativeD3v2M);
  var v3AttrFn4 = /* @__PURE__ */ v3AttrFn(showNumber);
  var ordRecord19 = /* @__PURE__ */ ordRecord();
  var ordRecordCons17 = /* @__PURE__ */ ordRecordCons(ordRecordNil)();
  var renderTree218 = /* @__PURE__ */ renderTree54(/* @__PURE__ */ ordRecord19(/* @__PURE__ */ ordRecordCons17({
    reflectSymbol: function() {
      return "points";
    }
  })(/* @__PURE__ */ ordArray(/* @__PURE__ */ ordRecord19(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons17({
    reflectSymbol: function() {
      return "y";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "x";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "color";
    }
  })(ordString))))));
  var createSvgContainer = function(containerSelector) {
    return bind63(select32(containerSelector))(function(container) {
      return discard43(liftEffect37(clearInnerHTML(containerSelector)))(function() {
        var svgTree = withChildren(named(SVG.value)("svg")([v3Attr12("width")(lit13(800)), v3Attr12("height")(lit13(300)), v3AttrStr("viewBox")(str14("0 0 800 300")), v3AttrStr("id")(str14("scene-join-demo-svg")), v3AttrStr("class")(str14("scene-join-demo"))]))([]);
        return bind63(renderTree118(container)(svgTree))(function() {
          return pure59(unit);
        });
      });
    });
  };
  var createCirclesTree = function(scene) {
    return sceneNestedJoin("circles")("circle")([scene])(function(v2) {
      return v2.points;
    })(function(point3) {
      return elem3(Circle.value)([v3Attr12("cx")(lit13(point3.x)), v3Attr12("cy")(lit13(point3.y)), v3Attr12("r")(lit13(20)), v3AttrStr("fill")(str14(point3.color)), v3AttrStr("stroke")(str14("#000")), v3Attr12("stroke-width")(lit13(2))]);
    })({
      enterBehavior: new Just({
        initialAttrs: [v3Attr12("cx")(lit13(400)), v3Attr12("cy")(lit13(150)), v3Attr12("r")(lit13(0))],
        transition: new Just({
          duration: 600,
          delay: Nothing.value,
          staggerDelay: Nothing.value,
          easing: new Just(CubicInOut.value)
        })
      }),
      updateBehavior: new Just({
        attrs: [v3AttrFn4("cx")(function(v2) {
          return v2.x;
        }), v3AttrFn4("cy")(function(v2) {
          return v2.y;
        }), v3Attr12("r")(lit13(20)), v3AttrFnStr("fill")(function(v2) {
          return v2.color;
        }), v3AttrStr("stroke")(str14("#000")), v3Attr12("stroke-width")(lit13(2))],
        transition: new Just({
          duration: 400,
          delay: Nothing.value,
          staggerDelay: Nothing.value,
          easing: new Just(CubicInOut.value)
        })
      }),
      exitBehavior: new Just({
        attrs: [v3Attr12("r")(lit13(0))],
        transition: new Just({
          duration: 300,
          delay: Nothing.value,
          staggerDelay: Nothing.value,
          easing: new Just(CubicIn.value)
        })
      })
    });
  };
  var updateCircles = function(points) {
    return bind63(select32("#scene-join-demo-svg"))(function(svgContainer) {
      var scene = {
        points
      };
      var tree2 = createCirclesTree(scene);
      return bind63(renderTree218(svgContainer)(tree2))(function() {
        return pure59(unit);
      });
    });
  };
  var drawInitial = function(containerSelector) {
    return discard43(createSvgContainer(containerSelector))(function() {
      return updateCircles([{
        x: 100,
        y: 100,
        color: "red"
      }, {
        x: 200,
        y: 150,
        color: "blue"
      }, {
        x: 300,
        y: 100,
        color: "green"
      }, {
        x: 400,
        y: 150,
        color: "orange"
      }, {
        x: 500,
        y: 100,
        color: "purple"
      }]);
    });
  };
  var updateToSeven = function(v2) {
    return updateCircles([{
      x: 100,
      y: 100,
      color: "red"
    }, {
      x: 200,
      y: 150,
      color: "blue"
    }, {
      x: 300,
      y: 100,
      color: "green"
    }, {
      x: 400,
      y: 150,
      color: "orange"
    }, {
      x: 500,
      y: 100,
      color: "purple"
    }, {
      x: 600,
      y: 150,
      color: "pink"
    }, {
      x: 700,
      y: 100,
      color: "cyan"
    }]);
  };
  var updateToThree = function(v2) {
    return updateCircles([{
      x: 150,
      y: 120,
      color: "red"
    }, {
      x: 300,
      y: 100,
      color: "green"
    }, {
      x: 450,
      y: 130,
      color: "orange"
    }]);
  };

  // output/Component.SceneJoinDemo/index.js
  var Initialize21 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var ShowInitial = /* @__PURE__ */ (function() {
    function ShowInitial2() {
    }
    ;
    ShowInitial2.value = new ShowInitial2();
    return ShowInitial2;
  })();
  var ShowThree = /* @__PURE__ */ (function() {
    function ShowThree2() {
    }
    ;
    ShowThree2.value = new ShowThree2();
    return ShowThree2;
  })();
  var ShowSeven = /* @__PURE__ */ (function() {
    function ShowSeven2() {
    }
    ;
    ShowSeven2.value = new ShowSeven2();
    return ShowSeven2;
  })();
  var render25 = function(v2) {
    return div2([class_("scene-join-demo-container")])([h1_([text5("SceneNestedJoin Demo")]), p_([text5("This demonstrates SceneNestedJoin - the clean solution for General Update Pattern with type decomposition!")]), div2([class_("controls")])([button2([onClick(function(v1) {
      return ShowInitial.value;
    }), class_("btn btn-primary")])([text5("Show 5 Circles (Initial)")]), button2([onClick(function(v1) {
      return ShowThree.value;
    }), class_("btn btn-warning")])([text5("Show 3 Circles (Exit)")]), button2([onClick(function(v1) {
      return ShowSeven.value;
    }), class_("btn btn-success")])([text5("Show 7 Circles (Enter)")])]), div2([id3("scene-join-demo-viz"), class_("visualization")])([]), div2([class_("explanation")])([h3_([text5("What's Happening?")]), ul_([li_([text5("Initial: 5 circles enter from center with transition")]), li_([text5("Show 3: 2 circles exit (shrink away), 3 update positions")]), li_([text5("Show 7: 2 new circles enter from center, 5 update positions")])]), h3_([text5("The Code")]), pre_([code_([text5('T.sceneNestedJoin "circles" "circle"\n  [scene]              -- Outer data: SceneData\n  (_.points)           -- Decompose to Array DataPoint\n  (\\\\point -> ...)      -- Template\n  { enterBehavior: Just { initialAttrs: [...], transition: ... }\n  , updateBehavior: Just { attrs: [], transition: ... }\n  , exitBehavior: Just { attrs: [...], transition: ... }\n  }')])])])]);
  };
  var handleAction20 = function(dictMonadAff) {
    var liftEffect54 = liftEffect(monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    return function(v2) {
      if (v2 instanceof Initialize21) {
        return liftEffect54(runD3v2M(drawInitial("#scene-join-demo-viz")));
      }
      ;
      if (v2 instanceof ShowInitial) {
        return liftEffect54(runD3v2M(drawInitial("#scene-join-demo-viz")));
      }
      ;
      if (v2 instanceof ShowThree) {
        return liftEffect54(runD3v2M(updateToThree("#scene-join-demo-viz")));
      }
      ;
      if (v2 instanceof ShowSeven) {
        return liftEffect54(runD3v2M(updateToSeven("#scene-join-demo-viz")));
      }
      ;
      throw new Error("Failed pattern match at Component.SceneJoinDemo (line 92, column 16 - line 103, column 70): " + [v2.constructor.name]);
    };
  };
  var component21 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render25,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction20(dictMonadAff),
        initialize: new Just(Initialize21.value)
      })
    });
  };

  // output/Component.Showcase.ShowcaseIndex/index.js
  var pure60 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize22 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var renderCard = function(route) {
    return function(title4) {
      return function(description) {
        return a([classes(["howto-card"]), href4("#" + routeToPath(route))])([h3([classes(["howto-card__title"])])([text5(title4)]), p([classes(["howto-card__description"])])([text5(description)])]);
      };
    };
  };
  var render26 = function(v2) {
    return div2([classes(["docs-page", "showcase-index"])])([render4({
      logoSize: Large.value,
      quadrant: NoQuadrant.value,
      prevNext: Nothing.value,
      pageTitle: Nothing.value
    }), section([classes(["docs-hero"])])([div2([classes(["docs-hero-content"])])([h1([classes(["docs-hero-title"])])([text5("Showcase")]), p([classes(["docs-hero-description"])])([text5("Complex, app-like visualizations that demonstrate PSD3's full capabilities. These examples benefit from full-screen treatment.")])])]), section([classes(["docs-section"])])([h2([classes(["docs-section-title"])])([text5("Interactive Visualizations")]), div2([classes(["howto-card-grid"])])([renderCard(ForcePlayground.value)("Force Playground")("Interactive force simulation with multiple datasets. Toggle forces, filter categories, and watch animated enter/exit transitions."), renderCard(TreeBuilder.value)("Tree Builder")("Visual tool for building D3 visualizations. Drag elements, configure attributes, and see live preview with sample data."), renderCard(TourWealthHealth.value)("Wealth & Health of Nations")("Animated bubble chart showing GDP vs life expectancy over time. A classic visualization recreated in PSD3."), renderCard(SPLOM.value)("Brushable SPLOM")("Scatterplot matrix of Palmer Penguins with linked brushing. Select points in any cell to highlight across all views."), renderCard(TourSimpsons.value)("Simpson's Paradox")("Interactive exploration of Simpson's Paradox with animated transitions. A classic setosa.io visualization ported to PSD3.")])])]);
  };
  var handleAction21 = function(v2) {
    return pure60(unit);
  };
  var component22 = /* @__PURE__ */ (function() {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render26,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction21,
        initialize: new Just(Initialize22.value)
      })
    });
  })();

  // output/Component.SimpleForceGraph/index.js
  var bind64 = /* @__PURE__ */ bind(bindHalogenM);
  var pure61 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize23 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var render27 = function(v2) {
    return div_([h1_([text5("Simple Force Graph")]), p_([text5("A minimal 5-node force-directed graph with hardcoded data.")]), p_([text5("Drag nodes to interact. Zoom with scroll wheel.")]), div2([attr2("id")("simple-force-graph"), attr2("class")("svg-container")])([])]);
  };
  var handleAction22 = function(dictMonadAff) {
    var liftEffect54 = liftEffect(monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    return function(v2) {
      return bind64(liftEffect54(simpleForceGraph("#simple-force-graph")))(function() {
        return pure61(unit);
      });
    };
  };
  var component23 = function(dictMonadAff) {
    return mkComponent({
      initialState: $$const(unit),
      render: render27,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction22(dictMonadAff),
        initialize: new Just(Initialize23.value)
      })
    });
  };

  // output/D3.Viz.FPFTW.AnscombeQuartet/index.js
  var attr30 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text31 = /* @__PURE__ */ text6(stringExprEvalD);
  var append116 = /* @__PURE__ */ append(semigroupArray);
  var x25 = /* @__PURE__ */ x(toAttributeValueNumber);
  var num25 = /* @__PURE__ */ num(numExprEvalD);
  var y25 = /* @__PURE__ */ y(toAttributeValueNumber);
  var textContent13 = /* @__PURE__ */ textContent2(toAttributeValueString);
  var textAnchor13 = /* @__PURE__ */ textAnchor(toAttributeValueString);
  var fill26 = /* @__PURE__ */ fill(toAttributeValueString);
  var x110 = /* @__PURE__ */ x1(toAttributeValueNumber);
  var y111 = /* @__PURE__ */ y1(toAttributeValueNumber);
  var x26 = /* @__PURE__ */ x2(toAttributeValueNumber);
  var y26 = /* @__PURE__ */ y2(toAttributeValueNumber);
  var stroke19 = /* @__PURE__ */ stroke(toAttributeValueString);
  var strokeWidth18 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var map81 = /* @__PURE__ */ map(functorArray);
  var cx13 = /* @__PURE__ */ cx(toAttributeValueNumber);
  var cy13 = /* @__PURE__ */ cy(toAttributeValueNumber);
  var r15 = /* @__PURE__ */ r(toAttributeValueNumber);
  var opacity10 = /* @__PURE__ */ opacity(toAttributeValueNumber);
  var bind65 = /* @__PURE__ */ bind(bindD3v2M);
  var select33 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var width33 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var height33 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var transform10 = /* @__PURE__ */ transform2(toAttributeValueString);
  var show61 = /* @__PURE__ */ show(showNumber);
  var renderTree55 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(ordUnit);
  var pure62 = /* @__PURE__ */ pure(applicativeD3v2M);
  var scaleY3 = function(y32) {
    return 280 - (y32 - 3) * 20;
  };
  var scaleX3 = function(x32) {
    return (x32 - 4) * 30 + 30;
  };
  var scatterplot = function(datasetName) {
    return function(points) {
      return withChildren(named(Group.value)("plot-" + datasetName)([attr30("class")(text31("anscombe-plot"))]))(append116([elem3(Text.value)([x25(num25(260)), y25(num25(30)), textContent13(text31(datasetName)), textAnchor13(text31("middle")), fill26(text31("#333")), attr30("class")(text31("plot-title"))]), elem3(Line.value)([x110(num25(30)), y111(num25(280)), x26(num25(480)), y26(num25(280)), stroke19(text31("#999")), strokeWidth18(num25(1))]), elem3(Line.value)([x110(num25(30)), y111(num25(80)), x26(num25(30)), y26(num25(280)), stroke19(text31("#999")), strokeWidth18(num25(1))])])(map81(function(pt3) {
        return elem3(Circle.value)([cx13(num25(scaleX3(pt3.x))), cy13(num25(scaleY3(pt3.y))), r15(num25(4)), fill26(text31("#4A90E2")), opacity10(num25(0.7)), stroke19(text31("#2E5C8A")), strokeWidth18(num25(1.5)), attr30("class")(text31("data-point"))]);
      })(points)));
    };
  };
  var dataset42 = [{
    x: 8,
    y: 6.58
  }, {
    x: 8,
    y: 5.76
  }, {
    x: 8,
    y: 7.71
  }, {
    x: 8,
    y: 8.84
  }, {
    x: 8,
    y: 8.47
  }, {
    x: 8,
    y: 7.04
  }, {
    x: 8,
    y: 5.25
  }, {
    x: 19,
    y: 12.5
  }, {
    x: 8,
    y: 5.56
  }, {
    x: 8,
    y: 7.91
  }, {
    x: 8,
    y: 6.89
  }];
  var dataset32 = [{
    x: 10,
    y: 7.46
  }, {
    x: 8,
    y: 6.77
  }, {
    x: 13,
    y: 12.74
  }, {
    x: 9,
    y: 7.11
  }, {
    x: 11,
    y: 7.81
  }, {
    x: 14,
    y: 8.84
  }, {
    x: 6,
    y: 6.08
  }, {
    x: 4,
    y: 5.39
  }, {
    x: 12,
    y: 8.15
  }, {
    x: 7,
    y: 6.42
  }, {
    x: 5,
    y: 5.73
  }];
  var dataset22 = [{
    x: 10,
    y: 9.14
  }, {
    x: 8,
    y: 8.14
  }, {
    x: 13,
    y: 8.74
  }, {
    x: 9,
    y: 8.77
  }, {
    x: 11,
    y: 9.26
  }, {
    x: 14,
    y: 8.1
  }, {
    x: 6,
    y: 6.13
  }, {
    x: 4,
    y: 3.1
  }, {
    x: 12,
    y: 9.13
  }, {
    x: 7,
    y: 7.26
  }, {
    x: 5,
    y: 4.74
  }];
  var dataset12 = [{
    x: 10,
    y: 8.04
  }, {
    x: 8,
    y: 6.95
  }, {
    x: 13,
    y: 7.58
  }, {
    x: 9,
    y: 8.81
  }, {
    x: 11,
    y: 8.33
  }, {
    x: 14,
    y: 9.96
  }, {
    x: 6,
    y: 7.24
  }, {
    x: 4,
    y: 4.26
  }, {
    x: 12,
    y: 10.84
  }, {
    x: 7,
    y: 4.82
  }, {
    x: 5,
    y: 5.68
  }];
  var anscombeData = [{
    name: "Dataset I",
    points: dataset12
  }, {
    name: "Dataset II",
    points: dataset22
  }, {
    name: "Dataset III",
    points: dataset32
  }, {
    name: "Dataset IV",
    points: dataset42
  }];
  var drawAnscombeQuartet = function(containerSelector) {
    return runD3v2M(bind65(select33(containerSelector))(function(container) {
      var quartetTree = withChildren(named(SVG.value)("svg")([width33(num25(1040)), height33(num25(600)), viewBox(0)(0)(1040)(600), attr30("class")(text31("anscombe-quartet"))]))(map81(function(v2) {
        var yOffset = (function() {
          var $37 = v2.name === "Dataset I" || v2.name === "Dataset II";
          if ($37) {
            return 0;
          }
          ;
          return 300;
        })();
        var xOffset = (function() {
          var $38 = v2.name === "Dataset I" || v2.name === "Dataset III";
          if ($38) {
            return 0;
          }
          ;
          return 520;
        })();
        return withChild(named(Group.value)("group-" + v2.name)([transform10(text31("translate(" + (show61(xOffset) + ("," + (show61(yOffset) + ")")))))]))(scatterplot(v2.name)(v2.points));
      })(anscombeData));
      return bind65(renderTree55(container)(quartetTree))(function() {
        return pure62(unit);
      });
    }));
  };

  // output/D3.Viz.FPFTW.SetOperations/index.js
  var fromFoldable35 = /* @__PURE__ */ fromFoldable20(foldableArray)(ordString);
  var attr31 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text32 = /* @__PURE__ */ text6(stringExprEvalD);
  var append117 = /* @__PURE__ */ append(semigroupArray);
  var cx14 = /* @__PURE__ */ cx(toAttributeValueNumber);
  var num26 = /* @__PURE__ */ num(numExprEvalD);
  var cy14 = /* @__PURE__ */ cy(toAttributeValueNumber);
  var r16 = /* @__PURE__ */ r(toAttributeValueNumber);
  var fill27 = /* @__PURE__ */ fill(toAttributeValueString);
  var stroke20 = /* @__PURE__ */ stroke(toAttributeValueString);
  var strokeWidth19 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var x27 = /* @__PURE__ */ x(toAttributeValueNumber);
  var y27 = /* @__PURE__ */ y(toAttributeValueNumber);
  var textContent14 = /* @__PURE__ */ textContent2(toAttributeValueString);
  var textAnchor14 = /* @__PURE__ */ textAnchor(toAttributeValueString);
  var show62 = /* @__PURE__ */ show(showInt);
  var opacity11 = /* @__PURE__ */ opacity(toAttributeValueNumber);
  var toUnfoldable9 = /* @__PURE__ */ toUnfoldable5(unfoldableArray);
  var bind66 = /* @__PURE__ */ bind(bindD3v2M);
  var select34 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var width34 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var height34 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var div5 = /* @__PURE__ */ div(euclideanRingInt);
  var mod12 = /* @__PURE__ */ mod(euclideanRingInt);
  var transform11 = /* @__PURE__ */ transform2(toAttributeValueString);
  var show128 = /* @__PURE__ */ show(showNumber);
  var renderTree56 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(ordUnit);
  var pure63 = /* @__PURE__ */ pure(applicativeD3v2M);
  var setB = /* @__PURE__ */ fromFoldable35(["blue", "green", "brown", "black", "purple"]);
  var setA = /* @__PURE__ */ fromFoldable35(["yellow", "blue", "red", "orange", "purple"]);
  var setsToVisualize = [{
    name: "Set A",
    set: setA,
    borderColor: "#E74C3C"
  }, {
    name: "Set B",
    set: setB,
    borderColor: "#3498DB"
  }, {
    name: "A \u222A B (Union)",
    set: /* @__PURE__ */ union4(ordString)(setA)(setB),
    borderColor: "#9B59B6"
  }, {
    name: "A \u2229 B (Intersection)",
    set: /* @__PURE__ */ intersection2(ordString)(setA)(setB),
    borderColor: "#27AE60"
  }];
  var initialRadius = 8;
  var goldenAngle = /* @__PURE__ */ (function() {
    return pi * (3 - sqrt(5));
  })();
  var phylotaxisPosition = function(index7) {
    var i2 = toNumber(index7);
    var rad = initialRadius * sqrt(0.5 + i2);
    var angle = i2 * goldenAngle;
    return {
      x: rad * cos(angle),
      y: rad * sin(angle)
    };
  };
  var colorMap = [{
    name: "yellow",
    hex: "#FFD700"
  }, {
    name: "blue",
    hex: "#4169E1"
  }, {
    name: "red",
    hex: "#DC143C"
  }, {
    name: "orange",
    hex: "#FF8C00"
  }, {
    name: "purple",
    hex: "#9370DB"
  }, {
    name: "green",
    hex: "#32CD32"
  }, {
    name: "brown",
    hex: "#8B4513"
  }, {
    name: "black",
    hex: "#2C2C2C"
  }, {
    name: "pink",
    hex: "#FF69B4"
  }];
  var getColorHex = function(colorName) {
    var v2 = find2(function(c2) {
      return c2.name === colorName;
    })(colorMap);
    if (v2 instanceof Just) {
      return v2.value0.hex;
    }
    ;
    if (v2 instanceof Nothing) {
      return "#999999";
    }
    ;
    throw new Error("Failed pattern match at D3.Viz.FPFTW.SetOperations (line 78, column 3 - line 80, column 25): " + [v2.constructor.name]);
  };
  var visualizeSet = function(setName14) {
    return function(elements) {
      return function(borderColor) {
        return withChildren(named(Group.value)("set-" + setName14)([attr31("class")(text32("set-visualization"))]))(append117([elem3(Circle.value)([cx14(num26(0)), cy14(num26(0)), r16(num26(120)), fill27(text32("none")), stroke20(text32(borderColor)), strokeWidth19(num26(3)), attr31("class")(text32("set-boundary"))]), elem3(Text.value)([x27(num26(0)), y27(num26(-135)), textContent14(text32(setName14)), textAnchor14(text32("middle")), fill27(text32("#333")), attr31("class")(text32("set-title"))]), elem3(Text.value)([x27(num26(0)), y27(num26(145)), textContent14(text32("(" + (show62(size5(elements)) + " colors)"))), textAnchor14(text32("middle")), fill27(text32("#666")), attr31("class")(text32("set-count"))])])(mapWithIndex3(function(index7) {
          return function(colorName) {
            var pos = phylotaxisPosition(index7);
            var colorHex = getColorHex(colorName);
            return elem3(Circle.value)([cx14(num26(pos.x)), cy14(num26(pos.y)), r16(num26(12)), fill27(text32(colorHex)), opacity11(num26(0.9)), stroke20(text32("#fff")), strokeWidth19(num26(2)), attr31("class")(text32("set-element"))]);
          };
        })(toUnfoldable9(elements))));
      };
    };
  };
  var drawSetOperations = function(containerSelector) {
    return runD3v2M(bind66(select34(containerSelector))(function(container) {
      var setsTree = withChildren(named(SVG.value)("svg")([width34(num26(1e3)), height34(num26(700)), viewBox(0)(0)(1e3)(700), attr31("class")(text32("set-operations"))]))(mapWithIndex3(function(index7) {
        return function(v2) {
          var row = div5(index7)(2);
          var yOffset = toNumber(row) * 350 + 200;
          var col2 = mod12(index7)(2);
          var xOffset = toNumber(col2) * 500 + 250;
          return withChild(named(Group.value)("group-" + v2.name)([transform11(text32("translate(" + (show128(xOffset) + ("," + (show128(yOffset) + ")")))))]))(visualizeSet(v2.name)(v2.set)(v2.borderColor));
        };
      })(setsToVisualize));
      return bind66(renderTree56(container)(setsTree))(function() {
        return pure63(unit);
      });
    }));
  };

  // output/PSD3.Shared.TutorialNav/index.js
  var eq10 = /* @__PURE__ */ eq(eqRoute);
  var show63 = /* @__PURE__ */ show(showRoute);
  var allTutorialRoutes = /* @__PURE__ */ (function() {
    return [TourFoundations.value, TourProfessional.value, TourFlow.value, TourHierarchies.value, TourMotion.value, TourInterpreters.value, TourFPFTW.value, TourGraphAlgorithms.value];
  })();
  var getNextTutorial = function(currentRoute) {
    var v2 = findIndex(function(r29) {
      return eq10(r29)(currentRoute);
    })(allTutorialRoutes);
    if (v2 instanceof Nothing) {
      return Nothing.value;
    }
    ;
    if (v2 instanceof Just) {
      return index(allTutorialRoutes)(v2.value0 + 1 | 0);
    }
    ;
    throw new Error("Failed pattern match at PSD3.Shared.TutorialNav (line 32, column 3 - line 34, column 53): " + [v2.constructor.name]);
  };
  var getPrevTutorial = function(currentRoute) {
    var v2 = findIndex(function(r29) {
      return eq10(r29)(currentRoute);
    })(allTutorialRoutes);
    if (v2 instanceof Nothing) {
      return Nothing.value;
    }
    ;
    if (v2 instanceof Just) {
      var $10 = v2.value0 > 0;
      if ($10) {
        return index(allTutorialRoutes)(v2.value0 - 1 | 0);
      }
      ;
      return Nothing.value;
    }
    ;
    throw new Error("Failed pattern match at PSD3.Shared.TutorialNav (line 39, column 3 - line 41, column 82): " + [v2.constructor.name]);
  };
  var renderHeader2 = function(currentRoute) {
    return render4({
      logoSize: Large.value,
      quadrant: NoQuadrant.value,
      prevNext: new Just({
        prev: getPrevTutorial(currentRoute),
        next: getNextTutorial(currentRoute)
      }),
      pageTitle: new Just(show63(currentRoute))
    });
  };

  // output/Component.Tour.TourFPFTW/index.js
  var discard44 = /* @__PURE__ */ discard(discardUnit)(bindHalogenM);
  var pure64 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize24 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var render28 = function(v2) {
    return div2([classes(["tutorial-page"])])([renderHeader2(TourFPFTW.value), main_([section([classes(["tutorial-section", "tutorial-intro"])])([h1([classes(["tutorial-title"])])([text5("Functional Programming For The Win")]), p_([text5("PureScript's powerful type system and functional programming features unlock visualization capabilities that are difficult or impossible in JavaScript. This page showcases how Maps, Sets, Foldable types, and contravariant functors make data visualization more flexible and type-safe.")]), p_([text5('These examples demonstrate the "FP For The Win" philosophy: using advanced functional programming techniques to create more composable, reusable, and maintainable visualization code.')])]), section([classes(["tutorial-section"]), id3("anscombe")])([h2([classes(["tutorial-section-title"])])([text5("1. Anscombe's Quartet: The Power of Map")]), p_([text5("Anscombe's Quartet is a famous dataset demonstrating why visualization matters. All four datasets have "), strong_([text5("identical statistical properties")]), text5(" (mean, variance, correlation \u2248 0.816), but "), strong_([text5("completely different distributions")]), text5(". Statistics can lie; plots don't!")]), p_([text5("This example showcases functional programming's "), em_([text5("map")]), text5(" pattern: we define "), strong_([text5("one scatterplot component")]), text5(" and "), strong_([text5("map it over four datasets")]), text5(". Same code, different data, four visualizations. This is composability in action:")]), pre([classes(["code-block"]), style("background: #f5f5f5; padding: 15px; border-radius: 5px; color: #333; overflow-x: auto;")])([code_([text5("-- One component definition\nscatterplot :: String -> Array Point -> Tree\nscatterplot name points = ...\n\n-- Map over all four datasets!\nmap (\\{ name, points } -> scatterplot name points) anscombeData")])]), div2([id3("anscombe-quartet"), classes(["viz-container"]), style("margin: 20px 0; text-align: center;")])([]), p_([text5("Notice how:")]), ul_([li_([strong_([text5("Dataset I")]), text5(": Linear relationship with some scatter")]), li_([strong_([text5("Dataset II")]), text5(": Perfect quadratic curve")]), li_([strong_([text5("Dataset III")]), text5(": Linear with one outlier skewing statistics")]), li_([strong_([text5("Dataset IV")]), text5(": No relationship except one influential point")])]), p_([text5("The FP win: We wrote the visualization component once and reused it four times. In imperative code, you'd repeat yourself or write complex loops. With "), code_([text5("map")]), text5(", composition is natural and type-safe.")])]), section([classes(["tutorial-section"]), id3("sets")])([h2([classes(["tutorial-section-title"])])([text5("2. Set Operations: Map + Foldable + Phylotaxis")]), p_([text5("Sets are unordered, unique collections. This example demonstrates "), strong_([text5("three FP wins at once")]), text5(":")]), ul_([li_([strong_([text5("Map pattern: ")]), text5("One visualizer component, mapped over four different sets (A, B, A \u222A B, A \u2229 B)")]), li_([strong_([text5("Foldable abstraction: ")]), text5("We iterate over a Set, not an Array! The visualization works with any Foldable type.")]), li_([strong_([text5("Code reuse: ")]), text5("Uses the same phylotaxis (sunflower spiral) layout from our network simulations.")])]), p_([text5("Each set is visualized as colored circles arranged in a phylotaxis pattern (the mathematical arrangement of seeds in a sunflower). Watch how union combines elements and intersection shows only shared elements:")]), div2([id3("set-operations"), classes(["viz-container"]), style("margin: 20px 0; text-align: center;")])([]), p_([text5("The FP win: This visualization demonstrates that PureScript's type classes let you write generic, reusable code. The same phylotaxis layout function works in network graphs "), em_([text5("and")]), text5(" set visualizations. In JavaScript, you'd rewrite it each time.")])]), section([classes(["tutorial-section"]), id3("tree-api-power")])([h2([classes(["tutorial-section-title"])])([text5("3. TreeAPI: A Composable DSL")]), p_([text5("The TreeAPI demonstrates functional programming principles in action. It's a deeply embedded DSL (Domain-Specific Language) that leverages PureScript's type system to provide:")]), ul_([li_([strong_([text5("Composability: ")]), text5("Build complex visualizations from simple, reusable pieces. Trees compose with attributes, which compose with scales and axes.")]), li_([strong_([text5("Type Safety: ")]), text5("The compiler ensures you can't attach circle attributes to rect elements, or pass the wrong data type to a layout.")]), li_([strong_([text5("Multiple Interpretations: ")]), text5("The same TreeAPI code can be interpreted as SVG, Mermaid diagrams, or even generated JavaScript.")]), li_([strong_([text5("Referential Transparency: ")]), text5("Tree descriptions are pure values that can be tested, transformed, and reasoned about before rendering.")])]), p_([text5("For examples of TreeAPI in action, see the "), a([href4("#" + routeToPath(TreeAPI.value))])([text5("Tree API Examples")]), text5(" page, or explore the "), a([href4("#" + routeToPath(AnimatedTreeCluster.value))])([text5("Animated Tree \u2194 Cluster")]), text5(" demonstration which shows how the same tree structure can smoothly transition between different layout algorithms.")])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Why Functional Programming Wins")]), p_([text5("These techniques might seem abstract, but they solve real problems:")]), ul_([li_([strong_([text5("Maintainability: ")]), text5("Type-safe code means fewer runtime errors and easier refactoring.")]), li_([strong_([text5("Reusability: ")]), text5("Contravariant functors and type classes let you write code once and use it with many data types.")]), li_([strong_([text5("Correctness: ")]), text5("The compiler catches bugs that would only appear at runtime in JavaScript.")]), li_([strong_([text5("Expressiveness: ")]), text5("Foldable, Functor, and other abstractions let you express complex data transformations concisely.")])]), p_([text5(`This is why we say "Functional Programming For The Win" - not because it's academically interesting, but because it produces better visualization code that's easier to write, test, and maintain.`)])])])]);
  };
  var handleAction23 = function(dictMonadAff) {
    var liftAff2 = liftAff(monadAffHalogenM(dictMonadAff));
    var liftEffect54 = liftEffect(monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    return function(v2) {
      return discard44(liftAff2(delay(100)))(function() {
        return discard44(liftEffect54(drawAnscombeQuartet("#anscombe-quartet")))(function() {
          return discard44(liftEffect54(drawSetOperations("#set-operations")))(function() {
            return pure64(unit);
          });
        });
      });
    };
  };
  var component24 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render28,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction23(dictMonadAff),
        initialize: new Just(Initialize24.value)
      })
    });
  };

  // output/DataViz.Layout.StateMachine.Layout/index.js
  var foldl19 = /* @__PURE__ */ foldl(foldableArray);
  var min15 = /* @__PURE__ */ min(ordNumber);
  var max20 = /* @__PURE__ */ max(ordNumber);
  var map82 = /* @__PURE__ */ map(functorArray);
  var selfLoopPath = function(config) {
    return function(layoutCenter) {
      return function(pos) {
        var loopRadius = config.selfLoopRadius * 0.5;
        var dy = pos.cy - layoutCenter.cy;
        var dx = pos.cx - layoutCenter.cx;
        var dist = sqrt(dx * dx + dy * dy);
        var outwardAngle = (function() {
          var $28 = dist > 0;
          if ($28) {
            return atan2(dy)(dx);
          }
          ;
          return -pi / 2;
        })();
        var endAngle = outwardAngle + 0.6;
        var endX = pos.cx + pos.rx * cos(endAngle);
        var endY = pos.cy + pos.ry * sin(endAngle);
        var labelX = pos.cx + (pos.rx + loopRadius * 2 + 10) * cos(outwardAngle);
        var labelY = pos.cy + (pos.ry + loopRadius * 2 + 10) * sin(outwardAngle);
        var startAngle = outwardAngle - 0.6;
        var startX = pos.cx + pos.rx * cos(startAngle);
        var startY = pos.cy + pos.ry * sin(startAngle);
        var controlY = pos.cy + (pos.ry + loopRadius * 1.5) * sin(outwardAngle);
        var controlX = pos.cx + (pos.rx + loopRadius * 1.5) * cos(outwardAngle);
        var angle = endAngle - pi / 2;
        return {
          startX,
          startY,
          controlX,
          controlY,
          endX,
          endY,
          labelX,
          labelY,
          angle,
          isSelfLoop: true
        };
      };
    };
  };
  var findStatePosition = function(states) {
    return function(id5) {
      var v2 = filter(function(s3) {
        return s3.state.id === id5;
      })(states);
      if (v2.length === 1) {
        return new Just(v2[0].position);
      }
      ;
      return Nothing.value;
    };
  };
  var defaultPath = {
    startX: 0,
    startY: 0,
    controlX: 0,
    controlY: 0,
    endX: 0,
    endY: 0,
    labelX: 0,
    labelY: 0,
    angle: 0,
    isSelfLoop: false
  };
  var defaultConfig5 = {
    stateRadiusX: 40,
    stateRadiusY: 25,
    layoutRadius: 150,
    margin: 80,
    selfLoopRadius: 50,
    arrowOffset: 3,
    initialArrowLength: 40
  };
  var countParallelTransitions = function(v2) {
    return function(v1) {
      return 0;
    };
  };
  var computeLayoutCenter = function(states) {
    var sumY = foldl19(function(acc) {
      return function(s3) {
        return acc + s3.position.cy;
      };
    })(0)(states);
    var sumX = foldl19(function(acc) {
      return function(s3) {
        return acc + s3.position.cx;
      };
    })(0)(states);
    var n = toNumber(length3(states));
    var $32 = n > 0;
    if ($32) {
      return {
        cx: sumX / n,
        cy: sumY / n
      };
    }
    ;
    return {
      cx: 0,
      cy: 0
    };
  };
  var computeInitialArrow = function(config) {
    return function(states) {
      var v2 = filter(function(s3) {
        return s3.state.isInitial;
      })(states);
      if (v2.length === 1) {
        var x32 = v2[0].position.cx - v2[0].position.rx - config.initialArrowLength;
        return {
          x: x32,
          y: v2[0].position.cy,
          angle: 0
        };
      }
      ;
      return {
        x: 0,
        y: 0,
        angle: 0
      };
    };
  };
  var computeBounds = function(config) {
    return function(states) {
      var updateBounds = function(acc) {
        return function(s3) {
          return {
            minX: min15(acc.minX)(s3.position.cx - s3.position.rx),
            minY: min15(acc.minY)(s3.position.cy - s3.position.ry),
            maxX: max20(acc.maxX)(s3.position.cx + s3.position.rx),
            maxY: max20(acc.maxY)(s3.position.cy + s3.position.ry)
          };
        };
      };
      var initial = {
        minX: 0,
        minY: 0,
        maxX: 0,
        maxY: 0
      };
      var bounds = foldl19(updateBounds)(initial)(states);
      return {
        width: bounds.maxX + config.margin,
        height: bounds.maxY + config.margin
      };
    };
  };
  var circularLayout = function(config) {
    return function(states) {
      var positionState = function(cx25) {
        return function(cy25) {
          return function(step5) {
            return function(idx) {
              return function(state3) {
                var angle = -pi / 2 + toNumber(idx) * step5;
                var position2 = {
                  cx: cx25 + config.layoutRadius * cos(angle),
                  cy: cy25 + config.layoutRadius * sin(angle),
                  rx: config.stateRadiusX,
                  ry: config.stateRadiusY
                };
                return {
                  state: state3,
                  position: position2
                };
              };
            };
          };
        };
      };
      var n = length3(states);
      var centerY = config.layoutRadius + config.margin;
      var centerX = config.layoutRadius + config.margin;
      var angleStep = (function() {
        var $35 = n > 0;
        if ($35) {
          return 2 * pi / toNumber(n);
        }
        ;
        return 0;
      })();
      return mapWithIndex3(positionState(centerX)(centerY)(angleStep))(states);
    };
  };
  var arcPath3 = function(config) {
    return function(from10) {
      return function(to) {
        return function(_offset) {
          var dy = to.cy - from10.cy;
          var dx = to.cx - from10.cx;
          var dist = sqrt(dx * dx + dy * dy);
          var nx = (function() {
            var $37 = dist > 0;
            if ($37) {
              return dx / dist;
            }
            ;
            return 1;
          })();
          var endX = to.cx - nx * (to.rx + config.arrowOffset);
          var startX = from10.cx + nx * (from10.rx + config.arrowOffset);
          var midX = (startX + endX) / 2;
          var ny = (function() {
            var $38 = dist > 0;
            if ($38) {
              return dy / dist;
            }
            ;
            return 0;
          })();
          var endY = to.cy - ny * (to.ry + config.arrowOffset);
          var startY = from10.cy + ny * (from10.ry + config.arrowOffset);
          var midY = (startY + endY) / 2;
          var curveAmount = min15(30)(dist * 0.15);
          var perpX = ny * curveAmount;
          var perpY = -nx * curveAmount;
          var controlY = midY + perpY;
          var labelY = controlY - 8;
          var tangentY = endY - controlY;
          var controlX = midX + perpX;
          var tangentX = endX - controlX;
          var angle = atan2(tangentY)(tangentX);
          return {
            startX,
            startY,
            controlX,
            controlY,
            endX,
            endY,
            labelX: controlX,
            labelY,
            angle,
            isSelfLoop: false
          };
        };
      };
    };
  };
  var layoutTransition = function(config) {
    return function(states) {
      return function(transition3) {
        var toPos = findStatePosition(states)(transition3.to);
        var layoutCenter = computeLayoutCenter(states);
        var fromPos = findStatePosition(states)(transition3.from);
        var path18 = (function() {
          if (fromPos instanceof Just && toPos instanceof Just) {
            var $41 = transition3.from === transition3.to;
            if ($41) {
              return selfLoopPath(config)(layoutCenter)(fromPos.value0);
            }
            ;
            return arcPath3(config)(fromPos.value0)(toPos.value0)(countParallelTransitions(states)(transition3));
          }
          ;
          return defaultPath;
        })();
        return {
          transition: transition3,
          path: path18
        };
      };
    };
  };
  var layoutWithConfig = function(config) {
    return function(layoutFn) {
      return function(machine) {
        var layoutStates = layoutFn(config)(machine.states);
        var layoutTransitions = map82(layoutTransition(config)(layoutStates))(machine.transitions);
        var initialArrow = computeInitialArrow(config)(layoutStates);
        var v2 = computeBounds(config)(layoutStates);
        return {
          states: layoutStates,
          transitions: layoutTransitions,
          width: v2.width,
          height: v2.height,
          initialArrow
        };
      };
    };
  };
  var layout = /* @__PURE__ */ layoutWithConfig(defaultConfig5)(circularLayout);

  // output/DataViz.Layout.StateMachine.Path/index.js
  var max21 = /* @__PURE__ */ max(ordNumber);
  var show64 = /* @__PURE__ */ show(showNumber);
  var stateFinalRing = function(pos) {
    return function(gap) {
      return {
        cx: pos.cx,
        cy: pos.cy,
        rx: max21(0)(pos.rx - gap),
        ry: max21(0)(pos.ry - gap)
      };
    };
  };
  var stateEllipse = function(pos) {
    return {
      cx: pos.cx,
      cy: pos.cy,
      rx: pos.rx,
      ry: pos.ry
    };
  };
  var selfLoopPathD = function(path18) {
    var dy = path18.controlY - path18.startY;
    var dx = path18.controlX - path18.startX;
    var radius = sqrt(dx * dx + dy * dy) * 0.8;
    return "M " + (show64(path18.startX) + (" " + (show64(path18.startY) + (" A " + (show64(radius) + (" " + (show64(radius) + (" 0" + (" 1" + (" 1" + (" " + (show64(path18.endX) + (" " + show64(path18.endY))))))))))))));
  };
  var transitionPathD = function(path18) {
    if (path18.isSelfLoop) {
      return selfLoopPathD(path18);
    }
    ;
    return "M " + (show64(path18.startX) + (" " + (show64(path18.startY) + (" Q " + (show64(path18.controlX) + (" " + (show64(path18.controlY) + (" " + (show64(path18.endX) + (" " + show64(path18.endY)))))))))));
  };
  var initialArrowPathD = function(pos) {
    return function(len) {
      var endY = pos.y + len * sin(pos.angle);
      var endX = pos.x + len * cos(pos.angle);
      return "M " + (show64(pos.x) + (" " + (show64(pos.y) + (" L " + (show64(endX) + (" " + show64(endY)))))));
    };
  };
  var arrowheadPathD = function(tipX) {
    return function(tipY) {
      return function(angle) {
        return function(size6) {
          var backAngle2 = angle + pi + 0.4;
          var backAngle1 = angle + pi - 0.4;
          var back2y = tipY + size6 * sin(backAngle2);
          var back2x = tipX + size6 * cos(backAngle2);
          var back1y = tipY + size6 * sin(backAngle1);
          var back1x = tipX + size6 * cos(backAngle1);
          return "M " + (show64(tipX) + (" " + (show64(tipY) + (" L " + (show64(back1x) + (" " + (show64(back1y) + (" L " + (show64(back2x) + (" " + (show64(back2y) + " Z")))))))))));
        };
      };
    };
  };

  // output/D3.Viz.TreeAPI.StateMachineDiagram/index.js
  var str15 = /* @__PURE__ */ str(stringExprEvalD);
  var v3Attr13 = /* @__PURE__ */ v3Attr(showNumber);
  var lit14 = /* @__PURE__ */ lit(numExprEvalD);
  var bind67 = /* @__PURE__ */ bind(bindD3v2M);
  var select35 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var show65 = /* @__PURE__ */ show(showNumber);
  var map83 = /* @__PURE__ */ map(functorArray);
  var renderTree57 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(ordUnit);
  var pure65 = /* @__PURE__ */ pure(applicativeD3v2M);
  var transitionElement = function(lt2) {
    var pathD = transitionPathD(lt2.path);
    var arrowD = arrowheadPathD(lt2.path.endX)(lt2.path.endY)(lt2.path.angle)(8);
    return withChildren(elem3(Group.value)([]))([elem3(Path.value)([v3AttrStr("d")(str15(pathD)), v3AttrStr("stroke")(str15("#666")), v3Attr13("stroke-width")(lit14(1.5)), v3AttrStr("fill")(str15("none"))]), elem3(Path.value)([v3AttrStr("d")(str15(arrowD)), v3AttrStr("fill")(str15("#666"))]), elem3(Text.value)([v3Attr13("x")(lit14(lt2.path.labelX)), v3Attr13("y")(lit14(lt2.path.labelY)), v3AttrStr("text-anchor")(str15("middle")), v3Attr13("font-size")(lit14(10)), v3AttrStr("fill")(str15("#666")), v3AttrStr("font-style")(str15("italic")), v3AttrStr("textContent")(str15(lt2.transition.label))])]);
  };
  var stateElement = function(ls) {
    var pos = stateEllipse(ls.position);
    return withChildren(elem3(Group.value)([]))(concat([[elem3(Circle.value)([v3Attr13("cx")(lit14(pos.cx)), v3Attr13("cy")(lit14(pos.cy)), v3Attr13("r")(lit14(pos.rx)), v3AttrStr("fill")(str15((function() {
      if (ls.state.isInitial) {
        return "#e8f5e9";
      }
      ;
      if (ls.state.isFinal) {
        return "#fff3e0";
      }
      ;
      return "#e3f2fd";
    })())), v3AttrStr("stroke")(str15((function() {
      if (ls.state.isInitial) {
        return "#4caf50";
      }
      ;
      if (ls.state.isFinal) {
        return "#ff9800";
      }
      ;
      return "#2196f3";
    })())), v3Attr13("stroke-width")(lit14(2))])], (function() {
      if (ls.state.isFinal) {
        var inner = stateFinalRing(ls.position)(5);
        return [elem3(Circle.value)([v3Attr13("cx")(lit14(inner.cx)), v3Attr13("cy")(lit14(inner.cy)), v3Attr13("r")(lit14(inner.rx)), v3AttrStr("fill")(str15("none")), v3AttrStr("stroke")(str15("#ff9800")), v3Attr13("stroke-width")(lit14(2))])];
      }
      ;
      return [];
    })(), [elem3(Text.value)([v3Attr13("x")(lit14(pos.cx)), v3Attr13("y")(lit14(pos.cy)), v3AttrStr("text-anchor")(str15("middle")), v3AttrStr("dominant-baseline")(str15("middle")), v3Attr13("font-size")(lit14(11)), v3AttrStr("fill")(str15("#333")), v3AttrStr("textContent")(str15(ls.state.label))])]]));
  };
  var phantomTypesMachine = {
    states: [{
      id: "start",
      label: "Unselected",
      isInitial: true,
      isFinal: false,
      extra: "No selection exists yet"
    }, {
      id: "selected",
      label: "Selected\n(Bindable, Bindable)",
      isInitial: false,
      isFinal: false,
      extra: "Selection exists, no data bound"
    }, {
      id: "bound",
      label: "Data Bound\n(Binds, Bindable)",
      isInitial: false,
      isFinal: false,
      extra: "Data bound, can enter/update"
    }, {
      id: "entered",
      label: "Entered\n(Binds, Binds)",
      isInitial: false,
      isFinal: false,
      extra: "In enter selection"
    }, {
      id: "rendered",
      label: "Rendered",
      isInitial: false,
      isFinal: true,
      extra: "Elements in DOM, Effect produced"
    }],
    transitions: [{
      from: "start",
      to: "selected",
      label: "select"
    }, {
      from: "selected",
      to: "bound",
      label: "bindData"
    }, {
      from: "bound",
      to: "entered",
      label: "enter"
    }, {
      from: "entered",
      to: "entered",
      label: "attr / style"
    }, {
      from: "entered",
      to: "rendered",
      label: "interpret"
    }, {
      from: "bound",
      to: "bound",
      label: "update attrs"
    }]
  };
  var startStateMachine = function(selector) {
    var laid = layout(phantomTypesMachine);
    var config = {
      width: laid.width,
      height: laid.height
    };
    return runD3v2M(bind67(select35(selector))(function(container) {
      var tree2 = withChildren(named(SVG.value)("svg")([v3Attr13("width")(lit14(config.width)), v3Attr13("height")(lit14(config.height)), v3AttrStr("viewBox")(str15("0 0 " + (show65(config.width) + (" " + show65(config.height))))), v3AttrStr("class")(str15("state-machine-diagram")), v3AttrStr("style")(str15("font-family: monospace;"))]))([withChild(elem3(Defs.value)([]))(named(Group.value)("arrow-marker")([v3AttrStr("id")(str15("arrowhead"))])), withChildren(named(Group.value)("transitions")([v3AttrStr("class")(str15("transitions"))]))(map83(transitionElement)(laid.transitions)), withChildren(named(Group.value)("states")([v3AttrStr("class")(str15("states"))]))(map83(stateElement)(laid.states)), withChildren(elem3(Group.value)([]))([elem3(Path.value)([v3AttrStr("d")(str15(initialArrowPathD(laid.initialArrow)(35))), v3AttrStr("stroke")(str15("#333")), v3Attr13("stroke-width")(lit14(2)), v3AttrStr("fill")(str15("none")), v3AttrStr("marker-end")(str15("url(#arrowhead-marker)"))]), elem3(Path.value)([v3AttrStr("d")(str15(arrowheadPathD(laid.initialArrow.x + 35)(laid.initialArrow.y)(0)(8))), v3AttrStr("fill")(str15("#333"))])])]);
      return bind67(renderTree57(container)(tree2))(function() {
        return pure65(unit);
      });
    }));
  };

  // output/Component.Tour.TourFlow/index.js
  var discard45 = /* @__PURE__ */ discard(discardUnit)(bindHalogenM);
  var bind68 = /* @__PURE__ */ bind(bindHalogenM);
  var Initialize25 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var render29 = function(v2) {
    return div2([classes(["tutorial-page"])])([renderHeader2(TourFlow.value), main_([section([classes(["tutorial-section", "tutorial-intro"])])([h1([classes(["tutorial-title"])])([text5("3. Data Flow")]), p_([text5("Chord and Sankey diagrams are specialized visualizations for showing relationships and flows between entities. Both use visual metaphors - ribbons and flows - to make complex interconnections immediately comprehensible.")]), p_([text5("These visualization types excel at revealing patterns in network data, resource flows, and dependencies that would be difficult to understand in tabular form.")])]), section([classes(["tutorial-section"]), id3("chord")])([h2([classes(["tutorial-section-title"])])([text5("1. Chord Diagram: Traffic Flow Analysis")]), p_([text5("Chord diagrams show bidirectional relationships and flows between entities in a circular layout. They're particularly effective for displaying interconnected systems where flow goes in both directions between pairs.")]), p_([text5("This example shows traffic flow between 11 regions in Baton Rouge, Louisiana, supporting analysis for a new bridge location. Each arc represents a region, and the ribbons show the volume of trips between region pairs. Ribbons are colored by their origin region, making it easy to trace outbound traffic from each area.")]), div2([id3("chord-container"), classes(["viz-container"])])([]), p_([text5("Inspired by "), a([href4("https://www.streetlightdata.com/planning-bridges-louisiana/"), target6("_blank")])([text5("StreetLight Data's bridge planning analysis")]), text5(". The circular layout reveals dominant traffic patterns - notice how West Baton Rouge (WBR, in red) and East Baton Rouge Main (EBR-M, in teal) serve as major hubs with thick ribbons to multiple regions.")])]), section([classes(["tutorial-section"]), id3("sankey")])([h2([classes(["tutorial-section-title"])])([text5("2. Sankey Diagram: Flow Visualization")]), p_([text5("Sankey diagrams visualize the flow of resources, energy, costs, or other quantities through a system. The width of each connection is proportional to the flow quantity, making it easy to identify dominant flows and inefficiencies.")]), p_([text5("This diagram shows energy flows in the UK energy system, from primary energy sources through transformation and distribution to final consumption. The Sankey layout uses a pure PureScript algorithm (not D3 FFI) that automatically positions nodes and creates smooth flow paths.")]), div2([id3("sankey-container"), classes(["viz-container"])])([]), p_([text5("The width of each flow represents the quantity of energy. Notice how the diagram reveals energy losses in transformation processes and highlights which sources contribute most to final consumption.")])]), section([classes(["tutorial-section"]), id3("statemachine")])([h2([classes(["tutorial-section-title"])])([text5("3. State Machine: Type-Safe Transitions")]), p_([text5("State machine diagrams visualize the valid states and transitions in a system. This example shows the phantom type state machine that underlies PSD3's Selection API - demonstrating how the library ensures type-safe D3 operations at compile time.")]), p_([text5("Each state represents a configuration of phantom type parameters. Transitions are the API operations that move between states. The type system prevents invalid transitions - you can't call "), code_([text5("enter")]), text5(" before "), code_([text5("bindData")]), text5(", because the phantom types won't unify.")]), div2([id3("statemachine-container"), classes(["viz-container"])])([]), p_([text5("This state machine layout is computed purely in PureScript using the new "), code_([text5("DataViz.Layout.StateMachine")]), text5(" module. States are arranged in a circular layout with curved arrow paths for transitions. Self-loops (like "), code_([text5("attr")]), text5(" on the Entered state) use bezier curves.")])])])]);
  };
  var handleAction24 = function(dictMonadAff) {
    var liftAff2 = liftAff(monadAffHalogenM(dictMonadAff));
    var liftEffect54 = liftEffect(monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    return function(v2) {
      return discard45(liftAff2(delay(100)))(function() {
        return bind68(liftAff2(simpleLoadText("./data/energy.csv")))(function(csvText) {
          return discard45(liftEffect54(startSankey(csvText)("#sankey-container")))(function() {
            return discard45(liftEffect54(startChord("#chord-container")))(function() {
              return liftEffect54(startStateMachine("#statemachine-container"));
            });
          });
        });
      });
    };
  };
  var component25 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render29,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction24(dictMonadAff),
        initialize: new Just(Initialize25.value)
      })
    });
  };

  // output/D3.Viz.TreeAPI.ParabolaNoAxes/index.js
  var bind69 = /* @__PURE__ */ bind(bindD3v2M);
  var select36 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var width35 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var num27 = /* @__PURE__ */ num(numExprEvalD);
  var height35 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr32 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text33 = /* @__PURE__ */ text6(stringExprEvalD);
  var cx15 = /* @__PURE__ */ cx(toAttributeValueNumber);
  var cy15 = /* @__PURE__ */ cy(toAttributeValueNumber);
  var r17 = /* @__PURE__ */ r(toAttributeValueNumber);
  var fill28 = /* @__PURE__ */ fill(toAttributeValueString);
  var renderTree58 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(/* @__PURE__ */ ordRecord()(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(ordRecordNil)()({
    reflectSymbol: function() {
      return "y";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "x";
    }
  })(ordNumber)));
  var liftEffect38 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var lookup28 = /* @__PURE__ */ lookup(ordString);
  var parabolaData2 = /* @__PURE__ */ (function() {
    var makePoint = function(i2) {
      var x32 = toNumber(i2);
      var y32 = x32 * x32;
      return {
        x: x32,
        y: y32
      };
    };
    return map(functorArray)(makePoint)(range2(0)(9));
  })();
  var parabolaNoAxes = function(selector) {
    return runD3v2M(bind69(select36(selector))(function(container) {
      var plotHeight = 200 - 2 * 30;
      var plotWidth = 400 - 2 * 30;
      var scaleX5 = function(x32) {
        return 30 + x32 / 9 * plotWidth;
      };
      var scaleY5 = function(y32) {
        return 200 - 30 - y32 / 81 * plotHeight;
      };
      var tree2 = withChild(named(SVG.value)("svg")([width35(num27(400)), height35(num27(200)), viewBox(0)(0)(400)(200), attr32("id")(text33("parabola-no-axes-svg")), attr32("class")(text33("tree-api-example"))]))(joinData("circles")("circle")(parabolaData2)(function(d) {
        return elem3(Circle.value)([cx15(num27(scaleX5(d.x))), cy15(num27(scaleY5(d.y))), r17(num27(5)), fill28(text33("green"))]);
      }));
      return bind69(renderTree58(container)(tree2))(function(selections) {
        return liftEffect38(function __do7() {
          log2("=== Parabola (No Axes) ===")();
          log2("")();
          log2("Data: 10 points where y = x\xB2")();
          log2("Result: 10 circles forming a parabola")();
          log2("")();
          (function() {
            var v2 = lookup28("circles")(selections);
            if (v2 instanceof Just) {
              return log2("\u2713 Circles positioned by data (y = x\xB2)")();
            }
            ;
            if (v2 instanceof Nothing) {
              return log2("\u2717 Missing circles")();
            }
            ;
            throw new Error("Failed pattern match at D3.Viz.TreeAPI.ParabolaNoAxes (line 90, column 5 - line 92, column 49): " + [v2.constructor.name]);
          })();
          log2("")();
          log2("The key concept: Position is a function of the data.")();
          log2("Each point (x, y) where y = x\xB2 gets mapped to a circle.")();
          log2("We can see the mathematical relationship visually!")();
          return log2("")();
        });
      });
    }));
  };

  // output/D3.Viz.TreeAPI.ParabolaWithAxes/index.js
  var bind70 = /* @__PURE__ */ bind(bindD3v2M);
  var select37 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var width36 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var num28 = /* @__PURE__ */ num(numExprEvalD);
  var height36 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr33 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text34 = /* @__PURE__ */ text6(stringExprEvalD);
  var transform12 = /* @__PURE__ */ transform2(toAttributeValueString);
  var show66 = /* @__PURE__ */ show(showNumber);
  var cx16 = /* @__PURE__ */ cx(toAttributeValueNumber);
  var cy16 = /* @__PURE__ */ cy(toAttributeValueNumber);
  var r18 = /* @__PURE__ */ r(toAttributeValueNumber);
  var fill29 = /* @__PURE__ */ fill(toAttributeValueString);
  var renderTree59 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(/* @__PURE__ */ ordRecord()(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(ordRecordNil)()({
    reflectSymbol: function() {
      return "y";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "x";
    }
  })(ordNumber)));
  var liftEffect39 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var lookup29 = /* @__PURE__ */ lookup(ordString);
  var parabolaData3 = /* @__PURE__ */ (function() {
    var makePoint = function(i2) {
      var x32 = toNumber(i2);
      var y32 = x32 * x32;
      return {
        x: x32,
        y: y32
      };
    };
    return map(functorArray)(makePoint)(range2(0)(9));
  })();
  var parabolaWithAxes = function(selector) {
    return runD3v2M(bind70(select37(selector))(function(container) {
      var margin = {
        top: 20,
        right: 20,
        bottom: 50,
        left: 60
      };
      var plotHeight = 200 - margin.top - margin.bottom;
      var yScale = {
        domain: {
          min: 0,
          max: 81
        },
        range: {
          min: plotHeight,
          max: 0
        }
      };
      var scaleY5 = function(value20) {
        var rangeSpan = yScale.range.max - yScale.range.min;
        var domainSpan = yScale.domain.max - yScale.domain.min;
        var normalized = (value20 - yScale.domain.min) / domainSpan;
        return yScale.range.min + normalized * rangeSpan;
      };
      var plotWidth = 400 - margin.left - margin.right;
      var xScale = {
        domain: {
          min: 0,
          max: 9
        },
        range: {
          min: 0,
          max: plotWidth
        }
      };
      var scaleX5 = function(value20) {
        var rangeSpan = xScale.range.max - xScale.range.min;
        var domainSpan = xScale.domain.max - xScale.domain.min;
        var normalized = (value20 - xScale.domain.min) / domainSpan;
        return xScale.range.min + normalized * rangeSpan;
      };
      var tree2 = withChild(named(SVG.value)("svg")([width36(num28(400)), height36(num28(200)), viewBox(0)(0)(400)(200), attr33("id")(text34("parabola-with-axes-svg")), attr33("class")(text34("tree-api-example"))]))(withChildren(named(Group.value)("plot-area")([transform12(text34("translate(" + (show66(margin.left) + ("," + (show66(margin.top) + ")"))))), attr33("class")(text34("plot-area"))]))([withChild(named(Group.value)("x-axis")([transform12(text34("translate(0," + (show66(plotHeight) + ")"))), attr33("class")(text34("x-axis"))]))(renderAxis(axisBottom(xScale))), withChild(named(Group.value)("y-axis")([attr33("class")(text34("y-axis"))]))(renderAxis(axisLeft(yScale))), joinData("circles")("circle")(parabolaData3)(function(d) {
        return elem3(Circle.value)([cx16(num28(scaleX5(d.x))), cy16(num28(scaleY5(d.y))), r18(num28(5)), fill29(text34("green"))]);
      })]));
      return bind70(renderTree59(container)(tree2))(function(selections) {
        return liftEffect39(function __do7() {
          log2("=== Parabola (With Axes) ===")();
          log2("")();
          log2("Data: 10 points where y = x\xB2")();
          log2("Result: Parabola with labeled axes")();
          log2("")();
          (function() {
            var v2 = lookup29("circles")(selections);
            if (v2 instanceof Just) {
              return log2("\u2713 Circles positioned using scales")();
            }
            ;
            if (v2 instanceof Nothing) {
              return log2("\u2717 Missing circles")();
            }
            ;
            throw new Error("Failed pattern match at D3.Viz.TreeAPI.ParabolaWithAxes (line 119, column 5 - line 121, column 49): " + [v2.constructor.name]);
          })();
          log2("")();
          log2("Key concepts introduced:")();
          log2("  - SCALES: Map data values to pixel positions")();
          log2("  - AXES: Visual reference showing the scale")();
          log2("")();
          log2("The x-axis shows values 0-9, y-axis shows 0-81.")();
          log2("Now we can see exactly what the data values are!")();
          return log2("")();
        });
      });
    }));
  };

  // output/D3.Viz.TreeAPI.ThreeLittleCirclesColored/index.js
  var bind71 = /* @__PURE__ */ bind(bindD3v2M);
  var select38 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var width37 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var num29 = /* @__PURE__ */ num(numExprEvalD);
  var height37 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr34 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text35 = /* @__PURE__ */ text6(stringExprEvalD);
  var cx17 = /* @__PURE__ */ cx(toAttributeValueNumber);
  var cy17 = /* @__PURE__ */ cy(toAttributeValueNumber);
  var r19 = /* @__PURE__ */ r(toAttributeValueNumber);
  var fill30 = /* @__PURE__ */ fill(toAttributeValueString);
  var renderTree60 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(/* @__PURE__ */ ordRecord()(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(ordRecordNil)()({
    reflectSymbol: function() {
      return "index";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "color";
    }
  })(ordString)));
  var liftEffect40 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var lookup30 = /* @__PURE__ */ lookup(ordString);
  var colorData = [{
    color: "red",
    index: 0
  }, {
    color: "green",
    index: 1
  }, {
    color: "blue",
    index: 2
  }];
  var threeLittleCirclesColored = function(selector) {
    return runD3v2M(bind71(select38(selector))(function(container) {
      var tree2 = withChild(named(SVG.value)("svg")([width37(num29(400)), height37(num29(100)), viewBox(0)(0)(400)(100), attr34("id")(text35("three-circles-colored-svg")), attr34("class")(text35("tree-api-example"))]))(joinData("circles")("circle")(colorData)(function(d) {
        return elem3(Circle.value)([cx17(num29(100 + d.index * 100)), cy17(num29(50)), r19(num29(25)), fill30(text35(d.color))]);
      }));
      return bind71(renderTree60(container)(tree2))(function(selections) {
        return liftEffect40(function __do7() {
          log2("=== Three Colored Circles ===")();
          log2("")();
          log2("Data: ['red', 'green', 'blue']")();
          log2("Result: 3 circles, each with its data-driven color")();
          log2("")();
          (function() {
            var v2 = lookup30("circles")(selections);
            if (v2 instanceof Just) {
              return log2("\u2713 Circles created with data-driven colors")();
            }
            ;
            if (v2 instanceof Nothing) {
              return log2("\u2717 Missing circles")();
            }
            ;
            throw new Error("Failed pattern match at D3.Viz.TreeAPI.ThreeLittleCirclesColored (line 71, column 5 - line 73, column 49): " + [v2.constructor.name]);
          })();
          log2("")();
          log2("The key concept: Attributes can be FUNCTIONS of the data.")();
          log2("Here, fill d.color means each circle gets its color from its datum.")();
          log2("This is the foundation of data visualization: visual encoding of data.")();
          return log2("")();
        });
      });
    }));
  };

  // output/D3.Viz.TreeAPI.ThreeLittleCirclesGreen/index.js
  var bind72 = /* @__PURE__ */ bind(bindD3v2M);
  var select39 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var width38 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var num30 = /* @__PURE__ */ num(numExprEvalD);
  var height38 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr35 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text36 = /* @__PURE__ */ text6(stringExprEvalD);
  var cx18 = /* @__PURE__ */ cx(toAttributeValueNumber);
  var cy18 = /* @__PURE__ */ cy(toAttributeValueNumber);
  var r20 = /* @__PURE__ */ r(toAttributeValueNumber);
  var fill31 = /* @__PURE__ */ fill(toAttributeValueString);
  var renderTree61 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(/* @__PURE__ */ ordRecord()(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(ordRecordNil)()({
    reflectSymbol: function() {
      return "label";
    }
  })(ordString))()({
    reflectSymbol: function() {
      return "index";
    }
  })(ordNumber)));
  var liftEffect41 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var lookup31 = /* @__PURE__ */ lookup(ordString);
  var simpleData = [{
    label: "a",
    index: 0
  }, {
    label: "b",
    index: 1
  }, {
    label: "c",
    index: 2
  }];
  var threeLittleCirclesGreen = function(selector) {
    return runD3v2M(bind72(select39(selector))(function(container) {
      var tree2 = withChild(named(SVG.value)("svg")([width38(num30(400)), height38(num30(100)), viewBox(0)(0)(400)(100), attr35("id")(text36("three-circles-green-svg")), attr35("class")(text36("tree-api-example"))]))(joinData("circles")("circle")(simpleData)(function(d) {
        return elem3(Circle.value)([cx18(num30(100 + d.index * 100)), cy18(num30(50)), r20(num30(25)), fill31(text36("green"))]);
      }));
      return bind72(renderTree61(container)(tree2))(function(selections) {
        return liftEffect41(function __do7() {
          log2("=== Three Little Circles (Green) ===")();
          log2("")();
          log2("Data: ['a', 'b', 'c']")();
          log2("Result: 3 green circles")();
          log2("")();
          (function() {
            var v2 = lookup31("circles")(selections);
            if (v2 instanceof Just) {
              return log2("\u2713 Circles created via data join")();
            }
            ;
            if (v2 instanceof Nothing) {
              return log2("\u2717 Missing circles")();
            }
            ;
            throw new Error("Failed pattern match at D3.Viz.TreeAPI.ThreeLittleCirclesGreen (line 70, column 5 - line 72, column 49): " + [v2.constructor.name]);
          })();
          log2("")();
          log2("The key concept: one circle per datum, positioned by index.")();
          log2("The datum content ('a', 'b', 'c') doesn't matter here -")();
          log2("what matters is that we have THREE pieces of data.")();
          return log2("")();
        });
      });
    }));
  };

  // output/Component.Tour.TourFoundations/index.js
  var show67 = /* @__PURE__ */ show(showNumber);
  var map84 = /* @__PURE__ */ map(functorArray);
  var discard46 = /* @__PURE__ */ discard(discardUnit)(bindHalogenM);
  var pure66 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize26 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var renderDatasetTable = function(name16) {
    return function(points) {
      var renderRow = function(p2) {
        return tr_([td_([text5(show67(p2.x))]), td_([text5(show67(p2.y))])]);
      };
      return div2([classes(["dataset-table-container"])])([h4([classes(["dataset-table-title"])])([text5("Dataset " + name16)]), table([classes(["dataset-table"])])([thead_([tr_([th_([text5("x")]), th_([text5("y")])])]), tbody_(map84(renderRow)(points))])]);
    };
  };
  var handleAction25 = function(dictMonadAff) {
    var liftEffect54 = liftEffect(monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    return function(v2) {
      return discard46(liftEffect54(threeLittleCirclesGreen("#three-circles-green-viz")))(function() {
        return discard46(liftEffect54(threeLittleCirclesColored("#three-circles-colored-viz")))(function() {
          return discard46(liftEffect54(parabolaNoAxes("#parabola-no-axes-viz")))(function() {
            return discard46(liftEffect54(parabolaWithAxes("#parabola-with-axes-viz")))(function() {
              return discard46(liftEffect54(anscombesQuartet("#anscombes-quartet-viz")))(function() {
                return pure66(unit);
              });
            });
          });
        });
      });
    };
  };
  var datasetD = [{
    x: 8,
    y: 6.58
  }, {
    x: 8,
    y: 5.76
  }, {
    x: 8,
    y: 7.71
  }, {
    x: 8,
    y: 8.84
  }, {
    x: 8,
    y: 8.47
  }, {
    x: 8,
    y: 7.04
  }, {
    x: 8,
    y: 5.25
  }, {
    x: 19,
    y: 12.5
  }, {
    x: 8,
    y: 5.56
  }, {
    x: 8,
    y: 7.91
  }, {
    x: 8,
    y: 6.89
  }];
  var datasetC = [{
    x: 10,
    y: 7.46
  }, {
    x: 8,
    y: 6.77
  }, {
    x: 13,
    y: 12.74
  }, {
    x: 9,
    y: 7.11
  }, {
    x: 11,
    y: 7.81
  }, {
    x: 14,
    y: 8.84
  }, {
    x: 6,
    y: 6.08
  }, {
    x: 4,
    y: 5.39
  }, {
    x: 12,
    y: 8.15
  }, {
    x: 7,
    y: 6.42
  }, {
    x: 5,
    y: 5.73
  }];
  var datasetB = [{
    x: 10,
    y: 9.14
  }, {
    x: 8,
    y: 8.14
  }, {
    x: 13,
    y: 8.74
  }, {
    x: 9,
    y: 8.77
  }, {
    x: 11,
    y: 9.26
  }, {
    x: 14,
    y: 8.1
  }, {
    x: 6,
    y: 6.13
  }, {
    x: 4,
    y: 3.1
  }, {
    x: 12,
    y: 9.13
  }, {
    x: 7,
    y: 7.26
  }, {
    x: 5,
    y: 4.74
  }];
  var datasetA = [{
    x: 10,
    y: 8.04
  }, {
    x: 8,
    y: 6.95
  }, {
    x: 13,
    y: 7.58
  }, {
    x: 9,
    y: 8.81
  }, {
    x: 11,
    y: 8.33
  }, {
    x: 14,
    y: 9.96
  }, {
    x: 6,
    y: 7.24
  }, {
    x: 4,
    y: 4.26
  }, {
    x: 12,
    y: 10.84
  }, {
    x: 7,
    y: 4.82
  }, {
    x: 5,
    y: 5.68
  }];
  var render30 = function(v2) {
    return div2([classes(["tutorial-page"])])([renderHeader2(TourFoundations.value), main_([section([classes(["tutorial-section", "tutorial-intro"])])([h1([classes(["tutorial-title"])])([text5("1. Foundations: Data to Visualization")]), p_([text5("The fundamental principle of data visualization is simple: start with data, create visual elements from that data. This page shows the progression from the most trivial example (three pieces of data \u2192 three circles) to a classic demonstration of why visualization matters (Anscombe's Quartet).")]), p_([text5("Each step adds one concept, building your understanding incrementally. If you're familiar with D3.js, the TreeAPI will feel natural but with type safety and composability.")])]), section([classes(["tutorial-section"]), id3("three-circles-green")])([h2([classes(["tutorial-section-title"])])([text5("1. Three Little Circles")]), p_([text5("The most minimal example: three pieces of data ['a', 'b', 'c'] \u2192 three green circles. The data doesn't need to be numbers - it can be anything. We just create one circle for each datum and use the index to position them horizontally.")]), div2([classes(["tutorial-viz-container"])])([div2([id3("three-circles-green-viz"), classes(["three-circles-green-viz"])])([])]), p([classes(["code-highlight"])])([text5("Key: "), code_([text5('joinData "circles" "circle" ["a", "b", "c"] $ \\d -> ...')])])]), section([classes(["tutorial-section"]), id3("three-circles-colored")])([h2([classes(["tutorial-section-title"])])([text5("2. Three Colored Circles")]), p_([text5("Same structure, different data: ['red', 'green', 'blue'] \u2192 three circles, each colored by its datum. This shows how attributes can be functions of the data - the fill color comes directly from the datum itself.")]), div2([classes(["tutorial-viz-container"])])([div2([id3("three-circles-colored-viz"), classes(["three-circles-colored-viz"])])([])]), p([classes(["code-highlight"])])([text5("Key: "), code_([text5("fill d.color")]), text5(" \u2014 attribute comes from datum")])]), section([classes(["tutorial-section"]), id3("parabola-no-axes")])([h2([classes(["tutorial-section-title"])])([text5("3. Data-Driven Positioning: Parabola")]), p_([text5("Ten circles forming a parabola. Now the y-position comes from the datum itself - we compute y = x\xB2 for each point. Still just green circles, but positioned by a mathematical relationship in the data.")]), div2([classes(["tutorial-viz-container"])])([div2([id3("parabola-no-axes-viz"), classes(["parabola-no-axes-viz"])])([])]), p([classes(["code-highlight"])])([text5("Key: "), code_([text5("let y = x * x")]), text5(" then "), code_([text5("cy (scaleY y)")])])]), section([classes(["tutorial-section"]), id3("parabola-with-axes")])([h2([classes(["tutorial-section-title"])])([text5("4. Adding Context: Axes and Scales")]), p_([text5("Same parabola, but now with axes to show the actual values. This introduces scales (mapping data space to pixel space) and axes (visual representation of those scales). These are fundamental tools for any real visualization.")]), div2([classes(["tutorial-viz-container"])])([div2([id3("parabola-with-axes-viz"), classes(["parabola-with-axes-viz"])])([])]), p([classes(["code-highlight"])])([text5("Key: "), code_([text5("axisBottom xScale")]), text5(" and "), code_([text5("axisLeft yScale")])])]), section([classes(["tutorial-section"]), id3("anscombes-quartet")])([h2([classes(["tutorial-section-title"])])([text5("5. Why Visualization Matters: Anscombe's Quartet")]), p_([text5("Four datasets with identical statistical properties (mean, variance, correlation) but completely different distributions. This is the classic demonstration of why you need to visualize data - summary statistics alone can be misleading.")]), p_([text5("The table shows how all four datasets have nearly identical statistics:")]), table([classes(["stats-table"])])([thead_([tr_([th_([text5("Dataset")]), th_([text5("Mean X")]), th_([text5("Mean Y")]), th_([text5("Var X")]), th_([text5("Var Y")]), th_([text5("Correlation")])])]), tbody_([tr_([td_([strong_([text5("A")])]), td_([text5("9.0")]), td_([text5("7.5")]), td_([text5("11.0")]), td_([text5("4.1")]), td_([text5("0.82")])]), tr_([td_([strong_([text5("B")])]), td_([text5("9.0")]), td_([text5("7.5")]), td_([text5("11.0")]), td_([text5("4.1")]), td_([text5("0.82")])]), tr_([td_([strong_([text5("C")])]), td_([text5("9.0")]), td_([text5("7.5")]), td_([text5("11.0")]), td_([text5("4.1")]), td_([text5("0.82")])]), tr_([td_([strong_([text5("D")])]), td_([text5("9.0")]), td_([text5("7.5")]), td_([text5("11.0")]), td_([text5("4.1")]), td_([text5("0.82")])])])]), p_([text5("Yet when visualized, the patterns are completely different: linear relationship (A), curved relationship (B), linear with outlier (C), and vertical line with outlier (D).")]), p_([text5("Here are the complete datasets - notice how different the patterns are when you see all the points:")]), div2([classes(["anscombe-data-tables"])])([renderDatasetTable("A")(datasetA), renderDatasetTable("B")(datasetB), renderDatasetTable("C")(datasetC), renderDatasetTable("D")(datasetD)]), div2([classes(["tutorial-viz-container"])])([div2([id3("anscombes-quartet-viz"), classes(["anscombes-quartet-viz"])])([])]), p_([text5("This example demonstrates why data visualization exists: numbers alone don't tell the story. You need to see the data to understand it.")])])])]);
  };
  var component26 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render30,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction25(dictMonadAff),
        initialize: new Just(Initialize26.value)
      })
    });
  };

  // output/PSD3.Data.Tree/index.js
  var Radial2 = /* @__PURE__ */ (function() {
    function Radial3() {
    }
    ;
    Radial3.value = new Radial3();
    return Radial3;
  })();
  var Horizontal = /* @__PURE__ */ (function() {
    function Horizontal2() {
    }
    ;
    Horizontal2.value = new Horizontal2();
    return Horizontal2;
  })();
  var Vertical = /* @__PURE__ */ (function() {
    function Vertical2() {
    }
    ;
    Vertical2.value = new Vertical2();
    return Vertical2;
  })();

  // output/PSD3.Data.DAGTree/index.js
  var bind73 = /* @__PURE__ */ bind(bindMaybe);
  var pure67 = /* @__PURE__ */ pure(applicativeMaybe);
  var foldl20 = /* @__PURE__ */ foldl(foldableArray);
  var max22 = /* @__PURE__ */ max(ordInt);
  var map85 = /* @__PURE__ */ map(functorArray);
  var toUnfoldable10 = /* @__PURE__ */ toUnfoldable(unfoldableArray);
  var append34 = /* @__PURE__ */ append(semigroupArray);
  var resolveExtraLinks = function(dictOrd) {
    var lookup36 = lookup(dictOrd);
    return function(links3) {
      return function(nodeMap) {
        var resolve = function(link5) {
          return bind73(lookup36(link5.source)(nodeMap))(function(source3) {
            return bind73(lookup36(link5.target)(nodeMap))(function(target7) {
              return pure67({
                source: source3,
                target: target7,
                linkType: link5.linkType
              });
            });
          });
        };
        return mapMaybe(resolve)(links3);
      };
    };
  };
  var maxDepth = function(tree2) {
    var go2 = function(d) {
      return function(t2) {
        var children3 = tail(t2);
        var v2 = uncons(children3);
        if (v2 instanceof Nothing) {
          return d;
        }
        ;
        if (v2 instanceof Just) {
          return foldl20(max22)(d)(map85(go2(d + 1 | 0))(toUnfoldable10(children3)));
        }
        ;
        throw new Error("Failed pattern match at PSD3.Data.DAGTree (line 251, column 10 - line 253, column 89): " + [v2.constructor.name]);
      };
    };
    return go2(0)(tree2);
  };
  var layoutTree = function(layout2) {
    return function(size6) {
      return function(tree2) {
        var go2 = function(depth) {
          return function(xMin) {
            return function(xMax) {
              return function(t2) {
                var xFraction = (xMin + xMax) / 2;
                var y32 = (function() {
                  if (layout2 instanceof Vertical) {
                    return toNumber(depth) * (size6.height / toNumber(maxDepth(tree2) + 1 | 0));
                  }
                  ;
                  if (layout2 instanceof Horizontal) {
                    return xFraction * size6.height;
                  }
                  ;
                  if (layout2 instanceof Radial2) {
                    return toNumber(depth) * 50;
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Data.DAGTree (line 220, column 13 - line 223, column 44): " + [layout2.constructor.name]);
                })();
                var x32 = (function() {
                  if (layout2 instanceof Vertical) {
                    return xFraction * size6.width;
                  }
                  ;
                  if (layout2 instanceof Horizontal) {
                    return toNumber(depth) * (size6.width / toNumber(maxDepth(tree2) + 1 | 0));
                  }
                  ;
                  if (layout2 instanceof Radial2) {
                    return xFraction * size6.width;
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Data.DAGTree (line 216, column 13 - line 219, column 43): " + [layout2.constructor.name]);
                })();
                var datum2 = head(t2);
                var positioned = {
                  datum: datum2,
                  x: x32,
                  y: y32,
                  depth
                };
                var children3 = tail(t2);
                var childCount = length(children3);
                var childWidth = (xMax - xMin) / toNumber(max22(1)(childCount));
                var layoutChildren = function(v2) {
                  return function(v1) {
                    if (v1 instanceof Nil) {
                      return Nil.value;
                    }
                    ;
                    if (v1 instanceof Cons) {
                      var childXMin = xMin + toNumber(v2) * childWidth;
                      var childXMax = childXMin + childWidth;
                      var positioned$prime = go2(depth + 1 | 0)(childXMin)(childXMax)(v1.value0);
                      return new Cons(positioned$prime, layoutChildren(v2 + 1 | 0)(v1.value1));
                    }
                    ;
                    throw new Error("Failed pattern match at PSD3.Data.DAGTree (line 231, column 9 - line 231, column 89): " + [v2.constructor.name, v1.constructor.name]);
                  };
                };
                var positionedChildren = layoutChildren(0)(children3);
                return mkTree(positioned)(positionedChildren);
              };
            };
          };
        };
        return go2(0)(0)(1)(tree2);
      };
    };
  };
  var flattenPositioned = function(tree2) {
    var go2 = function(acc) {
      return function(t2) {
        var node = head(t2);
        var children3 = tail(t2);
        var childArray = toUnfoldable10(children3);
        return append34(acc)(append34([node])(concatMap(go2([]))(childArray)));
      };
    };
    return go2([])(tree2);
  };
  var dagTree = function(dictOrd) {
    return function(tree2) {
      return function(getId) {
        return {
          tree: tree2,
          extraLinks: [],
          getId
        };
      };
    };
  };
  var buildTreeLinks = function(tree2) {
    var go2 = function(acc) {
      return function(t2) {
        var parent2 = head(t2);
        var children3 = tail(t2);
        var childArray = toUnfoldable10(children3);
        var childLinks = concatMap(go2([]))(childArray);
        var newLinks = map85(function(child) {
          return {
            source: parent2,
            target: head(child)
          };
        })(childArray);
        return append34(acc)(append34(newLinks)(childLinks));
      };
    };
    return go2([])(tree2);
  };
  var buildNodeMap = function(dictOrd) {
    var insert19 = insert(dictOrd);
    return function(getId) {
      return function(tree2) {
        var go2 = function(acc) {
          return function(t2) {
            var node = head(t2);
            var nodeId = getId(node.datum);
            var children3 = tail(t2);
            var acc$prime = insert19(nodeId)(node)(acc);
            return foldl20(go2)(acc$prime)(toUnfoldable10(children3));
          };
        };
        return go2(empty4)(tree2);
      };
    };
  };
  var layoutDAGTree = function(dictOrd) {
    var buildNodeMap1 = buildNodeMap(dictOrd);
    var resolveExtraLinks1 = resolveExtraLinks(dictOrd);
    return function(layout2) {
      return function(size6) {
        return function(dag) {
          var positioned = layoutTree(layout2)(size6)(dag.tree);
          var treeLinks = buildTreeLinks(positioned);
          var nodeMap = buildNodeMap1(dag.getId)(positioned);
          var extraLinks2 = resolveExtraLinks1(dag.extraLinks)(nodeMap);
          return {
            nodes: flattenPositioned(positioned),
            treeLinks,
            extraLinks: extraLinks2,
            nodeMap
          };
        };
      };
    };
  };
  var addLink = function(link5) {
    return function(dag) {
      return {
        tree: dag.tree,
        getId: dag.getId,
        extraLinks: snoc3(dag.extraLinks)(link5)
      };
    };
  };
  var addLinks = function(dictFoldable) {
    var foldl110 = foldl(dictFoldable);
    return function(links3) {
      return function(dag) {
        return foldl110(flip(addLink))(dag)(links3);
      };
    };
  };

  // output/D3.Viz.FPFTW.DAGTreeExample/index.js
  var fromFoldable36 = /* @__PURE__ */ fromFoldable(foldableArray);
  var $$void13 = /* @__PURE__ */ $$void(functorEffect);
  var bind74 = /* @__PURE__ */ bind(bindD3v2M);
  var select40 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var v3Attr14 = /* @__PURE__ */ v3Attr(showNumber);
  var lit15 = /* @__PURE__ */ lit(numExprEvalD);
  var str16 = /* @__PURE__ */ str(stringExprEvalD);
  var addLinks2 = /* @__PURE__ */ addLinks(foldableArray);
  var dagTree2 = /* @__PURE__ */ dagTree(ordString);
  var layoutDAGTree2 = /* @__PURE__ */ layoutDAGTree(ordString);
  var map86 = /* @__PURE__ */ map(functorArray);
  var renderTree62 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D);
  var renderTree119 = /* @__PURE__ */ renderTree62(ordUnit);
  var v3AttrFn5 = /* @__PURE__ */ v3AttrFn(showNumber);
  var ordRecord20 = /* @__PURE__ */ ordRecord();
  var ordRecordCons18 = /* @__PURE__ */ ordRecordCons(ordRecordNil)();
  var ordRecord110 = /* @__PURE__ */ ordRecord20(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons18({
    reflectSymbol: function() {
      return "y";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "x";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "depth";
    }
  })(ordInt))()({
    reflectSymbol: function() {
      return "datum";
    }
  })(/* @__PURE__ */ ordRecord20(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons18({
    reflectSymbol: function() {
      return "layer";
    }
  })(ordInt))()({
    reflectSymbol: function() {
      return "label";
    }
  })(ordString))()({
    reflectSymbol: function() {
      return "id";
    }
  })(ordString))));
  var ordRecordCons19 = /* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons18({
    reflectSymbol: function() {
      return "target";
    }
  })(ordRecord110))()({
    reflectSymbol: function() {
      return "source";
    }
  })(ordRecord110);
  var renderTree219 = /* @__PURE__ */ renderTree62(/* @__PURE__ */ ordRecord20(ordRecordCons19));
  var renderTree311 = /* @__PURE__ */ renderTree62(/* @__PURE__ */ ordRecord20(/* @__PURE__ */ ordRecordCons(ordRecordCons19)()({
    reflectSymbol: function() {
      return "linkType";
    }
  })(ordString)));
  var renderTree410 = /* @__PURE__ */ renderTree62(ordRecord110);
  var pure68 = /* @__PURE__ */ pure(applicativeD3v2M);
  var sampleTree = /* @__PURE__ */ (function() {
    return mkTree({
      id: "A",
      label: "A",
      layer: 0
    })(fromFoldable36([mkTree({
      id: "B",
      label: "B",
      layer: 1
    })(fromFoldable36([mkTree({
      id: "D",
      label: "D",
      layer: 2
    })(Nil.value), mkTree({
      id: "E",
      label: "E",
      layer: 2
    })(fromFoldable36([mkTree({
      id: "G",
      label: "G",
      layer: 3
    })(Nil.value), mkTree({
      id: "H",
      label: "H",
      layer: 3
    })(Nil.value)]))])), mkTree({
      id: "C",
      label: "C",
      layer: 1
    })(fromFoldable36([mkTree({
      id: "F",
      label: "F",
      layer: 2
    })(Nil.value)]))]));
  })();
  var extraLinks = [{
    source: "A",
    target: "E",
    linkType: "skip"
  }, {
    source: "C",
    target: "G",
    linkType: "cross"
  }, {
    source: "B",
    target: "F",
    linkType: "cross"
  }];
  var drawDAGTreeExample = function(selector) {
    return $$void13(runD3v2M(bind74(select40(selector))(function(container) {
      var size6 = {
        width: 500,
        height: 350
      };
      var padding2 = {
        top: 40,
        bottom: 20,
        left: 50,
        right: 50
      };
      var offsetNode = function(n) {
        return {
          datum: n.datum,
          depth: n.depth,
          x: n.x + padding2.left,
          y: n.y + padding2.top
        };
      };
      var offsetTreeLink = function(link5) {
        return {
          source: offsetNode(link5.source),
          target: offsetNode(link5.target)
        };
      };
      var offsetExtraLink = function(link5) {
        return {
          source: offsetNode(link5.source),
          target: offsetNode(link5.target),
          linkType: link5.linkType
        };
      };
      var legendY = size6.height - 15;
      var staticTree = withChildren(named(SVG.value)("svg")([v3Attr14("width")(lit15(size6.width)), v3Attr14("height")(lit15(size6.height)), v3AttrStr("class")(str16("dag-tree-example"))]))([elem3(Text.value)([v3Attr14("x")(lit15(size6.width / 2)), v3Attr14("y")(lit15(20)), v3AttrStr("textContent")(str16("DAG Tree: Tree + Extra Links")), v3Attr14("font-size")(lit15(14)), v3AttrStr("fill")(str16("#2F4F4F")), v3AttrStr("text-anchor")(str16("middle")), v3AttrStr("class")(str16("diagram-title"))]), named(Group.value)("tree-links")([v3AttrStr("class")(str16("tree-links"))]), named(Group.value)("extra-links")([v3AttrStr("class")(str16("extra-links"))]), named(Group.value)("nodes")([v3AttrStr("class")(str16("nodes"))]), named(Group.value)("labels")([v3AttrStr("class")(str16("labels"))]), elem3(Line.value)([v3Attr14("x1")(lit15(size6.width - 200)), v3Attr14("y1")(lit15(legendY)), v3Attr14("x2")(lit15(size6.width - 170)), v3Attr14("y2")(lit15(legendY)), v3AttrStr("stroke")(str16("#708090")), v3Attr14("stroke-width")(lit15(2))]), elem3(Text.value)([v3Attr14("x")(lit15(size6.width - 165)), v3Attr14("y")(lit15(legendY + 4)), v3AttrStr("textContent")(str16("Tree edge")), v3Attr14("font-size")(lit15(11)), v3AttrStr("fill")(str16("#708090"))]), elem3(Line.value)([v3Attr14("x1")(lit15(size6.width - 90)), v3Attr14("y1")(lit15(legendY)), v3Attr14("x2")(lit15(size6.width - 60)), v3Attr14("y2")(lit15(legendY)), v3AttrStr("stroke")(str16("#F4A460")), v3Attr14("stroke-width")(lit15(2.5))]), elem3(Text.value)([v3Attr14("x")(lit15(size6.width - 55)), v3Attr14("y")(lit15(legendY + 4)), v3AttrStr("textContent")(str16("Extra link")), v3Attr14("font-size")(lit15(11)), v3AttrStr("fill")(str16("#F4A460"))])]);
      var innerWidth8 = size6.width - padding2.left - padding2.right;
      var innerHeight8 = size6.height - padding2.top - padding2.bottom;
      var dag = addLinks2(extraLinks)(dagTree2(sampleTree)(function(v2) {
        return v2.id;
      }));
      var positioned = layoutDAGTree2(Vertical.value)({
        width: innerWidth8,
        height: innerHeight8
      })(dag);
      var extraLinksPositioned = map86(offsetExtraLink)(positioned.extraLinks);
      var nodes3 = map86(offsetNode)(positioned.nodes);
      var treeLinks = map86(offsetTreeLink)(positioned.treeLinks);
      return bind74(renderTree119(container)(staticTree))(function() {
        return bind74(select40(".dag-tree-example .tree-links"))(function(treeLinksGroup) {
          var treeLinksTree = joinData("links")("line")(treeLinks)(function(v2) {
            return elem3(Line.value)([v3AttrFn5("x1")(function(v1) {
              return v1.source.x;
            }), v3AttrFn5("y1")(function(v1) {
              return v1.source.y;
            }), v3AttrFn5("x2")(function(v1) {
              return v1.target.x;
            }), v3AttrFn5("y2")(function(v1) {
              return v1.target.y;
            }), v3AttrStr("stroke")(str16("#708090")), v3Attr14("stroke-width")(lit15(2)), v3Attr14("opacity")(lit15(0.6))]);
          });
          return bind74(renderTree219(treeLinksGroup)(treeLinksTree))(function() {
            return bind74(select40(".dag-tree-example .extra-links"))(function(extraLinksGroup) {
              var extraLinksTree = joinData("extra")("line")(extraLinksPositioned)(function(v2) {
                return elem3(Line.value)([v3AttrFn5("x1")(function(v1) {
                  return v1.source.x;
                }), v3AttrFn5("y1")(function(v1) {
                  return v1.source.y;
                }), v3AttrFn5("x2")(function(v1) {
                  return v1.target.x;
                }), v3AttrFn5("y2")(function(v1) {
                  return v1.target.y;
                }), v3AttrStr("stroke")(str16("#F4A460")), v3Attr14("stroke-width")(lit15(2.5)), v3AttrStr("class")(str16("extra-link"))]);
              });
              return bind74(renderTree311(extraLinksGroup)(extraLinksTree))(function() {
                return bind74(select40(".dag-tree-example .nodes"))(function(nodesGroup) {
                  var nodesTree = joinData("nodes")("circle")(nodes3)(function(v2) {
                    return elem3(Circle.value)([v3AttrFn5("cx")(function(v1) {
                      return v1.x;
                    }), v3AttrFn5("cy")(function(v1) {
                      return v1.y;
                    }), v3Attr14("r")(lit15(18)), v3AttrStr("fill")(str16("#4A90A4")), v3AttrStr("stroke")(str16("#fff")), v3Attr14("stroke-width")(lit15(2))]);
                  });
                  return bind74(renderTree410(nodesGroup)(nodesTree))(function() {
                    return bind74(select40(".dag-tree-example .labels"))(function(labelsGroup) {
                      var labelsTree = joinData("labels")("text")(nodes3)(function(v2) {
                        return elem3(Text.value)([v3AttrFn5("x")(function(v1) {
                          return v1.x;
                        }), v3AttrFn5("y")(function(n) {
                          return n.y + 5;
                        }), v3AttrFnStr("textContent")(function(v1) {
                          return v1.datum.label;
                        }), v3Attr14("font-size")(lit15(14)), v3AttrStr("fill")(str16("#fff")), v3AttrStr("text-anchor")(str16("middle")), v3AttrStr("class")(str16("node-label"))]);
                      });
                      return bind74(renderTree410(labelsGroup)(labelsTree))(function() {
                        return pure68(unit);
                      });
                    });
                  });
                });
              });
            });
          });
        });
      });
    })));
  };

  // output/D3.Viz.FPFTW.KoenigsbergBridges/index.js
  var bind75 = /* @__PURE__ */ bind(bindD3v2M);
  var liftEffect42 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var select41 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var from7 = /* @__PURE__ */ from3(showNumber);
  var stroke21 = /* @__PURE__ */ stroke(toAttributeValueString);
  var text37 = /* @__PURE__ */ text6(stringExprEvalD);
  var strokeWidth20 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var num31 = /* @__PURE__ */ num(numExprEvalD);
  var renderTree63 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D);
  var ordRecord21 = /* @__PURE__ */ ordRecord();
  var ordRecordCons20 = /* @__PURE__ */ ordRecordCons(ordRecordNil)();
  var ordNullable5 = /* @__PURE__ */ ordNullable(ordNumber);
  var ordRecord111 = /* @__PURE__ */ ordRecord21(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons20({
    reflectSymbol: function() {
      return "y";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "x";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "vy";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "vx";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "name";
    }
  })(ordString))()({
    reflectSymbol: function() {
      return "id";
    }
  })(ordInt))()({
    reflectSymbol: function() {
      return "fy";
    }
  })(ordNullable5))()({
    reflectSymbol: function() {
      return "fx";
    }
  })(ordNullable5))()({
    reflectSymbol: function() {
      return "degree";
    }
  })(ordInt));
  var renderTree120 = /* @__PURE__ */ renderTree63(/* @__PURE__ */ ordRecord21(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons20({
    reflectSymbol: function() {
      return "target";
    }
  })(ordRecord111))()({
    reflectSymbol: function() {
      return "source";
    }
  })(ordRecord111))()({
    reflectSymbol: function() {
      return "index";
    }
  })(ordInt)));
  var fill32 = /* @__PURE__ */ fill(toAttributeValueString);
  var renderTree220 = /* @__PURE__ */ renderTree63(ordRecord111);
  var attr36 = /* @__PURE__ */ attr3(toAttributeValueString);
  var fontSize14 = /* @__PURE__ */ fontSize(toAttributeValueNumber);
  var pure69 = /* @__PURE__ */ pure(applicativeD3v2M);
  var width39 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var height39 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var renderTree312 = /* @__PURE__ */ renderTree63(ordUnit);
  var tick3 = function(stateRef) {
    return runD3v2M(bind75(liftEffect42(read(stateRef)))(function(state3) {
      return bind75(select41("#koenigsberg-links"))(function(linksGroup) {
        return bind75(select41("#koenigsberg-nodes"))(function(nodesGroup) {
          return bind75(select41("#koenigsberg-labels"))(function(labelsGroup) {
            var linksTree = joinData("links")("line")(state3.swizzled)(function(v2) {
              return elem3(Line.value)([from7("x1")(function(v1) {
                return v1.source.x;
              }), from7("y1")(function(v1) {
                return v1.source.y;
              }), from7("x2")(function(v1) {
                return v1.target.x;
              }), from7("y2")(function(v1) {
                return v1.target.y;
              }), stroke21(text37("#8B4513")), strokeWidth20(num31(4))]);
            });
            return bind75(renderTree120(linksGroup)(linksTree))(function() {
              var nodesTree = joinData("nodes")("circle")(state3.nodes)(function(v2) {
                return elem3(Circle.value)([from7("cx")(function(v1) {
                  return v1.x;
                }), from7("cy")(function(v1) {
                  return v1.y;
                }), from7("r")(function(n) {
                  return 12 + toNumber(n.degree) * 3;
                }), fill32(text37("#4a7c59")), stroke21(text37("#2d4f35")), strokeWidth20(num31(2))]);
              });
              return bind75(renderTree220(nodesGroup)(nodesTree))(function() {
                var labelsTree = joinData("labels")("text")(state3.nodes)(function(v2) {
                  return elem3(Text.value)([from7("x")(function(v1) {
                    return v1.x;
                  }), from7("y")(function($105) {
                    return (function(v1) {
                      return v1 + 4;
                    })((function(v1) {
                      return v1.y;
                    })($105));
                  }), fromStr("textContent")(function(v1) {
                    return v1.name;
                  }), attr36("text-anchor")(text37("middle")), fill32(text37("#fff")), fontSize14(num31(10))]);
                });
                return bind75(renderTree220(labelsGroup)(labelsTree))(function() {
                  return pure69(unit);
                });
              });
            });
          });
        });
      });
    }));
  };
  var nodes2 = /* @__PURE__ */ (function() {
    return [{
      id: 0,
      name: "North",
      degree: 3,
      x: 0,
      y: -80,
      vx: 0,
      vy: 0,
      fx: nullImpl,
      fy: nullImpl
    }, {
      id: 1,
      name: "South",
      degree: 3,
      x: 0,
      y: 80,
      vx: 0,
      vy: 0,
      fx: nullImpl,
      fy: nullImpl
    }, {
      id: 2,
      name: "Island",
      degree: 5,
      x: -80,
      y: 0,
      vx: 0,
      vy: 0,
      fx: nullImpl,
      fy: nullImpl
    }, {
      id: 3,
      name: "East",
      degree: 3,
      x: 80,
      y: 0,
      vx: 0,
      vy: 0,
      fx: nullImpl,
      fy: nullImpl
    }];
  })();
  var links2 = [{
    source: 0,
    target: 2
  }, {
    source: 0,
    target: 2
  }, {
    source: 1,
    target: 2
  }, {
    source: 1,
    target: 2
  }, {
    source: 0,
    target: 3
  }, {
    source: 1,
    target: 3
  }, {
    source: 2,
    target: 3
  }];
  var drawKoenigsbergBridges = function(selector) {
    var swizzled = swizzleLinks(nodes2)(links2)(function(src10) {
      return function(tgt) {
        return function(i2) {
          return function(v2) {
            return {
              source: src10,
              target: tgt,
              index: i2
            };
          };
        };
      };
    });
    return function __do7() {
      var sim = create5(defaultConfig2)();
      setNodes(nodes2)(sim)();
      setLinks(links2)(sim)();
      addForce(new ManyBody("charge", {
        theta: defaultManyBody.theta,
        distanceMin: defaultManyBody.distanceMin,
        distanceMax: defaultManyBody.distanceMax,
        strength: -300
      }))(sim)();
      addForce(new Collide("collide", {
        strength: defaultCollide.strength,
        iterations: defaultCollide.iterations,
        radius: 35
      }))(sim)();
      addForce(new Center("center", defaultCenter))(sim)();
      addForce(new Link("links", {
        strength: defaultLink.strength,
        iterations: defaultLink.iterations,
        distance: 80
      }))(sim)();
      var stateRef = $$new({
        nodes: nodes2,
        swizzled
      })();
      runD3v2M(bind75(select41(selector))(function(container) {
        var containerTree = withChildren(named(SVG.value)("svg")([width39(num31(400)), height39(num31(300)), viewBox(-200)(-150)(400)(300)]))([withChildren(elem3(Group.value)([]))([named(Group.value)("links")([attr36("id")(text37("koenigsberg-links"))]), named(Group.value)("nodes")([attr36("id")(text37("koenigsberg-nodes"))]), named(Group.value)("labels")([attr36("id")(text37("koenigsberg-labels"))])])]);
        return bind75(renderTree312(container)(containerTree))(function() {
          return pure69(unit);
        });
      }))();
      onTick(tick3(stateRef))(sim)();
      start3(sim)();
      return stop(sim);
    };
  };

  // output/Data.Graph/index.js
  var map87 = /* @__PURE__ */ map(functorList);
  var mempty2 = /* @__PURE__ */ mempty(monoidList);
  var append35 = /* @__PURE__ */ append(semigroupCatList);
  var fromFoldable37 = /* @__PURE__ */ fromFoldable2(foldableList);
  var fromFoldable115 = /* @__PURE__ */ fromFoldable2(foldableArray);
  var Emit = /* @__PURE__ */ (function() {
    function Emit2(value0) {
      this.value0 = value0;
    }
    ;
    Emit2.create = function(value0) {
      return new Emit2(value0);
    };
    return Emit2;
  })();
  var Visit = /* @__PURE__ */ (function() {
    function Visit2(value0) {
      this.value0 = value0;
    }
    ;
    Visit2.create = function(value0) {
      return new Visit2(value0);
    };
    return Visit2;
  })();
  var Graph = function(x32) {
    return x32;
  };
  var topologicalSort = function(dictOrd) {
    var member9 = member(dictOrd);
    var $$delete10 = $$delete2(dictOrd);
    var lookup111 = lookup(dictOrd);
    return function(v2) {
      var visit = function($copy_state) {
        return function($copy_stack) {
          var $tco_var_state = $copy_state;
          var $tco_done = false;
          var $tco_result;
          function $tco_loop(state3, stack) {
            var v1 = uncons3(stack);
            if (v1 instanceof Nothing) {
              $tco_done = true;
              return state3;
            }
            ;
            if (v1 instanceof Just && v1.value0.value0 instanceof Emit) {
              var state$prime = {
                result: new Cons(v1.value0.value0.value0, state3.result),
                unvisited: state3.unvisited
              };
              $tco_var_state = state$prime;
              $copy_stack = v1.value0.value1;
              return;
            }
            ;
            if (v1 instanceof Just && v1.value0.value0 instanceof Visit) {
              if (member9(v1.value0.value0.value0)(state3.unvisited)) {
                var start4 = {
                  result: state3.result,
                  unvisited: $$delete10(v1.value0.value0.value0)(state3.unvisited)
                };
                var next2 = maybe(mempty2)(snd)(lookup111(v1.value0.value0.value0)(v2));
                $tco_var_state = start4;
                $copy_stack = append35(fromFoldable37(map87(Visit.create)(next2)))(cons(new Emit(v1.value0.value0.value0))(v1.value0.value1));
                return;
              }
              ;
              if (otherwise) {
                $tco_var_state = state3;
                $copy_stack = v1.value0.value1;
                return;
              }
              ;
            }
            ;
            throw new Error("Failed pattern match at Data.Graph (line 126, column 7 - line 144, column 40): " + [v1.constructor.name]);
          }
          ;
          while (!$tco_done) {
            $tco_result = $tco_loop($tco_var_state, $copy_stack);
          }
          ;
          return $tco_result;
        };
      };
      var initialState8 = {
        unvisited: v2,
        result: Nil.value
      };
      var go2 = function($copy_v1) {
        var $tco_done1 = false;
        var $tco_result;
        function $tco_loop(v1) {
          var v22 = findMin(v1.unvisited);
          if (v22 instanceof Just) {
            $copy_v1 = visit(v1)(fromFoldable115([new Visit(v22.value0.key)]));
            return;
          }
          ;
          if (v22 instanceof Nothing) {
            $tco_done1 = true;
            return v1.result;
          }
          ;
          throw new Error("Failed pattern match at Data.Graph (line 120, column 7 - line 122, column 26): " + [v22.constructor.name]);
        }
        ;
        while (!$tco_done1) {
          $tco_result = $tco_loop($copy_v1);
        }
        ;
        return $tco_result;
      };
      return go2(initialState8);
    };
  };
  var fromMap2 = Graph;

  // output/Data.Graph.Algorithms/index.js
  var mapFlipped10 = /* @__PURE__ */ mapFlipped(functorArray);
  var toUnfoldable11 = /* @__PURE__ */ toUnfoldable5(unfoldableArray);
  var unions3 = /* @__PURE__ */ unions(foldableArray);
  var map88 = /* @__PURE__ */ map(functorArray);
  var toUnfoldable1 = /* @__PURE__ */ toUnfoldable2(unfoldableArray);
  var fromFoldable116 = /* @__PURE__ */ fromFoldable(foldableArray);
  var maximum13 = /* @__PURE__ */ maximum(ordInt)(foldableArray);
  var toUnfoldable22 = /* @__PURE__ */ toUnfoldable(unfoldableArray);
  var reachableFrom = function(dictOrd) {
    var unions1 = unions3(dictOrd);
    var lookup36 = lookup(dictOrd);
    var difference8 = difference3(dictOrd);
    var union6 = union4(dictOrd);
    return function(start4) {
      return function(graph) {
        var go2 = function($copy_visited) {
          return function($copy_frontier) {
            var $tco_var_visited = $copy_visited;
            var $tco_done = false;
            var $tco_result;
            function $tco_loop(visited, frontier) {
              if (isEmpty2(frontier)) {
                $tco_done = true;
                return visited;
              }
              ;
              if (otherwise) {
                var neighbors = unions1(catMaybes(mapFlipped10(toUnfoldable11(frontier))(function(n) {
                  return lookup36(n)(graph.edges);
                })));
                var newNodes = difference8(neighbors)(visited);
                $tco_var_visited = union6(visited)(frontier);
                $copy_frontier = newNodes;
                return;
              }
              ;
              throw new Error("Failed pattern match at Data.Graph.Algorithms (line 60, column 5 - line 60, column 43): " + [visited.constructor.name, frontier.constructor.name]);
            }
            ;
            while (!$tco_done) {
              $tco_result = $tco_loop($tco_var_visited, $copy_frontier);
            }
            ;
            return $tco_result;
          };
        };
        return go2(empty8)(singleton11(start4));
      };
    };
  };
  var transitiveReduction = function(dictOrd) {
    var $$delete10 = $$delete5(dictOrd);
    var lookup36 = lookup(dictOrd);
    var member9 = member2(dictOrd);
    var reachableFrom1 = reachableFrom(dictOrd);
    var filter7 = filter5(dictOrd);
    var fromFoldable211 = fromFoldable6(dictOrd)(foldableArray);
    return function(graph) {
      var isTransitive = function(source3) {
        return function(target7) {
          var intermediates = $$delete10(target7)(fromMaybe(empty8)(lookup36(source3)(graph.edges)));
          var reachableThroughIntermediate = any2(function(intermediate) {
            return member9(target7)(reachableFrom1(intermediate)(graph));
          })(toUnfoldable11(intermediates));
          return reachableThroughIntermediate;
        };
      };
      var reduceEdge = function(v2) {
        return new Tuple(v2.value0, filter7((function() {
          var $74 = isTransitive(v2.value0);
          return function($75) {
            return !$74($75);
          };
        })())(v2.value1));
      };
      return {
        nodes: graph.nodes,
        edges: fromFoldable211(map88(reduceEdge)(toUnfoldable1(graph.edges)))
      };
    };
  };
  var getAllEdges = function(dictOrd) {
    var lookup36 = lookup(dictOrd);
    return function(graph) {
      return concat(mapFlipped10(graph.nodes)(function(source3) {
        var v2 = lookup36(source3)(graph.edges);
        if (v2 instanceof Nothing) {
          return [];
        }
        ;
        if (v2 instanceof Just) {
          return mapFlipped10(toUnfoldable11(v2.value0))(function(target7) {
            return new Tuple(source3, target7);
          });
        }
        ;
        throw new Error("Failed pattern match at Data.Graph.Algorithms (line 196, column 5 - line 199, column 28): " + [v2.constructor.name]);
      }));
    };
  };
  var getRemovedEdges = function(dictOrd) {
    var getAllEdges1 = getAllEdges(dictOrd);
    var Eq0 = dictOrd.Eq0();
    var difference8 = difference(eqTuple(Eq0)(Eq0));
    return function(original) {
      return function(reduced) {
        var reducedEdges = getAllEdges1(reduced);
        var originalEdges = getAllEdges1(original);
        return difference8(originalEdges)(reducedEdges);
      };
    };
  };
  var buildGraph = function(dictOrd) {
    var insert19 = insert(dictOrd);
    return function(tasks) {
      var addTask = function(acc) {
        return function(task) {
          return insert19(task.id)(new Tuple(task, fromFoldable116(task.depends)))(acc);
        };
      };
      var graphMap = foldl4(addTask)(empty4)(tasks);
      return fromMap2(graphMap);
    };
  };
  var getTopologicalOrder = function(dictOrd) {
    var buildGraph1 = buildGraph(dictOrd);
    var topologicalSort2 = topologicalSort(dictOrd);
    return function(tasks) {
      var graph = buildGraph1(tasks);
      return topologicalSort2(graph);
    };
  };
  var computeLayers = function(dictOrd) {
    var fromFoldable211 = fromFoldable6(dictOrd)(foldableArray);
    var getTopologicalOrder1 = getTopologicalOrder(dictOrd);
    var lookup36 = lookup(dictOrd);
    var insert19 = insert(dictOrd);
    return function(tasks) {
      var taskMap = fromFoldable211(mapFlipped10(tasks)(function(t2) {
        return new Tuple(t2.id, t2);
      }));
      var sortedIds = reverse(getTopologicalOrder1(tasks));
      var processTask = function(accLayers) {
        return function(taskId) {
          var v2 = lookup36(taskId)(taskMap);
          if (v2 instanceof Nothing) {
            return accLayers;
          }
          ;
          if (v2 instanceof Just) {
            var layer = (function() {
              var $70 = $$null3(v2.value0.depends);
              if ($70) {
                return 0;
              }
              ;
              var depLayers = mapFlipped10(v2.value0.depends)(function(depId) {
                return fromMaybe(0)(lookup36(depId)(accLayers));
              });
              var v1 = maximum13(depLayers);
              if (v1 instanceof Just) {
                return v1.value0 + 1 | 0;
              }
              ;
              if (v1 instanceof Nothing) {
                return 0;
              }
              ;
              throw new Error("Failed pattern match at Data.Graph.Algorithms (line 135, column 22 - line 137, column 36): " + [v1.constructor.name]);
            })();
            return insert19(taskId)(layer)(accLayers);
          }
          ;
          throw new Error("Failed pattern match at Data.Graph.Algorithms (line 124, column 7 - line 138, column 47): " + [v2.constructor.name]);
        };
      };
      return foldl4(processTask)(empty4)(toUnfoldable22(sortedIds));
    };
  };
  var addLayers = function(dictOrd) {
    var computeLayers1 = computeLayers(dictOrd);
    var lookup36 = lookup(dictOrd);
    return function(tasks) {
      var layers = computeLayers1(tasks);
      return mapFlipped10(tasks)(function(t2) {
        return {
          id: t2.id,
          layer: fromMaybe(0)(lookup36(t2.id)(layers)),
          depends: t2.depends
        };
      });
    };
  };

  // output/D3.Viz.FPFTW.TopologicalSort/index.js
  var cx19 = /* @__PURE__ */ cx(toAttributeValueNumber);
  var num32 = /* @__PURE__ */ num(numExprEvalD);
  var cy19 = /* @__PURE__ */ cy(toAttributeValueNumber);
  var r21 = /* @__PURE__ */ r(toAttributeValueNumber);
  var fill33 = /* @__PURE__ */ fill(toAttributeValueString);
  var text38 = /* @__PURE__ */ text6(stringExprEvalD);
  var stroke22 = /* @__PURE__ */ stroke(toAttributeValueString);
  var strokeWidth21 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var attr37 = /* @__PURE__ */ attr3(toAttributeValueString);
  var x28 = /* @__PURE__ */ x(toAttributeValueNumber);
  var y28 = /* @__PURE__ */ y(toAttributeValueNumber);
  var textContent15 = /* @__PURE__ */ textContent2(toAttributeValueString);
  var textAnchor15 = /* @__PURE__ */ textAnchor(toAttributeValueString);
  var bind76 = /* @__PURE__ */ bind(bindMaybe);
  var pure70 = /* @__PURE__ */ pure(applicativeMaybe);
  var x111 = /* @__PURE__ */ x1(toAttributeValueNumber);
  var y112 = /* @__PURE__ */ y1(toAttributeValueNumber);
  var x29 = /* @__PURE__ */ x2(toAttributeValueNumber);
  var y29 = /* @__PURE__ */ y2(toAttributeValueNumber);
  var mapFlipped11 = /* @__PURE__ */ mapFlipped(functorArray);
  var fromFoldable38 = /* @__PURE__ */ fromFoldable6(ordString)(foldableArray);
  var addLayers2 = /* @__PURE__ */ addLayers(ordString);
  var lookup32 = /* @__PURE__ */ lookup(ordString);
  var bind128 = /* @__PURE__ */ bind(bindD3v2M);
  var select42 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var maximum14 = /* @__PURE__ */ maximum(ordInt)(foldableArray);
  var show68 = /* @__PURE__ */ show(showInt);
  var width40 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var height40 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var append118 = /* @__PURE__ */ append(semigroupArray);
  var renderTree64 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(ordUnit);
  var pure118 = /* @__PURE__ */ pure(applicativeD3v2M);
  var visualizeTask = function(totalWidth) {
    return function(totalHeight) {
      return function(layerHeight) {
        return function(tasksInLayerCount) {
          return function(indexInLayer) {
            return function(task) {
              var yPos = toNumber(task.layer) * layerHeight + 50;
              var layerWidth = totalWidth - 100;
              var xPos = (function() {
                var $45 = tasksInLayerCount > 1;
                if ($45) {
                  return toNumber(indexInLayer) * layerWidth / toNumber(tasksInLayerCount - 1 | 0) + 50;
                }
                ;
                return totalWidth / 2;
              })();
              return [elem3(Circle.value)([cx19(num32(xPos)), cy19(num32(yPos)), r21(num32(25)), fill33(text38("#4CAF50")), stroke22(text38("#2E7D32")), strokeWidth21(num32(2)), attr37("class")(text38("task-node"))]), elem3(Text.value)([x28(num32(xPos)), y28(num32(yPos + 5)), textContent15(text38(task.name)), textAnchor15(text38("middle")), fill33(text38("#fff")), attr37("class")(text38("task-label"))])];
            };
          };
        };
      };
    };
  };
  var visualizeDependencyLink = function(totalWidth) {
    return function(totalHeight) {
      return function(layerHeight) {
        return function(allTasks) {
          return function(task) {
            return function(depId) {
              return bind76(find2(function(t2) {
                return t2.id === depId;
              })(allTasks))(function(depTask) {
                var tasksInTargetLayer = filter(function(t2) {
                  return t2.layer === depTask.layer;
                })(allTasks);
                var tasksInSourceLayer = filter(function(t2) {
                  return t2.layer === task.layer;
                })(allTasks);
                var targetY = toNumber(depTask.layer) * layerHeight + 50;
                var targetIndex = fromMaybe(0)(findIndex(function(t2) {
                  return t2.id === depTask.id;
                })(tasksInTargetLayer));
                var targetCount = length3(tasksInTargetLayer);
                var sourceY = toNumber(task.layer) * layerHeight + 50;
                var sourceIndex = fromMaybe(0)(findIndex(function(t2) {
                  return t2.id === task.id;
                })(tasksInSourceLayer));
                var sourceCount = length3(tasksInSourceLayer);
                var layerWidth = totalWidth - 100;
                var sourceX = (function() {
                  var $46 = sourceCount > 1;
                  if ($46) {
                    return toNumber(sourceIndex) * layerWidth / toNumber(sourceCount - 1 | 0) + 50;
                  }
                  ;
                  return totalWidth / 2;
                })();
                var targetX = (function() {
                  var $47 = targetCount > 1;
                  if ($47) {
                    return toNumber(targetIndex) * layerWidth / toNumber(targetCount - 1 | 0) + 50;
                  }
                  ;
                  return totalWidth / 2;
                })();
                return pure70(elem3(Line.value)([x111(num32(targetX)), y112(num32(targetY)), x29(num32(sourceX)), y29(num32(sourceY)), stroke22(text38("#bbb")), strokeWidth21(num32(2)), attr37("class")(text38("dependency-link"))]));
              });
            };
          };
        };
      };
    };
  };
  var buildPipelineTasks = [{
    id: "clone",
    name: "Clone Repo",
    depends: []
  }, {
    id: "install",
    name: "Install Deps",
    depends: ["clone"]
  }, {
    id: "lint",
    name: "Lint",
    depends: ["install"]
  }, {
    id: "test",
    name: "Test",
    depends: ["install"]
  }, {
    id: "build",
    name: "Build",
    depends: ["lint", "test"]
  }, {
    id: "docker",
    name: "Docker Image",
    depends: ["build"]
  }, {
    id: "deploy",
    name: "Deploy",
    depends: ["docker"]
  }];
  var addLayersWithNames = function(tasks) {
    var taskNodes = mapFlipped11(tasks)(function(t2) {
      return {
        id: t2.id,
        depends: t2.depends
      };
    });
    var nameMap = fromFoldable38(mapFlipped11(tasks)(function(t2) {
      return new Tuple(t2.id, t2.name);
    }));
    var layered = addLayers2(taskNodes);
    return mapFlipped11(layered)(function(l2) {
      return {
        id: l2.id,
        name: fromMaybe(l2.id)(lookup32(l2.id)(nameMap)),
        layer: l2.layer,
        depends: l2.depends
      };
    });
  };
  var drawTopologicalSort = function(containerSelector) {
    return runD3v2M(bind128(select42(containerSelector))(function(container) {
      var layeredTasks = addLayersWithNames(buildPipelineTasks);
      var layerValues = mapFlipped11(layeredTasks)(function(v2) {
        return v2.layer;
      });
      var maxLayer = fromMaybe(0)(maximum14(layerValues));
      var layerHeight = (function() {
        var $48 = maxLayer > 0;
        if ($48) {
          return (500 - 100) / toNumber(maxLayer);
        }
        ;
        return 100;
      })();
      var layerLabels = mapFlipped11(range2(0)(maxLayer))(function(layer) {
        return elem3(Text.value)([x28(num32(20)), y28(num32(toNumber(layer) * layerHeight + 55)), textContent15(text38("L" + show68(layer))), textAnchor15(text38("start")), fill33(text38("#666")), attr37("class")(text38("layer-label"))]);
      });
      var allNodes = concat(mapFlipped11(range2(0)(maxLayer))(function(layer) {
        var tasksInLayer = filter(function(t2) {
          return t2.layer === layer;
        })(layeredTasks);
        var count = length3(tasksInLayer);
        return concat(mapWithIndex3(function(idx) {
          return function(task) {
            return visualizeTask(800)(500)(layerHeight)(count)(idx)(task);
          };
        })(tasksInLayer));
      }));
      var allLinks = concat(mapFlipped11(layeredTasks)(function(task) {
        return catMaybes(mapFlipped11(task.depends)(function(depId) {
          return visualizeDependencyLink(800)(500)(layerHeight)(layeredTasks)(task)(depId);
        }));
      }));
      var vizTree = withChildren(named(SVG.value)("svg")([width40(num32(800)), height40(num32(500)), viewBox(0)(0)(800)(500), attr37("class")(text38("topological-sort"))]))(append118(allLinks)(append118(allNodes)(layerLabels)));
      return bind128(renderTree64(container)(vizTree))(function() {
        return pure118(unit);
      });
    }));
  };

  // output/D3.Viz.FPFTW.TransitiveReduction/index.js
  var fromFoldable39 = /* @__PURE__ */ fromFoldable6(ordString)(foldableArray);
  var fromFoldable117 = /* @__PURE__ */ fromFoldable20(foldableArray)(ordString);
  var x30 = /* @__PURE__ */ x(toAttributeValueNumber);
  var num33 = /* @__PURE__ */ num(numExprEvalD);
  var y30 = /* @__PURE__ */ y(toAttributeValueNumber);
  var textContent16 = /* @__PURE__ */ textContent2(toAttributeValueString);
  var text39 = /* @__PURE__ */ text6(stringExprEvalD);
  var textAnchor16 = /* @__PURE__ */ textAnchor(toAttributeValueString);
  var fill34 = /* @__PURE__ */ fill(toAttributeValueString);
  var attr38 = /* @__PURE__ */ attr3(toAttributeValueString);
  var mapFlipped14 = /* @__PURE__ */ mapFlipped(functorArray);
  var cx20 = /* @__PURE__ */ cx(toAttributeValueNumber);
  var cy20 = /* @__PURE__ */ cy(toAttributeValueNumber);
  var r22 = /* @__PURE__ */ r(toAttributeValueNumber);
  var stroke23 = /* @__PURE__ */ stroke(toAttributeValueString);
  var strokeWidth22 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var lookup33 = /* @__PURE__ */ lookup(ordString);
  var getAllEdges2 = /* @__PURE__ */ getAllEdges(ordString);
  var bind77 = /* @__PURE__ */ bind(bindMaybe);
  var elem7 = /* @__PURE__ */ elem2(/* @__PURE__ */ eqTuple(eqString)(eqString));
  var pure71 = /* @__PURE__ */ pure(applicativeMaybe);
  var x112 = /* @__PURE__ */ x1(toAttributeValueNumber);
  var y113 = /* @__PURE__ */ y1(toAttributeValueNumber);
  var x210 = /* @__PURE__ */ x2(toAttributeValueNumber);
  var y210 = /* @__PURE__ */ y2(toAttributeValueNumber);
  var opacity12 = /* @__PURE__ */ opacity(toAttributeValueNumber);
  var append119 = /* @__PURE__ */ append(semigroupArray);
  var bind129 = /* @__PURE__ */ bind(bindD3v2M);
  var select43 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var transitiveReduction2 = /* @__PURE__ */ transitiveReduction(ordString);
  var getRemovedEdges2 = /* @__PURE__ */ getRemovedEdges(ordString);
  var width41 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var height41 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var show69 = /* @__PURE__ */ show(showInt);
  var renderTree65 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(ordUnit);
  var pure119 = /* @__PURE__ */ pure(applicativeD3v2M);
  var exampleGraph = /* @__PURE__ */ (function() {
    return {
      nodes: ["A", "B", "C", "D", "E"],
      edges: fromFoldable39([new Tuple("A", fromFoldable117(["B", "C"])), new Tuple("B", fromFoldable117(["D"])), new Tuple("C", fromFoldable117(["D", "E"])), new Tuple("D", fromFoldable117(["E"])), new Tuple("E", empty8)])
    };
  })();
  var exampleGraphWithTransitive = /* @__PURE__ */ (function() {
    return {
      nodes: exampleGraph.nodes,
      edges: fromFoldable39([new Tuple("A", fromFoldable117(["B", "C", "D", "E"])), new Tuple("B", fromFoldable117(["D"])), new Tuple("C", fromFoldable117(["D", "E"])), new Tuple("D", fromFoldable117(["E"])), new Tuple("E", empty8)])
    };
  })();
  var circularLayout2 = function(centerX) {
    return function(centerY) {
      return function(circleRadius3) {
        return function(nodes3) {
          var positions = [{
            dx: 0,
            dy: -1
          }, {
            dx: 0.95,
            dy: -0.31
          }, {
            dx: 0.59,
            dy: 0.81
          }, {
            dx: -0.59,
            dy: 0.81
          }, {
            dx: -0.95,
            dy: -0.31
          }];
          return mapWithIndex3(function(i2) {
            return function(node) {
              var v2 = index(positions)(i2);
              if (v2 instanceof Just) {
                return {
                  id: node,
                  x: centerX + circleRadius3 * v2.value0.dx,
                  y: centerY + circleRadius3 * v2.value0.dy
                };
              }
              ;
              if (v2 instanceof Nothing) {
                return {
                  id: node,
                  x: centerX,
                  y: centerY
                };
              }
              ;
              throw new Error("Failed pattern match at D3.Viz.FPFTW.TransitiveReduction (line 77, column 11 - line 87, column 16): " + [v2.constructor.name]);
            };
          })(nodes3);
        };
      };
    };
  };
  var visualizeGraph = function(title4) {
    return function(graph) {
      return function(centerX) {
        return function(centerY) {
          return function(circleRadius3) {
            return function(highlightRemoved) {
              return function(removedEdges) {
                var titleElement = elem3(Text.value)([x30(num33(centerX)), y30(num33(centerY - circleRadius3 - 30)), textContent16(text39(title4)), textAnchor16(text39("middle")), fill34(text39("#333")), attr38("class")(text39("graph-title"))]);
                var positions = circularLayout2(centerX)(centerY)(circleRadius3)(graph.nodes);
                var posMap = fromFoldable39(mapFlipped14(positions)(function(p2) {
                  return new Tuple(p2.id, p2);
                }));
                var nodeElements = mapFlipped14(positions)(function(pos) {
                  return withChildren(named(Group.value)("node-" + pos.id)([]))([elem3(Circle.value)([cx20(num33(pos.x)), cy20(num33(pos.y)), r22(num33(20)), fill34(text39("#4A90E2")), stroke23(text39("#2E5C8A")), strokeWidth22(num33(2)), attr38("class")(text39("graph-node"))]), elem3(Text.value)([x30(num33(pos.x)), y30(num33(pos.y + 5)), textContent16(text39(pos.id)), textAnchor16(text39("middle")), fill34(text39("#fff")), attr38("class")(text39("node-label"))])]);
                });
                var getPos = function(nodeId) {
                  return lookup33(nodeId)(posMap);
                };
                var allEdges = getAllEdges2(graph);
                var edgeElements = catMaybes(mapFlipped14(allEdges)(function(v2) {
                  return bind77(getPos(v2.value0))(function(sourcePos) {
                    return bind77(getPos(v2.value1))(function(targetPos) {
                      var isRemoved = highlightRemoved && elem7(new Tuple(v2.value0, v2.value1))(removedEdges);
                      return pure71(elem3(Line.value)([x112(num33(sourcePos.x)), y113(num33(sourcePos.y)), x210(num33(targetPos.x)), y210(num33(targetPos.y)), stroke23(text39((function() {
                        if (isRemoved) {
                          return "#E74C3C";
                        }
                        ;
                        return "#999";
                      })())), strokeWidth22(num33((function() {
                        if (isRemoved) {
                          return 3;
                        }
                        ;
                        return 2;
                      })())), opacity12(num33((function() {
                        if (isRemoved) {
                          return 0.7;
                        }
                        ;
                        return 1;
                      })())), attr38("class")(text39((function() {
                        if (isRemoved) {
                          return "edge removed-edge";
                        }
                        ;
                        return "edge";
                      })()))]));
                    });
                  });
                }));
                return withChildren(named(Group.value)("graph-" + title4)([]))(append119([titleElement])(append119(edgeElements)(nodeElements)));
              };
            };
          };
        };
      };
    };
  };
  var drawTransitiveReduction = function(containerSelector) {
    return runD3v2M(bind129(select43(containerSelector))(function(container) {
      var reduced = transitiveReduction2(exampleGraphWithTransitive);
      var removedEdges = getRemovedEdges2(exampleGraphWithTransitive)(reduced);
      var edgeCount = function(original$prime) {
        return length3(getAllEdges2(original$prime));
      };
      var vizTree = withChildren(named(SVG.value)("svg")([width41(num33(1e3)), height41(num33(400)), viewBox(0)(0)(1e3)(400), attr38("class")(text39("transitive-reduction"))]))([visualizeGraph("Original (" + (show69(edgeCount(exampleGraphWithTransitive)) + " edges)"))(exampleGraphWithTransitive)(250)(200)(120)(true)(removedEdges), visualizeGraph("Reduced (" + (show69(edgeCount(reduced)) + " edges)"))(reduced)(750)(200)(120)(false)([]), elem3(Text.value)([x30(num33(500)), y30(num33(200)), textContent16(text39("\u2192")), textAnchor16(text39("middle")), fill34(text39("#666")), attr38("class")(text39("transformation-arrow"))])]);
      return bind129(renderTree65(container)(vizTree))(function() {
        return pure119(unit);
      });
    }));
  };

  // output/Component.Tour.TourGraphAlgorithms/index.js
  var discard47 = /* @__PURE__ */ discard(discardUnit)(bindHalogenM);
  var bind78 = /* @__PURE__ */ bind(bindHalogenM);
  var pure72 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize27 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var render31 = function(v2) {
    return div2([classes(["tutorial-page"])])([renderHeader2(TourGraphAlgorithms.value), main_([section([classes(["tutorial-section", "tutorial-intro"])])([h1([classes(["tutorial-title"])])([text5("Graph Algorithms: FP Wizardry")]), p_([text5("Graphs are everywhere in software: dependency trees, build systems, task schedulers, network routing, code analysis. This page demonstrates how "), strong_([text5("pure functional graph algorithms")]), text5(" combined with "), strong_([text5("declarative visualization")]), text5(" create powerful, elegant solutions to real-world problems.")]), p_([text5("We'll explore two classic algorithms that solve practical problems: topological sort (ordering tasks with dependencies) and transitive reduction (removing redundant edges). Both showcase the FP advantage: immutable transformations, pure functions, and easy-to-test logic.")])]), section([classes(["tutorial-section"]), id3("topological-sort-section")])([h2([classes(["tutorial-section-title"])])([text5("1. Topological Sort: Ordering Dependencies")]), p_([text5("Topological sort solves a fundamental problem: "), em_([text5('"In what order should I execute tasks that depend on each other?"')]), text5(" It's used in build systems (compile before link), package managers (install dependencies first), and task schedulers.")]), p_([text5("The algorithm takes a "), strong_([text5("directed acyclic graph (DAG)")]), text5(" and produces a "), strong_([text5("linear ordering")]), text5(" where every task comes after its dependencies. Below is a build pipeline with 7 tasks:")]), div2([id3("topological-sort"), classes(["viz-container"]), style("margin: 20px 0; text-align: center;")])([]), p_([text5("Notice how tasks are arranged in "), strong_([text5("layers")]), text5(" (L0, L1, L2, etc.). Each layer can execute in parallel since tasks in the same layer don't depend on each other. This is exactly what CI/CD systems do!")]), h3_([text5("The FP Win: Pure Graph Transformation")]), p_([text5("The topological sort implementation uses PureScript's "), code_([text5("Data.Graph")]), text5(" library with a purely functional algorithm:")]), pre([classes(["code-block"]), style("background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto;")])([code_([text5("-- Build a Graph from tasks\nbuildTaskGraph :: Array Task -> Graph String Task\nbuildTaskGraph tasks = fromMap graphMap\n  where\n    graphMap = foldl addTask Map.empty tasks\n    addTask acc task =\n      Map.insert task.id\n        (Tuple task (List.fromFoldable task.depends))\n        acc\n\n-- Pure topological sort (from Data.Graph)\ngetTopologicalOrder :: Array Task -> List String\ngetTopologicalOrder tasks =\n  topologicalSort (buildTaskGraph tasks)\n\n-- Compute layers: tasks with no deps at layer 0,\n-- tasks depending on layer 0 at layer 1, etc.\ncomputeLayers :: Array Task -> Map String Int\ncomputeLayers tasks = foldl processTask Map.empty sortedIds\n  where\n    sortedIds = List.reverse $ getTopologicalOrder tasks")])]), p_([text5("Key advantages:")]), ul_([li_([strong_([text5("Immutable: ")]), text5("Graph transformations return new graphs, never mutate")]), li_([strong_([text5("Pure: ")]), text5("Same input always produces same output, easy to test")]), li_([strong_([text5("Composable: ")]), text5("Topological sort \u2192 layer computation \u2192 visualization pipeline")]), li_([strong_([text5("Type-safe: ")]), text5("Compiler ensures graph structure is valid")])])]), section([classes(["tutorial-section"]), id3("transitive-reduction-section")])([h2([classes(["tutorial-section-title"])])([text5("2. Transitive Reduction: Removing Redundant Edges")]), p_([text5("Transitive reduction solves another practical problem: "), em_([text5('"Which dependencies are redundant?"')]), text5(" In dependency graphs, some edges are "), strong_([text5("implied by transitivity")]), text5(". For example, if A depends on B, and B depends on C, then we don't need to explicitly state that A depends on C.")]), p_([text5("Removing transitive edges simplifies graphs, making them easier to understand and maintain. This is crucial for build systems, package managers, and code dependency analysis.")]), div2([id3("transitive-reduction"), classes(["viz-container"]), style("margin: 20px 0; text-align: center;")])([]), p_([text5("The visualization shows "), strong_([text5("before and after")]), text5(". Redundant edges are highlighted in "), span4([style("color: #E74C3C;")])([text5("red")]), text5(" on the left, and removed on the right. Notice how the reduced graph preserves all reachability (A can still reach E through C \u2192 E) but with fewer explicit edges.")]), h3_([text5("The Algorithm: Reachability Analysis")]), p_([text5("The transitive reduction algorithm checks each edge: if the target is reachable through an "), em_([text5("alternate path")]), text5(", the edge is redundant:")]), pre([classes(["code-block"]), style("background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto;")])([code_([text5("-- Compute all nodes reachable from a given node\nreachableFrom :: String -> Graph -> Set String\nreachableFrom start graph = go Set.empty (Set.singleton start)\n  where\n    go visited frontier\n      | Set.isEmpty frontier = visited\n      | otherwise =\n          let neighbors = getNeighbors frontier\n              newNodes = Set.difference neighbors visited\n          in go (Set.union visited frontier) newNodes\n\n-- Remove transitive edges\ntransitiveReduction :: Graph -> Graph\ntransitiveReduction graph =\n  { nodes: graph.nodes\n  , edges: Map.mapWithKey reduceNode graph.edges\n  }\n  where\n    reduceNode source targets =\n      Set.filter (not <<< isTransitive source) targets\n\n    isTransitive source target =\n      -- Is target reachable through intermediate nodes?\n      let intermediates = Set.delete target targets\n      in Array.any (\\\\i -> Set.member target (reachableFrom i graph))\n           (Set.toUnfoldable intermediates)")])]), p_([text5("Key FP advantages:")]), ul_([li_([strong_([text5("Graph as value: ")]), text5("Original and reduced graphs coexist, easy to compare")]), li_([strong_([text5("Recursive traversal: ")]), text5("Reachability computed via tail-recursive function")]), li_([strong_([text5("Set operations: ")]), text5("Union, difference, membership checks are declarative and clear")]), li_([strong_([text5("Visualization-friendly: ")]), text5("Easy to highlight removed edges for before/after comparison")])])]), section([classes(["tutorial-section"]), id3("koenigsberg-section")])([h2([classes(["tutorial-section-title"])])([text5("3. K\xF6nigsberg Bridges: The Birth of Graph Theory")]), p_([text5("In 1736, Euler solved the famous "), em_([text5('"Seven Bridges of K\xF6nigsberg"')]), text5(" problem and invented graph theory in the process. The city had four land masses connected by seven bridges. The question: "), strong_([text5("Can you walk through the city crossing each bridge exactly once?")])]), div2([id3("koenigsberg-bridges"), classes(["viz-container"]), style("margin: 20px 0; text-align: center;")])([]), p_([text5("Euler proved it's "), strong_([text5("impossible")]), text5(". His insight: a walk crossing each edge exactly once ("), em_([text5("Eulerian path")]), text5(") exists only if at most 2 nodes have odd degree. Here, "), strong_([text5("all 4 nodes have odd degree")]), text5(" (the Island has degree 5, all others have degree 3).")]), p_([text5("This tiny graph\u2014just 4 nodes and 7 edges\u2014launched an entire field of mathematics. Today we use Eulerian paths for DNA sequencing, circuit board routing, and garbage truck routes.")])]), section([classes(["tutorial-section"]), id3("dag-tree-section")])([h2([classes(["tutorial-section-title"])])([text5("4. DAG Tree: Trees with Extra Links")]), p_([text5("Many real-world structures are "), em_([text5('"mostly hierarchical"')]), text5(" with some extra non-tree connections. Git commit graphs have merge links. State machines have back-edges. The D3 Update Pattern has merge points.")]), p_([text5("The "), strong_([text5("DAG Tree")]), text5(" library feature handles this elegantly: standard tree layout positions nodes, then extra links are overlaid. Tree edges are shown in "), span4([style("color: #708090;")])([text5("gray")]), text5(", extra links in "), span4([style("color: #F4A460;")])([text5("orange")]), text5(":")]), div2([id3("dag-tree-example"), classes(["viz-container"]), style("margin: 20px 0; text-align: center;")])([]), p_([text5("Notice how the orange extra links "), strong_([text5("leap across layers")]), text5(": A\u2192E skips a level, C\u2192G crosses branches and skips a level, B\u2192F crosses branches at the same depth. This is perfect for visualizing:")]), ul_([li_([strong_([text5("Git history: ")]), text5("Tree follows first-parent, merge commits add extra links")]), li_([strong_([text5("State machines: ")]), text5("Tree of states, back-edges for loops")]), li_([strong_([text5("Data flows: ")]), text5("Tree structure with join/merge points")]), li_([strong_([text5("Dependency graphs: ")]), text5("Primary hierarchy with cross-dependencies")])]), h3_([text5("Clean Separation of Concerns")]), p_([text5("The DAG Tree API keeps tree layout and extra links separate:")]), pre([classes(["code-block"]), style("background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto;")])([code_([text5('-- Build DAG from tree + extra links\ndag = dagTree myTree _.id\n    # addLinks\n        [ { source: "A", target: "E", linkType: "skip" }\n        , { source: "C", target: "G", linkType: "cross" }\n        ]\n\n-- Layout returns positioned nodes + resolved links\npositioned = layoutDAGTree Vertical size dag\n\n-- positioned.nodes      -- Array of nodes with x, y coords\n-- positioned.treeLinks  -- Parent\u2192child links\n-- positioned.extraLinks -- Extra links with source/target coords')])]), p_([text5("Tree algorithms handle positioning. Extra links are resolved by ID lookup. Rendering is trivial\u2014just map over each array.")])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Why FP Wins for Graph Algorithms")]), p_([text5("These examples demonstrate fundamental advantages of functional programming for graph algorithms:")]), ul_([li_([strong_([text5("Immutability enables comparison: ")]), text5("We can keep the original graph and the transformed graph, making before/after visualizations trivial.")]), li_([strong_([text5("Purity enables testing: ")]), text5("No hidden state, no side effects. Feed in a graph, get back a result. Test with edge cases, verify correctness.")]), li_([strong_([text5("Composition enables pipelines: ")]), text5("Topological sort \u2192 layer computation \u2192 layout \u2192 visualization. Each step is a pure function.")]), li_([strong_([text5("Types prevent bugs: ")]), text5("The compiler ensures you don't create cycles in a DAG, or reference non-existent nodes.")])]), p_([text5("Real-world applications:")]), ul_([li_([text5("Build systems: Bazel, Buck, Gradle all use topological sort for parallelization")]), li_([text5("Package managers: npm, cargo, pip use dependency resolution with cycle detection")]), li_([text5("Task schedulers: Apache Airflow, Luigi, Prefect order DAG execution")]), li_([text5("Code analysis: Import graphs, call graphs, module dependencies")])]), p_([text5("This is "), strong_([text5("functional programming wizardry")]), text5(": elegant algorithms solving hard problems, with visualization making the solutions immediately obvious.")])])]), footer([classes(["tutorial-footer"])])([p_([text5("Want more FP demonstrations? Check out "), a([href4("#" + routeToPath(TourFPFTW.value))])([text5("FP For The Win")]), text5(" for examples with Maps, Sets, and functional patterns.")])])]);
  };
  var handleAction26 = function(dictMonadAff) {
    var liftAff2 = liftAff(monadAffHalogenM(dictMonadAff));
    var liftEffect54 = liftEffect(monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    return function(v2) {
      return discard47(liftAff2(delay(100)))(function() {
        return discard47(liftEffect54(drawTopologicalSort("#topological-sort")))(function() {
          return discard47(liftEffect54(drawTransitiveReduction("#transitive-reduction")))(function() {
            return bind78(liftEffect54(drawKoenigsbergBridges("#koenigsberg-bridges")))(function() {
              return discard47(liftEffect54(drawDAGTreeExample("#dag-tree-example")))(function() {
                return pure72(unit);
              });
            });
          });
        });
      });
    };
  };
  var component27 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render31,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction26(dictMonadAff),
        initialize: new Just(Initialize27.value)
      })
    });
  };

  // output/Component.Tour.TourHierarchies/index.js
  var discard48 = /* @__PURE__ */ discard(discardUnit)(bindHalogenM);
  var pure73 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize28 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var render32 = function(v2) {
    return div2([classes(["tutorial-page"])])([renderHeader2(TourHierarchies.value), main_([section([classes(["tutorial-section", "tutorial-intro"])])([h1([classes(["tutorial-title"])])([text5("3. Hierarchical Layouts")]), p_([text5("Hierarchical data structures are everywhere in computing: file systems, organizational charts, taxonomies, JSON documents, and abstract syntax trees. Different visualization layouts reveal different aspects of the same hierarchical data.")]), p_([text5("This page demonstrates different ways to visualize hierarchical datasets. Use the links below to explore each layout type and see how each representation emphasizes different relationships in the data.")])]), section([classes(["tutorial-section"]), id3("node-link")])([h2([classes(["tutorial-section-title"])])([text5("1. Node-Link Diagrams (Trees and Dendrograms)")]), p_([text5("Node-link diagrams show hierarchies as connected nodes, with parent-child relationships represented by links. These layouts can be oriented horizontally, vertically, or radially.")]), h3_([text5("Vertical Tidy Tree")]), p_([text5("Root at the top, grows downward. Compact tidy tree layout using the Reingold-Tilford algorithm. Common in organizational charts.")]), div2([id3("tree-viz"), classes(["viz-container"])])([]), h3_([text5("Horizontal Tidy Tree")]), p_([text5("Root on the left, grows to the right. Efficient use of horizontal space.")]), div2([id3("horizontal-tree-viz"), classes(["viz-container"])])([]), h3_([text5("Radial Tidy Tree")]), p_([text5("Emanates from center in a circular layout. Space-efficient for large hierarchies.")]), div2([id3("radial-tree-viz"), classes(["viz-container"])])([]), h3_([text5("Dendrograms (Cluster Diagrams)")]), p_([text5("Dendrogram layouts place all leaf nodes at the same level, creating a uniform appearance useful for comparing leaf nodes.")]), div2([id3("cluster-viz"), classes(["viz-container"])])([]), p_([text5("We also have an interactive demo showing "), a([href4("#" + routeToPath(AnimatedTreeCluster.value))])([text5("animated transitions between Tree and Cluster layouts")]), text5(" that demonstrates how the same data looks different with these two algorithms.")])]), section([classes(["tutorial-section"]), id3("adjacency")])([h2([classes(["tutorial-section-title"])])([text5("2. Adjacency Diagrams (Icicle/Sunburst)")]), p_([text5("Adjacency diagrams show hierarchy through relative placement of rectangles or arcs. They're space-efficient and can encode quantitative values through area.")]), h3_([text5("Icicle Diagram (Partition)")]), p_([text5("Rectangular subdivisions showing hierarchy through relative placement. Each level of the hierarchy is a horizontal band, with children subdividing their parent's width. Area encodes quantitative values.")]), div2([id3("partition-viz"), classes(["viz-container"])])([]), h3_([text5("Sunburst Diagram")]), p_([text5("The radial equivalent of icicle diagrams. The root is at the center, and each ring represents a level of the hierarchy. Angular width represents quantitative value or number of children.")]), div2([id3("sunburst-viz"), classes(["viz-container"])])([])]), section([classes(["tutorial-section"]), id3("enclosure")])([h2([classes(["tutorial-section-title"])])([text5("3. Enclosure Diagrams (Treemap and Circle Packing)")]), p_([text5("Enclosure diagrams show hierarchy through containment, where parent elements completely enclose their children. These layouts efficiently use space and make quantitative comparisons easy.")]), h3_([text5("Treemap")]), p_([text5("Space-efficient rectangular subdivisions where area is proportional to value. Treemaps show hierarchy through nesting and excel at displaying large amounts of hierarchical data in a compact space. The recursive subdivision algorithm creates rectangles whose area represents quantitative values.")]), div2([id3("treemap-viz"), classes(["viz-container"])])([]), h3_([text5("Circle Packing")]), p_([text5("Tightly nested circles showing hierarchy through containment. Area encodes values, and the circular layout readily shows topology. The packing algorithm positions circles to minimize wasted space while maintaining clear hierarchical relationships.")]), div2([id3("pack-viz"), classes(["viz-container"])])([])]), section([classes(["tutorial-section"]), id3("edge-bundling")])([h2([classes(["tutorial-section-title"])])([text5("4. Hierarchical Edge Bundling")]), p_([text5("Edge bundling is a technique for reducing visual clutter in graphs with many edges. Edges are bundled together along the hierarchical structure, creating visually appealing flow patterns that reveal high-level connectivity patterns.")]), p_([text5("This technique is particularly effective for visualizing dependencies, relationships, or flows in large hierarchical datasets like software dependencies, communication networks, or biological pathways.")]), h3_([text5("Flare Class Dependencies")]), p_([text5("This diagram shows the import relationships between 252 classes in the Flare ActionScript visualization library. Each class is positioned around the circle based on its package hierarchy, and edges are bundled together based on shared ancestry. The bundling reveals which packages are tightly coupled.")]), div2([id3("edge-bundle-viz"), classes(["viz-container"])])([])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Interactive Exploration")]), p_([text5("To see a working example of hierarchical layouts with interactive switching between tree and cluster algorithms, visit the "), a([href4("#" + routeToPath(AnimatedTreeCluster.value))])([text5("Animated Tree \u2194 Cluster demo")]), text5(" which shows smooth transitions between different layouts of the same hierarchical data.")]), p_([text5("More hierarchical layout examples will be added to the "), a([href4("#" + routeToPath(Examples.value))])([text5("Examples")]), text5(" page as they are implemented in TreeAPI.")])])])]);
  };
  var handleAction27 = function(dictMonadAff) {
    var liftEffect54 = liftEffect(monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    return function(v2) {
      return discard48(liftEffect54(treeViz("#tree-viz")))(function() {
        return discard48(liftEffect54(horizontalTreeViz("#horizontal-tree-viz")))(function() {
          return discard48(liftEffect54(radialTreeViz("#radial-tree-viz")))(function() {
            return discard48(liftEffect54(clusterViz("#cluster-viz")))(function() {
              return discard48(liftEffect54(partitionViz("#partition-viz")))(function() {
                return discard48(liftEffect54(sunburstViz("#sunburst-viz")))(function() {
                  return discard48(liftEffect54(treemapViz("#treemap-viz")))(function() {
                    return discard48(liftEffect54(packViz("#pack-viz")))(function() {
                      return discard48(liftEffect54(edgeBundleViz("#edge-bundle-viz")))(function() {
                        return pure73(unit);
                      });
                    });
                  });
                });
              });
            });
          });
        });
      });
    };
  };
  var component28 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render32,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction27(dictMonadAff),
        initialize: new Just(Initialize28.value)
      })
    });
  };

  // output/Component.Tour.TourIndex/index.js
  var pure74 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize29 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var renderCard2 = function(route) {
    return function(title4) {
      return function(description) {
        return a([classes(["howto-card"]), href4("#" + routeToPath(route))])([h3([classes(["howto-card__title"])])([text5(title4)]), p([classes(["howto-card__description"])])([text5(description)])]);
      };
    };
  };
  var render33 = function(v2) {
    return div2([classes(["docs-page", "tour-index"])])([render4({
      logoSize: Large.value,
      quadrant: NoQuadrant.value,
      prevNext: Nothing.value,
      pageTitle: Nothing.value
    }), section([classes(["docs-hero"])])([div2([classes(["docs-hero-content"])])([h1([classes(["docs-hero-title"])])([text5("Tour")]), p([classes(["docs-hero-description"])])([text5("A progressive tour of PSD3's capabilities. Start with foundations and build up to complex interactive visualizations.")])])]), section([classes(["docs-section"])])([h2([classes(["docs-section-title"])])([text5("Getting Started")]), div2([classes(["howto-card-grid"])])([renderCard2(TourFoundations.value)("Foundations")("Three circles, matrix, parabola, bar chart. The building blocks."), renderCard2(TourProfessional.value)("Typical Charts")("Multiline, grouped bar, radial stacked. Professional-grade visualizations."), renderCard2(TourFlow.value)("Data Flow")("Chord and Sankey diagrams. Visualizing flows and relationships.")])]), section([classes(["docs-section"])])([h2([classes(["docs-section-title"])])([text5("Structure & Motion")]), div2([classes(["howto-card-grid"])])([renderCard2(TourHierarchies.value)("Hierarchies")("Tree layouts, treemap, pack, icicle. All hierarchical visualizations."), renderCard2(TourMotion.value)("Motion & Transitions")("Smooth animations between states. Bringing visualizations to life.")])]), section([classes(["docs-section"])])([h2([classes(["docs-section-title"])])([text5("Advanced Topics")]), div2([classes(["howto-card-grid"])])([renderCard2(TourInterpreters.value)("Alternative Interpreters")("Mermaid diagrams, English descriptions, and code generators."), renderCard2(TourFPFTW.value)("FP For The Win")("Maps, Sets, contravariant attributes. Leveraging functional programming."), renderCard2(TourGraphAlgorithms.value)("Graph Algorithms")("Topological sort, transitive reduction. Graph theory in action.")])])]);
  };
  var handleAction28 = function(v2) {
    return pure74(unit);
  };
  var component29 = /* @__PURE__ */ (function() {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render33,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction28,
        initialize: new Just(Initialize29.value)
      })
    });
  })();

  // output/D3.Viz.TreeAPI.InterpreterDemo/index.js
  var v3Attr15 = /* @__PURE__ */ v3Attr(showNumber);
  var lit16 = /* @__PURE__ */ lit(numExprEvalD);
  var str17 = /* @__PURE__ */ str(stringExprEvalD);
  var threeLittleCircles2 = /* @__PURE__ */ (function() {
    return withChild(named(SVG.value)("svg")([v3Attr15("width")(lit16(300)), v3Attr15("height")(lit16(100)), v3AttrStr("viewBox")(str17("0 0 300 100"))]))(withChildren(named(Group.value)("circles")([v3AttrStr("class")(str17("circles-group"))]))([elem3(Circle.value)([v3Attr15("cx")(lit16(50)), v3Attr15("cy")(lit16(50)), v3Attr15("r")(lit16(20)), v3AttrStr("fill")(str17("red"))]), elem3(Circle.value)([v3Attr15("cx")(lit16(150)), v3Attr15("cy")(lit16(50)), v3Attr15("r")(lit16(20)), v3AttrStr("fill")(str17("green"))]), elem3(Circle.value)([v3Attr15("cx")(lit16(250)), v3Attr15("cy")(lit16(50)), v3Attr15("r")(lit16(20)), v3AttrStr("fill")(str17("blue"))])]));
  })();
  var simpleBarChartNoJoin = /* @__PURE__ */ (function() {
    return withChild(named(SVG.value)("svg")([v3Attr15("width")(lit16(400)), v3Attr15("height")(lit16(200)), v3AttrStr("viewBox")(str17("0 0 400 200")), v3AttrStr("class")(str17("bar-chart"))]))(withChildren(named(Group.value)("bars")([v3AttrStr("class")(str17("bars-group"))]))([elem3(Rect.value)([v3Attr15("x")(lit16(20)), v3Attr15("y")(lit16(130)), v3Attr15("width")(lit16(50)), v3Attr15("height")(lit16(50)), v3AttrStr("fill")(str17("steelblue"))]), elem3(Rect.value)([v3Attr15("x")(lit16(90)), v3Attr15("y")(lit16(55)), v3Attr15("width")(lit16(50)), v3Attr15("height")(lit16(125)), v3AttrStr("fill")(str17("steelblue"))]), elem3(Rect.value)([v3Attr15("x")(lit16(160)), v3Attr15("y")(lit16(105)), v3Attr15("width")(lit16(50)), v3Attr15("height")(lit16(75)), v3AttrStr("fill")(str17("steelblue"))]), elem3(Rect.value)([v3Attr15("x")(lit16(230)), v3Attr15("y")(lit16(30)), v3Attr15("width")(lit16(50)), v3Attr15("height")(lit16(150)), v3AttrStr("fill")(str17("steelblue"))]), elem3(Rect.value)([v3Attr15("x")(lit16(300)), v3Attr15("y")(lit16(80)), v3Attr15("width")(lit16(50)), v3Attr15("height")(lit16(100)), v3AttrStr("fill")(str17("steelblue"))])]));
  })();
  var nestedStructure = /* @__PURE__ */ (function() {
    return withChild(named(SVG.value)("svg")([v3Attr15("width")(lit16(200)), v3Attr15("height")(lit16(200)), v3AttrStr("viewBox")(str17("0 0 200 200"))]))(withChild(named(Group.value)("outer")([]))(withChildren(named(Group.value)("inner")([]))([elem3(Circle.value)([v3Attr15("cx")(lit16(100)), v3Attr15("cy")(lit16(100)), v3Attr15("r")(lit16(50)), v3AttrStr("fill")(str17("purple"))]), elem3(Text.value)([v3Attr15("x")(lit16(100)), v3Attr15("y")(lit16(105)), v3AttrStr("textContent")(str17("Hello!")), v3AttrStr("fill")(str17("white"))])])));
  })();

  // output/Control.Monad.Writer/index.js
  var unwrap7 = /* @__PURE__ */ unwrap();
  var runWriter = function($5) {
    return unwrap7(runWriterT($5));
  };

  // output/PSD3.Interpreter.English/index.js
  var show70 = /* @__PURE__ */ show(showNumber);
  var show129 = /* @__PURE__ */ show(showBoolean);
  var discard49 = /* @__PURE__ */ discard(discardUnit)(/* @__PURE__ */ bindWriterT(semigroupString)(bindIdentity));
  var tell2 = /* @__PURE__ */ tell(/* @__PURE__ */ monadTellWriterT(monoidString)(monadIdentity));
  var applicativeWriterT2 = /* @__PURE__ */ applicativeWriterT(monoidString)(applicativeIdentity);
  var when6 = /* @__PURE__ */ when(applicativeWriterT2);
  var for_7 = /* @__PURE__ */ for_(applicativeWriterT2)(foldableArray);
  var show211 = /* @__PURE__ */ show(showInt);
  var showElemType = function(v2) {
    if (v2 instanceof SVG) {
      return "SVG container";
    }
    ;
    if (v2 instanceof Group) {
      return "group";
    }
    ;
    if (v2 instanceof Circle) {
      return "circle";
    }
    ;
    if (v2 instanceof Rect) {
      return "rectangle";
    }
    ;
    if (v2 instanceof Path) {
      return "path";
    }
    ;
    if (v2 instanceof Line) {
      return "line";
    }
    ;
    if (v2 instanceof Text) {
      return "text";
    }
    ;
    if (v2 instanceof Div) {
      return "div";
    }
    ;
    if (v2 instanceof Span) {
      return "span";
    }
    ;
    if (v2 instanceof Table) {
      return "table";
    }
    ;
    if (v2 instanceof Tbody) {
      return "table body";
    }
    ;
    if (v2 instanceof Thead) {
      return "table head";
    }
    ;
    if (v2 instanceof Tr) {
      return "table row";
    }
    ;
    if (v2 instanceof Td) {
      return "table cell";
    }
    ;
    if (v2 instanceof Th) {
      return "table header";
    }
    ;
    if (v2 instanceof Defs) {
      return "definitions";
    }
    ;
    if (v2 instanceof LinearGradient) {
      return "linear gradient";
    }
    ;
    if (v2 instanceof Stop) {
      return "gradient stop";
    }
    ;
    throw new Error("Failed pattern match at PSD3.Interpreter.English (line 107, column 1 - line 107, column 38): " + [v2.constructor.name]);
  };
  var showAttrValue = function(v2) {
    if (v2 instanceof StringValue) {
      return '"' + (v2.value0 + '"');
    }
    ;
    if (v2 instanceof NumberValue) {
      return show70(v2.value0);
    }
    ;
    if (v2 instanceof BooleanValue) {
      return show129(v2.value0);
    }
    ;
    throw new Error("Failed pattern match at PSD3.Interpreter.English (line 132, column 1 - line 132, column 42): " + [v2.constructor.name]);
  };
  var showAttrName = function(v2) {
    return v2;
  };
  var indent = function(v2) {
    if (v2 === 0) {
      return "";
    }
    ;
    return "  " + indent(v2 - 1 | 0);
  };
  var describeSource = function(v2) {
    if (v2 instanceof UnknownSource) {
      return "based on data (dynamic)";
    }
    ;
    if (v2 instanceof StaticSource) {
      return "to " + v2.value0;
    }
    ;
    if (v2 instanceof FieldSource) {
      return "from data field '" + (v2.value0 + "'");
    }
    ;
    if (v2 instanceof ExprSource) {
      return "computed as " + v2.value0;
    }
    ;
    if (v2 instanceof IndexSource) {
      return "from element index";
    }
    ;
    throw new Error("Failed pattern match at PSD3.Interpreter.English (line 99, column 18 - line 104, column 38): " + [v2.constructor.name]);
  };
  var describeAttribute = function(v2) {
    if (v2 instanceof StaticAttr) {
      return "Set " + (showAttrName(v2.value0) + (" to " + showAttrValue(v2.value1)));
    }
    ;
    if (v2 instanceof DataAttr) {
      return "Set " + (showAttrName(v2.value0) + (" " + describeSource(v2.value1)));
    }
    ;
    if (v2 instanceof IndexedAttr) {
      return "Set " + (showAttrName(v2.value0) + (" " + describeSource(v2.value1)));
    }
    ;
    throw new Error("Failed pattern match at PSD3.Interpreter.English (line 87, column 1 - line 87, column 61): " + [v2.constructor.name]);
  };
  var describeTree = function(tree2) {
    return function(level) {
      if (tree2 instanceof Node2) {
        return discard49((function() {
          if (tree2.value0.name instanceof Just) {
            return tell2(indent(level) + ("Create a " + (showElemType(tree2.value0.elemType) + (' named "' + (tree2.value0.name.value0 + '"')))));
          }
          ;
          if (tree2.value0.name instanceof Nothing) {
            return tell2(indent(level) + ("Create a " + showElemType(tree2.value0.elemType)));
          }
          ;
          throw new Error("Failed pattern match at PSD3.Interpreter.English (line 33, column 5 - line 35, column 77): " + [tree2.value0.name.constructor.name]);
        })())(function() {
          return discard49(when6(!$$null3(tree2.value0.attrs))(discard49(tell2(" with attributes:\n"))(function() {
            return for_7(tree2.value0.attrs)(function(attr46) {
              return tell2(indent(level + 1 | 0) + (describeAttribute(attr46) + "\n"));
            });
          })))(function() {
            return when6(!$$null3(tree2.value0.children))(discard49(tell2(indent(level) + ("Then add " + (show211(length3(tree2.value0.children)) + " child element(s):\n"))))(function() {
              return for_7(tree2.value0.children)(function(child) {
                return describeTree(child)(level + 1 | 0);
              });
            }));
          });
        });
      }
      ;
      if (tree2 instanceof Join) {
        return discard49(tell2(indent(level) + ("For each of " + (show211(length3(tree2.value0.joinData)) + " data items, "))))(function() {
          return discard49(tell2("create a " + (tree2.value0.key + (' (join named "' + (tree2.value0.name + '")')))))(function() {
            return discard49(tell2(" using data-driven attributes\n"))(function() {
              return tell2(indent(level + 1 | 0) + "(Template function defined for creating elements from data)\n");
            });
          });
        });
      }
      ;
      if (tree2 instanceof NestedJoin) {
        return discard49(tell2(indent(level) + ("For each of " + (show211(length3(tree2.value0.joinData)) + " nested data items, "))))(function() {
          return discard49(tell2("create a " + (tree2.value0.key + (' (nested join named "' + (tree2.value0.name + '")')))))(function() {
            return discard49(tell2(" using data-driven attributes\n"))(function() {
              return tell2(indent(level + 1 | 0) + "(Nested template function defined)\n");
            });
          });
        });
      }
      ;
      if (tree2 instanceof SceneJoin) {
        return discard49(tell2(indent(level) + ("For each of " + (show211(length3(tree2.value0.joinData)) + " data items, "))))(function() {
          return discard49(tell2("create/update/remove " + (tree2.value0.key + (' (scene join named "' + (tree2.value0.name + '")')))))(function() {
            return discard49(tell2(" with General Update Pattern:\n"))(function() {
              return discard49(when6(isJust(tree2.value0.enterBehavior))(tell2(indent(level + 1 | 0) + "- Enter: elements appear with initial attributes and transition\n")))(function() {
                return discard49(when6(isJust(tree2.value0.updateBehavior))(tell2(indent(level + 1 | 0) + "- Update: elements transition to new state\n")))(function() {
                  return discard49(when6(isJust(tree2.value0.exitBehavior))(tell2(indent(level + 1 | 0) + "- Exit: elements transition out then removed\n")))(function() {
                    return tell2(indent(level + 1 | 0) + "(Template function defined for creating elements from data)\n");
                  });
                });
              });
            });
          });
        });
      }
      ;
      if (tree2 instanceof SceneNestedJoin) {
        return discard49(tell2(indent(level) + ("For each of " + (show211(length3(tree2.value0.joinData)) + " nested data items, "))))(function() {
          return discard49(tell2("decompose and create/update/remove " + (tree2.value0.key + (' (scene nested join named "' + (tree2.value0.name + '")')))))(function() {
            return discard49(tell2(" with General Update Pattern:\n"))(function() {
              return discard49(when6(isJust(tree2.value0.enterBehavior))(tell2(indent(level + 1 | 0) + "- Enter: elements appear with initial attributes and transition\n")))(function() {
                return discard49(when6(isJust(tree2.value0.updateBehavior))(tell2(indent(level + 1 | 0) + "- Update: elements transition to new state\n")))(function() {
                  return discard49(when6(isJust(tree2.value0.exitBehavior))(tell2(indent(level + 1 | 0) + "- Exit: elements transition out then removed\n")))(function() {
                    return tell2(indent(level + 1 | 0) + "(Decompose and template functions defined)\n");
                  });
                });
              });
            });
          });
        });
      }
      ;
      throw new Error("Failed pattern match at PSD3.Interpreter.English (line 31, column 27 - line 84, column 80): " + [tree2.constructor.name]);
    };
  };
  var runEnglish = function(tree2) {
    return snd(runWriter(describeTree(tree2)(0)));
  };

  // output/PSD3.Interpreter.MetaAST/index.js
  var map89 = /* @__PURE__ */ map(functorArray);
  var show71 = /* @__PURE__ */ show(showInt);
  var intercalate5 = /* @__PURE__ */ intercalate2(monoidString);
  var show130 = /* @__PURE__ */ show(showBoolean);
  var NodeAST = /* @__PURE__ */ (function() {
    function NodeAST2(value0) {
      this.value0 = value0;
    }
    ;
    NodeAST2.create = function(value0) {
      return new NodeAST2(value0);
    };
    return NodeAST2;
  })();
  var JoinAST = /* @__PURE__ */ (function() {
    function JoinAST2(value0) {
      this.value0 = value0;
    }
    ;
    JoinAST2.create = function(value0) {
      return new JoinAST2(value0);
    };
    return JoinAST2;
  })();
  var NestedJoinAST = /* @__PURE__ */ (function() {
    function NestedJoinAST2(value0) {
      this.value0 = value0;
    }
    ;
    NestedJoinAST2.create = function(value0) {
      return new NestedJoinAST2(value0);
    };
    return NestedJoinAST2;
  })();
  var SceneJoinAST = /* @__PURE__ */ (function() {
    function SceneJoinAST2(value0) {
      this.value0 = value0;
    }
    ;
    SceneJoinAST2.create = function(value0) {
      return new SceneJoinAST2(value0);
    };
    return SceneJoinAST2;
  })();
  var SceneNestedJoinAST = /* @__PURE__ */ (function() {
    function SceneNestedJoinAST2(value0) {
      this.value0 = value0;
    }
    ;
    SceneNestedJoinAST2.create = function(value0) {
      return new SceneNestedJoinAST2(value0);
    };
    return SceneNestedJoinAST2;
  })();
  var showElemType2 = function(v2) {
    if (v2 instanceof SVG) {
      return "SVG";
    }
    ;
    if (v2 instanceof Group) {
      return "Group";
    }
    ;
    if (v2 instanceof Circle) {
      return "Circle";
    }
    ;
    if (v2 instanceof Rect) {
      return "Rect";
    }
    ;
    if (v2 instanceof Path) {
      return "Path";
    }
    ;
    if (v2 instanceof Line) {
      return "Line";
    }
    ;
    if (v2 instanceof Text) {
      return "Text";
    }
    ;
    if (v2 instanceof Div) {
      return "Div";
    }
    ;
    if (v2 instanceof Span) {
      return "Span";
    }
    ;
    if (v2 instanceof Table) {
      return "Table";
    }
    ;
    if (v2 instanceof Tbody) {
      return "Tbody";
    }
    ;
    if (v2 instanceof Thead) {
      return "Thead";
    }
    ;
    if (v2 instanceof Tr) {
      return "Tr";
    }
    ;
    if (v2 instanceof Td) {
      return "Td";
    }
    ;
    if (v2 instanceof Th) {
      return "Th";
    }
    ;
    if (v2 instanceof Defs) {
      return "Defs";
    }
    ;
    if (v2 instanceof LinearGradient) {
      return "LinearGradient";
    }
    ;
    if (v2 instanceof Stop) {
      return "Stop";
    }
    ;
    throw new Error("Failed pattern match at PSD3.Interpreter.MetaAST (line 189, column 1 - line 189, column 38): " + [v2.constructor.name]);
  };
  var toAST = function(tree2) {
    if (tree2 instanceof Node2) {
      return new NodeAST({
        name: tree2.value0.name,
        elemType: showElemType2(tree2.value0.elemType),
        attrCount: length3(tree2.value0.attrs),
        children: map89(toAST)(tree2.value0.children)
      });
    }
    ;
    if (tree2 instanceof Join) {
      return new JoinAST({
        name: tree2.value0.name,
        key: tree2.value0.key,
        dataCount: length3(tree2.value0.joinData),
        hasTemplate: true
      });
    }
    ;
    if (tree2 instanceof NestedJoin) {
      return new NestedJoinAST({
        name: tree2.value0.name,
        key: tree2.value0.key,
        dataCount: length3(tree2.value0.joinData),
        hasTemplate: true
      });
    }
    ;
    if (tree2 instanceof SceneJoin) {
      return new SceneJoinAST({
        name: tree2.value0.name,
        key: tree2.value0.key,
        dataCount: length3(tree2.value0.joinData),
        hasEnter: (function() {
          if (tree2.value0.enterBehavior instanceof Just) {
            return true;
          }
          ;
          if (tree2.value0.enterBehavior instanceof Nothing) {
            return false;
          }
          ;
          throw new Error("Failed pattern match at PSD3.Interpreter.MetaAST (line 93, column 19 - line 95, column 27): " + [tree2.value0.enterBehavior.constructor.name]);
        })(),
        hasUpdate: (function() {
          if (tree2.value0.updateBehavior instanceof Just) {
            return true;
          }
          ;
          if (tree2.value0.updateBehavior instanceof Nothing) {
            return false;
          }
          ;
          throw new Error("Failed pattern match at PSD3.Interpreter.MetaAST (line 96, column 20 - line 98, column 27): " + [tree2.value0.updateBehavior.constructor.name]);
        })(),
        hasExit: (function() {
          if (tree2.value0.exitBehavior instanceof Just) {
            return true;
          }
          ;
          if (tree2.value0.exitBehavior instanceof Nothing) {
            return false;
          }
          ;
          throw new Error("Failed pattern match at PSD3.Interpreter.MetaAST (line 99, column 18 - line 101, column 27): " + [tree2.value0.exitBehavior.constructor.name]);
        })(),
        hasTemplate: true
      });
    }
    ;
    if (tree2 instanceof SceneNestedJoin) {
      return new SceneNestedJoinAST({
        name: tree2.value0.name,
        key: tree2.value0.key,
        dataCount: length3(tree2.value0.joinData),
        hasEnter: (function() {
          if (tree2.value0.enterBehavior instanceof Just) {
            return true;
          }
          ;
          if (tree2.value0.enterBehavior instanceof Nothing) {
            return false;
          }
          ;
          throw new Error("Failed pattern match at PSD3.Interpreter.MetaAST (line 110, column 19 - line 112, column 27): " + [tree2.value0.enterBehavior.constructor.name]);
        })(),
        hasUpdate: (function() {
          if (tree2.value0.updateBehavior instanceof Just) {
            return true;
          }
          ;
          if (tree2.value0.updateBehavior instanceof Nothing) {
            return false;
          }
          ;
          throw new Error("Failed pattern match at PSD3.Interpreter.MetaAST (line 113, column 20 - line 115, column 27): " + [tree2.value0.updateBehavior.constructor.name]);
        })(),
        hasExit: (function() {
          if (tree2.value0.exitBehavior instanceof Just) {
            return true;
          }
          ;
          if (tree2.value0.exitBehavior instanceof Nothing) {
            return false;
          }
          ;
          throw new Error("Failed pattern match at PSD3.Interpreter.MetaAST (line 116, column 18 - line 118, column 27): " + [tree2.value0.exitBehavior.constructor.name]);
        })(),
        hasTemplate: true
      });
    }
    ;
    throw new Error("Failed pattern match at PSD3.Interpreter.MetaAST (line 63, column 14 - line 120, column 8): " + [tree2.constructor.name]);
  };
  var prettyPrintAST = function(ast) {
    var power2 = function(v2) {
      return function(v1) {
        if (v1 === 0) {
          return "";
        }
        ;
        return v2 + power2(v2)(v1 - 1 | 0);
      };
    };
    var indent3 = function(n) {
      return power2("  ")(n);
    };
    var prettyPrint = function(tree2) {
      return function(level) {
        if (tree2 instanceof NodeAST) {
          var nameStr = (function() {
            if (tree2.value0.name instanceof Just) {
              return '"' + (tree2.value0.name.value0 + '"');
            }
            ;
            if (tree2.value0.name instanceof Nothing) {
              return "anonymous";
            }
            ;
            throw new Error("Failed pattern match at PSD3.Interpreter.MetaAST (line 129, column 23 - line 131, column 37): " + [tree2.value0.name.constructor.name]);
          })();
          var childrenStr = (function() {
            var $85 = length3(tree2.value0.children) > 0;
            if ($85) {
              return "\n" + (indent3(level + 1 | 0) + (", children: " + (show71(length3(tree2.value0.children)) + (" nodes\n" + intercalate5("\n")(map89(function(c2) {
                return prettyPrint(c2)(level + 2 | 0);
              })(tree2.value0.children))))));
            }
            ;
            return "";
          })();
          return indent3(level) + ("NodeAST\n" + (indent3(level + 1 | 0) + ("{ name: " + (nameStr + ("\n" + (indent3(level + 1 | 0) + (", elemType: " + (tree2.value0.elemType + ("\n" + (indent3(level + 1 | 0) + (", attrCount: " + (show71(tree2.value0.attrCount) + (childrenStr + ("\n" + (indent3(level) + "}")))))))))))))));
        }
        ;
        if (tree2 instanceof JoinAST) {
          return indent3(level) + ("JoinAST\n" + (indent3(level + 1 | 0) + ('{ name: "' + (tree2.value0.name + ('"\n' + (indent3(level + 1 | 0) + (', key: "' + (tree2.value0.key + ('"\n' + (indent3(level + 1 | 0) + (", dataCount: " + (show71(tree2.value0.dataCount) + ("\n" + (indent3(level + 1 | 0) + (", hasTemplate: " + (show130(tree2.value0.hasTemplate) + ("\n" + (indent3(level) + "}"))))))))))))))))));
        }
        ;
        if (tree2 instanceof NestedJoinAST) {
          return indent3(level) + ("NestedJoinAST\n" + (indent3(level + 1 | 0) + ('{ name: "' + (tree2.value0.name + ('"\n' + (indent3(level + 1 | 0) + (', key: "' + (tree2.value0.key + ('"\n' + (indent3(level + 1 | 0) + (", dataCount: " + (show71(tree2.value0.dataCount) + ("\n" + (indent3(level + 1 | 0) + (", hasTemplate: " + (show130(tree2.value0.hasTemplate) + ("\n" + (indent3(level) + "}"))))))))))))))))));
        }
        ;
        if (tree2 instanceof SceneJoinAST) {
          return indent3(level) + ("SceneJoinAST\n" + (indent3(level + 1 | 0) + ('{ name: "' + (tree2.value0.name + ('"\n' + (indent3(level + 1 | 0) + (', key: "' + (tree2.value0.key + ('"\n' + (indent3(level + 1 | 0) + (", dataCount: " + (show71(tree2.value0.dataCount) + ("\n" + (indent3(level + 1 | 0) + (", hasEnter: " + (show130(tree2.value0.hasEnter) + ("\n" + (indent3(level + 1 | 0) + (", hasUpdate: " + (show130(tree2.value0.hasUpdate) + ("\n" + (indent3(level + 1 | 0) + (", hasExit: " + (show130(tree2.value0.hasExit) + ("\n" + (indent3(level + 1 | 0) + (", hasTemplate: " + (show130(tree2.value0.hasTemplate) + ("\n" + (indent3(level) + "}"))))))))))))))))))))))))))))));
        }
        ;
        if (tree2 instanceof SceneNestedJoinAST) {
          return indent3(level) + ("SceneNestedJoinAST\n" + (indent3(level + 1 | 0) + ('{ name: "' + (tree2.value0.name + ('"\n' + (indent3(level + 1 | 0) + (', key: "' + (tree2.value0.key + ('"\n' + (indent3(level + 1 | 0) + (", dataCount: " + (show71(tree2.value0.dataCount) + ("\n" + (indent3(level + 1 | 0) + (", hasEnter: " + (show130(tree2.value0.hasEnter) + ("\n" + (indent3(level + 1 | 0) + (", hasUpdate: " + (show130(tree2.value0.hasUpdate) + ("\n" + (indent3(level + 1 | 0) + (", hasExit: " + (show130(tree2.value0.hasExit) + ("\n" + (indent3(level + 1 | 0) + (", hasTemplate: " + (show130(tree2.value0.hasTemplate) + ("\n" + (indent3(level) + "}"))))))))))))))))))))))))))))));
        }
        ;
        throw new Error("Failed pattern match at PSD3.Interpreter.MetaAST (line 127, column 30 - line 179, column 31): " + [tree2.constructor.name]);
      };
    };
    return prettyPrint(ast)(0);
  };

  // output/PSD3.Shared.Mermaid/foreign.js
  var logMessage = (msg) => () => {
    console.log(msg);
  };
  var renderMermaidDiagrams_ = () => {
    console.log("FFI: renderMermaidDiagrams_ effect executing");
    requestAnimationFrame(() => {
      console.log("FFI: requestAnimationFrame callback executing");
      try {
        if (typeof window.mermaid === "undefined" || typeof window.mermaid.render !== "function") {
          console.log("Mermaid not loaded/initialized yet, will retry...");
          setTimeout(() => renderMermaidDiagrams_()(), 500);
          return;
        }
        console.log("Mermaid is loaded, looking for diagram elements...");
        const elements = document.querySelectorAll(".mermaid:not([data-rendered])");
        console.log(`Found ${elements.length} Mermaid diagram elements`);
        if (elements.length === 0) {
          console.log("No unrendered Mermaid diagrams found");
          return;
        }
        console.log(`Processing ${elements.length} Mermaid diagrams...`);
        elements.forEach(async (element4, index7) => {
          try {
            console.log(`Processing diagram ${index7 + 1}...`);
            element4.setAttribute("data-rendered", "true");
            let graphDefinition = element4.textContent || element4.innerText;
            console.log(`Diagram ${index7 + 1} text length: ${graphDefinition.length}`);
            const id5 = "mermaid-" + Math.random().toString(36).substr(2, 9);
            const { svg: svg2 } = await window.mermaid.render(id5, graphDefinition);
            element4.innerHTML = svg2;
            console.log(`\u2713 Rendered Mermaid diagram ${index7 + 1}: ${id5}`);
          } catch (error4) {
            console.error(`\u2717 Failed to render Mermaid diagram ${index7 + 1}:`, error4);
            element4.innerHTML = '<div style="color: red; padding: 1rem; border: 1px solid red;">Failed to render diagram: ' + error4.message + "</div>";
          }
        });
      } catch (error4) {
        console.error("Error in requestAnimationFrame callback:", error4);
      }
    });
    console.log("FFI: requestAnimationFrame scheduled");
  };

  // output/PSD3.Shared.Mermaid/index.js
  var discard50 = /* @__PURE__ */ discard(discardUnit);
  var append36 = /* @__PURE__ */ append(semigroupArray);
  var triggerMermaidRendering = function(dictMonadEffect) {
    var liftEffect54 = liftEffect(dictMonadEffect);
    return discard50(dictMonadEffect.Monad0().Bind1())(liftEffect54(logMessage("PureScript: triggerMermaidRendering called")))(function() {
      return liftEffect54(renderMermaidDiagrams_);
    });
  };
  var mermaidDiagram = function(code3) {
    return function(className2) {
      return div2([classes(append36(["mermaid-container"])((function() {
        if (className2 instanceof Nothing) {
          return [];
        }
        ;
        if (className2 instanceof Just) {
          return [className2.value0];
        }
        ;
        throw new Error("Failed pattern match at PSD3.Shared.Mermaid (line 22, column 9 - line 24, column 43): " + [className2.constructor.name]);
      })()))])([div2([classes(["mermaid"])])([text5(code3)])]);
    };
  };

  // output/Component.Tour.TourInterpreters/index.js
  var show72 = /* @__PURE__ */ show(showInt);
  var append120 = /* @__PURE__ */ append(semigroupArray);
  var v3Attr16 = /* @__PURE__ */ v3Attr(showNumber);
  var lit17 = /* @__PURE__ */ lit(numExprEvalD);
  var str18 = /* @__PURE__ */ str(stringExprEvalD);
  var discard51 = /* @__PURE__ */ discard(discardUnit)(bindHalogenM);
  var bind79 = /* @__PURE__ */ bind(bindD3v2M);
  var select44 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var renderTree66 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(ordUnit);
  var pure75 = /* @__PURE__ */ pure(applicativeD3v2M);
  var bind130 = /* @__PURE__ */ bind(bindHalogenM);
  var modify_14 = /* @__PURE__ */ modify_(monadStateHalogenM);
  var pure120 = /* @__PURE__ */ pure(applicativeHalogenM);
  var ExThreeLittleCircles = /* @__PURE__ */ (function() {
    function ExThreeLittleCircles2() {
    }
    ;
    ExThreeLittleCircles2.value = new ExThreeLittleCircles2();
    return ExThreeLittleCircles2;
  })();
  var ExBarChart = /* @__PURE__ */ (function() {
    function ExBarChart2() {
    }
    ;
    ExBarChart2.value = new ExBarChart2();
    return ExBarChart2;
  })();
  var ExNestedStructure = /* @__PURE__ */ (function() {
    function ExNestedStructure2() {
    }
    ;
    ExNestedStructure2.value = new ExNestedStructure2();
    return ExNestedStructure2;
  })();
  var Initialize30 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var SelectExample = /* @__PURE__ */ (function() {
    function SelectExample3(value0) {
      this.value0 = value0;
    }
    ;
    SelectExample3.create = function(value0) {
      return new SelectExample3(value0);
    };
    return SelectExample3;
  })();
  var eqExampleSelection = {
    eq: function(x32) {
      return function(y32) {
        if (x32 instanceof ExThreeLittleCircles && y32 instanceof ExThreeLittleCircles) {
          return true;
        }
        ;
        if (x32 instanceof ExBarChart && y32 instanceof ExBarChart) {
          return true;
        }
        ;
        if (x32 instanceof ExNestedStructure && y32 instanceof ExNestedStructure) {
          return true;
        }
        ;
        return false;
      };
    }
  };
  var eq11 = /* @__PURE__ */ eq(eqExampleSelection);
  var interpreterFlowDiagram = '\ngraph TB\n    Code["PureScript Visualization Code<br/>(TreeAPI DSL)"]\n\n    Code --> D3["D3/DOM Interpreter"]\n    Code --> English["English Description Interpreter"]\n    Code --> Mermaid["Mermaid Diagram Interpreter"]\n    Code --> Meta["Meta/AST Interpreter"]\n\n    D3 --> Output1["HTML & SVG<br/>Interactive Visualizations"]\n    English --> Output2["Natural Language Description<br/>How the viz is built"]\n    Mermaid --> Output3["Mermaid Syntax<br/>\u2192 AST Flowchart Diagram"]\n    Meta --> Output4["PureScript Data Structure<br/>\u2192 Visual Tree Diagram<br/>(Future: WYSIWYG Editor!)"]\n\n    style Code fill:#e1f5ff,stroke:#4a90e2,stroke-width:3px\n    style D3 fill:#d4edda,stroke:#28a745,stroke-width:2px\n    style English fill:#fff3cd,stroke:#ffc107,stroke-width:2px\n    style Mermaid fill:#f8d7da,stroke:#dc3545,stroke-width:2px\n    style Meta fill:#e7d4f5,stroke:#9b4ae2,stroke-width:2px\n    style Output1 fill:#d4edda,stroke:#28a745,stroke-width:2px\n    style Output2 fill:#fff3cd,stroke:#ffc107,stroke-width:2px\n    style Output3 fill:#f8d7da,stroke:#dc3545,stroke-width:2px\n    style Output4 fill:#e7d4f5,stroke:#9b4ae2,stroke-width:2px\n';
  var render34 = function(state3) {
    return div2([classes(["tutorial-page"])])([renderHeader2(TourInterpreters.value), main_([section([classes(["tutorial-section", "tutorial-intro"])])([h1([classes(["tutorial-title"])])([text5("6. Alternative Interpreters")]), p_([text5("TreeAPI is a grammar, not just an API. The same visualization code can be interpreted in multiple ways, each serving a different purpose:")]), div2([style("margin: 30px 0; background: #f9f9f9; padding: 20px; border-radius: 8px;")])([h3([style("margin-top: 0; text-align: center; color: #555;")])([text5("The Interpreter Pattern: One Code, Multiple Outputs")]), mermaidDiagram(interpreterFlowDiagram)(new Just("interpreter-overview"))]), p_([text5("Below, we demonstrate each interpreter using different examples. Choose an example to see how each interpreter handles increasing complexity:")]), div2([classes(["example-selector"]), style("margin: 20px 0; text-align: center;")])([button2([classes(["example-button", (function() {
      var $48 = eq11(state3.selectedExample)(ExThreeLittleCircles.value);
      if ($48) {
        return "active";
      }
      ;
      return "";
    })()]), onClick(function(v2) {
      return new SelectExample(ExThreeLittleCircles.value);
    })])([text5("Three Little Circles")]), button2([classes(["example-button", (function() {
      var $49 = eq11(state3.selectedExample)(ExBarChart.value);
      if ($49) {
        return "active";
      }
      ;
      return "";
    })()]), onClick(function(v2) {
      return new SelectExample(ExBarChart.value);
    })])([text5("Bar Chart (Data Join)")]), button2([classes(["example-button", (function() {
      var $50 = eq11(state3.selectedExample)(ExNestedStructure.value);
      if ($50) {
        return "active";
      }
      ;
      return "";
    })()]), onClick(function(v2) {
      return new SelectExample(ExNestedStructure.value);
    })])([text5("Nested Structure")])]), div2([id3("d3-output"), classes(["viz-container"]), style("text-align: center; margin: 20px 0;")])([]), p_([text5("This demonstrates that TreeAPI separates ")]), em_([text5("structure")]), text5(" (what operations we want) from "), em_([text5("interpretation")]), text5(" (how they execute). Each interpreter below shows a different view of the same code.")]), section([classes(["tutorial-section"]), id3("english")])([h2([classes(["tutorial-section-title"])])([text5("1. English Description Interpreter")]), p_([text5("This interpreter translates the TreeAPI code into plain English, describing HOW the visualization is built (not what it looks like). Perfect for documentation and understanding code structure.")]), pre([classes(["code-output"]), style("background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; color: #333;")])([text5(state3.englishDesc)])]), section([classes(["tutorial-section"]), id3("mermaid")])([h2([classes(["tutorial-section-title"])])([text5("2. Mermaid Diagram Interpreter")]), p_([text5("This interpreter generates Mermaid diagram syntax, representing the visualization structure as a flowchart. Perfect for documentation and architectural overviews. "), strong_([text5("Below we feed this generated code back into Mermaid to prove it works!")])]), div2([style("margin: 20px 0;")])([h3([style("margin-top: 0; font-size: 14px; color: #666;")])([text5("Generated Mermaid Code:")]), pre([classes(["code-output"]), style("background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; color: #333; margin: 0 0 20px 0; max-height: 200px; overflow-y: auto;")])([text5(state3.mermaidCode)]), h3([style("margin-top: 0; font-size: 14px; color: #666;")])([text5("Rendered Diagram (Inception!):")]), mermaidDiagram(state3.mermaidCode)(Nothing.value)]), p_([text5("Visit the "), a([href4("#" + routeToPath(MermaidTreeDemo.value))])([text5("Mermaid Tree Visualizer")]), text5(" to see more interactive Mermaid diagrams.")])]), section([classes(["tutorial-section"]), id3("meta-tree")])([h2([classes(["tutorial-section-title"])])([text5("3. Meta/AST Interpreter - Code as Data")]), p_([text5("This interpreter produces a PureScript data structure representation of the tree itself. It demonstrates that the visualization code IS data that can be inspected and manipulated. "), strong_([text5("Below we visualize the AST structure itself using TreeAPI - pure inception!")])]), div2([style("display: flex; gap: 20px; margin: 20px 0;")])([div2([style("flex: 1;")])([h3([style("margin-top: 0; font-size: 14px; color: #666;")])([text5("Generated AST Code:")]), pre([classes(["code-output"]), style("background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; font-size: 12px; color: #333; margin: 0; max-height: 400px;")])([text5(state3.astCode)])]), div2([style("flex: 1;")])([h3([style("margin-top: 0; font-size: 14px; color: #666;")])([text5("Visualized AST Tree (Inception!):")]), div2([id3("ast-viz-output"), classes(["viz-container"]), style("border: 1px solid #ddd; border-radius: 5px; background: white;")])([])])]), p_([text5("This is particularly powerful because it:")]), ul_([li_([text5("Visualizes code as data - the DSL is itself manipulable data")]), li_([text5("Shows the tree structure explicitly as PureScript types")]), li_([text5("Enables metaprogramming - you can write code that analyzes or transforms visualizations")]), li_([text5("Demonstrates self-hosting - the system can describe itself")])])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("The Power of Multiple Interpreters")]), p_([text5("The Finally Tagless pattern gives us remarkable flexibility. By writing our visualization code once in a polymorphic style, we can interpret it in multiple ways without changing the source. This enables:")]), ul_([li_([text5("Better documentation - generate explanations alongside visualizations")]), li_([text5("Multi-target output - produce SVG, Canvas, or code in different languages")]), li_([text5("Meta-programming - analyze and transform visualization code programmatically")]), li_([text5("Testing - verify behavior using alternative interpreters")]), li_([text5("Optimization - choose the best interpreter for different contexts")])]), p_([text5("This approach demonstrates that data visualization can benefit from advanced programming language techniques, bringing type safety, composability, and flexibility to a domain traditionally dominated by imperative JavaScript code.")])])])]);
  };
  var getExampleTree = function(v2) {
    if (v2 instanceof ExThreeLittleCircles) {
      return threeLittleCircles2;
    }
    ;
    if (v2 instanceof ExBarChart) {
      return simpleBarChartNoJoin;
    }
    ;
    if (v2 instanceof ExNestedStructure) {
      return nestedStructure;
    }
    ;
    throw new Error("Failed pattern match at Component.Tour.TourInterpreters (line 253, column 1 - line 253, column 50): " + [v2.constructor.name]);
  };
  var astToTreeVisualization = function(ast) {
    var renderASTNode = function(node) {
      return function(xPos) {
        return function(level) {
          if (node instanceof NodeAST) {
            var label5 = (function() {
              if (node.value0.name instanceof Just) {
                return node.value0.elemType + (": " + node.value0.name.value0);
              }
              ;
              if (node.value0.name instanceof Nothing) {
                return node.value0.elemType;
              }
              ;
              throw new Error("Failed pattern match at Component.Tour.TourInterpreters (line 80, column 21 - line 82, column 34): " + [node.value0.name.constructor.name]);
            })();
            var childCount = length3(node.value0.children);
            var startX = xPos - 120 * (toNumber(childCount) - 1) / 2;
            return withChildren(named(Group.value)("node-" + show72(level))([]))(append120([elem3(Circle.value)([v3Attr16("cx")(lit17(xPos)), v3Attr16("cy")(lit17(toNumber(level) * 80)), v3Attr16("r")(lit17(30)), v3AttrStr("fill")(str18("#4A90E2")), v3AttrStr("stroke")(str18("#2E5C8A")), v3Attr16("stroke-width")(lit17(2))]), elem3(Text.value)([v3Attr16("x")(lit17(xPos)), v3Attr16("y")(lit17(toNumber(level) * 80 + 5)), v3AttrStr("text-content")(str18(label5)), v3AttrStr("text-anchor")(str18("middle")), v3AttrStr("fill")(str18("white"))]), elem3(Text.value)([v3Attr16("x")(lit17(xPos)), v3Attr16("y")(lit17(toNumber(level) * 80 + 45)), v3AttrStr("text-content")(str18("attrs: " + show72(node.value0.attrCount))), v3AttrStr("text-anchor")(str18("middle")), v3AttrStr("fill")(str18("#666"))])])(append120(mapWithIndex3(function(i2) {
              return function(v2) {
                var childY = toNumber(level + 1 | 0) * 80;
                var childX = startX + toNumber(i2) * 120;
                return elem3(Line.value)([v3Attr16("x1")(lit17(xPos)), v3Attr16("y1")(lit17(toNumber(level) * 80 + 30)), v3Attr16("x2")(lit17(childX)), v3Attr16("y2")(lit17(childY - 30)), v3AttrStr("stroke")(str18("#999")), v3Attr16("stroke-width")(lit17(1.5))]);
              };
            })(node.value0.children))(mapWithIndex3(function(i2) {
              return function(child) {
                var childX = startX + toNumber(i2) * 120;
                return renderASTNode(child)(childX)(level + 1 | 0);
              };
            })(node.value0.children))));
          }
          ;
          if (node instanceof JoinAST) {
            return withChildren(named(Group.value)("join-" + show72(level))([]))([elem3(Circle.value)([v3Attr16("cx")(lit17(xPos)), v3Attr16("cy")(lit17(toNumber(level) * 80)), v3Attr16("r")(lit17(30)), v3AttrStr("fill")(str18("#E27A4A")), v3AttrStr("stroke")(str18("#8A472E")), v3Attr16("stroke-width")(lit17(2))]), elem3(Text.value)([v3Attr16("x")(lit17(xPos)), v3Attr16("y")(lit17(toNumber(level) * 80 + 5)), v3AttrStr("text-content")(str18("Join: " + node.value0.name)), v3AttrStr("text-anchor")(str18("middle")), v3AttrStr("fill")(str18("white"))]), elem3(Text.value)([v3Attr16("x")(lit17(xPos)), v3Attr16("y")(lit17(toNumber(level) * 80 + 45)), v3AttrStr("text-content")(str18("data: " + show72(node.value0.dataCount))), v3AttrStr("text-anchor")(str18("middle")), v3AttrStr("fill")(str18("#666"))])]);
          }
          ;
          if (node instanceof NestedJoinAST) {
            return withChildren(named(Group.value)("nested-join-" + show72(level))([]))([elem3(Circle.value)([v3Attr16("cx")(lit17(xPos)), v3Attr16("cy")(lit17(toNumber(level) * 80)), v3Attr16("r")(lit17(30)), v3AttrStr("fill")(str18("#9B4AE2")), v3AttrStr("stroke")(str18("#5C2E8A")), v3Attr16("stroke-width")(lit17(2))]), elem3(Text.value)([v3Attr16("x")(lit17(xPos)), v3Attr16("y")(lit17(toNumber(level) * 80 + 5)), v3AttrStr("text-content")(str18("NestedJoin: " + node.value0.name)), v3AttrStr("text-anchor")(str18("middle")), v3AttrStr("fill")(str18("white"))]), elem3(Text.value)([v3Attr16("x")(lit17(xPos)), v3Attr16("y")(lit17(toNumber(level) * 80 + 45)), v3AttrStr("text-content")(str18("data: " + show72(node.value0.dataCount))), v3AttrStr("text-anchor")(str18("middle")), v3AttrStr("fill")(str18("#666"))])]);
          }
          ;
          if (node instanceof SceneJoinAST) {
            return withChildren(named(Group.value)("scene-join-" + show72(level))([]))([elem3(Circle.value)([v3Attr16("cx")(lit17(xPos)), v3Attr16("cy")(lit17(toNumber(level) * 80)), v3Attr16("r")(lit17(30)), v3AttrStr("fill")(str18("#4AE2A4")), v3AttrStr("stroke")(str18("#2E8A5C")), v3Attr16("stroke-width")(lit17(2))]), elem3(Text.value)([v3Attr16("x")(lit17(xPos)), v3Attr16("y")(lit17(toNumber(level) * 80 + 5)), v3AttrStr("text-content")(str18("SceneJoin: " + node.value0.name)), v3AttrStr("text-anchor")(str18("middle")), v3AttrStr("fill")(str18("white"))]), elem3(Text.value)([v3Attr16("x")(lit17(xPos)), v3Attr16("y")(lit17(toNumber(level) * 80 + 45)), v3AttrStr("text-content")(str18("data: " + (show72(node.value0.dataCount) + (" {" + ((function() {
              if (node.value0.hasEnter) {
                return "E";
              }
              ;
              return "";
            })() + ((function() {
              if (node.value0.hasUpdate) {
                return "U";
              }
              ;
              return "";
            })() + ((function() {
              if (node.value0.hasExit) {
                return "X";
              }
              ;
              return "";
            })() + "}"))))))), v3AttrStr("text-anchor")(str18("middle")), v3AttrStr("fill")(str18("#666"))])]);
          }
          ;
          if (node instanceof SceneNestedJoinAST) {
            return withChildren(named(Group.value)("scene-nested-join-" + show72(level))([]))([elem3(Circle.value)([v3Attr16("cx")(lit17(xPos)), v3Attr16("cy")(lit17(toNumber(level) * 80)), v3Attr16("r")(lit17(30)), v3AttrStr("fill")(str18("#E2A44A")), v3AttrStr("stroke")(str18("#8A5C2E")), v3Attr16("stroke-width")(lit17(2))]), elem3(Text.value)([v3Attr16("x")(lit17(xPos)), v3Attr16("y")(lit17(toNumber(level) * 80 + 5)), v3AttrStr("text-content")(str18("SceneNestedJoin: " + node.value0.name)), v3AttrStr("text-anchor")(str18("middle")), v3AttrStr("fill")(str18("white"))]), elem3(Text.value)([v3Attr16("x")(lit17(xPos)), v3Attr16("y")(lit17(toNumber(level) * 80 + 45)), v3AttrStr("text-content")(str18("data: " + (show72(node.value0.dataCount) + (" {" + ((function() {
              if (node.value0.hasEnter) {
                return "E";
              }
              ;
              return "";
            })() + ((function() {
              if (node.value0.hasUpdate) {
                return "U";
              }
              ;
              return "";
            })() + ((function() {
              if (node.value0.hasExit) {
                return "X";
              }
              ;
              return "";
            })() + "}"))))))), v3AttrStr("text-anchor")(str18("middle")), v3AttrStr("fill")(str18("#666"))])]);
          }
          ;
          throw new Error("Failed pattern match at Component.Tour.TourInterpreters (line 78, column 37 - line 250, column 14): " + [node.constructor.name]);
        };
      };
    };
    return withChild(named(SVG.value)("svg")([v3Attr16("width")(lit17(600)), v3Attr16("height")(lit17(400)), v3AttrStr("viewBox")(str18("0 0 600 400"))]))(withChild(named(Group.value)("ast-tree")([v3AttrStr("transform")(str18("translate(300, 50)"))]))(renderASTNode(ast)(0)(0)));
  };
  var renderExample = function(dictMonadAff) {
    var monadEffectHalogenM2 = monadEffectHalogenM(dictMonadAff.MonadEffect0());
    var liftEffect54 = liftEffect(monadEffectHalogenM2);
    var triggerMermaidRendering2 = triggerMermaidRendering(monadEffectHalogenM2);
    return function(selection2) {
      var tree2 = getExampleTree(selection2);
      return discard51(liftEffect54(runD3v2M(bind79(select44("#d3-output"))(function(container) {
        return bind79(renderTree66(container)(tree2))(function() {
          return pure75(unit);
        });
      }))))(function() {
        var english = runEnglish(tree2);
        return bind130(liftEffect54(runMermaidTree(tree2)))(function(mermaid) {
          var ast = toAST(tree2);
          var astPretty = prettyPrintAST(ast);
          var astTree = astToTreeVisualization(ast);
          return discard51(liftEffect54(runD3v2M(bind79(select44("#ast-viz-output"))(function(astContainer) {
            return bind79(renderTree66(astContainer)(astTree))(function() {
              return pure75(unit);
            });
          }))))(function() {
            return discard51(modify_14(function(v2) {
              var $84 = {};
              for (var $85 in v2) {
                if ({}.hasOwnProperty.call(v2, $85)) {
                  $84[$85] = v2[$85];
                }
                ;
              }
              ;
              $84.englishDesc = english;
              $84.mermaidCode = mermaid;
              $84.astCode = astPretty;
              return $84;
            }))(function() {
              return discard51(triggerMermaidRendering2)(function() {
                return pure120(unit);
              });
            });
          });
        });
      });
    };
  };
  var handleAction29 = function(dictMonadAff) {
    var liftAff2 = liftAff(monadAffHalogenM(dictMonadAff));
    var renderExample1 = renderExample(dictMonadAff);
    return function(v2) {
      if (v2 instanceof Initialize30) {
        return discard51(liftAff2(delay(100)))(function() {
          return renderExample1(ExThreeLittleCircles.value);
        });
      }
      ;
      if (v2 instanceof SelectExample) {
        return discard51(modify_14(function(v1) {
          var $88 = {};
          for (var $89 in v1) {
            if ({}.hasOwnProperty.call(v1, $89)) {
              $88[$89] = v1[$89];
            }
            ;
          }
          ;
          $88.selectedExample = v2.value0;
          return $88;
        }))(function() {
          return renderExample1(v2.value0);
        });
      }
      ;
      throw new Error("Failed pattern match at Component.Tour.TourInterpreters (line 296, column 16 - line 309, column 28): " + [v2.constructor.name]);
    };
  };
  var component30 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return {
          englishDesc: "",
          mermaidCode: "",
          astCode: "",
          selectedExample: ExThreeLittleCircles.value
        };
      },
      render: render34,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction29(dictMonadAff),
        initialize: new Just(Initialize30.value)
      })
    });
  };

  // output/D3.Viz.AnimatedTreeClusterLoop/index.js
  var bind80 = /* @__PURE__ */ bind(bindAff);
  var liftEffect43 = /* @__PURE__ */ liftEffect(monadEffectAff);
  var discard52 = /* @__PURE__ */ discard(discardUnit)(bindAff);
  var toggleLayout2 = function(v2) {
    if (v2 instanceof TreeLayout) {
      return ClusterLayout.value;
    }
    ;
    if (v2 instanceof ClusterLayout) {
      return TreeLayout.value;
    }
    ;
    throw new Error("Failed pattern match at D3.Viz.AnimatedTreeClusterLoop (line 19, column 1 - line 19, column 41): " + [v2.constructor.name]);
  };
  var animationLoop = function(vizState) {
    return function(layoutRef) {
      return bind80(liftEffect43(read(layoutRef)))(function(currentLayout) {
        var newLayout = toggleLayout2(currentLayout);
        return discard52(liftEffect43(write(newLayout)(layoutRef)))(function() {
          return discard52(liftEffect43(animationStep(vizState.dataTree)(vizState.linksGroup)(vizState.nodesGroup)(vizState.chartWidth)(vizState.chartHeight)(newLayout)))(function() {
            return discard52(delay(3e3))(function() {
              return animationLoop(vizState)(layoutRef);
            });
          });
        });
      });
    };
  };
  var startAnimatedTreeClusterLoop = function(flareData) {
    return function(containerSelector) {
      return launchAff_(bind80(liftEffect43(draw(flareData)(containerSelector)))(function(vizState) {
        return bind80(liftEffect43($$new(TreeLayout.value)))(function(layoutRef) {
          return discard52(liftEffect43(animationStep(vizState.dataTree)(vizState.linksGroup)(vizState.nodesGroup)(vizState.chartWidth)(vizState.chartHeight)(TreeLayout.value)))(function() {
            return discard52(delay(3e3))(function() {
              return animationLoop(vizState)(layoutRef);
            });
          });
        });
      }));
    };
  };

  // output/D3.Viz.LesMisV3.Draw/index.js
  var bind81 = /* @__PURE__ */ bind(bindD3v2M);
  var liftEffect44 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var select45 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var from8 = /* @__PURE__ */ from3(showNumber);
  var stroke24 = /* @__PURE__ */ stroke(toAttributeValueString);
  var text40 = /* @__PURE__ */ text6(stringExprEvalD);
  var opacity13 = /* @__PURE__ */ opacity(toAttributeValueNumber);
  var num34 = /* @__PURE__ */ num(numExprEvalD);
  var renderTree67 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D);
  var ordRecord22 = /* @__PURE__ */ ordRecord();
  var ordRecordCons21 = /* @__PURE__ */ ordRecordCons(ordRecordNil)();
  var ordNullable6 = /* @__PURE__ */ ordNullable(ordNumber);
  var ordRecord112 = /* @__PURE__ */ ordRecord22(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons21({
    reflectSymbol: function() {
      return "y";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "x";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "vy";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "vx";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "name";
    }
  })(ordString))()({
    reflectSymbol: function() {
      return "id";
    }
  })(ordInt))()({
    reflectSymbol: function() {
      return "group";
    }
  })(ordInt))()({
    reflectSymbol: function() {
      return "fy";
    }
  })(ordNullable6))()({
    reflectSymbol: function() {
      return "fx";
    }
  })(ordNullable6));
  var renderTree121 = /* @__PURE__ */ renderTree67(/* @__PURE__ */ ordRecord22(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons21({
    reflectSymbol: function() {
      return "value";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "target";
    }
  })(ordRecord112))()({
    reflectSymbol: function() {
      return "source";
    }
  })(ordRecord112))()({
    reflectSymbol: function() {
      return "index";
    }
  })(ordInt)));
  var r23 = /* @__PURE__ */ r(toAttributeValueNumber);
  var strokeWidth23 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var renderTree221 = /* @__PURE__ */ renderTree67(ordRecord112);
  var pure76 = /* @__PURE__ */ pure(applicativeD3v2M);
  var map90 = /* @__PURE__ */ map(functorArray);
  var width42 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var height42 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr39 = /* @__PURE__ */ attr3(toAttributeValueString);
  var renderTree313 = /* @__PURE__ */ renderTree67(ordUnit);
  var svgWidth3 = 900;
  var svgHeight3 = 600;
  var simulationId3 = "lesmis-main";
  var updateDOM = function(stateRef) {
    return runD3v2M(bind81(liftEffect44(read(stateRef)))(function(state3) {
      return bind81(select45("#lesmis-links"))(function(linksGroup) {
        return bind81(select45("#lesmis-nodes"))(function(nodesGroup) {
          var linksTree = joinData("links")("line")(state3.links)(function(v2) {
            return elem3(Line.value)([from8("x1")(function(v1) {
              return v1.source.x;
            }), from8("y1")(function(v1) {
              return v1.source.y;
            }), from8("x2")(function(v1) {
              return v1.target.x;
            }), from8("y2")(function(v1) {
              return v1.target.y;
            }), from8("stroke-width")(function(link5) {
              return sqrt(link5.value);
            }), stroke24(text40("#999")), opacity13(num34(0.6))]);
          });
          return bind81(renderTree121(linksGroup)(linksTree))(function() {
            var nodesTree = joinData("nodes")("circle")(state3.nodes)(function(v2) {
              return withBehaviors(elem3(Circle.value)([from8("cx")(function(v1) {
                return v1.x;
              }), from8("cy")(function(v1) {
                return v1.y;
              }), r23(num34(5)), fromStr("fill")(function(node) {
                return schemeCategory10At(node.group);
              }), stroke24(text40("#fff")), strokeWidth23(num34(1.5))]))([new Drag(new SimulationDrag(simulationId3))]);
            });
            return bind81(renderTree221(nodesGroup)(nodesTree))(function() {
              return pure76(unit);
            });
          });
        });
      });
    }));
  };
  var cloneNode2 = function(n) {
    return {
      id: n.id,
      name: n.name,
      group: n.group,
      x: n.x,
      y: n.y,
      vx: n.vx,
      vy: n.vy,
      fx: n.fx,
      fy: n.fy
    };
  };
  var startLesMis = function(model) {
    return function(containerSelector) {
      var clonedNodes = map90(cloneNode2)(model.nodes);
      var swizzledLinks = swizzleLinks(clonedNodes)(model.links)(function(src10) {
        return function(tgt) {
          return function(i2) {
            return function(link5) {
              return {
                source: src10,
                target: tgt,
                index: i2,
                value: link5.value
              };
            };
          };
        };
      });
      return function __do7() {
        var sim = create5(defaultConfig2)();
        setNodes(clonedNodes)(sim)();
        setLinks(model.links)(sim)();
        registerSimulation_(simulationId3)(reheat(sim))();
        addForce(new ManyBody("charge", {
          theta: defaultManyBody.theta,
          distanceMin: defaultManyBody.distanceMin,
          strength: -100,
          distanceMax: 500
        }))(sim)();
        addForce(new Collide("collision", {
          radius: 5,
          strength: 1,
          iterations: 1
        }))(sim)();
        addForce(new Center("center", {
          x: 0,
          y: 0,
          strength: 0.1
        }))(sim)();
        addForce(new Link("links", {
          distance: 30,
          strength: 0.5,
          iterations: 1
        }))(sim)();
        var stateRef = $$new({
          nodes: clonedNodes,
          links: swizzledLinks
        })();
        runD3v2M(bind81(select45(containerSelector))(function(container) {
          var containerTree = withChildren(withBehaviors(named(SVG.value)("svg")([width42(num34(svgWidth3)), height42(num34(svgHeight3)), viewBox(-svgWidth3 / 2)(-svgHeight3 / 2)(svgWidth3)(svgHeight3), attr39("id")(text40("lesmis-v3-svg")), attr39("class")(text40("lesmis-v3"))]))([new Zoom(defaultZoom(new ScaleExtent(0.1, 10))("#lesmis-zoom-group"))]))([withChildren(named(Group.value)("zoom-group")([attr39("id")(text40("lesmis-zoom-group")), attr39("class")(text40("zoom-group"))]))([named(Group.value)("links")([attr39("id")(text40("lesmis-links")), attr39("class")(text40("links"))]), named(Group.value)("nodes")([attr39("id")(text40("lesmis-nodes")), attr39("class")(text40("nodes"))])])]);
          return bind81(renderTree313(container)(containerTree))(function() {
            return pure76(unit);
          });
        }))();
        onTick(updateDOM(stateRef))(sim)();
        start3(sim)();
        return function __do8() {
          stop(sim)();
          return unregisterSimulation_(simulationId3)();
        };
      };
    };
  };

  // output/D3.Viz.TreeAPI.StaggeredCircles/index.js
  var mapFlipped15 = /* @__PURE__ */ mapFlipped(functorArray);
  var bind131 = /* @__PURE__ */ bind(bindD3v2M);
  var select46 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var width43 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var num35 = /* @__PURE__ */ num(numExprEvalD);
  var height43 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr40 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text41 = /* @__PURE__ */ text6(stringExprEvalD);
  var cx21 = /* @__PURE__ */ cx(toAttributeValueNumber);
  var cy21 = /* @__PURE__ */ cy(toAttributeValueNumber);
  var r24 = /* @__PURE__ */ r(toAttributeValueNumber);
  var fill35 = /* @__PURE__ */ fill(toAttributeValueString);
  var renderTree68 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(/* @__PURE__ */ ordRecord()(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(ordRecordNil)()({
    reflectSymbol: function() {
      return "y";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "x";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "index";
    }
  })(ordInt)));
  var lookup34 = /* @__PURE__ */ lookup(ordString);
  var pure77 = /* @__PURE__ */ pure(applicativeD3v2M);
  var withTransitionStaggered2 = /* @__PURE__ */ withTransitionStaggered(transitionMD3v2Selection_);
  var withTransition4 = /* @__PURE__ */ withTransition(transitionMD3v2Selection_);
  var staggeredCircles = function(selector) {
    var circleData3 = mapFlipped15(range2(0)(10 - 1 | 0))(function(i2) {
      return {
        index: i2,
        x: 50 + toNumber(i2) * 60,
        y: 100
      };
    });
    return function __do7() {
      var animatedRef = $$new(false)();
      var circlesSel = runD3v2M(bind131(select46(selector))(function(container) {
        var tree2 = withChild(named(SVG.value)("staggered-svg")([width43(num35(650)), height43(num35(200)), viewBox(0)(0)(650)(200), attr40("id")(text41("staggered-svg")), attr40("class")(text41("staggered-circles"))]))(joinData("circles")("circle")(circleData3)(function(d) {
          return elem3(Circle.value)([cx21(num35(d.x)), cy21(num35(d.y)), r24(num35(20)), fill35(text41("#4a90d9"))]);
        }));
        return bind131(renderTree68(container)(tree2))(function(selections) {
          var circlesSel2 = (function() {
            var v2 = lookup34("circles")(selections);
            if (v2 instanceof Just) {
              return v2.value0;
            }
            ;
            if (v2 instanceof Nothing) {
              return unsafeCrashWith("circles selection not found");
            }
            ;
            throw new Error("Failed pattern match at D3.Viz.TreeAPI.StaggeredCircles (line 70, column 20 - line 72, column 81): " + [v2.constructor.name]);
          })();
          return pure77(circlesSel2);
        });
      }))();
      var trigger = function __do8() {
        var isAnimated = read(animatedRef)();
        if (isAnimated) {
          return unit;
        }
        ;
        write(true)(animatedRef)();
        return runD3v2M((function() {
          var config = transitionWith({
            duration: 500,
            delay: Nothing.value,
            staggerDelay: Nothing.value,
            easing: Nothing.value
          });
          return withTransitionStaggered2(config)(staggerByIndex(100))(circlesSel)([cy21(num35(50)), fill35(text41("#e74c3c")), r24(num35(25))]);
        })())();
      };
      var reset2 = function __do8() {
        write(false)(animatedRef)();
        return runD3v2M((function() {
          var config = transitionWith({
            duration: 300,
            delay: Nothing.value,
            staggerDelay: Nothing.value,
            easing: Nothing.value
          });
          return withTransition4(config)(circlesSel)([cy21(num35(100)), fill35(text41("#4a90d9")), r24(num35(20))]);
        })())();
      };
      return {
        trigger,
        reset: reset2
      };
    };
  };

  // output/Component.Tour.TourMotion/index.js
  var map91 = /* @__PURE__ */ map(functorArray);
  var discard53 = /* @__PURE__ */ discard(discardUnit)(bindHalogenM);
  var bind132 = /* @__PURE__ */ bind(bindHalogenM);
  var modify_15 = /* @__PURE__ */ modify_(monadStateHalogenM);
  var forever4 = /* @__PURE__ */ forever(monadRecHalogenM);
  var fromFoldable40 = /* @__PURE__ */ fromFoldable20(foldableArray)(ordString);
  var $$void14 = /* @__PURE__ */ $$void(functorHalogenM);
  var mapFlipped16 = /* @__PURE__ */ mapFlipped(functorEmitter);
  var get16 = /* @__PURE__ */ get(monadStateHalogenM);
  var pure121 = /* @__PURE__ */ pure(applicativeHalogenM);
  var tickProgressMap4 = /* @__PURE__ */ tickProgressMap(ordString);
  var member7 = /* @__PURE__ */ member2(ordString);
  var append121 = /* @__PURE__ */ append(/* @__PURE__ */ semigroupSet(ordString));
  var startProgress4 = /* @__PURE__ */ startProgress(ordString);
  var show73 = /* @__PURE__ */ show(showInt);
  var difference7 = /* @__PURE__ */ difference3(ordString);
  var append211 = /* @__PURE__ */ append(semigroupArray);
  var Initialize31 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var Finalize5 = /* @__PURE__ */ (function() {
    function Finalize6() {
    }
    ;
    Finalize6.value = new Finalize6();
    return Finalize6;
  })();
  var TriggerColorMixing = /* @__PURE__ */ (function() {
    function TriggerColorMixing2() {
    }
    ;
    TriggerColorMixing2.value = new TriggerColorMixing2();
    return TriggerColorMixing2;
  })();
  var TriggerStaggered = /* @__PURE__ */ (function() {
    function TriggerStaggered2() {
    }
    ;
    TriggerStaggered2.value = new TriggerStaggered2();
    return TriggerStaggered2;
  })();
  var ResetStaggered = /* @__PURE__ */ (function() {
    function ResetStaggered2() {
    }
    ;
    ResetStaggered2.value = new ResetStaggered2();
    return ResetStaggered2;
  })();
  var LesMisGUPTick = /* @__PURE__ */ (function() {
    function LesMisGUPTick2() {
    }
    ;
    LesMisGUPTick2.value = new LesMisGUPTick2();
    return LesMisGUPTick2;
  })();
  var AddGUPNodes = /* @__PURE__ */ (function() {
    function AddGUPNodes2() {
    }
    ;
    AddGUPNodes2.value = new AddGUPNodes2();
    return AddGUPNodes2;
  })();
  var RemoveGUPNodes = /* @__PURE__ */ (function() {
    function RemoveGUPNodes2() {
    }
    ;
    RemoveGUPNodes2.value = new RemoveGUPNodes2();
    return RemoveGUPNodes2;
  })();
  var ResetGUP = /* @__PURE__ */ (function() {
    function ResetGUP2() {
    }
    ;
    ResetGUP2.value = new ResetGUP2();
    return ResetGUP2;
  })();
  var render35 = function(v2) {
    return div2([classes(["tutorial-page"])])([renderHeader2(TourMotion.value), main_([section([classes(["tutorial-section", "tutorial-intro"])])([h1([classes(["tutorial-title"])])([text5("5. Movement & Transition")]), p_([text5("This page explores transitions and movement in D3 visualizations, from simple color and position changes to complex physics simulations with the General Update Pattern.")])]), section([classes(["tutorial-section"]), id3("section-1")])([h2([classes(["tutorial-section-title"])])([text5("1. Basic Transitions: Color Mixing")]), p_([text5("Transitions allow smooth animated changes to visual properties. This simple example shows three circles transitioning from green to RGB primary colors (red, green, blue) with 50% opacity. The circles reposition to overlap, demonstrating additive color mixing where overlapping colors create secondary colors: cyan (green + blue), magenta (red + blue), and yellow (red + green).")]), div2([id3("viz"), classes(["viz-container"])])([]), button2([classes(["transition-button"]), onClick(function(v1) {
      return TriggerColorMixing.value;
    })])([text5("Transition to RGB")])]), section([classes(["tutorial-section"]), id3("section-2")])([h2([classes(["tutorial-section-title"])])([text5("2. Staggered Animations")]), p_([text5("Transitions can include per-element delays for choreographing complex multi-step animations. This example shows 10 circles with staggered delays\u2014each circle animates 100ms after the previous one, creating a wave effect.")]), p_([text5("The `withTransitionStaggered` function takes a delay function `(datum -> index -> Milliseconds)` that computes a unique delay for each element. The helper `staggerByIndex 100.0` creates delays of 0ms, 100ms, 200ms, etc.")]), div2([id3("staggered-container"), classes(["viz-container"])])([]), div2([classes(["button-row"])])([button2([classes(["transition-button"]), onClick(function(v1) {
      return TriggerStaggered.value;
    })])([text5("Animate")]), button2([classes(["transition-button", "secondary"]), onClick(function(v1) {
      return ResetStaggered.value;
    })])([text5("Reset")])])]), section([classes(["tutorial-section"]), id3("section-3")])([h2([classes(["tutorial-section-title"])])([text5("3. Animated Tree Transitions")]), p_([text5("This demonstration shows smooth automatic transitions between Tidy Tree and Dendrogram (Cluster) layouts. The visualization automatically alternates between layouts every 3 seconds. The same 252 nodes from the Flare visualization toolkit smoothly animate to their new positions\u2014no enter/exit, just updates.")]), p_([text5("The transitions are implemented using D3's data join with identity-based keys, ensuring each node maintains its identity across layout changes. Children are sorted by height to eliminate crossovers during animation, creating smooth and comprehensible transitions.")]), div2([id3("animated-tree-container"), classes(["viz-container"])])([]), p_([text5("For a version with manual controls, visit the "), a([href4("#" + routeToPath(AnimatedTreeCluster.value))])([text5("full Animated Tree \u2194 Cluster demo")]), text5(".")])]), section([classes(["tutorial-section"]), id3("section-4")])([h2([classes(["tutorial-section-title"])])([text5("4. The General Update Pattern")]), p_([text5("This deceptively simple example shows off an aspect of screen-based data visualization that has no analogue in paper visualizations: the ability to specify how updates to the data should be represented.")]), p_([text5("In this example, some letters of the alphabet are presented and then constantly updated. When a letter enters at first, it falls in from the top and it is green. If it's still present in the next set of letters it stays on the screen, but it turns gray and moves to an alphabetically correct new position. And if it's not present in the new data, it turns red and falls out before disappearing.")]), div2([id3("gup-container"), classes(["viz-container"])])([]), p_([text5("The example automatically cycles through random letter selections every 2 seconds, demonstrating all three parts of the pattern: green letters entering from above, gray letters sliding to new positions, and brown letters exiting below.")])]), section([classes(["tutorial-section"]), id3("section-5")])([h2([classes(["tutorial-section-title"])])([text5("5. Force-Directed Graph: Les Miserables")]), p_([text5("Force-directed graphs use physics simulation to position nodes and links. Nodes repel each other like charged particles, while links act as springs pulling connected nodes together. The simulation finds an equilibrium that naturally reveals the structure of the network.")]), p_([text5("This graph shows character co-occurrence in Victor Hugo's Les Miserables. The simulation applies multiple forces: charge (nodes repel), center (prevents drift), collision (prevents overlap), and link (pulls connected nodes together). You can zoom and pan using the mouse wheel and drag gestures.")]), div2([id3("lesmis-container"), classes(["viz-container"])])([])]), section([classes(["tutorial-section"]), id3("section-6")])([h2([classes(["tutorial-section-title"])])([text5("6. Force Simulation + GUP Transitions")]), p_([text5("This combines force simulation with the General Update Pattern. The simulation runs continuously controlling node positions, while GUP transitions animate non-positional properties when data changes: entering nodes appear green, updating nodes turn gray, and exiting nodes turn brown before removal.")]), p_([text5("Use the buttons to add/remove random nodes and observe the enter/update/exit transitions. This demonstrates how to compose continuous physics simulation with discrete data-driven transitions.")]), div2([id3("lesmis-gup-container"), classes(["viz-container"])])([]), div2([classes(["button-row"])])([button2([classes(["transition-button"]), onClick(function(v1) {
      return AddGUPNodes.value;
    })])([text5("Add 5 Nodes")]), button2([classes(["transition-button"]), onClick(function(v1) {
      return RemoveGUPNodes.value;
    })])([text5("Remove 5 Nodes")]), button2([classes(["transition-button", "secondary"]), onClick(function(v1) {
      return ResetGUP.value;
    })])([text5("Reset All")])])])])]);
  };
  var getLetters2 = /* @__PURE__ */ (function() {
    var letters = toCharArray("abcdefghijklmnopqrstuvwxyz");
    var coinToss = function(c2) {
      return function __do7() {
        var n = random();
        var $66 = n > 0.6;
        if ($66) {
          return new Just(c2);
        }
        ;
        return Nothing.value;
      };
    };
    return function __do7() {
      var choices = sequence(traversableArray)(applicativeEffect)(map91(coinToss)(letters))();
      return catMaybes(choices);
    };
  })();
  var handleAction30 = function(dictMonadAff) {
    var liftAff2 = liftAff(monadAffHalogenM(dictMonadAff));
    var monadEffectHalogenM2 = monadEffectHalogenM(dictMonadAff.MonadEffect0());
    var liftEffect54 = liftEffect(monadEffectHalogenM2);
    var log8 = log3(monadEffectHalogenM2);
    return function(v2) {
      if (v2 instanceof Initialize31) {
        return discard53(liftAff2(delay(100)))(function() {
          return bind132(liftEffect54(threeLittleCirclesTransition("#viz")))(function(trigger) {
            return discard53(modify_15(function(v1) {
              var $68 = {};
              for (var $69 in v1) {
                if ({}.hasOwnProperty.call(v1, $69)) {
                  $68[$69] = v1[$69];
                }
                ;
              }
              ;
              $68.colorMixingTrigger = new Just(trigger);
              return $68;
            }))(function() {
              return bind132(liftEffect54(staggeredCircles("#staggered-container")))(function(staggered) {
                return discard53(modify_15(function(v1) {
                  var $71 = {};
                  for (var $72 in v1) {
                    if ({}.hasOwnProperty.call(v1, $72)) {
                      $71[$72] = v1[$72];
                    }
                    ;
                  }
                  ;
                  $71.staggeredTrigger = new Just(staggered);
                  return $71;
                }))(function() {
                  return bind132(liftEffect54(initV3GUP("#gup-container")))(function(update2) {
                    return bind132(fork(forever4(bind132(liftEffect54(getLetters2))(function(letters) {
                      return discard53(liftEffect54(update2(letters)))(function() {
                        return liftAff2(delay(2300));
                      });
                    }))))(function(forkId) {
                      return discard53(modify_15(function(v1) {
                        var $74 = {};
                        for (var $75 in v1) {
                          if ({}.hasOwnProperty.call(v1, $75)) {
                            $74[$75] = v1[$75];
                          }
                          ;
                        }
                        ;
                        $74.gupFiber = new Just(forkId);
                        return $74;
                      }))(function() {
                        return bind132(liftAff2(simpleLoadJSON("./data/flare-2.json")))(function(flareJson) {
                          return discard53(liftEffect54(startAnimatedTreeClusterLoop(flareJson)("#animated-tree-container")))(function() {
                            return bind132(liftAff2(simpleLoadJSON("./data/miserables.json")))(function(lesMisJson) {
                              var model = processRawModel(lesMisJson);
                              return bind132(liftEffect54(startLesMis(model)("#lesmis-container")))(function(cleanup) {
                                return discard53(modify_15(function(v1) {
                                  var $77 = {};
                                  for (var $78 in v1) {
                                    if ({}.hasOwnProperty.call(v1, $78)) {
                                      $77[$78] = v1[$78];
                                    }
                                    ;
                                  }
                                  ;
                                  $77.lesMisCleanup = new Just(cleanup);
                                  return $77;
                                }))(function() {
                                  var allNodeIds = fromFoldable40(map91(function(v1) {
                                    return v1.name;
                                  })(model.nodes));
                                  return bind132(liftEffect54(defaultCallbacks))(function(callbacks) {
                                    return bind132(liftEffect54(createSimulationWithCallbacks2(callbacks)(model)))(function(simulation) {
                                      return discard53(liftEffect54(renderSVGContainer2("#lesmis-gup-container")))(function() {
                                        return bind132(liftEffect54(subscribeToSimulation(simulation)))(function(emitter) {
                                          return discard53($$void14(subscribe2(mapFlipped16(emitter)(function(event) {
                                            if (event instanceof Tick) {
                                              return LesMisGUPTick.value;
                                            }
                                            ;
                                            return LesMisGUPTick.value;
                                          }))))(function() {
                                            return modify_15(function(v1) {
                                              var $81 = {};
                                              for (var $82 in v1) {
                                                if ({}.hasOwnProperty.call(v1, $82)) {
                                                  $81[$82] = v1[$82];
                                                }
                                                ;
                                              }
                                              ;
                                              $81.lesMisGUPModel = new Just(model);
                                              $81.lesMisGUPVisibleIds = allNodeIds;
                                              $81.lesMisGUPEntering = empty4;
                                              $81.lesMisGUPExiting = [];
                                              $81.lesMisGUPSimulation = new Just(simulation);
                                              return $81;
                                            });
                                          });
                                        });
                                      });
                                    });
                                  });
                                });
                              });
                            });
                          });
                        });
                      });
                    });
                  });
                });
              });
            });
          });
        });
      }
      ;
      if (v2 instanceof Finalize5) {
        return bind132(get16)(function(state3) {
          return discard53((function() {
            if (state3.gupFiber instanceof Nothing) {
              return pure121(unit);
            }
            ;
            if (state3.gupFiber instanceof Just) {
              return kill(state3.gupFiber.value0);
            }
            ;
            throw new Error("Failed pattern match at Component.Tour.TourMotion (line 158, column 5 - line 160, column 35): " + [state3.gupFiber.constructor.name]);
          })())(function() {
            return discard53((function() {
              if (state3.lesMisCleanup instanceof Nothing) {
                return pure121(unit);
              }
              ;
              if (state3.lesMisCleanup instanceof Just) {
                return liftEffect54(state3.lesMisCleanup.value0);
              }
              ;
              throw new Error("Failed pattern match at Component.Tour.TourMotion (line 162, column 5 - line 164, column 41): " + [state3.lesMisCleanup.constructor.name]);
            })())(function() {
              return modify_15(function(v1) {
                var $88 = {};
                for (var $89 in v1) {
                  if ({}.hasOwnProperty.call(v1, $89)) {
                    $88[$89] = v1[$89];
                  }
                  ;
                }
                ;
                $88.gupFiber = Nothing.value;
                $88.lesMisCleanup = Nothing.value;
                return $88;
              });
            });
          });
        });
      }
      ;
      if (v2 instanceof TriggerColorMixing) {
        return bind132(get16)(function(state3) {
          if (state3.colorMixingTrigger instanceof Nothing) {
            return pure121(unit);
          }
          ;
          if (state3.colorMixingTrigger instanceof Just) {
            return liftEffect54(createTransitionTrigger(state3.colorMixingTrigger.value0));
          }
          ;
          throw new Error("Failed pattern match at Component.Tour.TourMotion (line 169, column 5 - line 171, column 96): " + [state3.colorMixingTrigger.constructor.name]);
        });
      }
      ;
      if (v2 instanceof TriggerStaggered) {
        return bind132(get16)(function(state3) {
          if (state3.staggeredTrigger instanceof Nothing) {
            return pure121(unit);
          }
          ;
          if (state3.staggeredTrigger instanceof Just) {
            return liftEffect54(state3.staggeredTrigger.value0.trigger);
          }
          ;
          throw new Error("Failed pattern match at Component.Tour.TourMotion (line 175, column 5 - line 177, column 45): " + [state3.staggeredTrigger.constructor.name]);
        });
      }
      ;
      if (v2 instanceof ResetStaggered) {
        return bind132(get16)(function(state3) {
          if (state3.staggeredTrigger instanceof Nothing) {
            return pure121(unit);
          }
          ;
          if (state3.staggeredTrigger instanceof Just) {
            return liftEffect54(state3.staggeredTrigger.value0.reset);
          }
          ;
          throw new Error("Failed pattern match at Component.Tour.TourMotion (line 181, column 5 - line 183, column 41): " + [state3.staggeredTrigger.constructor.name]);
        });
      }
      ;
      if (v2 instanceof LesMisGUPTick) {
        return bind132(get16)(function(state3) {
          if (state3.lesMisGUPSimulation instanceof Nothing) {
            return pure121(unit);
          }
          ;
          if (state3.lesMisGUPSimulation instanceof Just) {
            var v1 = tickProgressMap4(transitionDelta2)(state3.lesMisGUPEntering);
            var v22 = tickTransitions(transitionDelta2)(state3.lesMisGUPExiting);
            return discard53(modify_15(function(v3) {
              var $102 = {};
              for (var $103 in v3) {
                if ({}.hasOwnProperty.call(v3, $103)) {
                  $102[$103] = v3[$103];
                }
                ;
              }
              ;
              $102.lesMisGUPEntering = v1.active;
              $102.lesMisGUPExiting = v22.active;
              return $102;
            }))(function() {
              return liftEffect54(function __do7() {
                var currentNodes = getNodes(state3.lesMisGUPSimulation.value0)();
                var currentLinks = getLinks(state3.lesMisGUPSimulation.value0)();
                var scene = buildSceneData2(currentNodes)(v1.active)(v22.active)(currentLinks);
                return renderScene2(scene)();
              });
            });
          }
          ;
          throw new Error("Failed pattern match at Component.Tour.TourMotion (line 190, column 5 - line 215, column 36): " + [state3.lesMisGUPSimulation.constructor.name]);
        });
      }
      ;
      if (v2 instanceof AddGUPNodes) {
        return bind132(get16)(function(state3) {
          if (state3.lesMisGUPModel instanceof Just && state3.lesMisGUPSimulation instanceof Just) {
            var hiddenNodes = filter(function(n) {
              return !member7(n.name)(state3.lesMisGUPVisibleIds);
            })(state3.lesMisGUPModel.value0.nodes);
            return bind132(liftEffect54(pickRandom(5)(hiddenNodes)))(function(nodesToAdd) {
              var newVisibleIds = append121(state3.lesMisGUPVisibleIds)(fromFoldable40(map91(function(v1) {
                return v1.name;
              })(nodesToAdd)));
              var desiredNodes = filter(function(n) {
                return member7(n.name)(newVisibleIds);
              })(state3.lesMisGUPModel.value0.nodes);
              var desiredLinks = filterLinksToSubset(function(v1) {
                return v1.id;
              })(desiredNodes)(state3.lesMisGUPModel.value0.links);
              return bind132(liftEffect54(applySetupWithData(lesMisSetup)(desiredNodes)(desiredLinks)(state3.lesMisGUPSimulation.value0)))(function(result) {
                var enteringNames = map91(function(v1) {
                  return v1.name;
                })(result.nodes.entered);
                var newEntering = startProgress4(enteringNames)(state3.lesMisGUPEntering);
                return discard53(liftEffect54(reheat(state3.lesMisGUPSimulation.value0)))(function() {
                  return discard53(modify_15(function(v1) {
                    var $110 = {};
                    for (var $111 in v1) {
                      if ({}.hasOwnProperty.call(v1, $111)) {
                        $110[$111] = v1[$111];
                      }
                      ;
                    }
                    ;
                    $110.lesMisGUPVisibleIds = newVisibleIds;
                    $110.lesMisGUPEntering = newEntering;
                    return $110;
                  }))(function() {
                    return log8("Added " + (show73(length3(nodesToAdd)) + " nodes"));
                  });
                });
              });
            });
          }
          ;
          return pure121(unit);
        });
      }
      ;
      if (v2 instanceof RemoveGUPNodes) {
        return bind132(get16)(function(state3) {
          if (state3.lesMisGUPModel instanceof Just && state3.lesMisGUPSimulation instanceof Just) {
            var visibleNodes = filter(function(n) {
              return member7(n.name)(state3.lesMisGUPVisibleIds);
            })(state3.lesMisGUPModel.value0.nodes);
            return bind132(liftEffect54(pickRandom(5)(visibleNodes)))(function(nodesToRemove) {
              var nodesToRemoveIds = fromFoldable40(map91(function(v1) {
                return v1.name;
              })(nodesToRemove));
              var newVisibleIds = difference7(state3.lesMisGUPVisibleIds)(nodesToRemoveIds);
              var desiredNodes = filter(function(n) {
                return member7(n.name)(newVisibleIds);
              })(state3.lesMisGUPModel.value0.nodes);
              var desiredLinks = filterLinksToSubset(function(v1) {
                return v1.id;
              })(desiredNodes)(state3.lesMisGUPModel.value0.links);
              return bind132(liftEffect54(applySetupWithData(lesMisSetup)(desiredNodes)(desiredLinks)(state3.lesMisGUPSimulation.value0)))(function(result) {
                var newExiting = startTransitions(result.nodes.exited);
                return discard53(liftEffect54(reheat(state3.lesMisGUPSimulation.value0)))(function() {
                  return discard53(modify_15(function(v1) {
                    var $117 = {};
                    for (var $118 in v1) {
                      if ({}.hasOwnProperty.call(v1, $118)) {
                        $117[$118] = v1[$118];
                      }
                      ;
                    }
                    ;
                    $117.lesMisGUPVisibleIds = newVisibleIds;
                    $117.lesMisGUPExiting = append211(state3.lesMisGUPExiting)(newExiting);
                    return $117;
                  }))(function() {
                    return log8("Removed " + (show73(length3(nodesToRemove)) + " nodes"));
                  });
                });
              });
            });
          }
          ;
          return pure121(unit);
        });
      }
      ;
      if (v2 instanceof ResetGUP) {
        return bind132(get16)(function(state3) {
          if (state3.lesMisGUPModel instanceof Just && state3.lesMisGUPSimulation instanceof Just) {
            var allNodeIds = fromFoldable40(map91(function(v1) {
              return v1.name;
            })(state3.lesMisGUPModel.value0.nodes));
            return bind132(liftEffect54(applySetupWithData(lesMisSetup)(state3.lesMisGUPModel.value0.nodes)(state3.lesMisGUPModel.value0.links)(state3.lesMisGUPSimulation.value0)))(function(result) {
              var enteringNames = map91(function(v1) {
                return v1.name;
              })(result.nodes.entered);
              var newEntering = startProgress4(enteringNames)(empty4);
              return discard53(liftEffect54(reheat(state3.lesMisGUPSimulation.value0)))(function() {
                return discard53(modify_15(function(v1) {
                  var $124 = {};
                  for (var $125 in v1) {
                    if ({}.hasOwnProperty.call(v1, $125)) {
                      $124[$125] = v1[$125];
                    }
                    ;
                  }
                  ;
                  $124.lesMisGUPVisibleIds = allNodeIds;
                  $124.lesMisGUPEntering = newEntering;
                  $124.lesMisGUPExiting = [];
                  return $124;
                }))(function() {
                  return log8("Reset to full dataset");
                });
              });
            });
          }
          ;
          return pure121(unit);
        });
      }
      ;
      throw new Error("Failed pattern match at Component.Tour.TourMotion (line 100, column 16 - line 305, column 24): " + [v2.constructor.name]);
    };
  };
  var component31 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return {
          gupFiber: Nothing.value,
          colorMixingTrigger: Nothing.value,
          staggeredTrigger: Nothing.value,
          lesMisCleanup: Nothing.value,
          lesMisGUPModel: Nothing.value,
          lesMisGUPVisibleIds: empty8,
          lesMisGUPEntering: empty4,
          lesMisGUPExiting: [],
          lesMisGUPSimulation: Nothing.value
        };
      },
      render: render35,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        handleAction: handleAction30(dictMonadAff),
        initialize: new Just(Initialize31.value),
        finalize: new Just(Finalize5.value)
      })
    });
  };

  // output/Component.Tour.TourProfessional/index.js
  var discard54 = /* @__PURE__ */ discard(discardUnit)(bindHalogenM);
  var pure78 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize32 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var render36 = function(v2) {
    return div2([classes(["tutorial-page"])])([renderHeader2(TourProfessional.value), main_([section([classes(["tutorial-section", "tutorial-intro"])])([h1([classes(["tutorial-title"])])([text5("2. Typical Charts")]), p_([text5("Real-world examples of common chart types showing state-level US population data and economic indicators. These are the kinds of charts you'd typically create for data analysis and reporting - more complex than the foundations, but without hierarchies, animations, transitions, or physical simulations.")]), p_([text5("Each example demonstrates best practices for scales, axes, legends, and color coding to create clear and informative visualizations.")])]), section([classes(["tutorial-section"]), id3("grouped-bar")])([h2([classes(["tutorial-section-title"])])([text5("1. Grouped Bar Chart")]), p_([text5("US population by state and age group. This grouped bar chart shows population distribution across 6 states (CA, TX, FL, NY, PA, IL) broken down into 9 age groups. Each state has its own cluster of bars, with colors representing different age groups.")]), div2([classes(["tutorial-viz-container"])])([div2([id3("grouped-bar-viz"), classes(["grouped-bar-viz"])])([])]), p_([text5("The chart uses nested band scales: an outer scale positions each state cluster, and an inner scale positions individual bars within each cluster. The population values are scaled linearly to bar heights, with colors from the Spectral color scheme to distinguish age groups.")]), p_([text5("View this example "), a([href4("#" + routeToPath(new Example("grouped-bar-chart")))])([text5("with full source code")]), text5(".")])]), section([classes(["tutorial-section"]), id3("multi-line")])([h2([classes(["tutorial-section-title"])])([text5("2. Multi-Line Chart")]), p_([text5("Unemployment rates over time for 42 US metro areas from 2000 to 2013. This chart shows how unemployment fluctuated across the country, clearly illustrating the impact of the 2008 financial crisis and subsequent recovery. With so many overlapping lines, the data would be impossible to read without interaction.")]), div2([classes(["tutorial-viz-container"])])([div2([id3("multi-line-viz"), classes(["multi-line-viz"])])([])]), p_([text5("All lines are drawn in light gray using SVG path elements. The chart uses linear scales for time (x-axis) and unemployment percentage (y-axis), with axis labels for context.")]), p_([strong_([text5("Try hovering over the lines! ")]), text5("This is the key feature: when you hover over any line, it darkens while the others remain light gray, making it easy to trace that individual metro area through the tangle of overlapping data. This demonstrates a fundamental advantage of web-based visualization over print: interactivity makes complex, dense datasets readable. In a static image, these 42 overlapping lines would be nearly impossible to interpret.")])]), section([classes(["tutorial-section"]), id3("radial-stacked")])([h2([classes(["tutorial-section-title"])])([text5("3. Radial Stacked Bar Chart")]), p_([text5('The same US state population data as the grouped bar chart, but visualized in polar coordinates. Each state gets a wedge around the circle, with age groups stacked radially from the center outward. This "sunburst-like" layout efficiently uses space and creates an aesthetically pleasing circular composition.')]), div2([classes(["tutorial-viz-container"])])([div2([id3("radial-stacked-viz"), classes(["radial-stacked-viz"])])([])]), p_([text5("Radial charts work best for cyclical or seasonal data, but we're using the same state population data here to demonstrate how the same dataset can be visualized in multiple ways. The chart uses polar coordinates with an angular scale (\u03B8) dividing the circle by states and a radial scale (r) for population. Arc paths are generated for each segment, with the same Spectral color scheme as the grouped bar chart. State labels are positioned around the perimeter.")])])])]);
  };
  var handleAction31 = function(dictMonadAff) {
    var liftEffect54 = liftEffect(monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    return function(v2) {
      return discard54(liftEffect54(groupedBarChart("#grouped-bar-viz")))(function() {
        return discard54(liftEffect54(multiLineChart("#multi-line-viz")))(function() {
          return discard54(liftEffect54(radialStackedBar("#radial-stacked-viz")))(function() {
            return pure78(unit);
          });
        });
      });
    };
  };
  var component32 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render36,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction31(dictMonadAff),
        initialize: new Just(Initialize32.value)
      })
    });
  };

  // output/D3.Viz.Simpsons.App/foreign.js
  function formatWithCommas(str23) {
    return str23.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  }

  // output/D3.Viz.Simpsons.Pie/index.js
  var append37 = /* @__PURE__ */ append(semigroupArray);
  var pieWithSort = function(getValue4) {
    return function(sortFn) {
      return function(items2) {
        var total = foldl4(function(acc) {
          return function(item) {
            return acc + getValue4(item);
          };
        })(0)(items2);
        var tau6 = 2 * pi;
        var sorted = (function() {
          if (sortFn instanceof Nothing) {
            return items2;
          }
          ;
          if (sortFn instanceof Just) {
            return sortBy(function(a3) {
              return function(b10) {
                return sortFn.value0(getValue4(a3))(getValue4(b10));
              };
            })(items2);
          }
          ;
          throw new Error("Failed pattern match at D3.Viz.Simpsons.Pie (line 55, column 14 - line 57, column 83): " + [sortFn.constructor.name]);
        })();
        var accumulate = function(acc) {
          return function(item) {
            var value20 = getValue4(item);
            var proportion = (function() {
              var $7 = total > 0;
              if ($7) {
                return value20 / total;
              }
              ;
              return 0;
            })();
            var arcAngle = proportion * tau6;
            var slice6 = {
              datum: item,
              value: value20,
              startAngle: acc.angle,
              endAngle: acc.angle + arcAngle,
              padAngle: 0
            };
            return {
              angle: acc.angle + arcAngle,
              slices: append37(acc.slices)([slice6])
            };
          };
        };
        var result = foldl4(accumulate)({
          angle: 0,
          slices: []
        })(sorted);
        return result.slices;
      };
    };
  };
  var pie = function(getValue4) {
    return function(items2) {
      return pieWithSort(getValue4)(Nothing.value)(items2);
    };
  };

  // output/D3.Viz.Simpsons.Types/index.js
  var Male = /* @__PURE__ */ (function() {
    function Male2() {
    }
    ;
    Male2.value = new Male2();
    return Male2;
  })();
  var Female = /* @__PURE__ */ (function() {
    function Female2() {
    }
    ;
    Female2.value = new Female2();
    return Female2;
  })();
  var eqGender = {
    eq: function(x32) {
      return function(y32) {
        if (x32 instanceof Male && y32 instanceof Male) {
          return true;
        }
        ;
        if (x32 instanceof Female && y32 instanceof Female) {
          return true;
        }
        ;
        return false;
      };
    }
  };
  var ordGender = {
    compare: function(x32) {
      return function(y32) {
        if (x32 instanceof Male && y32 instanceof Male) {
          return EQ.value;
        }
        ;
        if (x32 instanceof Male) {
          return LT.value;
        }
        ;
        if (y32 instanceof Male) {
          return GT.value;
        }
        ;
        if (x32 instanceof Female && y32 instanceof Female) {
          return EQ.value;
        }
        ;
        throw new Error("Failed pattern match at D3.Viz.Simpsons.Types (line 0, column 0 - line 0, column 0): " + [x32.constructor.name, y32.constructor.name]);
      };
    },
    Eq0: function() {
      return eqGender;
    }
  };
  var womenByDept = [{
    accepted: 9,
    applied: 2
  }, {
    accepted: 2,
    applied: 1
  }, {
    accepted: 18,
    applied: 35
  }, {
    accepted: 13,
    applied: 23
  }, {
    accepted: 9,
    applied: 28
  }, {
    accepted: 2,
    applied: 29
  }];
  var red = "#E74C3C";
  var rates = {
    male: {
      hard: 0.256,
      easy: 0.624
    },
    female: {
      hard: 0.265,
      easy: 0.797
    }
  };
  var purple = "#9b59b6";
  var population = {
    male: 2691,
    female: 1835
  };
  var overallAcceptanceRates = {
    male: 0.44,
    female: 0.35
  };
  var menByDept = [{
    accepted: 55,
    applied: 36
  }, {
    accepted: 33,
    applied: 21
  }, {
    accepted: 12,
    applied: 20
  }, {
    accepted: 14,
    applied: 30
  }, {
    accepted: 5,
    applied: 13
  }, {
    accepted: 2,
    applied: 25
  }];
  var isParadox = function(combined) {
    return combined.male > combined.female;
  };
  var green = "#1abc9c";
  var gray = "#bdc3c7";
  var defaultProportions = {
    easyFemale: 0.6,
    easyMale: 0.4
  };
  var calculateDepartments = function(props) {
    return {
      easy: {
        male: {
          applied: toNumber(population.male) * props.easyMale,
          admitted: toNumber(population.male) * props.easyMale * rates.male.easy
        },
        female: {
          applied: toNumber(population.female) * props.easyFemale,
          admitted: toNumber(population.female) * props.easyFemale * rates.female.easy
        }
      },
      hard: {
        male: {
          applied: toNumber(population.male) * (1 - props.easyMale),
          admitted: toNumber(population.male) * (1 - props.easyMale) * rates.male.hard
        },
        female: {
          applied: toNumber(population.female) * (1 - props.easyFemale),
          admitted: toNumber(population.female) * (1 - props.easyFemale) * rates.female.hard
        }
      }
    };
  };
  var calculateCombined = function(depts) {
    return {
      male: (depts.easy.male.admitted + depts.hard.male.admitted) / toNumber(population.male),
      female: (depts.easy.female.admitted + depts.hard.female.admitted) / toNumber(population.female)
    };
  };
  var deriveData = function(props) {
    var depts = calculateDepartments(props);
    var comb = calculateCombined(depts);
    return {
      departments: depts,
      combined: comb,
      isParadox: isParadox(comb)
    };
  };
  var blue = "#3498DB";
  var black2 = "#2C3E50";

  // output/D3.Viz.Simpsons.DataTable/index.js
  var bind82 = /* @__PURE__ */ bind(bindEffect);
  var mapFlipped17 = /* @__PURE__ */ mapFlipped(functorEffect);
  var for_8 = /* @__PURE__ */ for_(applicativeEffect);
  var for_13 = /* @__PURE__ */ for_8(foldableMaybe);
  var width44 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var num36 = /* @__PURE__ */ num(numExprEvalD);
  var height44 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr41 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text42 = /* @__PURE__ */ text6(stringExprEvalD);
  var fill36 = /* @__PURE__ */ fill(toAttributeValueString);
  var stroke25 = /* @__PURE__ */ stroke(toAttributeValueString);
  var strokeWidth24 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var bind133 = /* @__PURE__ */ bind(bindD3v2M);
  var select47 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var renderTree69 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(ordUnit);
  var pure79 = /* @__PURE__ */ pure(applicativeD3v2M);
  var path14 = /* @__PURE__ */ path(toAttributeValueString);
  var x31 = /* @__PURE__ */ x(toAttributeValueNumber);
  var y31 = /* @__PURE__ */ y(toAttributeValueNumber);
  var textAnchor17 = /* @__PURE__ */ textAnchor(toAttributeValueString);
  var fontSize15 = /* @__PURE__ */ fontSize(toAttributeValueNumber);
  var textContent17 = /* @__PURE__ */ textContent2(toAttributeValueString);
  var show74 = /* @__PURE__ */ show(showInt);
  var transform13 = /* @__PURE__ */ transform2(toAttributeValueString);
  var show131 = /* @__PURE__ */ show(showNumber);
  var append122 = /* @__PURE__ */ append(semigroupArray);
  var cx22 = /* @__PURE__ */ cx(toAttributeValueNumber);
  var cy22 = /* @__PURE__ */ cy(toAttributeValueNumber);
  var r25 = /* @__PURE__ */ r(toAttributeValueNumber);
  var attr113 = /* @__PURE__ */ attr3(toAttributeValueNumber);
  var map92 = /* @__PURE__ */ map(functorArray);
  var discard55 = /* @__PURE__ */ discard(discardUnit);
  var for_23 = /* @__PURE__ */ for_8(foldableArray);
  var for_32 = /* @__PURE__ */ for_(applicativeD3v2M)(foldableArray);
  var discard214 = /* @__PURE__ */ discard55(bindD3v2M);
  var sliceToDatum = function(slice6) {
    return {
      startAngle: slice6.startAngle,
      endAngle: slice6.endAngle
    };
  };
  var sliceColor = function(v2) {
    if (v2 === "accepted") {
      return blue;
    }
    ;
    if (v2 === "rejected") {
      return red;
    }
    ;
    return "#999";
  };
  var defaultMiniDonutConfig = /* @__PURE__ */ (function() {
    return {
      size: 85,
      outerRadius: 85 / 2.3,
      innerRadius: 85 / 2.3 - 10,
      highlightRadius: 85 / 2.1,
      labelSize: 12
    };
  })();
  var defaultBarConfig = /* @__PURE__ */ (function() {
    return {
      width: 50,
      height: 20,
      maxValue: toNumber(population.male)
    };
  })();
  var configureArc = function(innerR) {
    return function(outerR) {
      return setArcOuterRadius_(setArcInnerRadius_(arcGenerator_(unit))(innerR))(outerR);
    };
  };
  var clearContainer3 = function(selector) {
    return function __do7() {
      var doc = mapFlipped17(bind82(windowImpl)(document2))(toDocument)();
      var parentNode3 = toParentNode(doc);
      var maybeEl = querySelector(selector)(parentNode3)();
      return for_13(maybeEl)(function(el) {
        return setTextContent("")(toNode(el));
      })();
    };
  };
  var buildRowData = function(derived) {
    var hardMaleRate = rates.male.hard * 100;
    var hardFemaleRate = rates.female.hard * 100;
    var easyMaleRate = rates.male.easy * 100;
    var easyFemaleRate = rates.female.easy * 100;
    var combinedMaleRate = derived.combined.male * 100;
    var combinedMaleApplied = derived.departments.easy.male.applied + derived.departments.hard.male.applied;
    var combinedMaleAdmitted = derived.departments.easy.male.admitted + derived.departments.hard.male.admitted;
    var combinedFemaleRate = derived.combined.female * 100;
    var combinedFemaleApplied = derived.departments.easy.female.applied + derived.departments.hard.female.applied;
    var combinedFemaleAdmitted = derived.departments.easy.female.admitted + derived.departments.hard.female.admitted;
    return [{
      department: '"Easy"',
      maleApplied: derived.departments.easy.male.applied,
      femaleApplied: derived.departments.easy.female.applied,
      maleAdmitted: derived.departments.easy.male.admitted,
      femaleAdmitted: derived.departments.easy.female.admitted,
      maleRate: easyMaleRate,
      femaleRate: easyFemaleRate,
      maleWins: easyMaleRate > easyFemaleRate,
      femaleWins: easyFemaleRate > easyMaleRate
    }, {
      department: '"Hard"',
      maleApplied: derived.departments.hard.male.applied,
      femaleApplied: derived.departments.hard.female.applied,
      maleAdmitted: derived.departments.hard.male.admitted,
      femaleAdmitted: derived.departments.hard.female.admitted,
      maleRate: hardMaleRate,
      femaleRate: hardFemaleRate,
      maleWins: hardMaleRate > hardFemaleRate,
      femaleWins: hardFemaleRate > hardMaleRate
    }, {
      department: "Combined",
      maleApplied: combinedMaleApplied,
      femaleApplied: combinedFemaleApplied,
      maleAdmitted: combinedMaleAdmitted,
      femaleAdmitted: combinedFemaleAdmitted,
      maleRate: combinedMaleRate,
      femaleRate: combinedFemaleRate,
      maleWins: combinedMaleRate > combinedFemaleRate,
      femaleWins: combinedFemaleRate > combinedMaleRate
    }];
  };
  var barChart2 = function(config) {
    return function(value20) {
      return function(gender) {
        var fillColor = (function() {
          if (gender instanceof Male) {
            return purple;
          }
          ;
          if (gender instanceof Female) {
            return green;
          }
          ;
          throw new Error("Failed pattern match at D3.Viz.Simpsons.DataTable (line 96, column 17 - line 98, column 22): " + [gender.constructor.name]);
        })();
        var barWidth = value20 / config.maxValue * config.width;
        return withChildren(elem3(SVG.value)([width44(num36(config.width)), height44(num36(config.height)), viewBox(0)(0)(config.width)(config.height), attr41("class")(text42("bar-chart-svg"))]))([elem3(Rect.value)([width44(num36(config.width)), height44(num36(config.height)), fill36(text42("none")), stroke25(text42(gray)), strokeWidth24(num36(2))]), elem3(Rect.value)([width44(num36(barWidth)), height44(num36(config.height)), fill36(text42(fillColor))])]);
      };
    };
  };
  var renderBar = function(containerId) {
    return function(value20) {
      return function(gender) {
        return bind133(select47(containerId))(function(container) {
          return bind133(renderTree69(container)(barChart2(defaultBarConfig)(value20)(gender)))(function() {
            return pure79(unit);
          });
        });
      };
    };
  };
  var arcCentroid = function(innerR) {
    return function(outerR) {
      return function(slice6) {
        var midRadius = (innerR + outerR) / 2;
        var midAngle = (slice6.startAngle + slice6.endAngle) / 2 - 1.5707963267948966;
        return {
          x: midRadius * cos(midAngle),
          y: midRadius * sin(midAngle)
        };
      };
    };
  };
  var miniDonutChart = function(config) {
    return function(acceptedPercent) {
      return function(isWinner) {
        var sliceData = [{
          label: "rejected",
          percent: 100 - acceptedPercent
        }, {
          label: "accepted",
          percent: acceptedPercent
        }];
        var slices = pie(function(v2) {
          return v2.percent;
        })(sliceData);
        var indexedSlices = mapWithIndex3(function(i2) {
          return function(s3) {
            return {
              index: i2,
              slice: s3
            };
          };
        })(slices);
        var highlightOpacity = (function() {
          if (isWinner) {
            return 0.6;
          }
          ;
          return 0;
        })();
        var centerY = config.size / 2;
        var centerX = config.size / 2;
        var arcGen = configureArc(config.innerRadius)(config.outerRadius);
        var mkArcElem = function(v2) {
          var centroid = arcCentroid(config.innerRadius)(config.outerRadius)(v2.slice);
          return withChildren(elem3(Group.value)([attr41("class")(text42("arc"))]))([elem3(Path.value)([path14(text42(arcPath_(arcGen)(sliceToDatum(v2.slice)))), fill36(text42(sliceColor(v2.slice.datum.label))), stroke25(text42("#2C3E50")), strokeWidth24(num36(1))]), elem3(Text.value)([x31(num36(centroid.x)), y31(num36(centroid.y)), textAnchor17(text42("middle")), fontSize15(num36(config.labelSize)), fill36(text42("#34495e")), textContent17(text42(show74(round2(v2.slice.datum.percent)) + "%"))])]);
        };
        return withChildren(elem3(SVG.value)([width44(num36(config.size)), height44(num36(config.size)), viewBox(0)(0)(config.size)(config.size), attr41("class")(text42("mini-donut-svg"))]))([withChildren(elem3(Group.value)([transform13(text42("translate(" + (show131(centerX) + ("," + (show131(centerY) + ")")))))]))(append122([elem3(Circle.value)([cx22(num36(0)), cy22(num36(0)), r25(num36(config.highlightRadius)), fill36(text42("none")), stroke25(text42("#333")), strokeWidth24(num36(4)), attr113("stroke-opacity")(num36(highlightOpacity))])])(map92(mkArcElem)(indexedSlices)))]);
      };
    };
  };
  var renderDonut = function(containerId) {
    return function(rate) {
      return function(isWinner) {
        return bind133(select47(containerId))(function(container) {
          return bind133(renderTree69(container)(miniDonutChart(defaultMiniDonutConfig)(rate)(isWinner)))(function() {
            return pure79(unit);
          });
        });
      };
    };
  };
  var initDataTable = function(derived) {
    var rows4 = buildRowData(derived);
    return function __do7() {
      for_23(mapWithIndex3(function(i2) {
        return function(v2) {
          return i2;
        };
      })(rows4))(function(idx) {
        var prefix = "#row-" + show74(idx);
        return function __do8() {
          clearContainer3(prefix + "-male-applied")();
          clearContainer3(prefix + "-female-applied")();
          clearContainer3(prefix + "-male-admitted")();
          clearContainer3(prefix + "-female-admitted")();
          clearContainer3(prefix + "-male-rate")();
          return clearContainer3(prefix + "-female-rate")();
        };
      })();
      return runD3v2M(for_32(mapWithIndex3(function(i2) {
        return function(row) {
          return {
            idx: i2,
            row
          };
        };
      })(rows4))(function(v2) {
        var prefix = "row-" + show74(v2.idx);
        return discard214(renderBar("#" + (prefix + "-male-applied"))(v2.row.maleApplied)(Male.value))(function() {
          return discard214(renderBar("#" + (prefix + "-female-applied"))(v2.row.femaleApplied)(Female.value))(function() {
            return discard214(renderBar("#" + (prefix + "-male-admitted"))(v2.row.maleAdmitted)(Male.value))(function() {
              return discard214(renderBar("#" + (prefix + "-female-admitted"))(v2.row.femaleAdmitted)(Female.value))(function() {
                return discard214(renderDonut("#" + (prefix + "-male-rate"))(v2.row.maleRate)(v2.row.maleWins))(function() {
                  return renderDonut("#" + (prefix + "-female-rate"))(v2.row.femaleRate)(v2.row.femaleWins);
                });
              });
            });
          });
        });
      }))();
    };
  };
  var updateDataTable = initDataTable;

  // output/D3.Viz.Simpsons.DonutChart/index.js
  var compare20 = /* @__PURE__ */ compare(ordInt);
  var attr42 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text43 = /* @__PURE__ */ text6(stringExprEvalD);
  var textAnchor18 = /* @__PURE__ */ textAnchor(toAttributeValueString);
  var fill37 = /* @__PURE__ */ fill(toAttributeValueString);
  var fontSize16 = /* @__PURE__ */ fontSize(toAttributeValueNumber);
  var num37 = /* @__PURE__ */ num(numExprEvalD);
  var transform14 = /* @__PURE__ */ transform2(toAttributeValueString);
  var show75 = /* @__PURE__ */ show(showNumber);
  var textContent18 = /* @__PURE__ */ textContent2(toAttributeValueString);
  var path15 = /* @__PURE__ */ path(toAttributeValueString);
  var stroke26 = /* @__PURE__ */ stroke(toAttributeValueString);
  var strokeWidth25 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var show132 = /* @__PURE__ */ show(showInt);
  var eqIndexedSlice = {
    eq: function(v2) {
      return function(v1) {
        return v2.index === v1.index;
      };
    }
  };
  var ordIndexedSlice = {
    compare: function(v2) {
      return function(v1) {
        return compare20(v2.index)(v1.index);
      };
    },
    Eq0: function() {
      return eqIndexedSlice;
    }
  };
  var sliceToDatum2 = function(slice6) {
    return {
      startAngle: slice6.startAngle,
      endAngle: slice6.endAngle
    };
  };
  var sliceColor2 = function(v2) {
    if (v2 === "accepted") {
      return blue;
    }
    ;
    if (v2 === "rejected") {
      return red;
    }
    ;
    return "#999";
  };
  var prepareDonutData = function(config) {
    return function(acceptedPercent) {
      return function(label5) {
        var sliceData = [{
          label: "rejected",
          percent: 100 - acceptedPercent
        }, {
          label: "accepted",
          percent: acceptedPercent
        }];
        var slices = pie(function(v2) {
          return v2.percent;
        })(sliceData);
        var indexedSlices = mapWithIndex3(function(i2) {
          return function(s3) {
            return {
              index: i2,
              slice: s3
            };
          };
        })(slices);
        return {
          slices: indexedSlices,
          label: label5,
          config
        };
      };
    };
  };
  var donutChartLabel = function(donutData) {
    return elem3(Text.value)([attr42("dy")(text43("0.35em")), textAnchor18(text43("middle")), fill37(text43(black2)), fontSize16(num37(14)), transform14(text43("translate(0," + (show75(donutData.config.outerRadius + 20) + ")"))), textContent18(text43(donutData.label))]);
  };
  var defaultConfig6 = {
    outerRadius: 60,
    innerRadius: 40,
    centerX: 70,
    centerY: 70,
    showLabels: true
  };
  var configureArc2 = function(innerR) {
    return function(outerR) {
      return setArcOuterRadius_(setArcInnerRadius_(arcGenerator_(unit))(innerR))(outerR);
    };
  };
  var arcCentroid2 = function(innerR) {
    return function(outerR) {
      return function(slice6) {
        var midRadius = (innerR + outerR) / 2;
        var midAngle = (slice6.startAngle + slice6.endAngle) / 2 - 1.5707963267948966;
        return {
          x: midRadius * cos(midAngle),
          y: midRadius * sin(midAngle)
        };
      };
    };
  };
  var donutChartArcs = function(donutData) {
    var arcGen = configureArc2(donutData.config.innerRadius)(donutData.config.outerRadius);
    return joinData("arcs")("g")(donutData.slices)(function(v2) {
      return withChildren(elem3(Group.value)([attr42("class")(text43("arc"))]))([elem3(Path.value)([path15(text43(arcPath_(arcGen)(sliceToDatum2(v2.slice)))), fill37(text43(sliceColor2(v2.slice.datum.label))), stroke26(text43(black2)), strokeWidth25(num37(1))]), elem3(Text.value)([transform14(text43("translate(" + (show75(arcCentroid2(donutData.config.innerRadius)(donutData.config.outerRadius)(v2.slice).x) + ("," + (show75(arcCentroid2(donutData.config.innerRadius)(donutData.config.outerRadius)(v2.slice).y) + ")"))))), attr42("dy")(text43("0.35em")), textAnchor18(text43("middle")), fill37(text43(black2)), fontSize16(num37(12)), textContent18(text43(show132(round2(v2.slice.datum.percent)) + "%"))])]);
    });
  };
  var donutChart = function(config) {
    return function(acceptedPercent) {
      return function(label5) {
        var donutData = prepareDonutData(config)(acceptedPercent)(label5);
        var centerTransform = "translate(" + (show75(config.centerX) + ("," + (show75(config.centerY) + ")")));
        return {
          arcs: donutChartArcs(donutData),
          label: donutChartLabel(donutData),
          centerTransform
        };
      };
    };
  };

  // output/D3.Viz.Simpsons.ForceViz/foreign.js
  function setTimeout_2(effect) {
    return (delay2) => () => {
      return setTimeout(() => effect(), delay2);
    };
  }

  // output/D3.Viz.Simpsons.ForceDirected/index.js
  var append38 = /* @__PURE__ */ append(semigroupArray);
  var map93 = /* @__PURE__ */ map(functorArray);
  var genderY = function(config) {
    return function(gender) {
      var innerHeight8 = config.height - config.marginTop - config.marginBottom;
      if (gender instanceof Female) {
        return config.marginTop + innerHeight8 * 0.25;
      }
      ;
      if (gender instanceof Male) {
        return config.marginTop + innerHeight8 * 0.75;
      }
      ;
      throw new Error("Failed pattern match at D3.Viz.Simpsons.ForceDirected (line 145, column 5 - line 147, column 52): " + [gender.constructor.name]);
    };
  };
  var departmentX = function(config) {
    return function(deptIdx) {
      var innerWidth8 = config.width - config.marginLeft - config.marginRight;
      var spacing = innerWidth8 / toNumber(6 + 1 | 0);
      return config.marginLeft + spacing * toNumber(deptIdx + 1 | 0);
    };
  };
  var defaultConfig7 = {
    width: 600,
    height: 400,
    nodeRadius: 2.5,
    marginLeft: 50,
    marginRight: 50,
    marginTop: 50,
    marginBottom: 50
  };
  var createApplicants = function(config) {
    var acceptedOffset = -12;
    var createDeptApplicants = function(gender) {
      return function(deptIdx) {
        return function(deptData) {
          var rejected = replicate(deptData.applied - deptData.accepted | 0)(false);
          var baseY = genderY(config)(gender);
          var baseX = departmentX(config)(deptIdx);
          var accepted = replicate(deptData.accepted)(true);
          var allStatus = append38(accepted)(rejected);
          return map93(function(isAccepted) {
            var targetX$prime = (function() {
              if (isAccepted) {
                return baseX + acceptedOffset;
              }
              ;
              return baseX - acceptedOffset;
            })();
            return {
              id: 0,
              gender,
              department: deptIdx,
              accepted: isAccepted,
              x: targetX$prime,
              y: baseY,
              targetX: targetX$prime,
              targetY: baseY
            };
          })(allStatus);
        };
      };
    };
    var menApplicants = concat(mapWithIndex3(createDeptApplicants(Male.value))(menByDept));
    var womenApplicants = concat(mapWithIndex3(createDeptApplicants(Female.value))(womenByDept));
    var allApplicants = append38(womenApplicants)(menApplicants);
    return mapWithIndex3(function(idx) {
      return function(app) {
        return {
          accepted: app.accepted,
          department: app.department,
          gender: app.gender,
          targetX: app.targetX,
          targetY: app.targetY,
          x: app.x,
          y: app.y,
          id: idx
        };
      };
    })(allApplicants);
  };
  var combinedX = function(config) {
    return config.marginLeft + (config.width - config.marginLeft - config.marginRight) / 2;
  };

  // output/D3.Viz.Simpsons.ForceViz/index.js
  var bind83 = /* @__PURE__ */ bind(bindD3v2M);
  var liftEffect45 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var select48 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var from9 = /* @__PURE__ */ from3(showNumber);
  var r26 = /* @__PURE__ */ r(toAttributeValueNumber);
  var num38 = /* @__PURE__ */ num(numExprEvalD);
  var stroke27 = /* @__PURE__ */ stroke(toAttributeValueString);
  var text44 = /* @__PURE__ */ text6(stringExprEvalD);
  var strokeWidth26 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var renderTree70 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D);
  var ordRecord23 = /* @__PURE__ */ ordRecord();
  var ordRecordCons22 = /* @__PURE__ */ ordRecordCons(ordRecordNil)();
  var genderIsSymbol = {
    reflectSymbol: function() {
      return "gender";
    }
  };
  var ordNullable7 = /* @__PURE__ */ ordNullable(ordNumber);
  var renderTree122 = /* @__PURE__ */ renderTree70(/* @__PURE__ */ ordRecord23(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons22({
    reflectSymbol: function() {
      return "y";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "x";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "vy";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "vx";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "id";
    }
  })(ordInt))()({
    reflectSymbol: function() {
      return "gridY";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "gridX";
    }
  })(ordNumber))()(genderIsSymbol)(ordGender))()({
    reflectSymbol: function() {
      return "fy";
    }
  })(ordNullable7))()({
    reflectSymbol: function() {
      return "fx";
    }
  })(ordNullable7))()({
    reflectSymbol: function() {
      return "department";
    }
  })(ordInt))()({
    reflectSymbol: function() {
      return "accepted";
    }
  })(ordBoolean)));
  var pure80 = /* @__PURE__ */ pure(applicativeD3v2M);
  var attr43 = /* @__PURE__ */ attr3(toAttributeValueNumber);
  var textAnchor19 = /* @__PURE__ */ textAnchor(toAttributeValueString);
  var fontSize17 = /* @__PURE__ */ fontSize(toAttributeValueNumber);
  var eq16 = /* @__PURE__ */ eq(eqGender);
  var renderTree222 = /* @__PURE__ */ renderTree70(/* @__PURE__ */ ordRecord23(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons22({
    reflectSymbol: function() {
      return "label";
    }
  })(ordString))()(genderIsSymbol)(ordGender)));
  var fill38 = /* @__PURE__ */ fill(toAttributeValueString);
  var renderTree314 = /* @__PURE__ */ renderTree70(/* @__PURE__ */ ordRecord23(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons22({
    reflectSymbol: function() {
      return "name";
    }
  })(ordString))()({
    reflectSymbol: function() {
      return "idx";
    }
  })(ordInt)));
  var traverse6 = /* @__PURE__ */ traverse(traversableArray)(applicativeEffect);
  var map94 = /* @__PURE__ */ map(functorEffect);
  var discard56 = /* @__PURE__ */ discard(discardUnit);
  var insert15 = /* @__PURE__ */ insert(ordString);
  var width45 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var height45 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var attr114 = /* @__PURE__ */ attr3(toAttributeValueString);
  var renderTree411 = /* @__PURE__ */ renderTree70(ordUnit);
  var discard215 = /* @__PURE__ */ discard56(bindD3v2M);
  var not4 = /* @__PURE__ */ not(heytingAlgebraBoolean);
  var when7 = /* @__PURE__ */ when(applicativeEffect);
  var tick4 = function(stateRef) {
    var nodeColor2 = function(node) {
      if (node.accepted) {
        return blue;
      }
      ;
      return red;
    };
    return runD3v2M(bind83(liftEffect45(read(stateRef)))(function(state3) {
      return bind83(select48("#force-viz-applicants"))(function(nodesGroup) {
        var nodesTree = joinData("applicants")("circle")(state3.nodes)(function(v2) {
          return elem3(Circle.value)([from9("cx")(function(v1) {
            return v1.x;
          }), from9("cy")(function(v1) {
            return v1.y;
          }), r26(num38(state3.config.nodeRadius)), fromStr("fill")(nodeColor2), stroke27(text44("white")), strokeWidth26(num38(0.5))]);
        });
        return bind83(renderTree122(nodesGroup)(nodesTree))(function() {
          return pure80(unit);
        });
      });
    }));
  };
  var renderGenderLabels = function(config) {
    return function(parent2) {
      return runD3v2M((function() {
        var genders = [{
          gender: Female.value,
          label: "Women"
        }, {
          gender: Male.value,
          label: "Men"
        }];
        var labelsTree = joinData("gender-labels")("text")(genders)(function(v2) {
          return elem3(Text.value)([attr43("x")(num38(15)), from9("y")(function(v1) {
            return genderY(config)(v1.gender);
          }), textAnchor19(text44("start")), fontSize17(num38(14)), fromStr("fill")(function(v1) {
            var $131 = eq16(v1.gender)(Female.value);
            if ($131) {
              return green;
            }
            ;
            return purple;
          }), fromStr("textContent")(function(v1) {
            return v1.label;
          })]);
        });
        return bind83(renderTree222(parent2)(labelsTree))(function() {
          return pure80(unit);
        });
      })());
    };
  };
  var renderDepartmentLabels = function(config) {
    return function(parent2) {
      return runD3v2M((function() {
        var deptNames = ["A", "B", "C", "D", "E", "F"];
        var labelData = mapWithIndex3(function(i2) {
          return function(name16) {
            return {
              idx: i2,
              name: name16
            };
          };
        })(deptNames);
        var labelsTree = joinData("dept-labels")("text")(labelData)(function(v2) {
          return elem3(Text.value)([from9("x")(function(v1) {
            return departmentX(config)(v1.idx);
          }), attr43("y")(num38(config.marginTop - 10)), textAnchor19(text44("middle")), fontSize17(num38(12)), fill38(text44(black2)), fromStr("textContent")(function(v1) {
            return v1.name;
          })]);
        });
        return bind83(renderTree314(parent2)(labelsTree))(function() {
          return pure80(unit);
        });
      })());
    };
  };
  var createApplicantNodes = function(config) {
    var baseApplicants = createApplicants(config);
    return traverse6(function(app) {
      return function __do7() {
        var dx = map94(function(r1) {
          return (r1 - 0.5) * 40;
        })(random)();
        var dy = map94(function(r1) {
          return (r1 - 0.5) * 40;
        })(random)();
        return {
          id: app.id,
          x: app.x + dx,
          y: app.y + dy,
          vx: 0,
          vy: 0,
          fx: nullImpl,
          fy: nullImpl,
          gender: app.gender,
          department: app.department,
          accepted: app.accepted,
          gridX: app.targetX,
          gridY: app.targetY
        };
      };
    })(baseApplicants);
  };
  var initForceViz = function(selector) {
    return function __do7() {
      var nodes3 = createApplicantNodes(defaultConfig7)();
      var isCombinedRef = $$new(false)();
      var stateRef = $$new({
        nodes: nodes3,
        config: defaultConfig7
      })();
      var sim = create5(defaultConfig2)();
      setNodes(nodes3)(sim)();
      var forceXHandle = createForceXGrid(0.15);
      initializeForce(forceXHandle)(nodes3)();
      modify_2(insert15("forceX")(forceXHandle))(sim.forces)();
      var forceYHandle = createForceYGrid(0.15);
      initializeForce(forceYHandle)(nodes3)();
      modify_2(insert15("forceY")(forceYHandle))(sim.forces)();
      addForce(new Collide("collide", {
        radius: defaultConfig7.nodeRadius + 0.5,
        strength: 0.7,
        iterations: 2
      }))(sim)();
      runD3v2M(bind83(select48(selector))(function(container) {
        var containerTree = withChildren(named(SVG.value)("svg")([width45(num38(defaultConfig7.width)), height45(num38(defaultConfig7.height)), viewBox(0)(0)(defaultConfig7.width)(defaultConfig7.height), attr114("class")(text44("force-viz-svg"))]))([withChildren(elem3(Group.value)([]))([named(Group.value)("dept-labels")([attr114("class")(text44("dept-labels")), attr114("id")(text44("force-viz-dept-labels"))]), named(Group.value)("gender-labels")([attr114("class")(text44("gender-labels")), attr114("id")(text44("force-viz-gender-labels"))]), named(Group.value)("applicants")([attr114("class")(text44("applicants")), attr114("id")(text44("force-viz-applicants"))])])]);
        return bind83(renderTree411(container)(containerTree))(function() {
          return pure80(unit);
        });
      }))();
      runD3v2M(bind83(select48("#force-viz-dept-labels"))(function(deptLabelsParent) {
        return discard215(liftEffect45(renderDepartmentLabels(defaultConfig7)(deptLabelsParent)))(function() {
          return bind83(select48("#force-viz-gender-labels"))(function(genderLabelsParent) {
            return liftEffect45(renderGenderLabels(defaultConfig7)(genderLabelsParent));
          });
        });
      }))();
      onTick(tick4(stateRef))(sim)();
      start3(sim)();
      var updateX = function(xFn) {
        return updateGridXYAndReinit(new Just(xFn))(Nothing.value)(forceXHandle)(Nothing.value)(sim);
      };
      var twoGroupsXFn = function(node) {
        var baseX = combinedX(defaultConfig7);
        if (node.accepted) {
          return baseX - 12;
        }
        ;
        return baseX + 12;
      };
      var separatedXFn = function(node) {
        var baseX = departmentX(defaultConfig7)(node.department);
        if (node.accepted) {
          return baseX - 12;
        }
        ;
        return baseX + 12;
      };
      var fourGroupsXFn = function(node) {
        var baseX = combinedX(defaultConfig7);
        if (node.accepted) {
          return baseX - 60;
        }
        ;
        return baseX + 60;
      };
      var toggle2 = function __do8() {
        var isCombined = read(isCombinedRef)();
        var newMode = !isCombined;
        write(newMode)(isCombinedRef)();
        if (newMode) {
          updateX(fourGroupsXFn)();
          setTimeout_2(function __do9() {
            var stillCombined = read(isCombinedRef)();
            return when7(stillCombined)(updateX(twoGroupsXFn))();
          })(1200)();
          return unit;
        }
        ;
        updateX(fourGroupsXFn)();
        setTimeout_2(function __do9() {
          var stillSeparated = map94(not4)(read(isCombinedRef))();
          return when7(stillSeparated)(updateX(separatedXFn))();
        })(1200)();
        return unit;
      };
      return {
        toggle: toggle2,
        stop: stop(sim),
        isCombined: read(isCombinedRef)
      };
    };
  };

  // output/D3.Viz.Simpsons.LineChart/index.js
  var compare21 = /* @__PURE__ */ compare(ordInt);
  var show76 = /* @__PURE__ */ show(showNumber);
  var attr44 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text45 = /* @__PURE__ */ text6(stringExprEvalD);
  var path16 = /* @__PURE__ */ path(toAttributeValueString);
  var stroke28 = /* @__PURE__ */ stroke(toAttributeValueString);
  var strokeWidth27 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var num39 = /* @__PURE__ */ num(numExprEvalD);
  var fill39 = /* @__PURE__ */ fill(toAttributeValueString);
  var cx23 = /* @__PURE__ */ cx(toAttributeValueNumber);
  var cy23 = /* @__PURE__ */ cy(toAttributeValueNumber);
  var r27 = /* @__PURE__ */ r(toAttributeValueNumber);
  var transform15 = /* @__PURE__ */ transform2(toAttributeValueString);
  var textAnchor20 = /* @__PURE__ */ textAnchor(toAttributeValueString);
  var fontSize18 = /* @__PURE__ */ fontSize(toAttributeValueNumber);
  var textContent19 = /* @__PURE__ */ textContent2(toAttributeValueString);
  var eqIndexedRatePoint = {
    eq: function(v2) {
      return function(v1) {
        return v2.index === v1.index;
      };
    }
  };
  var ordIndexedRatePoint = {
    compare: function(v2) {
      return function(v1) {
        return compare21(v2.index)(v1.index);
      };
    },
    Eq0: function() {
      return eqIndexedRatePoint;
    }
  };
  var pathFromPoints = function(xScale) {
    return function(yScale) {
      return function(pts) {
        var go2 = function(isFirst) {
          return function(arr) {
            var v2 = uncons4(arr);
            if (v2 instanceof Nothing) {
              return "";
            }
            ;
            if (v2 instanceof Just) {
              var py = yScale(v2.value0.head.y);
              var px = xScale(v2.value0.head.x);
              var cmd = (function() {
                if (isFirst) {
                  return "M ";
                }
                ;
                return " L ";
              })();
              return cmd + (show76(px) + (" " + (show76(py) + go2(false)(v2.value0.tail))));
            }
            ;
            throw new Error("Failed pattern match at D3.Viz.Simpsons.LineChart (line 227, column 22 - line 235, column 60): " + [v2.constructor.name]);
          };
        };
        return go2(true)(pts);
      };
    };
  };
  var innerWidth6 = function(c2) {
    return c2.width - c2.marginLeft - c2.marginRight;
  };
  var innerHeight6 = function(c2) {
    return c2.height - c2.marginTop - c2.marginBottom;
  };
  var lineChartPoints = function(config) {
    return function(props) {
      var womenX = props.easyFemale * 100;
      var menX = props.easyMale * 100;
      var iw = innerWidth6(config);
      var xScale = function(v2) {
        return v2 / 100 * iw;
      };
      var ih = innerHeight6(config);
      var yScale = function(v2) {
        return ih - v2 / 100 * ih;
      };
      var derived = deriveData(props);
      var menY = derived.combined.male * 100;
      var womenY = derived.combined.female * 100;
      var points = [{
        x: womenX,
        y: womenY,
        color: green
      }, {
        x: menX,
        y: menY,
        color: purple
      }];
      var indexedPoints = mapWithIndex3(function(i2) {
        return function(p2) {
          return {
            index: i2,
            point: p2
          };
        };
      })(points);
      return joinData("rate-points")("g")(indexedPoints)(function(v2) {
        return withChildren(elem3(Group.value)([]))([elem3(Path.value)([attr44("class")(text45("guide-line")), path16(text45("M 0 " + (show76(yScale(v2.point.y)) + (" L " + (show76(xScale(v2.point.x)) + (" " + show76(yScale(v2.point.y)))))))), stroke28(text45(black2)), strokeWidth27(num39(1)), attr44("stroke-dasharray")(text45("5,5")), fill39(text45("none"))]), elem3(Circle.value)([cx23(num39(xScale(v2.point.x))), cy23(num39(yScale(v2.point.y))), r27(num39(6)), fill39(text45(v2.point.color)), stroke28(text45("white")), strokeWidth27(num39(1))])]);
      });
    };
  };
  var lineChartStatic = function(config) {
    var womenLine = [{
      x: 0,
      y: rates.female.hard * 100
    }, {
      x: 100,
      y: rates.female.easy * 100
    }];
    var menLine = [{
      x: 0,
      y: rates.male.hard * 100
    }, {
      x: 100,
      y: rates.male.easy * 100
    }];
    var iw = innerWidth6(config);
    var xAxisScale = {
      domain: {
        min: 0,
        max: 100
      },
      range: {
        min: 0,
        max: iw
      }
    };
    var xScale = function(v2) {
      return v2 / 100 * iw;
    };
    var ih = innerHeight6(config);
    var yAxisScale = {
      domain: {
        min: 0,
        max: 100
      },
      range: {
        min: ih,
        max: 0
      }
    };
    var yScale = function(v2) {
      return ih - v2 / 100 * ih;
    };
    return withChildren(elem3(Group.value)([attr44("class")(text45("line-chart-static"))]))([withChildren(elem3(Group.value)([attr44("class")(text45("y-axis"))]))([renderAxis(axisLeft(yAxisScale)), elem3(Text.value)([transform15(text45("translate(-35," + (show76(ih / 2) + ") rotate(-90)"))), textAnchor20(text45("middle")), fontSize18(num39(12)), textContent19(text45("% admitted"))])]), withChildren(elem3(Group.value)([transform15(text45("translate(0," + (show76(ih) + ")"))), attr44("class")(text45("x-axis"))]))([renderAxis(axisBottom(xAxisScale)), elem3(Text.value)([transform15(text45("translate(" + (show76(iw / 2) + ",40)"))), textAnchor20(text45("middle")), fontSize18(num39(12)), textContent19(text45("% applied to easy department"))])]), elem3(Path.value)([attr44("class")(text45("rate-line women")), path16(text45(pathFromPoints(xScale)(yScale)(womenLine))), stroke28(text45(green)), strokeWidth27(num39(1.5)), fill39(text45("none"))]), elem3(Path.value)([attr44("class")(text45("rate-line men")), path16(text45(pathFromPoints(xScale)(yScale)(menLine))), stroke28(text45(purple)), strokeWidth27(num39(1.5)), fill39(text45("none"))])]);
  };
  var defaultConfig8 = {
    width: 320,
    height: 300,
    marginTop: 40,
    marginRight: 20,
    marginBottom: 55,
    marginLeft: 45
  };

  // output/D3.Viz.Simpsons.ScatterChart/index.js
  var compare23 = /* @__PURE__ */ compare(ordInt);
  var show77 = /* @__PURE__ */ show(showNumber);
  var attr45 = /* @__PURE__ */ attr3(toAttributeValueString);
  var text46 = /* @__PURE__ */ text6(stringExprEvalD);
  var transform16 = /* @__PURE__ */ transform2(toAttributeValueString);
  var textAnchor21 = /* @__PURE__ */ textAnchor(toAttributeValueString);
  var fontSize19 = /* @__PURE__ */ fontSize(toAttributeValueNumber);
  var num40 = /* @__PURE__ */ num(numExprEvalD);
  var textContent20 = /* @__PURE__ */ textContent2(toAttributeValueString);
  var path17 = /* @__PURE__ */ path(toAttributeValueString);
  var stroke29 = /* @__PURE__ */ stroke(toAttributeValueString);
  var strokeWidth28 = /* @__PURE__ */ strokeWidth(toAttributeValueNumber);
  var fill40 = /* @__PURE__ */ fill(toAttributeValueString);
  var cx24 = /* @__PURE__ */ cx(toAttributeValueNumber);
  var cy24 = /* @__PURE__ */ cy(toAttributeValueNumber);
  var r28 = /* @__PURE__ */ r(toAttributeValueNumber);
  var width46 = /* @__PURE__ */ width8(toAttributeValueNumber);
  var height46 = /* @__PURE__ */ height8(toAttributeValueNumber);
  var eqIndexedPoint = {
    eq: function(v2) {
      return function(v1) {
        return v2.index === v1.index;
      };
    }
  };
  var ordIndexedPoint = {
    compare: function(v2) {
      return function(v1) {
        return compare23(v2.index)(v1.index);
      };
    },
    Eq0: function() {
      return eqIndexedPoint;
    }
  };
  var purplePoints = [{
    x: 8,
    y: 1,
    color: purple
  }, {
    x: 9,
    y: 2,
    color: purple
  }, {
    x: 10,
    y: 3,
    color: purple
  }, {
    x: 11,
    y: 4,
    color: purple
  }];
  var pathFromPoints2 = function(xScale) {
    return function(yScale) {
      return function(pts) {
        var go2 = function(isFirst) {
          return function(arr) {
            var v2 = uncons4(arr);
            if (v2 instanceof Nothing) {
              return "";
            }
            ;
            if (v2 instanceof Just) {
              var py = yScale(v2.value0.head.y);
              var px = xScale(v2.value0.head.x);
              var cmd = (function() {
                if (isFirst) {
                  return "M ";
                }
                ;
                return " L ";
              })();
              return cmd + (show77(px) + (" " + (show77(py) + go2(false)(v2.value0.tail))));
            }
            ;
            throw new Error("Failed pattern match at D3.Viz.Simpsons.ScatterChart (line 223, column 22 - line 231, column 60): " + [v2.constructor.name]);
          };
        };
        return go2(true)(pts);
      };
    };
  };
  var innerWidth7 = function(c2) {
    return c2.width - c2.marginLeft - c2.marginRight;
  };
  var innerHeight7 = function(c2) {
    return c2.height - c2.marginTop - c2.marginBottom;
  };
  var scatterChartStatic = function(config) {
    var purpleTrendLine = [{
      x: 7,
      y: 0
    }, {
      x: 13,
      y: 6
    }];
    var overallTrendLine = [{
      x: 0,
      y: 8.2
    }, {
      x: 13,
      y: 1
    }];
    var iw = innerWidth7(config);
    var xAxisScale = {
      domain: {
        min: 0,
        max: 12
      },
      range: {
        min: 0,
        max: iw
      }
    };
    var xScale = function(v2) {
      return v2 / 12 * iw;
    };
    var ih = innerHeight7(config);
    var yAxisScale = {
      domain: {
        min: 0,
        max: 10
      },
      range: {
        min: ih,
        max: 0
      }
    };
    var yScale = function(v2) {
      return ih - v2 / 10 * ih;
    };
    var greenTrendLine = [{
      x: 0,
      y: 5
    }, {
      x: 6,
      y: 11
    }];
    return withChildren(elem3(Group.value)([attr45("class")(text46("chart-static"))]))([withChildren(elem3(Group.value)([attr45("class")(text46("y-axis"))]))([renderAxis(axisLeft(yAxisScale)), elem3(Text.value)([transform16(text46("translate(-28," + (show77(ih / 2) + ") rotate(-90)"))), textAnchor21(text46("middle")), fontSize19(num40(12)), textContent20(text46("y"))])]), withChildren(elem3(Group.value)([transform16(text46("translate(0," + (show77(ih) + ")"))), attr45("class")(text46("x-axis"))]))([renderAxis(axisBottom(xAxisScale)), elem3(Text.value)([transform16(text46("translate(" + (show77(iw / 2) + ",35)"))), textAnchor21(text46("middle")), fontSize19(num40(12)), textContent20(text46("x"))])]), elem3(Path.value)([attr45("class")(text46("trend-line green")), path17(text46(pathFromPoints2(xScale)(yScale)(greenTrendLine))), stroke29(text46(green)), strokeWidth28(num40(1.5)), fill40(text46("none"))]), elem3(Path.value)([attr45("class")(text46("trend-line purple")), path17(text46(pathFromPoints2(xScale)(yScale)(purpleTrendLine))), stroke29(text46(purple)), strokeWidth28(num40(1.5)), fill40(text46("none"))]), elem3(Path.value)([attr45("class")(text46("trend-line overall")), path17(text46(pathFromPoints2(xScale)(yScale)(overallTrendLine))), stroke29(text46(gray)), strokeWidth28(num40(1.5)), attr45("stroke-dasharray")(text46("4,3")), fill40(text46("none"))])]);
  };
  var greenPoints = [{
    x: 1,
    y: 6,
    color: green
  }, {
    x: 2,
    y: 7,
    color: green
  }, {
    x: 3,
    y: 8,
    color: green
  }, {
    x: 4,
    y: 9,
    color: green
  }];
  var defaultConfig9 = {
    width: 380,
    height: 260,
    marginTop: 20,
    marginRight: 10,
    marginBottom: 40,
    marginLeft: 40
  };
  var allPoints = /* @__PURE__ */ append(semigroupArray)(greenPoints)(purplePoints);
  var scatterChartPoints = function(config) {
    var iw = innerWidth7(config);
    var xScale = function(v2) {
      return v2 / 12 * iw;
    };
    var indexedPoints = mapWithIndex3(function(i2) {
      return function(p2) {
        return {
          index: i2,
          point: p2
        };
      };
    })(allPoints);
    var ih = innerHeight7(config);
    var yScale = function(v2) {
      return ih - v2 / 10 * ih;
    };
    return joinData("points")("circle")(indexedPoints)(function(v2) {
      return elem3(Circle.value)([cx24(num40(xScale(v2.point.x))), cy24(num40(yScale(v2.point.y))), r28(num40(6)), fill40(text46(v2.point.color)), stroke29(text46("white")), strokeWidth28(num40(1))]);
    });
  };
  var scatterChart = function(config) {
    return {
      "static": scatterChartStatic(config),
      points: scatterChartPoints(config),
      containerAttrs: [width46(num40(config.width)), height46(num40(config.height)), viewBox(0)(0)(config.width)(config.height), attr45("class")(text46("scatter-chart"))]
    };
  };

  // output/D3.Viz.Simpsons.App/index.js
  var bind84 = /* @__PURE__ */ bind(bindD3v2M);
  var select49 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var renderTree71 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D);
  var renderTree123 = /* @__PURE__ */ renderTree71(ordIndexedRatePoint);
  var pure81 = /* @__PURE__ */ pure(applicativeD3v2M);
  var type_21 = /* @__PURE__ */ type_18(isPropInputType);
  var value17 = /* @__PURE__ */ value12(isPropString);
  var show78 = /* @__PURE__ */ show(showNumber);
  var show133 = /* @__PURE__ */ show(showInt);
  var str19 = /* @__PURE__ */ str(stringExprEvalD);
  var renderTree223 = /* @__PURE__ */ renderTree71(ordUnit);
  var renderTree315 = /* @__PURE__ */ renderTree71(ordIndexedPoint);
  var v3Attr17 = /* @__PURE__ */ v3Attr(showNumber);
  var lit18 = /* @__PURE__ */ lit(numExprEvalD);
  var renderTree412 = /* @__PURE__ */ renderTree71(ordIndexedSlice);
  var discard57 = /* @__PURE__ */ discard(discardUnit);
  var discard216 = /* @__PURE__ */ discard57(bindD3v2M);
  var discard310 = /* @__PURE__ */ discard57(bindHalogenM);
  var bind219 = /* @__PURE__ */ bind(bindHalogenM);
  var get17 = /* @__PURE__ */ get(monadStateHalogenM);
  var modify_16 = /* @__PURE__ */ modify_(monadStateHalogenM);
  var when8 = /* @__PURE__ */ when(applicativeHalogenM);
  var Initialize33 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var SetMaleProportion = /* @__PURE__ */ (function() {
    function SetMaleProportion2(value0) {
      this.value0 = value0;
    }
    ;
    SetMaleProportion2.create = function(value0) {
      return new SetMaleProportion2(value0);
    };
    return SetMaleProportion2;
  })();
  var SetFemaleProportion = /* @__PURE__ */ (function() {
    function SetFemaleProportion2(value0) {
      this.value0 = value0;
    }
    ;
    SetFemaleProportion2.create = function(value0) {
      return new SetFemaleProportion2(value0);
    };
    return SetFemaleProportion2;
  })();
  var ToggleCombined = /* @__PURE__ */ (function() {
    function ToggleCombined2() {
    }
    ;
    ToggleCombined2.value = new ToggleCombined2();
    return ToggleCombined2;
  })();
  var Render = /* @__PURE__ */ (function() {
    function Render3() {
    }
    ;
    Render3.value = new Render3();
    return Render3;
  })();
  var updateLineChart = function(props) {
    return runD3v2M(bind84(select49("#line-chart .rate-points-group"))(function(pointsContainer) {
      return bind84(renderTree123(pointsContainer)(lineChartPoints(defaultConfig8)(props)))(function() {
        return pure81(unit);
      });
    }));
  };
  var renderSlider = function(label5) {
    return function(value1) {
      return function(color2) {
        return function(action2) {
          return div2([classes(["simpsons-slider"])])([label4([style("color: " + color2)])([text5(label5)]), input([type_21(InputRange.value), min5(0), max6(100), value17(show78(value1 * 100)), step3(new Step(1)), style("accent-color: " + color2), onValueInput(function(val) {
            return action2(fromMaybe(value1 * 100)(fromString(val)) / 100);
          })]), span_([text5(show133(round2(value1 * 100)) + "%")])]);
        };
      };
    };
  };
  var renderScatterSection = /* @__PURE__ */ section([/* @__PURE__ */ classes(["simpsons-scatter"])])([/* @__PURE__ */ h2_([/* @__PURE__ */ text5("The Paradox Explained")]), /* @__PURE__ */ p_([/* @__PURE__ */ text5("Simpson's Paradox occurs when grouped data shows one trend, but combined data shows the opposite.")]), /* @__PURE__ */ div2([/* @__PURE__ */ id3("scatter-chart"), /* @__PURE__ */ classes(["scatter-chart"])])([]), /* @__PURE__ */ p_([/* @__PURE__ */ text5("In each color group, y increases with x. But overall, y decreases with x!")])]);
  var renderInteractiveSection = function(state3) {
    return function(derived) {
      return section([classes(["simpsons-interactive"])])([h2_([text5("Interactive Demonstration")]), p_([text5("Adjust the sliders to see how the distribution of applicants affects overall rates.")]), div2([classes(["simpsons-sliders"])])([renderSlider("Women to Easy Dept")(state3.proportions.easyFemale)(green)(SetFemaleProportion.create), renderSlider("Men to Easy Dept")(state3.proportions.easyMale)(purple)(SetMaleProportion.create)]), div2([id3("line-chart"), classes(["line-chart"])])([]), div2([classes(["simpsons-paradox-indicator", (function() {
        if (derived.isParadox) {
          return "is-paradox";
        }
        ;
        return "no-paradox";
      })()])])([(function() {
        if (derived.isParadox) {
          return text5("Simpson's Paradox is present! Men have higher overall rate despite lower per-department rates.");
        }
        ;
        return text5("No paradox - the group with higher per-department rates also has higher overall rate.");
      })()])]);
    };
  };
  var renderHeader3 = /* @__PURE__ */ header([/* @__PURE__ */ classes(["simpsons-header"])])([/* @__PURE__ */ h1_([/* @__PURE__ */ text5("Simpson's Paradox")]), /* @__PURE__ */ p_([/* @__PURE__ */ text5("How grouped and combined statistics can show opposite trends")])]);
  var renderForceSection = function(state3) {
    return section([classes(["simpsons-force"])])([h2_([text5("Applicant Cohorts")]), p_([text5("Each dot represents an applicant. Blue = accepted, Red = rejected.")]), button2([classes(["simpsons-toggle"]), onClick(function(v2) {
      return ToggleCombined.value;
    })])([text5((function() {
      if (state3.isCombined) {
        return "Separate by Department";
      }
      ;
      return "Combine All";
    })())]), div2([id3("force-viz"), classes(["force-viz"])])([])]);
  };
  var renderDonutSection = /* @__PURE__ */ section([/* @__PURE__ */ classes(["simpsons-donuts"])])([/* @__PURE__ */ h2_([/* @__PURE__ */ text5("UC Berkeley Graduate Admissions (1973)")]), /* @__PURE__ */ p_([/* @__PURE__ */ text5("The data initially appeared to show discrimination against women:")]), /* @__PURE__ */ div2([/* @__PURE__ */ classes(["simpsons-donuts-container"])])([/* @__PURE__ */ div2([/* @__PURE__ */ id3("donut-men"), /* @__PURE__ */ classes(["donut-chart"])])([]), /* @__PURE__ */ div2([/* @__PURE__ */ id3("donut-women"), /* @__PURE__ */ classes(["donut-chart"])])([])]), /* @__PURE__ */ p([/* @__PURE__ */ classes(["simpsons-paradox-note"])])([/* @__PURE__ */ text5("But wait... when you look at admission rates "), /* @__PURE__ */ em_([/* @__PURE__ */ text5("by department")]), /* @__PURE__ */ text5(", women were actually admitted at "), /* @__PURE__ */ strong_([/* @__PURE__ */ text5("higher rates")]), /* @__PURE__ */ text5(" in most departments!")])]);
  var renderCredits = /* @__PURE__ */ footer([/* @__PURE__ */ classes(["simpsons-credits"])])([/* @__PURE__ */ p_([/* @__PURE__ */ text5("Based on the visualization by "), /* @__PURE__ */ a([/* @__PURE__ */ href4("https://setosa.io/simpsons/"), /* @__PURE__ */ target6("_blank")])([/* @__PURE__ */ text5("Lewis Lehe & Victor Powell")]), /* @__PURE__ */ text5(" (2014). Reimplemented in PureScript using "), /* @__PURE__ */ a([/* @__PURE__ */ href4("https://github.com/psd3/psd3"), /* @__PURE__ */ target6("_blank")])([/* @__PURE__ */ text5("PS<$>D3")]), /* @__PURE__ */ text5(".")])]);
  var initialState3 = function(v2) {
    return {
      proportions: defaultProportions,
      isCombined: false,
      initialized: false
    };
  };
  var initScatterChart = /* @__PURE__ */ bind84(/* @__PURE__ */ select49("#scatter-chart"))(function(container) {
    var chart = scatterChart(defaultConfig9);
    var svgTree = withChildren(elem3(SVG.value)(chart.containerAttrs))([withChildren(elem3(Group.value)([v3AttrStr("transform")(str19("translate(" + (show78(defaultConfig9.marginLeft) + ("," + (show78(defaultConfig9.marginTop) + ")")))))]))([chart["static"]])]);
    return bind84(renderTree223(container)(svgTree))(function() {
      return bind84(select49("#scatter-chart svg"))(function(pointsContainer) {
        var pointsGroup = elem3(Group.value)([v3AttrStr("transform")(str19("translate(" + (show78(defaultConfig9.marginLeft) + ("," + (show78(defaultConfig9.marginTop) + ")"))))), v3AttrStr("class")(str19("points"))]);
        return bind84(renderTree223(pointsContainer)(pointsGroup))(function() {
          return bind84(select49("#scatter-chart svg .points"))(function(pointsInner) {
            return bind84(renderTree315(pointsInner)(chart.points))(function() {
              return pure81(unit);
            });
          });
        });
      });
    });
  });
  var initLineChart = /* @__PURE__ */ bind84(/* @__PURE__ */ select49("#line-chart"))(function(container) {
    var svgTree = withChildren(elem3(SVG.value)([v3Attr17("width")(lit18(defaultConfig8.width)), v3Attr17("height")(lit18(defaultConfig8.height)), v3AttrStr("viewBox")(str19("0 0 " + (show78(defaultConfig8.width) + (" " + show78(defaultConfig8.height))))), v3AttrStr("class")(str19("line-chart-svg"))]))([withChildren(elem3(Group.value)([v3AttrStr("transform")(str19("translate(" + (show78(defaultConfig8.marginLeft) + ("," + (show78(defaultConfig8.marginTop) + ")")))))]))([lineChartStatic(defaultConfig8)]), elem3(Group.value)([v3AttrStr("transform")(str19("translate(" + (show78(defaultConfig8.marginLeft) + ("," + (show78(defaultConfig8.marginTop) + ")"))))), v3AttrStr("class")(str19("rate-points-group"))])]);
    return bind84(renderTree223(container)(svgTree))(function() {
      return pure81(unit);
    });
  });
  var initDonutCharts = /* @__PURE__ */ bind84(/* @__PURE__ */ select49("#donut-men"))(function(menContainer) {
    var menDonut = donutChart(defaultConfig6)(overallAcceptanceRates.male * 100)("Men");
    var menTree = withChildren(elem3(SVG.value)([v3Attr17("width")(lit18(defaultConfig6.centerX * 2)), v3Attr17("height")(lit18(defaultConfig6.centerY + defaultConfig6.outerRadius + 30)), v3AttrStr("viewBox")(str19("0 0 " + (show78(defaultConfig6.centerX * 2) + (" " + show78(defaultConfig6.centerY + defaultConfig6.outerRadius + 30))))), v3AttrStr("class")(str19("donut-svg"))]))([withChildren(elem3(Group.value)([v3AttrStr("transform")(str19(menDonut.centerTransform))]))([menDonut.label])]);
    return bind84(renderTree223(menContainer)(menTree))(function() {
      return bind84(select49("#donut-men svg"))(function(menArcsContainer) {
        var menArcsGroup = elem3(Group.value)([v3AttrStr("transform")(str19(menDonut.centerTransform)), v3AttrStr("class")(str19("arcs"))]);
        return bind84(renderTree223(menArcsContainer)(menArcsGroup))(function() {
          return bind84(select49("#donut-men svg .arcs"))(function(menArcsInner) {
            return bind84(renderTree412(menArcsInner)(menDonut.arcs))(function() {
              return bind84(select49("#donut-women"))(function(womenContainer) {
                var womenDonut = donutChart(defaultConfig6)(overallAcceptanceRates.female * 100)("Women");
                var womenTree = withChildren(elem3(SVG.value)([v3Attr17("width")(lit18(defaultConfig6.centerX * 2)), v3Attr17("height")(lit18(defaultConfig6.centerY + defaultConfig6.outerRadius + 30)), v3AttrStr("viewBox")(str19("0 0 " + (show78(defaultConfig6.centerX * 2) + (" " + show78(defaultConfig6.centerY + defaultConfig6.outerRadius + 30))))), v3AttrStr("class")(str19("donut-svg"))]))([withChildren(elem3(Group.value)([v3AttrStr("transform")(str19(womenDonut.centerTransform))]))([womenDonut.label])]);
                return bind84(renderTree223(womenContainer)(womenTree))(function() {
                  return bind84(select49("#donut-women svg"))(function(womenArcsContainer) {
                    var womenArcsGroup = elem3(Group.value)([v3AttrStr("transform")(str19(womenDonut.centerTransform)), v3AttrStr("class")(str19("arcs"))]);
                    return bind84(renderTree223(womenArcsContainer)(womenArcsGroup))(function() {
                      return bind84(select49("#donut-women svg .arcs"))(function(womenArcsInner) {
                        return bind84(renderTree412(womenArcsInner)(womenDonut.arcs))(function() {
                          return pure81(unit);
                        });
                      });
                    });
                  });
                });
              });
            });
          });
        });
      });
    });
  });
  var formatNumber = function(n) {
    return formatWithCommas(show133(round2(n)));
  };
  var renderDataTable = function(_state) {
    return function(derived) {
      var rows4 = buildRowData(derived);
      return section([classes(["simpsons-table"])])([h2_([text5("Illustration")]), p([classes(["simpsons-table-description"])])([text5("Suppose there are two departments: one easy, one hard ('hard' as in 'hard to get into'). The sliders below set what percentage each gender applies to the easy department. Both departments prefer women, but if too many women apply to the hard one, their acceptance rate drops below the men's.")]), table([classes(["simpsons-data-table"])])([thead_([tr_([th_([text5("departments")]), th([colSpan2(2)])([text5("# applied")]), th([colSpan2(2)])([text5("# admitted")]), th([colSpan2(2)])([text5("% admitted")])]), tr([classes(["simpsons-subheader"])])([th_([]), th([style("color: " + purple)])([text5("men")]), th([style("color: " + green)])([text5("women")]), th([style("color: " + purple)])([text5("men")]), th([style("color: " + green)])([text5("women")]), th([style("color: " + purple)])([text5("men")]), th([style("color: " + green)])([text5("women")])])]), tbody_(mapWithIndex3(function(idx) {
        return function(row) {
          var prefix = "row-" + show133(idx);
          return tr_([td([classes(["simpsons-dept-name"])])([text5(row.department)]), td([classes(["simpsons-data-cell"])])([span_([text5(formatNumber(row.maleApplied))]), div2([id3(prefix + "-male-applied"), classes(["bar-container"])])([])]), td([classes(["simpsons-data-cell"])])([span_([text5(formatNumber(row.femaleApplied))]), div2([id3(prefix + "-female-applied"), classes(["bar-container"])])([])]), td([classes(["simpsons-data-cell"])])([span_([text5(formatNumber(row.maleAdmitted))]), div2([id3(prefix + "-male-admitted"), classes(["bar-container"])])([])]), td([classes(["simpsons-data-cell"])])([span_([text5(formatNumber(row.femaleAdmitted))]), div2([id3(prefix + "-female-admitted"), classes(["bar-container"])])([])]), td([classes(["simpsons-donut-cell"])])([div2([id3(prefix + "-male-rate"), classes(["donut-container"])])([])]), td([classes(["simpsons-donut-cell"])])([div2([id3(prefix + "-female-rate"), classes(["donut-container"])])([])])]);
        };
      })(rows4))]), div2([classes(["simpsons-paradox-result", (function() {
        if (derived.isParadox) {
          return "is-paradox";
        }
        ;
        return "no-paradox";
      })()])])([strong_([text5("Simpson's paradox? ")]), span_([text5((function() {
        if (derived.isParadox) {
          return "yes";
        }
        ;
        return "no";
      })())])])]);
    };
  };
  var render37 = function(state3) {
    var derived = deriveData(state3.proportions);
    return div2([classes(["simpsons-paradox"])])([renderHeader3, renderDonutSection, renderScatterSection, renderInteractiveSection(state3)(derived), renderDataTable(state3)(derived), renderForceSection(state3), renderCredits]);
  };
  var forceVizHandleRef = /* @__PURE__ */ (function() {
    return unsafePerformEffect($$new(Nothing.value));
  })();
  var initForceViz2 = function __do5() {
    var handle = initForceViz("#force-viz")();
    return write(new Just(handle))(forceVizHandleRef)();
  };
  var initializeCharts = function(derived) {
    return function __do7() {
      runD3v2M(discard216(initDonutCharts)(function() {
        return discard216(initScatterChart)(function() {
          return initLineChart;
        });
      }))();
      initForceViz2();
      return initDataTable(derived)();
    };
  };
  var handleAction32 = function(dictMonadAff) {
    var liftAff2 = liftAff(monadAffHalogenM(dictMonadAff));
    var MonadEffect0 = dictMonadAff.MonadEffect0();
    var liftEffect54 = liftEffect(monadEffectHalogenM(MonadEffect0));
    return function(dictMonadEffect) {
      return function(v2) {
        if (v2 instanceof Initialize33) {
          return discard310(liftAff2(delay(100)))(function() {
            return bind219(get17)(function(state3) {
              var derived = deriveData(state3.proportions);
              return discard310(liftEffect54(initializeCharts(derived)))(function() {
                return discard310(modify_16(function(v1) {
                  var $58 = {};
                  for (var $59 in v1) {
                    if ({}.hasOwnProperty.call(v1, $59)) {
                      $58[$59] = v1[$59];
                    }
                    ;
                  }
                  ;
                  $58.initialized = true;
                  return $58;
                }))(function() {
                  return handleAction32(dictMonadAff)(MonadEffect0)(Render.value);
                });
              });
            });
          });
        }
        ;
        if (v2 instanceof SetMaleProportion) {
          return discard310(modify_16(function(s3) {
            var $64 = {};
            for (var $65 in s3) {
              if ({}.hasOwnProperty.call(s3, $65)) {
                $64[$65] = s3[$65];
              }
              ;
            }
            ;
            $64.proportions = (function() {
              var $61 = {};
              for (var $62 in s3.proportions) {
                if ({}.hasOwnProperty.call(s3.proportions, $62)) {
                  $61[$62] = s3["proportions"][$62];
                }
                ;
              }
              ;
              $61.easyMale = v2.value0;
              return $61;
            })();
            return $64;
          }))(function() {
            return handleAction32(dictMonadAff)(MonadEffect0)(Render.value);
          });
        }
        ;
        if (v2 instanceof SetFemaleProportion) {
          return discard310(modify_16(function(s3) {
            var $71 = {};
            for (var $72 in s3) {
              if ({}.hasOwnProperty.call(s3, $72)) {
                $71[$72] = s3[$72];
              }
              ;
            }
            ;
            $71.proportions = (function() {
              var $68 = {};
              for (var $69 in s3.proportions) {
                if ({}.hasOwnProperty.call(s3.proportions, $69)) {
                  $68[$69] = s3["proportions"][$69];
                }
                ;
              }
              ;
              $68.easyFemale = v2.value0;
              return $68;
            })();
            return $71;
          }))(function() {
            return handleAction32(dictMonadAff)(MonadEffect0)(Render.value);
          });
        }
        ;
        if (v2 instanceof ToggleCombined) {
          return discard310(modify_16(function(s3) {
            var $75 = {};
            for (var $76 in s3) {
              if ({}.hasOwnProperty.call(s3, $76)) {
                $75[$76] = s3[$76];
              }
              ;
            }
            ;
            $75.isCombined = !s3.isCombined;
            return $75;
          }))(function() {
            return liftEffect54(function __do7() {
              var maybeHandle = read(forceVizHandleRef)();
              if (maybeHandle instanceof Just) {
                return maybeHandle.value0.toggle();
              }
              ;
              if (maybeHandle instanceof Nothing) {
                return unit;
              }
              ;
              throw new Error("Failed pattern match at D3.Viz.Simpsons.App (line 453, column 7 - line 455, column 29): " + [maybeHandle.constructor.name]);
            });
          });
        }
        ;
        if (v2 instanceof Render) {
          return bind219(get17)(function(state3) {
            return when8(state3.initialized)((function() {
              var derived = deriveData(state3.proportions);
              return liftEffect54(function __do7() {
                updateLineChart(state3.proportions)();
                return updateDataTable(derived)();
              });
            })());
          });
        }
        ;
        throw new Error("Failed pattern match at D3.Viz.Simpsons.App (line 426, column 16 - line 463, column 42): " + [v2.constructor.name]);
      };
    };
  };
  var component33 = function(dictMonadAff) {
    var handleAction1 = handleAction32(dictMonadAff)(dictMonadAff.MonadEffect0());
    return function(dictMonadEffect) {
      return mkComponent({
        initialState: initialState3,
        render: render37,
        "eval": mkEval({
          handleQuery: defaultEval.handleQuery,
          receive: defaultEval.receive,
          finalize: defaultEval.finalize,
          handleAction: handleAction1,
          initialize: new Just(Initialize33.value)
        })
      });
    };
  };

  // output/Halogen.HTML/index.js
  var componentSlot2 = /* @__PURE__ */ componentSlot();
  var slot_ = function() {
    return function(dictIsSymbol) {
      var componentSlot1 = componentSlot2(dictIsSymbol);
      return function(dictOrd) {
        var componentSlot22 = componentSlot1(dictOrd);
        return function(label5) {
          return function(p2) {
            return function(component54) {
              return function(input3) {
                return widget(new ComponentSlot(componentSlot22(label5)(p2)(component54)(input3)($$const(Nothing.value))));
              };
            };
          };
        };
      };
    };
  };

  // output/Component.Tour.TourSimpsons/index.js
  var discard58 = /* @__PURE__ */ discard(discardUnit)(bindHalogenM);
  var pure82 = /* @__PURE__ */ pure(applicativeHalogenM);
  var slot_2 = /* @__PURE__ */ slot_()({
    reflectSymbol: function() {
      return "simpsons";
    }
  })(ordUnit);
  var Initialize34 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var handleAction33 = function(dictMonadAff) {
    var liftAff2 = liftAff(monadAffHalogenM(dictMonadAff));
    return function(v2) {
      return discard58(liftAff2(delay(100)))(function() {
        return pure82(unit);
      });
    };
  };
  var _simpsons = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var render38 = function(dictMonadAff) {
    var component110 = component33(dictMonadAff)(dictMonadAff.MonadEffect0());
    return function(v2) {
      return div2([classes(["showcase-page", "simpsons-showcase"])])([render4({
        logoSize: Normal.value,
        quadrant: NoQuadrant.value,
        prevNext: Nothing.value,
        pageTitle: new Just("Simpson's Paradox")
      }), slot_2(_simpsons)(unit)(component110)(unit)]);
    };
  };
  var component34 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render38(dictMonadAff),
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction33(dictMonadAff),
        initialize: new Just(Initialize34.value)
      })
    });
  };

  // output/Component.WealthHealth.Types/index.js
  var EastAsiaAndPacific = /* @__PURE__ */ (function() {
    function EastAsiaAndPacific2() {
    }
    ;
    EastAsiaAndPacific2.value = new EastAsiaAndPacific2();
    return EastAsiaAndPacific2;
  })();
  var Europe = /* @__PURE__ */ (function() {
    function Europe2() {
    }
    ;
    Europe2.value = new Europe2();
    return Europe2;
  })();
  var LatinAmericaAndCaribbean = /* @__PURE__ */ (function() {
    function LatinAmericaAndCaribbean2() {
    }
    ;
    LatinAmericaAndCaribbean2.value = new LatinAmericaAndCaribbean2();
    return LatinAmericaAndCaribbean2;
  })();
  var MiddleEastAndNorthAfrica = /* @__PURE__ */ (function() {
    function MiddleEastAndNorthAfrica2() {
    }
    ;
    MiddleEastAndNorthAfrica2.value = new MiddleEastAndNorthAfrica2();
    return MiddleEastAndNorthAfrica2;
  })();
  var SouthAsia = /* @__PURE__ */ (function() {
    function SouthAsia2() {
    }
    ;
    SouthAsia2.value = new SouthAsia2();
    return SouthAsia2;
  })();
  var SubSaharanAfrica = /* @__PURE__ */ (function() {
    function SubSaharanAfrica2() {
    }
    ;
    SubSaharanAfrica2.value = new SubSaharanAfrica2();
    return SubSaharanAfrica2;
  })();
  var NorthAmerica = /* @__PURE__ */ (function() {
    function NorthAmerica2() {
    }
    ;
    NorthAmerica2.value = new NorthAmerica2();
    return NorthAmerica2;
  })();
  var regionName = function(v2) {
    if (v2 instanceof EastAsiaAndPacific) {
      return "East Asia & Pacific";
    }
    ;
    if (v2 instanceof Europe) {
      return "Europe & Central Asia";
    }
    ;
    if (v2 instanceof LatinAmericaAndCaribbean) {
      return "Latin America & Caribbean";
    }
    ;
    if (v2 instanceof MiddleEastAndNorthAfrica) {
      return "Middle East & North Africa";
    }
    ;
    if (v2 instanceof SouthAsia) {
      return "South Asia";
    }
    ;
    if (v2 instanceof SubSaharanAfrica) {
      return "Sub-Saharan Africa";
    }
    ;
    if (v2 instanceof NorthAmerica) {
      return "North America";
    }
    ;
    throw new Error("Failed pattern match at Component.WealthHealth.Types (line 27, column 14 - line 34, column 34): " + [v2.constructor.name]);
  };
  var regionColor = function(v2) {
    if (v2 instanceof EastAsiaAndPacific) {
      return "#e41a1c";
    }
    ;
    if (v2 instanceof Europe) {
      return "#377eb8";
    }
    ;
    if (v2 instanceof LatinAmericaAndCaribbean) {
      return "#4daf4a";
    }
    ;
    if (v2 instanceof MiddleEastAndNorthAfrica) {
      return "#984ea3";
    }
    ;
    if (v2 instanceof SouthAsia) {
      return "#ff7f00";
    }
    ;
    if (v2 instanceof SubSaharanAfrica) {
      return "#ffff33";
    }
    ;
    if (v2 instanceof NorthAmerica) {
      return "#a65628";
    }
    ;
    throw new Error("Failed pattern match at Component.WealthHealth.Types (line 38, column 15 - line 45, column 28): " + [v2.constructor.name]);
  };

  // output/Component.WealthHealth.Actions/index.js
  var Initialize35 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var DataLoaded = /* @__PURE__ */ (function() {
    function DataLoaded2(value0) {
      this.value0 = value0;
    }
    ;
    DataLoaded2.create = function(value0) {
      return new DataLoaded2(value0);
    };
    return DataLoaded2;
  })();
  var DataLoadFailed = /* @__PURE__ */ (function() {
    function DataLoadFailed2(value0) {
      this.value0 = value0;
    }
    ;
    DataLoadFailed2.create = function(value0) {
      return new DataLoadFailed2(value0);
    };
    return DataLoadFailed2;
  })();
  var SetYear = /* @__PURE__ */ (function() {
    function SetYear2(value0) {
      this.value0 = value0;
    }
    ;
    SetYear2.create = function(value0) {
      return new SetYear2(value0);
    };
    return SetYear2;
  })();
  var TogglePlay = /* @__PURE__ */ (function() {
    function TogglePlay2() {
    }
    ;
    TogglePlay2.value = new TogglePlay2();
    return TogglePlay2;
  })();
  var Tick2 = /* @__PURE__ */ (function() {
    function Tick3() {
    }
    ;
    Tick3.value = new Tick3();
    return Tick3;
  })();
  var HoverNation = /* @__PURE__ */ (function() {
    function HoverNation2(value0) {
      this.value0 = value0;
    }
    ;
    HoverNation2.create = function(value0) {
      return new HoverNation2(value0);
    };
    return HoverNation2;
  })();
  var ToggleNationSelection = /* @__PURE__ */ (function() {
    function ToggleNationSelection2(value0) {
      this.value0 = value0;
    }
    ;
    ToggleNationSelection2.create = function(value0) {
      return new ToggleNationSelection2(value0);
    };
    return ToggleNationSelection2;
  })();
  var SetAnimationSpeed = /* @__PURE__ */ (function() {
    function SetAnimationSpeed2(value0) {
      this.value0 = value0;
    }
    ;
    SetAnimationSpeed2.create = function(value0) {
      return new SetAnimationSpeed2(value0);
    };
    return SetAnimationSpeed2;
  })();
  var ToggleLabels = /* @__PURE__ */ (function() {
    function ToggleLabels2() {
    }
    ;
    ToggleLabels2.value = new ToggleLabels2();
    return ToggleLabels2;
  })();
  var Render2 = /* @__PURE__ */ (function() {
    function Render3() {
    }
    ;
    Render3.value = new Render3();
    return Render3;
  })();

  // output/Component.WealthHealth.Data/foreign.js
  function parseNationsJSON(jsonString) {
    try {
      return JSON.parse(jsonString);
    } catch (e) {
      console.error("Failed to parse nations JSON:", e);
      return [];
    }
  }

  // output/Component.WealthHealth.Data/index.js
  var bind85 = /* @__PURE__ */ bind(bindMaybe);
  var pure83 = /* @__PURE__ */ pure(applicativeMaybe);
  var bind134 = /* @__PURE__ */ bind(bindArray);
  var pure122 = /* @__PURE__ */ pure(applicativeArray);
  var min16 = /* @__PURE__ */ min(ordInt);
  var maximum15 = /* @__PURE__ */ maximum(ordInt)(foldableArray);
  var minimum7 = /* @__PURE__ */ minimum(ordInt)(foldableArray);
  var div6 = /* @__PURE__ */ div(euclideanRingInt);
  var comparing3 = /* @__PURE__ */ comparing(ordNumber);
  var map96 = /* @__PURE__ */ map(functorArray);
  var pure212 = /* @__PURE__ */ pure(applicativeAff);
  var parseRegionString = function(v2) {
    if (v2 === "East Asia & Pacific") {
      return new Just(EastAsiaAndPacific.value);
    }
    ;
    if (v2 === "Europe & Central Asia") {
      return new Just(Europe.value);
    }
    ;
    if (v2 === "America") {
      return new Just(LatinAmericaAndCaribbean.value);
    }
    ;
    if (v2 === "Middle East & North Africa") {
      return new Just(MiddleEastAndNorthAfrica.value);
    }
    ;
    if (v2 === "South Asia") {
      return new Just(SouthAsia.value);
    }
    ;
    if (v2 === "Sub-Saharan Africa") {
      return new Just(SubSaharanAfrica.value);
    }
    ;
    return Nothing.value;
  };
  var parseNationData = function(raw) {
    return bind85(parseRegionString(raw.region))(function(region) {
      return pure83({
        name: raw.name,
        region,
        income: raw.income,
        population: raw.population,
        lifeExpectancy: raw.lifeExpectancy
      });
    });
  };
  var nationsDataUrl = "data/nations.json";
  var calculateYearRange = function(nations) {
    var allYears = bind134(nations)(function(nation) {
      return bind134(nation.income)(function(yearValue) {
        var v2 = index(yearValue)(0);
        if (v2 instanceof Just) {
          return pure122(floor2(v2.value0));
        }
        ;
        if (v2 instanceof Nothing) {
          return [];
        }
        ;
        throw new Error("Failed pattern match at Component.WealthHealth.Data (line 125, column 7 - line 127, column 22): " + [v2.constructor.name]);
      });
    });
    var maxYear = min16(2005)(fromMaybe(2009)(maximum15(allYears)));
    var minYear = fromMaybe(1800)(minimum7(allYears));
    return {
      min: minYear,
      max: maxYear
    };
  };
  var bisectLeft2 = function(target7) {
    return function(arr) {
      var go2 = function($copy_low) {
        return function($copy_high) {
          var $tco_var_low = $copy_low;
          var $tco_done = false;
          var $tco_result;
          function $tco_loop(low2, high2) {
            if (low2 >= high2) {
              $tco_done = true;
              return low2;
            }
            ;
            if (otherwise) {
              var mid = div6(low2 + high2 | 0)(2);
              var v2 = bind85(index(arr)(mid))(function(v1) {
                return index(v1)(0);
              });
              if (v2 instanceof Just && v2.value0 < target7) {
                $tco_var_low = mid + 1 | 0;
                $copy_high = high2;
                return;
              }
              ;
              $tco_var_low = low2;
              $copy_high = mid;
              return;
            }
            ;
            throw new Error("Failed pattern match at Component.WealthHealth.Data (line 157, column 5 - line 163, column 28): " + [low2.constructor.name, high2.constructor.name]);
          }
          ;
          while (!$tco_done) {
            $tco_result = $tco_loop($tco_var_low, $copy_high);
          }
          ;
          return $tco_result;
        };
      };
      return go2(0)(length3(arr));
    };
  };
  var interpolateValue = function(targetYear) {
    return function(dataPoints) {
      var v2 = sortBy(comparing3(function(arr) {
        return fromMaybe(0)(index(arr)(0));
      }))(dataPoints);
      if (v2.length === 0) {
        return Nothing.value;
      }
      ;
      var yearNum = toNumber(targetYear);
      var i2 = bisectLeft2(yearNum)(v2);
      return bind85(index(v2)(i2))(function(a3) {
        return bind85(index(a3)(0))(function(aYear) {
          return bind85(index(a3)(1))(function(aValue) {
            var $39 = i2 > 0;
            if ($39) {
              return bind85(index(v2)(i2 - 1 | 0))(function(b10) {
                return bind85(index(b10)(0))(function(bYear) {
                  return bind85(index(b10)(1))(function(bValue) {
                    var t2 = (yearNum - aYear) / (bYear - aYear);
                    return pure83(aValue * (1 - t2) + bValue * t2);
                  });
                });
              });
            }
            ;
            return pure83(aValue);
          });
        });
      });
    };
  };
  var fillMissingYears = function(yearRange) {
    return function(dataPoints) {
      var $$null5 = function(arr) {
        var v2 = head2(arr);
        if (v2 instanceof Nothing) {
          return true;
        }
        ;
        if (v2 instanceof Just) {
          return false;
        }
        ;
        throw new Error("Failed pattern match at Component.WealthHealth.Data (line 81, column 16 - line 83, column 22): " + [v2.constructor.name]);
      };
      var $42 = $$null5(dataPoints);
      if ($42) {
        return Nothing.value;
      }
      ;
      var fillYear = function(year2) {
        var v2 = interpolateValue(floor2(year2))(dataPoints);
        if (v2 instanceof Just) {
          return [year2, v2.value0];
        }
        ;
        if (v2 instanceof Nothing) {
          return [year2, 0];
        }
        ;
        throw new Error("Failed pattern match at Component.WealthHealth.Data (line 75, column 23 - line 77, column 31): " + [v2.constructor.name]);
      };
      var allYears = map96(toNumber)(range2(yearRange.min)(yearRange.max));
      return new Just(map96(fillYear)(allYears));
    };
  };
  var fillNationData = function(yearRange) {
    return function(nation) {
      return bind85(fillMissingYears(yearRange)(nation.income))(function(filledIncome) {
        return bind85(fillMissingYears(yearRange)(nation.population))(function(filledPopulation) {
          return bind85(fillMissingYears(yearRange)(nation.lifeExpectancy))(function(filledLifeExpectancy) {
            return pure83({
              name: nation.name,
              region: nation.region,
              income: filledIncome,
              population: filledPopulation,
              lifeExpectancy: filledLifeExpectancy
            });
          });
        });
      });
    };
  };
  var loadNationsData = /* @__PURE__ */ bind(bindAff)(/* @__PURE__ */ get5(string)(nationsDataUrl))(function(result) {
    return pure212((function() {
      if (result instanceof Left) {
        return new Left("Failed to load nations data: " + printError(result.value0));
      }
      ;
      if (result instanceof Right) {
        var rawNations = parseNationsJSON(result.value0.body);
        var nations = catMaybes(map96(parseNationData)(rawNations));
        var yearRange = calculateYearRange(nations);
        var filledNations = catMaybes(map96(fillNationData(yearRange))(nations));
        return new Right({
          nations: filledNations,
          yearRange
        });
      }
      ;
      throw new Error("Failed pattern match at Component.WealthHealth.Data (line 104, column 8 - line 115, column 50): " + [result.constructor.name]);
    })());
  });
  var getNationAtYear = function(year2) {
    return function(nation) {
      return bind85(interpolateValue(year2)(nation.income))(function(income) {
        return bind85(interpolateValue(year2)(nation.population))(function(population2) {
          return bind85(interpolateValue(year2)(nation.lifeExpectancy))(function(lifeExpectancy) {
            return pure83({
              name: nation.name,
              region: nation.region,
              year: year2,
              income,
              population: population2,
              lifeExpectancy
            });
          });
        });
      });
    };
  };
  var getAllNationsAtYear = function(year2) {
    return function(model) {
      return catMaybes(map96(getNationAtYear(year2))(model.nations));
    };
  };

  // output/Component.WealthHealth.State/index.js
  var AlwaysShow = /* @__PURE__ */ (function() {
    function AlwaysShow2() {
    }
    ;
    AlwaysShow2.value = new AlwaysShow2();
    return AlwaysShow2;
  })();
  var OnHoverOnly = /* @__PURE__ */ (function() {
    function OnHoverOnly2() {
    }
    ;
    OnHoverOnly2.value = new OnHoverOnly2();
    return OnHoverOnly2;
  })();
  var initialState4 = function(v2) {
    return {
      model: Nothing.value,
      currentYear: 1800,
      playing: false,
      hoveredNation: Nothing.value,
      selectedNations: empty8,
      animationSpeed: 5,
      animationSubscriptionId: Nothing.value,
      labelMode: OnHoverOnly.value,
      vizUpdateFn: Nothing.value
    };
  };

  // output/Component.WealthHealth.HTML/index.js
  var map97 = /* @__PURE__ */ map(functorMaybe);
  var show79 = /* @__PURE__ */ show(showInt);
  var type_22 = /* @__PURE__ */ type_18(isPropInputType);
  var value18 = /* @__PURE__ */ value12(isPropString);
  var show134 = /* @__PURE__ */ show(showNumber);
  var renderLegendItem = function(region) {
    return div2([classes(["wealth-health-legend__item"])])([span4([classes(["wealth-health-legend__color"]), style("background-color: " + regionColor(region))])([]), span4([classes(["wealth-health-legend__label"])])([text5(regionName(region))])]);
  };
  var renderControlPanel2 = function(state3) {
    var toNum = function(s3) {
      return fromString(s3);
    };
    var toInt = function(s3) {
      return map97(floor2)(toNum(s3));
    };
    return div2([classes(["wealth-health-controls"])])([div2([classes(["wealth-health-year-display"])])([text5(show79(state3.currentYear))]), div2([classes(["wealth-health-scrubber"])])([label_([text5("Year")]), input([type_22(InputRange.value), min5(toNumber(fromMaybe(1800)(map97(function(v2) {
      return v2.yearRange.min;
    })(state3.model)))), max6(toNumber(fromMaybe(2009)(map97(function(v2) {
      return v2.yearRange.max;
    })(state3.model)))), value18(show79(state3.currentYear)), step3(new Step(1)), onValueInput(function(val) {
      return new SetYear(fromMaybe(state3.currentYear)(toInt(val)));
    }), classes(["wealth-health-scrubber__slider"])])]), div2([classes(["wealth-health-playback"])])([button2([classes(["wealth-health-playback__button"]), onClick(function(v2) {
      return TogglePlay.value;
    })])([text5((function() {
      if (state3.playing) {
        return "Pause";
      }
      ;
      return "Play";
    })())])]), div2([classes(["wealth-health-speed"])])([label_([text5("Speed")]), input([type_22(InputRange.value), min5(1), max6(10), value18(show134(state3.animationSpeed)), step3(new Step(0.5)), onValueInput(function(val) {
      return new SetAnimationSpeed(fromMaybe(5)(toNum(val)));
    }), classes(["wealth-health-speed__slider"])]), span4([classes(["wealth-health-speed__value"])])([text5(show134(state3.animationSpeed) + " years/sec")])]), div2([classes(["wealth-health-labels"])])([label_([text5("Show labels:")]), button2([classes(["wealth-health-labels__toggle"]), onClick(function(v2) {
      return ToggleLabels.value;
    })])([text5((function() {
      if (state3.labelMode instanceof AlwaysShow) {
        return "Always";
      }
      ;
      if (state3.labelMode instanceof OnHoverOnly) {
        return "Only on hover";
      }
      ;
      throw new Error("Failed pattern match at Component.WealthHealth.HTML (line 79, column 25 - line 81, column 47): " + [state3.labelMode.constructor.name]);
    })())])])]);
  };
  var formatPopulation = function(n) {
    var millions = n / 1e6;
    return show79(floor2(millions)) + "M";
  };
  var formatNumber2 = function(n) {
    return show79(floor2(n));
  };
  var allRegions = /* @__PURE__ */ (function() {
    return [EastAsiaAndPacific.value, Europe.value, LatinAmericaAndCaribbean.value, MiddleEastAndNorthAfrica.value, SouthAsia.value, SubSaharanAfrica.value, NorthAmerica.value];
  })();
  var renderLegend = /* @__PURE__ */ div2([/* @__PURE__ */ classes(["wealth-health-legend"])])([/* @__PURE__ */ h3_([/* @__PURE__ */ text5("Regions")]), /* @__PURE__ */ div2([/* @__PURE__ */ classes(["wealth-health-legend__items"])])(/* @__PURE__ */ map(functorArray)(renderLegendItem)(allRegions))]);

  // output/D3.Viz.TreeAPI.WealthHealthDraw/index.js
  var v3Attr18 = /* @__PURE__ */ v3Attr(showNumber);
  var lit19 = /* @__PURE__ */ lit(numExprEvalD);
  var str20 = /* @__PURE__ */ str(stringExprEvalD);
  var show80 = /* @__PURE__ */ show(showInt);
  var max23 = /* @__PURE__ */ max(ordNumber);
  var bind86 = /* @__PURE__ */ bind(bindD3v2M);
  var select50 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var show135 = /* @__PURE__ */ show(showNumber);
  var append123 = /* @__PURE__ */ append(semigroupArray);
  var map98 = /* @__PURE__ */ map(functorArray);
  var renderTree72 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(/* @__PURE__ */ ordRecord()(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(ordRecordNil)()({
    reflectSymbol: function() {
      return "regionColor";
    }
  })(ordString))()({
    reflectSymbol: function() {
      return "region";
    }
  })(ordString))()({
    reflectSymbol: function() {
      return "population";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "name";
    }
  })(ordString))()({
    reflectSymbol: function() {
      return "lifeExpectancy";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "income";
    }
  })(ordNumber)));
  var pure84 = /* @__PURE__ */ pure(applicativeD3v2M);
  var v3AttrFn6 = /* @__PURE__ */ v3AttrFn(showNumber);
  var yTicks = [20, 30, 40, 50, 60, 70, 80];
  var xTicks = [200, 500, 1e3, 2e3, 5e3, 1e4, 2e4, 5e4, 1e5];
  var scaleY4 = function(config) {
    return function(lifeExpectancy) {
      var rangeHeight = config.height - config.marginTop - config.marginBottom;
      var normalized = (lifeExpectancy - 14) / (86 - 14);
      return config.height - config.marginBottom - normalized * rangeHeight;
    };
  };
  var yAxisTick = function(config) {
    return function(tickValue) {
      return withChildren(named(Group.value)("y-tick")([]))([elem3(Line.value)([v3Attr18("x1")(lit19(config.marginLeft - 6)), v3Attr18("x2")(lit19(config.marginLeft)), v3Attr18("y1")(lit19(scaleY4(config)(tickValue))), v3Attr18("y2")(lit19(scaleY4(config)(tickValue))), v3AttrStr("stroke")(str20("#333")), v3Attr18("stroke-width")(lit19(1))]), elem3(Text.value)([v3Attr18("x")(lit19(config.marginLeft - 10)), v3Attr18("y")(lit19(scaleY4(config)(tickValue) + 3)), v3AttrStr("text-anchor")(str20("end")), v3Attr18("font-size")(lit19(10)), v3AttrStr("fill")(str20("#333")), v3AttrStr("textContent")(str20(show80(floor2(tickValue))))])]);
    };
  };
  var scaleX4 = function(config) {
    return function(income) {
      var rangeWidth = config.width - config.marginLeft - config.marginRight;
      var logIncome = (function() {
        var $57 = income > 0;
        if ($57) {
          return log(income);
        }
        ;
        return 5.298317;
      })();
      var normalized = (logIncome - 5.298317) / (11.512925 - 5.298317);
      return config.marginLeft + normalized * rangeWidth;
    };
  };
  var verticalGridLine = function(config) {
    return function(tickValue) {
      return elem3(Line.value)([v3Attr18("x1")(lit19(0.5 + scaleX4(config)(tickValue))), v3Attr18("x2")(lit19(0.5 + scaleX4(config)(tickValue))), v3Attr18("y1")(lit19(config.marginTop)), v3Attr18("y2")(lit19(config.height - config.marginBottom))]);
    };
  };
  var scaleRadius = function(population2) {
    var normalized = population2 / 5e9;
    var scaled = sqrt(normalized) * 80;
    return max23(3)(scaled);
  };
  var horizontalGridLine = function(config) {
    return function(tickValue) {
      return elem3(Line.value)([v3Attr18("y1")(lit19(0.5 + scaleY4(config)(tickValue))), v3Attr18("y2")(lit19(0.5 + scaleY4(config)(tickValue))), v3Attr18("x1")(lit19(config.marginLeft)), v3Attr18("x2")(lit19(config.width - config.marginRight))]);
    };
  };
  var formatPopulation2 = function(n) {
    if (n >= 1e9) {
      return show80(floor2(n / 1e9)) + "B";
    }
    ;
    if (n >= 1e6) {
      return show80(floor2(n / 1e6)) + "M";
    }
    ;
    if (n >= 1e3) {
      return show80(floor2(n / 1e3)) + "K";
    }
    ;
    if (otherwise) {
      return show80(floor2(n));
    }
    ;
    throw new Error("Failed pattern match at D3.Viz.TreeAPI.WealthHealthDraw (line 302, column 1 - line 302, column 37): " + [n.constructor.name]);
  };
  var formatIncome = function(value20) {
    if (value20 >= 1e3) {
      return "$" + (show80(floor2(value20 / 1e3)) + "k");
    }
    ;
    if (otherwise) {
      return "$" + show80(floor2(value20));
    }
    ;
    throw new Error("Failed pattern match at D3.Viz.TreeAPI.WealthHealthDraw (line 86, column 1 - line 86, column 33): " + [value20.constructor.name]);
  };
  var xAxisTick = function(config) {
    return function(tickValue) {
      return withChildren(named(Group.value)("x-tick")([]))([elem3(Line.value)([v3Attr18("x1")(lit19(scaleX4(config)(tickValue))), v3Attr18("x2")(lit19(scaleX4(config)(tickValue))), v3Attr18("y1")(lit19(config.height - config.marginBottom)), v3Attr18("y2")(lit19(config.height - config.marginBottom + 6)), v3AttrStr("stroke")(str20("#333")), v3Attr18("stroke-width")(lit19(1))]), elem3(Text.value)([v3Attr18("x")(lit19(scaleX4(config)(tickValue))), v3Attr18("y")(lit19(config.height - config.marginBottom + 15)), v3AttrStr("text-anchor")(str20("middle")), v3Attr18("font-size")(lit19(10)), v3AttrStr("fill")(str20("#333")), v3AttrStr("textContent")(str20(formatIncome(tickValue)))])]);
    };
  };
  var defaultConfig10 = {
    width: 960,
    height: 560,
    marginTop: 20,
    marginRight: 20,
    marginBottom: 35,
    marginLeft: 40
  };
  var initWealthHealth = function(selector) {
    return runD3v2M(bind86(select50(selector))(function(container) {
      var staticTree = withChildren(named(SVG.value)("svg")([v3Attr18("width")(lit19(defaultConfig10.width)), v3Attr18("height")(lit19(defaultConfig10.height)), v3AttrStr("viewBox")(str20("0 0 " + (show135(defaultConfig10.width) + (" " + show135(defaultConfig10.height))))), v3AttrStr("class")(str20("wealth-health-viz"))]))([withChildren(named(Group.value)("grid")([v3AttrStr("stroke")(str20("currentColor")), v3Attr18("stroke-opacity")(lit19(0.1))]))(append123(map98(verticalGridLine(defaultConfig10))(xTicks))(map98(horizontalGridLine(defaultConfig10))(yTicks))), withChildren(named(Group.value)("x-axis")([]))([elem3(Line.value)([v3Attr18("x1")(lit19(defaultConfig10.marginLeft)), v3Attr18("y1")(lit19(defaultConfig10.height - defaultConfig10.marginBottom)), v3Attr18("x2")(lit19(defaultConfig10.width - defaultConfig10.marginRight)), v3Attr18("y2")(lit19(defaultConfig10.height - defaultConfig10.marginBottom)), v3AttrStr("stroke")(str20("#333")), v3Attr18("stroke-width")(lit19(1.5))])]), withChildren(named(Group.value)("x-ticks")([]))(map98(xAxisTick(defaultConfig10))(xTicks)), elem3(Text.value)([v3Attr18("x")(lit19(defaultConfig10.width / 2)), v3Attr18("y")(lit19(defaultConfig10.height - 5)), v3AttrStr("text-anchor")(str20("middle")), v3Attr18("font-size")(lit19(14)), v3AttrStr("fill")(str20("#333")), v3AttrStr("textContent")(str20("Income per Person (GDP/capita, PPP$ inflation-adjusted)"))]), withChildren(named(Group.value)("y-axis")([]))([elem3(Line.value)([v3Attr18("x1")(lit19(defaultConfig10.marginLeft)), v3Attr18("y1")(lit19(defaultConfig10.marginTop)), v3Attr18("x2")(lit19(defaultConfig10.marginLeft)), v3Attr18("y2")(lit19(defaultConfig10.height - defaultConfig10.marginBottom)), v3AttrStr("stroke")(str20("#333")), v3Attr18("stroke-width")(lit19(1.5))])]), withChildren(named(Group.value)("y-ticks")([]))(map98(yAxisTick(defaultConfig10))(yTicks)), elem3(Text.value)([v3Attr18("x")(lit19(15)), v3Attr18("y")(lit19(defaultConfig10.height / 2)), v3AttrStr("text-anchor")(str20("middle")), v3Attr18("font-size")(lit19(14)), v3AttrStr("fill")(str20("#333")), v3AttrStr("textContent")(str20("Life Expectancy (years)"))]), withChildren(named(Group.value)("nations-container")([v3AttrStr("class")(str20("nations"))]))([])]);
      return bind86(renderTree72(container)(staticTree))(function() {
        return pure84(function(nations) {
          return runD3v2M(bind86(select50("#wealth-health-viz .nations"))(function(nationsContainer) {
            var nationsTree = joinData("nations")("circle")(nations)(function(v2) {
              return withBehaviors(elem3(Circle.value)([v3AttrFn6("cx")(function(n) {
                return scaleX4(defaultConfig10)(n.income);
              }), v3AttrFn6("cy")(function(n) {
                return scaleY4(defaultConfig10)(n.lifeExpectancy);
              }), v3AttrFn6("r")(function(n) {
                return scaleRadius(n.population);
              }), v3AttrFnStr("fill")(function(v1) {
                return v1.regionColor;
              }), v3Attr18("fill-opacity")(lit19(0.7)), v3AttrStr("stroke")(str20("#333")), v3Attr18("stroke-width")(lit19(0.5)), v3AttrStr("class")(str20("nation-circle"))]))([new MouseEnterWithInfo(function(v1) {
                var content3 = "<strong>" + (v1.datum.name + ("</strong><br/>" + ("Region: " + (v1.datum.region + ("<br/>" + ("Income: $" + (show80(floor2(v1.datum.income)) + ("<br/>" + ("Life Expectancy: " + (show80(floor2(v1.datum.lifeExpectancy)) + (" years<br/>" + ("Population: " + formatPopulation2(v1.datum.population)))))))))))));
                return showTooltip(content3)(v1.clientX)(v1.clientY);
              }), new MouseLeaveWithInfo(function(v1) {
                return hideTooltip;
              })]);
            });
            return bind86(renderTree72(nationsContainer)(nationsTree))(function() {
              return pure84(unit);
            });
          }));
        });
      });
    }));
  };

  // output/Component.WealthHealth.WealthHealth/index.js
  var bind87 = /* @__PURE__ */ bind(bindHalogenM);
  var discard59 = /* @__PURE__ */ discard(discardUnit);
  var discard118 = /* @__PURE__ */ discard59(bindHalogenM);
  var pure85 = /* @__PURE__ */ pure(applicativeHalogenM);
  var modify_17 = /* @__PURE__ */ modify_(monadStateHalogenM);
  var get18 = /* @__PURE__ */ get(monadStateHalogenM);
  var when9 = /* @__PURE__ */ when(applicativeHalogenM);
  var $$void15 = /* @__PURE__ */ $$void(functorHalogenM);
  var forever5 = /* @__PURE__ */ forever(monadRecAff);
  var discard217 = /* @__PURE__ */ discard59(bindAff);
  var liftEffect46 = /* @__PURE__ */ liftEffect(monadEffectAff);
  var member8 = /* @__PURE__ */ member2(ordString);
  var $$delete8 = /* @__PURE__ */ $$delete5(ordString);
  var insert16 = /* @__PURE__ */ insert9(ordString);
  var map99 = /* @__PURE__ */ map(functorArray);
  var bind135 = /* @__PURE__ */ bind(bindMaybe);
  var nationPointToDrawData = function(np) {
    return {
      name: np.name,
      income: np.income,
      population: np.population,
      lifeExpectancy: np.lifeExpectancy,
      regionColor: regionColor(np.region),
      region: regionName(np.region)
    };
  };
  var handleAction34 = function(dictMonadAff) {
    var liftAff2 = liftAff(monadAffHalogenM(dictMonadAff));
    var MonadEffect0 = dictMonadAff.MonadEffect0();
    var liftEffect118 = liftEffect(monadEffectHalogenM(MonadEffect0));
    return function(dictMonadEffect) {
      return function(v2) {
        if (v2 instanceof Initialize35) {
          return bind87(liftAff2(loadNationsData))(function(result) {
            if (result instanceof Left) {
              return discard118(liftEffect118(log2("Error loading data: " + result.value0)))(function() {
                return pure85(unit);
              });
            }
            ;
            if (result instanceof Right) {
              return handleAction34(dictMonadAff)(MonadEffect0)(new DataLoaded(result.value0));
            }
            ;
            throw new Error("Failed pattern match at Component.WealthHealth.WealthHealth (line 157, column 5 - line 162, column 40): " + [result.constructor.name]);
          });
        }
        ;
        if (v2 instanceof DataLoaded) {
          return discard118(modify_17(function(v1) {
            var $55 = {};
            for (var $56 in v1) {
              if ({}.hasOwnProperty.call(v1, $56)) {
                $55[$56] = v1[$56];
              }
              ;
            }
            ;
            $55.model = new Just(v2.value0);
            return $55;
          }))(function() {
            return discard118(modify_17(function(v1) {
              var $58 = {};
              for (var $59 in v1) {
                if ({}.hasOwnProperty.call(v1, $59)) {
                  $58[$59] = v1[$59];
                }
                ;
              }
              ;
              $58.currentYear = v2.value0.yearRange.min;
              return $58;
            }))(function() {
              return discard118(liftAff2(delay(100)))(function() {
                return bind87(liftEffect118(initWealthHealth("#wealth-health-viz")))(function(updateFn) {
                  return discard118(modify_17(function(v1) {
                    var $61 = {};
                    for (var $62 in v1) {
                      if ({}.hasOwnProperty.call(v1, $62)) {
                        $61[$62] = v1[$62];
                      }
                      ;
                    }
                    ;
                    $61.vizUpdateFn = new Just(updateFn);
                    return $61;
                  }))(function() {
                    return handleAction34(dictMonadAff)(MonadEffect0)(Render2.value);
                  });
                });
              });
            });
          });
        }
        ;
        if (v2 instanceof DataLoadFailed) {
          return discard118(liftEffect118(log2("Data load failed: " + v2.value0)))(function() {
            return pure85(unit);
          });
        }
        ;
        if (v2 instanceof SetYear) {
          return discard118(modify_17(function(v1) {
            var $66 = {};
            for (var $67 in v1) {
              if ({}.hasOwnProperty.call(v1, $67)) {
                $66[$67] = v1[$67];
              }
              ;
            }
            ;
            $66.currentYear = v2.value0;
            return $66;
          }))(function() {
            return handleAction34(dictMonadAff)(MonadEffect0)(Render2.value);
          });
        }
        ;
        if (v2 instanceof TogglePlay) {
          return bind87(get18)(function(state3) {
            var newPlaying = !state3.playing;
            return discard118(modify_17(function(v1) {
              var $70 = {};
              for (var $71 in v1) {
                if ({}.hasOwnProperty.call(v1, $71)) {
                  $70[$71] = v1[$71];
                }
                ;
              }
              ;
              $70.playing = newPlaying;
              return $70;
            }))(function() {
              return discard118(when9(newPlaying)((function() {
                var intervalMs = 1e3 / state3.animationSpeed;
                return bind87(liftEffect118(create4))(function(v1) {
                  return bind87(subscribe2(v1.emitter))(function(subscriptionId) {
                    return discard118(modify_17(function(v22) {
                      var $74 = {};
                      for (var $75 in v22) {
                        if ({}.hasOwnProperty.call(v22, $75)) {
                          $74[$75] = v22[$75];
                        }
                        ;
                      }
                      ;
                      $74.animationSubscriptionId = new Just(subscriptionId);
                      return $74;
                    }))(function() {
                      return $$void15(liftAff2(forkAff(forever5(discard217(delay(intervalMs))(function() {
                        return liftEffect46(notify(v1.listener)(Tick2.value));
                      })))));
                    });
                  });
                });
              })()))(function() {
                return when9(!newPlaying)(bind87(get18)(function(state$prime) {
                  if (state$prime.animationSubscriptionId instanceof Nothing) {
                    return pure85(unit);
                  }
                  ;
                  if (state$prime.animationSubscriptionId instanceof Just) {
                    return discard118(unsubscribe2(state$prime.animationSubscriptionId.value0))(function() {
                      return modify_17(function(v1) {
                        var $80 = {};
                        for (var $81 in v1) {
                          if ({}.hasOwnProperty.call(v1, $81)) {
                            $80[$81] = v1[$81];
                          }
                          ;
                        }
                        ;
                        $80.animationSubscriptionId = Nothing.value;
                        return $80;
                      });
                    });
                  }
                  ;
                  throw new Error("Failed pattern match at Component.WealthHealth.WealthHealth (line 203, column 7 - line 207, column 60): " + [state$prime.animationSubscriptionId.constructor.name]);
                }));
              });
            });
          });
        }
        ;
        if (v2 instanceof Tick2) {
          return bind87(get18)(function(state3) {
            if (state3.model instanceof Nothing) {
              return pure85(unit);
            }
            ;
            if (state3.model instanceof Just) {
              var nextYear = state3.currentYear + 1 | 0;
              return discard118((function() {
                var $85 = nextYear > state3.model.value0.yearRange.max;
                if ($85) {
                  return modify_17(function(v1) {
                    var $86 = {};
                    for (var $87 in v1) {
                      if ({}.hasOwnProperty.call(v1, $87)) {
                        $86[$87] = v1[$87];
                      }
                      ;
                    }
                    ;
                    $86.currentYear = state3.model.value0.yearRange.min;
                    return $86;
                  });
                }
                ;
                return modify_17(function(v1) {
                  var $89 = {};
                  for (var $90 in v1) {
                    if ({}.hasOwnProperty.call(v1, $90)) {
                      $89[$90] = v1[$90];
                    }
                    ;
                  }
                  ;
                  $89.currentYear = nextYear;
                  return $89;
                });
              })())(function() {
                return handleAction34(dictMonadAff)(MonadEffect0)(Render2.value);
              });
            }
            ;
            throw new Error("Failed pattern match at Component.WealthHealth.WealthHealth (line 211, column 5 - line 220, column 28): " + [state3.model.constructor.name]);
          });
        }
        ;
        if (v2 instanceof HoverNation) {
          return modify_17(function(v1) {
            var $93 = {};
            for (var $94 in v1) {
              if ({}.hasOwnProperty.call(v1, $94)) {
                $93[$94] = v1[$94];
              }
              ;
            }
            ;
            $93.hoveredNation = v2.value0;
            return $93;
          });
        }
        ;
        if (v2 instanceof ToggleNationSelection) {
          return modify_17(function(s3) {
            var newSelected = (function() {
              var $97 = member8(v2.value0)(s3.selectedNations);
              if ($97) {
                return $$delete8(v2.value0)(s3.selectedNations);
              }
              ;
              return insert16(v2.value0)(s3.selectedNations);
            })();
            var $98 = {};
            for (var $99 in s3) {
              if ({}.hasOwnProperty.call(s3, $99)) {
                $98[$99] = s3[$99];
              }
              ;
            }
            ;
            $98.selectedNations = newSelected;
            return $98;
          });
        }
        ;
        if (v2 instanceof SetAnimationSpeed) {
          return modify_17(function(v1) {
            var $102 = {};
            for (var $103 in v1) {
              if ({}.hasOwnProperty.call(v1, $103)) {
                $102[$103] = v1[$103];
              }
              ;
            }
            ;
            $102.animationSpeed = v2.value0;
            return $102;
          });
        }
        ;
        if (v2 instanceof ToggleLabels) {
          return discard118(modify_17(function(s3) {
            var $107 = {};
            for (var $108 in s3) {
              if ({}.hasOwnProperty.call(s3, $108)) {
                $107[$108] = s3[$108];
              }
              ;
            }
            ;
            $107.labelMode = (function() {
              if (s3.labelMode instanceof AlwaysShow) {
                return OnHoverOnly.value;
              }
              ;
              if (s3.labelMode instanceof OnHoverOnly) {
                return AlwaysShow.value;
              }
              ;
              throw new Error("Failed pattern match at Component.WealthHealth.WealthHealth (line 240, column 23 - line 242, column 38): " + [s3.labelMode.constructor.name]);
            })();
            return $107;
          }))(function() {
            return handleAction34(dictMonadAff)(MonadEffect0)(Render2.value);
          });
        }
        ;
        if (v2 instanceof Render2) {
          return bind87(get18)(function(state3) {
            if (state3.model instanceof Just && state3.vizUpdateFn instanceof Just) {
              var nations = getAllNationsAtYear(state3.currentYear)(state3.model.value0);
              var drawData = map99(nationPointToDrawData)(nations);
              return liftEffect118(state3.vizUpdateFn.value0(drawData));
            }
            ;
            return pure85(unit);
          });
        }
        ;
        throw new Error("Failed pattern match at Component.WealthHealth.WealthHealth (line 153, column 16 - line 253, column 24): " + [v2.constructor.name]);
      };
    };
  };
  var getNationData = function(nationName) {
    return function(year2) {
      return function(model) {
        return bind135(find2(function(n) {
          return n.name === nationName;
        })(model.nations))(function(nationRawData) {
          return getNationAtYear(year2)(nationRawData);
        });
      };
    };
  };
  var renderTooltip = function(state3) {
    if (state3.hoveredNation instanceof Nothing) {
      return text5("");
    }
    ;
    if (state3.hoveredNation instanceof Just) {
      if (state3.model instanceof Nothing) {
        return text5("");
      }
      ;
      if (state3.model instanceof Just) {
        var v2 = getNationData(state3.hoveredNation.value0)(state3.currentYear)(state3.model.value0);
        if (v2 instanceof Nothing) {
          return text5("");
        }
        ;
        if (v2 instanceof Just) {
          return div2([classes(["wealth-health-tooltip-halogen"])])([h4_([text5(v2.value0.name)]), div_([text5("Region: " + regionName(v2.value0.region))]), div_([text5("Income: $" + formatNumber2(v2.value0.income))]), div_([text5("Population: " + formatPopulation(v2.value0.population))]), div_([text5("Life Expectancy: " + (formatNumber2(v2.value0.lifeExpectancy) + " years"))])]);
        }
        ;
        throw new Error("Failed pattern match at Component.WealthHealth.WealthHealth (line 122, column 11 - line 132, column 18): " + [v2.constructor.name]);
      }
      ;
      throw new Error("Failed pattern match at Component.WealthHealth.WealthHealth (line 119, column 7 - line 132, column 18): " + [state3.model.constructor.name]);
    }
    ;
    throw new Error("Failed pattern match at Component.WealthHealth.WealthHealth (line 116, column 3 - line 132, column 18): " + [state3.hoveredNation.constructor.name]);
  };
  var render39 = function(state3) {
    return div2([classes(["wealth-health-page"])])([header([classes(["wealth-health-header"])])([h1_([text5("The Wealth & Health of Nations")]), p_([text5("An animated exploration of income, life expectancy, and population across 180 nations from 1800 to 2009")])]), div2([classes(["wealth-health-content"])])([aside([classes(["wealth-health-sidebar"])])([renderControlPanel2(state3), renderLegend]), main([classes(["wealth-health-visualization"])])([(function() {
      if (state3.model instanceof Nothing) {
        return div2([classes(["wealth-health-loading"])])([text5("Loading data...")]);
      }
      ;
      if (state3.model instanceof Just) {
        return div2([classes(["wealth-health-viz-wrapper"])])([div2([id3("wealth-health-viz"), classes(["wealth-health-viz-container", (function() {
          if (state3.labelMode instanceof AlwaysShow) {
            return "labels-always-show";
          }
          ;
          if (state3.labelMode instanceof OnHoverOnly) {
            return "";
          }
          ;
          throw new Error("Failed pattern match at Component.WealthHealth.WealthHealth (line 74, column 46 - line 76, column 50): " + [state3.labelMode.constructor.name]);
        })()])])([]), renderTooltip(state3)]);
      }
      ;
      throw new Error("Failed pattern match at Component.WealthHealth.WealthHealth (line 62, column 15 - line 81, column 22): " + [state3.model.constructor.name]);
    })()])]), footer([classes(["wealth-health-credits"])])([div2([classes(["wealth-health-credits__tribute"])])([text5("In memory of "), a([href4("https://youtu.be/usdJgEwMinM"), target6("_blank"), classes(["wealth-health-credits__link"])])([text5("Hans Rosling")]), text5(" (1948-2017), whose famous TED talk inspired this visualization.")]), div2([classes(["wealth-health-credits__adaptation"])])([text5("D3 adaptation by "), a([href4("https://observablehq.com/@mbostock/the-wealth-health-of-nations"), target6("_blank"), classes(["wealth-health-credits__link"])])([text5("Mike Bostock")]), text5(". PureScript implementation demonstrates the PS<$>D3 library.")])])]);
  };
  var component35 = function(dictMonadAff) {
    var handleAction1 = handleAction34(dictMonadAff)(dictMonadAff.MonadEffect0());
    return function(dictMonadEffect) {
      return mkComponent({
        initialState: initialState4,
        render: render39,
        "eval": mkEval({
          handleQuery: defaultEval.handleQuery,
          receive: defaultEval.receive,
          finalize: defaultEval.finalize,
          handleAction: handleAction1,
          initialize: new Just(Initialize35.value)
        })
      });
    };
  };

  // output/Component.Tour.TourWealthHealth/index.js
  var discard60 = /* @__PURE__ */ discard(discardUnit)(bindHalogenM);
  var pure86 = /* @__PURE__ */ pure(applicativeHalogenM);
  var slot_3 = /* @__PURE__ */ slot_()({
    reflectSymbol: function() {
      return "wealthHealth";
    }
  })(ordUnit);
  var Initialize36 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var handleAction35 = function(dictMonadAff) {
    var liftAff2 = liftAff(monadAffHalogenM(dictMonadAff));
    return function(v2) {
      return discard60(liftAff2(delay(100)))(function() {
        return pure86(unit);
      });
    };
  };
  var _wealthHealth = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var render40 = function(dictMonadAff) {
    var component110 = component35(dictMonadAff)(dictMonadAff.MonadEffect0());
    return function(v2) {
      return div2([classes(["showcase-page", "wealth-health-showcase"])])([render4({
        logoSize: Normal.value,
        quadrant: NoQuadrant.value,
        prevNext: Nothing.value,
        pageTitle: new Just("Wealth & Health of Nations")
      }), slot_3(_wealthHealth)(unit)(component110)(unit)]);
    };
  };
  var component36 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render40(dictMonadAff),
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction35(dictMonadAff),
        initialize: new Just(Initialize36.value)
      })
    });
  };

  // output/Component.TreeAPI/foreign.js
  var clearViz = () => {
    const viz = document.getElementById("viz");
    if (viz) {
      viz.innerHTML = "";
    }
  };

  // output/Component.TreeAPI/index.js
  var discard61 = /* @__PURE__ */ discard(discardUnit)(bindHalogenM);
  var modify_18 = /* @__PURE__ */ modify_(monadStateHalogenM);
  var $$void16 = /* @__PURE__ */ $$void(functorEffect);
  var ThreeCircles = /* @__PURE__ */ (function() {
    function ThreeCircles2() {
    }
    ;
    ThreeCircles2.value = new ThreeCircles2();
    return ThreeCircles2;
  })();
  var ThreeCirclesTransition = /* @__PURE__ */ (function() {
    function ThreeCirclesTransition2() {
    }
    ;
    ThreeCirclesTransition2.value = new ThreeCirclesTransition2();
    return ThreeCirclesTransition2;
  })();
  var SimpleTree = /* @__PURE__ */ (function() {
    function SimpleTree2() {
    }
    ;
    SimpleTree2.value = new SimpleTree2();
    return SimpleTree2;
  })();
  var NestedElements = /* @__PURE__ */ (function() {
    function NestedElements2() {
    }
    ;
    NestedElements2.value = new NestedElements2();
    return NestedElements2;
  })();
  var BarChart = /* @__PURE__ */ (function() {
    function BarChart2() {
    }
    ;
    BarChart2.value = new BarChart2();
    return BarChart2;
  })();
  var ScatterPlot = /* @__PURE__ */ (function() {
    function ScatterPlot2() {
    }
    ;
    ScatterPlot2.value = new ScatterPlot2();
    return ScatterPlot2;
  })();
  var LineChart = /* @__PURE__ */ (function() {
    function LineChart2() {
    }
    ;
    LineChart2.value = new LineChart2();
    return LineChart2;
  })();
  var GroupedBarChart = /* @__PURE__ */ (function() {
    function GroupedBarChart2() {
    }
    ;
    GroupedBarChart2.value = new GroupedBarChart2();
    return GroupedBarChart2;
  })();
  var SimpleHierarchy = /* @__PURE__ */ (function() {
    function SimpleHierarchy2() {
    }
    ;
    SimpleHierarchy2.value = new SimpleHierarchy2();
    return SimpleHierarchy2;
  })();
  var ThreeDimensions = /* @__PURE__ */ (function() {
    function ThreeDimensions2() {
    }
    ;
    ThreeDimensions2.value = new ThreeDimensions2();
    return ThreeDimensions2;
  })();
  var Initialize37 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var SelectExample2 = /* @__PURE__ */ (function() {
    function SelectExample3(value0) {
      this.value0 = value0;
    }
    ;
    SelectExample3.create = function(value0) {
      return new SelectExample3(value0);
    };
    return SelectExample3;
  })();
  var handleAction36 = function(dictMonadAff) {
    var liftEffect54 = liftEffect(monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    return function(v2) {
      if (v2 instanceof Initialize37) {
        return handleAction36(dictMonadAff)(new SelectExample2(ThreeCircles.value));
      }
      ;
      if (v2 instanceof SelectExample2) {
        return discard61(modify_18(function(v1) {
          var $21 = {};
          for (var $22 in v1) {
            if ({}.hasOwnProperty.call(v1, $22)) {
              $21[$22] = v1[$22];
            }
            ;
          }
          ;
          $21.currentExample = v2.value0;
          return $21;
        }))(function() {
          return discard61(liftEffect54(clearViz))(function() {
            if (v2.value0 instanceof ThreeCircles) {
              return liftEffect54(threeLittleCircles);
            }
            ;
            if (v2.value0 instanceof ThreeCirclesTransition) {
              return liftEffect54($$void16(threeLittleCirclesTransition("#viz")));
            }
            ;
            if (v2.value0 instanceof SimpleTree) {
              return liftEffect54(testSimpleTree);
            }
            ;
            if (v2.value0 instanceof NestedElements) {
              return liftEffect54(testNestedElements);
            }
            ;
            if (v2.value0 instanceof BarChart) {
              return liftEffect54(barChart);
            }
            ;
            if (v2.value0 instanceof ScatterPlot) {
              return liftEffect54(scatterPlot);
            }
            ;
            if (v2.value0 instanceof LineChart) {
              return liftEffect54(lineChart);
            }
            ;
            if (v2.value0 instanceof GroupedBarChart) {
              return liftEffect54(groupedBarChart("#viz"));
            }
            ;
            if (v2.value0 instanceof SimpleHierarchy) {
              return liftEffect54(treeViz("#viz"));
            }
            ;
            if (v2.value0 instanceof ThreeDimensions) {
              return liftEffect54(threeLittleDimensions);
            }
            ;
            throw new Error("Failed pattern match at Component.TreeAPI (line 331, column 5 - line 341, column 87): " + [v2.value0.constructor.name]);
          });
        });
      }
      ;
      throw new Error("Failed pattern match at Component.TreeAPI (line 319, column 16 - line 341, column 87): " + [v2.constructor.name]);
    };
  };
  var exampleTitle = function(v2) {
    if (v2 instanceof ThreeCircles) {
      return "Three Little Circles (Data Join)";
    }
    ;
    if (v2 instanceof ThreeCirclesTransition) {
      return "Three Little Circles (Transition)";
    }
    ;
    if (v2 instanceof SimpleTree) {
      return "Simple Tree (Basic Structure)";
    }
    ;
    if (v2 instanceof NestedElements) {
      return "Nested Elements (Multi-Level)";
    }
    ;
    if (v2 instanceof BarChart) {
      return "Bar Chart";
    }
    ;
    if (v2 instanceof ScatterPlot) {
      return "Scatter Plot";
    }
    ;
    if (v2 instanceof LineChart) {
      return "Line Chart";
    }
    ;
    if (v2 instanceof GroupedBarChart) {
      return "Grouped Bar Chart (Nested Joins)";
    }
    ;
    if (v2 instanceof SimpleHierarchy) {
      return "Tree Layout (Hierarchy)";
    }
    ;
    if (v2 instanceof ThreeDimensions) {
      return "Three Little Dimensions (Nested Joins)";
    }
    ;
    throw new Error("Failed pattern match at Component.TreeAPI (line 133, column 1 - line 133, column 34): " + [v2.constructor.name]);
  };
  var exampleCode = function(v2) {
    if (v2 instanceof ThreeCircles) {
      return '\ntree = named SVG "svg" [...] `withChild`\n  (joinData "circles" "circle" circleData $ \\d ->\n    elem Circle\n      [ cx d.x\n      , cy d.y\n      , radius d.r\n      , fill d.color\n      ])\n\nselections <- renderTree container tree\n';
    }
    ;
    if (v2 instanceof ThreeCirclesTransition) {
      return '\n-- Initial render: green circles in horizontal line\ninitialTree = named SVG "svg" [...] `withChild`\n  (joinData "circles" "circle" [0, 1, 2] $ \\\\d ->\n    elem Circle [fill "green", cx (d * 100 + 100), ...])\n\nselections <- renderTree container initialTree\n\n-- Extract circles selection\ncirclesSel <- liftEffect $ reselectD3v2 "circles" selections\n\n-- Transition to RGB colors with overlapping positions\nlet transitionConfig = transitionWith\n      { duration: Milliseconds 1500.0\n      , delay: Just (Milliseconds 100.0)\n      , easing: Just ElasticOut\n      }\n\nwithTransition transitionConfig circlesSel\n  [ fill colorFn\n  , cx cxFn\n  , cy cyFn\n  , radius 30.0\n  , fillOpacity 0.5\n  ]\n';
    }
    ;
    if (v2 instanceof SimpleTree) {
      return '\ntree = named SVG "svg" [...] `withChild`\n  (named Group "container" [...] `withChildren`\n    [ named Circle "circle" [...]\n    , named Text "text" [...]\n    ])\n\nselections <- renderTree container tree\n-- Access: Map.lookup "circle" selections\n';
    }
    ;
    if (v2 instanceof NestedElements) {
      return '\ntree = named SVG "svg" [...] `withChild`\n  (named Group "mainGroup" [...] `withChildren`\n    [ named Group "node1" [...] `withChildren`\n        [ named Circle "circle1" [...]\n        , named Text "label1" [...]\n        ]\n    , named Group "node2" [...] `withChildren`\n        [ named Circle "circle2" [...]\n        , named Text "label2" [...]\n        ]\n    ])\n\nselections <- renderTree container tree\n';
    }
    ;
    if (v2 instanceof BarChart) {
      return '\ntree = named SVG "svg" [...] `withChild`\n  (named Group "chartGroup" [...] `withChild`\n    (joinData "bars" "rect" dataPoints $ \\\\point ->\n      T.elem Rect\n        [ x (xScale point.x)\n        , y (yScale point.y)\n        , width barWidth\n        , height barHeight\n        , fill "#4a90e2"\n        ]))\n\nselections <- renderTree container tree\n';
    }
    ;
    if (v2 instanceof ScatterPlot) {
      return '\ntree = named SVG "svg" [...] `withChild`\n  (named Group "chartGroup" [...] `withChild`\n    (joinData "points" "circle" dataPoints $ \\\\point ->\n      T.elem Circle\n        [ cx (xScale point.x)\n        , cy (yScale point.y)\n        , radius 6.0\n        , fill "#e74c3c"\n        ]))\n\nselections <- renderTree container tree\n';
    }
    ;
    if (v2 instanceof LineChart) {
      return '\ntree = named SVG "svg" [...] `withChild`\n  (named Group "chartGroup" [...] `withChild`\n    (named Path "line"\n      [ d pathData\n      , fill "none"\n      , stroke "#2ecc71"\n      , strokeWidth 2.0\n      ]))\n\nselections <- renderTree container tree\n';
    }
    ;
    if (v2 instanceof GroupedBarChart) {
      return '\n-- Group data by state\nlet stateGroups = groupByState data\n    ages = getAges data\n\n-- Nested join: states \u2192 bars within each state\nbarsTree = nestedJoin "stateGroups" "g" stateGroups (_.bars) $ \\\\bar ->\n  let\n    stateIdx = findIndex (\\\\g -> g.state == bar.state) stateGroups\n    ageIdx = findIndex (\\\\a -> a == bar.age) ages\n    xPos = stateIdx * groupWidth + ageIdx * barWidth\n    yPos = yScale bar.population\n    barHeight = iHeight - yPos\n  in\n    T.elem Rect\n      [ x xPos\n      , y yPos\n      , width barWidth\n      , height barHeight\n      , fill (colorForAge bar.age)\n      ]\n\nselections <- renderTree chartGroup barsTree\n';
    }
    ;
    if (v2 instanceof SimpleHierarchy) {
      return '\n-- Apply layout algorithm\nlet positioned = tree config hierarchyData\nlet nodes = Array.fromFoldable positioned\nlet links = makeLinks positioned\n\ntree = named SVG "svg" [...] `withChildren`\n  [ named Group "linksGroup" [...] `withChild`\n      (joinData "links" "path" links $ \\\\link ->\n        T.elem Path [d (linkPath link), ...])\n  , named Group "nodesGroup" [...] `withChild`\n      (joinData "nodes" "g" nodes $ \\\\node ->\n        T.named Group ("node-" <> node.name) [...]\n          `withChildren`\n            [ T.elem Circle [cx node.x, cy node.y, ...]\n            , T.elem Text [textContent node.name, ...]\n            ])\n  ]\n';
    }
    ;
    if (v2 instanceof ThreeDimensions) {
      return '\n-- Nested data: [[1,2,3],[4,5,6],[7,8,9]]\ntree = named Table "table" [...] `withChild`\n  (nestedJoin "rows" "tr" matrixData identity $ \\\\cellValue ->\n    T.elem Td [textContent (show cellValue)])\n\n-- nestedJoin handles type decomposition:\n-- - Outer type: Array Int (a row)\n-- - Decomposer: identity (extracts row data)\n-- - Inner type: Int (a cell value)\n-- - Creates: table rows \u2192 table cells\n\n-- Power: Works with ANY decomposition!\n-- - Array of Records with nested Arrays\n-- - Lists of Maps of Sets\n-- - Custom ADT decompositions\n';
    }
    ;
    throw new Error("Failed pattern match at Component.TreeAPI (line 145, column 1 - line 145, column 33): " + [v2.constructor.name]);
  };
  var eqExample = {
    eq: function(x32) {
      return function(y32) {
        if (x32 instanceof ThreeCircles && y32 instanceof ThreeCircles) {
          return true;
        }
        ;
        if (x32 instanceof ThreeCirclesTransition && y32 instanceof ThreeCirclesTransition) {
          return true;
        }
        ;
        if (x32 instanceof SimpleTree && y32 instanceof SimpleTree) {
          return true;
        }
        ;
        if (x32 instanceof NestedElements && y32 instanceof NestedElements) {
          return true;
        }
        ;
        if (x32 instanceof BarChart && y32 instanceof BarChart) {
          return true;
        }
        ;
        if (x32 instanceof ScatterPlot && y32 instanceof ScatterPlot) {
          return true;
        }
        ;
        if (x32 instanceof LineChart && y32 instanceof LineChart) {
          return true;
        }
        ;
        if (x32 instanceof GroupedBarChart && y32 instanceof GroupedBarChart) {
          return true;
        }
        ;
        if (x32 instanceof SimpleHierarchy && y32 instanceof SimpleHierarchy) {
          return true;
        }
        ;
        if (x32 instanceof ThreeDimensions && y32 instanceof ThreeDimensions) {
          return true;
        }
        ;
        return false;
      };
    }
  };
  var eq17 = /* @__PURE__ */ eq(eqExample);
  var exampleButton = function(state3) {
    return function(ex) {
      return function(label5) {
        return function(description) {
          return button2([class_((function() {
            var $30 = eq17(state3.currentExample)(ex);
            if ($30) {
              return "selected";
            }
            ;
            return "";
          })()), onClick(function(v2) {
            return new SelectExample2(ex);
          })])([div2([class_("label")])([text5(label5)]), div2([class_("description")])([text5(description)])]);
        };
      };
    };
  };
  var render41 = function(state3) {
    return div2([class_("tree-api-examples")])([h1_([text5("Declarative Tree API Examples")]), div2([class_("description")])([p_([text5("This page demonstrates the new declarative tree API for PSD3. "), text5("Instead of imperative "), code_([text5("appendChild")]), text5(" chains, you define the entire DOM structure as a tree, "), text5("then render it in one step.")]), p_([strong_([text5("Key features:")])]), ul_([li_([text5("Tree structure is immediately visible")]), li_([text5("Data joins with template functions")]), li_([text5("Named selections via Map lookup")]), li_([text5("Type-safe, polymorphic attributes")])])]), div2([class_("example-selector")])([h2_([text5("Basic Examples:")]), div2([class_("buttons")])([exampleButton(state3)(ThreeCircles.value)("Three Little Circles")("Data join basics"), exampleButton(state3)(ThreeCirclesTransition.value)("Circles Transition")("Animated transitions"), exampleButton(state3)(SimpleTree.value)("Simple Tree")("Basic nesting"), exampleButton(state3)(NestedElements.value)("Nested Elements")("Multi-level (Group \u2192 Circle + Text)"), exampleButton(state3)(ThreeDimensions.value)("Three Little Dimensions")("Nested data joins (2D array \u2192 table)")]), h2_([text5("Chart Examples:")]), div2([class_("buttons")])([exampleButton(state3)(BarChart.value)("Bar Chart")("Data-driven bars with scaling"), exampleButton(state3)(ScatterPlot.value)("Scatter Plot")("Points positioned by data"), exampleButton(state3)(LineChart.value)("Line Chart")("Path element from data"), exampleButton(state3)(GroupedBarChart.value)("Grouped Bar Chart")("Nested joins with multiple series")]), h2_([text5("Hierarchy Examples:")]), div2([class_("buttons")])([exampleButton(state3)(SimpleHierarchy.value)("Tree Layout")("Hierarchical node-link diagram")])]), div2([class_("visualization-container")])([h2_([text5(exampleTitle(state3.currentExample))]), div2([id3("viz"), class_("viz-area")])([]), div2([class_("code-example")])([h3_([text5("Code:")]), pre_([code_([text5(exampleCode(state3.currentExample))])])])])]);
  };
  var component37 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return {
          currentExample: ThreeCircles.value
        };
      },
      render: render41,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction36(dictMonadAff),
        initialize: new Just(Initialize37.value)
      })
    });
  };

  // output/Component.Understanding.UnderstandingAttributes/index.js
  var pure87 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize38 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var svgDiagram = function(src10) {
    return function(alt11) {
      return img([src9("assets/diagrams/" + src10), alt5(alt11), style("max-width: 100%; height: auto;")]);
    };
  };
  var renderNavCard = function(title4) {
    return function(href5) {
      return function(description) {
        return a([href4(href5), classes(["section-nav-card"])])([h3_([text5(title4)]), p_([text5(description)])]);
      };
    };
  };
  var render42 = function(v2) {
    return div2([classes(["tutorial-page"])])([render4({
      logoSize: Large.value,
      quadrant: QuadUnderstanding.value,
      prevNext: Nothing.value,
      pageTitle: Nothing.value
    }), main_([section([classes(["tutorial-section", "tutorial-intro"])])([h1([classes(["tutorial-title"])])([text5("Type-Safe Attribute System")]), p_([text5("A key innovation of D3 is the natural way to go from static to data-driven attributes. PSD3 preserves this flexibility while adding compile-time type safety through typeclasses and phantom types.")]), div2([classes(["section-nav-cards"])])([renderNavCard("Attribute Variants")("#attribute-variants")("Static, datum, and indexed"), renderNavCard("Contravariant Pattern")("#contravariant")("Transform data before attributes"), renderNavCard("Type Safety")("#type-safety")("Compile-time guarantees"), renderNavCard("Common Attributes")("#common-attributes")("SVG and HTML attributes")])]), section([classes(["tutorial-section"]), id3("attribute-variants")])([h2([classes(["tutorial-section-title"])])([text5("Attribute Variants")]), p_([text5("Attributes in PSD3 can take three forms, all with the same clean syntax:")]), div2([classes(["diagram-container"])])([svgDiagram("attribute-resolution.svg")("Attribute type resolution diagram")]), table([classes(["tutorial-table"])])([thead_([tr_([th_([text5("Form")]), th_([text5("Example")]), th_([text5("Use Case")])])]), tbody_([tr_([td_([strong_([text5("Static")])]), td_([code_([text5("radius 10.0")])]), td_([text5("Same value for all elements")])]), tr_([td_([strong_([text5("Datum Function")])]), td_([code_([text5("cx (\\d -> d.x)")])]), td_([text5("Value depends on bound data")])]), tr_([td_([strong_([text5("Datum + Index")])]), td_([code_([text5("x (\\d i -> 50.0 + i * 100.0)")])]), td_([text5("Value depends on data and position")])])])]), p([classes(["code-highlight"])])([text5("Key: "), text5("The "), code_([text5("IsAttribute")]), text5(" typeclass resolves all three forms at compile time.")])]), section([classes(["tutorial-section"]), id3("contravariant")])([h2([classes(["tutorial-section-title"])])([text5("The Contravariant Pattern")]), p_([text5("Attributes form a "), em_([text5("Contravariant Functor")]), text5(". This means you can transform the input data type before the attribute sees it.")]), p_([text5("Why contravariant? Regular functors transform "), em_([text5("outputs")]), text5(". Attributes transform "), em_([text5("inputs")]), text5(" (the datum they receive).")]), p([classes(["code-highlight"])])([text5("Example: "), code_([text5("cmap _.name (textContent identity)")]), text5(" extracts the name field before setting text content.")])]), section([classes(["tutorial-section"]), id3("type-safety")])([h2([classes(["tutorial-section-title"])])([text5("Type Safety Guarantees")]), p_([text5("The attribute system provides several compile-time guarantees:")]), ul_([li_([strong_([text5("Datum type matching")]), text5(" - Attributes must match the selection's datum type")]), li_([strong_([text5("Attribute value types")]), text5(" - "), code_([text5("radius")]), text5(" requires Number, "), code_([text5("fill")]), text5(" requires String")]), li_([strong_([text5("No missing attributes")]), text5(" - Arrays of attributes are explicit and type-checked")])]), p_([text5("Common compile-time errors:")]), ul_([li_([code_([text5('radius "10"')]), text5(" - Type error: expected Number, got String")]), li_([code_([text5("cx (\\d -> d.x)")]), text5(" on wrong datum type - Type error: field 'x' not found")])]), p([classes(["code-highlight"])])([text5("Philosophy: "), text5("Runtime errors in D3 become compile-time errors in PSD3.")])]), section([classes(["tutorial-section"]), id3("common-attributes")])([h2([classes(["tutorial-section-title"])])([text5("Common Attributes")]), p_([text5("PSD3 provides typed wrappers for all common SVG and HTML attributes:")]), h3_([text5("Positioning")]), p_([code_([text5("cx, cy, x, y, x1, y1, x2, y2")]), text5(" - coordinate positions")]), h3_([text5("Dimensions")]), p_([code_([text5("width, height, radius, rx, ry")]), text5(" - size attributes")]), h3_([text5("Styling")]), p_([code_([text5("fill, stroke, strokeWidth, fillOpacity, strokeOpacity")]), text5(" - colors and strokes")]), h3_([text5("Text")]), p_([code_([text5("textContent, textAnchor, fontSize, fontWeight")]), text5(" - text styling")]), h3_([text5("Transforms")]), p_([code_([text5("transform, translate, rotate, scale")]), text5(" - geometric transforms")]), h3_([text5("General")]), p_([code_([text5("class_, id_, d (for paths), viewBox")]), text5(" - common utilities")])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Summary")]), p_([text5("PSD3's attribute system:")]), ul_([li_([text5("Three forms: static, datum function, datum+index")]), li_([text5("Resolved at compile time via IsAttribute typeclass")]), li_([text5("Contravariant functor for data transformation")]), li_([text5("Type-safe: datum types, value types, completeness")]), li_([text5("Comprehensive coverage of SVG and HTML attributes")])])])])]);
  };
  var handleAction37 = function(dictMonadAff) {
    return function(v2) {
      return pure87(unit);
    };
  };
  var component38 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render42,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction37(dictMonadAff),
        initialize: new Just(Initialize38.value)
      })
    });
  };

  // output/Component.Understanding.UnderstandingGrammar/index.js
  var pure88 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize39 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var svgDiagram2 = function(src10) {
    return function(alt11) {
      return img([src9("assets/diagrams/" + src10), alt5(alt11), style("max-width: 100%; height: auto;")]);
    };
  };
  var renderNavCard2 = function(title4) {
    return function(href5) {
      return function(description) {
        return a([href4(href5), classes(["section-nav-card"])])([h3_([text5(title4)]), p_([text5(description)])]);
      };
    };
  };
  var render43 = function(v2) {
    return div2([classes(["tutorial-page"])])([render4({
      logoSize: Large.value,
      quadrant: QuadUnderstanding.value,
      prevNext: Nothing.value,
      pageTitle: Nothing.value
    }), main_([section([classes(["tutorial-section", "tutorial-intro"])])([h1([classes(["tutorial-title"])])([text5("The Grammar of D3")]), p_([text5("D3 can be understood as an embedded Domain Specific Language for data visualization. While the full API has a large surface area, the essential grammar is remarkably small. PSD3 captures this grammar in a type-safe, composable way.")]), div2([classes(["section-nav-cards"])])([renderNavCard2("Core Primitives")("#core-primitives")("The four essential operations"), renderNavCard2("Selection States")("#selection-states")("Phantom types for safety"), renderNavCard2("Static vs GUP")("#static-vs-gup")("One-time vs updating"), renderNavCard2("TreeAPI")("#tree-api")("Declarative alternative")])]), section([classes(["tutorial-section"]), id3("core-primitives")])([h2([classes(["tutorial-section-title"])])([text5("Core Primitives")]), p_([text5("The grammar of D3 visualizations consists of four essential primitives. Everything else is built from these:")]), table([classes(["tutorial-table"])])([thead_([tr_([th_([text5("Primitive")]), th_([text5("Function")]), th_([text5("PSD3 API")])])]), tbody_([tr_([td_([em_([text5("select")])]), td_([text5("Find an entry point in the DOM")]), td_([code_([text5("select")]), text5(", "), code_([text5("selectAll")])])]), tr_([td_([em_([text5("append")])]), td_([text5("Add a DOM element to a selection")]), td_([code_([text5("appendChild")]), text5(", "), code_([text5("append")])])]), tr_([td_([em_([text5("join")])]), td_([text5("For each datum "), strong_([text5("d")]), text5(", create an element "), strong_([text5("e")])]), td_([code_([text5("appendData")]), text5(", "), code_([text5("joinData")]), text5(", "), code_([text5("renderData")])])]), tr_([td_([em_([text5("attr")])]), td_([text5("Apply attributes to current elements")]), td_([code_([text5("setAttrs")]), text5(" (array of Attribute)")])])])]), p([classes(["code-highlight"])])([text5("Key insight: "), text5("Attributes can be static values or functions of the datum, enabling Data Driven Documents.")])]), section([classes(["tutorial-section"]), id3("selection-states")])([h2([classes(["tutorial-section-title"])])([text5("Selection States (Phantom Types)")]), p_([text5("PSD3 uses phantom types to track what operations are legal on a selection. This catches errors at compile time that D3 would only catch at runtime:")]), div2([classes(["diagram-container"])])([svgDiagram2("selection-state-machine.svg")("Selection state machine diagram")]), table([classes(["tutorial-table"])])([thead_([tr_([th_([text5("State")]), th_([text5("Meaning")]), th_([text5("Legal Operations")])])]), tbody_([tr_([td_([code_([text5("SEmpty")])]), td_([text5("Selection has elements but no data")]), td_([text5("appendChild, appendData, joinData")])]), tr_([td_([code_([text5("SPending")])]), td_([text5("Data waiting for elements (enter)")]), td_([text5("append")])]), tr_([td_([code_([text5("SBoundOwns")])]), td_([text5("Elements with bound data")]), td_([text5("setAttrs, appendChildInheriting, merge")])]), tr_([td_([code_([text5("SExiting")])]), td_([text5("Elements to be removed (exit)")]), td_([text5("setAttrsExit, remove")])])])]), p([classes(["code-highlight"])])([text5("Type safety: "), text5("Trying to call "), code_([text5("setAttrs")]), text5(" on an "), code_([text5("SEmpty")]), text5(" selection is a compile error, not a runtime bug.")])]), section([classes(["tutorial-section"]), id3("static-vs-gup")])([h2([classes(["tutorial-section-title"])])([text5("Static Visualizations vs General Update Pattern")]), p_([text5("There are two fundamental patterns for D3 visualizations:")]), h3_([text5("Static: One-time render")]), p_([text5("Use "), code_([text5("appendData")]), text5(" for simple visualizations that render once with fixed data. This is perfect for charts, static hierarchies, and basic data displays.")]), h3_([text5("GUP: Dynamic updates")]), div2([classes(["diagram-container"])])([svgDiagram2("gup-flow.svg")("General Update Pattern flow diagram")]), p_([text5("Use "), code_([text5("joinData")]), text5(" when data changes over time. The join splits data into three disjoint sets:")]), ul_([li_([strong_([text5("Enter")]), text5(" - new data items that need elements created")]), li_([strong_([text5("Update")]), text5(" - existing elements that should be updated")]), li_([strong_([text5("Exit")]), text5(" - old elements that should be removed")])]), p([classes(["code-highlight"])])([text5("GUP enables: "), text5("Animated transitions, live data feeds, user interactions, and smooth state changes.")])]), section([classes(["tutorial-section"]), id3("tree-api")])([h2([classes(["tutorial-section-title"])])([text5("TreeAPI: Declarative Alternative")]), p_([text5("For static visualizations, the TreeAPI provides a more declarative, succinct syntax. Instead of imperative method chaining, you declare the desired tree structure.")]), p_([text5("TreeAPI variants handle different use cases:")]), ul_([li_([code_([text5("Node")]), text5(" - static elements with children")]), li_([code_([text5("Join")]), text5(" - data-driven element creation (N elements from N data)")]), li_([code_([text5("NestedJoin")]), text5(" - nested data with type decomposition")]), li_([code_([text5("SceneJoin")]), text5(" - declarative GUP with enter/update/exit behaviors")])]), p([classes(["code-highlight"])])([text5("Note: "), text5("TreeAPI excels at static visualizations. For complex interactive visualizations with simulations, the underlying Selection API provides more control.")])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Summary")]), p_([text5("The D3 grammar in PSD3:")]), ul_([li_([text5("Four primitives: select, append, join, attr")]), li_([text5("Phantom types enforce correct operation ordering")]), li_([text5("Static visualizations use appendData or TreeAPI")]), li_([text5("Dynamic visualizations use joinData with GUP")]), li_([text5("TreeAPI provides declarative syntax for tree structures")])])])])]);
  };
  var handleAction38 = function(dictMonadAff) {
    return function(v2) {
      return pure88(unit);
    };
  };
  var component39 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render43,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction38(dictMonadAff),
        initialize: new Just(Initialize39.value)
      })
    });
  };

  // output/Component.Understanding.UnderstandingScenes/index.js
  var pure89 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize40 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var svgDiagram3 = function(src10) {
    return function(alt11) {
      return img([src9("assets/diagrams/" + src10), alt5(alt11), style("max-width: 100%; height: auto;")]);
    };
  };
  var renderNavCard3 = function(title4) {
    return function(href5) {
      return function(description) {
        return a([href4(href5), classes(["section-nav-card"])])([h3_([text5(title4)]), p_([text5(description)])]);
      };
    };
  };
  var render44 = function(v2) {
    return div2([classes(["tutorial-page"])])([render4({
      logoSize: Large.value,
      quadrant: QuadUnderstanding.value,
      prevNext: Nothing.value,
      pageTitle: Nothing.value
    }), main_([section([classes(["tutorial-section", "tutorial-intro"])])([h1([classes(["tutorial-title"])])([text5("Scene Structures & Transitions")]), p_([text5("Complex interactive visualizations like force-directed graphs involve managing multiple concerns: user input, simulation physics, state transitions, and DOM updates. PSD3's Scene structures make this complexity declarative.")]), div2([classes(["section-nav-cards"])])([renderNavCard3("The Challenge")("#challenge")("Why interactive viz is hard"), renderNavCard3("Scene Structures")("#scene-structures")("Declarative state management"), renderNavCard3("Transitions")("#transitions")("Smooth state changes"), renderNavCard3("Code Explorer")("#code-explorer")("Flagship example")])]), section([classes(["tutorial-section"]), id3("challenge")])([h2([classes(["tutorial-section-title"])])([text5("The Challenge of Interactive Visualizations")]), p_([text5("Interactive, updating visualizations with simulations are among the most complex frontend code to write correctly. They involve:")]), ul_([li_([strong_([text5("User actions")]), text5(" - clicks, drags, hovers that trigger state changes")]), li_([strong_([text5("State management")]), text5(" - tracking what's visible, selected, filtered")]), li_([strong_([text5("Simulation physics")]), text5(" - continuous force calculations and position updates")]), li_([strong_([text5("Transitions")]), text5(" - smooth animations between states")]), li_([strong_([text5("DOM synchronization")]), text5(" - keeping the view in sync with the model")])]), p([classes(["code-highlight"])])([text5("Problem: "), text5("Imperative D3 code becomes tangled, hard to reason about, and prone to subtle bugs.")])]), section([classes(["tutorial-section"]), id3("scene-structures")])([h2([classes(["tutorial-section-title"])])([text5("Scene Structures")]), p_([text5("A Scene bundles together all the data needed to render a visualization state:")]), div2([classes(["diagram-container"])])([svgDiagram3("scene-lifecycle.svg")("Scene lifecycle diagram")]), p_([text5("Each scene contains:")]), ul_([li_([strong_([text5("Data")]), text5(" - the nodes, links, or other data to visualize")]), li_([strong_([text5("Configuration")]), text5(" - layout parameters, force strengths, etc.")]), li_([strong_([text5("Behaviors")]), text5(" - how elements enter, update, and exit")])]), p_([text5("When the scene changes, PSD3 automatically:")]), ul_([li_([text5("Calculates the diff between old and new data")]), li_([text5("Creates enter selections for new data")]), li_([text5("Updates existing elements")]), li_([text5("Removes exiting elements with transitions")])])]), section([classes(["tutorial-section"]), id3("transitions")])([h2([classes(["tutorial-section-title"])])([text5("Transition Matrix")]), p_([text5("Complex applications have multiple scenes (states) with transitions between them:")]), div2([classes(["diagram-container"])])([svgDiagram3("engines-comparison.svg")("Engine comparison: Interpolation vs Physics")]), p_([text5("Each transition defines:")]), ul_([li_([strong_([text5("TransitionConfig")]), text5(" - duration, easing, delay")]), li_([strong_([text5("Initial attributes")]), text5(" - starting state for entering elements")]), li_([strong_([text5("Target attributes")]), text5(" - ending state to animate toward")])]), p_([text5("This declarative approach makes complex multi-state visualizations much easier to reason about:")]), div2([classes(["diagram-container"])])([svgDiagram3("imperative-vs-declarative.svg")("Imperative vs declarative comparison")])]), section([classes(["tutorial-section"]), id3("code-explorer")])([h2([classes(["tutorial-section-title"])])([text5("Flagship Example: Code Explorer")]), p_([text5("The Code Explorer demonstrates Scene structures in action. It's an interactive force-directed graph of PureScript module dependencies with:")]), ul_([li_([strong_([text5("Multiple scenes")]), text5(" - different views of the module graph")]), li_([strong_([text5("Smooth transitions")]), text5(" - animated changes between states")]), li_([strong_([text5("User interactions")]), text5(" - click, drag, zoom, expand/collapse")]), li_([strong_([text5("Force simulation")]), text5(" - physics-based layout")])]), p_([text5("Despite this complexity, the core update logic is declarative - you specify the target scene and PSD3 handles the rest.")]), p([classes(["code-highlight"])])([text5("Key insight: "), text5('Think in terms of "what state do I want?" not "what updates do I need to apply?"')])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Summary")]), p_([text5("Scene structures enable:")]), ul_([li_([text5("Declarative state management for complex visualizations")]), li_([text5("Automatic diff calculation and DOM updates")]), li_([text5("Transition matrix for multi-state applications")]), li_([text5("Clean separation of data, configuration, and behavior")]), li_([text5("Easier reasoning about complex interactive visualizations")])])])])]);
  };
  var handleAction39 = function(dictMonadAff) {
    return function(v2) {
      return pure89(unit);
    };
  };
  var component40 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render44,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction39(dictMonadAff),
        initialize: new Just(Initialize40.value)
      })
    });
  };

  // output/Component.Understanding.UnderstandingSelections/index.js
  var pure90 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize41 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var svgDiagram4 = function(src10) {
    return function(alt11) {
      return img([src9("assets/diagrams/" + src10), alt5(alt11), style("max-width: 100%; height: auto;")]);
    };
  };
  var renderNavCard4 = function(title4) {
    return function(href5) {
      return function(description) {
        return a([href4(href5), classes(["section-nav-card"])])([h3_([text5(title4)]), p_([text5(description)])]);
      };
    };
  };
  var render45 = function(v2) {
    return div2([classes(["tutorial-page"])])([render4({
      logoSize: Large.value,
      quadrant: QuadUnderstanding.value,
      prevNext: Nothing.value,
      pageTitle: Nothing.value
    }), main_([section([classes(["tutorial-section", "tutorial-intro"])])([h1([classes(["tutorial-title"])])([text5("Selection Phantom Types")]), p_([text5("PSD3 uses phantom types to encode the state machine of D3 selections. This is similar to the Indexed Monad pattern - operations are only allowed when the selection is in the correct state, and this is enforced at compile time.")]), div2([classes(["section-nav-cards"])])([renderNavCard4("Selection States")("#selection-states")("Five phantom type states"), renderNavCard4("State Machine")("#state-machine")("Valid state transitions"), renderNavCard4("Indexed Monad")("#indexed-monad")("Why this pattern works"), renderNavCard4("Type Safety")("#type-safety")("Errors at compile time")])]), section([classes(["tutorial-section"]), id3("selection-states")])([h2([classes(["tutorial-section-title"])])([text5("The Five Selection States")]), p_([text5("A selection in PSD3 carries a phantom type parameter indicating its current state:")]), table([classes(["tutorial-table"])])([thead_([tr_([th_([text5("State")]), th_([text5("Meaning")]), th_([text5("Valid Operations")])])]), tbody_([tr_([td_([code_([text5("SEmpty")])]), td_([text5("Has parent elements, no data bound")]), td_([text5("appendChild, appendData, joinData")])]), tr_([td_([code_([text5("SPending")])]), td_([text5("Has data, needs elements (enter)")]), td_([text5("append")])]), tr_([td_([code_([text5("SBoundOwns")])]), td_([text5("Elements with bound data")]), td_([text5("setAttrs, appendChildInheriting, merge")])]), tr_([td_([code_([text5("SBoundInherits")])]), td_([text5("Child elements inheriting parent data")]), td_([text5("setAttrs")])]), tr_([td_([code_([text5("SExiting")])]), td_([text5("Elements to be removed (exit)")]), td_([text5("setAttrsExit, remove")])])])]), p([classes(["code-highlight"])])([text5("Note: "), text5("These types are 'phantom' - they exist only at compile time and carry no runtime data.")])]), section([classes(["tutorial-section"]), id3("state-machine")])([h2([classes(["tutorial-section-title"])])([text5("The Selection State Machine")]), p_([text5("Operations transition selections between states. The type system ensures only valid transitions are allowed:")]), div2([classes(["diagram-container"])])([svgDiagram4("selection-state-machine.svg")("Selection state machine diagram")]), p_([text5("Key transitions:")]), ul_([li_([code_([text5("select")]), text5(" \u2192 SEmpty (entry point)")]), li_([code_([text5("joinData")]), text5(" \u2192 JoinResult with enter/update/exit")]), li_([code_([text5("append")]), text5(" \u2192 SPending to SBoundOwns (creates elements)")]), li_([code_([text5("remove")]), text5(" \u2192 SExiting to done (deletes elements)")])])]), section([classes(["tutorial-section"]), id3("indexed-monad")])([h2([classes(["tutorial-section-title"])])([text5("The Indexed Monad Pattern")]), p_([text5("This design is inspired by Indexed Monads (also called Parameterized Monads). Unlike regular monads where bind has type:")]), p([classes(["code-highlight"])])([code_([text5("bind :: m a -> (a -> m b) -> m b")])]), p_([text5("Indexed monads carry additional type parameters for pre/post state:")]), p([classes(["code-highlight"])])([code_([text5("ibind :: m i j a -> (a -> m j k b) -> m i k b")])]), p_([text5("In PSD3, each selection operation is typed with its input and output states:")]), ul_([li_([code_([text5("select :: m (sel SEmpty ...)")])]), li_([code_([text5("append :: sel SPending ... -> m (sel SBoundOwns ...)")])])]), p_([text5("Sequencing operations chains their states - the output of one becomes input to the next.")])]), section([classes(["tutorial-section"]), id3("type-safety")])([h2([classes(["tutorial-section-title"])])([text5("Type Safety in Practice")]), p_([text5("Invalid operations are compile-time errors, not runtime bugs:")]), div2([classes(["diagram-container"])])([svgDiagram4("type-safety-errors.svg")("Type safety errors caught at compile time")]), p_([text5("Examples of errors caught at compile time:")]), ul_([li_([code_([text5("setAttrs attrs emptySel")]), text5(" - Can't set attrs on SEmpty")]), li_([code_([text5("append Circle boundSel")]), text5(" - Can't append to SBoundOwns")]), li_([code_([text5("remove pendingSel")]), text5(" - Can't remove SPending (has no elements)")])]), p_([text5("Compare to D3.js where these errors would fail silently or cause confusing runtime behavior.")]), p([classes(["code-highlight"])])([text5("Benefit: "), text5("The compiler guides you through the correct sequence of operations.")])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Summary")]), p_([text5("Selection phantom types provide:")]), ul_([li_([text5("Five states: SEmpty, SPending, SBoundOwns, SBoundInherits, SExiting")]), li_([text5("State machine enforced by types")]), li_([text5("Indexed Monad pattern for state transitions")]), li_([text5("Invalid operation sequences caught at compile time")]), li_([text5("No more silent failures or undefined behavior")])])])])]);
  };
  var handleAction40 = function(dictMonadAff) {
    return function(v2) {
      return pure90(unit);
    };
  };
  var component41 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render45,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction40(dictMonadAff),
        initialize: new Just(Initialize41.value)
      })
    });
  };

  // output/Component.Understanding.UnderstandingTreeAPI/index.js
  var pure91 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize42 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var svgDiagram5 = function(src10) {
    return function(alt11) {
      return img([src9("assets/diagrams/" + src10), alt5(alt11), style("max-width: 100%; height: auto;")]);
    };
  };
  var renderNavCard5 = function(title4) {
    return function(href5) {
      return function(description) {
        return a([href4(href5), classes(["section-nav-card"])])([h3_([text5(title4)]), p_([text5(description)])]);
      };
    };
  };
  var render46 = function(v2) {
    return div2([classes(["tutorial-page"])])([render4({
      logoSize: Large.value,
      quadrant: QuadUnderstanding.value,
      prevNext: Nothing.value,
      pageTitle: Nothing.value
    }), main_([section([classes(["tutorial-section", "tutorial-intro"])])([h1([classes(["tutorial-title"])])([text5("TreeAPI: Declarative Visualization")]), p_([text5("TreeAPI provides a declarative way to build visualization structures. Instead of imperative method chains, you declare the tree structure you want and PSD3 renders it. This makes static visualizations extremely succinct while maintaining full type safety.")]), div2([classes(["section-nav-cards"])])([renderNavCard5("Architecture")("#architecture")("API layer cake"), renderNavCard5("Tree Variants")("#tree-variants")("Node, Join, SceneJoin"), renderNavCard5("Static vs GUP")("#static-vs-gup")("When to use what"), renderNavCard5("Limitations")("#limitations")("When to use Selection API")])]), section([classes(["tutorial-section"]), id3("architecture")])([h2([classes(["tutorial-section-title"])])([text5("Architecture: The Layer Cake")]), p_([text5("PSD3 is organized in layers. TreeAPI and Simulation API are high-level, declarative APIs that sit on top of the core SelectionM layer:")]), div2([classes(["diagram-container"])])([svgDiagram5("layer-cake.svg")("PSD3 architecture layer cake diagram")]), p_([text5("Key points:")]), ul_([li_([strong_([text5("TreeAPI")]), text5(" - Declarative tree structures for static visualizations")]), li_([strong_([text5("Simulation API")]), text5(" - Force-directed layouts with physics")]), li_([strong_([text5("SelectionM")]), text5(" - Core selection operations with phantom types")]), li_([strong_([text5("Interpreters")]), text5(" - Multiple backends via Finally Tagless")])])]), section([classes(["tutorial-section"]), id3("tree-variants")])([h2([classes(["tutorial-section-title"])])([text5("Tree Variants")]), p_([text5("TreeAPI provides different tree node types for different use cases:")]), div2([classes(["diagram-container"])])([svgDiagram5("tree-variants.svg")("Tree API variants diagram")]), table([classes(["tutorial-table"])])([thead_([tr_([th_([text5("Variant")]), th_([text5("Use Case")]), th_([text5("Smart Constructor")])])]), tbody_([tr_([td_([code_([text5("Node")])]), td_([text5("Static elements with children")]), td_([code_([text5("named, elem")])])]), tr_([td_([code_([text5("Join")])]), td_([text5("N elements from N data items")]), td_([code_([text5("joinData")])])]), tr_([td_([code_([text5("NestedJoin")])]), td_([text5("Nested data with type decomposition")]), td_([code_([text5("nestedJoin")])])]), tr_([td_([code_([text5("SceneJoin")])]), td_([text5("GUP with enter/update/exit behaviors")]), td_([code_([text5("sceneJoin, sceneNestedJoin")])])])])]), p([classes(["code-highlight"])])([text5("Composition: "), code_([text5("withChild")]), text5(" and "), code_([text5("withChildren")]), text5(" build up tree structures.")])]), section([classes(["tutorial-section"]), id3("static-vs-gup")])([h2([classes(["tutorial-section-title"])])([text5("Static vs General Update Pattern")]), p_([text5("TreeAPI shines for static visualizations with its succinct, declarative syntax:")]), div2([classes(["diagram-container"])])([svgDiagram5("imperative-vs-declarative.svg")("Imperative vs declarative comparison")]), p_([text5("For updating visualizations, use "), code_([text5("SceneJoin")]), text5(" which declaratively specifies enter/update/exit behaviors:")]), ul_([li_([strong_([text5("Enter")]), text5(" - Initial attributes and optional transition for new elements")]), li_([strong_([text5("Update")]), text5(" - Attributes and transition for existing elements")]), li_([strong_([text5("Exit")]), text5(" - Attributes and transition before removal")])]), p([classes(["code-highlight"])])([text5("SceneNestedJoin: "), text5("Combines type decomposition with GUP - the most powerful variant.")])]), section([classes(["tutorial-section"]), id3("limitations")])([h2([classes(["tutorial-section-title"])])([text5("When to Use the Selection API")]), p_([text5("TreeAPI is excellent for many use cases, but the underlying Selection API provides more control for:")]), ul_([li_([strong_([text5("Complex interactions")]), text5(" - Fine-grained control over event handlers")]), li_([strong_([text5("Dynamic structures")]), text5(" - Tree shape that changes based on data")]), li_([strong_([text5("Custom transitions")]), text5(" - Coordinated animations across elements")]), li_([strong_([text5("Force simulations")]), text5(" - Physics-based layouts with tick functions")])]), p_([text5("The good news: both APIs work with the same SelectionM foundation, so you can mix them as needed. Use TreeAPI for structure, Selection API for behavior.")]), p([classes(["code-highlight"])])([text5("Tip: "), text5("Start with TreeAPI. Drop to Selection API when you need more control.")])]), section([classes(["tutorial-section"])])([h2([classes(["tutorial-section-title"])])([text5("Summary")]), p_([text5("TreeAPI provides:")]), ul_([li_([text5("Declarative tree structures instead of imperative chains")]), li_([text5("Four variants: Node, Join, NestedJoin, SceneJoin")]), li_([text5("Succinct static visualizations")]), li_([text5("SceneJoin for declarative GUP with transitions")]), li_([text5("Compatible with underlying Selection API")])])])])]);
  };
  var handleAction41 = function(dictMonadAff) {
    return function(v2) {
      return pure91(unit);
    };
  };
  var component42 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render46,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction41(dictMonadAff),
        initialize: new Just(Initialize42.value)
      })
    });
  };

  // output/Debug/foreign.js
  var req = typeof module === "undefined" ? void 0 : module.require;
  var util = (function() {
    try {
      return req === void 0 ? void 0 : req("util");
    } catch (e) {
      return void 0;
    }
  })();
  function _spy(tag, x32) {
    if (util !== void 0) {
      console.log(tag + ":", util.inspect(x32, { depth: null, colors: true }));
    } else {
      console.log(tag + ":", x32);
    }
    return x32;
  }
  var now2 = (function() {
    var perf;
    if (typeof performance !== "undefined") {
      perf = performance;
    } else if (req) {
      try {
        perf = req("perf_hooks").performance;
      } catch (e) {
      }
    }
    return (function() {
      return (perf || Date).now();
    });
  })();

  // output/Debug/index.js
  var spy = function() {
    return function(tag) {
      return function(a3) {
        return _spy(tag, a3);
      };
    };
  };

  // output/Halogen.Aff.Util/index.js
  var bind88 = /* @__PURE__ */ bind(bindAff);
  var liftEffect47 = /* @__PURE__ */ liftEffect(monadEffectAff);
  var bindFlipped5 = /* @__PURE__ */ bindFlipped(bindEffect);
  var composeKleisliFlipped4 = /* @__PURE__ */ composeKleisliFlipped(bindEffect);
  var pure92 = /* @__PURE__ */ pure(applicativeAff);
  var bindFlipped1 = /* @__PURE__ */ bindFlipped(bindMaybe);
  var pure123 = /* @__PURE__ */ pure(applicativeEffect);
  var map100 = /* @__PURE__ */ map(functorEffect);
  var discard62 = /* @__PURE__ */ discard(discardUnit);
  var throwError2 = /* @__PURE__ */ throwError(monadThrowAff);
  var selectElement = function(query2) {
    return bind88(liftEffect47(bindFlipped5(composeKleisliFlipped4((function() {
      var $16 = querySelector(query2);
      return function($17) {
        return $16(toParentNode3($17));
      };
    })())(document2))(windowImpl)))(function(mel) {
      return pure92(bindFlipped1(fromElement)(mel));
    });
  };
  var runHalogenAff = /* @__PURE__ */ runAff_(/* @__PURE__ */ either(throwException)(/* @__PURE__ */ $$const(/* @__PURE__ */ pure123(unit))));
  var awaitLoad = /* @__PURE__ */ makeAff(function(callback) {
    return function __do7() {
      var rs = bindFlipped5(readyState)(bindFlipped5(document2)(windowImpl))();
      if (rs instanceof Loading) {
        var et = map100(toEventTarget)(windowImpl)();
        var listener = eventListener(function(v2) {
          return callback(new Right(unit));
        })();
        addEventListener2(domcontentloaded)(listener)(false)(et)();
        return effectCanceler(removeEventListener2(domcontentloaded)(listener)(false)(et));
      }
      ;
      callback(new Right(unit))();
      return nonCanceler;
    };
  });
  var awaitBody = /* @__PURE__ */ discard62(bindAff)(awaitLoad)(function() {
    return bind88(selectElement("body"))(function(body2) {
      return maybe(throwError2(error("Could not find body")))(pure92)(body2);
    });
  });

  // output/Control.Monad.Fork.Class/index.js
  var monadForkAff = {
    suspend: suspendAff,
    fork: forkAff,
    join: joinFiber,
    Monad0: function() {
      return monadAff;
    },
    Functor1: function() {
      return functorFiber;
    }
  };
  var fork2 = function(dict) {
    return dict.fork;
  };

  // output/Halogen.Aff.Driver.State/index.js
  var unRenderStateX = unsafeCoerce2;
  var unDriverStateX = unsafeCoerce2;
  var renderStateX_ = function(dictApplicative) {
    var traverse_10 = traverse_(dictApplicative)(foldableMaybe);
    return function(f) {
      return unDriverStateX(function(st) {
        return traverse_10(f)(st.rendering);
      });
    };
  };
  var mkRenderStateX = unsafeCoerce2;
  var renderStateX = function(dictFunctor) {
    return function(f) {
      return unDriverStateX(function(st) {
        return mkRenderStateX(f(st.rendering));
      });
    };
  };
  var mkDriverStateXRef = unsafeCoerce2;
  var mapDriverState = function(f) {
    return function(v2) {
      return f(v2);
    };
  };
  var initDriverState = function(component54) {
    return function(input3) {
      return function(handler3) {
        return function(lchs) {
          return function __do7() {
            var selfRef = $$new({})();
            var childrenIn = $$new(empty6)();
            var childrenOut = $$new(empty6)();
            var handlerRef = $$new(handler3)();
            var pendingQueries = $$new(new Just(Nil.value))();
            var pendingOuts = $$new(new Just(Nil.value))();
            var pendingHandlers = $$new(Nothing.value)();
            var fresh2 = $$new(1)();
            var subscriptions = $$new(new Just(empty4))();
            var forks = $$new(empty4)();
            var ds = {
              component: component54,
              state: component54.initialState(input3),
              refs: empty4,
              children: empty6,
              childrenIn,
              childrenOut,
              selfRef,
              handlerRef,
              pendingQueries,
              pendingOuts,
              pendingHandlers,
              rendering: Nothing.value,
              fresh: fresh2,
              subscriptions,
              forks,
              lifecycleHandlers: lchs
            };
            write(ds)(selfRef)();
            return mkDriverStateXRef(selfRef);
          };
        };
      };
    };
  };

  // output/Halogen.Aff.Driver.Eval/index.js
  var traverse_7 = /* @__PURE__ */ traverse_(applicativeEffect)(foldableMaybe);
  var bindFlipped6 = /* @__PURE__ */ bindFlipped(bindMaybe);
  var lookup35 = /* @__PURE__ */ lookup(ordSubscriptionId);
  var bind136 = /* @__PURE__ */ bind(bindAff);
  var liftEffect48 = /* @__PURE__ */ liftEffect(monadEffectAff);
  var discard63 = /* @__PURE__ */ discard(discardUnit);
  var discard119 = /* @__PURE__ */ discard63(bindAff);
  var traverse_12 = /* @__PURE__ */ traverse_(applicativeAff);
  var traverse_22 = /* @__PURE__ */ traverse_12(foldableList);
  var fork3 = /* @__PURE__ */ fork2(monadForkAff);
  var parSequence_2 = /* @__PURE__ */ parSequence_(parallelAff)(applicativeParAff)(foldableList);
  var pure93 = /* @__PURE__ */ pure(applicativeAff);
  var map101 = /* @__PURE__ */ map(functorCoyoneda);
  var parallel3 = /* @__PURE__ */ parallel(parallelAff);
  var map121 = /* @__PURE__ */ map(functorAff);
  var sequential3 = /* @__PURE__ */ sequential(parallelAff);
  var map210 = /* @__PURE__ */ map(functorMaybe);
  var insert17 = /* @__PURE__ */ insert(ordSubscriptionId);
  var retractFreeAp2 = /* @__PURE__ */ retractFreeAp(applicativeParAff);
  var $$delete9 = /* @__PURE__ */ $$delete2(ordForkId);
  var unlessM2 = /* @__PURE__ */ unlessM(monadEffect);
  var insert18 = /* @__PURE__ */ insert(ordForkId);
  var traverse_32 = /* @__PURE__ */ traverse_12(foldableMaybe);
  var lookup110 = /* @__PURE__ */ lookup(ordForkId);
  var lookup210 = /* @__PURE__ */ lookup(ordString);
  var foldFree2 = /* @__PURE__ */ foldFree(monadRecAff);
  var alter2 = /* @__PURE__ */ alter(ordString);
  var unsubscribe3 = function(sid) {
    return function(ref2) {
      return function __do7() {
        var v2 = read(ref2)();
        var subs = read(v2.subscriptions)();
        return traverse_7(unsubscribe)(bindFlipped6(lookup35(sid))(subs))();
      };
    };
  };
  var queueOrRun = function(ref2) {
    return function(au) {
      return bind136(liftEffect48(read(ref2)))(function(v2) {
        if (v2 instanceof Nothing) {
          return au;
        }
        ;
        if (v2 instanceof Just) {
          return liftEffect48(write(new Just(new Cons(au, v2.value0)))(ref2));
        }
        ;
        throw new Error("Failed pattern match at Halogen.Aff.Driver.Eval (line 188, column 33 - line 190, column 57): " + [v2.constructor.name]);
      });
    };
  };
  var handleLifecycle = function(lchs) {
    return function(f) {
      return discard119(liftEffect48(write({
        initializers: Nil.value,
        finalizers: Nil.value
      })(lchs)))(function() {
        return bind136(liftEffect48(f))(function(result) {
          return bind136(liftEffect48(read(lchs)))(function(v2) {
            return discard119(traverse_22(fork3)(v2.finalizers))(function() {
              return discard119(parSequence_2(v2.initializers))(function() {
                return pure93(result);
              });
            });
          });
        });
      });
    };
  };
  var handleAff = /* @__PURE__ */ runAff_(/* @__PURE__ */ either(throwException)(/* @__PURE__ */ $$const(/* @__PURE__ */ pure(applicativeEffect)(unit))));
  var fresh = function(f) {
    return function(ref2) {
      return bind136(liftEffect48(read(ref2)))(function(v2) {
        return liftEffect48(modify$prime(function(i2) {
          return {
            state: i2 + 1 | 0,
            value: f(i2)
          };
        })(v2.fresh));
      });
    };
  };
  var evalQ = function(render58) {
    return function(ref2) {
      return function(q3) {
        return bind136(liftEffect48(read(ref2)))(function(v2) {
          return evalM(render58)(ref2)(v2["component"]["eval"](new Query(map101(Just.create)(liftCoyoneda(q3)), $$const(Nothing.value))));
        });
      };
    };
  };
  var evalM = function(render58) {
    return function(initRef) {
      return function(v2) {
        var evalChildQuery = function(ref2) {
          return function(cqb) {
            return bind136(liftEffect48(read(ref2)))(function(v1) {
              return unChildQueryBox(function(v22) {
                var evalChild = function(v3) {
                  return parallel3(bind136(liftEffect48(read(v3)))(function(dsx) {
                    return unDriverStateX(function(ds) {
                      return evalQ(render58)(ds.selfRef)(v22.value1);
                    })(dsx);
                  }));
                };
                return map121(v22.value2)(sequential3(v22.value0(applicativeParAff)(evalChild)(v1.children)));
              })(cqb);
            });
          };
        };
        var go2 = function(ref2) {
          return function(v1) {
            if (v1 instanceof State) {
              return bind136(liftEffect48(read(ref2)))(function(v22) {
                var v3 = v1.value0(v22.state);
                if (unsafeRefEq(v22.state)(v3.value1)) {
                  return pure93(v3.value0);
                }
                ;
                if (otherwise) {
                  return discard119(liftEffect48(write({
                    component: v22.component,
                    refs: v22.refs,
                    children: v22.children,
                    childrenIn: v22.childrenIn,
                    childrenOut: v22.childrenOut,
                    selfRef: v22.selfRef,
                    handlerRef: v22.handlerRef,
                    pendingQueries: v22.pendingQueries,
                    pendingOuts: v22.pendingOuts,
                    pendingHandlers: v22.pendingHandlers,
                    rendering: v22.rendering,
                    fresh: v22.fresh,
                    subscriptions: v22.subscriptions,
                    forks: v22.forks,
                    lifecycleHandlers: v22.lifecycleHandlers,
                    state: v3.value1
                  })(ref2)))(function() {
                    return discard119(handleLifecycle(v22.lifecycleHandlers)(render58(v22.lifecycleHandlers)(ref2)))(function() {
                      return pure93(v3.value0);
                    });
                  });
                }
                ;
                throw new Error("Failed pattern match at Halogen.Aff.Driver.Eval (line 86, column 7 - line 92, column 21): " + [v3.constructor.name]);
              });
            }
            ;
            if (v1 instanceof Subscribe) {
              return bind136(fresh(SubscriptionId)(ref2))(function(sid) {
                return bind136(liftEffect48(subscribe(v1.value0(sid))(function(act) {
                  return handleAff(evalF(render58)(ref2)(new Action(act)));
                })))(function(finalize) {
                  return bind136(liftEffect48(read(ref2)))(function(v22) {
                    return discard119(liftEffect48(modify_2(map210(insert17(sid)(finalize)))(v22.subscriptions)))(function() {
                      return pure93(v1.value1(sid));
                    });
                  });
                });
              });
            }
            ;
            if (v1 instanceof Unsubscribe) {
              return discard119(liftEffect48(unsubscribe3(v1.value0)(ref2)))(function() {
                return pure93(v1.value1);
              });
            }
            ;
            if (v1 instanceof Lift2) {
              return v1.value0;
            }
            ;
            if (v1 instanceof ChildQuery2) {
              return evalChildQuery(ref2)(v1.value0);
            }
            ;
            if (v1 instanceof Raise) {
              return bind136(liftEffect48(read(ref2)))(function(v22) {
                return bind136(liftEffect48(read(v22.handlerRef)))(function(handler3) {
                  return discard119(queueOrRun(v22.pendingOuts)(handler3(v1.value0)))(function() {
                    return pure93(v1.value1);
                  });
                });
              });
            }
            ;
            if (v1 instanceof Par) {
              return sequential3(retractFreeAp2(hoistFreeAp((function() {
                var $119 = evalM(render58)(ref2);
                return function($120) {
                  return parallel3($119($120));
                };
              })())(v1.value0)));
            }
            ;
            if (v1 instanceof Fork) {
              return bind136(fresh(ForkId)(ref2))(function(fid) {
                return bind136(liftEffect48(read(ref2)))(function(v22) {
                  return bind136(liftEffect48($$new(false)))(function(doneRef) {
                    return bind136(fork3($$finally(liftEffect48(function __do7() {
                      modify_2($$delete9(fid))(v22.forks)();
                      return write(true)(doneRef)();
                    }))(evalM(render58)(ref2)(v1.value0))))(function(fiber) {
                      return discard119(liftEffect48(unlessM2(read(doneRef))(modify_2(insert18(fid)(fiber))(v22.forks))))(function() {
                        return pure93(v1.value1(fid));
                      });
                    });
                  });
                });
              });
            }
            ;
            if (v1 instanceof Join2) {
              return bind136(liftEffect48(read(ref2)))(function(v22) {
                return bind136(liftEffect48(read(v22.forks)))(function(forkMap) {
                  return discard119(traverse_32(joinFiber)(lookup110(v1.value0)(forkMap)))(function() {
                    return pure93(v1.value1);
                  });
                });
              });
            }
            ;
            if (v1 instanceof Kill) {
              return bind136(liftEffect48(read(ref2)))(function(v22) {
                return bind136(liftEffect48(read(v22.forks)))(function(forkMap) {
                  return discard119(traverse_32(killFiber(error("Cancelled")))(lookup110(v1.value0)(forkMap)))(function() {
                    return pure93(v1.value1);
                  });
                });
              });
            }
            ;
            if (v1 instanceof GetRef) {
              return bind136(liftEffect48(read(ref2)))(function(v22) {
                return pure93(v1.value1(lookup210(v1.value0)(v22.refs)));
              });
            }
            ;
            throw new Error("Failed pattern match at Halogen.Aff.Driver.Eval (line 83, column 12 - line 139, column 33): " + [v1.constructor.name]);
          };
        };
        return foldFree2(go2(initRef))(v2);
      };
    };
  };
  var evalF = function(render58) {
    return function(ref2) {
      return function(v2) {
        if (v2 instanceof RefUpdate) {
          return liftEffect48(flip(modify_2)(ref2)(mapDriverState(function(st) {
            return {
              component: st.component,
              state: st.state,
              children: st.children,
              childrenIn: st.childrenIn,
              childrenOut: st.childrenOut,
              selfRef: st.selfRef,
              handlerRef: st.handlerRef,
              pendingQueries: st.pendingQueries,
              pendingOuts: st.pendingOuts,
              pendingHandlers: st.pendingHandlers,
              rendering: st.rendering,
              fresh: st.fresh,
              subscriptions: st.subscriptions,
              forks: st.forks,
              lifecycleHandlers: st.lifecycleHandlers,
              refs: alter2($$const(v2.value1))(v2.value0)(st.refs)
            };
          })));
        }
        ;
        if (v2 instanceof Action) {
          return bind136(liftEffect48(read(ref2)))(function(v1) {
            return evalM(render58)(ref2)(v1["component"]["eval"](new Action2(v2.value0, unit)));
          });
        }
        ;
        throw new Error("Failed pattern match at Halogen.Aff.Driver.Eval (line 52, column 20 - line 58, column 62): " + [v2.constructor.name]);
      };
    };
  };

  // output/Halogen.Aff.Driver/index.js
  var bind89 = /* @__PURE__ */ bind(bindEffect);
  var discard64 = /* @__PURE__ */ discard(discardUnit);
  var for_9 = /* @__PURE__ */ for_(applicativeEffect)(foldableMaybe);
  var traverse_8 = /* @__PURE__ */ traverse_(applicativeAff)(foldableList);
  var fork4 = /* @__PURE__ */ fork2(monadForkAff);
  var bindFlipped7 = /* @__PURE__ */ bindFlipped(bindEffect);
  var traverse_13 = /* @__PURE__ */ traverse_(applicativeEffect);
  var traverse_23 = /* @__PURE__ */ traverse_13(foldableMaybe);
  var traverse_33 = /* @__PURE__ */ traverse_13(foldableMap);
  var discard218 = /* @__PURE__ */ discard64(bindAff);
  var parSequence_3 = /* @__PURE__ */ parSequence_(parallelAff)(applicativeParAff)(foldableList);
  var liftEffect49 = /* @__PURE__ */ liftEffect(monadEffectAff);
  var pure94 = /* @__PURE__ */ pure(applicativeEffect);
  var map102 = /* @__PURE__ */ map(functorEffect);
  var pure124 = /* @__PURE__ */ pure(applicativeAff);
  var when10 = /* @__PURE__ */ when(applicativeEffect);
  var renderStateX2 = /* @__PURE__ */ renderStateX(functorEffect);
  var $$void17 = /* @__PURE__ */ $$void(functorAff);
  var foreachSlot2 = /* @__PURE__ */ foreachSlot(applicativeEffect);
  var renderStateX_2 = /* @__PURE__ */ renderStateX_(applicativeEffect);
  var tailRecM3 = /* @__PURE__ */ tailRecM(monadRecEffect);
  var voidLeft4 = /* @__PURE__ */ voidLeft(functorEffect);
  var bind137 = /* @__PURE__ */ bind(bindAff);
  var liftEffect117 = /* @__PURE__ */ liftEffect(monadEffectEffect);
  var newLifecycleHandlers = /* @__PURE__ */ (function() {
    return $$new({
      initializers: Nil.value,
      finalizers: Nil.value
    });
  })();
  var handlePending = function(ref2) {
    return function __do7() {
      var queue = read(ref2)();
      write(Nothing.value)(ref2)();
      return for_9(queue)((function() {
        var $59 = traverse_8(fork4);
        return function($60) {
          return handleAff($59(reverse($60)));
        };
      })())();
    };
  };
  var cleanupSubscriptionsAndForks = function(v2) {
    return function __do7() {
      bindFlipped7(traverse_23(traverse_33(unsubscribe)))(read(v2.subscriptions))();
      write(Nothing.value)(v2.subscriptions)();
      bindFlipped7(traverse_33((function() {
        var $61 = killFiber(error("finalized"));
        return function($62) {
          return handleAff($61($62));
        };
      })()))(read(v2.forks))();
      return write(empty4)(v2.forks)();
    };
  };
  var runUI = function(renderSpec2) {
    return function(component54) {
      return function(i2) {
        var squashChildInitializers = function(lchs) {
          return function(preInits) {
            return unDriverStateX(function(st) {
              var parentInitializer = evalM(render58)(st.selfRef)(st["component"]["eval"](new Initialize(unit)));
              return modify_2(function(handlers) {
                return {
                  initializers: new Cons(discard218(parSequence_3(reverse(handlers.initializers)))(function() {
                    return discard218(parentInitializer)(function() {
                      return liftEffect49(function __do7() {
                        handlePending(st.pendingQueries)();
                        return handlePending(st.pendingOuts)();
                      });
                    });
                  }), preInits),
                  finalizers: handlers.finalizers
                };
              })(lchs);
            });
          };
        };
        var runComponent = function(lchs) {
          return function(handler3) {
            return function(j) {
              return unComponent(function(c2) {
                return function __do7() {
                  var lchs$prime = newLifecycleHandlers();
                  var $$var2 = initDriverState(c2)(j)(handler3)(lchs$prime)();
                  var pre2 = read(lchs)();
                  write({
                    initializers: Nil.value,
                    finalizers: pre2.finalizers
                  })(lchs)();
                  bindFlipped7(unDriverStateX((function() {
                    var $63 = render58(lchs);
                    return function($64) {
                      return $63((function(v2) {
                        return v2.selfRef;
                      })($64));
                    };
                  })()))(read($$var2))();
                  bindFlipped7(squashChildInitializers(lchs)(pre2.initializers))(read($$var2))();
                  return $$var2;
                };
              });
            };
          };
        };
        var renderChild = function(lchs) {
          return function(handler3) {
            return function(childrenInRef) {
              return function(childrenOutRef) {
                return unComponentSlot(function(slot) {
                  return function __do7() {
                    var childrenIn = map102(slot.pop)(read(childrenInRef))();
                    var $$var2 = (function() {
                      if (childrenIn instanceof Just) {
                        write(childrenIn.value0.value1)(childrenInRef)();
                        var dsx = read(childrenIn.value0.value0)();
                        unDriverStateX(function(st) {
                          return function __do8() {
                            flip(write)(st.handlerRef)((function() {
                              var $65 = maybe(pure124(unit))(handler3);
                              return function($66) {
                                return $65(slot.output($66));
                              };
                            })())();
                            return handleAff(evalM(render58)(st.selfRef)(st["component"]["eval"](new Receive(slot.input, unit))))();
                          };
                        })(dsx)();
                        return childrenIn.value0.value0;
                      }
                      ;
                      if (childrenIn instanceof Nothing) {
                        return runComponent(lchs)((function() {
                          var $67 = maybe(pure124(unit))(handler3);
                          return function($68) {
                            return $67(slot.output($68));
                          };
                        })())(slot.input)(slot.component)();
                      }
                      ;
                      throw new Error("Failed pattern match at Halogen.Aff.Driver (line 213, column 14 - line 222, column 98): " + [childrenIn.constructor.name]);
                    })();
                    var isDuplicate = map102(function($69) {
                      return isJust(slot.get($69));
                    })(read(childrenOutRef))();
                    when10(isDuplicate)(warn("Halogen: Duplicate slot address was detected during rendering, unexpected results may occur"))();
                    modify_2(slot.set($$var2))(childrenOutRef)();
                    return bind89(read($$var2))(renderStateX2(function(v2) {
                      if (v2 instanceof Nothing) {
                        return $$throw("Halogen internal error: child was not initialized in renderChild");
                      }
                      ;
                      if (v2 instanceof Just) {
                        return pure94(renderSpec2.renderChild(v2.value0));
                      }
                      ;
                      throw new Error("Failed pattern match at Halogen.Aff.Driver (line 227, column 37 - line 229, column 50): " + [v2.constructor.name]);
                    }))();
                  };
                });
              };
            };
          };
        };
        var render58 = function(lchs) {
          return function($$var2) {
            return function __do7() {
              var v2 = read($$var2)();
              var shouldProcessHandlers = map102(isNothing)(read(v2.pendingHandlers))();
              when10(shouldProcessHandlers)(write(new Just(Nil.value))(v2.pendingHandlers))();
              write(empty6)(v2.childrenOut)();
              write(v2.children)(v2.childrenIn)();
              var handler3 = (function() {
                var $70 = queueOrRun(v2.pendingHandlers);
                var $71 = evalF(render58)(v2.selfRef);
                return function($72) {
                  return $70($$void17($71($72)));
                };
              })();
              var childHandler = (function() {
                var $73 = queueOrRun(v2.pendingQueries);
                return function($74) {
                  return $73(handler3(Action.create($74)));
                };
              })();
              var rendering = renderSpec2.render(function($75) {
                return handleAff(handler3($75));
              })(renderChild(lchs)(childHandler)(v2.childrenIn)(v2.childrenOut))(v2.component.render(v2.state))(v2.rendering)();
              var children3 = read(v2.childrenOut)();
              var childrenIn = read(v2.childrenIn)();
              foreachSlot2(childrenIn)(function(v1) {
                return function __do8() {
                  var childDS = read(v1)();
                  renderStateX_2(renderSpec2.removeChild)(childDS)();
                  return finalize(lchs)(childDS)();
                };
              })();
              flip(modify_2)(v2.selfRef)(mapDriverState(function(ds$prime) {
                return {
                  component: ds$prime.component,
                  state: ds$prime.state,
                  refs: ds$prime.refs,
                  childrenIn: ds$prime.childrenIn,
                  childrenOut: ds$prime.childrenOut,
                  selfRef: ds$prime.selfRef,
                  handlerRef: ds$prime.handlerRef,
                  pendingQueries: ds$prime.pendingQueries,
                  pendingOuts: ds$prime.pendingOuts,
                  pendingHandlers: ds$prime.pendingHandlers,
                  fresh: ds$prime.fresh,
                  subscriptions: ds$prime.subscriptions,
                  forks: ds$prime.forks,
                  lifecycleHandlers: ds$prime.lifecycleHandlers,
                  rendering: new Just(rendering),
                  children: children3
                };
              }))();
              return when10(shouldProcessHandlers)(flip(tailRecM3)(unit)(function(v1) {
                return function __do8() {
                  var handlers = read(v2.pendingHandlers)();
                  write(new Just(Nil.value))(v2.pendingHandlers)();
                  traverse_23((function() {
                    var $76 = traverse_8(fork4);
                    return function($77) {
                      return handleAff($76(reverse($77)));
                    };
                  })())(handlers)();
                  var mmore = read(v2.pendingHandlers)();
                  var $52 = maybe(false)($$null)(mmore);
                  if ($52) {
                    return voidLeft4(write(Nothing.value)(v2.pendingHandlers))(new Done(unit))();
                  }
                  ;
                  return new Loop(unit);
                };
              }))();
            };
          };
        };
        var finalize = function(lchs) {
          return unDriverStateX(function(st) {
            return function __do7() {
              cleanupSubscriptionsAndForks(st)();
              var f = evalM(render58)(st.selfRef)(st["component"]["eval"](new Finalize(unit)));
              modify_2(function(handlers) {
                return {
                  initializers: handlers.initializers,
                  finalizers: new Cons(f, handlers.finalizers)
                };
              })(lchs)();
              return foreachSlot2(st.children)(function(v2) {
                return function __do8() {
                  var dsx = read(v2)();
                  return finalize(lchs)(dsx)();
                };
              })();
            };
          });
        };
        var evalDriver = function(disposed) {
          return function(ref2) {
            return function(q3) {
              return bind137(liftEffect49(read(disposed)))(function(v2) {
                if (v2) {
                  return pure124(Nothing.value);
                }
                ;
                return evalQ(render58)(ref2)(q3);
              });
            };
          };
        };
        var dispose = function(disposed) {
          return function(lchs) {
            return function(dsx) {
              return handleLifecycle(lchs)(function __do7() {
                var v2 = read(disposed)();
                if (v2) {
                  return unit;
                }
                ;
                write(true)(disposed)();
                finalize(lchs)(dsx)();
                return unDriverStateX(function(v1) {
                  return function __do8() {
                    var v22 = liftEffect117(read(v1.selfRef))();
                    return for_9(v22.rendering)(renderSpec2.dispose)();
                  };
                })(dsx)();
              });
            };
          };
        };
        return bind137(liftEffect49(newLifecycleHandlers))(function(lchs) {
          return bind137(liftEffect49($$new(false)))(function(disposed) {
            return handleLifecycle(lchs)(function __do7() {
              var sio = create4();
              var dsx = bindFlipped7(read)(runComponent(lchs)((function() {
                var $78 = notify(sio.listener);
                return function($79) {
                  return liftEffect49($78($79));
                };
              })())(i2)(component54))();
              return unDriverStateX(function(st) {
                return pure94({
                  query: evalDriver(disposed)(st.selfRef),
                  messages: sio.emitter,
                  dispose: dispose(disposed)(lchs)(dsx)
                });
              })(dsx)();
            });
          });
        });
      };
    };
  };

  // output/Halogen.VDom.Driver/index.js
  var $runtime_lazy10 = function(name16, moduleName, init4) {
    var state3 = 0;
    var val;
    return function(lineNumber) {
      if (state3 === 2) return val;
      if (state3 === 1) throw new ReferenceError(name16 + " was needed before it finished initializing (module " + moduleName + ", line " + lineNumber + ")", moduleName, lineNumber);
      state3 = 1;
      val = init4();
      state3 = 2;
      return val;
    };
  };
  var $$void18 = /* @__PURE__ */ $$void(functorEffect);
  var pure95 = /* @__PURE__ */ pure(applicativeEffect);
  var traverse_9 = /* @__PURE__ */ traverse_(applicativeEffect)(foldableMaybe);
  var unwrap8 = /* @__PURE__ */ unwrap();
  var when11 = /* @__PURE__ */ when(applicativeEffect);
  var not5 = /* @__PURE__ */ not(/* @__PURE__ */ heytingAlgebraFunction(/* @__PURE__ */ heytingAlgebraFunction(heytingAlgebraBoolean)));
  var identity17 = /* @__PURE__ */ identity(categoryFn);
  var bind138 = /* @__PURE__ */ bind(bindAff);
  var liftEffect50 = /* @__PURE__ */ liftEffect(monadEffectAff);
  var map103 = /* @__PURE__ */ map(functorEffect);
  var bindFlipped8 = /* @__PURE__ */ bindFlipped(bindEffect);
  var substInParent = function(v2) {
    return function(v1) {
      return function(v22) {
        if (v1 instanceof Just && v22 instanceof Just) {
          return $$void18(insertBefore(v2)(v1.value0)(v22.value0));
        }
        ;
        if (v1 instanceof Nothing && v22 instanceof Just) {
          return $$void18(appendChild2(v2)(v22.value0));
        }
        ;
        return pure95(unit);
      };
    };
  };
  var removeChild3 = function(v2) {
    return function __do7() {
      var npn = parentNode(v2.node)();
      return traverse_9(function(pn) {
        return removeChild(v2.node)(pn);
      })(npn)();
    };
  };
  var mkSpec = function(handler3) {
    return function(renderChildRef) {
      return function(document3) {
        var getNode = unRenderStateX(function(v2) {
          return v2.node;
        });
        var done = function(st) {
          if (st instanceof Just) {
            return halt(st.value0);
          }
          ;
          return unit;
        };
        var buildWidget2 = function(spec) {
          var buildThunk2 = buildThunk(unwrap8)(spec);
          var $lazy_patch = $runtime_lazy10("patch", "Halogen.VDom.Driver", function() {
            return function(st, slot) {
              if (st instanceof Just) {
                if (slot instanceof ComponentSlot) {
                  halt(st.value0);
                  return $lazy_renderComponentSlot(100)(slot.value0);
                }
                ;
                if (slot instanceof ThunkSlot) {
                  var step$prime = step2(st.value0, slot.value0);
                  return mkStep(new Step2(extract2(step$prime), new Just(step$prime), $lazy_patch(103), done));
                }
                ;
                throw new Error("Failed pattern match at Halogen.VDom.Driver (line 97, column 22 - line 103, column 79): " + [slot.constructor.name]);
              }
              ;
              return $lazy_render(104)(slot);
            };
          });
          var $lazy_render = $runtime_lazy10("render", "Halogen.VDom.Driver", function() {
            return function(slot) {
              if (slot instanceof ComponentSlot) {
                return $lazy_renderComponentSlot(86)(slot.value0);
              }
              ;
              if (slot instanceof ThunkSlot) {
                var step5 = buildThunk2(slot.value0);
                return mkStep(new Step2(extract2(step5), new Just(step5), $lazy_patch(89), done));
              }
              ;
              throw new Error("Failed pattern match at Halogen.VDom.Driver (line 84, column 7 - line 89, column 75): " + [slot.constructor.name]);
            };
          });
          var $lazy_renderComponentSlot = $runtime_lazy10("renderComponentSlot", "Halogen.VDom.Driver", function() {
            return function(cs) {
              var renderChild = read(renderChildRef)();
              var rsx = renderChild(cs)();
              var node = getNode(rsx);
              return mkStep(new Step2(node, Nothing.value, $lazy_patch(117), done));
            };
          });
          var patch2 = $lazy_patch(91);
          var render58 = $lazy_render(82);
          var renderComponentSlot = $lazy_renderComponentSlot(109);
          return render58;
        };
        var buildAttributes = buildProp(handler3);
        return {
          buildWidget: buildWidget2,
          buildAttributes,
          document: document3
        };
      };
    };
  };
  var renderSpec = function(document3) {
    return function(container) {
      var render58 = function(handler3) {
        return function(child) {
          return function(v2) {
            return function(v1) {
              if (v1 instanceof Nothing) {
                return function __do7() {
                  var renderChildRef = $$new(child)();
                  var spec = mkSpec(handler3)(renderChildRef)(document3);
                  var machine = buildVDom(spec)(v2);
                  var node = extract2(machine);
                  $$void18(appendChild2(node)(toNode2(container)))();
                  return {
                    machine,
                    node,
                    renderChildRef
                  };
                };
              }
              ;
              if (v1 instanceof Just) {
                return function __do7() {
                  write(child)(v1.value0.renderChildRef)();
                  var parent2 = parentNode(v1.value0.node)();
                  var nextSib = nextSibling(v1.value0.node)();
                  var machine$prime = step2(v1.value0.machine, v2);
                  var newNode = extract2(machine$prime);
                  when11(not5(unsafeRefEq)(v1.value0.node)(newNode))(substInParent(newNode)(nextSib)(parent2))();
                  return {
                    machine: machine$prime,
                    node: newNode,
                    renderChildRef: v1.value0.renderChildRef
                  };
                };
              }
              ;
              throw new Error("Failed pattern match at Halogen.VDom.Driver (line 157, column 5 - line 173, column 80): " + [v1.constructor.name]);
            };
          };
        };
      };
      return {
        render: render58,
        renderChild: identity17,
        removeChild: removeChild3,
        dispose: removeChild3
      };
    };
  };
  var runUI2 = function(component54) {
    return function(i2) {
      return function(element4) {
        return bind138(liftEffect50(map103(toDocument)(bindFlipped8(document2)(windowImpl))))(function(document3) {
          return runUI(renderSpec(document3)(element4))(component54)(i2);
        });
      };
    };
  };

  // output/PSD3.Shared.Footer/index.js
  var render47 = /* @__PURE__ */ (function() {
    return footer([classes(["site-footer"])])([hr([classes(["site-footer__rule"])]), div2([classes(["site-footer__content"])])([a([href4("#" + routeToPath(Acknowledgements.value)), classes(["site-footer__link"])])([text5("Acknowledgements")])])]);
  })();

  // output/PSD3.Acknowledgements/index.js
  var discard65 = /* @__PURE__ */ discard(discardUnit)(bindHalogenM);
  var bind90 = /* @__PURE__ */ bind(bindHalogenM);
  var pure96 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize43 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var render48 = function(v2) {
    return div2([classes(["acknowledgements-page"])])([render4({
      logoSize: Large.value,
      quadrant: NoQuadrant.value,
      prevNext: Nothing.value,
      pageTitle: Nothing.value
    }), div2([classes(["acknowledgements-content"])])([h1([classes(["acknowledgements-title"])])([text5("Acknowledgements")]), section([classes(["acknowledgements-section"])])([h2_([text5("D3.js and Data Visualization")]), p_([text5("This project would not exist without "), a([href4("https://d3js.org/")])([text5("D3.js")]), text5(", created by "), a([href4("https://bost.ocks.org/mike/")])([text5("Mike Bostock")]), text5(". D3 revolutionized web-based data visualization and established patterns that have become fundamental to the field. Many of the examples in PS<$>D3 are adapted from Mike's extensive collection of examples and tutorials.")]), p_([text5("Thanks so much to Mike for creating D3, for his clear documentation and examples, and for making the library open source. His work on Observable and continued contributions to visualization continue to inspire.")]), h3_([text5("Library Dependencies")]), p_([text5("This diagram shows how D3 modules flow into our library packages. Note D3's own internal dependencies on the left - modules like d3-zoom depend on d3-transition, d3-drag, etc. Unused D3 modules are tree-shaken from the bundle.")]), div2([id3("d3-library-sankey"), style("background: #fafafa; border-radius: 8px; padding: 10px;")])([])]), section([classes(["acknowledgements-section"])])([h2_([text5("Website Dependencies")]), p_([text5("This diagram shows how the demo website depends on our libraries. The SimulationManager represents temporary FFI code that will eventually move into psd3-simulation.")]), div2([id3("d3-website-sankey"), style("background: #fafafa; border-radius: 8px; padding: 10px;")])([])]), section([classes(["acknowledgements-section"])])([h2_([text5("Observable Examples (ISC License)")]), p_([text5("Several chart examples in PS<$>D3 are based on visualizations from "), a([href4("https://observablehq.com/")])([text5("Observable")]), text5(", licensed under the ISC License. These include:")]), ul_([li_([a([href4("https://observablehq.com/@d3/grouped-bar-chart/2")])([text5("Grouped Bar Chart")]), text5(" (Copyright 2018\u20132020 Observable, Inc.)")]), li_([a([href4("https://observablehq.com/@d3/multi-line-chart/2")])([text5("Multi-Line Chart")]), text5(" (Copyright 2018\u20132023 Observable, Inc.)")]), li_([a([href4("https://observablehq.com/@d3/radial-stacked-bar-chart/2")])([text5("Radial Stacked Bar Chart")]), text5(" (Copyright 2019\u20132023 Observable, Inc., created by Mike Bostock)")])]), p_([text5("These examples have been reimplemented in PureScript to demonstrate the PS<$>D3 library's capabilities while faithfully reproducing the original visualizations' dimensions, scales, and styling.")])]), section([classes(["acknowledgements-section"])])([h2_([text5("Data Visualization Pioneers")]), p_([a([href4("https://www.edwardtufte.com/")])([text5("Edward Tufte")]), text5("'s work on information design and visual communication established many of the principles we follow today. His books remain essential reading for anyone interested in effective data presentation.")]), p_([a([href4("https://www.gapminder.org/about/hans-rosling/")])([text5("Hans Rosling")]), text5("'s passionate advocacy for data literacy and his innovative animated visualizations (particularly the Gapminder World visualization) showed how data can tell compelling stories. The Wealth & Health example in this project is inspired by his work.")])]), section([classes(["acknowledgements-section"])])([h2_([text5("PureScript and Functional Programming")]), p_([a([href4("http://functorial.com/")])([text5("Phil Freeman")]), text5(", for his presentation and example of finally tagless encodings in PureScript which provided the spark for this library's architecture.")]), p_([text5("Ian Ross, for his solution to the polymorphic attribute architecture with typeclasses, so neat.")]), p_([text5("The PureScript Core Team members, past, present and future and the wider PureScript community for building this incredibly nice language and ecosystem. I'd particularly like to single out Mike Solomon, Jordan Martinez, Thomas Honeyman, Fabrizio Ferrai who listened to me drone on about this on conference calls.")])]), section([classes(["acknowledgements-section"])])([h2_([text5("AI Collaboration")]), p_([text5("The 2024-2025 iteration of this project was developed in collaboration with Claude (Anthropic). This represents a significant experiment in human-AI pair programming on a complex, long-running project.")]), p_([text5("The intellectual foundations of PS<$>D3 were developed over several years: the initial PureScript D3 bindings (2019), the finally tagless encoding inspired by Phil Freeman's work, and the Attr typeclass pattern adapted from Ian Ross's Haskell code. Claude contributed substantially to the 2024-2025 implementation: the Tree API design, phantom type refinements, extensive refactoring, documentation, and tens of thousands of lines of code.")]), p_([text5("We believe transparency about AI involvement is important. This collaboration demonstrates both the potential and the nature of human-AI development: the human brings domain expertise, architectural vision, and quality judgment; the AI brings rapid implementation, pattern recognition across large codebases, and tireless iteration. Neither could have produced this result alone.")])]), section([classes(["acknowledgements-section"])])([h2_([text5("About This Project")]), p_([text5("PS<$>D3 is an experimental exploration of what data visualization APIs might look like in a strongly-typed functional programming language. It aims to preserve D3's flexibility while adding type safety and composability.")]), p_([text5("This project is open source and available on GitHub. Contributions, feedback, and suggestions are always welcome.")])])]), render47]);
  };
  var handleAction42 = function(dictMonadAff) {
    var liftAff2 = liftAff(monadAffHalogenM(dictMonadAff));
    var liftEffect54 = liftEffect(monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    return function(v2) {
      return discard65(liftAff2(delay(100)))(function() {
        return bind90(liftAff2(get5(string)("/data/d3-library-deps.csv")))(function(libraryResult) {
          return discard65((function() {
            if (libraryResult instanceof Left) {
              return pure96(unit);
            }
            ;
            if (libraryResult instanceof Right) {
              return liftEffect54(drawSankey(libraryResult.value0.body)("#d3-library-sankey")(740)(500));
            }
            ;
            throw new Error("Failed pattern match at PSD3.Acknowledgements (line 180, column 5 - line 183, column 79): " + [libraryResult.constructor.name]);
          })())(function() {
            return bind90(liftAff2(get5(string)("/data/d3-website-deps.csv")))(function(websiteResult) {
              if (websiteResult instanceof Left) {
                return pure96(unit);
              }
              ;
              if (websiteResult instanceof Right) {
                return liftEffect54(drawSankey(websiteResult.value0.body)("#d3-website-sankey")(700)(220));
              }
              ;
              throw new Error("Failed pattern match at PSD3.Acknowledgements (line 186, column 5 - line 189, column 79): " + [websiteResult.constructor.name]);
            });
          });
        });
      });
    };
  };
  var component43 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render48,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction42(dictMonadAff),
        initialize: new Just(Initialize43.value)
      })
    });
  };

  // output/PSD3.Home/index.js
  var pure97 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize44 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var handleAction43 = function(v2) {
    return pure97(unit);
  };
  var getBookmarkImage = function(v2) {
    if (v2 === "Getting Started") {
      return "assets/bookmark-images/getting-started.jpeg";
    }
    ;
    if (v2 === "How-to Guides") {
      return "assets/bookmark-images/howto.jpeg";
    }
    ;
    if (v2 === "API Reference") {
      return "assets/bookmark-images/reference.jpeg";
    }
    ;
    if (v2 === "Understanding") {
      return "assets/bookmark-images/understanding.jpeg";
    }
    ;
    return "assets/bookmark-images/howto.jpeg";
  };
  var renderDocBox = function(title4) {
    return function(description) {
      return function(path18) {
        return a([href4("#" + path18), classes(["home-doc-box"])])([div2([classes(["home-doc-box__image-container"])])([img([src9(getBookmarkImage(title4)), alt5(""), classes(["home-doc-box__image"])])]), div2([classes(["home-doc-box__content"])])([h3([classes(["home-doc-box-title"])])([text5(title4)]), p([classes(["home-doc-box-description"])])([text5(description)])])]);
      };
    };
  };
  var render49 = function(v2) {
    return div2([classes(["home-page"])])([render4({
      logoSize: Large.value,
      quadrant: NoQuadrant.value,
      prevNext: Nothing.value,
      pageTitle: Nothing.value
    }), section([id3("hero"), classes(["home-hero"])])([div2([classes(["home-hero-content"])])([h1([classes(["home-hero-title"])])([text5("Type-safe, composable, maintainable, interactive data visualisation with PureScript and D3.js")]), div2([classes(["home-hero-image"])])([img([src9("assets/example-thumbnails/force-playground.png"), alt5("Force Playground visualization"), classes(["home-hero-img"])]), p([classes(["home-hero-caption"])])([text5("Try the "), a([href4("#" + routeToPath(ForcePlayground.value)), classes(["home-hero-link"])])([text5("Force Playground")])])])])]), section([id3("docs"), classes(["home-docs"])])([h2([classes(["home-section-title"])])([text5("Documentation")]), div2([classes(["home-docs-grid"])])([renderDocBox("Getting Started")("Installation, setup, and your first visualization")(routeToPath(GettingStarted.value)), renderDocBox("How-to Guides")("Step-by-step instructions for specific visualizations")(routeToPath(HowtoIndex.value)), renderDocBox("API Reference")("Pursuit-style documentation of the library with type signatures")(routeToPath(Reference.value)), renderDocBox("Understanding")("Conceptual overview of the project")(routeToPath(Understanding.value))])]), render47]);
  };
  var component44 = /* @__PURE__ */ (function() {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render49,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction43,
        initialize: new Just(Initialize44.value)
      })
    });
  })();

  // output/PSD3.HowTo.HowtoIndex/index.js
  var pure98 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize45 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var renderHowtoCard = function(route) {
    return function(title4) {
      return function(description) {
        return a([classes(["howto-card"]), href4("#" + routeToPath(route))])([h3([classes(["howto-card__title"])])([text5(title4)]), p([classes(["howto-card__description"])])([text5(description)])]);
      };
    };
  };
  var render50 = function(v2) {
    return div2([classes(["docs-page", "howto-wiki"])])([render4({
      logoSize: Large.value,
      quadrant: QuadHowTo.value,
      prevNext: Nothing.value,
      pageTitle: Nothing.value
    }), section([classes(["docs-hero"])])([div2([classes(["docs-hero-content"])])([h1([classes(["docs-hero-title"])])([text5("How-to Guides")]), p([classes(["docs-hero-description"])])([text5("Practical guides for accomplishing specific tasks with PureScript D3. Each topic includes bullet points of what will be covered.")])])]), section([classes(["docs-section"])])([h2([classes(["docs-section-title"])])([text5("Core Techniques")]), div2([classes(["howto-card-grid"])])([renderHowtoCard(HowtoTransitions.value)("Creating Animated Transitions")("Smooth, animated transitions between visualization states."), renderHowtoCard(HowtoEvents.value)("Responding to User Events")("Click, hover, drag, and zoom interactions."), renderHowtoCard(HowtoTooltips.value)("Adding Tooltips")("Informative tooltips that appear on hover.")])]), section([classes(["docs-section"])])([h2([classes(["docs-section-title"])])([text5("Data & Scales")]), div2([classes(["howto-card-grid"])])([renderHowtoCard(HowtoLoadingData.value)("Loading External Data")("Fetch and parse JSON/CSV with Affjax."), renderHowtoCard(HowtoAxesScales.value)("Creating Axes and Scales")("Color interpolation and D3 scale/axis FFI.")])]), section([classes(["docs-section"])])([h2([classes(["docs-section-title"])])([text5("Layouts")]), div2([classes(["howto-card-grid"])])([renderHowtoCard(HowtoForceGraphs.value)("Building Force-Directed Graphs")("SimulationM for interactive network visualizations."), renderHowtoCard(HowtoHierarchical.value)("Working with Hierarchical Data")("Tree, cluster, and treemap layouts."), renderHowtoCard(HowtoTreeAPI.value)("Using the TreeAPI")("Declarative trees with multiple interpreters.")])]), section([classes(["docs-section"])])([h2([classes(["docs-section-title"])])([text5("Development")]), div2([classes(["howto-card-grid"])])([renderHowtoCard(HowtoDebugging.value)("Debugging Visualizations")("Console logging, DevTools, Mermaid diagrams."), renderHowtoCard(HowtoPerformance.value)("Performance Optimization")("DOM optimization, tick efficiency, CSS transitions.")])])]);
  };
  var handleAction44 = function(v2) {
    return pure98(unit);
  };
  var component45 = /* @__PURE__ */ (function() {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render50,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction44,
        initialize: new Just(Initialize45.value)
      })
    });
  })();

  // output/PSD3.Reference.Reference/index.js
  var pure99 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize46 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var renderApiCard = function(title4) {
    return function(description) {
      return a([classes(["howto-card"]), href4("api/index.html"), target6("_blank")])([h3([classes(["howto-card__title"])])([text5(title4)]), p([classes(["howto-card__description"])])([text5(description)])]);
    };
  };
  var render51 = function(v2) {
    return div2([classes(["docs-page", "reference-index"])])([render4({
      logoSize: Large.value,
      quadrant: QuadReference.value,
      prevNext: Nothing.value,
      pageTitle: Nothing.value
    }), section([classes(["docs-hero"])])([div2([classes(["docs-hero-content"])])([h1([classes(["docs-hero-title"])])([text5("API Reference")]), p([classes(["docs-hero-description"])])([text5("Lorem ipsum dolor sit amet, consectetur adipiscing elit. Comprehensive documentation for all PSD3 modules, types, and functions.")])])]), section([classes(["docs-section"])])([h2([classes(["docs-section-title"])])([text5("Browse Documentation")]), div2([classes(["howto-card-grid"])])([renderApiCard("Core Selection API")("Lorem ipsum dolor sit amet, consectetur adipiscing elit. SelectionM monad and phantom type system."), renderApiCard("Simulation & Forces")("Sed do eiusmod tempor incididunt ut labore. Force-directed layouts and physics configuration."), renderApiCard("TreeAPI & Declarative")("Ut enim ad minim veniam, quis nostrud exercitation. Declarative tree structures and interpreters."), renderApiCard("Data Utilities")("Duis aute irure dolor in reprehenderit in voluptate. Hierarchical data, scales, and transformations.")])])]);
  };
  var handleAction45 = function(v2) {
    return pure99(unit);
  };
  var component46 = /* @__PURE__ */ (function() {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render51,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction45,
        initialize: new Just(Initialize46.value)
      })
    });
  })();

  // output/PSD3.Tutorial.GettingStarted/index.js
  var pure100 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize47 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var render52 = function(v2) {
    return div2([classes(["docs-page"])])([render4({
      logoSize: Large.value,
      quadrant: QuadGettingStarted.value,
      prevNext: Nothing.value,
      pageTitle: Nothing.value
    }), section([classes(["docs-hero"])])([div2([classes(["docs-hero-content"])])([h1([classes(["docs-hero-title"])])([text5("Getting Started")]), p([classes(["docs-hero-description"])])([text5("Build type-safe, declarative D3 visualizations in PureScript. This guide will have you rendering your first chart in minutes.")])])]), section([classes(["tutorial-section"]), id3("quickstart")])([h2([classes(["tutorial-section-title"])])([text5("Quick Start")]), h3([id3("prerequisites")])([text5("Prerequisites")]), p_([text5("You'll need:")]), ul_([li_([text5("Node.js 18+")]), li_([text5("PureScript compiler and Spago")])]), pre_([code_([text5("npm install -g purescript spago")])]), h3([id3("installation")])([text5("Installation")]), p_([text5("Add the PSD3 packages to your project:")]), pre_([code_([text5("spago install psd3-selection psd3-layout")])]), p_([text5("For force-directed graphs and simulations (which use the lower-level PSD3 API), also add:")]), pre_([code_([text5("spago install psd3-simulation")])])]), section([classes(["tutorial-section"]), id3("first-viz")])([h2([classes(["tutorial-section-title"])])([text5("Your First Visualization")]), p_([text5("PSD3 uses a declarative Tree API. You describe what you want, and the library renders it to D3. Here's a complete example:")]), pre_([code_([text5('module Main where\n\nimport Prelude\nimport Effect (Effect)\nimport PSD3.Tree as T\nimport PSD3.Tree (Tree)\nimport PSD3.Attribute (class_, cx, cy, r, fill)\nimport PSD3.Interpreter.D3 (render)\n\n-- Your data\ntype Point = { x :: Number, y :: Number, color :: String }\n\nmyData :: Array Point\nmyData =\n  [ { x: 100.0, y: 100.0, color: "steelblue" }\n  , { x: 200.0, y: 150.0, color: "coral" }\n  , { x: 300.0, y: 100.0, color: "seagreen" }\n  ]\n\n-- The visualization\nchart :: Tree Point\nchart =\n  T.named Svg "svg"\n    [ T.width 400.0, T.height 200.0 ]\n    `T.withChildren`\n      [ T.joined "circles" Circle myData identity $ \\\\point ->\n          [ cx point.x\n          , cy point.y\n          , r 20.0\n          , fill point.color\n          ]\n      ]\n\n-- Render to the DOM\nmain :: Effect Unit\nmain = render "#chart" chart')])]), h3_([text5("What's happening here?")]), ul_([li_([code_([text5('T.named Svg "svg"')]), text5(" - Creates a named SVG element (the name helps with transitions)")]), li_([code_([text5('T.joined "circles" Circle myData identity')]), text5(" - Data joins your array to Circle elements. Each point becomes a circle.")]), li_([text5("The lambda "), code_([text5("\\point -> [...]")]), text5(" receives each data item with full type safety - no coercion needed")]), li_([code_([text5('render "#chart" chart')]), text5(" - Renders the tree to a DOM element with selector "), code_([text5("#chart")])])])]), section([classes(["tutorial-section"]), id3("html-setup")])([h2([classes(["tutorial-section-title"])])([text5("HTML Setup")]), p_([text5("Your HTML needs D3.js and a container element:")]), pre_([code_([text5('<!DOCTYPE html>\n<html>\n<head>\n  <script src="https://d3js.org/d3.v7.min.js"><\/script>\n</head>\n<body>\n  <div id="chart"></div>\n  <script src="bundle.js"><\/script>\n</body>\n</html>')])]), p_([text5("Bundle your PureScript:")]), pre_([code_([text5("spago bundle --module Main --outfile bundle.js")])])]), section([classes(["tutorial-section"]), id3("concepts")])([h2([classes(["tutorial-section-title"])])([text5("Key Concepts")]), h3_([text5("The Tree API")]), p_([text5("PSD3's Tree API is declarative - you describe the structure of your visualization as a tree of elements. The key building blocks:")]), ul_([li_([code_([text5("T.elem")]), text5(" - A single element with static attributes")]), li_([code_([text5("T.joined")]), text5(" - Data-driven elements (D3's data join)")]), li_([code_([text5("T.named")]), text5(" - Named container for identity-preserving updates")]), li_([code_([text5("T.withChild / T.withChildren")]), text5(" - Nest elements hierarchically")])]), h3_([text5("Type-Safe Attributes")]), p_([text5("Attributes are functions from your data to values. The compiler ensures you can't use attributes on wrong element types:")]), pre_([code_([text5(`-- This works: cx is valid for Circle
T.joined "dots" Circle data identity $ \\\\d ->
  [ cx d.x, cy d.y, r 5.0 ]

-- This won't compile: cx isn't valid for Rect
T.joined "bars" Rect data identity $ \\\\d ->
  [ cx d.x ]  -- Compile error!`)])]), h3_([text5("Interpreters")]), p_([text5("The same Tree can be rendered different ways:")]), ul_([li_([code_([text5("D3v2.render")]), text5(" - Renders to the DOM via D3")]), li_([code_([text5("MermaidTree.interpret")]), text5(" - Generates a Mermaid diagram of the tree structure")]), li_([code_([text5("English.interpret")]), text5(" - Produces English description (debugging)")])]), h3_([text5("Two APIs")]), p_([text5("PSD3 offers two levels of abstraction:")]), ul_([li_([strong_([text5("Tree API")]), text5(" - Declarative, ideal for static charts and layouts (bar charts, trees, Sankey diagrams). This is what we've shown above.")]), li_([strong_([text5("PSD3 API")]), text5(" - Lower-level but equally type-safe. Required for force simulations and highly interactive visualizations. See the "), a([href4("#/showcase")])([text5("Code Explorer")]), text5(" for an example.")])]), p_([text5("Both APIs share the same type-safe foundation. The Tree API builds on top of the PSD3 API, so you can mix them when needed.")])]), section([classes(["tutorial-section"]), id3("next")])([h2([classes(["tutorial-section-title"])])([text5("Next Steps")]), ul_([li_([a([href4("#/tour")])([text5("Take the Tour")]), text5(" - See what's possible with PSD3")]), li_([a([href4("#/showcase")])([text5("Explore the Showcase")]), text5(" - Interactive examples like the Code Explorer and SPLOM")]), li_([a([href4("#/examples")])([text5("Browse Examples")]), text5(" - All examples organized by category")]), li_([a([href4("#/understanding")])([text5("Understanding PSD3")]), text5(" - Deep dive into the architecture")])])]), render47]);
  };
  var handleAction46 = function(v2) {
    return pure100(unit);
  };
  var component47 = /* @__PURE__ */ (function() {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render52,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction46,
        initialize: new Just(Initialize47.value)
      })
    });
  })();

  // output/PSD3.Understanding/index.js
  var pure101 = /* @__PURE__ */ pure(applicativeHalogenM);
  var Initialize48 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var renderCard3 = function(route) {
    return function(title4) {
      return function(description) {
        return a([classes(["howto-card"]), href4("#" + routeToPath(route))])([h3([classes(["howto-card__title"])])([text5(title4)]), p([classes(["howto-card__description"])])([text5(description)])]);
      };
    };
  };
  var render53 = function(v2) {
    return div2([classes(["docs-page", "understanding-index"])])([render4({
      logoSize: Large.value,
      quadrant: QuadUnderstanding.value,
      prevNext: Nothing.value,
      pageTitle: Nothing.value
    }), section([classes(["docs-hero"])])([div2([classes(["docs-hero-content"])])([h1([classes(["docs-hero-title"])])([text5("Understanding")]), p([classes(["docs-hero-description"])])([text5("Deep dives into the core concepts and patterns that make PSD3 a type-safe, composable framework for D3 visualizations.")])])]), section([classes(["docs-section"])])([h2([classes(["docs-section-title"])])([text5("Core Concepts")]), div2([classes(["howto-card-grid"])])([renderCard3(UnderstandingGrammar.value)("The Grammar of D3")("Four essential primitives: select, append, join, attr. Everything else builds from these."), renderCard3(UnderstandingAttributes.value)("Type-Safe Attributes")("Static values, datum functions, contravariant pattern. Compile-time type safety."), renderCard3(UnderstandingSelections.value)("Selection Phantom Types")("Five states: SEmpty, SPending, SBoundOwns, SBoundInherits, SExiting. Indexed Monad pattern.")])]), section([classes(["docs-section"])])([h2([classes(["docs-section-title"])])([text5("Architecture")]), div2([classes(["howto-card-grid"])])([renderCard3(UnderstandingTreeAPI.value)("TreeAPI")("Declarative tree structures. Layer cake architecture with TreeAPI and Simulation API on SelectionM."), renderCard3(UnderstandingScenes.value)("Scene Structures & Transitions")("Declarative state management for complex interactive visualizations with transition matrices.")])])]);
  };
  var handleAction47 = function(v2) {
    return pure101(unit);
  };
  var component48 = /* @__PURE__ */ (function() {
    return mkComponent({
      initialState: function(v2) {
        return unit;
      },
      render: render53,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction47,
        initialize: new Just(Initialize48.value)
      })
    });
  })();

  // output/Data.Char/index.js
  var toCharCode2 = /* @__PURE__ */ fromEnum(boundedEnumChar);
  var fromCharCode3 = /* @__PURE__ */ toEnum(boundedEnumChar);

  // output/PSD3.Wizard.Datasets/index.js
  var Beginner = /* @__PURE__ */ (function() {
    function Beginner2() {
    }
    ;
    Beginner2.value = new Beginner2();
    return Beginner2;
  })();
  var Intermediate = /* @__PURE__ */ (function() {
    function Intermediate2() {
    }
    ;
    Intermediate2.value = new Intermediate2();
    return Intermediate2;
  })();
  var Advanced = /* @__PURE__ */ (function() {
    function Advanced2() {
    }
    ;
    Advanced2.value = new Advanced2();
    return Advanced2;
  })();
  var sineWaveDataset = /* @__PURE__ */ (function() {
    return {
      id: "sinewave",
      name: "Sine Wave",
      description: "Smooth wave pattern - great for line charts and transitions",
      difficulty: Beginner.value,
      fields: [{
        name: "x",
        fieldType: "Number"
      }, {
        name: "y",
        fieldType: "Number"
      }],
      dataPreview: ["{ x: 0.0, y: 100.0 }", "{ x: 5.0, y: 125.0 }", "{ x: 10.0, y: 145.0 }", "..."],
      suggestedViz: "Line chart or area chart",
      educationalNote: "Demonstrates smooth continuous data - perfect for learning line generators and paths."
    };
  })();
  var showDifficulty = {
    show: function(v2) {
      if (v2 instanceof Beginner) {
        return "Beginner";
      }
      ;
      if (v2 instanceof Intermediate) {
        return "Intermediate";
      }
      ;
      if (v2 instanceof Advanced) {
        return "Advanced";
      }
      ;
      throw new Error("Failed pattern match at PSD3.Wizard.Datasets (line 32, column 1 - line 35, column 29): " + [v2.constructor.name]);
    }
  };
  var scatterDataset = /* @__PURE__ */ (function() {
    return {
      id: "scatter",
      name: "Scatter Plot",
      description: "Random points in 2D space - perfect for your first visualization",
      difficulty: Beginner.value,
      fields: [{
        name: "x",
        fieldType: "Number"
      }, {
        name: "y",
        fieldType: "Number"
      }],
      dataPreview: ["{ x: 10.0, y: 20.0 }", "{ x: 25.0, y: 45.0 }", "{ x: 40.0, y: 30.0 }", "..."],
      suggestedViz: "Scatter plot with circles",
      educationalNote: "Start here! Simple 2D data is the easiest way to learn PSD3's data binding patterns."
    };
  })();
  var multiLineDataset = /* @__PURE__ */ (function() {
    return {
      id: "multiline",
      name: "Unemployment Rates",
      description: "Unemployment rates for 4 cities over time - multi-series data",
      difficulty: Intermediate.value,
      fields: [{
        name: "series",
        fieldType: "String"
      }, {
        name: "date",
        fieldType: "String"
      }, {
        name: "value",
        fieldType: "Number"
      }],
      dataPreview: ['{ series: "San Francisco", date: "2000-01", value: 3.5 }', '{ series: "San Francisco", date: "2002-01", value: 5.2 }', '{ series: "New York", date: "2000-01", value: 5.3 }', "..."],
      suggestedViz: "Multi-line chart with legend",
      educationalNote: "Time-series data with multiple series - demonstrates data grouping by series and line generators."
    };
  })();
  var groupedBarDataset = /* @__PURE__ */ (function() {
    return {
      id: "groupedbar",
      name: "State Demographics",
      description: "Population by state and age group - for grouped/stacked visualizations",
      difficulty: Intermediate.value,
      fields: [{
        name: "state",
        fieldType: "String"
      }, {
        name: "age",
        fieldType: "String"
      }, {
        name: "population",
        fieldType: "Number"
      }],
      dataPreview: ['{ state: "CA", age: "<10", population: 5038433.0 }', '{ state: "CA", age: "10-19", population: 5055706.0 }', '{ state: "TX", age: "<10", population: 4131018.0 }', "..."],
      suggestedViz: "Grouped bar chart or stacked bar chart",
      educationalNote: "Multi-dimensional data with categorical and numerical fields - great for learning data nesting and grouping patterns."
    };
  })();
  var eqDifficulty = {
    eq: function(x32) {
      return function(y32) {
        if (x32 instanceof Beginner && y32 instanceof Beginner) {
          return true;
        }
        ;
        if (x32 instanceof Intermediate && y32 instanceof Intermediate) {
          return true;
        }
        ;
        if (x32 instanceof Advanced && y32 instanceof Advanced) {
          return true;
        }
        ;
        return false;
      };
    }
  };
  var barChartDataset = /* @__PURE__ */ (function() {
    return {
      id: "barchart",
      name: "Monthly Sales",
      description: "12 months of sales data - classic bar chart material",
      difficulty: Beginner.value,
      fields: [{
        name: "x",
        fieldType: "Number"
      }, {
        name: "y",
        fieldType: "Number"
      }],
      dataPreview: ["{ x: 0.0, y: 30.0 }", "{ x: 1.0, y: 45.0 }", "{ x: 2.0, y: 60.0 }", "..."],
      suggestedViz: "Bar chart or column chart",
      educationalNote: "Perfect for learning data joins - each bar represents one data point."
    };
  })();
  var anscombeDataset = /* @__PURE__ */ (function() {
    return {
      id: "anscombe",
      name: "Anscombe's Quartet",
      description: "Four datasets with identical statistics but very different patterns",
      difficulty: Beginner.value,
      fields: [{
        name: "x",
        fieldType: "Number"
      }, {
        name: "y",
        fieldType: "Number"
      }],
      dataPreview: ["-- Dataset 1:", "{ x: 10.0, y: 8.04 }", "{ x: 8.0, y: 6.95 }", "..."],
      suggestedViz: "Four small multiples scatter plots",
      educationalNote: "Famous dataset showing why visualization matters - all four have identical mean, variance, and correlation, but look completely different when plotted!"
    };
  })();
  var allDatasets2 = [scatterDataset, sineWaveDataset, barChartDataset, anscombeDataset, groupedBarDataset, multiLineDataset];

  // output/PSD3.Wizard.FileDownload/foreign.js
  var createZip = function() {
    return new JSZip();
  };
  var addFile = function(zip2) {
    return function(filename) {
      return function(content3) {
        return function() {
          zip2.file(filename, content3);
        };
      };
    };
  };
  var downloadZipImpl = function(zip2) {
    return function(zipFilename) {
      return function(onError, onSuccess) {
        zip2.generateAsync({ type: "blob" }).then(function(blob) {
          const url2 = URL.createObjectURL(blob);
          const link5 = document.createElement("a");
          link5.href = url2;
          link5.download = zipFilename;
          document.body.appendChild(link5);
          link5.click();
          document.body.removeChild(link5);
          setTimeout(function() {
            URL.revokeObjectURL(url2);
          }, 100);
          onSuccess();
        }).catch(function(error4) {
          onError(error4);
        });
        return function(cancelError, onCancelerError, onCancelerSuccess) {
          onCancelerSuccess();
        };
      };
    };
  };
  var copyToClipboard = function(text47) {
    return function() {
      try {
        if (navigator.clipboard && window.isSecureContext) {
          navigator.clipboard.writeText(text47);
          return true;
        } else {
          const textArea = document.createElement("textarea");
          textArea.value = text47;
          textArea.style.position = "fixed";
          textArea.style.left = "-999999px";
          textArea.style.top = "-999999px";
          document.body.appendChild(textArea);
          textArea.focus();
          textArea.select();
          const success = document.execCommand("copy");
          document.body.removeChild(textArea);
          return success;
        }
      } catch (error4) {
        console.error("Failed to copy to clipboard:", error4);
        return false;
      }
    };
  };

  // output/PSD3.Wizard.FileDownload/index.js
  var append39 = /* @__PURE__ */ append(semigroupArray);
  var eq18 = /* @__PURE__ */ eq(/* @__PURE__ */ eqArray(eqString));
  var append124 = /* @__PURE__ */ append(semigroupString);
  var map104 = /* @__PURE__ */ map(functorArray);
  var bind91 = /* @__PURE__ */ bind(bindAff);
  var liftEffect51 = /* @__PURE__ */ liftEffect(monadEffectAff);
  var discard66 = /* @__PURE__ */ discard(discardUnit)(bindAff);
  var for_10 = /* @__PURE__ */ for_(applicativeEffect)(foldableArray);
  var formatFilesForClipboard = function(files2) {
    var replicateArray = function(n) {
      return function(x32) {
        var $14 = n <= 0;
        if ($14) {
          return [];
        }
        ;
        return append39([x32])(replicateArray(n - 1 | 0)(x32));
      };
    };
    var intercalateArray = function(sep) {
      return function(arr) {
        return maybe("")(function(v2) {
          var $16 = eq18(v2.tail)([]);
          if ($16) {
            return v2.head;
          }
          ;
          return v2.head + (sep + intercalateArray(sep)(v2.tail));
        })(uncons4(arr));
      };
    };
    var repeatString = function(str23) {
      return function(n) {
        return foldl4(append124)("")(replicateArray(n)(str23));
      };
    };
    var separator = "\n" + (repeatString("=")(80) + "\n");
    var formatFile = function(file) {
      return "File: " + (file.filename + ("\n" + (repeatString("-")(80) + ("\n" + file.content))));
    };
    var fileTexts = map104(formatFile)(files2);
    return intercalateArray(separator)(fileTexts);
  };
  var downloadAsZip = function(projectName) {
    return function(files2) {
      return bind91(liftEffect51(createZip))(function(zip2) {
        return discard66(liftEffect51(for_10(files2)(function(file) {
          return addFile(zip2)(file.filename)(file.content);
        })))(function() {
          return fromEffectFnAff(downloadZipImpl(zip2)(projectName + ".zip"));
        });
      });
    };
  };
  var copyFilesToClipboard = function(files2) {
    var formatted = formatFilesForClipboard(files2);
    return copyToClipboard(formatted);
  };

  // output/PSD3.Wizard.Templates/index.js
  var map105 = /* @__PURE__ */ map(functorArray);
  var map122 = /* @__PURE__ */ map(functorMaybe);
  var intercalate6 = /* @__PURE__ */ intercalate2(monoidString);
  var generateRecordType = function(fields) {
    var fieldLines = map105(function(f) {
      return f.name + (" :: " + f.fieldType);
    })(fields);
    return joinWith("\n  , ")(fieldLines);
  };
  var generateUnsafe = function(vizName) {
    return function(dataTypeName) {
      return function(fields) {
        var recordType = generateRecordType(fields);
        return "module " + (vizName + (".Unsafe where\n\nimport PSD3.Internal.Types (Datum_, Index_)\nimport Unsafe.Coerce (unsafeCoerce)\n\n-- | Data type for this visualization\ntype " + (dataTypeName + (" =\n  { " + (recordType + ("\n  }\n\n-- | Coerce Datum_ to " + (dataTypeName + ("\n-- This is safe because D3's data join ensures Datum_ contains\n-- the data we originally passed to simpleJoin/updateJoin\ncoerceTo" + (dataTypeName + (" :: Datum_ -> " + (dataTypeName + ("\ncoerceTo" + (dataTypeName + " = unsafeCoerce\n\n-- | Coerce Index_ to Int (always provided by D3)\ncoerceIndex :: Index_ -> Int\ncoerceIndex = unsafeCoerce\n")))))))))))));
      };
    };
  };
  var generateModel = function(vizName) {
    return function(dataTypeName) {
      return function(fields) {
        return function(exampleData) {
          var recordType = generateRecordType(fields);
          return "module " + (vizName + (".Model where\n\n-- | Data type for this visualization\n-- Re-exported from Unsafe for use in type signatures\ntype " + (dataTypeName + (" =\n  { " + (recordType + ("\n  }\n\n-- | Example data for testing\nexampleData :: Array " + (dataTypeName + ("\nexampleData =\n  " + (exampleData + "\n")))))))));
        };
      };
    };
  };
  var generateMain = function(vizName) {
    return function(v2) {
      return "module Main where\n\nimport Prelude\nimport Effect (Effect)\nimport " + (vizName + (".Draw (run)\nimport " + (vizName + ".Model (exampleData)\n\nmain :: Effect Unit\nmain = run exampleData\n")));
    };
  };
  var generateHTML = function(vizName) {
    return '<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>' + (vizName + (' - PSD3 Visualization</title>\n  <style>\n    body {\n      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;\n      margin: 0;\n      padding: 20px;\n      background-color: #f5f5f5;\n    }\n    .container {\n      max-width: 1200px;\n      margin: 0 auto;\n      background-color: white;\n      padding: 30px;\n      border-radius: 8px;\n      box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n    }\n    h1 {\n      color: #333;\n      margin-top: 0;\n    }\n    #chart {\n      margin: 20px 0;\n      border: 1px solid #e0e0e0;\n      border-radius: 4px;\n      background-color: #fafafa;\n    }\n    svg {\n      display: block;\n    }\n  </style>\n</head>\n<body>\n  <div class="container">\n    <h1>' + (vizName + `</h1>
    <div id="chart"></div>
  </div>

  <!-- D3.js from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"><\/script>

  <!-- Your bundled PureScript code -->
  <!-- After building with 'spago bundle', include your bundle here: -->
  <!-- <script src="./bundle.js"><\/script> -->
</body>
</html>
`)));
  };
  var generateDatumType = function(fields) {
    var typeLines = map105(function(f) {
      return f.name + (" :: Datum_ -> " + f.fieldType);
    })(fields);
    return joinWith("\n  , ")(typeLines);
  };
  var generateREADME = function(vizName) {
    return function(dataTypeName) {
      return function(fields) {
        var firstField = fromMaybe("x")(map122(function(f) {
          return f.name;
        })(head2(fields)));
        var fieldList = intercalate6("\n")(map105(function(f) {
          return "- " + (f.name + (": " + f.fieldType));
        })(fields));
        var exampleFields = intercalate6(", ")(map105(function(f) {
          return f.name + ": 0.0";
        })(fields));
        var datumType = generateDatumType(fields);
        return "# " + (vizName + ("\n\nPSD3 visualization scaffold generated by the web wizard.\n\n## Files Generated\n\n- **Unsafe.purs** - Type coercion functions (isolates all unsafeCoerce calls)\n- **Model.purs** - Data type definitions\n- **Draw.purs** - Main visualization code\n- **index.html** - HTML page with D3.js loaded from CDN\n\n## Data Type\n\n```purescript\ntype " + (dataTypeName + (" =\n  { " + (fieldList + ("\n  }\n```\n\n## Quick Start\n\n1. **Add your data** in `Model.purs`:\n   ```purescript\n   exampleData :: Array " + (dataTypeName + ("\n   exampleData =\n     [ { " + (exampleFields + (" }\n     -- Add more data points\n     ]\n   ```\n\n2. **Customize the visualization** in `Draw.purs`\n   - Modify the `draw` function to create your desired chart\n   - Use the `datum_` accessor to work with your data safely\n   - See the commented examples for using data fields in attributes\n\n3. **Build and run**:\n   ```bash\n   # Compile the PureScript\n   spago build\n\n   # Bundle for the browser (if you created Main.purs)\n   spago bundle --module Main --outfile bundle.js\n\n   # Open index.html in your browser\n   open index.html\n   ```\n\n## The datum_ Pattern\n\nThe `datum_` accessor record provides type-safe access to your data:\n\n```purescript\ndatum_ ::\n  { " + (datumType + ("\n  , index :: Index_ -> Int\n  }\n```\n\nUse it in attributes like this:\n```purescript\nA.cx (\\\\(d :: Datum_) _ -> datum_." + (firstField + " d)\n```\n\nThe type annotations `(d :: Datum_)` and `(i :: Index_)` help PureScript's type checker\nfind the correct ToAttr instance.\n\n## Learn More\n\n- [PSD3 Documentation](https://github.com/afcondon/PureScript-Tagless-D3)\n- [Wizard Guide](../../docs/wizard-guide.md)\n")))))))))))));
      };
    };
  };
  var generateAccessors = function(fields) {
    return function(coerceFnName) {
      var accessorLines = map105(function(f) {
        return f.name + (": _." + (f.name + (" <<< " + coerceFnName)));
      })(fields);
      return joinWith("\n  , ")(accessorLines);
    };
  };
  var generateDraw = function(vizName) {
    return function(dataTypeName) {
      return function(fields) {
        return function(coerceFnName) {
          var firstField = fromMaybe("x")(map122(function(f) {
            return f.name;
          })(head2(fields)));
          var datumType = generateDatumType(fields);
          var accessors = generateAccessors(fields)(coerceFnName);
          return "module " + (vizName + (".Draw where\n\nimport Prelude\n\nimport PSD3\nimport PSD3.Attributes as A\nimport PSD3.Internal.FFI (keyIsID_)\nimport " + (vizName + (".Unsafe (" + (coerceFnName + (", coerceIndex)\nimport " + (vizName + (".Model (" + (dataTypeName + (")\nimport Data.Int (toNumber)\nimport Effect (Effect)\n\n-- | Accessor record for working with bound data\ndatum_ ::\n  { " + (datumType + ("\n  , index :: Index_ -> Int\n  }\ndatum_ =\n  { " + (accessors + ("\n  , index: coerceIndex\n  }\n\n-- | Main drawing function\ndraw :: forall m. SelectionM D3Selection_ m => Array " + (dataTypeName + (' -> Selector D3Selection_ -> m Unit\ndraw dataPoints selector = do\n  (root :: D3Selection_) <- attach selector\n  svg <- appendTo root Svg\n    [ A.width 800.0\n    , A.height 600.0\n    , A.viewBox 0.0 0.0 800.0 600.0\n    ]\n\n  -- Example: Simple data join\n  -- Replace this with your visualization logic\n  circles <- simpleJoin svg Circle dataPoints keyIsID_\n  setAttributes circles\n    [ A.cx (\\\\(_ :: Datum_) (i :: Index_) -> toNumber (datum_.index i) * 50.0)\n    , A.cy 300.0\n    , A.radius 20.0\n    , A.fill "steelblue"\n    ]\n\n  -- Examples of using your data fields in attributes:\n  -- A.cx (\\\\(d :: Datum_) _ -> datum_.' + (firstField + (' d)  -- Use first data field\n  -- A.fill (\\\\(d :: Datum_) (i :: Index_) -> if datum_.index i > 5 then "red" else "blue")\n  -- A.radius (\\\\(d :: Datum_) _ -> datum_.' + (firstField + (" d * 2.0)  -- Scale by data\n\n  pure unit\n\n-- | Entry point\n-- TODO: Update to use PSD3 when wizard is overhauled\n-- run :: Array " + (dataTypeName + ' -> Effect Unit\n-- run dataPoints = eval_D3M $ draw dataPoints "#chart"\n')))))))))))))))))))));
        };
      };
    };
  };

  // output/PSD3.Wizard.Generator/index.js
  var intercalate7 = /* @__PURE__ */ intercalate2(monoidString);
  var map106 = /* @__PURE__ */ map(functorArray);
  var append125 = /* @__PURE__ */ append(semigroupArray);
  var sineWaveData = "[ { x: 0.0, y: 100.0 }\n  , { x: 5.0, y: 125.0 }\n  , { x: 10.0, y: 145.0 }\n  , { x: 15.0, y: 159.0 }\n  , { x: 20.0, y: 165.0 }\n  , { x: 25.0, y: 159.0 }\n  , { x: 30.0, y: 145.0 }\n  , { x: 35.0, y: 125.0 }\n  , { x: 40.0, y: 100.0 }\n  , { x: 45.0, y: 75.0 }\n  , { x: 50.0, y: 55.0 }\n  , { x: 55.0, y: 41.0 }\n  , { x: 60.0, y: 35.0 }\n  , { x: 65.0, y: 41.0 }\n  , { x: 70.0, y: 55.0 }\n  , { x: 75.0, y: 75.0 }\n  , { x: 80.0, y: 100.0 }\n  ]";
  var scatterData2 = "[ { x: 10.0, y: 20.0 }\n  , { x: 25.0, y: 45.0 }\n  , { x: 40.0, y: 30.0 }\n  , { x: 55.0, y: 60.0 }\n  , { x: 70.0, y: 40.0 }\n  , { x: 85.0, y: 70.0 }\n  , { x: 100.0, y: 55.0 }\n  , { x: 115.0, y: 80.0 }\n  , { x: 130.0, y: 65.0 }\n  , { x: 145.0, y: 90.0 }\n  ]";
  var multiLineData = '[ { series: "San Francisco", date: "2000-01", value: 3.5 }\n  , { series: "San Francisco", date: "2002-01", value: 5.2 }\n  , { series: "San Francisco", date: "2004-01", value: 4.8 }\n  , { series: "San Francisco", date: "2006-01", value: 3.9 }\n  , { series: "San Francisco", date: "2008-01", value: 4.2 }\n  , { series: "San Francisco", date: "2010-01", value: 8.4 }\n  , { series: "San Francisco", date: "2012-01", value: 6.8 }\n  , { series: "New York", date: "2000-01", value: 5.3 }\n  , { series: "New York", date: "2002-01", value: 7.2 }\n  , { series: "New York", date: "2004-01", value: 6.1 }\n  , { series: "New York", date: "2006-01", value: 4.9 }\n  , { series: "New York", date: "2008-01", value: 5.3 }\n  , { series: "New York", date: "2010-01", value: 9.2 }\n  , { series: "New York", date: "2012-01", value: 7.8 }\n  , { series: "Austin", date: "2000-01", value: 2.9 }\n  , { series: "Austin", date: "2002-01", value: 4.8 }\n  , { series: "Austin", date: "2004-01", value: 4.2 }\n  , { series: "Austin", date: "2006-01", value: 3.5 }\n  , { series: "Austin", date: "2008-01", value: 3.8 }\n  , { series: "Austin", date: "2010-01", value: 6.5 }\n  , { series: "Austin", date: "2012-01", value: 5.1 }\n  , { series: "Seattle", date: "2000-01", value: 4.1 }\n  , { series: "Seattle", date: "2002-01", value: 6.3 }\n  , { series: "Seattle", date: "2004-01", value: 5.5 }\n  , { series: "Seattle", date: "2006-01", value: 4.2 }\n  , { series: "Seattle", date: "2008-01", value: 4.5 }\n  , { series: "Seattle", date: "2010-01", value: 7.8 }\n  , { series: "Seattle", date: "2012-01", value: 6.2 }\n  ]';
  var groupedBarData = '[ { state: "CA", age: "<10", population: 5038433.0 }\n  , { state: "CA", age: "10-19", population: 5055706.0 }\n  , { state: "CA", age: "20-29", population: 5310481.0 }\n  , { state: "CA", age: "30-39", population: 5354112.0 }\n  , { state: "TX", age: "<10", population: 4131018.0 }\n  , { state: "TX", age: "10-19", population: 3770007.0 }\n  , { state: "TX", age: "20-29", population: 3863019.0 }\n  , { state: "TX", age: "30-39", population: 3696647.0 }\n  , { state: "NY", age: "<10", population: 2275293.0 }\n  , { state: "NY", age: "10-19", population: 2363801.0 }\n  , { state: "NY", age: "20-29", population: 2885845.0 }\n  , { state: "NY", age: "30-39", population: 2754048.0 }\n  ]';
  var fallbackData = function(fields) {
    var generateFieldValue = function(field4) {
      if (field4.fieldType === "Number") {
        return field4.name + ": 0.0";
      }
      ;
      if (field4.fieldType === "String") {
        return field4.name + (': "' + (field4.name + '"'));
      }
      ;
      if (field4.fieldType === "Int") {
        return field4.name + ": 0";
      }
      ;
      return field4.name + ": 0.0";
    };
    var sampleRow = "{ " + (intercalate7(", ")(map106(generateFieldValue)(fields)) + " }");
    var rows4 = intercalate7("\n  , ")([sampleRow, sampleRow, sampleRow]);
    return "[ " + (rows4 + "\n  ]");
  };
  var barChartData = "[ { x: 0.0, y: 30.0 }\n  , { x: 1.0, y: 45.0 }\n  , { x: 2.0, y: 60.0 }\n  , { x: 3.0, y: 55.0 }\n  , { x: 4.0, y: 70.0 }\n  , { x: 5.0, y: 65.0 }\n  , { x: 6.0, y: 80.0 }\n  , { x: 7.0, y: 75.0 }\n  , { x: 8.0, y: 90.0 }\n  , { x: 9.0, y: 85.0 }\n  , { x: 10.0, y: 95.0 }\n  , { x: 11.0, y: 100.0 }\n  ]";
  var anscombeData2 = "[ { x: 10.0, y: 8.04 }\n  , { x: 8.0, y: 6.95 }\n  , { x: 13.0, y: 7.58 }\n  , { x: 9.0, y: 8.81 }\n  , { x: 11.0, y: 8.33 }\n  , { x: 14.0, y: 9.96 }\n  , { x: 6.0, y: 7.24 }\n  , { x: 4.0, y: 4.26 }\n  , { x: 12.0, y: 10.84 }\n  , { x: 7.0, y: 4.82 }\n  , { x: 5.0, y: 5.68 }\n  ]";
  var generateExampleData = function(dataset) {
    if (dataset.id === "scatter") {
      return scatterData2;
    }
    ;
    if (dataset.id === "sinewave") {
      return sineWaveData;
    }
    ;
    if (dataset.id === "barchart") {
      return barChartData;
    }
    ;
    if (dataset.id === "anscombe") {
      return anscombeData2;
    }
    ;
    if (dataset.id === "groupedbar") {
      return groupedBarData;
    }
    ;
    if (dataset.id === "multiline") {
      return multiLineData;
    }
    ;
    return fallbackData(dataset.fields);
  };
  var generateProject = function(config) {
    var exampleData = generateExampleData(config.dataset);
    var dataTypeName = config.vizName + "Data";
    var mainFile = (function() {
      if (config.includeMain) {
        return [{
          filename: "Main.purs",
          content: generateMain(config.vizName)(dataTypeName)
        }];
      }
      ;
      return [];
    })();
    var coerceFnName = "coerceTo" + dataTypeName;
    var baseFiles = [{
      filename: config.vizName + "/Unsafe.purs",
      content: generateUnsafe(config.vizName)(dataTypeName)(config.dataset.fields)
    }, {
      filename: config.vizName + "/Model.purs",
      content: generateModel(config.vizName)(dataTypeName)(config.dataset.fields)(exampleData)
    }, {
      filename: config.vizName + "/Draw.purs",
      content: generateDraw(config.vizName)(dataTypeName)(config.dataset.fields)(coerceFnName)
    }, {
      filename: config.vizName + "/index.html",
      content: generateHTML(config.vizName)
    }, {
      filename: config.vizName + "/README.md",
      content: generateREADME(config.vizName)(dataTypeName)(config.dataset.fields)
    }];
    return append125(baseFiles)(mainFile);
  };

  // output/PSD3.Wizard.Wizard/index.js
  var map107 = /* @__PURE__ */ map(functorArray);
  var eq19 = /* @__PURE__ */ eq(/* @__PURE__ */ eqArray(eqString));
  var show81 = /* @__PURE__ */ show(showDifficulty);
  var eq25 = /* @__PURE__ */ eq(eqDifficulty);
  var eq32 = /* @__PURE__ */ eq(/* @__PURE__ */ eqMaybe(eqDifficulty));
  var bind92 = /* @__PURE__ */ bind(bindMaybe);
  var pure102 = /* @__PURE__ */ pure(applicativeMaybe);
  var type_23 = /* @__PURE__ */ type_18(isPropInputType);
  var value19 = /* @__PURE__ */ value12(isPropString);
  var modify_19 = /* @__PURE__ */ modify_(monadStateHalogenM);
  var bind139 = /* @__PURE__ */ bind(bindHalogenM);
  var get19 = /* @__PURE__ */ get(monadStateHalogenM);
  var discard67 = /* @__PURE__ */ discard(discardUnit)(bindHalogenM);
  var pure125 = /* @__PURE__ */ pure(applicativeHalogenM);
  var when12 = /* @__PURE__ */ when(applicativeHalogenM);
  var ChooseDataset = /* @__PURE__ */ (function() {
    function ChooseDataset2() {
    }
    ;
    ChooseDataset2.value = new ChooseDataset2();
    return ChooseDataset2;
  })();
  var NameModule = /* @__PURE__ */ (function() {
    function NameModule2() {
    }
    ;
    NameModule2.value = new NameModule2();
    return NameModule2;
  })();
  var ReviewFiles = /* @__PURE__ */ (function() {
    function ReviewFiles2() {
    }
    ;
    ReviewFiles2.value = new ReviewFiles2();
    return ReviewFiles2;
  })();
  var Download = /* @__PURE__ */ (function() {
    function Download2() {
    }
    ;
    Download2.value = new Download2();
    return Download2;
  })();
  var SelectDataset = /* @__PURE__ */ (function() {
    function SelectDataset2(value0) {
      this.value0 = value0;
    }
    ;
    SelectDataset2.create = function(value0) {
      return new SelectDataset2(value0);
    };
    return SelectDataset2;
  })();
  var SetVizName = /* @__PURE__ */ (function() {
    function SetVizName2(value0) {
      this.value0 = value0;
    }
    ;
    SetVizName2.create = function(value0) {
      return new SetVizName2(value0);
    };
    return SetVizName2;
  })();
  var ToggleIncludeMain = /* @__PURE__ */ (function() {
    function ToggleIncludeMain2() {
    }
    ;
    ToggleIncludeMain2.value = new ToggleIncludeMain2();
    return ToggleIncludeMain2;
  })();
  var NextStep = /* @__PURE__ */ (function() {
    function NextStep2() {
    }
    ;
    NextStep2.value = new NextStep2();
    return NextStep2;
  })();
  var PreviousStep = /* @__PURE__ */ (function() {
    function PreviousStep2() {
    }
    ;
    PreviousStep2.value = new PreviousStep2();
    return PreviousStep2;
  })();
  var GoToStep = /* @__PURE__ */ (function() {
    function GoToStep2(value0) {
      this.value0 = value0;
    }
    ;
    GoToStep2.create = function(value0) {
      return new GoToStep2(value0);
    };
    return GoToStep2;
  })();
  var GenerateFiles = /* @__PURE__ */ (function() {
    function GenerateFiles2() {
    }
    ;
    GenerateFiles2.value = new GenerateFiles2();
    return GenerateFiles2;
  })();
  var DownloadZip = /* @__PURE__ */ (function() {
    function DownloadZip2() {
    }
    ;
    DownloadZip2.value = new DownloadZip2();
    return DownloadZip2;
  })();
  var CopyToClipboard = /* @__PURE__ */ (function() {
    function CopyToClipboard2() {
    }
    ;
    CopyToClipboard2.value = new CopyToClipboard2();
    return CopyToClipboard2;
  })();
  var SetDifficultyFilter = /* @__PURE__ */ (function() {
    function SetDifficultyFilter2(value0) {
      this.value0 = value0;
    }
    ;
    SetDifficultyFilter2.create = function(value0) {
      return new SetDifficultyFilter2(value0);
    };
    return SetDifficultyFilter2;
  })();
  var renderReviewFiles = function(state3) {
    var renderFile = function(file) {
      return details([classes(["wizard__file"])])([summary_([text5(file.filename)]), pre([classes(["wizard__code"])])([code_([text5(file.content)])])]);
    };
    return div2([classes(["wizard__step-content"])])([h2_([text5("Review Generated Files")]), p_([text5("Preview the files that will be generated for your project.")]), div2([classes(["wizard__file-list"])])(map107(renderFile)(state3.generatedFiles))]);
  };
  var renderHeader4 = function(state3) {
    return header([classes(["wizard__header"])])([h1_([text5("PSD3 Visualization Wizard")]), p([classes(["wizard__subtitle"])])([text5("Create a new PSD3 visualization project in 4 easy steps")])]);
  };
  var renderDownload = function(state3) {
    return div2([classes(["wizard__step-content wizard__step-content--centered"])])([h2_([text5("Download Your Project")]), p_([text5("Your visualization project is ready! Download it as a zip file or copy the code to your clipboard.")]), div2([classes(["wizard__download-options"])])([button2([classes(["wizard__btn wizard__btn--primary wizard__btn--large"]), onClick(function(v2) {
      return DownloadZip.value;
    })])([text5("\u{1F4E6} Download " + (state3.vizName + ".zip"))]), button2([classes(["wizard__btn wizard__btn--secondary wizard__btn--large"]), onClick(function(v2) {
      return CopyToClipboard.value;
    })])([text5("\u{1F4CB} Copy to Clipboard")])]), div2([classes(["wizard__next-steps"])])([h3_([text5("Next Steps")]), ol_([li_([text5("Extract the zip file to your project directory")]), li_([text5("Add your dependencies to spago.dhall or package.json")]), li_([text5("Customize the visualization in Draw.purs")]), li_([text5("Build with 'spago build'")]), li_([text5("Open index.html in your browser")])])])]);
  };
  var renderChooseDataset = function(state3) {
    var toLowerCase = (function() {
      var toLower2 = function(c2) {
        var $73 = c2 >= "A" && c2 <= "Z";
        if ($73) {
          return fromMaybe(c2)(fromCharCode3(toCharCode2(c2) + 32 | 0));
        }
        ;
        return c2;
      };
      var $151 = map107(toLower2);
      return function($152) {
        return fromCharArray($151(toCharArray($152)));
      };
    })();
    var intercalate9 = function(sep) {
      return function(arr) {
        return maybe("")(function(v2) {
          var $75 = eq19(v2.tail)([]);
          if ($75) {
            return v2.head;
          }
          ;
          return v2.head + (sep + intercalate9(sep)(v2.tail));
        })(uncons4(arr));
      };
    };
    var renderDatasetCard = function(dataset) {
      var isSelected = (function() {
        if (state3.selectedDataset instanceof Just) {
          return state3.selectedDataset.value0.id === dataset.id;
        }
        ;
        if (state3.selectedDataset instanceof Nothing) {
          return false;
        }
        ;
        throw new Error("Failed pattern match at PSD3.Wizard.Wizard (line 181, column 20 - line 183, column 25): " + [state3.selectedDataset.constructor.name]);
      })();
      var cardClass = "dataset-card" + (function() {
        if (isSelected) {
          return " dataset-card--selected";
        }
        ;
        return "";
      })();
      return div2([classes([cardClass]), onClick(function(v2) {
        return new SelectDataset(dataset);
      })])([div2([classes(["dataset-card__header"])])([h3_([text5(dataset.name)]), span4([classes(["difficulty-badge difficulty-badge--" + toLowerCase(show81(dataset.difficulty))])])([text5(show81(dataset.difficulty))])]), p([classes(["dataset-card__description"])])([text5(dataset.description)]), div2([classes(["dataset-card__info"])])([strong_([text5("Fields: ")]), text5(intercalate9(", ")(map107(function(f) {
        return f.name + (": " + f.fieldType);
      })(dataset.fields)))]), div2([classes(["dataset-card__viz"])])([strong_([text5("Suggested: ")]), text5(dataset.suggestedViz)]), div2([classes(["dataset-card__note"])])([text5(dataset.educationalNote)])]);
    };
    var filteredDatasets = (function() {
      if (state3.filterDifficulty instanceof Nothing) {
        return allDatasets2;
      }
      ;
      if (state3.filterDifficulty instanceof Just) {
        return filter(function(d) {
          return eq25(d.difficulty)(state3.filterDifficulty.value0);
        })(allDatasets2);
      }
      ;
      throw new Error("Failed pattern match at PSD3.Wizard.Wizard (line 174, column 22 - line 176, column 77): " + [state3.filterDifficulty.constructor.name]);
    })();
    return div2([classes(["wizard__step-content"])])([h2_([text5("Choose a Dataset")]), p_([text5("Select an example dataset to get started. Each dataset includes sample data and suggestions for visualizations.")]), div2([classes(["wizard__filters"])])([label_([text5("Filter by difficulty:")]), button2([classes(["filter-btn" + (function() {
      var $83 = eq32(state3.filterDifficulty)(Nothing.value);
      if ($83) {
        return " filter-btn--active";
      }
      ;
      return "";
    })()]), onClick(function(v2) {
      return new SetDifficultyFilter(Nothing.value);
    })])([text5("All")]), button2([classes(["filter-btn" + (function() {
      var $84 = eq32(state3.filterDifficulty)(new Just(Beginner.value));
      if ($84) {
        return " filter-btn--active";
      }
      ;
      return "";
    })()]), onClick(function(v2) {
      return new SetDifficultyFilter(new Just(Beginner.value));
    })])([text5("Beginner")]), button2([classes(["filter-btn" + (function() {
      var $85 = eq32(state3.filterDifficulty)(new Just(Intermediate.value));
      if ($85) {
        return " filter-btn--active";
      }
      ;
      return "";
    })()]), onClick(function(v2) {
      return new SetDifficultyFilter(new Just(Intermediate.value));
    })])([text5("Intermediate")])]), div2([classes(["wizard__dataset-grid"])])(map107(renderDatasetCard)(filteredDatasets))]);
  };
  var isValidModuleName = function(name16) {
    var all4 = function(pred) {
      return function(arr) {
        var v2 = uncons4(arr);
        if (v2 instanceof Nothing) {
          return true;
        }
        ;
        if (v2 instanceof Just) {
          return pred(v2.value0.head) && all4(pred)(v2.value0.tail);
        }
        ;
        throw new Error("Failed pattern match at PSD3.Wizard.Wizard (line 458, column 18 - line 460, column 56): " + [v2.constructor.name]);
      };
    };
    var isUpperCase = function(c2) {
      var code3 = toCharCode2(c2);
      return code3 >= 65 && code3 <= 90;
    };
    var isLowerCase = function(c2) {
      var code3 = toCharCode2(c2);
      return code3 >= 97 && code3 <= 122;
    };
    var isDigitChar = function(c2) {
      var code3 = toCharCode2(c2);
      return code3 >= 48 && code3 <= 57;
    };
    var isAlphaNum = function(c2) {
      return isUpperCase(c2) || (isLowerCase(c2) || isDigitChar(c2));
    };
    var chars = toCharArray(name16);
    if (chars.length === 0) {
      return false;
    }
    ;
    return fromMaybe(false)(bind92(head2(chars))(function(first) {
      return pure102(isUpperCase(first) && all4(isAlphaNum)(chars));
    }));
  };
  var renderNameModule = function(state3) {
    return div2([classes(["wizard__step-content"])])([h2_([text5("Name Your Visualization")]), p_([text5("Choose a name for your visualization module. It should be a valid PureScript module name (CamelCase, starting with uppercase).")]), div2([classes(["wizard__form-group"])])([label4([$$for("viz-name")])([text5("Visualization Name")]), input([type_23(InputText.value), id3("viz-name"), value19(state3.vizName), placeholder3("e.g., MyScatterPlot"), onValueInput(SetVizName.create), classes(["wizard__input"])]), (function() {
      var $91 = isValidModuleName(state3.vizName) || state3.vizName === "";
      if ($91) {
        return div_([]);
      }
      ;
      return div2([classes(["wizard__error"])])([text5("Module name must start with uppercase and contain only letters and numbers")]);
    })()]), div2([classes(["wizard__form-group"])])([label_([input([type_23(InputCheckbox.value), checked2(state3.includeMain), onChecked(function(v2) {
      return ToggleIncludeMain.value;
    })]), text5(" Include Main.purs (for bundling with spago)")]), p([classes(["wizard__help-text"])])([text5("Main.purs provides an entry point for bundling your visualization. Check this if you plan to use 'spago bundle'.")])]), (function() {
      var $92 = state3.vizName !== "" && isValidModuleName(state3.vizName);
      if ($92) {
        return div2([classes(["wizard__preview"])])([h3_([text5("Files that will be generated:")]), ul_([li_([text5(state3.vizName + "/Unsafe.purs")]), li_([text5(state3.vizName + "/Model.purs")]), li_([text5(state3.vizName + "/Draw.purs")]), li_([text5(state3.vizName + "/index.html")]), li_([text5(state3.vizName + "/README.md")]), (function() {
          if (state3.includeMain) {
            return li_([text5("Main.purs")]);
          }
          ;
          return text5("");
        })()])]);
      }
      ;
      return div_([]);
    })()]);
  };
  var renderStepContent = function(dictMonadAff) {
    return function(state3) {
      return div2([classes(["wizard__content"])])([(function() {
        if (state3.currentStep instanceof ChooseDataset) {
          return renderChooseDataset(state3);
        }
        ;
        if (state3.currentStep instanceof NameModule) {
          return renderNameModule(state3);
        }
        ;
        if (state3.currentStep instanceof ReviewFiles) {
          return renderReviewFiles(state3);
        }
        ;
        if (state3.currentStep instanceof Download) {
          return renderDownload(state3);
        }
        ;
        throw new Error("Failed pattern match at PSD3.Wizard.Wizard (line 132, column 7 - line 136, column 41): " + [state3.currentStep.constructor.name]);
      })()]);
    };
  };
  var initialState5 = /* @__PURE__ */ (function() {
    return {
      currentStep: ChooseDataset.value,
      selectedDataset: Nothing.value,
      vizName: "",
      includeMain: true,
      generatedFiles: [],
      filterDifficulty: Nothing.value
    };
  })();
  var eqWizardStep = {
    eq: function(x32) {
      return function(y32) {
        if (x32 instanceof ChooseDataset && y32 instanceof ChooseDataset) {
          return true;
        }
        ;
        if (x32 instanceof NameModule && y32 instanceof NameModule) {
          return true;
        }
        ;
        if (x32 instanceof ReviewFiles && y32 instanceof ReviewFiles) {
          return true;
        }
        ;
        if (x32 instanceof Download && y32 instanceof Download) {
          return true;
        }
        ;
        return false;
      };
    }
  };
  var eq42 = /* @__PURE__ */ eq(eqWizardStep);
  var renderNavigation = function(state3) {
    var canProceed = (function() {
      if (state3.currentStep instanceof ChooseDataset) {
        return isJust(state3.selectedDataset);
      }
      ;
      if (state3.currentStep instanceof NameModule) {
        return state3.vizName !== "" && isValidModuleName(state3.vizName);
      }
      ;
      if (state3.currentStep instanceof ReviewFiles) {
        return true;
      }
      ;
      if (state3.currentStep instanceof Download) {
        return true;
      }
      ;
      throw new Error("Failed pattern match at PSD3.Wizard.Wizard (line 363, column 16 - line 367, column 21): " + [state3.currentStep.constructor.name]);
    })();
    return div2([classes(["wizard__navigation"])])([button2([classes(["wizard__btn wizard__btn--secondary"]), onClick(function(v2) {
      return PreviousStep.value;
    }), disabled10(eq42(state3.currentStep)(ChooseDataset.value))])([text5("\u2190 Previous")]), button2([classes(["wizard__btn wizard__btn--primary"]), onClick(function(v2) {
      return NextStep.value;
    }), disabled10(!canProceed)])([text5((function() {
      var $98 = eq42(state3.currentStep)(Download.value);
      if ($98) {
        return "Restart";
      }
      ;
      return "Next \u2192";
    })())])]);
  };
  var renderProgressBar = function(state3) {
    var stepIndex = function(v2) {
      if (v2 instanceof ChooseDataset) {
        return 0;
      }
      ;
      if (v2 instanceof NameModule) {
        return 1;
      }
      ;
      if (v2 instanceof ReviewFiles) {
        return 2;
      }
      ;
      if (v2 instanceof Download) {
        return 3;
      }
      ;
      throw new Error("Failed pattern match at PSD3.Wizard.Wizard (line 121, column 3 - line 121, column 33): " + [v2.constructor.name]);
    };
    var renderStep = function(step5) {
      return function(num41) {
        return function(label5) {
          var isCompleted = stepIndex(state3.currentStep) > stepIndex(step5);
          var isActive = eq42(state3.currentStep)(step5);
          var classes2 = "wizard__step" + ((function() {
            if (isActive) {
              return " wizard__step--active";
            }
            ;
            return "";
          })() + (function() {
            if (isCompleted) {
              return " wizard__step--completed";
            }
            ;
            return "";
          })());
          return div2([classes([classes2]), onClick(function(v2) {
            return new GoToStep(step5);
          })])([div2([classes(["wizard__step-number"])])([text5(num41)]), div2([classes(["wizard__step-label"])])([text5(label5)])]);
        };
      };
    };
    return div2([classes(["wizard__progress"])])([renderStep(ChooseDataset.value)("1")("Choose Dataset"), renderStep(NameModule.value)("2")("Name Module"), renderStep(ReviewFiles.value)("3")("Review Files"), renderStep(Download.value)("4")("Download")]);
  };
  var render54 = function(dictMonadAff) {
    var renderStepContent1 = renderStepContent(dictMonadAff);
    return function(state3) {
      return div2([classes(["wizard"])])([renderHeader4(state3), renderProgressBar(state3), renderStepContent1(state3), renderNavigation(state3)]);
    };
  };
  var canGoToStep = function(state3) {
    return function(step5) {
      if (step5 instanceof ChooseDataset) {
        return true;
      }
      ;
      if (step5 instanceof NameModule) {
        return isJust(state3.selectedDataset);
      }
      ;
      if (step5 instanceof ReviewFiles) {
        return isJust(state3.selectedDataset) && (state3.vizName !== "" && isValidModuleName(state3.vizName));
      }
      ;
      if (step5 instanceof Download) {
        return isJust(state3.selectedDataset) && (state3.vizName !== "" && isValidModuleName(state3.vizName));
      }
      ;
      throw new Error("Failed pattern match at PSD3.Wizard.Wizard (line 435, column 26 - line 439, column 101): " + [step5.constructor.name]);
    };
  };
  var handleAction48 = function(dictMonadAff) {
    var liftAff2 = liftAff(monadAffHalogenM(dictMonadAff));
    var liftEffect54 = liftEffect(monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    return function(v2) {
      if (v2 instanceof SelectDataset) {
        return modify_19(function(v1) {
          var $104 = {};
          for (var $105 in v1) {
            if ({}.hasOwnProperty.call(v1, $105)) {
              $104[$105] = v1[$105];
            }
            ;
          }
          ;
          $104.selectedDataset = new Just(v2.value0);
          return $104;
        });
      }
      ;
      if (v2 instanceof SetVizName) {
        return modify_19(function(v1) {
          var $108 = {};
          for (var $109 in v1) {
            if ({}.hasOwnProperty.call(v1, $109)) {
              $108[$109] = v1[$109];
            }
            ;
          }
          ;
          $108.vizName = trim(v2.value0);
          return $108;
        });
      }
      ;
      if (v2 instanceof ToggleIncludeMain) {
        return modify_19(function(s3) {
          var $112 = {};
          for (var $113 in s3) {
            if ({}.hasOwnProperty.call(s3, $113)) {
              $112[$113] = s3[$113];
            }
            ;
          }
          ;
          $112.includeMain = !s3.includeMain;
          return $112;
        });
      }
      ;
      if (v2 instanceof NextStep) {
        return bind139(get19)(function(state3) {
          if (state3.currentStep instanceof ChooseDataset) {
            return modify_19(function(v1) {
              var $116 = {};
              for (var $117 in v1) {
                if ({}.hasOwnProperty.call(v1, $117)) {
                  $116[$117] = v1[$117];
                }
                ;
              }
              ;
              $116.currentStep = NameModule.value;
              return $116;
            });
          }
          ;
          if (state3.currentStep instanceof NameModule) {
            return discard67(handleAction48(dictMonadAff)(GenerateFiles.value))(function() {
              return modify_19(function(v1) {
                var $119 = {};
                for (var $120 in v1) {
                  if ({}.hasOwnProperty.call(v1, $120)) {
                    $119[$120] = v1[$120];
                  }
                  ;
                }
                ;
                $119.currentStep = ReviewFiles.value;
                return $119;
              });
            });
          }
          ;
          if (state3.currentStep instanceof ReviewFiles) {
            return modify_19(function(v1) {
              var $122 = {};
              for (var $123 in v1) {
                if ({}.hasOwnProperty.call(v1, $123)) {
                  $122[$123] = v1[$123];
                }
                ;
              }
              ;
              $122.currentStep = Download.value;
              return $122;
            });
          }
          ;
          if (state3.currentStep instanceof Download) {
            return modify_19(function(v1) {
              var $125 = {};
              for (var $126 in v1) {
                if ({}.hasOwnProperty.call(v1, $126)) {
                  $125[$126] = v1[$126];
                }
                ;
              }
              ;
              $125.currentStep = ChooseDataset.value;
              return $125;
            });
          }
          ;
          throw new Error("Failed pattern match at PSD3.Wizard.Wizard (line 383, column 5 - line 389, column 62): " + [state3.currentStep.constructor.name]);
        });
      }
      ;
      if (v2 instanceof PreviousStep) {
        return bind139(get19)(function(state3) {
          if (state3.currentStep instanceof NameModule) {
            return modify_19(function(v1) {
              var $129 = {};
              for (var $130 in v1) {
                if ({}.hasOwnProperty.call(v1, $130)) {
                  $129[$130] = v1[$130];
                }
                ;
              }
              ;
              $129.currentStep = ChooseDataset.value;
              return $129;
            });
          }
          ;
          if (state3.currentStep instanceof ReviewFiles) {
            return modify_19(function(v1) {
              var $132 = {};
              for (var $133 in v1) {
                if ({}.hasOwnProperty.call(v1, $133)) {
                  $132[$133] = v1[$133];
                }
                ;
              }
              ;
              $132.currentStep = NameModule.value;
              return $132;
            });
          }
          ;
          if (state3.currentStep instanceof Download) {
            return modify_19(function(v1) {
              var $135 = {};
              for (var $136 in v1) {
                if ({}.hasOwnProperty.call(v1, $136)) {
                  $135[$136] = v1[$136];
                }
                ;
              }
              ;
              $135.currentStep = ReviewFiles.value;
              return $135;
            });
          }
          ;
          if (state3.currentStep instanceof ChooseDataset) {
            return pure125(unit);
          }
          ;
          throw new Error("Failed pattern match at PSD3.Wizard.Wizard (line 393, column 5 - line 397, column 33): " + [state3.currentStep.constructor.name]);
        });
      }
      ;
      if (v2 instanceof GoToStep) {
        return bind139(get19)(function(state3) {
          return when12(canGoToStep(state3)(v2.value0))(modify_19(function(v1) {
            var $138 = {};
            for (var $139 in v1) {
              if ({}.hasOwnProperty.call(v1, $139)) {
                $138[$139] = v1[$139];
              }
              ;
            }
            ;
            $138.currentStep = v2.value0;
            return $138;
          }));
        });
      }
      ;
      if (v2 instanceof GenerateFiles) {
        return bind139(get19)(function(state3) {
          if (state3.selectedDataset instanceof Just) {
            var config = {
              vizName: state3.vizName,
              dataset: state3.selectedDataset.value0,
              includeMain: state3.includeMain
            };
            var files2 = generateProject(config);
            return modify_19(function(v1) {
              var $143 = {};
              for (var $144 in v1) {
                if ({}.hasOwnProperty.call(v1, $144)) {
                  $143[$144] = v1[$144];
                }
                ;
              }
              ;
              $143.generatedFiles = files2;
              return $143;
            });
          }
          ;
          if (state3.selectedDataset instanceof Nothing) {
            return pure125(unit);
          }
          ;
          throw new Error("Failed pattern match at PSD3.Wizard.Wizard (line 407, column 5 - line 418, column 27): " + [state3.selectedDataset.constructor.name]);
        });
      }
      ;
      if (v2 instanceof DownloadZip) {
        return bind139(get19)(function(state3) {
          return liftAff2(downloadAsZip(state3.vizName)(state3.generatedFiles));
        });
      }
      ;
      if (v2 instanceof CopyToClipboard) {
        return bind139(get19)(function(state3) {
          return bind139(liftEffect54(copyFilesToClipboard(state3.generatedFiles)))(function(success) {
            return pure125(unit);
          });
        });
      }
      ;
      if (v2 instanceof SetDifficultyFilter) {
        return modify_19(function(v1) {
          var $147 = {};
          for (var $148 in v1) {
            if ({}.hasOwnProperty.call(v1, $148)) {
              $147[$148] = v1[$148];
            }
            ;
          }
          ;
          $147.filterDifficulty = v2.value0;
          return $147;
        });
      }
      ;
      throw new Error("Failed pattern match at PSD3.Wizard.Wizard (line 371, column 16 - line 431, column 50): " + [v2.constructor.name]);
    };
  };
  var component49 = /* @__PURE__ */ (function() {
    return mkComponent({
      initialState: $$const(initialState5),
      render: render54(monadAffAff),
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        initialize: defaultEval.initialize,
        finalize: defaultEval.finalize,
        handleAction: handleAction48(monadAffAff)
      })
    });
  })();

  // output/Routing.Parser/index.js
  var map108 = /* @__PURE__ */ map(functorArray);
  var discard68 = /* @__PURE__ */ discard(discardUnit)(bindMaybe);
  var guard2 = /* @__PURE__ */ guard(alternativeMaybe);
  var apply5 = /* @__PURE__ */ apply(applyMaybe);
  var map123 = /* @__PURE__ */ map(functorMaybe);
  var fromFoldable41 = /* @__PURE__ */ fromFoldable6(ordString)(foldableArray);
  var traverse7 = /* @__PURE__ */ traverse(traversableArray)(applicativeMaybe);
  var fromFoldable118 = /* @__PURE__ */ fromFoldable(foldableArray);
  var append40 = /* @__PURE__ */ append(semigroupList);
  var map211 = /* @__PURE__ */ map(functorList);
  var fromFoldable210 = /* @__PURE__ */ fromFoldable(foldableMaybe);
  var parseQueryPart = function(decoder) {
    var part2tuple = function(input3) {
      var keyVal = map108(decoder)(split("=")(input3));
      return discard68(guard2(length3(keyVal) <= 2))(function() {
        return apply5(map123(Tuple.create)(head2(keyVal)))(index(keyVal)(1));
      });
    };
    var $27 = map123(fromFoldable41);
    var $28 = traverse7(part2tuple);
    var $29 = split("&");
    return function($30) {
      return $27($28($29($30)));
    };
  };
  var parse8 = function(decoder) {
    return function(hash2) {
      var pathParts = function(str23) {
        var parts = fromFoldable118(map108(function($31) {
          return Path3.create(decoder($31));
        })(split("/")(str23)));
        var v3 = unsnoc(parts);
        if (v3 instanceof Just && (v3.value0.last instanceof Path3 && v3.value0.last.value0 === "")) {
          return v3.value0.init;
        }
        ;
        return parts;
      };
      var v2 = map123(flip(splitAt3)(hash2))(indexOf2("?")(hash2));
      if (v2 instanceof Just) {
        return append40(pathParts(v2.value0.before))(map211(Query2.create)(fromFoldable210(parseQueryPart(decoder)(drop5(1)(v2.value0.after)))));
      }
      ;
      if (v2 instanceof Nothing) {
        return pathParts(hash2);
      }
      ;
      throw new Error("Failed pattern match at Routing.Parser (line 32, column 3 - line 37, column 21): " + [v2.constructor.name]);
    };
  };

  // output/Routing/index.js
  var fromJust6 = /* @__PURE__ */ fromJust();
  var matchWith = function(decoder) {
    return function(matcher) {
      var $2 = runMatch(matcher);
      var $3 = parse8(decoder);
      return function($4) {
        return $2($3($4));
      };
    };
  };
  var match2 = /* @__PURE__ */ matchWith(function($6) {
    return fromJust6($$decodeURIComponent($6));
  });

  // output/Web.HTML.Event.HashChangeEvent.EventTypes/index.js
  var hashchange = "hashchange";

  // output/Routing.Hash/index.js
  var bind93 = /* @__PURE__ */ bind(bindEffect);
  var map109 = /* @__PURE__ */ map(functorEffect);
  var bindFlipped9 = /* @__PURE__ */ bindFlipped(bindEffect);
  var join5 = /* @__PURE__ */ join(bindEffect);
  var apply6 = /* @__PURE__ */ apply(applyEffect);
  var pure103 = /* @__PURE__ */ pure(applicativeEffect);
  var voidRight3 = /* @__PURE__ */ voidRight(functorEffect);
  var setHash2 = function(h7) {
    return bind93(bind93(windowImpl)(location))(setHash(h7));
  };
  var getHash = /* @__PURE__ */ bind93(/* @__PURE__ */ bind93(windowImpl)(location))(/* @__PURE__ */ (function() {
    var $16 = map109((function() {
      var $18 = fromMaybe("");
      var $19 = stripPrefix("#");
      return function($20) {
        return $18($19($20));
      };
    })());
    return function($17) {
      return $16(hash($17));
    };
  })());
  var foldHashes = function(cb) {
    return function(init4) {
      return function __do7() {
        var ref2 = bindFlipped9($$new)(bindFlipped9(init4)(getHash))();
        var win = map109(toEventTarget)(windowImpl)();
        var listener = eventListener(function(v2) {
          return bindFlipped9(flip(write)(ref2))(join5(apply6(map109(cb)(read(ref2)))(getHash)));
        })();
        addEventListener2(hashchange)(listener)(false)(win)();
        return removeEventListener2(hashchange)(listener)(false)(win);
      };
    };
  };
  var matchesWith = function(dictFoldable) {
    var indexl2 = indexl(dictFoldable);
    return function(parser) {
      return function(cb) {
        var go2 = function(a3) {
          var $21 = maybe(pure103(a3))(function(b10) {
            return voidRight3(new Just(b10))(cb(a3)(b10));
          });
          var $22 = indexl2(0);
          return function($23) {
            return $21($22(parser($23)));
          };
        };
        return foldHashes(go2)(go2(Nothing.value));
      };
    };
  };
  var matches2 = /* @__PURE__ */ (function() {
    var $24 = matchesWith(foldableEither);
    return function($25) {
      return $24(match2($25));
    };
  })();

  // output/TreeBuilder.App/foreign.js
  var clearPreviewContainer = (selector) => () => {
    const container = document.querySelector(selector);
    if (container) {
      container.innerHTML = "";
    }
  };

  // output/PSD3.Interpreter.SemiQuine.TreeToCode/index.js
  var show82 = /* @__PURE__ */ show(showNumber);
  var show136 = /* @__PURE__ */ show(showBoolean);
  var map124 = /* @__PURE__ */ map(functorArray);
  var append126 = /* @__PURE__ */ append(semigroupArray);
  var staticValueToCode = function(v2) {
    if (v2 instanceof StringValue) {
      return 'text "' + (v2.value0 + '"');
    }
    ;
    if (v2 instanceof NumberValue) {
      return "num " + show82(v2.value0);
    }
    ;
    if (v2 instanceof BooleanValue) {
      return "bool " + show136(v2.value0);
    }
    ;
    throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 193, column 21 - line 196, column 38): " + [v2.constructor.name]);
  };
  var showElemType3 = function(v2) {
    if (v2 instanceof SVG) {
      return "SVG";
    }
    ;
    if (v2 instanceof Group) {
      return "Group";
    }
    ;
    if (v2 instanceof Circle) {
      return "Circle";
    }
    ;
    if (v2 instanceof Rect) {
      return "Rect";
    }
    ;
    if (v2 instanceof Path) {
      return "Path";
    }
    ;
    if (v2 instanceof Line) {
      return "Line";
    }
    ;
    if (v2 instanceof Text) {
      return "Text";
    }
    ;
    if (v2 instanceof Div) {
      return "Div";
    }
    ;
    if (v2 instanceof Span) {
      return "Span";
    }
    ;
    if (v2 instanceof Table) {
      return "Table";
    }
    ;
    if (v2 instanceof Tbody) {
      return "Tbody";
    }
    ;
    if (v2 instanceof Thead) {
      return "Thead";
    }
    ;
    if (v2 instanceof Tr) {
      return "Tr";
    }
    ;
    if (v2 instanceof Td) {
      return "Td";
    }
    ;
    if (v2 instanceof Th) {
      return "Th";
    }
    ;
    if (v2 instanceof Defs) {
      return "Defs";
    }
    ;
    if (v2 instanceof LinearGradient) {
      return "LinearGradient";
    }
    ;
    if (v2 instanceof Stop) {
      return "Stop";
    }
    ;
    throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 227, column 16 - line 245, column 17): " + [v2.constructor.name]);
  };
  var showAttrValue2 = function(v2) {
    if (v2 instanceof StringValue) {
      return '"' + (v2.value0 + '"');
    }
    ;
    if (v2 instanceof NumberValue) {
      return show82(v2.value0);
    }
    ;
    if (v2 instanceof BooleanValue) {
      return show136(v2.value0);
    }
    ;
    throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 249, column 17 - line 252, column 27): " + [v2.constructor.name]);
  };
  var indent2 = function(n) {
    return joinWith("")(replicate(n)("  "));
  };
  var attrSourceToCode = function(v2) {
    if (v2 instanceof UnknownSource) {
      return "d.<?>";
    }
    ;
    if (v2 instanceof StaticSource) {
      return "num " + v2.value0;
    }
    ;
    if (v2 instanceof FieldSource) {
      return 'field @"' + (v2.value0 + '"');
    }
    ;
    if (v2 instanceof ExprSource) {
      return v2.value0;
    }
    ;
    if (v2 instanceof IndexSource) {
      return "index";
    }
    ;
    throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 201, column 20 - line 206, column 25): " + [v2.constructor.name]);
  };
  var attrFnName = function(v2) {
    if (v2 === "stroke-width") {
      return "strokeWidth";
    }
    ;
    if (v2 === "fill-opacity") {
      return "fillOpacity";
    }
    ;
    if (v2 === "stroke-opacity") {
      return "strokeOpacity";
    }
    ;
    if (v2 === "stroke-dasharray") {
      return "strokeDasharray";
    }
    ;
    if (v2 === "font-size") {
      return "fontSize";
    }
    ;
    if (v2 === "font-family") {
      return "fontFamily";
    }
    ;
    if (v2 === "font-weight") {
      return "fontWeight";
    }
    ;
    if (v2 === "text-anchor") {
      return "textAnchor";
    }
    ;
    if (v2 === "dominant-baseline") {
      return "dominantBaseline";
    }
    ;
    if (v2 === "stop-color") {
      return "stopColor";
    }
    ;
    if (v2 === "gradientUnits") {
      return "gradientUnits";
    }
    ;
    return v2;
  };
  var attrToCode = function(maybeSample) {
    return function(attr46) {
      if (attr46 instanceof StaticAttr) {
        return attrFnName(attr46.value0) + (" $ " + staticValueToCode(attr46.value1));
      }
      ;
      if (attr46 instanceof DataAttr) {
        if (maybeSample instanceof Just) {
          var evaluated = attr46.value2(maybeSample.value0);
          return attrFnName(attr46.value0) + (" $ " + (attrSourceToCode(attr46.value1) + (" {- \u2192 " + (showAttrValue2(evaluated) + " -}"))));
        }
        ;
        if (maybeSample instanceof Nothing) {
          return attrFnName(attr46.value0) + (" $ " + attrSourceToCode(attr46.value1));
        }
        ;
        throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 175, column 5 - line 181, column 57): " + [maybeSample.constructor.name]);
      }
      ;
      if (attr46 instanceof IndexedAttr) {
        if (maybeSample instanceof Just) {
          var evaluated = attr46.value2(maybeSample.value0)(0);
          return attrFnName(attr46.value0) + (" $ " + (attrSourceToCode(attr46.value1) + (" {- \u2192 " + (showAttrValue2(evaluated) + " -}"))));
        }
        ;
        if (maybeSample instanceof Nothing) {
          return attrFnName(attr46.value0) + (" $ " + attrSourceToCode(attr46.value1));
        }
        ;
        throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 184, column 5 - line 189, column 57): " + [maybeSample.constructor.name]);
      }
      ;
      throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 169, column 31 - line 189, column 57): " + [attr46.constructor.name]);
    };
  };
  var attrsToLines = function(maybeSample) {
    return function(attrs) {
      return function(indentLevel) {
        var $50 = $$null3(attrs);
        if ($50) {
          return [indent2(indentLevel) + "[]"];
        }
        ;
        var attrStrings = map124(attrToCode(maybeSample))(attrs);
        var v2 = head2(attrStrings);
        if (v2 instanceof Just) {
          return append126([indent2(indentLevel) + ("[ " + v2.value0)])(append126(map124(function(a3) {
            return indent2(indentLevel) + (", " + a3);
          })(drop(1)(attrStrings)))([indent2(indentLevel) + "]"]));
        }
        ;
        if (v2 instanceof Nothing) {
          return [indent2(indentLevel) + "[]"];
        }
        ;
        throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 160, column 10 - line 165, column 50): " + [v2.constructor.name]);
      };
    };
  };
  var treeLines = function(maybeSample) {
    return function(tree2) {
      return function(indentLevel) {
        var hasUpdate = function(spec) {
          if (spec.updateBehavior instanceof Just) {
            return true;
          }
          ;
          if (spec.updateBehavior instanceof Nothing) {
            return false;
          }
          ;
          throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 124, column 22 - line 126, column 23): " + [spec.updateBehavior.constructor.name]);
        };
        var hasExit = function(spec) {
          if (spec.exitBehavior instanceof Just) {
            return true;
          }
          ;
          if (spec.exitBehavior instanceof Nothing) {
            return false;
          }
          ;
          throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 127, column 20 - line 129, column 23): " + [spec.exitBehavior.constructor.name]);
        };
        var hasEnter = function(spec) {
          if (spec.enterBehavior instanceof Just) {
            return true;
          }
          ;
          if (spec.enterBehavior instanceof Nothing) {
            return false;
          }
          ;
          throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 121, column 21 - line 123, column 23): " + [spec.enterBehavior.constructor.name]);
        };
        if (tree2 instanceof Node2) {
          var elemCode = (function() {
            if (tree2.value0.name instanceof Just) {
              return "T.named " + (showElemType3(tree2.value0.elemType) + (' "' + (tree2.value0.name.value0 + '"')));
            }
            ;
            if (tree2.value0.name instanceof Nothing) {
              return "T.elem " + showElemType3(tree2.value0.elemType);
            }
            ;
            throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 40, column 18 - line 42, column 59): " + [tree2.value0.name.constructor.name]);
          })();
          var childrenCode = (function() {
            var v2 = length3(tree2.value0.children);
            if (v2 === 0) {
              return [];
            }
            ;
            if (v2 === 1) {
              var v1 = head2(tree2.value0.children);
              if (v1 instanceof Just) {
                return append126([indent2(indentLevel) + "`T.withChild`"])(treeLines(maybeSample)(v1.value0)(indentLevel + 1 | 0));
              }
              ;
              if (v1 instanceof Nothing) {
                return [];
              }
              ;
              throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 50, column 14 - line 54, column 24): " + [v1.constructor.name]);
            }
            ;
            return append126([indent2(indentLevel) + "`T.withChildren`", indent2(indentLevel + 1 | 0) + "["])(append126(childrenWithCommas(maybeSample)(tree2.value0.children)(indentLevel + 1 | 0))([indent2(indentLevel + 1 | 0) + "]"]));
          })();
          var attrsLines = attrsToLines(maybeSample)(tree2.value0.attrs)(indentLevel + 1 | 0);
          return append126([indent2(indentLevel) + elemCode])(append126(attrsLines)(childrenCode));
        }
        ;
        if (tree2 instanceof Join) {
          var templateCode = (function() {
            var v2 = head2(tree2.value0.joinData);
            if (v2 instanceof Just) {
              var templateTree = tree2.value0.template(v2.value0);
              return treeLines(new Just(v2.value0))(templateTree)(indentLevel + 1 | 0);
            }
            ;
            if (v2 instanceof Nothing) {
              return [indent2(indentLevel + 1 | 0) + "-- (no data to evaluate template)"];
            }
            ;
            throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 69, column 22 - line 74, column 78): " + [v2.constructor.name]);
          })();
          return append126([indent2(indentLevel) + ('T.joinData "' + (tree2.value0.name + ('" "' + (tree2.value0.key + '" data_ $ \\d ->'))))])(templateCode);
        }
        ;
        if (tree2 instanceof NestedJoin) {
          var templateCode = (function() {
            var v2 = head2(tree2.value0.joinData);
            if (v2 instanceof Just) {
              var innerData = tree2.value0.decompose(v2.value0);
              var v1 = head2(innerData);
              if (v1 instanceof Just) {
                var templateTree = tree2.value0.template(v1.value0);
                return treeLines(new Just(v1.value0))(templateTree)(indentLevel + 1 | 0);
              }
              ;
              if (v1 instanceof Nothing) {
                return [indent2(indentLevel + 1 | 0) + "-- (no inner data to evaluate template)"];
              }
              ;
              throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 84, column 14 - line 89, column 88): " + [v1.constructor.name]);
            }
            ;
            if (v2 instanceof Nothing) {
              return [indent2(indentLevel + 1 | 0) + "-- (no data to evaluate template)"];
            }
            ;
            throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 81, column 22 - line 91, column 78): " + [v2.constructor.name]);
          })();
          return append126([indent2(indentLevel) + ('T.nestedJoin "' + (tree2.value0.name + ('" "' + (tree2.value0.key + '" data_ decompose $ \\inner ->'))))])(templateCode);
        }
        ;
        if (tree2 instanceof SceneJoin) {
          var templateCode = (function() {
            var v2 = head2(tree2.value0.joinData);
            if (v2 instanceof Just) {
              var templateTree = tree2.value0.template(v2.value0);
              return treeLines(new Just(v2.value0))(templateTree)(indentLevel + 1 | 0);
            }
            ;
            if (v2 instanceof Nothing) {
              return [indent2(indentLevel + 1 | 0) + "-- (no data to evaluate template)"];
            }
            ;
            throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 103, column 22 - line 108, column 78): " + [v2.constructor.name]);
          })();
          var behaviors = (function() {
            var $76 = hasEnter(tree2.value0);
            if ($76) {
              return "enter ";
            }
            ;
            return "";
          })() + ((function() {
            var $77 = hasUpdate(tree2.value0);
            if ($77) {
              return "update ";
            }
            ;
            return "";
          })() + (function() {
            var $78 = hasExit(tree2.value0);
            if ($78) {
              return "exit";
            }
            ;
            return "";
          })());
          return append126([indent2(indentLevel) + ('T.sceneJoin "' + (tree2.value0.name + ('" "' + (tree2.value0.key + '" data_')))), indent2(indentLevel) + ("  -- behaviors: " + behaviors), indent2(indentLevel) + "  $ \\d ->"])(templateCode);
        }
        ;
        if (tree2 instanceof SceneNestedJoin) {
          return [indent2(indentLevel) + ('T.sceneNestedJoin "' + (tree2.value0.name + ('" "' + (tree2.value0.key + '" data_ decompose')))), indent2(indentLevel) + "  -- (scene nested join - template omitted)"];
        }
        ;
        throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 35, column 42 - line 118, column 6): " + [tree2.constructor.name]);
      };
    };
  };
  var childrenWithCommas = function(maybeSample) {
    return function(children3) {
      return function(ind) {
        var indexedChildren = function(cs) {
          return mapWithIndex3(function(i2) {
            return function(c2) {
              return {
                idx: i2,
                child: c2
              };
            };
          })(cs);
        };
        var dropFirst = function(arr) {
          var v2 = length3(arr);
          if (v2 === 0) {
            return [];
          }
          ;
          if (v2 === 1) {
            return [];
          }
          ;
          return drop(1)(arr);
        };
        var renderChild = function(v2) {
          return function(v1) {
            var prefix = (function() {
              var $84 = v1.idx === 0;
              if ($84) {
                return "  ";
              }
              ;
              return ", ";
            })();
            var childLines = treeLines(maybeSample)(v1.child)(0);
            var v22 = head2(childLines);
            if (v22 instanceof Just) {
              return append126([indent2(ind) + (prefix + v22.value0)])(map124(function(l2) {
                return indent2(ind + 1 | 0) + l2;
              })(dropFirst(childLines)));
            }
            ;
            if (v22 instanceof Nothing) {
              return [];
            }
            ;
            throw new Error("Failed pattern match at PSD3.Interpreter.SemiQuine.TreeToCode (line 142, column 8 - line 146, column 20): " + [v22.constructor.name]);
          };
        };
        return concat(zipWith2(renderChild)(replicate(length3(children3))(unit))(indexedChildren(children3)));
      };
    };
  };
  var treeToCodeWithSample = function(sample) {
    return function(tree2) {
      return joinWith("\n")(treeLines(new Just(sample))(tree2)(0));
    };
  };

  // output/PSD3.Interpreter.SemiQuine.Types/index.js
  var FromField = /* @__PURE__ */ (function() {
    function FromField2(value0) {
      this.value0 = value0;
    }
    ;
    FromField2.create = function(value0) {
      return new FromField2(value0);
    };
    return FromField2;
  })();
  var ConstantNumber = /* @__PURE__ */ (function() {
    function ConstantNumber2(value0) {
      this.value0 = value0;
    }
    ;
    ConstantNumber2.create = function(value0) {
      return new ConstantNumber2(value0);
    };
    return ConstantNumber2;
  })();
  var ConstantString = /* @__PURE__ */ (function() {
    function ConstantString2(value0) {
      this.value0 = value0;
    }
    ;
    ConstantString2.create = function(value0) {
      return new ConstantString2(value0);
    };
    return ConstantString2;
  })();
  var IndexBased = /* @__PURE__ */ (function() {
    function IndexBased2() {
    }
    ;
    IndexBased2.value = new IndexBased2();
    return IndexBased2;
  })();
  var Computed = /* @__PURE__ */ (function() {
    function Computed2(value0) {
      this.value0 = value0;
    }
    ;
    Computed2.create = function(value0) {
      return new Computed2(value0);
    };
    return Computed2;
  })();
  var BNode = /* @__PURE__ */ (function() {
    function BNode2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    BNode2.create = function(value0) {
      return function(value1) {
        return new BNode2(value0, value1);
      };
    };
    return BNode2;
  })();
  var BDataJoin = /* @__PURE__ */ (function() {
    function BDataJoin2(value0) {
      this.value0 = value0;
    }
    ;
    BDataJoin2.create = function(value0) {
      return new BDataJoin2(value0);
    };
    return BDataJoin2;
  })();
  var eqAttributeChoice = {
    eq: function(x32) {
      return function(y32) {
        if (x32 instanceof FromField && y32 instanceof FromField) {
          return x32.value0 === y32.value0;
        }
        ;
        if (x32 instanceof ConstantNumber && y32 instanceof ConstantNumber) {
          return x32.value0 === y32.value0;
        }
        ;
        if (x32 instanceof ConstantString && y32 instanceof ConstantString) {
          return x32.value0 === y32.value0;
        }
        ;
        if (x32 instanceof IndexBased && y32 instanceof IndexBased) {
          return true;
        }
        ;
        if (x32 instanceof Computed && y32 instanceof Computed) {
          return x32.value0 === y32.value0;
        }
        ;
        return false;
      };
    }
  };
  var defaultAttributesFor = function(v2) {
    if (v2 === "circle") {
      return [{
        attrName: "cx",
        choice: new FromField("x")
      }, {
        attrName: "cy",
        choice: new FromField("y")
      }, {
        attrName: "r",
        choice: new FromField("radius")
      }, {
        attrName: "fill",
        choice: new FromField("color")
      }];
    }
    ;
    if (v2 === "rect") {
      return [{
        attrName: "x",
        choice: new FromField("x")
      }, {
        attrName: "y",
        choice: new FromField("y")
      }, {
        attrName: "width",
        choice: new FromField("width")
      }, {
        attrName: "height",
        choice: new FromField("height")
      }, {
        attrName: "fill",
        choice: new FromField("color")
      }];
    }
    ;
    if (v2 === "text") {
      return [{
        attrName: "x",
        choice: new FromField("x")
      }, {
        attrName: "y",
        choice: new FromField("y")
      }, {
        attrName: "text",
        choice: new FromField("label")
      }, {
        attrName: "fill",
        choice: new ConstantString("#333")
      }];
    }
    ;
    if (v2 === "line") {
      return [{
        attrName: "x1",
        choice: new ConstantNumber(0)
      }, {
        attrName: "y1",
        choice: new ConstantNumber(0)
      }, {
        attrName: "x2",
        choice: new FromField("x")
      }, {
        attrName: "y2",
        choice: new FromField("y")
      }, {
        attrName: "stroke",
        choice: new FromField("color")
      }];
    }
    ;
    if (v2 === "group") {
      return [];
    }
    ;
    if (v2 === "svg") {
      return [{
        attrName: "width",
        choice: new ConstantNumber(400)
      }, {
        attrName: "height",
        choice: new ConstantNumber(300)
      }];
    }
    ;
    return [];
  };
  var emptyNode = function(nid) {
    return function(elemType) {
      return {
        id: nid,
        elementType: elemType,
        name: Nothing.value,
        attributes: defaultAttributesFor(elemType),
        expanded: true
      };
    };
  };

  // output/TreeBuilder.Interpreter/foreign.js
  var SVG_NS = "http://www.w3.org/2000/svg";
  var SVG_ELEMENTS = /* @__PURE__ */ new Set(["svg", "circle", "rect", "line", "path", "text", "g", "group"]);
  var renderPreviewFFI = (containerSelector) => (instructions) => () => {
    const container = select_default2(containerSelector);
    container.selectAll("*").remove();
    instructions.forEach((instr) => {
      renderInstruction(container.node(), instr);
    });
  };
  function renderInstruction(parent2, instruction) {
    const elemType = normalizeElementType(instruction.elemType);
    let elem11;
    if (SVG_ELEMENTS.has(elemType)) {
      elem11 = document.createElementNS(SVG_NS, elemType);
    } else {
      elem11 = document.createElement(elemType);
    }
    instruction.attrs.forEach((attr46) => {
      if (attr46.name === "text") {
        elem11.textContent = attr46.value;
      } else {
        elem11.setAttribute(attr46.name, attr46.value);
      }
    });
    parent2.appendChild(elem11);
    instruction.children.forEach((child) => {
      renderInstruction(elem11, child);
    });
    return elem11;
  }
  function normalizeElementType(type2) {
    switch (type2) {
      case "group":
        return "g";
      default:
        return type2;
    }
  }

  // output/TreeBuilder.Interpreter/index.js
  var show83 = /* @__PURE__ */ show(showNumber);
  var show137 = /* @__PURE__ */ show(showInt);
  var bind94 = /* @__PURE__ */ bind(bindMaybe);
  var map125 = /* @__PURE__ */ map(functorArray);
  var getNumericField = function(field4) {
    return function(datum2) {
      if (field4 === "x") {
        return datum2.x;
      }
      ;
      if (field4 === "y") {
        return datum2.y;
      }
      ;
      if (field4 === "cx") {
        return datum2.cx;
      }
      ;
      if (field4 === "cy") {
        return datum2.cy;
      }
      ;
      if (field4 === "rx") {
        return datum2.rx;
      }
      ;
      if (field4 === "ry") {
        return datum2.ry;
      }
      ;
      if (field4 === "sx") {
        return datum2.sx;
      }
      ;
      if (field4 === "sy") {
        return datum2.sy;
      }
      ;
      if (field4 === "radius") {
        return datum2.radius;
      }
      ;
      if (field4 === "width") {
        return datum2.width;
      }
      ;
      if (field4 === "height") {
        return datum2.height;
      }
      ;
      if (field4 === "value") {
        return datum2.value;
      }
      ;
      if (field4 === "index") {
        return toNumber(datum2.index);
      }
      ;
      return 0;
    };
  };
  var getFieldValue = function(field4) {
    return function(datum2) {
      if (field4 === "x") {
        return show83(datum2.x);
      }
      ;
      if (field4 === "y") {
        return show83(datum2.y);
      }
      ;
      if (field4 === "cx") {
        return show83(datum2.cx);
      }
      ;
      if (field4 === "cy") {
        return show83(datum2.cy);
      }
      ;
      if (field4 === "rx") {
        return show83(datum2.rx);
      }
      ;
      if (field4 === "ry") {
        return show83(datum2.ry);
      }
      ;
      if (field4 === "sx") {
        return show83(datum2.sx);
      }
      ;
      if (field4 === "sy") {
        return show83(datum2.sy);
      }
      ;
      if (field4 === "radius") {
        return show83(datum2.radius);
      }
      ;
      if (field4 === "width") {
        return show83(datum2.width);
      }
      ;
      if (field4 === "height") {
        return show83(datum2.height);
      }
      ;
      if (field4 === "color") {
        return datum2.color;
      }
      ;
      if (field4 === "label") {
        return datum2.label;
      }
      ;
      if (field4 === "name") {
        return datum2.name;
      }
      ;
      if (field4 === "value") {
        return show83(datum2.value);
      }
      ;
      if (field4 === "index") {
        return show137(datum2.index);
      }
      ;
      return "";
    };
  };
  var evalSimpleExpr = function(expr) {
    return function(datum2) {
      var parseSubExpr2 = function(s3) {
        var parts = split(" - ")(s3);
        var v6 = length3(parts);
        if (v6 === 2) {
          return bind94(head2(parts))(function(fieldPart) {
            return bind94(last(parts))(function(offsetPart) {
              return bind94(stripPrefix("d.")(fieldPart))(function(field4) {
                return bind94(fromString(offsetPart))(function(offset) {
                  return new Just({
                    field: field4,
                    offset
                  });
                });
              });
            });
          });
        }
        ;
        return Nothing.value;
      };
      var parseMulExpr2 = function(s3) {
        var parts = split(" * ")(s3);
        var v6 = length3(parts);
        if (v6 === 2) {
          return bind94(head2(parts))(function(part1) {
            return bind94(last(parts))(function(part2) {
              return bind94(stripPrefix("d.")(part1))(function(field1) {
                var v12 = fromString(part2);
                if (v12 instanceof Just) {
                  return new Just(getNumericField(field1)(datum2) * v12.value0);
                }
                ;
                if (v12 instanceof Nothing) {
                  return bind94(stripPrefix("d.")(part2))(function(field22) {
                    return new Just(getNumericField(field1)(datum2) * getNumericField(field22)(datum2));
                  });
                }
                ;
                throw new Error("Failed pattern match at TreeBuilder.Interpreter (line 210, column 9 - line 215, column 79): " + [v12.constructor.name]);
              });
            });
          });
        }
        ;
        return Nothing.value;
      };
      var parseFieldRef2 = function(s3) {
        return stripPrefix("d.")(s3);
      };
      var parseFieldAddField = function(s3) {
        var parts = split(" + ")(s3);
        var v6 = length3(parts);
        if (v6 === 2) {
          return bind94(head2(parts))(function(part1) {
            return bind94(last(parts))(function(part2) {
              return bind94(stripPrefix("d.")(part1))(function(field1) {
                return bind94(stripPrefix("d.")(part2))(function(field22) {
                  return new Just({
                    field1,
                    field2: field22
                  });
                });
              });
            });
          });
        }
        ;
        return Nothing.value;
      };
      var parseDivExpr2 = function(s3) {
        var parts = split(" / ")(s3);
        var v6 = length3(parts);
        if (v6 === 2) {
          return bind94(head2(parts))(function(fieldPart) {
            return bind94(last(parts))(function(divisorPart) {
              return bind94(stripPrefix("d.")(fieldPart))(function(field4) {
                return bind94(fromString(divisorPart))(function(divisor) {
                  return new Just({
                    field: field4,
                    divisor
                  });
                });
              });
            });
          });
        }
        ;
        return Nothing.value;
      };
      var parseAddExpr2 = function(s3) {
        var parts = split(" + ")(s3);
        var v6 = length3(parts);
        if (v6 === 2) {
          return bind94(head2(parts))(function(fieldPart) {
            return bind94(last(parts))(function(offsetPart) {
              return bind94(stripPrefix("d.")(fieldPart))(function(field4) {
                return bind94(fromString(offsetPart))(function(offset) {
                  return new Just({
                    field: field4,
                    offset
                  });
                });
              });
            });
          });
        }
        ;
        return Nothing.value;
      };
      var v2 = parseFieldAddField(expr);
      if (v2 instanceof Just) {
        return show83(getNumericField(v2.value0.field1)(datum2) + getNumericField(v2.value0.field2)(datum2));
      }
      ;
      if (v2 instanceof Nothing) {
        var v1 = parseAddExpr2(expr);
        if (v1 instanceof Just) {
          return show83(getNumericField(v1.value0.field)(datum2) + v1.value0.offset);
        }
        ;
        if (v1 instanceof Nothing) {
          var v22 = parseSubExpr2(expr);
          if (v22 instanceof Just) {
            return show83(getNumericField(v22.value0.field)(datum2) - v22.value0.offset);
          }
          ;
          if (v22 instanceof Nothing) {
            var v3 = parseMulExpr2(expr);
            if (v3 instanceof Just) {
              return show83(v3.value0);
            }
            ;
            if (v3 instanceof Nothing) {
              var v4 = parseDivExpr2(expr);
              if (v4 instanceof Just) {
                return show83(getNumericField(v4.value0.field)(datum2) / v4.value0.divisor);
              }
              ;
              if (v4 instanceof Nothing) {
                var v5 = parseFieldRef2(expr);
                if (v5 instanceof Just) {
                  return getFieldValue(v5.value0)(datum2);
                }
                ;
                if (v5 instanceof Nothing) {
                  return expr;
                }
                ;
                throw new Error("Failed pattern match at TreeBuilder.Interpreter (line 157, column 23 - line 159, column 40): " + [v5.constructor.name]);
              }
              ;
              throw new Error("Failed pattern match at TreeBuilder.Interpreter (line 152, column 19 - line 159, column 40): " + [v4.constructor.name]);
            }
            ;
            throw new Error("Failed pattern match at TreeBuilder.Interpreter (line 148, column 15 - line 159, column 40): " + [v3.constructor.name]);
          }
          ;
          throw new Error("Failed pattern match at TreeBuilder.Interpreter (line 143, column 11 - line 159, column 40): " + [v22.constructor.name]);
        }
        ;
        throw new Error("Failed pattern match at TreeBuilder.Interpreter (line 138, column 7 - line 159, column 40): " + [v1.constructor.name]);
      }
      ;
      throw new Error("Failed pattern match at TreeBuilder.Interpreter (line 133, column 3 - line 159, column 40): " + [v2.constructor.name]);
    };
  };
  var resolveAttributeChoice = function(choice) {
    return function(datum2) {
      if (choice instanceof FromField) {
        return getFieldValue(choice.value0)(datum2);
      }
      ;
      if (choice instanceof ConstantNumber) {
        return show83(choice.value0);
      }
      ;
      if (choice instanceof ConstantString) {
        return choice.value0;
      }
      ;
      if (choice instanceof IndexBased) {
        return show137(datum2.index);
      }
      ;
      if (choice instanceof Computed) {
        return evalSimpleExpr(choice.value0)(datum2);
      }
      ;
      throw new Error("Failed pattern match at TreeBuilder.Interpreter (line 78, column 39 - line 83, column 45): " + [choice.constructor.name]);
    };
  };
  var defaultDatum = {
    x: 0,
    y: 0,
    cx: 25,
    cy: 21,
    rx: 0,
    ry: 0,
    sx: 0,
    sy: 0,
    radius: 10,
    width: 50,
    height: 30,
    color: "#999",
    label: "",
    name: "",
    value: 0,
    index: 0
  };
  var bindingToAttr = function(datum2) {
    return function(binding) {
      return {
        name: binding.attrName,
        value: resolveAttributeChoice(binding.choice)(datum2)
      };
    };
  };
  var nodeToInstruction = function(node) {
    return function(datum2) {
      return function(children3) {
        return {
          elemType: node.elementType,
          attrs: map125(bindingToAttr(datum2))(node.attributes),
          children: children3
        };
      };
    };
  };
  var treeToInstructions = function(tree2) {
    return function(sampleData2) {
      if (tree2 instanceof BNode) {
        var datum2 = fromMaybe(defaultDatum)(head2(sampleData2));
        var childInstructions = concat(map125(function(c2) {
          return treeToInstructions(c2)(sampleData2);
        })(tree2.value1));
        return [nodeToInstruction(tree2.value0)(datum2)(childInstructions)];
      }
      ;
      if (tree2 instanceof BDataJoin) {
        return map125(function(d) {
          return nodeToInstruction(tree2.value0.template)(d)([]);
        })(sampleData2);
      }
      ;
      throw new Error("Failed pattern match at TreeBuilder.Interpreter (line 49, column 38 - line 58, column 64): " + [tree2.constructor.name]);
    };
  };
  var renderPreview = function(containerSelector) {
    return function(tree2) {
      return function(sampleData2) {
        var instructions = treeToInstructions(tree2)(sampleData2);
        return renderPreviewFFI(containerSelector)(instructions);
      };
    };
  };

  // output/TreeBuilder.ToTree/index.js
  var bind95 = /* @__PURE__ */ bind(bindMaybe);
  var map126 = /* @__PURE__ */ map(functorArray);
  var parseElementType = function(v2) {
    if (v2 === "svg") {
      return SVG.value;
    }
    ;
    if (v2 === "group") {
      return Group.value;
    }
    ;
    if (v2 === "g") {
      return Group.value;
    }
    ;
    if (v2 === "circle") {
      return Circle.value;
    }
    ;
    if (v2 === "rect") {
      return Rect.value;
    }
    ;
    if (v2 === "line") {
      return Line.value;
    }
    ;
    if (v2 === "path") {
      return Path.value;
    }
    ;
    if (v2 === "text") {
      return Text.value;
    }
    ;
    if (v2 === "defs") {
      return Defs.value;
    }
    ;
    if (v2 === "div") {
      return Div.value;
    }
    ;
    if (v2 === "span") {
      return Span.value;
    }
    ;
    if (v2 === "table") {
      return Table.value;
    }
    ;
    if (v2 === "tbody") {
      return Tbody.value;
    }
    ;
    if (v2 === "thead") {
      return Thead.value;
    }
    ;
    if (v2 === "tr") {
      return Tr.value;
    }
    ;
    if (v2 === "td") {
      return Td.value;
    }
    ;
    if (v2 === "th") {
      return Th.value;
    }
    ;
    return Group.value;
  };
  var getNumericField2 = function(field4) {
    return function(datum2) {
      if (field4 === "x") {
        return datum2.x;
      }
      ;
      if (field4 === "y") {
        return datum2.y;
      }
      ;
      if (field4 === "cx") {
        return datum2.cx;
      }
      ;
      if (field4 === "cy") {
        return datum2.cy;
      }
      ;
      if (field4 === "rx") {
        return datum2.rx;
      }
      ;
      if (field4 === "ry") {
        return datum2.ry;
      }
      ;
      if (field4 === "sx") {
        return datum2.sx;
      }
      ;
      if (field4 === "sy") {
        return datum2.sy;
      }
      ;
      if (field4 === "radius") {
        return datum2.radius;
      }
      ;
      if (field4 === "width") {
        return datum2.width;
      }
      ;
      if (field4 === "height") {
        return datum2.height;
      }
      ;
      if (field4 === "value") {
        return datum2.value;
      }
      ;
      if (field4 === "index") {
        return toNumber(datum2.index);
      }
      ;
      return 0;
    };
  };
  var parseAddExpr = function(s3) {
    return function(datum2) {
      var parts = split(" + ")(s3);
      var v2 = length3(parts);
      if (v2 === 2) {
        return bind95(head2(parts))(function(part1) {
          return bind95(last(parts))(function(part2) {
            return bind95(stripPrefix("d.")(part1))(function(field1) {
              var v1 = fromString(part2);
              if (v1 instanceof Just) {
                return new Just(getNumericField2(field1)(datum2) + v1.value0);
              }
              ;
              if (v1 instanceof Nothing) {
                return bind95(stripPrefix("d.")(part2))(function(field22) {
                  return new Just(getNumericField2(field1)(datum2) + getNumericField2(field22)(datum2));
                });
              }
              ;
              throw new Error("Failed pattern match at TreeBuilder.ToTree (line 182, column 7 - line 187, column 77): " + [v1.constructor.name]);
            });
          });
        });
      }
      ;
      return Nothing.value;
    };
  };
  var parseDivExpr = function(s3) {
    return function(datum2) {
      var parts = split(" / ")(s3);
      var v2 = length3(parts);
      if (v2 === 2) {
        return bind95(head2(parts))(function(part1) {
          return bind95(last(parts))(function(part2) {
            return bind95(stripPrefix("d.")(part1))(function(field1) {
              return bind95(fromString(part2))(function(n) {
                return new Just(getNumericField2(field1)(datum2) / n);
              });
            });
          });
        });
      }
      ;
      return Nothing.value;
    };
  };
  var parseMulExpr = function(s3) {
    return function(datum2) {
      var parts = split(" * ")(s3);
      var v2 = length3(parts);
      if (v2 === 2) {
        return bind95(head2(parts))(function(part1) {
          return bind95(last(parts))(function(part2) {
            return bind95(stripPrefix("d.")(part1))(function(field1) {
              var v1 = fromString(part2);
              if (v1 instanceof Just) {
                return new Just(getNumericField2(field1)(datum2) * v1.value0);
              }
              ;
              if (v1 instanceof Nothing) {
                return bind95(stripPrefix("d.")(part2))(function(field22) {
                  return new Just(getNumericField2(field1)(datum2) * getNumericField2(field22)(datum2));
                });
              }
              ;
              throw new Error("Failed pattern match at TreeBuilder.ToTree (line 212, column 7 - line 216, column 77): " + [v1.constructor.name]);
            });
          });
        });
      }
      ;
      return Nothing.value;
    };
  };
  var parseSubExpr = function(s3) {
    return function(datum2) {
      var parts = split(" - ")(s3);
      var v2 = length3(parts);
      if (v2 === 2) {
        return bind95(head2(parts))(function(part1) {
          return bind95(last(parts))(function(part2) {
            return bind95(stripPrefix("d.")(part1))(function(field1) {
              return bind95(fromString(part2))(function(n) {
                return new Just(getNumericField2(field1)(datum2) - n);
              });
            });
          });
        });
      }
      ;
      return Nothing.value;
    };
  };
  var getFieldValue2 = function(field4) {
    return function(datum2) {
      if (field4 === "x") {
        return new NumberValue(datum2.x);
      }
      ;
      if (field4 === "y") {
        return new NumberValue(datum2.y);
      }
      ;
      if (field4 === "cx") {
        return new NumberValue(datum2.cx);
      }
      ;
      if (field4 === "cy") {
        return new NumberValue(datum2.cy);
      }
      ;
      if (field4 === "rx") {
        return new NumberValue(datum2.rx);
      }
      ;
      if (field4 === "ry") {
        return new NumberValue(datum2.ry);
      }
      ;
      if (field4 === "sx") {
        return new NumberValue(datum2.sx);
      }
      ;
      if (field4 === "sy") {
        return new NumberValue(datum2.sy);
      }
      ;
      if (field4 === "radius") {
        return new NumberValue(datum2.radius);
      }
      ;
      if (field4 === "width") {
        return new NumberValue(datum2.width);
      }
      ;
      if (field4 === "height") {
        return new NumberValue(datum2.height);
      }
      ;
      if (field4 === "value") {
        return new NumberValue(datum2.value);
      }
      ;
      if (field4 === "index") {
        return new NumberValue(toNumber(datum2.index));
      }
      ;
      if (field4 === "color") {
        return new StringValue(datum2.color);
      }
      ;
      if (field4 === "label") {
        return new StringValue(datum2.label);
      }
      ;
      if (field4 === "name") {
        return new StringValue(datum2.name);
      }
      ;
      return new StringValue("");
    };
  };
  var parseFieldRef = function(s3) {
    return function(datum2) {
      return bind95(stripPrefix("d.")(s3))(function(field4) {
        return new Just(getFieldValue2(field4)(datum2));
      });
    };
  };
  var evalComputedExpr = function(expr) {
    return function(datum2) {
      var v2 = parseAddExpr(expr)(datum2);
      if (v2 instanceof Just) {
        return new NumberValue(v2.value0);
      }
      ;
      if (v2 instanceof Nothing) {
        var v1 = parseSubExpr(expr)(datum2);
        if (v1 instanceof Just) {
          return new NumberValue(v1.value0);
        }
        ;
        if (v1 instanceof Nothing) {
          var v22 = parseMulExpr(expr)(datum2);
          if (v22 instanceof Just) {
            return new NumberValue(v22.value0);
          }
          ;
          if (v22 instanceof Nothing) {
            var v3 = parseDivExpr(expr)(datum2);
            if (v3 instanceof Just) {
              return new NumberValue(v3.value0);
            }
            ;
            if (v3 instanceof Nothing) {
              var v4 = parseFieldRef(expr)(datum2);
              if (v4 instanceof Just) {
                return v4.value0;
              }
              ;
              if (v4 instanceof Nothing) {
                return new StringValue(expr);
              }
              ;
              throw new Error("Failed pattern match at TreeBuilder.ToTree (line 168, column 22 - line 170, column 40): " + [v4.constructor.name]);
            }
            ;
            throw new Error("Failed pattern match at TreeBuilder.ToTree (line 166, column 20 - line 170, column 40): " + [v3.constructor.name]);
          }
          ;
          throw new Error("Failed pattern match at TreeBuilder.ToTree (line 164, column 18 - line 170, column 40): " + [v22.constructor.name]);
        }
        ;
        throw new Error("Failed pattern match at TreeBuilder.ToTree (line 162, column 16 - line 170, column 40): " + [v1.constructor.name]);
      }
      ;
      throw new Error("Failed pattern match at TreeBuilder.ToTree (line 160, column 3 - line 170, column 40): " + [v2.constructor.name]);
    };
  };
  var choiceToAttribute = function(name16) {
    return function(choice) {
      if (choice instanceof ConstantNumber) {
        return new StaticAttr(name16, new NumberValue(choice.value0));
      }
      ;
      if (choice instanceof ConstantString) {
        return new StaticAttr(name16, new StringValue(choice.value0));
      }
      ;
      if (choice instanceof FromField) {
        return new DataAttr(name16, new FieldSource(choice.value0), getFieldValue2(choice.value0));
      }
      ;
      if (choice instanceof IndexBased) {
        return new IndexedAttr(name16, IndexSource.value, function(v2) {
          return function(idx) {
            return new NumberValue(toNumber(idx));
          };
        });
      }
      ;
      if (choice instanceof Computed) {
        return new DataAttr(name16, new ExprSource(choice.value0), evalComputedExpr(choice.value0));
      }
      ;
      throw new Error("Failed pattern match at TreeBuilder.ToTree (line 90, column 33 - line 107, column 60): " + [choice.constructor.name]);
    };
  };
  var bindingToAttribute = function(binding) {
    return choiceToAttribute(binding.attrName)(binding.choice);
  };
  var builderToTreeWithData = function(tree2) {
    return function(sampleData2) {
      if (tree2 instanceof BNode) {
        return new Node2({
          name: tree2.value0.name,
          elemType: parseElementType(tree2.value0.elementType),
          attrs: map126(bindingToAttribute)(tree2.value0.attributes),
          behaviors: [],
          children: map126(function(c2) {
            return builderToTreeWithData(c2)(sampleData2);
          })(tree2.value1)
        });
      }
      ;
      if (tree2 instanceof BDataJoin) {
        return new Join({
          name: tree2.value0.name,
          key: tree2.value0.elementType,
          joinData: sampleData2,
          template: function(v2) {
            return new Node2({
              name: Nothing.value,
              elemType: parseElementType(tree2.value0.template.elementType),
              attrs: map126(bindingToAttribute)(tree2.value0.template.attributes),
              behaviors: [],
              children: []
            });
          }
        });
      }
      ;
      throw new Error("Failed pattern match at TreeBuilder.ToTree (line 36, column 41 - line 59, column 8): " + [tree2.constructor.name]);
    };
  };

  // output/TreeBuilder.Types/index.js
  var div7 = /* @__PURE__ */ div(euclideanRingInt);
  var mod13 = /* @__PURE__ */ mod(euclideanRingInt);
  var show84 = /* @__PURE__ */ show(showInt);
  var bind96 = /* @__PURE__ */ bind(bindArray);
  var pure104 = /* @__PURE__ */ pure(applicativeArray);
  var elem8 = /* @__PURE__ */ elem2(eqString);
  var sudokuSampleData = /* @__PURE__ */ (function() {
    var boxColor = function(row) {
      return function(col2) {
        var boxRow = div7(row)(3);
        var boxCol = div7(col2)(3);
        var isLightBox = mod13(boxRow + boxCol | 0)(2) === 0;
        if (isLightBox) {
          return "#f5f2e8";
        }
        ;
        return "#e8e0cc";
      };
    };
    var mkCell = function(row) {
      return function(col2) {
        return function(val) {
          var stripY = 150 / 2;
          var ringRadius = 30 + toNumber(row) * ((140 - 30) / toNumber(9 - 1 | 0));
          var idx = (row * 9 | 0) + col2 | 0;
          var stripX = 10 + toNumber(idx) * 3.2;
          var gy = 10 + toNumber(row) * (28 + 2);
          var gx = 10 + toNumber(col2) * (28 + 2);
          var centerY = gy + 28 * 0.7;
          var centerX = gx + 28 / 2;
          var angle = toNumber(col2) * (2 * 3.14159 / toNumber(9)) - 3.14159 / 2;
          var radX = 150 + ringRadius * cos(angle);
          var radY = 150 + ringRadius * sin(angle);
          return {
            x: gx,
            y: gy,
            cx: centerX,
            cy: centerY,
            rx: radX,
            ry: radY,
            sx: stripX,
            sy: stripY,
            radius: 10,
            width: 28,
            height: 28,
            color: boxColor(row)(col2),
            label: (function() {
              var $20 = val === 0;
              if ($20) {
                return "";
              }
              ;
              return show84(val);
            })(),
            name: "cell",
            value: toNumber(val),
            index: idx
          };
        };
      };
    };
    var sudokuRow = function(row) {
      return function(vals) {
        return mapWithIndex3(mkCell(row))(vals);
      };
    };
    return concat([sudokuRow(0)([5, 3, 0, 0, 7, 0, 0, 0, 0]), sudokuRow(1)([6, 0, 0, 1, 9, 5, 0, 0, 0]), sudokuRow(2)([0, 9, 8, 0, 0, 0, 0, 6, 0]), sudokuRow(3)([8, 0, 0, 0, 6, 0, 0, 0, 3]), sudokuRow(4)([4, 0, 0, 8, 0, 3, 0, 0, 1]), sudokuRow(5)([7, 0, 0, 0, 2, 0, 0, 0, 6]), sudokuRow(6)([0, 6, 0, 0, 0, 0, 2, 8, 0]), sudokuRow(7)([0, 0, 0, 4, 1, 9, 0, 0, 5]), sudokuRow(8)([0, 0, 0, 0, 8, 0, 0, 7, 9])]);
  })();
  var goSampleData = /* @__PURE__ */ (function() {
    var stones = [{
      r: 3,
      c: 3,
      stone: "\u25CF"
    }, {
      r: 3,
      c: 15,
      stone: "\u25CB"
    }, {
      r: 15,
      c: 15,
      stone: "\u25CF"
    }, {
      r: 15,
      c: 3,
      stone: "\u25CB"
    }, {
      r: 9,
      c: 9,
      stone: "\u25CF"
    }, {
      r: 3,
      c: 9,
      stone: "\u25CB"
    }, {
      r: 9,
      c: 3,
      stone: "\u25CF"
    }, {
      r: 9,
      c: 15,
      stone: "\u25CB"
    }, {
      r: 15,
      c: 9,
      stone: "\u25CF"
    }];
    var isStarPoint = function(r29) {
      return function(c2) {
        return (r29 === 3 || (r29 === 9 || r29 === 15)) && (c2 === 3 || (c2 === 9 || c2 === 15));
      };
    };
    var getStone = function(r29) {
      return function(c2) {
        var v2 = find2(function(s3) {
          return s3.r === r29 && s3.c === c2;
        })(stones);
        if (v2 instanceof Just) {
          return v2.value0.stone;
        }
        ;
        if (v2 instanceof Nothing) {
          return "";
        }
        ;
        throw new Error("Failed pattern match at TreeBuilder.Types (line 284, column 18 - line 286, column 18): " + [v2.constructor.name]);
      };
    };
    var mkCell = function(row) {
      return function(col2) {
        var stripY = 150 / 2;
        var stone = getStone(row)(col2);
        var ringRadius = 15 + toNumber(row) * ((140 - 15) / toNumber(19 - 1 | 0));
        var idx = (row * 19 | 0) + col2 | 0;
        var stripX = 10 + toNumber(idx) * 0.75;
        var gy = 10 + toNumber(row) * 14;
        var gx = 10 + toNumber(col2) * 14;
        var centerY = gy + 14 * 0.7;
        var centerX = gx + 14 / 2;
        var angle = toNumber(col2) * (2 * 3.14159 / toNumber(19)) - 3.14159 / 2;
        var radX = 150 + ringRadius * cos(angle);
        var radY = 150 + ringRadius * sin(angle);
        return {
          x: gx,
          y: gy,
          cx: centerX,
          cy: centerY,
          rx: radX,
          ry: radY,
          sx: stripX,
          sy: stripY,
          radius: 5,
          width: 14,
          height: 14,
          color: "#DEB887",
          label: stone,
          name: (function() {
            var $23 = stone === "";
            if ($23) {
              var $24 = isStarPoint(row)(col2);
              if ($24) {
                return "star";
              }
              ;
              return "empty";
            }
            ;
            return "stone";
          })(),
          value: toNumber((function() {
            var $25 = stone === "\u25CF";
            if ($25) {
              return 1;
            }
            ;
            var $26 = stone === "\u25CB";
            if ($26) {
              return 2;
            }
            ;
            return 0;
          })()),
          index: idx
        };
      };
    };
    return bind96(range2(0)(18))(function(row) {
      return bind96(range2(0)(18))(function(col2) {
        return pure104(mkCell(row)(col2));
      });
    });
  })();
  var chessSampleData = /* @__PURE__ */ (function() {
    var squareColor = function(row) {
      return function(col2) {
        var $27 = mod13(row + col2 | 0)(2) === 0;
        if ($27) {
          return "#f0d9b5";
        }
        ;
        return "#b58863";
      };
    };
    var mkCell = function(row) {
      return function(col2) {
        return function(piece) {
          var stripY = 150 / 2;
          var ringRadius = 25 + toNumber(row) * ((140 - 25) / toNumber(8 - 1 | 0));
          var idx = (row * 8 | 0) + col2 | 0;
          var stripX = 10 + toNumber(idx) * 4;
          var gy = 10 + toNumber(row) * 36;
          var gx = 10 + toNumber(col2) * 36;
          var centerY = gy + 36 * 0.75;
          var centerX = gx + 36 / 2;
          var angle = toNumber(col2) * (2 * 3.14159 / toNumber(8)) - 3.14159 / 2;
          var radX = 150 + ringRadius * cos(angle);
          var radY = 150 + ringRadius * sin(angle);
          return {
            x: gx,
            y: gy,
            cx: centerX,
            cy: centerY,
            rx: radX,
            ry: radY,
            sx: stripX,
            sy: stripY,
            radius: 12,
            width: 36,
            height: 36,
            color: squareColor(row)(col2),
            label: piece,
            name: (function() {
              var $28 = piece === "";
              if ($28) {
                return "empty";
              }
              ;
              return "piece";
            })(),
            value: toNumber((function() {
              var $29 = piece === "";
              if ($29) {
                return 0;
              }
              ;
              return 1;
            })()),
            index: idx
          };
        };
      };
    };
    var chessRow = function(row) {
      return function(pieces) {
        return mapWithIndex3(mkCell(row))(pieces);
      };
    };
    return concat([chessRow(0)(["\u265C", "\u265E", "\u265D", "\u265B", "\u265A", "\u265D", "\u265E", "\u265C"]), chessRow(1)(["\u265F", "\u265F", "\u265F", "\u265F", "\u265F", "\u265F", "\u265F", "\u265F"]), chessRow(2)(["", "", "", "", "", "", "", ""]), chessRow(3)(["", "", "", "", "", "", "", ""]), chessRow(4)(["", "", "", "", "", "", "", ""]), chessRow(5)(["", "", "", "", "", "", "", ""]), chessRow(6)(["\u2659", "\u2659", "\u2659", "\u2659", "\u2659", "\u2659", "\u2659", "\u2659"]), chessRow(7)(["\u2656", "\u2658", "\u2657", "\u2655", "\u2654", "\u2657", "\u2658", "\u2656"])]);
  })();
  var availableElements = [{
    id: "svg",
    label: "SVG",
    category: "Container",
    description: "Root SVG container"
  }, {
    id: "group",
    label: "Group",
    category: "Container",
    description: "Group element (g) for nesting"
  }, {
    id: "circle",
    label: "Circle",
    category: "Shape",
    description: "Circle with cx, cy, r"
  }, {
    id: "rect",
    label: "Rect",
    category: "Shape",
    description: "Rectangle with x, y, width, height"
  }, {
    id: "line",
    label: "Line",
    category: "Shape",
    description: "Line from x1,y1 to x2,y2"
  }, {
    id: "text",
    label: "Text",
    category: "Text",
    description: "Text element with x, y position"
  }];
  var availableAttributes = [{
    name: "cx",
    label: "Center X",
    valueType: "number",
    description: "Circle center X coordinate"
  }, {
    name: "cy",
    label: "Center Y",
    valueType: "number",
    description: "Circle center Y coordinate"
  }, {
    name: "x",
    label: "X",
    valueType: "number",
    description: "X coordinate"
  }, {
    name: "y",
    label: "Y",
    valueType: "number",
    description: "Y coordinate"
  }, {
    name: "x1",
    label: "X1",
    valueType: "number",
    description: "Line start X"
  }, {
    name: "y1",
    label: "Y1",
    valueType: "number",
    description: "Line start Y"
  }, {
    name: "x2",
    label: "X2",
    valueType: "number",
    description: "Line end X"
  }, {
    name: "y2",
    label: "Y2",
    valueType: "number",
    description: "Line end Y"
  }, {
    name: "r",
    label: "Radius",
    valueType: "number",
    description: "Circle radius"
  }, {
    name: "width",
    label: "Width",
    valueType: "number",
    description: "Element width"
  }, {
    name: "height",
    label: "Height",
    valueType: "number",
    description: "Element height"
  }, {
    name: "fill",
    label: "Fill",
    valueType: "color",
    description: "Fill color"
  }, {
    name: "stroke",
    label: "Stroke",
    valueType: "color",
    description: "Stroke color"
  }, {
    name: "stroke-width",
    label: "Stroke Width",
    valueType: "number",
    description: "Stroke thickness"
  }, {
    name: "opacity",
    label: "Opacity",
    valueType: "number",
    description: "Transparency (0-1)"
  }, {
    name: "text",
    label: "Text Content",
    valueType: "string",
    description: "Text to display"
  }, {
    name: "font-size",
    label: "Font Size",
    valueType: "number",
    description: "Text size in pixels"
  }];
  var attributeOptionsFor = function(v2) {
    if (v2 === "circle") {
      return filter(function(a3) {
        return elem8(a3.name)(["cx", "cy", "r", "fill", "stroke", "stroke-width", "opacity"]);
      })(availableAttributes);
    }
    ;
    if (v2 === "rect") {
      return filter(function(a3) {
        return elem8(a3.name)(["x", "y", "width", "height", "fill", "stroke", "stroke-width", "opacity"]);
      })(availableAttributes);
    }
    ;
    if (v2 === "line") {
      return filter(function(a3) {
        return elem8(a3.name)(["x1", "y1", "x2", "y2", "stroke", "stroke-width", "opacity"]);
      })(availableAttributes);
    }
    ;
    if (v2 === "text") {
      return filter(function(a3) {
        return elem8(a3.name)(["x", "y", "text", "fill", "font-size", "opacity"]);
      })(availableAttributes);
    }
    ;
    if (v2 === "group") {
      return filter(function(a3) {
        return elem8(a3.name)(["opacity"]);
      })(availableAttributes);
    }
    ;
    if (v2 === "svg") {
      return filter(function(a3) {
        return elem8(a3.name)(["width", "height"]);
      })(availableAttributes);
    }
    ;
    return availableAttributes;
  };

  // output/TreeBuilder.App/index.js
  var map127 = /* @__PURE__ */ map(functorArray);
  var append41 = /* @__PURE__ */ append(semigroupArray);
  var eq26 = /* @__PURE__ */ eq(eqAttributeChoice);
  var elem9 = /* @__PURE__ */ elem2(eqString);
  var eq33 = /* @__PURE__ */ eq(/* @__PURE__ */ eqMaybe(eqInt));
  var show85 = /* @__PURE__ */ show(showNumber);
  var show138 = /* @__PURE__ */ show(showInt);
  var intercalate8 = /* @__PURE__ */ intercalate2(monoidString);
  var v3Attr19 = /* @__PURE__ */ v3Attr(showNumber);
  var lit20 = /* @__PURE__ */ lit(numExprEvalD);
  var str21 = /* @__PURE__ */ str(stringExprEvalD);
  var discard69 = /* @__PURE__ */ discard(discardUnit)(bindHalogenM);
  var bind97 = /* @__PURE__ */ bind(bindHalogenM);
  var get20 = /* @__PURE__ */ get(monadStateHalogenM);
  var modify_20 = /* @__PURE__ */ modify_(monadStateHalogenM);
  var map128 = /* @__PURE__ */ map(functorMaybe);
  var join6 = /* @__PURE__ */ join(bindMaybe);
  var when13 = /* @__PURE__ */ when(applicativeHalogenM);
  var pure105 = /* @__PURE__ */ pure(applicativeHalogenM);
  var bind140 = /* @__PURE__ */ bind(bindD3v2M);
  var select51 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var renderTree73 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(ordUnit);
  var pure126 = /* @__PURE__ */ pure(applicativeD3v2M);
  var Initialize49 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var AddRootElement = /* @__PURE__ */ (function() {
    function AddRootElement2(value0) {
      this.value0 = value0;
    }
    ;
    AddRootElement2.create = function(value0) {
      return new AddRootElement2(value0);
    };
    return AddRootElement2;
  })();
  var AddChildElement = /* @__PURE__ */ (function() {
    function AddChildElement2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    AddChildElement2.create = function(value0) {
      return function(value1) {
        return new AddChildElement2(value0, value1);
      };
    };
    return AddChildElement2;
  })();
  var SelectNode = /* @__PURE__ */ (function() {
    function SelectNode2(value0) {
      this.value0 = value0;
    }
    ;
    SelectNode2.create = function(value0) {
      return new SelectNode2(value0);
    };
    return SelectNode2;
  })();
  var RemoveNode = /* @__PURE__ */ (function() {
    function RemoveNode2(value0) {
      this.value0 = value0;
    }
    ;
    RemoveNode2.create = function(value0) {
      return new RemoveNode2(value0);
    };
    return RemoveNode2;
  })();
  var ToggleNodeExpand = /* @__PURE__ */ (function() {
    function ToggleNodeExpand2(value0) {
      this.value0 = value0;
    }
    ;
    ToggleNodeExpand2.create = function(value0) {
      return new ToggleNodeExpand2(value0);
    };
    return ToggleNodeExpand2;
  })();
  var UpdateAttribute = /* @__PURE__ */ (function() {
    function UpdateAttribute2(value0, value1, value22) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
    }
    ;
    UpdateAttribute2.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return new UpdateAttribute2(value0, value1, value22);
        };
      };
    };
    return UpdateAttribute2;
  })();
  var AddAttribute = /* @__PURE__ */ (function() {
    function AddAttribute2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    AddAttribute2.create = function(value0) {
      return function(value1) {
        return new AddAttribute2(value0, value1);
      };
    };
    return AddAttribute2;
  })();
  var RemoveAttribute = /* @__PURE__ */ (function() {
    function RemoveAttribute2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    RemoveAttribute2.create = function(value0) {
      return function(value1) {
        return new RemoveAttribute2(value0, value1);
      };
    };
    return RemoveAttribute2;
  })();
  var SelectTreeType = /* @__PURE__ */ (function() {
    function SelectTreeType2(value0) {
      this.value0 = value0;
    }
    ;
    SelectTreeType2.create = function(value0) {
      return new SelectTreeType2(value0);
    };
    return SelectTreeType2;
  })();
  var SelectDataSet = /* @__PURE__ */ (function() {
    function SelectDataSet2(value0) {
      this.value0 = value0;
    }
    ;
    SelectDataSet2.create = function(value0) {
      return new SelectDataSet2(value0);
    };
    return SelectDataSet2;
  })();
  var SwitchTab = /* @__PURE__ */ (function() {
    function SwitchTab2(value0) {
      this.value0 = value0;
    }
    ;
    SwitchTab2.create = function(value0) {
      return new SwitchTab2(value0);
    };
    return SwitchTab2;
  })();
  var RefreshPreview = /* @__PURE__ */ (function() {
    function RefreshPreview2() {
    }
    ;
    RefreshPreview2.value = new RefreshPreview2();
    return RefreshPreview2;
  })();
  var updateNodeAttribute = function(targetId) {
    return function(attrName) {
      return function(choice) {
        return function(tree2) {
          var updateAttr = function(attrs) {
            return map127(function(a3) {
              var $88 = a3.attrName === attrName;
              if ($88) {
                return {
                  attrName: a3.attrName,
                  choice
                };
              }
              ;
              return a3;
            })(attrs);
          };
          if (tree2 instanceof BNode) {
            var $90 = tree2.value0.id === targetId;
            if ($90) {
              return new BNode({
                id: tree2.value0.id,
                elementType: tree2.value0.elementType,
                name: tree2.value0.name,
                expanded: tree2.value0.expanded,
                attributes: updateAttr(tree2.value0.attributes)
              }, tree2.value1);
            }
            ;
            return new BNode(tree2.value0, map127(updateNodeAttribute(targetId)(attrName)(choice))(tree2.value1));
          }
          ;
          if (tree2 instanceof BDataJoin) {
            var $93 = tree2.value0.id === targetId;
            if ($93) {
              return new BDataJoin({
                id: tree2.value0.id,
                name: tree2.value0.name,
                elementType: tree2.value0.elementType,
                expanded: tree2.value0.expanded,
                template: {
                  id: tree2.value0.template.id,
                  elementType: tree2.value0.template.elementType,
                  name: tree2.value0.template.name,
                  expanded: tree2.value0.template.expanded,
                  attributes: updateAttr(tree2.value0.template.attributes)
                }
              });
            }
            ;
            return tree2;
          }
          ;
          throw new Error("Failed pattern match at TreeBuilder.App (line 850, column 53 - line 858, column 16): " + [tree2.constructor.name]);
        };
      };
    };
  };
  var treeButton = function(state3) {
    return function(treeId) {
      return function(label5) {
        return button2([classes(append41(["preset-btn"])((function() {
          var $95 = state3.currentTreeType === treeId;
          if ($95) {
            return ["preset-btn--active"];
          }
          ;
          return [];
        })())), onClick(function(v2) {
          return new SelectTreeType(treeId);
        })])([text5(label5)]);
      };
    };
  };
  var toggleExpand = function(targetId) {
    return function(tree2) {
      if (tree2 instanceof BNode) {
        var $97 = tree2.value0.id === targetId;
        if ($97) {
          return new BNode({
            id: tree2.value0.id,
            elementType: tree2.value0.elementType,
            name: tree2.value0.name,
            attributes: tree2.value0.attributes,
            expanded: !tree2.value0.expanded
          }, tree2.value1);
        }
        ;
        return new BNode(tree2.value0, map127(toggleExpand(targetId))(tree2.value1));
      }
      ;
      return tree2;
    };
  };
  var tabButton = function(active) {
    return function(tabId) {
      return function(label5) {
        return button2([classes(append41(["tab-btn"])((function() {
          var $100 = active === tabId;
          if ($100) {
            return ["tab-btn--active"];
          }
          ;
          return [];
        })())), onClick(function(v2) {
          return new SwitchTab(tabId);
        })])([text5(label5)]);
      };
    };
  };
  var stripTree = /* @__PURE__ */ (function() {
    return new BNode({
      id: 1,
      elementType: "svg",
      name: new Just("strip"),
      attributes: [{
        attrName: "width",
        choice: new ConstantNumber(300)
      }, {
        attrName: "height",
        choice: new ConstantNumber(60)
      }],
      expanded: true
    }, [new BDataJoin({
      id: 2,
      name: "bars",
      elementType: "rect",
      template: {
        id: 3,
        elementType: "rect",
        name: Nothing.value,
        attributes: [{
          attrName: "x",
          choice: new FromField("sx")
        }, {
          attrName: "y",
          choice: new ConstantNumber(5)
        }, {
          attrName: "width",
          choice: new ConstantNumber(3)
        }, {
          attrName: "height",
          choice: new ConstantNumber(50)
        }, {
          attrName: "fill",
          choice: new FromField("color")
        }],
        expanded: true
      },
      expanded: true
    })]);
  })();
  var renderQ4D3Preview = function(v2) {
    return div2([classes(["quadrant", "q4-d3preview"])])([div2([classes(["quadrant-header"])])([h3_([text5("D3 Interpreter")]), span4([classes(["interpreter-tag"])])([text5("Tree \u2192 SVG")])]), div2([classes(["quadrant-content"])])([div2([id3("tree-builder-preview"), classes(["d3-preview-container"])])([])])]);
  };
  var renderQ2MetaAST = function(v2) {
    return div2([classes(["quadrant", "q2-metaast"])])([div2([classes(["quadrant-header"])])([h3_([text5("MetaAST Interpreter")]), span4([classes(["interpreter-tag"])])([text5("Tree \u2192 Structure")])]), div2([classes(["quadrant-content"])])([div2([id3("ast-viz-output"), classes(["ast-viz-container"])])([])])]);
  };
  var renderPaletteBtn = function(state3) {
    return function(elem1) {
      var action2 = (function() {
        if (state3.selectedNodeId instanceof Just) {
          return new AddChildElement(state3.selectedNodeId.value0, elem1.id);
        }
        ;
        if (state3.selectedNodeId instanceof Nothing) {
          return new AddRootElement(elem1.id);
        }
        ;
        throw new Error("Failed pattern match at TreeBuilder.App (line 565, column 14 - line 567, column 40): " + [state3.selectedNodeId.constructor.name]);
      })();
      return button2([classes(["palette-btn", "palette-btn--" + elem1.category]), title2(elem1.description), onClick(function(v2) {
        return action2;
      })])([text5(elem1.label)]);
    };
  };
  var renderChoiceButtons = function(nodeId) {
    return function(binding) {
      var choiceBtn = function(label5) {
        return function(choice) {
          return button2([classes(append41(["choice-btn"])((function() {
            var $103 = eq26(binding.choice)(choice);
            if ($103) {
              return ["choice-btn--active"];
            }
            ;
            return [];
          })())), onClick(function(v2) {
            return new UpdateAttribute(nodeId, binding.attrName, choice);
          })])([text5(label5)]);
        };
      };
      return span4([classes(["choice-buttons"])])([choiceBtn("x")(new FromField("x")), choiceBtn("y")(new FromField("y")), choiceBtn("w")(new FromField("width")), choiceBtn("h")(new FromField("height")), choiceBtn("r")(new FromField("radius")), choiceBtn("color")(new FromField("color")), choiceBtn("label")(new FromField("label"))]);
    };
  };
  var renderInlineAttr = function(nodeId) {
    return function(binding) {
      return div2([classes(["inline-attr"])])([span4([classes(["inline-attr-name"])])([text5(binding.attrName)]), span4([classes(["inline-attr-arrow"])])([text5("<-")]), renderChoiceButtons(nodeId)(binding), button2([classes(["inline-attr-remove"]), onClick(function(v2) {
        return new RemoveAttribute(nodeId, binding.attrName);
      })])([text5("x")])]);
    };
  };
  var renderAddAttrBtn = function(nodeId) {
    return function(attr46) {
      return button2([classes(["add-attr-btn"]), title2("Add " + attr46.label), onClick(function(v2) {
        return new AddAttribute(nodeId, attr46.name);
      })])([text5("+" + attr46.label)]);
    };
  };
  var removeNodeById = function(targetId) {
    return function(tree2) {
      if (tree2 instanceof BNode) {
        var $105 = tree2.value0.id === targetId;
        if ($105) {
          return Nothing.value;
        }
        ;
        return new Just(new BNode(tree2.value0, mapMaybe(removeNodeById(targetId))(tree2.value1)));
      }
      ;
      return new Just(tree2);
    };
  };
  var removeNodeAttribute = function(targetId) {
    return function(attrName) {
      return function(tree2) {
        if (tree2 instanceof BNode) {
          var $109 = tree2.value0.id === targetId;
          if ($109) {
            return new BNode({
              id: tree2.value0.id,
              elementType: tree2.value0.elementType,
              name: tree2.value0.name,
              expanded: tree2.value0.expanded,
              attributes: filter(function(a3) {
                return a3.attrName !== attrName;
              })(tree2.value0.attributes)
            }, tree2.value1);
          }
          ;
          return new BNode(tree2.value0, map127(removeNodeAttribute(targetId)(attrName))(tree2.value1));
        }
        ;
        if (tree2 instanceof BDataJoin) {
          var $112 = tree2.value0.id === targetId;
          if ($112) {
            return new BDataJoin({
              id: tree2.value0.id,
              name: tree2.value0.name,
              elementType: tree2.value0.elementType,
              expanded: tree2.value0.expanded,
              template: {
                id: tree2.value0.template.id,
                elementType: tree2.value0.template.elementType,
                name: tree2.value0.template.name,
                expanded: tree2.value0.template.expanded,
                attributes: filter(function(a3) {
                  return a3.attrName !== attrName;
                })(tree2.value0.template.attributes)
              }
            });
          }
          ;
          return tree2;
        }
        ;
        throw new Error("Failed pattern match at TreeBuilder.App (line 874, column 46 - line 882, column 16): " + [tree2.constructor.name]);
      };
    };
  };
  var radialTree = /* @__PURE__ */ (function() {
    return new BNode({
      id: 1,
      elementType: "svg",
      name: new Just("radial"),
      attributes: [{
        attrName: "width",
        choice: new ConstantNumber(300)
      }, {
        attrName: "height",
        choice: new ConstantNumber(300)
      }],
      expanded: true
    }, [new BDataJoin({
      id: 2,
      name: "dots",
      elementType: "circle",
      template: {
        id: 3,
        elementType: "circle",
        name: Nothing.value,
        attributes: [{
          attrName: "cx",
          choice: new FromField("rx")
        }, {
          attrName: "cy",
          choice: new FromField("ry")
        }, {
          attrName: "r",
          choice: new FromField("radius")
        }, {
          attrName: "fill",
          choice: new FromField("color")
        }],
        expanded: true
      },
      expanded: true
    })]);
  })();
  var missingAttrs = function(elemType) {
    return function(current) {
      var currentNames = map127(function(v2) {
        return v2.attrName;
      })(current);
      var available = attributeOptionsFor(elemType);
      return filter(function(opt) {
        return !elem9(opt.name)(currentNames);
      })(map127(function(o) {
        return {
          name: o.name,
          label: o.label
        };
      })(available));
    };
  };
  var renderInlineAttrs = function(nodeId) {
    return function(elemType) {
      return function(attrs) {
        return div2([classes(["inline-attrs"])])([div2([classes(["inline-attrs-list"])])(map127(renderInlineAttr(nodeId))(attrs)), div2([classes(["inline-add-attr"])])(map127(renderAddAttrBtn(nodeId))(missingAttrs(elemType)(attrs)))]);
      };
    };
  };
  var renderTreeNode = function(state3) {
    return function(tree2) {
      if (tree2 instanceof BNode) {
        var isSelected = eq33(state3.selectedNodeId)(new Just(tree2.value0.id));
        return div2([classes(["tree-node"])])([div2([classes(append41(["node-header"])((function() {
          if (isSelected) {
            return ["node-header--selected"];
          }
          ;
          return [];
        })())), onClick(function(v2) {
          return new SelectNode(tree2.value0.id);
        })])([(function() {
          var $116 = length3(tree2.value1) > 0;
          if ($116) {
            return span4([classes(["expand-toggle"]), onClick(function(v2) {
              return new ToggleNodeExpand(tree2.value0.id);
            })])([text5((function() {
              if (tree2.value0.expanded) {
                return "v";
              }
              ;
              return ">";
            })())]);
          }
          ;
          return span4([classes(["expand-placeholder"])])([text5("o")]);
        })(), span4([classes(["element-badge", "element-badge--" + tree2.value0.elementType])])([text5(tree2.value0.elementType)]), (function() {
          if (tree2.value0.name instanceof Just) {
            return span4([classes(["node-name"])])([text5(tree2.value0.name.value0)]);
          }
          ;
          if (tree2.value0.name instanceof Nothing) {
            return text5("");
          }
          ;
          throw new Error("Failed pattern match at TreeBuilder.App (line 601, column 13 - line 603, column 36): " + [tree2.value0.name.constructor.name]);
        })(), button2([classes(["remove-btn"]), onClick(function(v2) {
          return new RemoveNode(tree2.value0.id);
        })])([text5("x")])]), (function() {
          if (tree2.value0.expanded) {
            return renderInlineAttrs(tree2.value0.id)(tree2.value0.elementType)(tree2.value0.attributes);
          }
          ;
          return text5("");
        })(), (function() {
          var $121 = tree2.value0.expanded && length3(tree2.value1) > 0;
          if ($121) {
            return div2([classes(["node-children"])])(map127(renderTreeNode(state3))(tree2.value1));
          }
          ;
          return text5("");
        })()]);
      }
      ;
      if (tree2 instanceof BDataJoin) {
        var isSelected = eq33(state3.selectedNodeId)(new Just(tree2.value0.id));
        return div2([classes(["tree-node"])])([div2([classes(append41(["node-header"])((function() {
          if (isSelected) {
            return ["node-header--selected"];
          }
          ;
          return [];
        })())), onClick(function(v2) {
          return new SelectNode(tree2.value0.id);
        })])([span4([classes(["join-badge"])])([text5("join")]), span4([classes(["element-badge", "element-badge--" + tree2.value0.elementType])])([text5(tree2.value0.elementType)]), span4([classes(["node-name"])])([text5(tree2.value0.name)])]), (function() {
          if (tree2.value0.expanded) {
            return renderInlineAttrs(tree2.value0.id)(tree2.value0.template.elementType)(tree2.value0.template.attributes);
          }
          ;
          return text5("");
        })()]);
      }
      ;
      throw new Error("Failed pattern match at TreeBuilder.App (line 577, column 29 - line 642, column 8): " + [tree2.constructor.name]);
    };
  };
  var renderTreeEditor = function(state3) {
    return div2([classes(["tree-editor"])])([div2([classes(["preset-buttons"])])([treeButton(state3)("grid")("Grid"), treeButton(state3)("radial")("Radial"), treeButton(state3)("strip")("Strip")]), div2([classes(["tree-view"])])([(function() {
      if (state3.tree instanceof Nothing) {
        return div2([classes(["empty-tree"])])([text5("Select a preset to start")]);
      }
      ;
      if (state3.tree instanceof Just) {
        return renderTreeNode(state3)(state3.tree.value0);
      }
      ;
      throw new Error("Failed pattern match at TreeBuilder.App (line 199, column 11 - line 205, column 40): " + [state3.tree.constructor.name]);
    })()]), div2([classes(["palette-buttons"])])(map127(renderPaletteBtn(state3))(availableElements))]);
  };
  var initialState6 = /* @__PURE__ */ (function() {
    return {
      tree: Nothing.value,
      sampleData: sudokuSampleData,
      selectedNodeId: Nothing.value,
      nextNodeId: 1,
      previewError: Nothing.value,
      currentTreeType: "grid",
      currentDataSet: "sudoku",
      activeTab: "tree"
    };
  })();
  var gridTree = /* @__PURE__ */ (function() {
    return new BNode({
      id: 1,
      elementType: "svg",
      name: new Just("grid"),
      attributes: [{
        attrName: "width",
        choice: new ConstantNumber(300)
      }, {
        attrName: "height",
        choice: new ConstantNumber(300)
      }],
      expanded: true
    }, [new BDataJoin({
      id: 2,
      name: "cells",
      elementType: "rect",
      template: {
        id: 3,
        elementType: "rect",
        name: Nothing.value,
        attributes: [{
          attrName: "x",
          choice: new FromField("x")
        }, {
          attrName: "y",
          choice: new FromField("y")
        }, {
          attrName: "width",
          choice: new FromField("width")
        }, {
          attrName: "height",
          choice: new FromField("height")
        }, {
          attrName: "fill",
          choice: new FromField("color")
        }],
        expanded: true
      },
      expanded: true
    }), new BDataJoin({
      id: 4,
      name: "labels",
      elementType: "text",
      template: {
        id: 5,
        elementType: "text",
        name: Nothing.value,
        attributes: [{
          attrName: "x",
          choice: new FromField("cx")
        }, {
          attrName: "y",
          choice: new FromField("cy")
        }, {
          attrName: "text",
          choice: new FromField("label")
        }, {
          attrName: "fill",
          choice: new ConstantString("#333")
        }],
        expanded: true
      },
      expanded: true
    })]);
  })();
  var getTreeForType = function(v2) {
    if (v2 === "grid") {
      return gridTree;
    }
    ;
    if (v2 === "radial") {
      return radialTree;
    }
    ;
    if (v2 === "strip") {
      return stripTree;
    }
    ;
    return gridTree;
  };
  var getSemiQuineOutput = function(state3) {
    if (state3.tree instanceof Nothing) {
      return "-- No tree defined\n-- Select a preset to start";
    }
    ;
    if (state3.tree instanceof Just) {
      var sampleDatum = (function() {
        var v2 = head2(state3.sampleData);
        if (v2 instanceof Just) {
          return v2.value0;
        }
        ;
        if (v2 instanceof Nothing) {
          return {
            x: 0,
            y: 0,
            cx: 0,
            cy: 0,
            rx: 0,
            ry: 0,
            sx: 0,
            sy: 0,
            radius: 0,
            width: 0,
            height: 0,
            value: 0,
            color: "",
            label: "",
            name: "",
            index: 0
          };
        }
        ;
        throw new Error("Failed pattern match at TreeBuilder.App (line 507, column 23 - line 511, column 78): " + [v2.constructor.name]);
      })();
      var actualTree = builderToTreeWithData(state3.tree.value0)(state3.sampleData);
      return treeToCodeWithSample(sampleDatum)(actualTree);
    }
    ;
    throw new Error("Failed pattern match at TreeBuilder.App (line 501, column 28 - line 513, column 51): " + [state3.tree.constructor.name]);
  };
  var renderQ3SemiQuine = function(state3) {
    return div2([classes(["quadrant", "q3-semiquine"])])([div2([classes(["quadrant-header"])])([h3_([text5("SemiQuine Interpreter")]), span4([classes(["interpreter-tag"])])([text5("Tree \u2192 PureScript")])]), div2([classes(["quadrant-content"])])([pre([classes(["code-output", "language-psd3"])])([code([classes(["language-psd3"])])([text5(getSemiQuineOutput(state3))])])])]);
  };
  var getDataSet = function(v2) {
    if (v2 === "sudoku") {
      return sudokuSampleData;
    }
    ;
    if (v2 === "chess") {
      return chessSampleData;
    }
    ;
    if (v2 === "go") {
      return goSampleData;
    }
    ;
    return sudokuSampleData;
  };
  var formatSampleDataPreview = function(data_2) {
    var formatDatumShort = function(d) {
      return "  { x: " + (show85(d.x) + (", y: " + (show85(d.y) + (', color: "' + (d.color + '" }')))));
    };
    var preview = take(5)(data_2);
    var count = length3(data_2);
    return "// " + (show138(count) + (" items\n" + ("[\n" + (intercalate8(",\n")(map127(formatDatumShort)(preview)) + ((function() {
      var $135 = count > 5;
      if ($135) {
        return "\n  // ... " + (show138(count - 5 | 0) + " more");
      }
      ;
      return "";
    })() + "\n]")))));
  };
  var dataButton = function(state3) {
    return function(dataId) {
      return function(label5) {
        return button2([classes(append41(["preset-btn"])((function() {
          var $142 = state3.currentDataSet === dataId;
          if ($142) {
            return ["preset-btn--active"];
          }
          ;
          return [];
        })())), onClick(function(v2) {
          return new SelectDataSet(dataId);
        })])([text5(label5)]);
      };
    };
  };
  var renderDataEditor = function(state3) {
    return div2([classes(["data-editor"])])([div2([classes(["preset-buttons"])])([dataButton(state3)("sudoku")("9x9"), dataButton(state3)("chess")("8x8"), dataButton(state3)("go")("19x19")]), pre([classes(["data-preview"])])([text5(formatSampleDataPreview(state3.sampleData))])]);
  };
  var renderQ1TreeBuilder = function(state3) {
    return div2([classes(["quadrant", "q1-builder"])])([div2([classes(["quadrant-header"])])([h3_([text5("TreeBuilder")]), div2([classes(["quadrant-tabs"])])([tabButton(state3.activeTab)("tree")("Tree"), tabButton(state3.activeTab)("data")("Data")])]), div2([classes(["quadrant-content"])])([(function() {
      var $143 = state3.activeTab === "tree";
      if ($143) {
        return renderTreeEditor(state3);
      }
      ;
      return renderDataEditor(state3);
    })()])]);
  };
  var render55 = function(state3) {
    return div2([classes(["interpreter-demo-page"])])([render4({
      logoSize: Normal.value,
      quadrant: NoQuadrant.value,
      prevNext: Nothing.value,
      pageTitle: new Just("Multiple Interpreters Demo")
    }), div2([classes(["quadrant-grid"])])([renderQ1TreeBuilder(state3), renderQ2MetaAST(state3), renderQ3SemiQuine(state3), renderQ4D3Preview(state3)])]);
  };
  var astToTreeVisualization2 = function(ast) {
    var renderASTNode = function(node) {
      return function(xPos) {
        return function(level) {
          if (node instanceof NodeAST) {
            var label5 = (function() {
              if (node.value0.name instanceof Just) {
                return node.value0.elemType + (": " + node.value0.name.value0);
              }
              ;
              if (node.value0.name instanceof Nothing) {
                return node.value0.elemType;
              }
              ;
              throw new Error("Failed pattern match at TreeBuilder.App (line 287, column 19 - line 289, column 32): " + [node.value0.name.constructor.name]);
            })();
            var childCount = length3(node.value0.children);
            var startX = xPos - 100 * (toNumber(childCount) - 1) / 2;
            return withChildren(named(Group.value)("node-" + show138(level))([]))(append41([elem3(Circle.value)([v3Attr19("cx")(lit20(xPos)), v3Attr19("cy")(lit20(toNumber(level) * 70)), v3Attr19("r")(lit20(25)), v3AttrStr("fill")(str21("#4A90E2")), v3AttrStr("stroke")(str21("#2E5C8A")), v3Attr19("stroke-width")(lit20(2))]), elem3(Text.value)([v3Attr19("x")(lit20(xPos)), v3Attr19("y")(lit20(toNumber(level) * 70 + 4)), v3AttrStr("textContent")(str21(label5)), v3AttrStr("text-anchor")(str21("middle")), v3AttrStr("fill")(str21("white")), v3AttrStr("font-size")(str21("10px")), v3AttrStr("font-family")(str21("monospace"))]), elem3(Text.value)([v3Attr19("x")(lit20(xPos)), v3Attr19("y")(lit20(toNumber(level) * 70 + 38)), v3AttrStr("textContent")(str21("attrs: " + show138(node.value0.attrCount))), v3AttrStr("text-anchor")(str21("middle")), v3AttrStr("fill")(str21("#666")), v3AttrStr("font-size")(str21("9px"))])])(append41(mapWithIndex3(function(i2) {
              return function(v2) {
                var childY = toNumber(level + 1 | 0) * 70;
                var childX = startX + toNumber(i2) * 100;
                return elem3(Line.value)([v3Attr19("x1")(lit20(xPos)), v3Attr19("y1")(lit20(toNumber(level) * 70 + 25)), v3Attr19("x2")(lit20(childX)), v3Attr19("y2")(lit20(childY - 25)), v3AttrStr("stroke")(str21("#999")), v3Attr19("stroke-width")(lit20(1.5))]);
              };
            })(node.value0.children))(mapWithIndex3(function(i2) {
              return function(child) {
                var childX = startX + toNumber(i2) * 100;
                return renderASTNode(child)(childX)(level + 1 | 0);
              };
            })(node.value0.children))));
          }
          ;
          if (node instanceof JoinAST) {
            return withChildren(named(Group.value)("join-" + show138(level))([]))([elem3(Circle.value)([v3Attr19("cx")(lit20(xPos)), v3Attr19("cy")(lit20(toNumber(level) * 70)), v3Attr19("r")(lit20(25)), v3AttrStr("fill")(str21("#E27A4A")), v3AttrStr("stroke")(str21("#8A472E")), v3Attr19("stroke-width")(lit20(2))]), elem3(Text.value)([v3Attr19("x")(lit20(xPos)), v3Attr19("y")(lit20(toNumber(level) * 70 + 4)), v3AttrStr("textContent")(str21("Join: " + node.value0.name)), v3AttrStr("text-anchor")(str21("middle")), v3AttrStr("fill")(str21("white")), v3AttrStr("font-size")(str21("9px"))]), elem3(Text.value)([v3Attr19("x")(lit20(xPos)), v3Attr19("y")(lit20(toNumber(level) * 70 + 38)), v3AttrStr("textContent")(str21("data: " + show138(node.value0.dataCount))), v3AttrStr("text-anchor")(str21("middle")), v3AttrStr("fill")(str21("#666")), v3AttrStr("font-size")(str21("9px"))])]);
          }
          ;
          if (node instanceof NestedJoinAST) {
            return withChildren(named(Group.value)("nested-join-" + show138(level))([]))([elem3(Circle.value)([v3Attr19("cx")(lit20(xPos)), v3Attr19("cy")(lit20(toNumber(level) * 70)), v3Attr19("r")(lit20(25)), v3AttrStr("fill")(str21("#9B4AE2")), v3AttrStr("stroke")(str21("#5C2E8A")), v3Attr19("stroke-width")(lit20(2))]), elem3(Text.value)([v3Attr19("x")(lit20(xPos)), v3Attr19("y")(lit20(toNumber(level) * 70 + 4)), v3AttrStr("textContent")(str21("Nested: " + node.value0.name)), v3AttrStr("text-anchor")(str21("middle")), v3AttrStr("fill")(str21("white")), v3AttrStr("font-size")(str21("9px"))]), elem3(Text.value)([v3Attr19("x")(lit20(xPos)), v3Attr19("y")(lit20(toNumber(level) * 70 + 38)), v3AttrStr("textContent")(str21("data: " + show138(node.value0.dataCount))), v3AttrStr("text-anchor")(str21("middle")), v3AttrStr("fill")(str21("#666")), v3AttrStr("font-size")(str21("9px"))])]);
          }
          ;
          if (node instanceof SceneJoinAST) {
            return withChildren(named(Group.value)("scene-join-" + show138(level))([]))([elem3(Circle.value)([v3Attr19("cx")(lit20(xPos)), v3Attr19("cy")(lit20(toNumber(level) * 70)), v3Attr19("r")(lit20(25)), v3AttrStr("fill")(str21("#4AE2A4")), v3AttrStr("stroke")(str21("#2E8A5C")), v3Attr19("stroke-width")(lit20(2))]), elem3(Text.value)([v3Attr19("x")(lit20(xPos)), v3Attr19("y")(lit20(toNumber(level) * 70 + 4)), v3AttrStr("textContent")(str21("Scene: " + node.value0.name)), v3AttrStr("text-anchor")(str21("middle")), v3AttrStr("fill")(str21("white")), v3AttrStr("font-size")(str21("9px"))]), elem3(Text.value)([v3Attr19("x")(lit20(xPos)), v3Attr19("y")(lit20(toNumber(level) * 70 + 38)), v3AttrStr("textContent")(str21("data: " + (show138(node.value0.dataCount) + (" {" + ((function() {
              if (node.value0.hasEnter) {
                return "E";
              }
              ;
              return "";
            })() + ((function() {
              if (node.value0.hasUpdate) {
                return "U";
              }
              ;
              return "";
            })() + ((function() {
              if (node.value0.hasExit) {
                return "X";
              }
              ;
              return "";
            })() + "}"))))))), v3AttrStr("text-anchor")(str21("middle")), v3AttrStr("fill")(str21("#666")), v3AttrStr("font-size")(str21("9px"))])]);
          }
          ;
          if (node instanceof SceneNestedJoinAST) {
            return withChildren(named(Group.value)("scene-nested-" + show138(level))([]))([elem3(Circle.value)([v3Attr19("cx")(lit20(xPos)), v3Attr19("cy")(lit20(toNumber(level) * 70)), v3Attr19("r")(lit20(25)), v3AttrStr("fill")(str21("#E2A44A")), v3AttrStr("stroke")(str21("#8A5C2E")), v3Attr19("stroke-width")(lit20(2))]), elem3(Text.value)([v3Attr19("x")(lit20(xPos)), v3Attr19("y")(lit20(toNumber(level) * 70 + 4)), v3AttrStr("textContent")(str21("SceneNested: " + node.value0.name)), v3AttrStr("text-anchor")(str21("middle")), v3AttrStr("fill")(str21("white")), v3AttrStr("font-size")(str21("8px"))]), elem3(Text.value)([v3Attr19("x")(lit20(xPos)), v3Attr19("y")(lit20(toNumber(level) * 70 + 38)), v3AttrStr("textContent")(str21("data: " + (show138(node.value0.dataCount) + (" {" + ((function() {
              if (node.value0.hasEnter) {
                return "E";
              }
              ;
              return "";
            })() + ((function() {
              if (node.value0.hasUpdate) {
                return "U";
              }
              ;
              return "";
            })() + ((function() {
              if (node.value0.hasExit) {
                return "X";
              }
              ;
              return "";
            })() + "}"))))))), v3AttrStr("text-anchor")(str21("middle")), v3AttrStr("fill")(str21("#666")), v3AttrStr("font-size")(str21("9px"))])]);
          }
          ;
          throw new Error("Failed pattern match at TreeBuilder.App (line 284, column 37 - line 472, column 14): " + [node.constructor.name]);
        };
      };
    };
    return withChild(named(SVG.value)("ast-svg")([v3Attr19("width")(lit20(400)), v3Attr19("height")(lit20(350)), v3AttrStr("viewBox")(str21("0 0 400 350"))]))(withChild(named(Group.value)("ast-tree")([v3AttrStr("transform")(str21("translate(200, 40)"))]))(renderASTNode(ast)(0)(0)));
  };
  var addNodeAttribute = function(targetId) {
    return function(binding) {
      return function(tree2) {
        if (tree2 instanceof BNode) {
          var $177 = tree2.value0.id === targetId;
          if ($177) {
            return new BNode({
              id: tree2.value0.id,
              elementType: tree2.value0.elementType,
              name: tree2.value0.name,
              expanded: tree2.value0.expanded,
              attributes: snoc3(tree2.value0.attributes)(binding)
            }, tree2.value1);
          }
          ;
          return new BNode(tree2.value0, map127(addNodeAttribute(targetId)(binding))(tree2.value1));
        }
        ;
        if (tree2 instanceof BDataJoin) {
          var $180 = tree2.value0.id === targetId;
          if ($180) {
            return new BDataJoin({
              id: tree2.value0.id,
              name: tree2.value0.name,
              elementType: tree2.value0.elementType,
              expanded: tree2.value0.expanded,
              template: {
                id: tree2.value0.template.id,
                elementType: tree2.value0.template.elementType,
                name: tree2.value0.template.name,
                expanded: tree2.value0.template.expanded,
                attributes: snoc3(tree2.value0.template.attributes)(binding)
              }
            });
          }
          ;
          return tree2;
        }
        ;
        throw new Error("Failed pattern match at TreeBuilder.App (line 863, column 42 - line 871, column 16): " + [tree2.constructor.name]);
      };
    };
  };
  var addChildToNode = function(parentId) {
    return function(newChild) {
      return function(tree2) {
        if (tree2 instanceof BNode) {
          var $183 = tree2.value0.id === parentId;
          if ($183) {
            return new BNode(tree2.value0, snoc3(tree2.value1)(newChild));
          }
          ;
          return new BNode(tree2.value0, map127(addChildToNode(parentId)(newChild))(tree2.value1));
        }
        ;
        return tree2;
      };
    };
  };
  var handleAction49 = function(dictMonadAff) {
    var liftEffect54 = liftEffect(monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    return function(v2) {
      if (v2 instanceof Initialize49) {
        return discard69(handleAction49(dictMonadAff)(new SelectTreeType("grid")))(function() {
          return handleAction49(dictMonadAff)(new SelectDataSet("sudoku"));
        });
      }
      ;
      if (v2 instanceof AddRootElement) {
        return bind97(get20)(function(state3) {
          var newNode = emptyNode(state3.nextNodeId)(v2.value0);
          var newTree = new BNode(newNode, []);
          return discard69(modify_20(function(v1) {
            var $187 = {};
            for (var $188 in v1) {
              if ({}.hasOwnProperty.call(v1, $188)) {
                $187[$188] = v1[$188];
              }
              ;
            }
            ;
            $187.tree = new Just(newTree);
            $187.nextNodeId = state3.nextNodeId + 1 | 0;
            $187.selectedNodeId = new Just(newNode.id);
            return $187;
          }))(function() {
            return handleAction49(dictMonadAff)(RefreshPreview.value);
          });
        });
      }
      ;
      if (v2 instanceof AddChildElement) {
        return bind97(get20)(function(state3) {
          var newNode = emptyNode(state3.nextNodeId)(v2.value1);
          var updatedTree = map128(addChildToNode(v2.value0)(new BNode(newNode, [])))(state3.tree);
          return discard69(modify_20(function(v1) {
            var $191 = {};
            for (var $192 in v1) {
              if ({}.hasOwnProperty.call(v1, $192)) {
                $191[$192] = v1[$192];
              }
              ;
            }
            ;
            $191.tree = updatedTree;
            $191.nextNodeId = state3.nextNodeId + 1 | 0;
            $191.selectedNodeId = new Just(newNode.id);
            return $191;
          }))(function() {
            return handleAction49(dictMonadAff)(RefreshPreview.value);
          });
        });
      }
      ;
      if (v2 instanceof SelectNode) {
        return modify_20(function(v1) {
          var $196 = {};
          for (var $197 in v1) {
            if ({}.hasOwnProperty.call(v1, $197)) {
              $196[$197] = v1[$197];
            }
            ;
          }
          ;
          $196.selectedNodeId = new Just(v2.value0);
          return $196;
        });
      }
      ;
      if (v2 instanceof RemoveNode) {
        return bind97(get20)(function(state3) {
          var updatedTree = join6(map128(removeNodeById(v2.value0))(state3.tree));
          var newSelected = (function() {
            var $200 = eq33(state3.selectedNodeId)(new Just(v2.value0));
            if ($200) {
              return Nothing.value;
            }
            ;
            return state3.selectedNodeId;
          })();
          return discard69(modify_20(function(v1) {
            var $201 = {};
            for (var $202 in v1) {
              if ({}.hasOwnProperty.call(v1, $202)) {
                $201[$202] = v1[$202];
              }
              ;
            }
            ;
            $201.tree = updatedTree;
            $201.selectedNodeId = newSelected;
            return $201;
          }))(function() {
            return handleAction49(dictMonadAff)(RefreshPreview.value);
          });
        });
      }
      ;
      if (v2 instanceof ToggleNodeExpand) {
        return bind97(get20)(function(state3) {
          var updatedTree = map128(toggleExpand(v2.value0))(state3.tree);
          return modify_20(function(v1) {
            var $205 = {};
            for (var $206 in v1) {
              if ({}.hasOwnProperty.call(v1, $206)) {
                $205[$206] = v1[$206];
              }
              ;
            }
            ;
            $205.tree = updatedTree;
            return $205;
          });
        });
      }
      ;
      if (v2 instanceof UpdateAttribute) {
        return bind97(get20)(function(state3) {
          var updatedTree = map128(updateNodeAttribute(v2.value0)(v2.value1)(v2.value2))(state3.tree);
          return discard69(modify_20(function(v1) {
            var $209 = {};
            for (var $210 in v1) {
              if ({}.hasOwnProperty.call(v1, $210)) {
                $209[$210] = v1[$210];
              }
              ;
            }
            ;
            $209.tree = updatedTree;
            return $209;
          }))(function() {
            return handleAction49(dictMonadAff)(RefreshPreview.value);
          });
        });
      }
      ;
      if (v2 instanceof AddAttribute) {
        return when13(v2.value1 !== "")(bind97(get20)(function(state3) {
          var newBinding = {
            attrName: v2.value1,
            choice: new FromField("x")
          };
          var updatedTree = map128(addNodeAttribute(v2.value0)(newBinding))(state3.tree);
          return discard69(modify_20(function(v1) {
            var $215 = {};
            for (var $216 in v1) {
              if ({}.hasOwnProperty.call(v1, $216)) {
                $215[$216] = v1[$216];
              }
              ;
            }
            ;
            $215.tree = updatedTree;
            return $215;
          }))(function() {
            return handleAction49(dictMonadAff)(RefreshPreview.value);
          });
        }));
      }
      ;
      if (v2 instanceof RemoveAttribute) {
        return bind97(get20)(function(state3) {
          var updatedTree = map128(removeNodeAttribute(v2.value0)(v2.value1))(state3.tree);
          return discard69(modify_20(function(v1) {
            var $220 = {};
            for (var $221 in v1) {
              if ({}.hasOwnProperty.call(v1, $221)) {
                $220[$221] = v1[$221];
              }
              ;
            }
            ;
            $220.tree = updatedTree;
            return $220;
          }))(function() {
            return handleAction49(dictMonadAff)(RefreshPreview.value);
          });
        });
      }
      ;
      if (v2 instanceof SelectTreeType) {
        var tree2 = getTreeForType(v2.value0);
        return discard69(modify_20(function(v1) {
          var $225 = {};
          for (var $226 in v1) {
            if ({}.hasOwnProperty.call(v1, $226)) {
              $225[$226] = v1[$226];
            }
            ;
          }
          ;
          $225.tree = new Just(tree2);
          $225.currentTreeType = v2.value0;
          $225.selectedNodeId = Nothing.value;
          return $225;
        }))(function() {
          return handleAction49(dictMonadAff)(RefreshPreview.value);
        });
      }
      ;
      if (v2 instanceof SelectDataSet) {
        var data_2 = getDataSet(v2.value0);
        return discard69(modify_20(function(v1) {
          var $229 = {};
          for (var $230 in v1) {
            if ({}.hasOwnProperty.call(v1, $230)) {
              $229[$230] = v1[$230];
            }
            ;
          }
          ;
          $229.sampleData = data_2;
          $229.currentDataSet = v2.value0;
          return $229;
        }))(function() {
          return handleAction49(dictMonadAff)(RefreshPreview.value);
        });
      }
      ;
      if (v2 instanceof SwitchTab) {
        return modify_20(function(v1) {
          var $233 = {};
          for (var $234 in v1) {
            if ({}.hasOwnProperty.call(v1, $234)) {
              $233[$234] = v1[$234];
            }
            ;
          }
          ;
          $233.activeTab = v2.value0;
          return $233;
        });
      }
      ;
      if (v2 instanceof RefreshPreview) {
        return bind97(get20)(function(state3) {
          if (state3.tree instanceof Nothing) {
            return pure105(unit);
          }
          ;
          if (state3.tree instanceof Just) {
            return discard69(liftEffect54(clearPreviewContainer("#tree-builder-preview")))(function() {
              return discard69(liftEffect54(clearPreviewContainer("#ast-viz-output")))(function() {
                return discard69(liftEffect54(renderPreview("#tree-builder-preview")(state3.tree.value0)(state3.sampleData)))(function() {
                  var actualTree = builderToTreeWithData(state3.tree.value0)(state3.sampleData);
                  var treeAST = toAST(actualTree);
                  var astVizTree = astToTreeVisualization2(treeAST);
                  return discard69(liftEffect54(runD3v2M(bind140(select51("#ast-viz-output"))(function(astContainer) {
                    return bind140(renderTree73(astContainer)(astVizTree))(function() {
                      return pure126(unit);
                    });
                  }))))(function() {
                    return liftEffect54(highlightAll);
                  });
                });
              });
            });
          }
          ;
          throw new Error("Failed pattern match at TreeBuilder.App (line 781, column 5 - line 805, column 38): " + [state3.tree.constructor.name]);
        });
      }
      ;
      throw new Error("Failed pattern match at TreeBuilder.App (line 712, column 16 - line 805, column 38): " + [v2.constructor.name]);
    };
  };
  var component50 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return initialState6;
      },
      render: render55,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction49(dictMonadAff),
        initialize: new Just(Initialize49.value)
      })
    });
  };

  // output/TreeBuilder2.App/foreign.js
  var clearContainer4 = (selector) => () => {
    const container = document.querySelector(selector);
    if (container) {
      container.innerHTML = "";
    }
  };

  // output/Web.UIEvent.KeyboardEvent/foreign.js
  function key(e) {
    return e.key;
  }

  // output/TreeBuilder2.App/index.js
  var bind98 = /* @__PURE__ */ bind(bindEffect);
  var for_11 = /* @__PURE__ */ for_(applicativeEffect)(foldableMaybe);
  var bind141 = /* @__PURE__ */ bind(bindArray);
  var fromFoldable43 = /* @__PURE__ */ fromFoldable3(foldableList);
  var show86 = /* @__PURE__ */ show(showInt);
  var append127 = /* @__PURE__ */ append(semigroupArray);
  var identity18 = /* @__PURE__ */ identity(categoryFn);
  var map129 = /* @__PURE__ */ map(functorList);
  var eq110 = /* @__PURE__ */ eq(/* @__PURE__ */ eqMaybe(eqInt));
  var map130 = /* @__PURE__ */ map(functorArray);
  var elem10 = /* @__PURE__ */ elem2(eqInt);
  var discard70 = /* @__PURE__ */ discard(discardUnit);
  var min17 = /* @__PURE__ */ min(ordNumber);
  var max24 = /* @__PURE__ */ max(ordNumber);
  var bind220 = /* @__PURE__ */ bind(bindD3v2M);
  var select52 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var v3Attr20 = /* @__PURE__ */ v3Attr(showNumber);
  var lit21 = /* @__PURE__ */ lit(numExprEvalD);
  var str22 = /* @__PURE__ */ str(stringExprEvalD);
  var show139 = /* @__PURE__ */ show(showNumber);
  var renderTree74 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D);
  var ordRecord24 = /* @__PURE__ */ ordRecord();
  var ordRecordCons23 = /* @__PURE__ */ ordRecordCons(ordRecordNil)();
  var idIsSymbol = {
    reflectSymbol: function() {
      return "id";
    }
  };
  var renderTree124 = /* @__PURE__ */ renderTree74(/* @__PURE__ */ ordRecord24(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons23({
    reflectSymbol: function() {
      return "targetY";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "targetX";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "sourceY";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "sourceX";
    }
  })(ordNumber))()(idIsSymbol)(ordString)));
  var liftEffect52 = /* @__PURE__ */ liftEffect(monadEffectD3v2M);
  var pure127 = /* @__PURE__ */ pure(applicativeD3v2M);
  var append212 = /* @__PURE__ */ append(semigroupList);
  var bind311 = /* @__PURE__ */ bind(bindHalogenM);
  var discard219 = /* @__PURE__ */ discard70(bindHalogenM);
  var modify_21 = /* @__PURE__ */ modify_(monadStateHalogenM);
  var $$void19 = /* @__PURE__ */ $$void(functorHalogenM);
  var get21 = /* @__PURE__ */ get(monadStateHalogenM);
  var pure213 = /* @__PURE__ */ pure(applicativeHalogenM);
  var elemIndex3 = /* @__PURE__ */ elemIndex(eqInt);
  var for_14 = /* @__PURE__ */ for_(applicativeHalogenM)(foldableMaybe);
  var Root = /* @__PURE__ */ (function() {
    function Root2() {
    }
    ;
    Root2.value = new Root2();
    return Root2;
  })();
  var TypeA = /* @__PURE__ */ (function() {
    function TypeA2() {
    }
    ;
    TypeA2.value = new TypeA2();
    return TypeA2;
  })();
  var TypeB = /* @__PURE__ */ (function() {
    function TypeB2() {
    }
    ;
    TypeB2.value = new TypeB2();
    return TypeB2;
  })();
  var Initialize50 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var NodeClicked = /* @__PURE__ */ (function() {
    function NodeClicked2(value0) {
      this.value0 = value0;
    }
    ;
    NodeClicked2.create = function(value0) {
      return new NodeClicked2(value0);
    };
    return NodeClicked2;
  })();
  var HandleKeyDown = /* @__PURE__ */ (function() {
    function HandleKeyDown2(value0) {
      this.value0 = value0;
    }
    ;
    HandleKeyDown2.create = function(value0) {
      return new HandleKeyDown2(value0);
    };
    return HandleKeyDown2;
  })();
  var RenderTree = /* @__PURE__ */ (function() {
    function RenderTree2() {
    }
    ;
    RenderTree2.value = new RenderTree2();
    return RenderTree2;
  })();
  var eqNodeType = {
    eq: function(x32) {
      return function(y32) {
        if (x32 instanceof Root && y32 instanceof Root) {
          return true;
        }
        ;
        if (x32 instanceof TypeA && y32 instanceof TypeA) {
          return true;
        }
        ;
        if (x32 instanceof TypeB && y32 instanceof TypeB) {
          return true;
        }
        ;
        return false;
      };
    }
  };
  var ordNodeType = {
    compare: function(x32) {
      return function(y32) {
        if (x32 instanceof Root && y32 instanceof Root) {
          return EQ.value;
        }
        ;
        if (x32 instanceof Root) {
          return LT.value;
        }
        ;
        if (y32 instanceof Root) {
          return GT.value;
        }
        ;
        if (x32 instanceof TypeA && y32 instanceof TypeA) {
          return EQ.value;
        }
        ;
        if (x32 instanceof TypeA) {
          return LT.value;
        }
        ;
        if (y32 instanceof TypeA) {
          return GT.value;
        }
        ;
        if (x32 instanceof TypeB && y32 instanceof TypeB) {
          return EQ.value;
        }
        ;
        throw new Error("Failed pattern match at TreeBuilder2.App (line 0, column 0 - line 0, column 0): " + [x32.constructor.name, y32.constructor.name]);
      };
    },
    Eq0: function() {
      return eqNodeType;
    }
  };
  var renderTree224 = /* @__PURE__ */ renderTree74(/* @__PURE__ */ ordRecord24(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons23({
    reflectSymbol: function() {
      return "y";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "x";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "strokeWidth";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "nodeType";
    }
  })(ordNodeType))()({
    reflectSymbol: function() {
      return "isLeaf";
    }
  })(ordBoolean))()(idIsSymbol)(ordInt))()({
    reflectSymbol: function() {
      return "depth";
    }
  })(ordInt))()({
    reflectSymbol: function() {
      return "color";
    }
  })(ordString)));
  var setupZoom = function __do6() {
    var doc = bind98(windowImpl)(document2)();
    var parentNode3 = toParentNode(toDocument(doc));
    var maybeSvg = querySelector("#tree-builder2-svg")(parentNode3)();
    return for_11(maybeSvg)(function(svg2) {
      var v2 = new ScaleExtent(0.5, 4);
      return function __do7() {
        attachZoom_(svg2)(v2.value0)(v2.value1)(".zoom-group")();
        return unit;
      };
    })();
  };
  var selectedStrokeWidth = 5;
  var render56 = function(state3) {
    return div2([class_("tree-builder2-container"), tabIndex2(0), onKeyDown(HandleKeyDown.create)])([h2_([text5("Interactive Tree Builder")]), p([class_("instructions")])([text5((function() {
      if (state3.selectedNodeId instanceof Nothing) {
        return "Click any node to select it, or use arrow keys to navigate";
      }
      ;
      if (state3.selectedNodeId instanceof Just) {
        return "Press 'a' for green child, 'b' for orange child. Arrow keys to navigate. Click to deselect.";
      }
      ;
      throw new Error("Failed pattern match at TreeBuilder2.App (line 250, column 21 - line 252, column 116): " + [state3.selectedNodeId.constructor.name]);
    })())]), div2([class_("tree-builder2-svg-container"), id3("tree-builder2-container")])([])]);
  };
  var normalStrokeWidth = 2;
  var nodeColor = function(v2) {
    if (v2 instanceof Root) {
      return "#4A90E2";
    }
    ;
    if (v2 instanceof TypeA) {
      return "#4AE2A4";
    }
    ;
    if (v2 instanceof TypeB) {
      return "#E27A4A";
    }
    ;
    throw new Error("Failed pattern match at TreeBuilder2.App (line 67, column 1 - line 67, column 32): " + [v2.constructor.name]);
  };
  var makeLinks7 = function(t2) {
    var val = head(t2);
    var children3 = tail(t2);
    var grandchildLinks = bind141(fromFoldable43(children3))(makeLinks7);
    var childLinks = bind141(fromFoldable43(children3))(function(child) {
      var childVal = head(child);
      return [{
        id: show86(val.id) + ("->" + show86(childVal.id)),
        sourceX: val.x,
        sourceY: val.y,
        targetX: childVal.x,
        targetY: childVal.y
      }];
    });
    return append127(childLinks)(grandchildLinks);
  };
  var isLeaf2 = function(t2) {
    var v2 = tail(t2);
    if (v2 instanceof Nil) {
      return true;
    }
    ;
    return false;
  };
  var isLeafById = function(targetId) {
    return function(t2) {
      var val = head(t2);
      var children3 = tail(t2);
      var $164 = val.id === targetId;
      if ($164) {
        return isLeaf2(t2);
      }
      ;
      return any2(identity18)(fromFoldable43(map129(isLeafById(targetId))(children3)));
    };
  };
  var toRenderNode = function(state3) {
    return function(node) {
      var isSelected = eq110(state3.selectedNodeId)(new Just(node.id));
      var isNodeLeaf = isLeafById(node.id)(state3.userTree);
      return {
        id: node.id,
        nodeType: node.nodeType,
        x: node.x,
        y: node.y,
        depth: node.depth,
        color: nodeColor(node.nodeType),
        strokeWidth: (function() {
          if (isSelected) {
            return selectedStrokeWidth;
          }
          ;
          return normalStrokeWidth;
        })(),
        isLeaf: isNodeLeaf
      };
    };
  };
  var initialTree = /* @__PURE__ */ (function() {
    return mkTree({
      id: 0,
      nodeType: Root.value,
      x: 0,
      y: 0,
      depth: 0
    })(Nil.value);
  })();
  var initialState7 = /* @__PURE__ */ (function() {
    return {
      userTree: initialTree,
      selectedNodeId: Nothing.value,
      nextId: 1,
      clickListener: Nothing.value
    };
  })();
  var getChildrenIds = function(targetId) {
    return function(t2) {
      var val = head(t2);
      var children3 = tail(t2);
      var $166 = val.id === targetId;
      if ($166) {
        return map130(function(c2) {
          return head(c2).id;
        })(fromFoldable43(children3));
      }
      ;
      return foldl4(function(acc) {
        return function(c2) {
          var $167 = $$null3(acc);
          if ($167) {
            return getChildrenIds(targetId)(c2);
          }
          ;
          return acc;
        };
      })([])(fromFoldable43(children3));
    };
  };
  var flattenTree2 = /* @__PURE__ */ fromFoldable3(/* @__PURE__ */ foldableCofree(foldableList));
  var findParentId = function(targetId) {
    return function(t2) {
      var val = head(t2);
      var children3 = tail(t2);
      var childIds = map129(function(c2) {
        return head(c2).id;
      })(children3);
      var $168 = elem10(targetId)(fromFoldable43(childIds));
      if ($168) {
        return new Just(val.id);
      }
      ;
      return foldl4(function(acc) {
        return function(c2) {
          if (acc instanceof Just) {
            return new Just(acc.value0);
          }
          ;
          if (acc instanceof Nothing) {
            return findParentId(targetId)(c2);
          }
          ;
          throw new Error("Failed pattern match at TreeBuilder2.App (line 187, column 34 - line 189, column 42): " + [acc.constructor.name]);
        };
      })(Nothing.value)(fromFoldable43(children3));
    };
  };
  var applyLayout = function(t2) {
    var config = {
      layerScale: defaultTreeConfig.layerScale,
      separation: defaultTreeConfig.separation,
      size: {
        width: 600,
        height: 400
      },
      minSeparation: 2
    };
    return tree(config)(t2);
  };
  var renderTreeViz = function(state3) {
    return function(listener) {
      return function __do7() {
        clearContainer4("#tree-builder2-container")();
        var positioned = applyLayout(state3.userTree);
        var nodes3 = flattenTree2(positioned);
        var links3 = makeLinks7(positioned);
        var renderNodes = map130(toRenderNode(state3))(nodes3);
        var minX = foldl4(function(acc) {
          return function(n) {
            return min17(acc)(n.x);
          };
        })(0)(nodes3);
        var maxX = foldl4(function(acc) {
          return function(n) {
            return max24(acc)(n.x);
          };
        })(0)(nodes3);
        var actualWidth = maxX - minX;
        var offsetX2 = (800 - actualWidth) / 2 - minX;
        return runD3v2M(bind220(select52("#tree-builder2-container"))(function(container) {
          var linksTree = withChild(named(SVG.value)("svg")([v3Attr20("width")(lit21(800)), v3Attr20("height")(lit21(500)), v3AttrStr("viewBox")(str22("0 0 " + (show139(800) + (" " + show139(500))))), v3AttrStr("id")(str22("tree-builder2-svg"))]))(withChild(named(Group.value)("zoomGroup")([v3AttrStr("class")(str22("zoom-group"))]))(withChild(named(Group.value)("linksGroup")([v3AttrStr("class")(str22("links"))]))(joinData("linkPaths")("path")(links3)(function(link5) {
            return elem3(Path.value)([v3AttrStr("d")(str22(linkBezierVertical(link5.sourceX + offsetX2)(link5.sourceY + 80)(link5.targetX + offsetX2)(link5.targetY + 80))), v3AttrStr("fill")(str22("none")), v3AttrStr("stroke")(str22("#888")), v3Attr20("stroke-width")(lit21(2))]);
          }))));
          return bind220(renderTree124(container)(linksTree))(function(linksSelections) {
            return bind220(liftEffect52(reselectD3v2("zoomGroup")(linksSelections)))(function(zoomGroupSel) {
              var nodesTree = withChild(named(Group.value)("nodesGroup")([v3AttrStr("class")(str22("nodes"))]))(joinData("nodeCircles")("circle")(renderNodes)(function(node) {
                return withBehaviors(elem3(Circle.value)([v3Attr20("cx")(lit21(node.x + offsetX2)), v3Attr20("cy")(lit21(node.y + 80)), v3Attr20("r")(lit21(15)), v3AttrStr("fill")(str22(node.color)), v3AttrStr("stroke")(str22("#333")), v3Attr20("stroke-width")(lit21(node.strokeWidth)), v3AttrStr("cursor")(str22("pointer"))]))([new ClickWithDatum(function(n) {
                  return notify(listener)(new NodeClicked(n.id));
                })]);
              }));
              return bind220(renderTree224(zoomGroupSel)(nodesTree))(function() {
                return pure127(unit);
              });
            });
          });
        }))();
      };
    };
  };
  var addChildToNode2 = function(targetId) {
    return function(newChild) {
      return function(t2) {
        var val = head(t2);
        var children3 = tail(t2);
        var $171 = val.id === targetId;
        if ($171) {
          return mkTree(val)(append212(children3)(new Cons(mkTree(newChild)(Nil.value), Nil.value)));
        }
        ;
        return mkTree(val)(map129(addChildToNode2(targetId)(newChild))(children3));
      };
    };
  };
  var handleAction50 = function(dictMonadAff) {
    var liftEffect118 = liftEffect(monadEffectHalogenM(dictMonadAff.MonadEffect0()));
    return function(v2) {
      if (v2 instanceof Initialize50) {
        return bind311(liftEffect118(create4))(function(v1) {
          return discard219(modify_21(function(v22) {
            var $174 = {};
            for (var $175 in v22) {
              if ({}.hasOwnProperty.call(v22, $175)) {
                $174[$175] = v22[$175];
              }
              ;
            }
            ;
            $174.clickListener = new Just(v1.listener);
            return $174;
          }))(function() {
            return discard219($$void19(subscribe2(v1.emitter)))(function() {
              return discard219(handleAction50(dictMonadAff)(RenderTree.value))(function() {
                return liftEffect118(setupZoom);
              });
            });
          });
        });
      }
      ;
      if (v2 instanceof NodeClicked) {
        return bind311(get21)(function(state3) {
          return discard219((function() {
            if (state3.selectedNodeId instanceof Just && state3.selectedNodeId.value0 === v2.value0) {
              return modify_21(function(s3) {
                var $180 = {};
                for (var $181 in s3) {
                  if ({}.hasOwnProperty.call(s3, $181)) {
                    $180[$181] = s3[$181];
                  }
                  ;
                }
                ;
                $180.selectedNodeId = Nothing.value;
                return $180;
              });
            }
            ;
            return modify_21(function(s3) {
              var $184 = {};
              for (var $185 in s3) {
                if ({}.hasOwnProperty.call(s3, $185)) {
                  $184[$185] = s3[$185];
                }
                ;
              }
              ;
              $184.selectedNodeId = new Just(v2.value0);
              return $184;
            });
          })())(function() {
            return handleAction50(dictMonadAff)(RenderTree.value);
          });
        });
      }
      ;
      if (v2 instanceof HandleKeyDown) {
        return bind311(get21)(function(state3) {
          var keyName = key(v2.value0);
          if (keyName === "ArrowUp") {
            return discard219((function() {
              if (state3.selectedNodeId instanceof Nothing) {
                return modify_21(function(s3) {
                  var $190 = {};
                  for (var $191 in s3) {
                    if ({}.hasOwnProperty.call(s3, $191)) {
                      $190[$191] = s3[$191];
                    }
                    ;
                  }
                  ;
                  $190.selectedNodeId = new Just(0);
                  return $190;
                });
              }
              ;
              if (state3.selectedNodeId instanceof Just) {
                var v1 = findParentId(state3.selectedNodeId.value0)(state3.userTree);
                if (v1 instanceof Just) {
                  return modify_21(function(s3) {
                    var $194 = {};
                    for (var $195 in s3) {
                      if ({}.hasOwnProperty.call(s3, $195)) {
                        $194[$195] = s3[$195];
                      }
                      ;
                    }
                    ;
                    $194.selectedNodeId = new Just(v1.value0);
                    return $194;
                  });
                }
                ;
                if (v1 instanceof Nothing) {
                  return pure213(unit);
                }
                ;
                throw new Error("Failed pattern match at TreeBuilder2.App (line 304, column 13 - line 306, column 35): " + [v1.constructor.name]);
              }
              ;
              throw new Error("Failed pattern match at TreeBuilder2.App (line 300, column 9 - line 306, column 35): " + [state3.selectedNodeId.constructor.name]);
            })())(function() {
              return handleAction50(dictMonadAff)(RenderTree.value);
            });
          }
          ;
          if (keyName === "ArrowDown") {
            return discard219((function() {
              if (state3.selectedNodeId instanceof Nothing) {
                return modify_21(function(s3) {
                  var $200 = {};
                  for (var $201 in s3) {
                    if ({}.hasOwnProperty.call(s3, $201)) {
                      $200[$201] = s3[$201];
                    }
                    ;
                  }
                  ;
                  $200.selectedNodeId = new Just(0);
                  return $200;
                });
              }
              ;
              if (state3.selectedNodeId instanceof Just) {
                var v1 = head2(getChildrenIds(state3.selectedNodeId.value0)(state3.userTree));
                if (v1 instanceof Just) {
                  return modify_21(function(s3) {
                    var $204 = {};
                    for (var $205 in s3) {
                      if ({}.hasOwnProperty.call(s3, $205)) {
                        $204[$205] = s3[$205];
                      }
                      ;
                    }
                    ;
                    $204.selectedNodeId = new Just(v1.value0);
                    return $204;
                  });
                }
                ;
                if (v1 instanceof Nothing) {
                  return pure213(unit);
                }
                ;
                throw new Error("Failed pattern match at TreeBuilder2.App (line 314, column 13 - line 316, column 35): " + [v1.constructor.name]);
              }
              ;
              throw new Error("Failed pattern match at TreeBuilder2.App (line 310, column 9 - line 316, column 35): " + [state3.selectedNodeId.constructor.name]);
            })())(function() {
              return handleAction50(dictMonadAff)(RenderTree.value);
            });
          }
          ;
          if (keyName === "ArrowLeft") {
            return discard219((function() {
              if (state3.selectedNodeId instanceof Nothing) {
                return modify_21(function(s3) {
                  var $210 = {};
                  for (var $211 in s3) {
                    if ({}.hasOwnProperty.call(s3, $211)) {
                      $210[$211] = s3[$211];
                    }
                    ;
                  }
                  ;
                  $210.selectedNodeId = new Just(0);
                  return $210;
                });
              }
              ;
              if (state3.selectedNodeId instanceof Just) {
                var v1 = findParentId(state3.selectedNodeId.value0)(state3.userTree);
                if (v1 instanceof Nothing) {
                  return pure213(unit);
                }
                ;
                if (v1 instanceof Just) {
                  var siblings = getChildrenIds(v1.value0)(state3.userTree);
                  var currentIdx = elemIndex3(state3.selectedNodeId.value0)(siblings);
                  if (currentIdx instanceof Just && currentIdx.value0 > 0) {
                    var v22 = index(siblings)(currentIdx.value0 - 1 | 0);
                    if (v22 instanceof Just) {
                      return modify_21(function(s3) {
                        var $216 = {};
                        for (var $217 in s3) {
                          if ({}.hasOwnProperty.call(s3, $217)) {
                            $216[$217] = s3[$217];
                          }
                          ;
                        }
                        ;
                        $216.selectedNodeId = new Just(v22.value0);
                        return $216;
                      });
                    }
                    ;
                    if (v22 instanceof Nothing) {
                      return pure213(unit);
                    }
                    ;
                    throw new Error("Failed pattern match at TreeBuilder2.App (line 331, column 21 - line 333, column 43): " + [v22.constructor.name]);
                  }
                  ;
                  return pure213(unit);
                }
                ;
                throw new Error("Failed pattern match at TreeBuilder2.App (line 324, column 13 - line 334, column 33): " + [v1.constructor.name]);
              }
              ;
              throw new Error("Failed pattern match at TreeBuilder2.App (line 320, column 9 - line 334, column 33): " + [state3.selectedNodeId.constructor.name]);
            })())(function() {
              return handleAction50(dictMonadAff)(RenderTree.value);
            });
          }
          ;
          if (keyName === "ArrowRight") {
            return discard219((function() {
              if (state3.selectedNodeId instanceof Nothing) {
                return modify_21(function(s3) {
                  var $224 = {};
                  for (var $225 in s3) {
                    if ({}.hasOwnProperty.call(s3, $225)) {
                      $224[$225] = s3[$225];
                    }
                    ;
                  }
                  ;
                  $224.selectedNodeId = new Just(0);
                  return $224;
                });
              }
              ;
              if (state3.selectedNodeId instanceof Just) {
                var v1 = findParentId(state3.selectedNodeId.value0)(state3.userTree);
                if (v1 instanceof Nothing) {
                  return pure213(unit);
                }
                ;
                if (v1 instanceof Just) {
                  var siblings = getChildrenIds(v1.value0)(state3.userTree);
                  var currentIdx = elemIndex3(state3.selectedNodeId.value0)(siblings);
                  if (currentIdx instanceof Just) {
                    var v22 = index(siblings)(currentIdx.value0 + 1 | 0);
                    if (v22 instanceof Just) {
                      return modify_21(function(s3) {
                        var $230 = {};
                        for (var $231 in s3) {
                          if ({}.hasOwnProperty.call(s3, $231)) {
                            $230[$231] = s3[$231];
                          }
                          ;
                        }
                        ;
                        $230.selectedNodeId = new Just(v22.value0);
                        return $230;
                      });
                    }
                    ;
                    if (v22 instanceof Nothing) {
                      return pure213(unit);
                    }
                    ;
                    throw new Error("Failed pattern match at TreeBuilder2.App (line 349, column 21 - line 351, column 43): " + [v22.constructor.name]);
                  }
                  ;
                  if (currentIdx instanceof Nothing) {
                    return pure213(unit);
                  }
                  ;
                  throw new Error("Failed pattern match at TreeBuilder2.App (line 347, column 20 - line 352, column 39): " + [currentIdx.constructor.name]);
                }
                ;
                throw new Error("Failed pattern match at TreeBuilder2.App (line 342, column 13 - line 352, column 39): " + [v1.constructor.name]);
              }
              ;
              throw new Error("Failed pattern match at TreeBuilder2.App (line 338, column 9 - line 352, column 39): " + [state3.selectedNodeId.constructor.name]);
            })())(function() {
              return handleAction50(dictMonadAff)(RenderTree.value);
            });
          }
          ;
          if (keyName === "a") {
            return for_14(state3.selectedNodeId)(function(selectedId) {
              var newChild = {
                id: state3.nextId,
                nodeType: TypeA.value,
                x: 0,
                y: 0,
                depth: 0
              };
              var newTree = addChildToNode2(selectedId)(newChild)(state3.userTree);
              return discard219(modify_21(function(s3) {
                var $237 = {};
                for (var $238 in s3) {
                  if ({}.hasOwnProperty.call(s3, $238)) {
                    $237[$238] = s3[$238];
                  }
                  ;
                }
                ;
                $237.userTree = newTree;
                $237.nextId = s3.nextId + 1 | 0;
                return $237;
              }))(function() {
                return handleAction50(dictMonadAff)(RenderTree.value);
              });
            });
          }
          ;
          if (keyName === "b") {
            return for_14(state3.selectedNodeId)(function(selectedId) {
              var newChild = {
                id: state3.nextId,
                nodeType: TypeB.value,
                x: 0,
                y: 0,
                depth: 0
              };
              var newTree = addChildToNode2(selectedId)(newChild)(state3.userTree);
              return discard219(modify_21(function(s3) {
                var $240 = {};
                for (var $241 in s3) {
                  if ({}.hasOwnProperty.call(s3, $241)) {
                    $240[$241] = s3[$241];
                  }
                  ;
                }
                ;
                $240.userTree = newTree;
                $240.nextId = s3.nextId + 1 | 0;
                return $240;
              }))(function() {
                return handleAction50(dictMonadAff)(RenderTree.value);
              });
            });
          }
          ;
          return pure213(unit);
        });
      }
      ;
      if (v2 instanceof RenderTree) {
        return bind311(get21)(function(state3) {
          if (state3.clickListener instanceof Just) {
            return liftEffect118(renderTreeViz(state3)(state3.clickListener.value0));
          }
          ;
          if (state3.clickListener instanceof Nothing) {
            return pure213(unit);
          }
          ;
          throw new Error("Failed pattern match at TreeBuilder2.App (line 382, column 5 - line 384, column 27): " + [state3.clickListener.constructor.name]);
        });
      }
      ;
      throw new Error("Failed pattern match at TreeBuilder2.App (line 267, column 16 - line 384, column 27): " + [v2.constructor.name]);
    };
  };
  var component51 = function(dictMonadAff) {
    return mkComponent({
      initialState: function(v2) {
        return initialState7;
      },
      render: render56,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction50(dictMonadAff),
        initialize: new Just(Initialize50.value)
      })
    });
  };

  // output/PSD3.Main/index.js
  var bind99 = /* @__PURE__ */ bind(bindHalogenM);
  var liftEffect53 = /* @__PURE__ */ liftEffect(/* @__PURE__ */ monadEffectHalogenM(monadEffectAff));
  var discard71 = /* @__PURE__ */ discard(discardUnit)(bindHalogenM);
  var when14 = /* @__PURE__ */ when(applicativeHalogenM);
  var pure106 = /* @__PURE__ */ pure(applicativeHalogenM);
  var spy2 = /* @__PURE__ */ spy();
  var modify_22 = /* @__PURE__ */ modify_(monadStateHalogenM);
  var slot_4 = /* @__PURE__ */ slot_();
  var slot_1 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "home";
    }
  })(ordUnit);
  var slot_22 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "gettingStarted";
    }
  })(ordUnit);
  var slot_32 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "wizard";
    }
  })(ordUnit);
  var slot_42 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "howtoIndex";
    }
  })(ordUnit);
  var slot_5 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "howtoTransitions";
    }
  })(ordUnit);
  var component1 = /* @__PURE__ */ component15(monadAffAff);
  var slot_6 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "howtoForceGraphs";
    }
  })(ordUnit);
  var component210 = /* @__PURE__ */ component10(monadAffAff);
  var slot_7 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "howtoHierarchical";
    }
  })(ordUnit);
  var component310 = /* @__PURE__ */ component11(monadAffAff);
  var slot_8 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "howtoEvents";
    }
  })(ordUnit);
  var component410 = /* @__PURE__ */ component9(monadAffAff);
  var slot_9 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "howtoTreeAPI";
    }
  })(ordUnit);
  var component52 = /* @__PURE__ */ component16(monadAffAff);
  var slot_10 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "howtoLoadingData";
    }
  })(ordUnit);
  var component62 = /* @__PURE__ */ component12(monadAffAff);
  var slot_11 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "howtoAxesScales";
    }
  })(ordUnit);
  var component72 = /* @__PURE__ */ component7(monadAffAff);
  var slot_12 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "howtoTooltips";
    }
  })(ordUnit);
  var component82 = /* @__PURE__ */ component14(monadAffAff);
  var slot_13 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "howtoDebugging";
    }
  })(ordUnit);
  var component92 = /* @__PURE__ */ component8(monadAffAff);
  var slot_14 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "howtoPerformance";
    }
  })(ordUnit);
  var component102 = /* @__PURE__ */ component13(monadAffAff);
  var slot_15 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "howtoTreeExplorer";
    }
  })(ordUnit);
  var component112 = /* @__PURE__ */ component17(monadAffAff);
  var slot_16 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "understanding";
    }
  })(ordUnit);
  var slot_17 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "understandingGrammar";
    }
  })(ordUnit);
  var component122 = /* @__PURE__ */ component39(monadAffAff);
  var slot_18 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "understandingAttributes";
    }
  })(ordUnit);
  var component132 = /* @__PURE__ */ component38(monadAffAff);
  var slot_19 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "understandingSelections";
    }
  })(ordUnit);
  var component142 = /* @__PURE__ */ component41(monadAffAff);
  var slot_20 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "understandingTreeAPI";
    }
  })(ordUnit);
  var component152 = /* @__PURE__ */ component42(monadAffAff);
  var slot_21 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "understandingScenes";
    }
  })(ordUnit);
  var component162 = /* @__PURE__ */ component40(monadAffAff);
  var slot_222 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "reference";
    }
  })(ordUnit);
  var slot_23 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "tourIndex";
    }
  })(ordUnit);
  var slot_24 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "tourFoundations";
    }
  })(ordUnit);
  var component172 = /* @__PURE__ */ component26(monadAffAff);
  var slot_25 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "tourProfessional";
    }
  })(ordUnit);
  var component182 = /* @__PURE__ */ component32(monadAffAff);
  var slot_26 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "tourFlow";
    }
  })(ordUnit);
  var component192 = /* @__PURE__ */ component25(monadAffAff);
  var slot_27 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "tourHierarchies";
    }
  })(ordUnit);
  var component202 = /* @__PURE__ */ component28(monadAffAff);
  var slot_28 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "tourMotion";
    }
  })(ordUnit);
  var component212 = /* @__PURE__ */ component31(monadAffAff);
  var slot_29 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "tourWealthHealth";
    }
  })(ordUnit);
  var component222 = /* @__PURE__ */ component36(monadAffAff);
  var slot_30 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "tourInterpreters";
    }
  })(ordUnit);
  var component232 = /* @__PURE__ */ component30(monadAffAff);
  var slot_31 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "tourFPFTW";
    }
  })(ordUnit);
  var component242 = /* @__PURE__ */ component24(monadAffAff);
  var slot_322 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "tourGraphAlgorithms";
    }
  })(ordUnit);
  var component252 = /* @__PURE__ */ component27(monadAffAff);
  var slot_33 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "tourSimpsons";
    }
  })(ordUnit);
  var component262 = /* @__PURE__ */ component34(monadAffAff);
  var slot_34 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "showcase";
    }
  })(ordUnit);
  var slot_35 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "examples";
    }
  })(ordUnit);
  var slot_36 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "example";
    }
  })(ordUnit);
  var component272 = /* @__PURE__ */ component2(monadAffAff);
  var slot_37 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "treeAPI";
    }
  })(ordUnit);
  var component282 = /* @__PURE__ */ component37(monadAffAff);
  var slot_38 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "animatedTreeCluster";
    }
  })(ordUnit);
  var component292 = /* @__PURE__ */ component(monadAffAff);
  var slot_39 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "generalUpdatePattern";
    }
  })(ordUnit);
  var component302 = /* @__PURE__ */ component6(monadAffAff);
  var slot_40 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "mermaidTreeDemo";
    }
  })(ordUnit);
  var component312 = /* @__PURE__ */ component18(monadAffAff);
  var slot_41 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "sceneJoinDemo";
    }
  })(ordUnit);
  var component322 = /* @__PURE__ */ component21(monadAffAff);
  var slot_422 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "simpleForceGraph";
    }
  })(ordUnit);
  var component332 = /* @__PURE__ */ component23(monadAffAff);
  var slot_43 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "sankeyDebug";
    }
  })(ordUnit);
  var component342 = /* @__PURE__ */ component20(monadAffAff);
  var slot_44 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "forcePlayground";
    }
  })(ordUnit);
  var component352 = /* @__PURE__ */ component4(monadAffAff);
  var slot_45 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "treeBuilder";
    }
  })(ordUnit);
  var component362 = /* @__PURE__ */ component50(monadAffAff);
  var slot_46 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "treeBuilder2";
    }
  })(ordUnit);
  var component372 = /* @__PURE__ */ component51(monadAffAff);
  var slot_47 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "splom";
    }
  })(ordUnit);
  var component382 = /* @__PURE__ */ component19(monadAffAff);
  var slot_48 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "gupDebug";
    }
  })(ordUnit);
  var component392 = /* @__PURE__ */ component5(monadAffAff);
  var slot_49 = /* @__PURE__ */ slot_4({
    reflectSymbol: function() {
      return "acknowledgements";
    }
  })(ordUnit);
  var component402 = /* @__PURE__ */ component43(monadAffAff);
  var Initialize51 = /* @__PURE__ */ (function() {
    function Initialize52() {
    }
    ;
    Initialize52.value = new Initialize52();
    return Initialize52;
  })();
  var Navigate = /* @__PURE__ */ (function() {
    function Navigate2(value0) {
      this.value0 = value0;
    }
    ;
    Navigate2.create = function(value0) {
      return new Navigate2(value0);
    };
    return Navigate2;
  })();
  var RouteChanged = /* @__PURE__ */ (function() {
    function RouteChanged2(value0) {
      this.value0 = value0;
    }
    ;
    RouteChanged2.create = function(value0) {
      return new RouteChanged2(value0);
    };
    return RouteChanged2;
  })();
  var handleAction51 = function(v2) {
    if (v2 instanceof Initialize51) {
      return bind99(liftEffect53(function __do7() {
        var w = windowImpl();
        var loc = location(w)();
        return hash(loc)();
      }))(function(currentHash) {
        return discard71(when14(currentHash === "" || (currentHash === "#" || currentHash === "#/"))(liftEffect53(setHash2(routeToPath(Home.value)))))(function() {
          return bind99(subscribe2(makeEmitter(function(push2) {
            return matches2(routing)(function(v12) {
              return function(newRoute) {
                return push2(new RouteChanged(new Just(newRoute)));
              };
            });
          })))(function() {
            return pure106(unit);
          });
        });
      });
    }
    ;
    if (v2 instanceof Navigate) {
      return liftEffect53(setHash2(routeToPath(v2.value0)));
    }
    ;
    if (v2 instanceof RouteChanged) {
      var v1 = spy2("RouteChanged")(v2.value0);
      return discard71((function() {
        if (v2.value0 instanceof Just) {
          var v22 = spy2("Updating currentRoute to")(v2.value0.value0);
          return modify_22(function(v3) {
            var $214 = {};
            for (var $215 in v3) {
              if ({}.hasOwnProperty.call(v3, $215)) {
                $214[$215] = v3[$215];
              }
              ;
            }
            ;
            $214.currentRoute = v2.value0.value0;
            return $214;
          });
        }
        ;
        if (v2.value0 instanceof Nothing) {
          return modify_22(function(v23) {
            var $218 = {};
            for (var $219 in v23) {
              if ({}.hasOwnProperty.call(v23, $219)) {
                $218[$219] = v23[$219];
              }
              ;
            }
            ;
            $218.currentRoute = NotFound.value;
            return $218;
          });
        }
        ;
        throw new Error("Failed pattern match at PSD3.Main (line 456, column 5 - line 460, column 57): " + [v2.value0.constructor.name]);
      })())(function() {
        return liftEffect53(function __do7() {
          var w = windowImpl();
          return scroll(0)(0)(w)();
        });
      });
    }
    ;
    throw new Error("Failed pattern match at PSD3.Main (line 431, column 16 - line 464, column 19): " + [v2.constructor.name]);
  };
  var _wizard = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _understandingTreeAPI = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _understandingSelections = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _understandingScenes = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _understandingGrammar = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _understandingAttributes = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _understanding = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _treeBuilder2 = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _treeBuilder = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _treeAPI = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _tourWealthHealth = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _tourSimpsons = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _tourProfessional = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _tourMotion = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _tourInterpreters = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _tourIndex = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _tourHierarchies = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _tourGraphAlgorithms = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _tourFoundations = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _tourFlow = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _tourFPFTW = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _splom = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _simpleForceGraph = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _showcase = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _sceneJoinDemo = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _sankeyDebug = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _reference = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _mermaidTreeDemo = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _howtoTreeExplorer = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _howtoTreeAPI = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _howtoTransitions = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _howtoTooltips = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _howtoPerformance = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _howtoLoadingData = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _howtoIndex = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _howtoHierarchical = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _howtoForceGraphs = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _howtoEvents = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _howtoDebugging = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _howtoAxesScales = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _home = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _gupDebug = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _gettingStarted = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _generalUpdatePattern = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _forcePlayground = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _examples = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _example = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _animatedTreeCluster = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var _acknowledgements = /* @__PURE__ */ (function() {
    return $$Proxy.value;
  })();
  var renderPage = function(route) {
    var v2 = spy2("Route is")(route);
    if (v2 instanceof Home) {
      return slot_1(_home)(unit)(component44)(unit);
    }
    ;
    if (v2 instanceof GettingStarted) {
      return slot_22(_gettingStarted)(unit)(component47)(unit);
    }
    ;
    if (v2 instanceof Wizard) {
      return slot_32(_wizard)(unit)(component49)(unit);
    }
    ;
    if (v2 instanceof HowtoIndex) {
      return slot_42(_howtoIndex)(unit)(component45)(unit);
    }
    ;
    if (v2 instanceof HowtoTransitions) {
      return slot_5(_howtoTransitions)(unit)(component1)(unit);
    }
    ;
    if (v2 instanceof HowtoForceGraphs) {
      return slot_6(_howtoForceGraphs)(unit)(component210)(unit);
    }
    ;
    if (v2 instanceof HowtoHierarchical) {
      return slot_7(_howtoHierarchical)(unit)(component310)(unit);
    }
    ;
    if (v2 instanceof HowtoEvents) {
      return slot_8(_howtoEvents)(unit)(component410)(unit);
    }
    ;
    if (v2 instanceof HowtoTreeAPI) {
      return slot_9(_howtoTreeAPI)(unit)(component52)(unit);
    }
    ;
    if (v2 instanceof HowtoLoadingData) {
      return slot_10(_howtoLoadingData)(unit)(component62)(unit);
    }
    ;
    if (v2 instanceof HowtoAxesScales) {
      return slot_11(_howtoAxesScales)(unit)(component72)(unit);
    }
    ;
    if (v2 instanceof HowtoTooltips) {
      return slot_12(_howtoTooltips)(unit)(component82)(unit);
    }
    ;
    if (v2 instanceof HowtoDebugging) {
      return slot_13(_howtoDebugging)(unit)(component92)(unit);
    }
    ;
    if (v2 instanceof HowtoPerformance) {
      return slot_14(_howtoPerformance)(unit)(component102)(unit);
    }
    ;
    if (v2 instanceof HowtoTreeExplorer) {
      return slot_15(_howtoTreeExplorer)(unit)(component112)(unit);
    }
    ;
    if (v2 instanceof Understanding) {
      return slot_16(_understanding)(unit)(component48)(unit);
    }
    ;
    if (v2 instanceof UnderstandingGrammar) {
      return slot_17(_understandingGrammar)(unit)(component122)(unit);
    }
    ;
    if (v2 instanceof UnderstandingAttributes) {
      return slot_18(_understandingAttributes)(unit)(component132)(unit);
    }
    ;
    if (v2 instanceof UnderstandingSelections) {
      return slot_19(_understandingSelections)(unit)(component142)(unit);
    }
    ;
    if (v2 instanceof UnderstandingTreeAPI) {
      return slot_20(_understandingTreeAPI)(unit)(component152)(unit);
    }
    ;
    if (v2 instanceof UnderstandingScenes) {
      return slot_21(_understandingScenes)(unit)(component162)(unit);
    }
    ;
    if (v2 instanceof Reference) {
      return slot_222(_reference)(unit)(component46)(unit);
    }
    ;
    if (v2 instanceof ReferenceModule) {
      return slot_222(_reference)(unit)(component46)(unit);
    }
    ;
    if (v2 instanceof TourIndex) {
      return slot_23(_tourIndex)(unit)(component29)(unit);
    }
    ;
    if (v2 instanceof TourFoundations) {
      return slot_24(_tourFoundations)(unit)(component172)(unit);
    }
    ;
    if (v2 instanceof TourProfessional) {
      return slot_25(_tourProfessional)(unit)(component182)(unit);
    }
    ;
    if (v2 instanceof TourFlow) {
      return slot_26(_tourFlow)(unit)(component192)(unit);
    }
    ;
    if (v2 instanceof TourHierarchies) {
      return slot_27(_tourHierarchies)(unit)(component202)(unit);
    }
    ;
    if (v2 instanceof TourMotion) {
      return slot_28(_tourMotion)(unit)(component212)(unit);
    }
    ;
    if (v2 instanceof TourWealthHealth) {
      return slot_29(_tourWealthHealth)(unit)(component222)(unit);
    }
    ;
    if (v2 instanceof TourInterpreters) {
      return slot_30(_tourInterpreters)(unit)(component232)(unit);
    }
    ;
    if (v2 instanceof TourFPFTW) {
      return slot_31(_tourFPFTW)(unit)(component242)(unit);
    }
    ;
    if (v2 instanceof TourGraphAlgorithms) {
      return slot_322(_tourGraphAlgorithms)(unit)(component252)(unit);
    }
    ;
    if (v2 instanceof TourLesMisGUP) {
      return slot_1(_home)(unit)(component44)(unit);
    }
    ;
    if (v2 instanceof TourSimpsons) {
      return slot_33(_tourSimpsons)(unit)(component262)(unit);
    }
    ;
    if (v2 instanceof Showcase) {
      return slot_34(_showcase)(unit)(component22)(unit);
    }
    ;
    if (v2 instanceof Examples) {
      return slot_35(_examples)(unit)(component3)(unit);
    }
    ;
    if (v2 instanceof Example) {
      return slot_36(_example)(unit)(component272)(v2.value0);
    }
    ;
    if (v2 instanceof TreeAPI) {
      return slot_37(_treeAPI)(unit)(component282)(unit);
    }
    ;
    if (v2 instanceof AnimatedTreeCluster) {
      return slot_38(_animatedTreeCluster)(unit)(component292)(unit);
    }
    ;
    if (v2 instanceof GeneralUpdatePattern) {
      return slot_39(_generalUpdatePattern)(unit)(component302)(unit);
    }
    ;
    if (v2 instanceof LesMisGUPTree) {
      return slot_1(_home)(unit)(component44)(unit);
    }
    ;
    if (v2 instanceof LesMisGUP) {
      return slot_1(_home)(unit)(component44)(unit);
    }
    ;
    if (v2 instanceof LesMisGUPSimple) {
      return slot_1(_home)(unit)(component44)(unit);
    }
    ;
    if (v2 instanceof LesMisGUPTreeAPI) {
      return slot_1(_home)(unit)(component44)(unit);
    }
    ;
    if (v2 instanceof LesMisGUPClean) {
      return slot_1(_home)(unit)(component44)(unit);
    }
    ;
    if (v2 instanceof LesMisQueryDemo) {
      return slot_1(_home)(unit)(component44)(unit);
    }
    ;
    if (v2 instanceof ModuleGraph) {
      return slot_1(_home)(unit)(component44)(unit);
    }
    ;
    if (v2 instanceof MermaidTreeDemo) {
      return slot_40(_mermaidTreeDemo)(unit)(component312)(unit);
    }
    ;
    if (v2 instanceof SceneJoinDemo) {
      return slot_41(_sceneJoinDemo)(unit)(component322)(unit);
    }
    ;
    if (v2 instanceof ForceConfigPOC) {
      return slot_422(_simpleForceGraph)(unit)(component332)(unit);
    }
    ;
    if (v2 instanceof ForceConfigV2Test) {
      return slot_422(_simpleForceGraph)(unit)(component332)(unit);
    }
    ;
    if (v2 instanceof SimpleForceGraph) {
      return slot_422(_simpleForceGraph)(unit)(component332)(unit);
    }
    ;
    if (v2 instanceof SankeyDebug) {
      return slot_43(_sankeyDebug)(unit)(component342)(unit);
    }
    ;
    if (v2 instanceof ForcePlayground) {
      return slot_44(_forcePlayground)(unit)(component352)(unit);
    }
    ;
    if (v2 instanceof TreeBuilder) {
      return slot_45(_treeBuilder)(unit)(component362)(unit);
    }
    ;
    if (v2 instanceof TreeBuilder2) {
      return slot_46(_treeBuilder2)(unit)(component372)(unit);
    }
    ;
    if (v2 instanceof SPLOM) {
      return slot_47(_splom)(unit)(component382)(unit);
    }
    ;
    if (v2 instanceof GUPDebug) {
      return slot_48(_gupDebug)(unit)(component392)(unit);
    }
    ;
    if (v2 instanceof Acknowledgements) {
      return slot_49(_acknowledgements)(unit)(component402)(unit);
    }
    ;
    if (v2 instanceof NotFound) {
      return div2([classes(["not-found"])])([h1_([text5("404 - Page Not Found")]), p_([text5("The page you're looking for doesn't exist.")]), a([href4("#" + routeToPath(Home.value))])([text5("Go to Home")])]);
    }
    ;
    throw new Error("Failed pattern match at PSD3.Main (line 223, column 20 - line 428, column 8): " + [v2.constructor.name]);
  };
  var render57 = function(state3) {
    return div2([classes(["app"])])([main([classes(["app__main"])])([renderPage(state3.currentRoute)])]);
  };
  var component53 = /* @__PURE__ */ (function() {
    return mkComponent({
      initialState: function(v2) {
        return {
          currentRoute: Home.value
        };
      },
      render: render57,
      "eval": mkEval({
        handleQuery: defaultEval.handleQuery,
        receive: defaultEval.receive,
        finalize: defaultEval.finalize,
        handleAction: handleAction51,
        initialize: new Just(Initialize51.value)
      })
    });
  })();
  var main2 = /* @__PURE__ */ runHalogenAff(/* @__PURE__ */ bind(bindAff)(awaitBody)(function(body2) {
    return runUI2(component53)(unit)(body2);
  }));

  // <stdin>
  main2();
})();
